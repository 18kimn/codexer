<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>test</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <style>
    pre code.hljs {
      display: block;
      overflow-x: auto;
      padding: 1em;
    }
    code.hljs {
      padding: 3px 5px;
    } /*!
    Theme: GitHub
    Description: Light theme as seen on github.com
    Author: github.com
    Maintainer: @Hirse
    Updated: 2021-05-15

    Outdated base version: https://github.com/primer/github-syntax-light
    Current colors taken from GitHub's CSS
  */
    .hljs {
      color: #24292e;
      background: #fff;
    }
    .hljs-doctag,
    .hljs-keyword,
    .hljs-meta .hljs-keyword,
    .hljs-template-tag,
    .hljs-template-variable,
    .hljs-type,
    .hljs-variable.language_ {
      color: #d73a49;
    }
    .hljs-title,
    .hljs-title.class_,
    .hljs-title.class_.inherited__,
    .hljs-title.function_ {
      color: #6f42c1;
    }
    .hljs-attr,
    .hljs-attribute,
    .hljs-literal,
    .hljs-meta,
    .hljs-number,
    .hljs-operator,
    .hljs-selector-attr,
    .hljs-selector-class,
    .hljs-selector-id,
    .hljs-variable {
      color: #005cc5;
    }
    .hljs-meta .hljs-string,
    .hljs-regexp,
    .hljs-string {
      color: #032f62;
    }
    .hljs-built_in,
    .hljs-symbol {
      color: #e36209;
    }
    .hljs-code,
    .hljs-comment,
    .hljs-formula {
      color: #6a737d;
    }
    .hljs-name,
    .hljs-quote,
    .hljs-selector-pseudo,
    .hljs-selector-tag {
      color: #22863a;
    }
    .hljs-subst {
      color: #24292e;
    }
    .hljs-section {
      color: #005cc5;
      font-weight: 700;
    }
    .hljs-bullet {
      color: #735c0f;
    }
    .hljs-emphasis {
      color: #24292e;
      font-style: italic;
    }
    .hljs-strong {
      color: #24292e;
      font-weight: 700;
    }
    .hljs-addition {
      color: #22863a;
      background-color: #f0fff4;
    }
    .hljs-deletion {
      color: #b31d28;
      background-color: #ffeef0;
    }
  </style>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;700&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap');
    @page {
      @bottom-center {
        content: counter(page);
      }
    }
    html,
    body {
      font-family: 'Crimson Text';
    }
    code {
      font-family: 'Fira Code';
    }
    code,
    span,
    div,
    p {
      page-break-before: avoid !important;
      font-size: 8pt;
    }

    tr {
      page-break-before: avoid;
      display: 'inline-block';
    }

    html {
      zoom: 0.753;
    }
    body {
      page-break-before: avoid;
    }

    pre {
      -ms-overflow-style: none; /* IE and Edge */
      scrollbar-width: none; /* Firefox */
    }

    pre::-webkit-scrollbar {
      display: none;
    }
  </style>
</head>
<body>
<div style="width:100%;height:100%;
display:flex; place-items: center; place-content: center;
text-align: center; 
">
<h1 style="width: 100%;">
evictorbook
</h1>
</div>
<div style="page-break-after: always;">

</div>
<div style="width:100%;text-align:center;">
<a name="toc">
<h1>
Table of Contents
</h1>
</a>
</div>
<ol type="1">
<li>.vscode
<ol type="1">
<li><a href="#-vscode-launch-json">launch.json</a></li>
</ol></li>
<li><a href="#readme-md">README.md</a></li>
<li><a href="#appspec-app-yml">appspec.app.yml</a></li>
<li><a href="#appspec-db-yml">appspec.db.yml</a></li>
<li>deploy_scripts
<ol type="1">
<li>app
<ol type="1">
<li><a href="#deploy_scripts-app-prepare-sh">prepare.sh</a></li>
<li><a href="#deploy_scripts-app-start-sh">start.sh</a></li>
<li><a href="#deploy_scripts-app-stop-sh">stop.sh</a></li>
</ol></li>
<li>db
<ol type="1">
<li><a href="#deploy_scripts-db-prepare-sh">prepare.sh</a></li>
<li><a href="#deploy_scripts-db-start-sh">start.sh</a></li>
<li><a href="#deploy_scripts-db-stop-sh">stop.sh</a></li>
</ol></li>
</ol></li>
<li>dev_scripts
<ol type="1">
<li><a href="#dev_scripts-update-ui-deps-sh">update-ui-deps.sh</a></li>
</ol></li>
<li><a href="#docker-compose-db-only-yml">docker-compose.db-only.yml</a></li>
<li><a href="#docker-compose-local-nodb-yaml">docker-compose.local-nodb.yaml</a></li>
<li><a href="#docker-compose-override-yml">docker-compose.override.yml</a></li>
<li><a href="#docker-compose-prod-yml">docker-compose.prod.yml</a></li>
<li><a href="#docker-compose-yml">docker-compose.yml</a></li>
<li>nginx_proxy
<ol type="1">
<li>nginx_prod
<ol type="1">
<li><a href="#nginx_proxy-nginx_prod-prod-conf">prod.conf</a></li>
</ol></li>
<li>nginx_staging
<ol type="1">
<li><a href="#nginx_proxy-nginx_staging-staging-conf">staging.conf</a></li>
</ol></li>
</ol></li>
<li><a href="#package-json">package.json</a></li>
<li>server
<ol type="1">
<li><a href="#server--dockerignore">.dockerignore</a></li>
<li><a href="#server-dockerfile">Dockerfile</a></li>
<li>backends
<ol type="1">
<li><a href="#server-backends-neo4jbackend-js">neo4jBackend.js</a></li>
</ol></li>
<li>configData
<ol type="1">
<li><a href="#server-configdata-neighborhoods-js">neighborhoods.js</a></li>
</ol></li>
<li>flags
<ol type="1">
<li><a href="#server-flags-dbrouteflags-js">dbRouteFlags.js</a></li>
</ol></li>
<li>framework
<ol type="1">
<li><a href="#server-framework-readme-md">README.md</a></li>
<li><a href="#server-framework-flagutils-js">flagUtils.js</a></li>
<li><a href="#server-framework-mockapp-js">mockApp.js</a></li>
<li><a href="#server-framework-prototestutils-js">protoTestUtils.js</a></li>
<li><a href="#server-framework-protoutils-js">protoUtils.js</a></li>
<li><a href="#server-framework-serviceutils-js">serviceUtils.js</a></li>
<li><a href="#server-framework-statusutils-js">statusUtils.js</a></li>
</ol></li>
<li><a href="#server-index-js">index.js</a></li>
<li><a href="#server-package-json">package.json</a></li>
<li>rest
<ol type="1">
<li>handlers
<ol type="1">
<li>query
<ol type="1">
<li>about
<ol type="1">
<li><a href="#server-rest-handlers-query-about-assessor-js">assessor.js</a></li>
<li><a href="#server-rest-handlers-query-about-business-js">business.js</a></li>
<li><a href="#server-rest-handlers-query-about-eviction-js">eviction.js</a></li>
</ol></li>
<li><a href="#server-rest-handlers-query-index-js">index.js</a></li>
<li>neighborhood
<ol type="1">
<li><a href="#server-rest-handlers-query-neighborhood-evictions-js">evictions.js</a></li>
</ol></li>
<li>network
<ol type="1">
<li><a href="#server-rest-handlers-query-network-details-js">details.js</a></li>
<li><a href="#server-rest-handlers-query-network-graph-js">graph.js</a></li>
<li><a href="#server-rest-handlers-query-network-nodes-js">nodes.js</a></li>
<li><a href="#server-rest-handlers-query-network-portfolio-js">portfolio.js</a></li>
<li><a href="#server-rest-handlers-query-network-relatednetworks-js">relatedNetworks.js</a></li>
</ol></li>
<li>owner
<ol type="1">
<li><a href="#server-rest-handlers-query-owner-details-js">details.js</a></li>
<li><a href="#server-rest-handlers-query-owner-evictions-js">evictions.js</a></li>
<li><a href="#server-rest-handlers-query-owner-networkdetails-js">networkDetails.js</a></li>
<li><a href="#server-rest-handlers-query-owner-portfolio-js">portfolio.js</a></li>
<li><a href="#server-rest-handlers-query-owner-relatednetworks-js">relatedNetworks.js</a></li>
</ol></li>
<li>parcel
<ol type="1">
<li><a href="#server-rest-handlers-query-parcel-details-js">details.js</a></li>
<li><a href="#server-rest-handlers-query-parcel-evictions-js">evictions.js</a></li>
<li><a href="#server-rest-handlers-query-parcel-networkdetails-js">networkDetails.js</a></li>
<li><a href="#server-rest-handlers-query-parcel-owners-js">owners.js</a></li>
<li><a href="#server-rest-handlers-query-parcel-portfolio-js">portfolio.js</a></li>
<li><a href="#server-rest-handlers-query-parcel-relatednetworks-js">relatedNetworks.js</a></li>
</ol></li>
<li>search
<ol type="1">
<li><a href="#server-rest-handlers-query-search-search-js">search.js</a></li>
</ol></li>
<li><a href="#server-rest-handlers-query-servicehandler-js">serviceHandler.js</a></li>
<li>util_queries
<ol type="1">
<li><a href="#server-rest-handlers-query-util_queries-adjnetwork-js">adjNetwork.js</a></li>
</ol></li>
</ol></li>
<li>queryTest
<ol type="1">
<li><a href="#server-rest-handlers-querytest-index-js">index.js</a></li>
<li><a href="#server-rest-handlers-querytest-sample-js">sample.js</a></li>
<li><a href="#server-rest-handlers-querytest-servicehandler-js">serviceHandler.js</a></li>
</ol></li>
<li>unifiedSearch
<ol type="1">
<li><a href="#server-rest-handlers-unifiedsearch-search-js">search.js</a></li>
<li><a href="#server-rest-handlers-unifiedsearch-servicehandler-js">serviceHandler.js</a></li>
</ol></li>
</ol></li>
<li>routes
<ol type="1">
<li><a href="#server-rest-routes-conversionhelpers-js">conversionHelpers.js</a></li>
<li><a href="#server-rest-routes-dbroutelisteners-js">dbRouteListeners.js</a></li>
<li><a href="#server-rest-routes-dbroutepostprocessing-js">dbRoutePostProcessing.js</a></li>
<li><a href="#server-rest-routes-dbroutesetup-js">dbRouteSetup.js</a></li>
<li><a href="#server-rest-routes-sessionroutes-js">sessionRoutes.js</a></li>
<li><a href="#server-rest-routes-unifiedsearch-js">unifiedSearch.js</a></li>
</ol></li>
<li>server
<ol type="1">
<li><a href="#server-rest-server-rest-js">rest.js</a></li>
</ol></li>
</ol></li>
<li>schemas
<ol type="1">
<li><a href="#server-schemas-readme-md">README.md</a></li>
<li><a href="#server-schemas-compile2json-js">compile2json.js</a></li>
<li><a href="#server-schemas-compile_all_schemas-sh">compile_all_schemas.sh</a></li>
<li><a href="#server-schemas-delete_all_json-sh">delete_all_json.sh</a></li>
<li>legacy
<ol type="1">
<li><a href="#server-schemas-legacy-howto_compile_protos-md">HOWTO_Compile_protos.md</a></li>
<li><a href="#server-schemas-legacy-readme-md">README.md</a></li>
<li><a href="#server-schemas-legacy-compile_protos-sh">compile_protos.sh</a></li>
<li>md-generated
<ol type="1">
<li><a href="#server-schemas-legacy-md-generated-readme-md">README.md</a></li>
<li>graph
<ol type="1">
<li><a href="#server-schemas-legacy-md-generated-graph-docs-md">docs.md</a></li>
</ol></li>
<li>query
<ol type="1">
<li><a href="#server-schemas-legacy-md-generated-query-docs-md">docs.md</a></li>
</ol></li>
<li>rest
<ol type="1">
<li><a href="#server-schemas-legacy-md-generated-rest-docs-md">docs.md</a></li>
</ol></li>
</ol></li>
<li>proto
<ol type="1">
<li><a href="#server-schemas-legacy-proto-readme-md">README.md</a></li>
<li>graph
<ol type="1">
<li><a href="#server-schemas-legacy-proto-graph-graph-proto">graph.proto</a></li>
<li><a href="#server-schemas-legacy-proto-graph-nodes-proto">nodes.proto</a></li>
<li><a href="#server-schemas-legacy-proto-graph-relations-proto">relations.proto</a></li>
</ol></li>
<li>query
<ol type="1">
<li><a href="#server-schemas-legacy-proto-query-business-proto">business.proto</a></li>
<li><a href="#server-schemas-legacy-proto-query-eviction-proto">eviction.proto</a></li>
<li><a href="#server-schemas-legacy-proto-query-graph_util-proto">graph_util.proto</a></li>
<li><a href="#server-schemas-legacy-proto-query-network-proto">network.proto</a></li>
<li><a href="#server-schemas-legacy-proto-query-parcel-proto">parcel.proto</a></li>
<li><a href="#server-schemas-legacy-proto-query-query-proto">query.proto</a></li>
<li><a href="#server-schemas-legacy-proto-query-util-proto">util.proto</a></li>
</ol></li>
<li>rest
<ol type="1">
<li><a href="#server-schemas-legacy-proto-rest-business-proto">business.proto</a></li>
<li><a href="#server-schemas-legacy-proto-rest-eviction-proto">eviction.proto</a></li>
<li><a href="#server-schemas-legacy-proto-rest-graph_util-proto">graph_util.proto</a></li>
<li><a href="#server-schemas-legacy-proto-rest-network-proto">network.proto</a></li>
<li><a href="#server-schemas-legacy-proto-rest-network_ids-proto">network_ids.proto</a></li>
<li><a href="#server-schemas-legacy-proto-rest-parcel-proto">parcel.proto</a></li>
<li><a href="#server-schemas-legacy-proto-rest-rest-proto">rest.proto</a></li>
<li><a href="#server-schemas-legacy-proto-rest-user_feedback_report-proto">user_feedback_report.proto</a></li>
<li><a href="#server-schemas-legacy-proto-rest-util-proto">util.proto</a></li>
</ol></li>
<li>search
<ol type="1">
<li><a href="#server-schemas-legacy-proto-search-search-proto">search.proto</a></li>
</ol></li>
</ol></li>
</ol></li>
<li>src
<ol type="1">
<li>graph_util
<ol type="1">
<li><a href="#server-schemas-src-graph_util-graph_barbells-js">graph_barbells.js</a></li>
<li><a href="#server-schemas-src-graph_util-graph_node-js">graph_node.js</a></li>
<li><a href="#server-schemas-src-graph_util-graph_node_lite-js">graph_node_lite.js</a></li>
<li><a href="#server-schemas-src-graph_util-graph_relation_barbell-js">graph_relation_barbell.js</a></li>
</ol></li>
<li>pages
<ol type="1">
<li><a href="#server-schemas-src-pages-parcel_page-js">parcel_page.js</a></li>
</ol></li>
<li>query
<ol type="1">
<li><a href="#server-schemas-src-query-additional_evictor_reference-js">additional_evictor_reference.js</a></li>
<li><a href="#server-schemas-src-query-business_details_corp-js">business_details_corp.js</a></li>
<li><a href="#server-schemas-src-query-business_details_lp-js">business_details_lp.js</a></li>
<li><a href="#server-schemas-src-query-business_network_identifier-js">business_network_identifier.js</a></li>
<li><a href="#server-schemas-src-query-database_search_result-js">database_search_result.js</a></li>
<li><a href="#server-schemas-src-query-eviction_match_quality-js">eviction_match_quality.js</a></li>
<li><a href="#server-schemas-src-query-eviction_record-js">eviction_record.js</a></li>
<li><a href="#server-schemas-src-query-eviction_record_ownerpage-js">eviction_record_ownerpage.js</a></li>
<li><a href="#server-schemas-src-query-eviction_record_with_location-js">eviction_record_with_location.js</a></li>
<li><a href="#server-schemas-src-query-network_description-js">network_description.js</a></li>
<li><a href="#server-schemas-src-query-network_details-js">network_details.js</a></li>
<li><a href="#server-schemas-src-query-network_match_explanation-js">network_match_explanation.js</a></li>
<li><a href="#server-schemas-src-query-parcel_address_details-js">parcel_address_details.js</a></li>
<li><a href="#server-schemas-src-query-parcel_details-js">parcel_details.js</a></li>
<li><a href="#server-schemas-src-query-parcel_ownership_record-js">parcel_ownership_record.js</a></li>
<li><a href="#server-schemas-src-query-property_portfolio_entry-js">property_portfolio_entry.js</a></li>
<li><a href="#server-schemas-src-query-property_portfolio_entry_ownerpage-js">property_portfolio_entry_ownerpage.js</a></li>
<li><a href="#server-schemas-src-query-related_network_info-js">related_network_info.js</a></li>
<li>responses
<ol type="1">
<li><a href="#server-schemas-src-query-responses-common_portfolio_response-js">common_portfolio_response.js</a></li>
<li><a href="#server-schemas-src-query-responses-common_related_network_response-js">common_related_network_response.js</a></li>
<li><a href="#server-schemas-src-query-responses-neighborhood_evictions_response-js">neighborhood_evictions_response.js</a></li>
<li><a href="#server-schemas-src-query-responses-network_details_response-js">network_details_response.js</a></li>
<li><a href="#server-schemas-src-query-responses-network_graph_response-js">network_graph_response.js</a></li>
<li><a href="#server-schemas-src-query-responses-network_nodes_response-js">network_nodes_response.js</a></li>
<li><a href="#server-schemas-src-query-responses-owner_business_details_response-js">owner_business_details_response.js</a></li>
<li><a href="#server-schemas-src-query-responses-owner_evictions_response-js">owner_evictions_response.js</a></li>
<li><a href="#server-schemas-src-query-responses-owner_portfolio_response-js">owner_portfolio_response.js</a></li>
<li><a href="#server-schemas-src-query-responses-parcel_details_response-js">parcel_details_response.js</a></li>
<li><a href="#server-schemas-src-query-responses-parcel_evictions_response-js">parcel_evictions_response.js</a></li>
<li><a href="#server-schemas-src-query-responses-parcel_owners_response-js">parcel_owners_response.js</a></li>
<li><a href="#server-schemas-src-query-responses-search_response-js">search_response.js</a></li>
</ol></li>
</ol></li>
<li>type_util
<ol type="1">
<li><a href="#server-schemas-src-type_util-nullable_types-js">nullable_types.js</a></li>
</ol></li>
<li>unifiedSearch
<ol type="1">
<li>definitions
<ol type="1">
<li><a href="#server-schemas-src-unifiedsearch-definitions-business_search_payload-js">business_search_payload.js</a></li>
<li><a href="#server-schemas-src-unifiedsearch-definitions-business_type-js">business_type.js</a></li>
<li><a href="#server-schemas-src-unifiedsearch-definitions-category_enum-js">category_enum.js</a></li>
<li><a href="#server-schemas-src-unifiedsearch-definitions-neighborhood_summary_payload-js">neighborhood_summary_payload.js</a></li>
<li><a href="#server-schemas-src-unifiedsearch-definitions-parcel_search_payload-js">parcel_search_payload.js</a></li>
<li><a href="#server-schemas-src-unifiedsearch-definitions-ranking_info-js">ranking_info.js</a></li>
<li><a href="#server-schemas-src-unifiedsearch-definitions-search_result-js">search_result.js</a></li>
</ol></li>
<li><a href="#server-schemas-src-unifiedsearch-search_request-js">search_request.js</a></li>
<li><a href="#server-schemas-src-unifiedsearch-search_response-js">search_response.js</a></li>
</ol></li>
</ol></li>
</ol></li>
<li>startup_scripts</li>
<li>test
<ol type="1">
<li><a href="#server-test-api_tester-py">api_tester.py</a></li>
<li><a href="#server-test-getparceldetails-test-js">getParcelDetails.test.js</a></li>
<li><a href="#server-test-sample-test-js">sample.test.js</a></li>
<li>test_data
<ol type="1">
<li>neighborhood
<ol type="1">
<li><a href="#server-test-test_data-neighborhood-getneighborhoodevictionstestdata-js">getNeighborhoodEvictionsTestData.js</a></li>
</ol></li>
<li>network
<ol type="1">
<li><a href="#server-test-test_data-network-getnetworkdetailstestdata-js">getNetworkDetailsTestData.js</a></li>
<li><a href="#server-test-test_data-network-getnetworkgraphtestdata-js">getNetworkGraphTestData.js</a></li>
<li><a href="#server-test-test_data-network-getnetworknodestestdata-js">getNetworkNodesTestData.js</a></li>
<li><a href="#server-test-test_data-network-getnetworkportfoliotestdata-js">getNetworkPortfolioTestData.js</a></li>
<li><a href="#server-test-test_data-network-getnetworkrelatednetworkstestdata-js">getNetworkRelatedNetworksTestData.js</a></li>
</ol></li>
<li>owner
<ol type="1">
<li><a href="#server-test-test_data-owner-getownerdetailstestdata-js">getOwnerDetailsTestData.js</a></li>
<li><a href="#server-test-test_data-owner-getownerevictionstestdata-js">getOwnerEvictionsTestData.js</a></li>
<li><a href="#server-test-test_data-owner-getownerportfoliotestdata-js">getOwnerPortfolioTestData.js</a></li>
<li><a href="#server-test-test_data-owner-getownerrelatednetworkstestdata-js">getOwnerRelatedNetworksTestData.js</a></li>
</ol></li>
<li>parcel
<ol type="1">
<li><a href="#server-test-test_data-parcel-getparceldetailstestdata-js">getParcelDetailsTestData.js</a></li>
<li><a href="#server-test-test_data-parcel-getparcelevictionstestdata-js">getParcelEvictionsTestData.js</a></li>
<li><a href="#server-test-test_data-parcel-getparcelownerstestdata-js">getParcelOwnersTestData.js</a></li>
<li><a href="#server-test-test_data-parcel-getparcelportfoliotestdata-js">getParcelPortfolioTestData.js</a></li>
<li><a href="#server-test-test_data-parcel-getparcelrelatednetworkstestdata-js">getParcelRelatedNetworksTestData.js</a></li>
</ol></li>
<li>search
<ol type="1">
<li><a href="#server-test-test_data-search-getsearchtestdata-js">getSearchTestData.js</a></li>
</ol></li>
</ol></li>
</ol></li>
<li>utils
<ol type="1">
<li>gnarly
<ol type="1">
<li><a href="#server-utils-gnarly-readme-md">README.md</a></li>
<li><a href="#server-utils-gnarly-stringutils-js">stringUtils.js</a></li>
</ol></li>
</ol></li>
</ol></li>
<li>startup_scripts
<ol type="1">
<li><a href="#startup_scripts-neo4j-init-sh">neo4j-init.sh</a></li>
<li><a href="#startup_scripts-wait-for-it-sh">wait-for-it.sh</a></li>
</ol></li>
<li>type_definitions
<ol type="1">
<li><a href="#type_definitions-readme-md">README.md</a></li>
</ol></li>
<li>ui
<ol type="1">
<li><a href="#ui-dockerfile">Dockerfile</a></li>
<li><a href="#ui-dockerfile-dev">Dockerfile.dev</a></li>
<li><a href="#ui-i18next-parser-config-js">i18next-parser.config.js</a></li>
<li>nginx
<ol type="1">
<li><a href="#ui-nginx-default-conf">default.conf</a></li>
</ol></li>
<li><a href="#ui-package-json">package.json</a></li>
<li>public
<ol type="1">
<li><a href="#ui-public-index-html">index.html</a></li>
<li>locales
<ol type="1">
<li>en
<ol type="1">
<li><a href="#ui-public-locales-en-disclaimer-json">Disclaimer.json</a></li>
<li><a href="#ui-public-locales-en-evictions-json">Evictions.json</a></li>
<li><a href="#ui-public-locales-en-footer-json">Footer.json</a></li>
<li><a href="#ui-public-locales-en-glossary-json">Glossary.json</a></li>
<li><a href="#ui-public-locales-en-home-json">Home.json</a></li>
<li><a href="#ui-public-locales-en-home_old-json">Home_old.json</a></li>
<li><a href="#ui-public-locales-en-list-json">List.json</a></li>
<li><a href="#ui-public-locales-en-map-json">Map.json</a></li>
<li><a href="#ui-public-locales-en-methodology-json">Methodology.json</a></li>
<li><a href="#ui-public-locales-en-network-json">Network.json</a></li>
<li><a href="#ui-public-locales-en-network_old-json">Network_old.json</a></li>
<li><a href="#ui-public-locales-en-owner-json">Owner.json</a></li>
<li><a href="#ui-public-locales-en-owner_old-json">Owner_old.json</a></li>
<li><a href="#ui-public-locales-en-parcel-json">Parcel.json</a></li>
<li><a href="#ui-public-locales-en-parcel_old-json">Parcel_old.json</a></li>
<li><a href="#ui-public-locales-en-search-json">Search.json</a></li>
<li><a href="#ui-public-locales-en-search_old-json">Search_old.json</a></li>
<li><a href="#ui-public-locales-en-status-json">Status.json</a></li>
</ol></li>
</ol></li>
<li><a href="#ui-public-manifest-json">manifest.json</a></li>
<li><a href="#ui-public-methodology_graph-jpg">methodology_graph.jpg</a></li>
</ol></li>
<li>src
<ol type="1">
<li><a href="#ui-src--eslintrc">.eslintrc</a></li>
<li><a href="#ui-src--prettierrc">.prettierrc</a></li>
<li>components
<ol type="1">
<li><a href="#ui-src-components-app-js">App.js</a></li>
<li>Data
<ol type="1">
<li><a href="#ui-src-components-data-data-js">Data.js</a></li>
<li><a href="#ui-src-components-data-datadebug-js">DataDebug.js</a></li>
<li><a href="#ui-src-components-data-datainner-js">DataInner.js</a></li>
<li><a href="#ui-src-components-data-datastate-js">DataState.js</a></li>
<li><a href="#ui-src-components-data-datautils-js">DataUtils.js</a></li>
</ol></li>
<li>DataMap
<ol type="1">
<li><a href="#ui-src-components-datamap-datamap-js">DataMap.js</a></li>
<li>Map
<ol type="1">
<li>map_icons
<ol type="1">
<li><a href="#ui-src-components-datamap-map-map_icons-mapicons-js">mapIcons.js</a></li>
</ol></li>
</ol></li>
<li><a href="#ui-src-components-datamap-mapstyle-js">MapStyle.js</a></li>
<li><a href="#ui-src-components-datamap-maputils-js">MapUtils.js</a></li>
<li>Overlays
<ol type="1">
<li><a href="#ui-src-components-datamap-overlays-infobox-js">InfoBox.js</a></li>
<li><a href="#ui-src-components-datamap-overlays-legend-js">Legend.js</a></li>
<li><a href="#ui-src-components-datamap-overlays-mapboxgllayer-js">MapboxGLLayer.js</a></li>
<li><a href="#ui-src-components-datamap-overlays-overlay-js">Overlay.js</a></li>
</ol></li>
</ol></li>
<li>DataPage
<ol type="1">
<li><a href="#ui-src-components-datapage-datapage-js">DataPage.js</a></li>
</ol></li>
<li>DataSearchBar
<ol type="1">
<li><a href="#ui-src-components-datasearchbar-searchbar-js">SearchBar.js</a></li>
<li><a href="#ui-src-components-datasearchbar-searchbardropdownutils-js">SearchBarDropdownUtils.js</a></li>
<li><a href="#ui-src-components-datasearchbar-searchbarinpututils-js">SearchBarInputUtils.js</a></li>
</ol></li>
<li>DataTable
<ol type="1">
<li>AdornedTable
<ol type="1">
<li><a href="#ui-src-components-datatable-adornedtable-adornedtable-js">AdornedTable.js</a></li>
<li>BaseTable
<ol type="1">
<li><a href="#ui-src-components-datatable-adornedtable-basetable-basetable-js">BaseTable.js</a></li>
</ol></li>
</ol></li>
<li><a href="#ui-src-components-datatable-datatable-js">DataTable.js</a></li>
</ol></li>
<li><a href="#ui-src-components-evictionlist-js">EvictionList.js</a></li>
<li><a href="#ui-src-components-feedbackiframe-js">FeedbackIFrame.js</a></li>
<li><a href="#ui-src-components-footer-js">Footer.js</a></li>
<li>Graph
<ol type="1">
<li><a href="#ui-src-components-graph-d3graph-js">D3Graph.js</a></li>
<li><a href="#ui-src-components-graph-draw_graph-js">draw_graph.js</a></li>
<li><a href="#ui-src-components-graph-graphprocessor-js">graphProcessor.js</a></li>
</ol></li>
<li><a href="#ui-src-components-grid-js">Grid.js</a></li>
<li><a href="#ui-src-components-header-js">Header.js</a></li>
<li><a href="#ui-src-components-networklist-js">NetworkList.js</a></li>
<li><a href="#ui-src-components-notavailable-js">NotAvailable.js</a></li>
<li><a href="#ui-src-components-ownershipnetwork-js">OwnershipNetwork.js</a></li>
<li><a href="#ui-src-components-pagetitle-js">PageTitle.js</a></li>
<li><a href="#ui-src-components-propertylist-js">PropertyList.js</a></li>
</ol></li>
<li>config
<ol type="1">
<li><a href="#ui-src-config-config-json">config.json</a></li>
<li><a href="#ui-src-config-style-guide-txt">style-guide.txt</a></li>
</ol></li>
<li><a href="#ui-src-i18n-js">i18n.js</a></li>
<li>images</li>
<li><a href="#ui-src-index-js">index.js</a></li>
<li>pages
<ol type="1">
<li><a href="#ui-src-pages-disclaimer-js">Disclaimer.js</a></li>
<li><a href="#ui-src-pages-evictionpage-js">EvictionPage.js</a></li>
<li><a href="#ui-src-pages-glossary-js">Glossary.js</a></li>
<li><a href="#ui-src-pages-home-js">Home.js</a></li>
<li><a href="#ui-src-pages-methodology-js">Methodology.js</a></li>
<li><a href="#ui-src-pages-networkpage-js">NetworkPage.js</a></li>
<li><a href="#ui-src-pages-ownerpage-js">OwnerPage.js</a></li>
<li><a href="#ui-src-pages-parcelpage-js">ParcelPage.js</a></li>
<li><a href="#ui-src-pages-searchresultspage-js">SearchResultsPage.js</a></li>
</ol></li>
<li>state
<ol type="1">
<li><a href="#ui-src-state-rootreducer-js">rootReducer.js</a></li>
<li>slices
<ol type="1">
<li><a href="#ui-src-state-slices-searchstateslice-js">searchStateSlice.js</a></li>
</ol></li>
<li><a href="#ui-src-state-store-js">store.js</a></li>
</ol></li>
<li>theme
<ol type="1">
<li><a href="#ui-src-theme-footerstyles-js">FooterStyles.js</a></li>
<li><a href="#ui-src-theme-graphstyles-js">GraphStyles.js</a></li>
<li><a href="#ui-src-theme-headerstyles-js">HeaderStyles.js</a></li>
<li><a href="#ui-src-theme-homestyles-js">HomeStyles.js</a></li>
<li><a href="#ui-src-theme-liststyles-js">ListStyles.js</a></li>
<li><a href="#ui-src-theme-overlaystyles-js">OverlayStyles.js</a></li>
<li><a href="#ui-src-theme-searchbarstyles-js">SearchBarStyles.js</a></li>
<li><a href="#ui-src-theme-searchresultsstyles-js">SearchResultsStyles.js</a></li>
<li><a href="#ui-src-theme-theme-js">Theme.js</a></li>
</ol></li>
<li>utils
<ol type="1">
<li><a href="#ui-src-utils-api-js">api.js</a></li>
<li><a href="#ui-src-utils-csvformat-js">csvFormat.js</a></li>
<li><a href="#ui-src-utils-datautils-js">dataUtils.js</a></li>
<li><a href="#ui-src-utils-evictionformat-js">evictionFormat.js</a></li>
<li><a href="#ui-src-utils-iconsinit-js">iconsInit.js</a></li>
<li><a href="#ui-src-utils-materialutils-js">materialUtils.js</a></li>
<li><a href="#ui-src-utils-parcelformat-js">parcelFormat.js</a></li>
<li><a href="#ui-src-utils-propertyclass-js">propertyClass.js</a></li>
<li><a href="#ui-src-utils-reacttable-js">reactTable.js</a></li>
<li><a href="#ui-src-utils-searchutils-js">searchUtils.js</a></li>
<li><a href="#ui-src-utils-stringutils-js">stringUtils.js</a></li>
<li><a href="#ui-src-utils-stringutils-test-js">stringUtils.test.js</a></li>
<li><a href="#ui-src-utils-tableutils-js">tableUtils.js</a></li>
</ol></li>
</ol></li>
<li>startup_scripts</li>
</ol></li>
</ol>
<div style="page-break-after: always;">

</div>
<h2 id="vscodelaunch.json"><a href="#toc"><a name="-vscode-launch-json">.vscode/launch.json</a></a></h2>
<pre><code>{
  <span class="hljs-regexp">//</span> Use IntelliSense to learn about possible attributes.
  <span class="hljs-regexp">//</span> Hover to view descriptions of existing attributes.
  <span class="hljs-regexp">//</span> For more information, visit: https:<span class="hljs-regexp">//g</span>o.microsoft.com<span class="hljs-regexp">/fwlink/</span>?linkid=<span class="hljs-number">830387</span>
  <span class="hljs-string">&quot;version&quot;</span>: <span class="hljs-string">&quot;0.2.0&quot;</span>,
  <span class="hljs-string">&quot;configurations&quot;</span>: [
    {
      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;pwa-chrome&quot;</span>,
      <span class="hljs-string">&quot;request&quot;</span>: <span class="hljs-string">&quot;launch&quot;</span>,
      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;Launch Chrome against localhost&quot;</span>,
      <span class="hljs-string">&quot;url&quot;</span>: <span class="hljs-string">&quot;http://localhost:3000&quot;</span>,
      <span class="hljs-string">&quot;webRoot&quot;</span>: <span class="hljs-string">&quot;${workspaceFolder}&quot;</span>
    }
  ]
}</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="readme.md"><a href="#toc"><a name="readme-md">README.md</a></a></h2>
<pre><code>## Introduction

<span class="hljs-title">Please see [The EvictorBook Developer&#x27;s Guide](https:</span>//docs.google.com/document/d/<span class="hljs-number">1</span>NnJ_Yd_Av8S2bFs5MceeA73BXmx0Ebvy_hJ4xNJI1IA/edit#heading=h.<span class="hljs-number">7</span>gbjrtcbk8kv) for an in-depth introduction to the project.

<span class="hljs-title">See also [EvictorBook Community Agreements](https:</span>//docs.google.com/document/d/<span class="hljs-number">1</span>kUGeOOMEB-_N5oLhi8TK01EW33pmATzyXW8O7-gldw4/edit)

## EvictorBook Setup

This guide summarizes the steps needed to build <span class="hljs-literal">and</span> run `EvictorBook` from source code, with steps for troubleshooting common problems.

<span class="hljs-title">    BEFORE YOU START:</span> please be aware that building the production branch immediately followed by the staging branch can cause problems with your dev environment.

### Dev Environment

<span class="hljs-number">1</span>. Download <span class="hljs-literal">or</span> clone the repository: `https://github.com/antievictionmappingproject/evictorbook.git`

<span class="hljs-number">1</span>. Switch to the `STAGING` branch (IMPORTANT)
   &lt;br/&gt;&lt;br/&gt;
   The `STAGING` branch is the `correct branch` to work from for anyone <span class="hljs-keyword">new</span> to the project
   Building the production branch immediately followed by the staging branch `can cause problems` with your dev environment
   &lt;br/&gt;&lt;br/&gt;
<span class="hljs-number">1</span>. Install Docker

<span class="hljs-title">   Setup in Linux:</span>

   ```
   sudo apt-get -y install docker-engine
   sudo usermod -aG docker $USER
   sudo reboot
   ```

<span class="hljs-title">   For other operating systems, please refer to the appropriate [Docker setup guide](https:</span>//docs.docker.com/get-docker/).

<span class="hljs-number">1</span>. First, ensure that you have an AWS IAM role with access to the AEMP S3 bucket. In the root directory, create a `.env` file with your AWS credentials, using the following:

   ```
   AWS_ACCESS_KEY_ID=YOUR_ACCESS_KEY
   AWS_SECRET_ACCESS_KEY=YOUR_SECRET_ACCESS_KEY
   ```

<span class="hljs-number">1</span>. Run the default Docker-Compose script. This will launch <span class="hljs-number">3</span> containers: the UI, the api server, <span class="hljs-literal">and</span> a local Neo4j database
   for testing <span class="hljs-literal">and</span> development.

   ```
   docker-compose up
   ```

   `It is normal for this step to take several minutes`

<span class="hljs-title">   Once this completes, the app is available at `localhost:3000`, the Neo4J browser at `localhost:7474`, and the REST API at `localhost:</span><span class="hljs-number">4000</span>/api`.

   For edits, tear downs, <span class="hljs-literal">or</span> re-builds `docker-compose down -V` <span class="hljs-literal">and</span> manually delete the _neo4j-import-done.flag_ file in the &lt;u&gt;_neo4j_data_&lt;/u&gt; folder

### Troubleshooting

<span class="hljs-number">1</span>. Missing Dependencies

- You may get a build-time error about missing depencencies occassionally
- This is normal when pulling down <span class="hljs-literal">or</span> switching to a branch that has <span class="hljs-keyword">new</span> NPM dependencies that are <span class="hljs-literal">not</span> installed locally
- Running `NPM install` in a terminal will `NOT` work due to a virtual file system

<span class="hljs-title">  `Run these commands verbatim in the command line, while in the root project directory:</span>`

<span class="hljs-title">      The UI or frontend container:</span>

      docker-compose run ui npm install
      docker container restart ui


<span class="hljs-title">      The API or backend container:</span>

      docker-compose run api npm install
      docker container restart api

<span class="hljs-number">2</span>. If you encounter a `java.lang.RuntimeException` during start-up on the `neo4j_dev_db` container, you likely need to run `docker-compose down` before running `docker-compose up`.

<span class="hljs-number">3</span>. **`react-app-rewired: <span class="hljs-literal">not</span> found` crash loop**

   See <span class="hljs-string">&quot;Updating Dependencies&quot;</span> above. If all else fails, you _can_ nuke Docker completely by force stopping any active containers <span class="hljs-literal">and</span> then running a system prune:

   ```
   docker container stop $(docker container ls -aq)
   docker system prune -af --volumes
   ```

   This will remove _everything_ though, so be sure that&#x27;s what you want.

<span class="hljs-number">4</span>. If you still need help, feel free to post on Anti-Eviction Mapping Project Slack<span class="hljs-comment">; someone is usually around to help.</span>

### Prod Environment

<span class="hljs-number">1</span>. Launch an EC2 instance running Ubuntu (e.g. Ubuntu <span class="hljs-number">18.04</span>)

<span class="hljs-number">1</span>. Make sure the security group for the EC2 instance has port <span class="hljs-number">3000</span> open

<span class="hljs-number">1</span>. SSH into the instance

<span class="hljs-number">1</span>. Install Docker (Linux)
   ```
   sudo apt-get -y install docker-engine
   sudo usermod -aG docker $USER
   sudo reboot
   ```
<span class="hljs-number">1</span>. Export the test/production Neo4j endpoint as the environment variable `DB_ENDPOINT`.  
   Be sure it references a current neo4j instance. E.g.
   ```
   export DB_ENDPOINT=ec2-<span class="hljs-number">01</span>-<span class="hljs-number">234</span>-<span class="hljs-number">56</span>-<span class="hljs-number">789</span>.us-west-<span class="hljs-number">2</span>.compute.amazonaws.com
   ```
   To remove the the environment variable (for example when switching back to a dev environment), unset it
   ```
   unset DB_ENDPOINT
   ```
<span class="hljs-number">1</span>. Run the production Docker-Compose. This will launch <span class="hljs-number">3</span> containers: the UI, the api server <span class="hljs-literal">and</span> the nginx webserver.
   ```
   docker-compose -f docker-compose.yml -f docker-compose.prod.yml up -d
   ```

### Using Test Database

In either the Development Environment <span class="hljs-literal">or</span> Production environment set-ups, you can optionally specify a Neo4j endpoint for use in testing experimental API queries. 

The main use case for this is during transitions between database verions -- the test database can be run on a remote EC2, <span class="hljs-literal">and</span> then in both local development <span class="hljs-literal">and</span> in the staging environment, the test queries will be run against the <span class="hljs-keyword">new</span> database. Test queries should be integrated as the default queries before being pushed to the production instance, however.

To enable this, comment in the `NEO4J_URI_TEST` docker flag <span class="hljs-literal">and</span> export the test Neo4j endpoint as the environment variable `DB_ENDPOINT_TEST`. Be sure it references a current neo4j instance. E.g.
   ```
   export DB_ENDPOINT_TEST=ec2-<span class="hljs-number">01</span>-<span class="hljs-number">234</span>-<span class="hljs-number">56</span>-<span class="hljs-number">789</span>.us-west-<span class="hljs-number">2</span>.compute.amazonaws.com
   ```

To disable using the test database, unset the environment variable.
   ```
   unset DB_ENDPOINT_TEST
   ```</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="appspec.app.yml"><a href="#toc"><a name="appspec-app-yml">appspec.app.yml</a></a></h2>
<pre><code><span class="hljs-attr">version:</span> <span class="hljs-number">0.0</span>
<span class="hljs-attr">os:</span> <span class="hljs-string">linux</span>
<span class="hljs-attr">files:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">source:</span> <span class="hljs-string">/</span>
    <span class="hljs-attr">destination:</span> <span class="hljs-string">/ebook</span>
<span class="hljs-attr">hooks:</span>
  <span class="hljs-attr">BeforeInstall:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">location:</span> <span class="hljs-string">deploy_scripts/app/stop.sh</span>
      <span class="hljs-attr">timeout:</span> <span class="hljs-number">3600</span>
      <span class="hljs-attr">runas:</span> <span class="hljs-string">root</span>
  <span class="hljs-attr">ApplicationStart:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">location:</span> <span class="hljs-string">deploy_scripts/app/start.sh</span>
      <span class="hljs-attr">timeout:</span> <span class="hljs-number">3600</span>
      <span class="hljs-attr">runas:</span> <span class="hljs-string">root</span></pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="appspec.db.yml"><a href="#toc"><a name="appspec-db-yml">appspec.db.yml</a></a></h2>
<pre><code><span class="hljs-attr">version:</span> <span class="hljs-number">0.0</span>
<span class="hljs-attr">os:</span> <span class="hljs-string">linux</span>
<span class="hljs-attr">files:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">source:</span> <span class="hljs-string">/</span>
    <span class="hljs-attr">destination:</span> <span class="hljs-string">/ebook</span>
<span class="hljs-attr">hooks:</span>
  <span class="hljs-attr">BeforeInstall:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">location:</span> <span class="hljs-string">deploy_scripts/db/stop.sh</span>
      <span class="hljs-attr">timeout:</span> <span class="hljs-number">3600</span>
      <span class="hljs-attr">runas:</span> <span class="hljs-string">root</span>
  <span class="hljs-attr">ApplicationStart:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">location:</span> <span class="hljs-string">deploy_scripts/db/start.sh</span>
      <span class="hljs-attr">timeout:</span> <span class="hljs-number">3600</span>
      <span class="hljs-attr">runas:</span> <span class="hljs-string">root</span></pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="deploy_scriptsappprepare.sh"><a href="#toc"><a name="deploy_scripts-app-prepare-sh">deploy_scripts/app/prepare.sh</a></a></h2>
<pre><code><span class="hljs-meta">#!/bin/sh</span>

apt-get install -y docker.io
<span class="hljs-comment"># Debian package heavily deprecated, as usual.</span>
curl -L https://github.com/docker/compose/releases/download/1.17.1/docker-compose-`<span class="hljs-built_in">uname</span> -s`-`<span class="hljs-built_in">uname</span> -m` -o /usr/local/bin/docker-compose
<span class="hljs-built_in">chmod</span> +x /usr/local/bin/docker-compose
gpasswd -a ubuntu docker
newgrp docker
<span class="hljs-built_in">chown</span> -R ubuntu:ubuntu /srv/arteria
<span class="hljs-built_in">yes</span> | sudo apt install jq
<span class="hljs-built_in">yes</span> | sudo apt install awscli
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="deploy_scriptsappstart.sh"><a href="#toc"><a name="deploy_scripts-app-start-sh">deploy_scripts/app/start.sh</a></a></h2>
<pre><code><span class="hljs-meta">#!/bin/bash</span>

<span class="hljs-comment"># ApplicationStart – You typically use this deployment lifecycle event to restart services that were stopped during ApplicationStop.</span>
<span class="hljs-comment"># Let&#x27;s Encrypt staging environment details can be found here: https://letsencrypt.org/docs/staging-environment/</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Start Container&quot;</span>
<span class="hljs-built_in">cd</span> /ebook

<span class="hljs-comment"># AWS vars</span>
deployment_config_s3_path=<span class="hljs-string">&quot;s3://evictorbook/deployment_config.json&quot;</span>
deployment_config_file=<span class="hljs-string">&quot;deployment_config.json&quot;</span>

<span class="hljs-comment"># Certbot vars</span>
rsa_key_size=4096
certbot_data_path=<span class="hljs-string">&quot;./nginx_proxy/certbot&quot;</span>
email=<span class="hljs-string">&quot;tim@mappingaction.org&quot;</span> <span class="hljs-comment"># Adding a valid address is strongly recommended</span>

<span class="hljs-comment"># Register AWS config</span>
<span class="hljs-keyword">if</span> [ -f <span class="hljs-variable">$deployment_config_file</span> ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">rm</span> <span class="hljs-variable">$deployment_config_file</span>
<span class="hljs-keyword">fi</span>

aws s3 <span class="hljs-built_in">cp</span> <span class="hljs-variable">$deployment_config_s3_path</span> <span class="hljs-variable">$deployment_config_file</span>

<span class="hljs-comment"># Assign variables according to deployment type (staging or production)</span>
<span class="hljs-keyword">if</span> [ <span class="hljs-string">&quot;<span class="hljs-variable">$DEPLOYMENT_GROUP_NAME</span>&quot;</span> == <span class="hljs-string">&quot;staging&quot;</span> ]; <span class="hljs-keyword">then</span>
    db_endpoint=$(jq -r <span class="hljs-string">&#x27;.Staging.Database.Endpoint&#x27;</span> <span class="hljs-variable">$deployment_config_file</span>)
    nginx_conf_path=<span class="hljs-string">&quot;./nginx_proxy/nginx_staging&quot;</span>
    domains=(mac-staging.website)
    staging=1 <span class="hljs-comment"># set to 1 for testing</span>

<span class="hljs-keyword">elif</span> [ <span class="hljs-string">&quot;<span class="hljs-variable">$DEPLOYMENT_GROUP_NAME</span>&quot;</span> == <span class="hljs-string">&quot;production&quot;</span> ]; <span class="hljs-keyword">then</span>
    db_endpoint=$(jq -r <span class="hljs-string">&#x27;.Production.Database.Endpoint&#x27;</span> <span class="hljs-variable">$deployment_config_file</span>)
    nginx_conf_path=<span class="hljs-string">&quot;./nginx_proxy/nginx_prod&quot;</span>
    domains=(evictorbook.com)
    staging=0 <span class="hljs-comment"># set 0 for production</span>
<span class="hljs-keyword">else</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Invalid value for DEPLOYMENT_GROUP_NAME&quot;</span>
    <span class="hljs-built_in">exit</span> 1
<span class="hljs-keyword">fi</span>

<span class="hljs-comment"># Environment vars used in docker-compose.prod.yml</span>
<span class="hljs-built_in">export</span> DB_ENDPOINT=<span class="hljs-variable">$db_endpoint</span>
<span class="hljs-built_in">export</span> NGINX_CONF_PATH=<span class="hljs-variable">$nginx_conf_path</span>

<span class="hljs-comment"># Get certbot params for setting up ssl/tls</span>
<span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">get_tls_parameters</span></span>() {
    <span class="hljs-keyword">if</span> [ ! -e <span class="hljs-string">&quot;<span class="hljs-variable">$certbot_data_path</span>/conf/options-ssl-nginx.conf&quot;</span> ] || [ ! -e <span class="hljs-string">&quot;<span class="hljs-variable">$certbot_data_path</span>/conf/ssl-dhparams.pem&quot;</span> ]; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;### Downloading recommended TLS parameters ...&quot;</span>
        <span class="hljs-built_in">mkdir</span> -p <span class="hljs-string">&quot;<span class="hljs-variable">$certbot_data_path</span>/conf&quot;</span>
        curl -s https://raw.githubusercontent.com/certbot/certbot/master/certbot-nginx/certbot_nginx/_internal/tls_configs/options-ssl-nginx.conf &gt;<span class="hljs-string">&quot;<span class="hljs-variable">$certbot_data_path</span>/conf/options-ssl-nginx.conf&quot;</span>
        curl -s https://raw.githubusercontent.com/certbot/certbot/master/certbot/certbot/ssl-dhparams.pem &gt;<span class="hljs-string">&quot;<span class="hljs-variable">$certbot_data_path</span>/conf/ssl-dhparams.pem&quot;</span>
        <span class="hljs-built_in">echo</span>
    <span class="hljs-keyword">fi</span>
}

<span class="hljs-comment"># Create a dummy ssl certificate required to start Nginx</span>
<span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">create_dummy_cert</span></span>() {
    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;### Creating dummy certificate for <span class="hljs-variable">$domains</span> ...&quot;</span>
    path=<span class="hljs-string">&quot;/etc/letsencrypt/live/<span class="hljs-variable">$domains</span>&quot;</span>
    <span class="hljs-built_in">mkdir</span> -p <span class="hljs-string">&quot;<span class="hljs-variable">$certbot_data_path</span>/conf/live/<span class="hljs-variable">$domains</span>&quot;</span>
    docker-compose -f docker-compose.yml -f docker-compose.prod.yml run --<span class="hljs-built_in">rm</span> --entrypoint <span class="hljs-string">&quot;\
  openssl req -x509 -nodes -newkey rsa:1024 -days 1\
    -keyout &#x27;<span class="hljs-variable">$path</span>/privkey.pem&#x27; \
    -out &#x27;<span class="hljs-variable">$path</span>/fullchain.pem&#x27; \
    -subj &#x27;/CN=localhost&#x27;&quot;</span> certbot
    <span class="hljs-built_in">echo</span>
}

<span class="hljs-comment"># Compose staging/prod environment with dummy certificate</span>
<span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">compose_prod_env</span></span>() {
    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;### Composing detached production environment ...&quot;</span>
    docker-compose -f docker-compose.yml -f docker-compose.prod.yml up -d
    <span class="hljs-built_in">echo</span>

    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;### Recreating nginx ...&quot;</span>
    docker-compose -f docker-compose.yml -f docker-compose.prod.yml up --force-recreate -d nginx
    <span class="hljs-built_in">echo</span>
}

<span class="hljs-comment"># Delete dummy cert after starting staging/prod environment</span>
<span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">delete_dummy_cert</span></span>() {
    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;### Deleting dummy certificate for <span class="hljs-variable">$domains</span> ...&quot;</span>
    docker-compose -f docker-compose.yml -f docker-compose.prod.yml run --<span class="hljs-built_in">rm</span> --entrypoint <span class="hljs-string">&quot;\
  rm -Rf /etc/letsencrypt/live/<span class="hljs-variable">$domains</span> &amp;&amp; \
  rm -Rf /etc/letsencrypt/archive/<span class="hljs-variable">$domains</span> &amp;&amp; \
  rm -Rf /etc/letsencrypt/renewal/<span class="hljs-variable">$domains</span>.conf&quot;</span> certbot
    <span class="hljs-built_in">echo</span>
}

<span class="hljs-comment"># Replace deleted dummy cert with a letsencrypt cert and reload Nginx</span>
<span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">get_letsencrypt_cert</span></span>() {

    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;### Requesting Let&#x27;s Encrypt certificate for <span class="hljs-variable">$domains</span> ...&quot;</span>
    <span class="hljs-comment">#Join $domains to -d args</span>
    domain_args=<span class="hljs-string">&quot;&quot;</span>
    <span class="hljs-keyword">for</span> domain <span class="hljs-keyword">in</span> <span class="hljs-string">&quot;<span class="hljs-variable">${domains[@]}</span>&quot;</span>; <span class="hljs-keyword">do</span>
        domain_args=<span class="hljs-string">&quot;<span class="hljs-variable">$domain_args</span> -d <span class="hljs-variable">$domain</span>&quot;</span>
    <span class="hljs-keyword">done</span>

    <span class="hljs-comment"># Select appropriate email arg</span>
    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;<span class="hljs-variable">$email</span>&quot;</span> <span class="hljs-keyword">in</span>
    <span class="hljs-string">&quot;&quot;</span>) email_arg=<span class="hljs-string">&quot;--register-unsafely-without-email&quot;</span> ;;
    *) email_arg=<span class="hljs-string">&quot;--email <span class="hljs-variable">$email</span>&quot;</span> ;;
    <span class="hljs-keyword">esac</span>

    <span class="hljs-comment"># Enable staging mode if needed</span>
    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$staging</span> != <span class="hljs-string">&quot;0&quot;</span> ]; <span class="hljs-keyword">then</span> staging_arg=<span class="hljs-string">&quot;--staging&quot;</span>; <span class="hljs-keyword">fi</span>

    docker-compose -f docker-compose.yml -f docker-compose.prod.yml run --<span class="hljs-built_in">rm</span> --entrypoint <span class="hljs-string">&quot;\
  certbot certonly --webroot -w /var/www/certbot \
    <span class="hljs-variable">$staging_arg</span> \
    <span class="hljs-variable">$email_arg</span> \
    <span class="hljs-variable">$domain_args</span> \
    --rsa-key-size <span class="hljs-variable">$rsa_key_size</span> \
    --agree-tos \
    --non-interactive \
    --force-renewal&quot;</span> certbot
    <span class="hljs-built_in">echo</span>

    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;### Reloading nginx ...&quot;</span>
    docker-compose -f docker-compose.yml -f docker-compose.prod.yml <span class="hljs-built_in">exec</span> -T nginx nginx -s reload
}

<span class="hljs-comment"># Run phase</span>
get_tls_parameters
create_dummy_cert
compose_prod_env
delete_dummy_cert
get_letsencrypt_cert
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="deploy_scriptsappstop.sh"><a href="#toc"><a name="deploy_scripts-app-stop-sh">deploy_scripts/app/stop.sh</a></a></h2>
<pre><code><span class="hljs-meta">#!/bin/bash</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Stop Container&quot;</span>
<span class="hljs-built_in">cd</span> /ebook
docker-compose -f docker-compose.yml -f docker-compose.prod.yml down --rmi <span class="hljs-string">&#x27;all&#x27;</span> --volumes
docker system prune --all --force --volumes
sudo <span class="hljs-built_in">rm</span> -rf nginx_proxy/certbot/
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="deploy_scriptsdbprepare.sh"><a href="#toc"><a name="deploy_scripts-db-prepare-sh">deploy_scripts/db/prepare.sh</a></a></h2>
<pre><code><span class="hljs-meta">#!/bin/sh</span>

apt-get install -y docker.io
<span class="hljs-comment"># Debian package heavily deprecated, as usual.</span>
curl -L https://github.com/docker/compose/releases/download/1.17.1/docker-compose-`<span class="hljs-built_in">uname</span> -s`-`<span class="hljs-built_in">uname</span> -m` -o /usr/local/bin/docker-compose
<span class="hljs-built_in">chmod</span> +x /usr/local/bin/docker-compose
gpasswd -a ubuntu docker
newgrp docker
<span class="hljs-built_in">chown</span> -R ubuntu:ubuntu /srv/arteria
<span class="hljs-built_in">yes</span> | sudo apt install jq
<span class="hljs-built_in">yes</span> | sudo apt install awscli</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="deploy_scriptsdbstart.sh"><a href="#toc"><a name="deploy_scripts-db-start-sh">deploy_scripts/db/start.sh</a></a></h2>
<pre><code><span class="hljs-comment">#!/bin/bash</span>

<span class="hljs-comment"># ApplicationStart – You typically use this deployment lifecycle event to restart services that were stopped during ApplicationStop.</span>
<span class="hljs-comment"># Let&#x27;s Encrypt staging environment details can be found here: https://letsencrypt.org/docs/staging-environment/</span>
<span class="hljs-string">echo</span> <span class="hljs-string">&quot;Start Container&quot;</span>
<span class="hljs-string">cd</span> /<span class="hljs-string">ebook</span>

<span class="hljs-comment"># pull down the access keys for the AEMP `CodeDeploy` IAM (needed to download the db dump)</span>
<span class="hljs-string">access_key_id</span>=$(<span class="hljs-string">aws</span> <span class="hljs-string">ssm</span> <span class="hljs-built_in">get-parameters</span> <span class="hljs-built_in">--region</span> <span class="hljs-string">us-west-1</span> <span class="hljs-built_in">--names</span> <span class="hljs-string">AEMP_CODE_DEPLOY_ACCESS_KEY_ID</span> <span class="hljs-built_in">--with-decryption</span> <span class="hljs-built_in">--query</span> <span class="hljs-string">Parameters</span>[<span class="hljs-string">0</span>].<span class="hljs-string">Value</span> | <span class="hljs-string">tr</span> -<span class="hljs-string">d</span> <span class="hljs-string">&#x27;&quot;&#x27;</span>)
<span class="hljs-string">secret_access_key</span>=$(<span class="hljs-string">aws</span> <span class="hljs-string">ssm</span> <span class="hljs-built_in">get-parameters</span> <span class="hljs-built_in">--region</span> <span class="hljs-string">us-west-1</span> <span class="hljs-built_in">--names</span> <span class="hljs-string">AEMP_CODE_DEPLOY_SECRET_ACCESS_KEY</span> <span class="hljs-built_in">--with-decryption</span> <span class="hljs-built_in">--query</span> <span class="hljs-string">Parameters</span>[<span class="hljs-string">0</span>].<span class="hljs-string">Value</span> | <span class="hljs-string">tr</span> -<span class="hljs-string">d</span> <span class="hljs-string">&#x27;&quot;&#x27;</span> )

<span class="hljs-comment"># now we can swap over to using env variables for the credentials (which will get passed to Docker config)</span>
<span class="hljs-string">export</span> <span class="hljs-string">AWS_ACCESS_KEY_ID</span>=$<span class="hljs-string">access_key_id</span>
<span class="hljs-string">export</span> <span class="hljs-string">AWS_SECRET_ACCESS_KEY</span>=$<span class="hljs-string">secret_access_key</span>

<span class="hljs-string">docker-compose</span> -<span class="hljs-string">f</span> <span class="hljs-string">docker-compose</span>.<span class="hljs-string">yml</span> -<span class="hljs-string">f</span> <span class="hljs-string">docker-compose</span>.<span class="hljs-string">db-only</span>.<span class="hljs-string">yml</span> <span class="hljs-string">up</span> -<span class="hljs-string">d</span></pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="deploy_scriptsdbstop.sh"><a href="#toc"><a name="deploy_scripts-db-stop-sh">deploy_scripts/db/stop.sh</a></a></h2>
<pre><code><span class="hljs-meta">#!/bin/bash</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Stop Container&quot;</span>
<span class="hljs-built_in">cd</span> /ebook

docker-compose down

<span class="hljs-comment"># kill all running containers</span>
docker <span class="hljs-built_in">kill</span> $(docker ps -q)

<span class="hljs-comment"># Delete every Docker containers</span>
<span class="hljs-comment"># Must be run first because images are attached to containers</span>
docker <span class="hljs-built_in">rm</span> -f $(docker ps -a -q)

<span class="hljs-comment"># Delete every Docker image</span>
docker rmi -f $(docker images -q)

docker system prune --all --force --volumes

<span class="hljs-comment"># remove all networks</span>
docker network prune -f
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="dev_scriptsupdate-ui-deps.sh"><a href="#toc"><a name="dev_scripts-update-ui-deps-sh">dev_scripts/update-ui-deps.sh</a></a></h2>
<pre><code><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-built_in">cd</span> <span class="hljs-string">&quot;<span class="hljs-variable">${0%/*}</span>&quot;</span>
<span class="hljs-built_in">export</span> PACKAGE_HASH=$(md5 -q ../ui/package.json)
<span class="hljs-built_in">export</span> PACKAGE_LOCK_HASH=$(md5 -q ../ui/package-lock.json)
<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Current package.json MD5 hash is <span class="hljs-variable">$PACKAGE_HASH</span>&quot;</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Current package-lock.json MD5 hash is <span class="hljs-variable">$PACKAGE_LOCK_HASH</span>&quot;</span>
<span class="hljs-built_in">export</span> CACHE_BUST=<span class="hljs-string">&quot;<span class="hljs-variable">$PACKAGE_HASH</span>:<span class="hljs-variable">$PACKAGE_LOCK_HASH</span>&quot;</span>
<span class="hljs-built_in">cd</span> ../ui/
docker-compose stop ui
docker-compose build --build-arg CACHE_BUST=<span class="hljs-variable">$CACHE_BUST</span> ui
docker-compose up -d ui
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="docker-compose.db-only.yml"><a href="#toc"><a name="docker-compose-db-only-yml">docker-compose.db-only.yml</a></a></h2>
<pre><code><span class="hljs-comment"># Used to host the DB alone, used for deploying the db on a separate server in staging and </span>
<span class="hljs-comment"># production environments.</span>

<span class="hljs-comment"># See /startup_scripts/neo4j-init.sh to see the version of the database loaded</span>

<span class="hljs-attribute">version</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;3.6&quot;</span>
<span class="hljs-attribute">services</span><span class="hljs-punctuation">:</span>
  <span class="hljs-attribute">neo4j</span><span class="hljs-punctuation">:</span>
      <span class="hljs-attribute">container_name</span><span class="hljs-punctuation">:</span> <span class="hljs-string">neo4j_db</span>
      <span class="hljs-attribute">working_dir</span><span class="hljs-punctuation">:</span> <span class="hljs-string">/neo4j</span>
      <span class="hljs-attribute">image</span><span class="hljs-punctuation">:</span> <span class="hljs-string">neo4j:4.2.2</span>
      <span class="hljs-attribute">restart</span><span class="hljs-punctuation">:</span> <span class="hljs-string">unless-stopped</span>
      <span class="hljs-attribute">ports</span><span class="hljs-punctuation">:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;7474:7474&quot;</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;7473:7473&quot;</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;7687:7687&quot;</span>
      <span class="hljs-attribute">volumes</span><span class="hljs-punctuation">:</span> <span class="hljs-string"># don&#x27;t mount /data or /logs https://github.com/neo4j/docker-neo4j/issues/131</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">./startup_scripts:/startup_scripts</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">./neo4j_data:/var/lib/neo4j/data</span>
      <span class="hljs-attribute">environment</span><span class="hljs-punctuation">:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">EXTENSION_SCRIPT=/startup_scripts/neo4j-init.sh</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">NEO4JLABS_PLUGINS=[&quot;apoc&quot;, &quot;graph-data-science&quot;]</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">NEO4J_dbms_security_procedures_unrestricted=apoc.*,gds.*</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">NEO4J_AUTH=neo4j/admin</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}</span></pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="docker-compose.local-nodb.yaml"><a href="#toc"><a name="docker-compose-local-nodb-yaml">docker-compose.local-nodb.yaml</a></a></h2>
<pre><code><span class="hljs-comment"># docker-compose.local-nodb.yml</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># docker config for local environments where there&#x27;s already a neo4j container</span>
<span class="hljs-comment"># running at ${DB_ENDPOINT}. does *not* attempt to start another neo4j</span>
<span class="hljs-comment"># container.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># this allows for rapid development and testing of the node express backend</span>
<span class="hljs-comment"># server, without ever having to tear down or re-up the neo4j database server.</span>
<span class="hljs-attribute">version</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;3.6&quot;</span>
<span class="hljs-attribute">services</span><span class="hljs-punctuation">:</span>
  <span class="hljs-attribute">api</span><span class="hljs-punctuation">:</span>
    <span class="hljs-attribute">environment</span><span class="hljs-punctuation">:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">NEO4J_URI=bolt://${DB_ENDPOINT:-neo4j}:7687</span>
      <span class="hljs-comment"># optional flag to enable a second neo4j URI for testing (useful for transitions between API versions)</span>
      <span class="hljs-comment"># - NEO4J_TEST_URI=neo4j://${DB_ENDPOINT:-neo4j}:7687</span>
      <span class="hljs-comment"># debugging flags...</span>
      <span class="hljs-comment"># disable server memory-cache for testing:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">EBOOK_API_DISABLE_CACHE=true</span>
      <span class="hljs-comment"># page size for /api/neighborhood:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">EBOOK_API_NEIGHBORHOOD_MAX_PAGE_SIZE=100   # default:100</span>
      <span class="hljs-comment"># flags that impact the structure of api respones, use with care:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">EBOOK_API_WRAP_NEIGHBORHOOD_EVICTIONS=false     # default:false</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">EBOOK_API_WRITE_PROTO_MULTIMAPS=false           # default:false</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">EBOOK_API_WRITE_JSON_SUBGRAPH_PROPERTIES=false  # default:false</span>
      <span class="hljs-comment"># experimental features:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">EBOOK_API_ENABLE_UNIFIED_SEARCH=true</span>

    <span class="hljs-attribute">command</span><span class="hljs-punctuation">:</span> <span class="hljs-string">./startup_scripts/wait-for-it.sh ${DB_ENDPOINT}:7687 -t 180 -- node -r esm index.js</span>

  <span class="hljs-attribute">ui</span><span class="hljs-punctuation">:</span>
    <span class="hljs-attribute">image</span><span class="hljs-punctuation">:</span> <span class="hljs-string">ui-dev</span>
    <span class="hljs-attribute">container_name</span><span class="hljs-punctuation">:</span> <span class="hljs-string">ui-dev</span>
    <span class="hljs-attribute">build</span><span class="hljs-punctuation">:</span>
      <span class="hljs-attribute">context</span><span class="hljs-punctuation">:</span> <span class="hljs-string">./ui</span>
      <span class="hljs-attribute">dockerfile</span><span class="hljs-punctuation">:</span> <span class="hljs-string">Dockerfile.dev</span>
    <span class="hljs-attribute">restart</span><span class="hljs-punctuation">:</span> <span class="hljs-string">unless-stopped</span>
    <span class="hljs-attribute">volumes</span><span class="hljs-punctuation">:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./ui:/home/node/app</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">ui_node_modules:/home/node/app/node_modules</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./startup_scripts:/home/node/app/startup_scripts</span>
    <span class="hljs-attribute">ports</span><span class="hljs-punctuation">:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;3000:3000&quot;</span>
    <span class="hljs-attribute">command</span><span class="hljs-punctuation">:</span> <span class="hljs-string">./startup_scripts/wait-for-it.sh ${DB_ENDPOINT}:7687 -t 180 -- npm start</span>
    <span class="hljs-attribute">depends_on</span><span class="hljs-punctuation">:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">api</span>
    <span class="hljs-attribute">tty</span><span class="hljs-punctuation">:</span> <span class="hljs-string">true</span>
    <span class="hljs-attribute">stdin_open</span><span class="hljs-punctuation">:</span> <span class="hljs-string">true</span>
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="docker-compose.override.yml"><a href="#toc"><a name="docker-compose-override-yml">docker-compose.override.yml</a></a></h2>
<pre><code><span class="hljs-comment">#docker-compose.override.yml</span>
<span class="hljs-attribute">version</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;3.6&quot;</span>
<span class="hljs-attribute">services</span><span class="hljs-punctuation">:</span>
  <span class="hljs-attribute">api</span><span class="hljs-punctuation">:</span>
    <span class="hljs-attribute">depends_on</span><span class="hljs-punctuation">:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">neo4j</span>
    <span class="hljs-attribute">environment</span><span class="hljs-punctuation">:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">NEO4J_URI=neo4j://neo4j:7687</span>
      <span class="hljs-comment"># optional flag to enable a second neo4j URI for testing (useful for transitions between API versions)</span>
      <span class="hljs-comment"># - NEO4J_URI_TEST=neo4j://${DB_ENDPOINT_TEST}:7687</span>
      <span class="hljs-comment"># debugging flags...</span>
      <span class="hljs-comment"># server memory-cache control, set &#x27;true&#x27; for testing:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">EBOOK_API_DISABLE_CACHE=false # default:false</span>
      <span class="hljs-comment"># page size for /api/neighborhood:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">EBOOK_API_NEIGHBORHOOD_MAX_PAGE_SIZE=100 # default:100</span>
      <span class="hljs-comment"># flags that impact the structure of REST respones, use with care:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">EBOOK_API_WRAP_NEIGHBORHOOD_EVICTIONS=false # default:false</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">EBOOK_API_WRITE_PROTO_MULTIMAPS=false # default:false</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">EBOOK_API_WRITE_JSON_SUBGRAPH_PROPERTIES=false # default:false</span>
      <span class="hljs-comment"># experimental features:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">EBOOK_API_ENABLE_UNIFIED_SEARCH=true</span>
    <span class="hljs-attribute">command</span><span class="hljs-punctuation">:</span> <span class="hljs-string">./startup_scripts/wait-for-it.sh ${DB_ENDPOINT:-neo4j}:7687 -t 180 -- node -r esm index.js</span>

  <span class="hljs-attribute">ui</span><span class="hljs-punctuation">:</span>
    <span class="hljs-attribute">image</span><span class="hljs-punctuation">:</span> <span class="hljs-string">ui</span>
    <span class="hljs-attribute">container_name</span><span class="hljs-punctuation">:</span> <span class="hljs-string">ui</span>
    <span class="hljs-attribute">build</span><span class="hljs-punctuation">:</span>
      <span class="hljs-attribute">context</span><span class="hljs-punctuation">:</span> <span class="hljs-string">./ui</span>
      <span class="hljs-attribute">dockerfile</span><span class="hljs-punctuation">:</span> <span class="hljs-string">Dockerfile.dev</span>
    <span class="hljs-attribute">restart</span><span class="hljs-punctuation">:</span> <span class="hljs-string">unless-stopped</span>
    <span class="hljs-attribute">volumes</span><span class="hljs-punctuation">:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./ui:/home/node/app</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">ui_node_modules:/home/node/app/node_modules</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./startup_scripts:/home/node/app/startup_scripts</span>
    <span class="hljs-attribute">ports</span><span class="hljs-punctuation">:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;3000:3000&quot;</span>
    <span class="hljs-attribute">command</span><span class="hljs-punctuation">:</span> <span class="hljs-string">./startup_scripts/wait-for-it.sh ${DB_ENDPOINT:-neo4j}:7687 -t 180 -- npm start</span>
    <span class="hljs-attribute">depends_on</span><span class="hljs-punctuation">:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">api</span>
    <span class="hljs-attribute">tty</span><span class="hljs-punctuation">:</span> <span class="hljs-string">true</span>
    <span class="hljs-attribute">stdin_open</span><span class="hljs-punctuation">:</span> <span class="hljs-string">true</span>

  <span class="hljs-attribute">neo4j</span><span class="hljs-punctuation">:</span>
    <span class="hljs-attribute">container_name</span><span class="hljs-punctuation">:</span> <span class="hljs-string">neo4j_dev_db</span>
    <span class="hljs-attribute">working_dir</span><span class="hljs-punctuation">:</span> <span class="hljs-string">/neo4j</span>
    <span class="hljs-attribute">image</span><span class="hljs-punctuation">:</span> <span class="hljs-string">neo4j:4.2.2</span>
    <span class="hljs-attribute">restart</span><span class="hljs-punctuation">:</span> <span class="hljs-string">unless-stopped</span>
    <span class="hljs-attribute">ports</span><span class="hljs-punctuation">:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;7474:7474&quot;</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;7473:7473&quot;</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;7687:7687&quot;</span>
    <span class="hljs-attribute">volumes</span><span class="hljs-punctuation">:</span> <span class="hljs-string"># don&#x27;t mount /data or /logs https://github.com/neo4j/docker-neo4j/issues/131</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./startup_scripts:/startup_scripts</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./neo4j_data:/var/lib/neo4j/data</span>
    <span class="hljs-attribute">environment</span><span class="hljs-punctuation">:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">EXTENSION_SCRIPT=/startup_scripts/neo4j-init.sh</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">NEO4JLABS_PLUGINS=[&quot;apoc&quot;, &quot;graph-data-science&quot;]</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">NEO4J_dbms_security_procedures_unrestricted=apoc.*,gds.*</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">NEO4J_AUTH=neo4j/admin</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}</span>
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="docker-compose.prod.yml"><a href="#toc"><a name="docker-compose-prod-yml">docker-compose.prod.yml</a></a></h2>
<pre><code><span class="hljs-comment">#docker-compose.prod.yml</span>
version: <span class="hljs-string">&quot;3.6&quot;</span>
services:
  nginx:
    image: nginx:<span class="hljs-number">1.18</span>-alpine
    container_name: nginx
    restart: unless-stopped
    volumes:
      - <span class="hljs-variable">${NGINX_CONF_PATH}</span>:<span class="hljs-regexp">/etc/</span>nginx/conf.d
      - .<span class="hljs-regexp">/nginx_proxy/</span>certbot<span class="hljs-regexp">/conf:/</span>etc/letsencrypt
      - .<span class="hljs-regexp">/nginx_proxy/</span>certbot<span class="hljs-regexp">/www:/</span>var<span class="hljs-regexp">/www/</span>certbot
    ports:
      - <span class="hljs-string">&quot;80:80&quot;</span>
      - <span class="hljs-string">&quot;443:443&quot;</span>
    command: <span class="hljs-string">&#x27;/bin/sh -c &#x27;</span><span class="hljs-string">&#x27;while :; do sleep 6h &amp; wait $${!}; nginx -s reload; done &amp; nginx -g &quot;daemon off;&quot;&#x27;</span><span class="hljs-string">&#x27;&#x27;</span>

  certbot:
    image: certbot/certbot
    container_name: certbot
    restart: unless-stopped
    volumes:
      - .<span class="hljs-regexp">/nginx_proxy/</span>certbot<span class="hljs-regexp">/conf:/</span>etc/letsencrypt
      - .<span class="hljs-regexp">/nginx_proxy/</span>certbot<span class="hljs-regexp">/www:/</span>var<span class="hljs-regexp">/www/</span>certbot
    entrypoint: <span class="hljs-string">&quot;/bin/sh -c &#x27;trap exit TERM; while :; do certbot renew; sleep 12h &amp; wait $${!}; done;&#x27;&quot;</span>

  api:
    environment:
      - NEO4J_URI=bolt:<span class="hljs-regexp">//</span><span class="hljs-variable">${DB_ENDPOINT}</span>:<span class="hljs-number">7687</span>
      <span class="hljs-comment"># optional flag to enable a second neo4j URI for testing (useful for transitions between API versions)</span>
      <span class="hljs-comment"># - NEO4J_URI_TEST=neo4j://${DB_ENDPOINT_TEST}:7687</span>
      <span class="hljs-comment"># debug flags to control optional features...</span>
      - EBOOK_API_ENABLE_UNIFIED_SEARCH=true
    command: .<span class="hljs-regexp">/startup_scripts/</span>wait-<span class="hljs-keyword">for</span>-it.sh <span class="hljs-variable">${DB_ENDPOINT}</span>:<span class="hljs-number">7687</span> -t <span class="hljs-number">30</span> -- node -r esm index.js

  ui:
    image: ui
    container_name: ui
    build:
      context: .<span class="hljs-regexp">/ui/</span>
      dockerfile: Dockerfile
    restart: unless-stopped
    volumes:
      - .<span class="hljs-regexp">/ui:/</span>home<span class="hljs-regexp">/node/</span>app
      - ui_node_modules:<span class="hljs-regexp">/home/</span>node<span class="hljs-regexp">/app/</span>node_modules <span class="hljs-comment">#weird</span>
      - .<span class="hljs-regexp">/ui_log:/</span>home<span class="hljs-regexp">/node/</span>.npm/_logs
    ports:
      - <span class="hljs-string">&quot;3000:3000&quot;</span>
    depends_on:
      - api
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="docker-compose.yml"><a href="#toc"><a name="docker-compose-yml">docker-compose.yml</a></a></h2>
<pre><code><span class="hljs-attribute">version</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;3.6&quot;</span>
<span class="hljs-attribute">services</span><span class="hljs-punctuation">:</span>
  <span class="hljs-attribute">api</span><span class="hljs-punctuation">:</span>
    <span class="hljs-attribute">image</span><span class="hljs-punctuation">:</span> <span class="hljs-string">api</span>
    <span class="hljs-attribute">container_name</span><span class="hljs-punctuation">:</span> <span class="hljs-string">api</span>
    <span class="hljs-attribute">build</span><span class="hljs-punctuation">:</span>
      <span class="hljs-attribute">context</span><span class="hljs-punctuation">:</span> <span class="hljs-string">./server</span>
      <span class="hljs-attribute">dockerfile</span><span class="hljs-punctuation">:</span> <span class="hljs-string">Dockerfile</span>
    <span class="hljs-attribute">restart</span><span class="hljs-punctuation">:</span> <span class="hljs-string">unless-stopped</span>
    <span class="hljs-attribute">ports</span><span class="hljs-punctuation">:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;4000:4000&quot;</span>
    <span class="hljs-attribute">environment</span><span class="hljs-punctuation">:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">NEO4J_USER=neo4j</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">NEO4J_PASSWORD=admin</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">REST_PORT=4000</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">DEV_SERVER=TRUE</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">UI_USERNAME=user</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">UI_PASSWORD=sftool</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">UI_TEMP_PASSWORD=temppass123</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">COOKIE_KEY=dsafs45adflk*37&amp;^867KLHHJG</span>
    <span class="hljs-attribute">volumes</span><span class="hljs-punctuation">:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./server:/home/node/app</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">api_node_modules:/home/node/app/node_modules</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./startup_scripts:/home/node/app/startup_scripts</span>

<span class="hljs-attribute">volumes</span><span class="hljs-punctuation">:</span>
  <span class="hljs-attribute">api_node_modules</span><span class="hljs-punctuation">:</span>
  <span class="hljs-attribute">ui_node_modules</span><span class="hljs-punctuation">:
</span></pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="nginx_proxynginx_prodprod.conf"><a href="#toc"><a name="nginx_proxy-nginx_prod-prod-conf">nginx_proxy/nginx_prod/prod.conf</a></a></h2>
<pre><code><span class="hljs-section">upstream</span> ui {
    <span class="hljs-attribute">server</span> ui:<span class="hljs-number">3000</span>;
}

<span class="hljs-section">upstream</span> api {
    <span class="hljs-attribute">server</span> api:<span class="hljs-number">4000</span>;
}

<span class="hljs-section">server</span> {
    <span class="hljs-attribute">listen</span> <span class="hljs-number">80</span>;
    <span class="hljs-attribute">server_name</span> evictorbook.com;
    <span class="hljs-attribute">server_tokens</span> <span class="hljs-literal">off</span>;

    <span class="hljs-section">location</span> /.well-known/acme-challenge/ {
        <span class="hljs-attribute">root</span> /var/www/certbot;
    }

    <span class="hljs-section">location</span> / {
        <span class="hljs-attribute">return</span> <span class="hljs-number">301</span> https://<span class="hljs-variable">$host</span><span class="hljs-variable">$request_uri</span>;
    }
}

<span class="hljs-section">server</span> {

    <span class="hljs-attribute">listen</span> <span class="hljs-number">443</span> ssl;
    <span class="hljs-attribute">server_name</span> evictorbook.com;
    <span class="hljs-attribute">server_tokens</span> <span class="hljs-literal">off</span>;

    <span class="hljs-attribute">ssl_certificate</span> /etc/letsencrypt/live/evictorbook.com/fullchain.pem;
    <span class="hljs-attribute">ssl_certificate_key</span> /etc/letsencrypt/live/evictorbook.com/privkey.pem;
    <span class="hljs-attribute">include</span> /etc/letsencrypt/options-ssl-nginx.conf;
    <span class="hljs-attribute">ssl_dhparam</span> /etc/letsencrypt/ssl-dhparams.pem;

    <span class="hljs-section">location</span> / {
        <span class="hljs-attribute">proxy_pass</span> http://ui;
        <span class="hljs-attribute">proxy_set_header</span> Host <span class="hljs-variable">$http_host</span>;
        <span class="hljs-attribute">proxy_set_header</span> X-Real-IP <span class="hljs-variable">$remote_addr</span>;
        <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-For <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;
    }

    <span class="hljs-section">location</span> /api {
        <span class="hljs-attribute">proxy_pass</span> http://api;
    }

    <span class="hljs-section">location</span> /session {
        <span class="hljs-attribute">proxy_pass</span> http://api;
    }

    <span class="hljs-section">location</span> /sockjs-node {
        <span class="hljs-attribute">proxy_pass</span> http://ui;
        <span class="hljs-attribute">proxy_http_version</span> <span class="hljs-number">1</span>.<span class="hljs-number">1</span>;
        <span class="hljs-attribute">proxy_set_header</span> Upgrade <span class="hljs-variable">$http_upgrade</span>;
        <span class="hljs-attribute">proxy_set_header</span> Connection <span class="hljs-string">&quot;Upgrade&quot;</span>;
    }
}</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="nginx_proxynginx_stagingstaging.conf"><a href="#toc"><a name="nginx_proxy-nginx_staging-staging-conf">nginx_proxy/nginx_staging/staging.conf</a></a></h2>
<pre><code><span class="hljs-section">upstream</span> ui {
    <span class="hljs-attribute">server</span> ui:<span class="hljs-number">3000</span>;
}

<span class="hljs-section">upstream</span> api {
    <span class="hljs-attribute">server</span> api:<span class="hljs-number">4000</span>;
}

<span class="hljs-section">server</span> {
    <span class="hljs-attribute">listen</span> <span class="hljs-number">80</span>;
    <span class="hljs-attribute">server_name</span> mac-staging.website;
    <span class="hljs-attribute">server_tokens</span> <span class="hljs-literal">off</span>;

    <span class="hljs-section">location</span> /.well-known/acme-challenge/ {
        <span class="hljs-attribute">root</span> /var/www/certbot;
    }

    <span class="hljs-section">location</span> / {
        <span class="hljs-attribute">return</span> <span class="hljs-number">301</span> https://<span class="hljs-variable">$host</span><span class="hljs-variable">$request_uri</span>;
    }
}

<span class="hljs-section">server</span> {

    <span class="hljs-attribute">listen</span> <span class="hljs-number">443</span> ssl;
    <span class="hljs-attribute">server_name</span> mac-staging.website;
    <span class="hljs-attribute">server_tokens</span> <span class="hljs-literal">off</span>;

    <span class="hljs-attribute">ssl_certificate</span> /etc/letsencrypt/live/mac-staging.website/fullchain.pem;
    <span class="hljs-attribute">ssl_certificate_key</span> /etc/letsencrypt/live/mac-staging.website/privkey.pem;
    <span class="hljs-attribute">include</span> /etc/letsencrypt/options-ssl-nginx.conf;
    <span class="hljs-attribute">ssl_dhparam</span> /etc/letsencrypt/ssl-dhparams.pem;

    <span class="hljs-section">location</span> / {
        <span class="hljs-attribute">proxy_pass</span> http://ui;
        <span class="hljs-attribute">proxy_set_header</span> Host <span class="hljs-variable">$http_host</span>;
        <span class="hljs-attribute">proxy_set_header</span> X-Real-IP <span class="hljs-variable">$remote_addr</span>;
        <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-For <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;
    }

    <span class="hljs-section">location</span> /api {
        <span class="hljs-attribute">proxy_pass</span> http://api;
    }

    <span class="hljs-section">location</span> /session {
        <span class="hljs-attribute">proxy_pass</span> http://api;
    }

    <span class="hljs-section">location</span> /sockjs-node {
        <span class="hljs-attribute">proxy_pass</span> http://ui;
        <span class="hljs-attribute">proxy_http_version</span> <span class="hljs-number">1</span>.<span class="hljs-number">1</span>;
        <span class="hljs-attribute">proxy_set_header</span> Upgrade <span class="hljs-variable">$http_upgrade</span>;
        <span class="hljs-attribute">proxy_set_header</span> Connection <span class="hljs-string">&quot;Upgrade&quot;</span>;
    }
}</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="package.json"><a href="#toc"><a name="package-json">package.json</a></a></h2>
<pre><code><span class="hljs-template-variable">{}</span><span class="language-xml">
</span></pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="server.dockerignore"><a href="#toc"><a name="server--dockerignore">server/.dockerignore</a></a></h2>
<pre><code>node_modules
npm-<span class="hljs-built_in">debug</span>.<span class="hljs-built_in">log</span>
Dockerfile
.dockerignore</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverdockerfile"><a href="#toc"><a name="server-dockerfile">server/Dockerfile</a></a></h2>
<pre><code>FROM <span class="hljs-keyword">node</span><span class="hljs-title">:12</span>.<span class="hljs-number">1.0</span>

RUN mkdir -p /home/<span class="hljs-keyword">node</span><span class="hljs-title">/app</span>/node_modules &amp;&amp; chown -R <span class="hljs-keyword">node</span><span class="hljs-title">:node</span> /home/<span class="hljs-keyword">node</span><span class="hljs-title">/app</span>

WORKDIR /home/<span class="hljs-keyword">node</span><span class="hljs-title">/app</span>

<span class="hljs-comment"># A wildcard is used to ensure both package.json AND package-lock.json are copied</span>
COPY package*.json ./

<span class="hljs-keyword">USER</span> <span class="hljs-title">node</span>

<span class="hljs-comment"># expose the server port</span>
EXPOSE <span class="hljs-number">4000</span>

<span class="hljs-comment">## install only the packages defined in the package-lock.json (faster than the normal npm install)</span>
RUN npm install</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverbackendsneo4jbackend.js"><a href="#toc"><a name="server-backends-neo4jbackend-js">server/backends/neo4jBackend.js</a></a></h2>
<pre><code><span class="hljs-comment">// neo4jBackend.js</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// wrapper for the neo4j-driver module. this module returns a function which,</span>
<span class="hljs-comment">// when called, instantiates a neo4j driver object with the passed-in config.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// this allows the api server to maintain connections to multiple different</span>
<span class="hljs-comment">// neo4j database servers.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// avoid redundant calls to this function. since it creates a new driver object</span>
<span class="hljs-comment">// each time it&#x27;s called, only call it during app setup and only once per</span>
<span class="hljs-comment">// target database.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// usage: </span>
<span class="hljs-comment">//   create a driver obj with default options:</span>
<span class="hljs-comment">//     const db-driver = neo4jBackend();</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">//   create a driver object with custom options:</span>
<span class="hljs-comment">//     const db-driver-test = neo4jBackend({ use_test_endpoint: true });</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// see below for a description of the supported properties in &#x27;options&#x27;.</span>

import neo4j from &#x27;neo4j-driver&#x27;;
import flagUtils from &#x27;../framework/flagUtils&#x27;;

<span class="hljs-comment">// define flags...</span>
const flags = {};

<span class="hljs-comment">// note: as of v2 database, uses neo4j version 4, and should be addressed with the</span>
<span class="hljs-comment">// &#x27;neo4j://&#x27; uri scheme.</span>
flagUtils.define<span class="hljs-constructor">StringEnvFlag(<span class="hljs-params">flags</span>, &#x27;<span class="hljs-params">neo4j_uri</span>&#x27;, <span class="hljs-params">process</span>.<span class="hljs-params">env</span>.NEO4J_URI, &#x27;<span class="hljs-params">neo4j</span>:<span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-params">localhost</span>:7687&#x27;)</span>;

flagUtils.define<span class="hljs-constructor">StringEnvFlag(<span class="hljs-params">flags</span>, &#x27;<span class="hljs-params">neo4j_uri_test</span>&#x27;, <span class="hljs-params">process</span>.<span class="hljs-params">env</span>.NEO4J_URI_TEST, &#x27;<span class="hljs-params">neo4j</span>:<span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-params">neo4j</span>:7687&#x27;)</span>;
flagUtils.define<span class="hljs-constructor">StringEnvFlag(<span class="hljs-params">flags</span>, &#x27;<span class="hljs-params">neo4j_user</span>&#x27;, <span class="hljs-params">process</span>.<span class="hljs-params">env</span>.NEO4J_USER)</span>;
flagUtils.define<span class="hljs-constructor">StringEnvFlag(<span class="hljs-params">flags</span>, &#x27;<span class="hljs-params">neo4j_password</span>&#x27;, <span class="hljs-params">process</span>.<span class="hljs-params">env</span>.NEO4J_PASSWORD)</span>;

<span class="hljs-comment">// main exported function.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// if supplied, &#x27;options&#x27; param is an object that supports the following</span>
<span class="hljs-comment">// properties: </span>
<span class="hljs-comment">//   {</span>
<span class="hljs-comment">//     // if set true, use &#x27;neo4j_uri_test&#x27; from flags. if unset or false, use</span>
<span class="hljs-comment">//     // the &#x27;neo4j_uri&#x27; flag instead.</span>
<span class="hljs-comment">//     use_test_endpoint: &lt;boolean&gt;</span>
<span class="hljs-comment">//   }</span>
const neo4jBackend = <span class="hljs-keyword">function</span>(options = {}) {
  <span class="hljs-keyword">let</span> neo4jUri = ( options.use_test_endpoint
                   ? flags.neo4j_uri_test
                   : flags.neo4j_uri );

  <span class="hljs-comment">// via db-driver.js:</span>
  const driver = neo4j.driver(
    neo4jUri,
    neo4j.auth.basic(
      flags.neo4j_user,
      flags.neo4j_password),
    { disableLosslessIntegers: <span class="hljs-literal">true</span> });

  return driver;
}

export default neo4jBackend;
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverconfigdataneighborhoods.js"><a href="#toc"><a name="server-configdata-neighborhoods-js">server/configData/neighborhoods.js</a></a></h2>
<pre><code><span class="hljs-keyword">const</span> neighborhoods = [
  {
    <span class="hljs-attribute">id:</span><span class="hljs-string"> 1,
    display_name</span>: <span class="hljs-string">&#x27;Bayview&#x27;</span>,
    <span class="hljs-attribute">canonical_name</span>: <span class="hljs-string">&#x27;BAYVIEW&#x27;</span>,
    <span class="hljs-attribute">canonical_name_safe</span>: <span class="hljs-string">&#x27;BAYVIEW&#x27;</span>
  },
  {
    <span class="hljs-attribute">id:</span><span class="hljs-string"> 2,
    display_name</span>: <span class="hljs-string">&#x27;Bernal Heights&#x27;</span>,
    <span class="hljs-attribute">canonical_name</span>: <span class="hljs-string">&#x27;BERNAL HEIGHTS&#x27;</span>,
    <span class="hljs-attribute">canonical_name_safe</span>: <span class="hljs-string">&#x27;BERNAL%20HEIGHTS&#x27;</span>
  },
  {
    <span class="hljs-attribute">id:</span><span class="hljs-string"> 3,
    display_name</span>: <span class="hljs-string">&#x27;Castro/Upper Market&#x27;</span>,
    <span class="hljs-attribute">canonical_name</span>: <span class="hljs-string">&#x27;CASTRO/UPPER MARKET&#x27;</span>,
    <span class="hljs-attribute">canonical_name_safe</span>: <span class="hljs-string">&#x27;CASTRO%2FUPPER%20MARKET&#x27;</span>
  },
  {
    <span class="hljs-attribute">id:</span><span class="hljs-string"> 4,
    display_name</span>: <span class="hljs-string">&#x27;Chinatown&#x27;</span>,
    <span class="hljs-attribute">canonical_name</span>: <span class="hljs-string">&#x27;CHINATOWN&#x27;</span>,
    <span class="hljs-attribute">canonical_name_safe</span>: <span class="hljs-string">&#x27;CHINATOWN&#x27;</span>
  },
  {
    <span class="hljs-attribute">id:</span><span class="hljs-string"> 5,
    display_name</span>: <span class="hljs-string">&#x27;Crocker Amazon&#x27;</span>,
    <span class="hljs-attribute">canonical_name</span>: <span class="hljs-string">&#x27;CROCKER AMAZON&#x27;</span>,
    <span class="hljs-attribute">canonical_name_safe</span>: <span class="hljs-string">&#x27;CROCKER%20AMAZON&#x27;</span>
  },
  {
    <span class="hljs-attribute">id:</span><span class="hljs-string"> 6,
    display_name</span>: <span class="hljs-string">&#x27;Downtown/Civic Center&#x27;</span>,
    <span class="hljs-attribute">canonical_name</span>: <span class="hljs-string">&#x27;DOWNTOWN/CIVIC CENTER&#x27;</span>,
    <span class="hljs-attribute">canonical_name_safe</span>: <span class="hljs-string">&#x27;DOWNTOWN%2FCIVIC%20CENTER&#x27;</span>
  },
  {
    <span class="hljs-attribute">id:</span><span class="hljs-string"> 7,
    display_name</span>: <span class="hljs-string">&#x27;Diamond Heights&#x27;</span>,
    <span class="hljs-attribute">canonical_name</span>: <span class="hljs-string">&#x27;DIAMOND HEIGHTS&#x27;</span>,
    <span class="hljs-attribute">canonical_name_safe</span>: <span class="hljs-string">&#x27;DIAMOND%20HEIGHTS&#x27;</span>,

  },
  {
    <span class="hljs-attribute">id:</span><span class="hljs-string"> 8,
    display_name</span>: <span class="hljs-string">&#x27;Excelsior&#x27;</span>,
    <span class="hljs-attribute">canonical_name</span>: <span class="hljs-string">&#x27;EXCELSIOR&#x27;</span>,
    <span class="hljs-attribute">canonical_name_safe</span>: <span class="hljs-string">&#x27;EXCELSIOR&#x27;</span>
  },
  {
    <span class="hljs-attribute">id:</span><span class="hljs-string"> 8,
    display_name</span>: <span class="hljs-string">&#x27;Financial District&#x27;</span>,
    <span class="hljs-attribute">canonical_name</span>: <span class="hljs-string">&#x27;FINANCIAL DISTRICT&#x27;</span>,
    <span class="hljs-attribute">canonical_name_safe</span>: <span class="hljs-string">&#x27;FINANCIAL%20DISTRICT&#x27;</span>
  },
  {
    <span class="hljs-attribute">id:</span><span class="hljs-string"> 10,
    display_name</span>: <span class="hljs-string">&#x27;Glen Park&#x27;</span>,
    <span class="hljs-attribute">canonical_name</span>: <span class="hljs-string">&#x27;GLEN PARK&#x27;</span>,
    <span class="hljs-attribute">canonical_name_safe</span>: <span class="hljs-string">&#x27;GLEN%20PARK&#x27;</span>,
  },
  {
    <span class="hljs-attribute">id:</span><span class="hljs-string"> 11,
    display_name</span>: <span class="hljs-string">&#x27;Golden Gate Park&#x27;</span>,
    <span class="hljs-attribute">canonical_name</span>: <span class="hljs-string">&#x27;GOLDEN GATE PARK&#x27;</span>,
    <span class="hljs-attribute">canonical_name_safe</span>: <span class="hljs-string">&#x27;GOLDEN%20GATE%20PARK&#x27;</span>
  },
  {
    <span class="hljs-attribute">id:</span><span class="hljs-string"> 12,
    display_name</span>: <span class="hljs-string">&#x27;Haight Ashbury&#x27;</span>,
    <span class="hljs-attribute">canonical_name</span>: <span class="hljs-string">&#x27;HAIGHT ASHBURY&#x27;</span>,
    <span class="hljs-attribute">canonical_name_safe</span>: <span class="hljs-string">&#x27;HAIGHT%20ASHBURY&#x27;</span>
  },
  {
    <span class="hljs-attribute">id:</span><span class="hljs-string"> 13,
    display_name</span>: <span class="hljs-string">&#x27;Inner Richmond&#x27;</span>,
    <span class="hljs-attribute">canonical_name</span>: <span class="hljs-string">&#x27;INNER RICHMOND&#x27;</span>,
    <span class="hljs-attribute">canonical_name_safe</span>: <span class="hljs-string">&#x27;INNER%20RICHMOND&#x27;</span>
  },
  {
    <span class="hljs-attribute">id:</span><span class="hljs-string"> 14,
    display_name</span>: <span class="hljs-string">&#x27;Inner Sunset&#x27;</span>,
    <span class="hljs-attribute">canonical_name</span>: <span class="hljs-string">&#x27;INNER SUNSET&#x27;</span>,
    <span class="hljs-attribute">canonical_name_safe</span>: <span class="hljs-string">&#x27;INNER%20SUNSET&#x27;</span>
  },
  {
    <span class="hljs-attribute">id:</span><span class="hljs-string"> 15,
    display_name</span>: <span class="hljs-string">&#x27;Lakeshore&#x27;</span>,
    <span class="hljs-attribute">canonical_name</span>: <span class="hljs-string">&#x27;LAKESHORE&#x27;</span>,
    <span class="hljs-attribute">canonical_name_safe</span>: <span class="hljs-string">&#x27;LAKESHORE&#x27;</span>
  },
  {
    <span class="hljs-attribute">id:</span><span class="hljs-string"> 16,
    display_name</span>: <span class="hljs-string">&#x27;Marina&#x27;</span>,
    <span class="hljs-attribute">canonical_name</span>: <span class="hljs-string">&#x27;MARINA&#x27;</span>,
    <span class="hljs-attribute">canonical_name_safe</span>: <span class="hljs-string">&#x27;MARINA&#x27;</span>
  },
  {
    <span class="hljs-attribute">id:</span><span class="hljs-string"> 17,
    display_name</span>: <span class="hljs-string">&#x27;Mission&#x27;</span>,
    <span class="hljs-attribute">canonical_name</span>: <span class="hljs-string">&#x27;MISSION&#x27;</span>,
    <span class="hljs-attribute">canonical_name_safe</span>: <span class="hljs-string">&#x27;MISSION&#x27;</span>
  },
  {
    <span class="hljs-attribute">id:</span><span class="hljs-string"> 18,
    display_name</span>: <span class="hljs-string">&#x27;Nob Hill&#x27;</span>,
    <span class="hljs-attribute">canonical_name</span>: <span class="hljs-string">&#x27;NOB HILL&#x27;</span>,
    <span class="hljs-attribute">canonical_name_safe</span>: <span class="hljs-string">&#x27;NOB%20HILL&#x27;</span>
  },
  {
    <span class="hljs-attribute">id:</span><span class="hljs-string"> 19,
    display_name</span>: <span class="hljs-string">&#x27;Noe Valley&#x27;</span>,
    <span class="hljs-attribute">canonical_name</span>: <span class="hljs-string">&#x27;NOE VALLEY&#x27;</span>,
    <span class="hljs-attribute">canonical_name_safe</span>: <span class="hljs-string">&#x27;NOE%20VALLEY&#x27;</span>
  },
  {
    <span class="hljs-attribute">id:</span><span class="hljs-string"> 20,
    display_name</span>: <span class="hljs-string">&#x27;North Beach&#x27;</span>,
    <span class="hljs-attribute">canonical_name</span>: <span class="hljs-string">&#x27;NORTH BEACH&#x27;</span>,
    <span class="hljs-attribute">canonical_name_safe</span>: <span class="hljs-string">&#x27;NORTH%20BEACH&#x27;</span>
  },
  {
    <span class="hljs-attribute">id:</span><span class="hljs-string"> 21,
    display_name</span>: <span class="hljs-string">&#x27;Ocean View&#x27;</span>,
    <span class="hljs-attribute">canonical_name</span>: <span class="hljs-string">&#x27;OCEAN VIEW&#x27;</span>,
    <span class="hljs-attribute">canonical_name_safe</span>: <span class="hljs-string">&#x27;OCEAN%20VIEW&#x27;</span>,
  },
  {
    <span class="hljs-attribute">id:</span><span class="hljs-string"> 22,
    display_name</span>: <span class="hljs-string">&#x27;Outer Mission&#x27;</span>,
    <span class="hljs-attribute">canonical_name</span>: <span class="hljs-string">&#x27;OUTER MISSION&#x27;</span>,
    <span class="hljs-attribute">canonical_name_safe</span>: <span class="hljs-string">&#x27;OUTER%20MISSION&#x27;</span>
  },
  {
    <span class="hljs-attribute">id:</span><span class="hljs-string"> 23,
    display_name</span>: <span class="hljs-string">&#x27;Outer Richmond&#x27;</span>,
    <span class="hljs-attribute">canonical_name</span>: <span class="hljs-string">&#x27;OUTER RICHMOND&#x27;</span>,
    <span class="hljs-attribute">canonical_name_safe</span>: <span class="hljs-string">&#x27;OUTER%20RICHMOND&#x27;</span>
  },
  {
    <span class="hljs-attribute">id:</span><span class="hljs-string"> 24,
    display_name</span>: <span class="hljs-string">&#x27;Outer Sunset&#x27;</span>,
    <span class="hljs-attribute">canonical_name</span>: <span class="hljs-string">&#x27;OUTER SUNSET&#x27;</span>,
    <span class="hljs-attribute">canonical_name_safe</span>: <span class="hljs-string">&#x27;OUTER%20SUNSET&#x27;</span>
  },
  {
    <span class="hljs-attribute">id:</span><span class="hljs-string"> 25,
    display_name</span>: <span class="hljs-string">&#x27;Pacific Heights&#x27;</span>,
    <span class="hljs-attribute">canonical_name</span>: <span class="hljs-string">&#x27;PACIFIC HEIGHTS&#x27;</span>,
    <span class="hljs-attribute">canonical_name_safe</span>: <span class="hljs-string">&#x27;PACIFIC%20HEIGHTS&#x27;</span>
  },
  {
    <span class="hljs-attribute">id:</span><span class="hljs-string"> 26,
    display_name</span>: <span class="hljs-string">&#x27;Parkside&#x27;</span>,
    <span class="hljs-attribute">canonical_name</span>: <span class="hljs-string">&#x27;PARKSIDE&#x27;</span>,
    <span class="hljs-attribute">canonical_name_safe</span>: <span class="hljs-string">&#x27;PARKSIDE&#x27;</span>
  },
  {
    <span class="hljs-attribute">id:</span><span class="hljs-string"> 27,
    display_name</span>: <span class="hljs-string">&#x27;Potrero Hill&#x27;</span>,
    <span class="hljs-attribute">canonical_name</span>: <span class="hljs-string">&#x27;POTRERO HILL&#x27;</span>,
    <span class="hljs-attribute">canonical_name_safe</span>: <span class="hljs-string">&#x27;POTRERO%20HILL&#x27;</span>
  },
  {
    <span class="hljs-attribute">id:</span><span class="hljs-string"> 28,
    display_name</span>: <span class="hljs-string">&#x27;Presidio&#x27;</span>,
    <span class="hljs-attribute">canonical_name</span>: <span class="hljs-string">&#x27;PRESIDIO&#x27;</span>,
    <span class="hljs-attribute">canonical_name_safe</span>: <span class="hljs-string">&#x27;PRESIDIO&#x27;</span>
  },
  {
    <span class="hljs-attribute">id:</span><span class="hljs-string"> 29,
    display_name</span>: <span class="hljs-string">&#x27;Presidio Heights&#x27;</span>,
    <span class="hljs-attribute">canonical_name</span>: <span class="hljs-string">&#x27;PRESIDIO HEIGHTS&#x27;</span>,
    <span class="hljs-attribute">canonical_name_safe</span>: <span class="hljs-string">&#x27;PRESIDIO%20HEIGHTS&#x27;</span>
  },
  {
    <span class="hljs-attribute">id:</span><span class="hljs-string"> 30,
    display_name</span>: <span class="hljs-string">&#x27;Russian Hill&#x27;</span>,
    <span class="hljs-attribute">canonical_name</span>: <span class="hljs-string">&#x27;RUSSIAN HILL&#x27;</span>,
    <span class="hljs-attribute">canonical_name_safe</span>: <span class="hljs-string">&#x27;RUSSIAN%20HILL&#x27;</span>
  },
  {
    <span class="hljs-attribute">id:</span><span class="hljs-string"> 31,
    display_name</span>: <span class="hljs-string">&#x27;Seacliff&#x27;</span>,
    <span class="hljs-attribute">canonical_name</span>: <span class="hljs-string">&#x27;SEACLIFF&#x27;</span>,
    <span class="hljs-attribute">canonical_name_safe</span>: <span class="hljs-string">&#x27;SEACLIFF&#x27;</span>
  },
  {
    <span class="hljs-attribute">id:</span><span class="hljs-string"> 32,
    display_name</span>: <span class="hljs-string">&#x27;South Of Market&#x27;</span>,
    <span class="hljs-attribute">canonical_name</span>: <span class="hljs-string">&#x27;SOUTH OF MARKET&#x27;</span>,
    <span class="hljs-attribute">canonical_name_safe</span>: <span class="hljs-string">&#x27;SOUTH%20OF%20MARKET&#x27;</span>
  },
  {
    <span class="hljs-attribute">id:</span><span class="hljs-string"> 33,
    display_name</span>: <span class="hljs-string">&#x27;Treasure Island/Yerba Buena Island&#x27;</span>,
    <span class="hljs-attribute">canonical_name</span>: <span class="hljs-string">&#x27;TREASURE ISLAND/YBI&#x27;</span>,
    <span class="hljs-attribute">canonical_name_safe</span>: <span class="hljs-string">&#x27;TREASURE ISLAND%2FYBI&#x27;</span>,
  },
  {
    <span class="hljs-attribute">id:</span><span class="hljs-string"> 34,
    display_name</span>: <span class="hljs-string">&#x27;Twin Peaks&#x27;</span>,
    <span class="hljs-attribute">canonical_name</span>: <span class="hljs-string">&#x27;TWIN PEAKS&#x27;</span>,
    <span class="hljs-attribute">canonical_name_safe</span>: <span class="hljs-string">&#x27;TWIN%20PEAKS&#x27;</span>
  },
  {
    <span class="hljs-attribute">id:</span><span class="hljs-string"> 35,
    display_name</span>: <span class="hljs-string">&#x27;Visitacion Valley&#x27;</span>,
    <span class="hljs-attribute">canonical_name</span>: <span class="hljs-string">&#x27;VISITACION VALLEY&#x27;</span>,
    <span class="hljs-attribute">canonical_name_safe</span>: <span class="hljs-string">&#x27;VISITACION%20VALLEY&#x27;</span>
  },
  {
    <span class="hljs-attribute">id:</span><span class="hljs-string"> 36,
    display_name</span>: <span class="hljs-string">&#x27;Western Addition&#x27;</span>,
    <span class="hljs-attribute">canonical_name</span>: <span class="hljs-string">&#x27;WESTERN ADDITION&#x27;</span>,
    <span class="hljs-attribute">canonical_name_safe</span>: <span class="hljs-string">&#x27;WESTERN%20ADDITION&#x27;</span>
  },
  {
    <span class="hljs-attribute">id:</span><span class="hljs-string"> 37,
    display_name</span>: <span class="hljs-string">&#x27;West Of Twin Peaks&#x27;</span>,
    <span class="hljs-attribute">canonical_name</span>: <span class="hljs-string">&#x27;WEST OF TWIN PEAKS&#x27;</span>,
    <span class="hljs-attribute">canonical_name_safe</span>: <span class="hljs-string">&#x27;WEST%20OF%20TWIN%20PEAKS&#x27;</span>
  },
];

<span class="hljs-keyword">export</span> <span class="hljs-title">default</span> {
  neighborhoods
};
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverflagsdbrouteflags.js"><a href="#toc"><a name="server-flags-dbrouteflags-js">server/flags/dbRouteFlags.js</a></a></h2>
<pre><code><span class="hljs-keyword">import</span> flagUtils <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../framework/flagUtils&#x27;</span>;

<span class="hljs-comment">// container obj for command-line flags, to be exported.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// - top-level setup functions can import this file directly and use the results.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// - modules which need to be run in unit tests should access these flags by</span>
<span class="hljs-comment">//     passing the exported dbRouteFlags object via app.locals.</span>
const dbRouteFlags = {};

<span class="hljs-comment">// define flags...</span>

<span class="hljs-comment">// if set true, enable API routes that will query the remote testing DB under &#x27;/api/test/...&#x27;</span>
<span class="hljs-comment">// this is useful when transitioning between database versions that will require</span>
<span class="hljs-comment">// changes to the API. This allows for simultaneous access to the existing routes</span>
<span class="hljs-comment">// and experimental, testing routes</span>

<span class="hljs-comment">//   default: false</span>
flagUtils.defineBooleanEnvFlag(
    dbRouteFlags, <span class="hljs-string">&#x27;enable_test&#x27;</span>,
    process.env.NEO4J_URI_TEST, <span class="hljs-keyword">false</span>);

<span class="hljs-comment">// if set true, enable unified search api at &#x27;/api/search?q=foo&#x27;</span>
<span class="hljs-comment">//   default: true</span>
flagUtils.defineBooleanEnvFlag(
    dbRouteFlags, <span class="hljs-string">&#x27;enable_unified_search&#x27;</span>,
    process.env.EBOOK_API_ENABLE_UNIFIED_SEARCH, <span class="hljs-keyword">true</span>);

<span class="hljs-comment">// if set true, validate query responses with json-schema definitions.</span>
<span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> Before activating this, need to verify that all fields which may</span>
<span class="hljs-comment">// possibly be &#x27;null&#x27; are represented as &#x27;nullable&#x27;.</span>
<span class="hljs-comment">// See https://github.com/antievictionmappingproject/evictorbook/issues/408</span>
<span class="hljs-comment">//   default: false</span>
flagUtils.defineBooleanEnvFlag(
    dbRouteFlags, <span class="hljs-string">&#x27;validate_query_responses&#x27;</span>,
    process.env.EBOOK_API_VALIDATE_QUERY_RESPONSES, <span class="hljs-keyword">false</span>);

<span class="hljs-comment">// if set true, disable cacheMiddleware for db routes. useful for rapid testing</span>
<span class="hljs-comment">// in development environment. DON&#x27;T DO THIS IN PRODUCTION.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">//   default: false</span>
flagUtils.defineBooleanEnvFlag(
    dbRouteFlags, <span class="hljs-string">&#x27;disable_cache&#x27;</span>, process.env.EBOOK_API_DISABLE_CACHE, <span class="hljs-keyword">false</span>);

<span class="hljs-comment">// TODO(Dana): Deprecate this flag and delete.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// if set true, response json matches rest proto, where multimap fields are</span>
<span class="hljs-comment">// represented as maps of &#x27;{ value: &lt;list_of_strings&gt; }&#x27; objects.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// otherwise, response json matches the may 2020 api, where multimap fields</span>
<span class="hljs-comment">// are represented directly as maps of lists.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// context: may 2020 api responses include maps of lists, which are not</span>
<span class="hljs-comment">// supported in proto. to get proto compatibility, we represent those fields</span>
<span class="hljs-comment">// instead as a proto map of StringVector messages.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">//   default: false</span>
flagUtils.defineBooleanEnvFlag(
    dbRouteFlags, <span class="hljs-string">&#x27;write_proto_multimaps&#x27;</span>,
    process.env.EBOOK_API_WRITE_PROTO_MULTIMAPS, <span class="hljs-keyword">false</span>);

<span class="hljs-comment">// TODO(Dana): Deprecate this flag and delete.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// if set true, /api/network/... response json encodes graph node&#x27;s properties</span>
<span class="hljs-comment">// as a json-encoded string named &#x27;properties_json&#x27;.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// otherwise, /api/network/... response json features node properties as a</span>
<span class="hljs-comment">// plain obj named &#x27;properties&#x27;. this matches the may 2020 api behavior.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// context: when encoding getNetworkParcel and getNetworkBE responses as</span>
<span class="hljs-comment">// proto, we provide a json blob of node properties rather than attempting to fully</span>
<span class="hljs-comment">// document the graph schema inside rest response proto. this is a good way to</span>
<span class="hljs-comment">// approximate the behavior of the original rest api (and the neo4j-driver api</span>
<span class="hljs-comment">// it&#x27;s based on), while still a valid type-safe proto.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// see type_definitions/proto/rest/graph_util.proto</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">//   default: false</span>
flagUtils.defineBooleanEnvFlag(
  dbRouteFlags, <span class="hljs-string">&#x27;write_subgraph_properties_json&#x27;</span>,
  process.env.EBOOK_API_WRITE_JSON_SUBGRAPH_PROPERTIES, <span class="hljs-keyword">false</span>);

<span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Rename to &#x27;default&#x27; instead of &#x27;max&#x27;.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// if set, use this as the default page size allowed for /api/neighborhood/...</span>
<span class="hljs-comment">// requests. (when page size is not specified, /api/neighborhood uses the</span>
<span class="hljs-comment">// maximum by default.)</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">//   default: 100</span>
flagUtils.defineIntegerEnvFlag(
  dbRouteFlags, <span class="hljs-string">&#x27;neighborhood_max_page_size&#x27;</span>,
  process.env.EBOOK_API_NEIGHBORHOOD_MAX_PAGE_SIZE, <span class="hljs-number">100</span>);

<span class="hljs-comment">// TODO(Dana): Deprecate this flag and delete.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// if set true, /api/neighborhood/... response json represents</span>
<span class="hljs-comment">// { evictions: &lt;list&gt; }. this allows compatibility with response proto in</span>
<span class="hljs-comment">// rest/ebook_service.proto</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// otherwise, response json represents a list of evictions with no wrapper</span>
<span class="hljs-comment">// object, as in the may 2020 production server.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">//   default: false</span>
flagUtils.defineBooleanEnvFlag(
  dbRouteFlags, <span class="hljs-string">&#x27;wrap_neighborhood_evictions&#x27;</span>,
  process.env.EBOOK_API_WRAP_NEIGHBORHOOD_EVICTIONS, <span class="hljs-keyword">false</span>);

<span class="hljs-comment">// export the flags object.</span>
export <span class="hljs-keyword">default</span> dbRouteFlags;
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverframeworkreadme.md"><a href="#toc"><a name="server-framework-readme-md">server/framework/README.md</a></a></h2>
<pre><code><span class="hljs-comment">Framework</span>

<span class="hljs-comment">Previously</span> <span class="hljs-comment">located</span> <span class="hljs-comment">in</span> <span class="hljs-comment">server/inc/pocket</span><span class="hljs-literal">-</span><span class="hljs-comment">dimension</span><span class="hljs-string">.</span>

<span class="hljs-comment">The files in this directory contain code that was</span> <span class="hljs-comment">conceived</span> <span class="hljs-comment">of</span> <span class="hljs-comment">as a general-purpose framework I</span> <span class="hljs-comment">call</span> <span class="hljs-comment">&#x27;pocket</span><span class="hljs-literal">-</span><span class="hljs-comment">dimension&#x27;</span><span class="hljs-string">,</span> <span class="hljs-comment">intended</span> <span class="hljs-comment">to</span> <span class="hljs-comment">be re-used for other projects</span><span class="hljs-string">.</span> <span class="hljs-comment">Express</span> <span class="hljs-comment">is</span> <span class="hljs-comment">an</span> <span class="hljs-comment">impressive</span> <span class="hljs-comment">framework</span><span class="hljs-string">,</span> <span class="hljs-comment">but it&#x27;s missing certain utilities and conveniences that I&#x27;ve found necessary for readable and maintainable web applications</span><span class="hljs-string">,</span> <span class="hljs-comment">so I implemented this to fill in the gaps</span><span class="hljs-string">.</span> <span class="hljs-comment">I developed this in parallel</span> <span class="hljs-comment">with</span> <span class="hljs-comment">my work on the ebook</span> <span class="hljs-comment">web</span> <span class="hljs-comment">server</span><span class="hljs-string">,</span> <span class="hljs-comment">using</span> <span class="hljs-comment">evictorbook</span> <span class="hljs-comment">as a test case to verify that this would</span> <span class="hljs-comment">be useful in a real</span><span class="hljs-literal">-</span><span class="hljs-comment">world</span> <span class="hljs-comment">system</span><span class="hljs-string">.</span>

<span class="hljs-comment">As</span> <span class="hljs-comment">such</span><span class="hljs-string">,</span> <span class="hljs-comment">I isolated this code into a separate folder in the project and labeled it with that project&#x27;s name to distinguish it from the ebook application</span> <span class="hljs-comment">itself</span><span class="hljs-string">.</span>

<span class="hljs-comment">Some elements turned out to</span> <span class="hljs-comment">be extremely useful for ebook&#x27;s</span> <span class="hljs-comment">use</span> <span class="hljs-comment">cases</span> <span class="hljs-comment">(safe and readable debug flag</span> <span class="hljs-comment">access</span><span class="hljs-string">,</span> <span class="hljs-comment">mock app harness for testing)</span><span class="hljs-string">.</span> <span class="hljs-comment">Other</span> <span class="hljs-comment">elements</span><span class="hljs-string">,</span> <span class="hljs-comment">in</span> <span class="hljs-comment">practice</span><span class="hljs-string">,</span> <span class="hljs-comment">were</span> <span class="hljs-comment">more</span> <span class="hljs-comment">narrow</span> <span class="hljs-comment">or specialized than a project like ebook calls for</span> <span class="hljs-comment">(&#x27;service&#x27; metaphor for reusing code between client-facing and internal</span> <span class="hljs-comment">code</span><span class="hljs-string">,</span> <span class="hljs-comment">validation utilities for schemas written</span> <span class="hljs-comment">in</span> <span class="hljs-comment">&#x27;protocol</span> <span class="hljs-comment">buffer&#x27;</span> <span class="hljs-comment">language</span><span class="hljs-string">.</span><span class="hljs-comment">)</span>

<span class="hljs-comment">As I depart the project</span><span class="hljs-string">,</span> <span class="hljs-comment">I&#x27;m performing a cleanup pass and moving the code</span> <span class="hljs-comment">from</span> <span class="hljs-comment">&#x27;inc/pocket</span><span class="hljs-literal">-</span><span class="hljs-comment">dimension/&#x27; to the more legible</span> <span class="hljs-comment">&#x27;framework/&#x27;</span><span class="hljs-string">.</span> <span class="hljs-comment">These are tools that I&#x27;ve</span> <span class="hljs-comment">found</span> <span class="hljs-comment">to</span> <span class="hljs-comment">be quite useful in general</span><span class="hljs-string">,</span> <span class="hljs-comment">and future maintainers are encouraged to make use of these modules and update</span> <span class="hljs-comment">them</span> <span class="hljs-comment">as the need arises. Consider the code in this</span> <span class="hljs-comment">directory</span> <span class="hljs-comment">the</span> <span class="hljs-comment">&#x27;aemp&#x27;</span> <span class="hljs-comment">fork</span> <span class="hljs-comment">of</span> <span class="hljs-comment">my</span> <span class="hljs-comment">mini</span><span class="hljs-literal">-</span><span class="hljs-comment">framework</span><span class="hljs-string">,</span> <span class="hljs-comment">here if you ever need</span> <span class="hljs-comment">it</span><span class="hljs-string">.</span>

<span class="hljs-comment">The</span> <span class="hljs-comment">original</span> <span class="hljs-comment">README</span> <span class="hljs-comment">from</span> <span class="hljs-comment">3/2021 is preserved below. </span>

<span class="hljs-literal">-</span><span class="hljs-comment">Dana</span>

<span class="hljs-comment">pocket</span><span class="hljs-literal">-</span><span class="hljs-comment">dimension:</span> <span class="hljs-comment">a</span> <span class="hljs-comment">toolkit</span> <span class="hljs-comment">by</span> <span class="hljs-comment">datagram</span>

<span class="hljs-comment">tools for writing simple and</span> <span class="hljs-comment">effective</span> <span class="hljs-comment">node</span><span class="hljs-string">.</span><span class="hljs-comment">js servers in express. there are two main components:</span> 

<span class="hljs-literal">-</span> <span class="hljs-comment">utilities for using protocol buffers to type-check plain javascript objects. useful for enforcing type-checks on rest payloads</span><span class="hljs-string">,</span> <span class="hljs-comment">database</span> <span class="hljs-comment">query</span> <span class="hljs-comment">results</span><span class="hljs-string">,</span> <span class="hljs-comment">or other data types where</span> <span class="hljs-comment">there&#x27;s</span> <span class="hljs-comment">an implicit schema that could benefit from more rigorous</span> <span class="hljs-comment">definition</span><span class="hljs-string">.</span>
<span class="hljs-literal">-</span> <span class="hljs-comment">utilities</span> <span class="hljs-comment">for</span> <span class="hljs-comment">writing</span> <span class="hljs-comment">modular</span><span class="hljs-string">,</span> <span class="hljs-comment">stateless rest handlers in node express. first-class support for dependency injection via app</span><span class="hljs-string">.</span><span class="hljs-comment">locals</span> <span class="hljs-comment">context</span><span class="hljs-string">,</span> <span class="hljs-comment">safe accessors for shell environment</span> <span class="hljs-comment">variables</span><span class="hljs-string">,</span> <span class="hljs-comment">more</span> <span class="hljs-comment">to</span> <span class="hljs-comment">come</span><span class="hljs-string">.</span>

<span class="hljs-comment">taken</span> <span class="hljs-comment">together</span><span class="hljs-string">,</span> <span class="hljs-comment">this toolkit allows for systems programmers to adopt a modular and flexible approach for stateless real-time backend systems in the javascript</span> <span class="hljs-comment">language</span><span class="hljs-string">.</span>

<span class="hljs-comment">note: the target platform for this library is node</span><span class="hljs-string">.</span> <span class="hljs-comment">however</span><span class="hljs-string">,</span> <span class="hljs-comment">the</span> <span class="hljs-comment">functions</span> <span class="hljs-comment">in</span> <span class="hljs-comment">protoUtils are intended to be appropriate for use in</span><span class="hljs-literal">-</span><span class="hljs-comment">browser</span><span class="hljs-string">,</span> <span class="hljs-comment">as</span> <span class="hljs-comment">well</span><span class="hljs-string">.</span> <span class="hljs-comment">(for</span> <span class="hljs-comment">example</span><span class="hljs-string">,</span> <span class="hljs-comment">a react client could call</span> <span class="hljs-comment">protoUtils</span><span class="hljs-string">.</span><span class="hljs-comment">checkProto() to verify the field names and structure of rest-json payloads received from</span> <span class="hljs-comment">a</span> <span class="hljs-comment">server</span> <span class="hljs-comment">api</span><span class="hljs-string">.</span><span class="hljs-comment">)</span>


<span class="hljs-comment">written</span> <span class="hljs-comment">and</span> <span class="hljs-comment">maintained</span> <span class="hljs-comment">by</span> <span class="hljs-comment">datagram</span><span class="hljs-string">.</span>
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverframeworkflagutils.js"><a href="#toc"><a name="server-framework-flagutils-js">server/framework/flagUtils.js</a></a></h2>
<pre><code><span class="hljs-comment">// flagUtils.js</span>


<span class="hljs-comment">// helper functions to read flags from env:</span>

<span class="hljs-comment">// safe way to read a boolean flag, passed to the app via env variable.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// inputs: string value of an env variable, and the intended default. return</span>
<span class="hljs-comment">// true if the string is &quot;true&quot;, and false if the string is &quot;false&quot;. otherwise,</span>
<span class="hljs-comment">// return the otherwise, return the default.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// recommended: prefer variables that default to false. they&#x27;re safer.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// usage:</span>
<span class="hljs-comment">//    const debugFlag = readBooleanEnvFlag(process.env.ENV_VARIABLE, false);</span>
<span class="hljs-comment">//    if (debugFlag) {</span>
<span class="hljs-comment">//      // do something you don&#x27;t normally do in production.</span>
<span class="hljs-comment">//    }</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">readBooleanEnvFlag</span>(<span class="hljs-params">envString, defaultValue = <span class="hljs-literal">false</span></span>) {
  <span class="hljs-keyword">if</span> (envString === <span class="hljs-string">&quot;true&quot;</span>) { <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; }
  <span class="hljs-keyword">if</span> (envString === <span class="hljs-string">&quot;false&quot;</span>) { <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; }
  <span class="hljs-keyword">return</span> defaultValue;
}

<span class="hljs-comment">// safe way to read an integer flag, passed to the app via env variable.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// inputs: string value of the env variable, and the intended integer default.</span>
<span class="hljs-comment">// if the string can be parsed as an integer, return that integer value.</span>
<span class="hljs-comment">// otherwise, returns the default. (&#x27;&#x27; -&gt; default, not zero.)</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// usage:</span>
<span class="hljs-comment">//   const someParam = readIntegerEnvFlag(process.env.ENV_VARIABLE, 100);</span>
<span class="hljs-comment">//   if (someParam &lt; 0) {</span>
<span class="hljs-comment">//     callSomeFunction(someParam);</span>
<span class="hljs-comment">//   }</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">readIntegerEnvFlag</span>(<span class="hljs-params">envString, defaultValue = <span class="hljs-number">0</span></span>) {
  <span class="hljs-keyword">var</span> value;
  <span class="hljs-keyword">if</span> (!envString) {
    <span class="hljs-comment">// return default if undefined/empty str is passed in...</span>
    <span class="hljs-keyword">return</span> defaultValue;
  }
  value = <span class="hljs-title class_">Number</span>(envString);
  <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">Number</span>.<span class="hljs-title function_">isInteger</span>(value)) {
    <span class="hljs-comment">// ...or if the number is a non-integer.</span>
    <span class="hljs-keyword">return</span> defaultValue;
  }
  <span class="hljs-keyword">return</span> value;
}

<span class="hljs-comment">// safe way to read a string flag, passed into the app via env variable.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// inputs: the value of an env variable, as returned by process.env.MY_VARIABLE,</span>
<span class="hljs-comment">//  and an intended default value.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// usage:</span>
<span class="hljs-comment">//   const someValue = readStringEnvFlag(process.env.MY_VARIABLE, &quot;tubular&quot;);</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// this isn&#x27;t as useful as the equivalent helper functions for boolean and</span>
<span class="hljs-comment">// number flags, but it&#x27;s here for symmetry.</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">readStringEnvFlag</span>(<span class="hljs-params">envString, defaultValue = <span class="hljs-string">&#x27;&#x27;</span></span>) {
  <span class="hljs-keyword">return</span> ( envString ? envString : defaultValue );
}

<span class="hljs-comment">// internal helper function, check types and throw a well-formatted error if</span>
<span class="hljs-comment">// param_value&#x27;s type doesn&#x27;t match expected_typename.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// example usage:</span>
<span class="hljs-comment">//   checkParamType(&quot;flags&quot;, flags, &#x27;object&#x27;);</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// if &#x27;print_value&#x27; is true, include param_value&#x27;s value in the error msg.</span>
<span class="hljs-comment">// if &#x27;check_nonfalse&#x27; is true, also throw on &#x27;if (!param_value)&#x27;.</span>
<span class="hljs-keyword">const</span> checkParamType = <span class="hljs-keyword">function</span>(<span class="hljs-params">
    param_name, param_value, expected_typename,
    print_value = <span class="hljs-literal">true</span>, check_nonfalse = <span class="hljs-literal">false</span></span>) {
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> param_value !== expected_typename) {
    <span class="hljs-keyword">throw</span> <span class="hljs-string">&#x27;invalid &#x27;</span> + param_name + <span class="hljs-string">&#x27;,&#x27;</span> + 
        <span class="hljs-string">&#x27; expected &#x27;</span> + expected_typename + <span class="hljs-string">&#x27;,&#x27;</span> +
        <span class="hljs-string">&#x27; found: &#x27;</span> + <span class="hljs-keyword">typeof</span> param_value +
        ( (print_value) ? (<span class="hljs-string">&#x27;, value: &#x27;</span> + param_value) : <span class="hljs-string">&#x27;&#x27;</span> );
  }
  <span class="hljs-keyword">if</span> (check_nonfalse &amp;&amp; (!param_value)) {
    <span class="hljs-keyword">throw</span> <span class="hljs-string">&#x27;invalid &#x27;</span> + param_name + <span class="hljs-string">&#x27;,&#x27;</span> + 
        <span class="hljs-string">&#x27; expected non-falsey &#x27;</span> + expected_typename + <span class="hljs-string">&#x27;,&#x27;</span> +
        <span class="hljs-string">&#x27; found: &#x27;</span> + <span class="hljs-keyword">typeof</span> param_value +
        ( (print_value) ? (<span class="hljs-string">&#x27;, value: &#x27;</span> + param_value) : <span class="hljs-string">&#x27;&#x27;</span> );
  }
}

<span class="hljs-comment">// safely read and store a boolean flag, passed to the app via env variable.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// inputs:</span>
<span class="hljs-comment">//   flags: object. value will be stored as a property of this obj.</span>
<span class="hljs-comment">//   flagName: a name for your flag. access the value later at flags.flagName.</span>
<span class="hljs-comment">//   envString: the string-value of an environment variable to process, as</span>
<span class="hljs-comment">//       retrieved with &#x27;process.env.ENV_VARIABLE&#x27;.</span>
<span class="hljs-comment">//   defaultValue: if supplied, the boolean value to use by default.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// example usage:</span>
<span class="hljs-comment">//   // in app setup...</span>
<span class="hljs-comment">//   const flags = {};</span>
<span class="hljs-comment">//   defineBooleanEnvFlag(flags, &#x27;myFlag&#x27;, process.env.MY_ENV_VARIABLE, false);</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">//   // ... later ...</span>
<span class="hljs-comment">//   if (flags.myFlag) {</span>
<span class="hljs-comment">//     // do something you don&#x27;t normally do in production.</span>
<span class="hljs-comment">//   }</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">defineBooleanEnvFlag</span>(<span class="hljs-params">
    flags, flagName, envString = <span class="hljs-string">&#x27;&#x27;</span>, defaultValue = <span class="hljs-literal">false</span></span>) {
  <span class="hljs-title function_">checkParamType</span>(<span class="hljs-string">&#x27;flags&#x27;</span>, flags, <span class="hljs-string">&#x27;object&#x27;</span>);
  <span class="hljs-title function_">checkParamType</span>(<span class="hljs-string">&#x27;flagName&#x27;</span>, flagName, <span class="hljs-string">&#x27;string&#x27;</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">true</span>);
  <span class="hljs-title function_">checkParamType</span>(<span class="hljs-string">&#x27;envString&#x27;</span>, envString, <span class="hljs-string">&#x27;string&#x27;</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>);
  <span class="hljs-title function_">checkParamType</span>(<span class="hljs-string">&#x27;defaultValue&#x27;</span>, defaultValue, <span class="hljs-string">&#x27;boolean&#x27;</span>);

  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(flags, flagName, {
    <span class="hljs-attr">value</span>: <span class="hljs-title function_">readBooleanEnvFlag</span>(envString, defaultValue),
    <span class="hljs-attr">writable</span>: <span class="hljs-literal">false</span>
  });
}

<span class="hljs-comment">// safely read and store an integer flag, passed to the app via env variable.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// inputs:</span>
<span class="hljs-comment">//   flags: object. value will be stored as a property of this obj.</span>
<span class="hljs-comment">//   flagName: a name for your flag. access the value later at flags.flagName.</span>
<span class="hljs-comment">//   envString: the string-value of an environment variable to process, as</span>
<span class="hljs-comment">//       retrieved with &#x27;process.env.ENV_VARIABLE&#x27;.</span>
<span class="hljs-comment">//   defaultValue: if supplied, the integer value to use by default.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// example usage:</span>
<span class="hljs-comment">//   // in app setup...</span>
<span class="hljs-comment">//   const flags = {};</span>
<span class="hljs-comment">//   defineIntegerEnvFlag(flags, &#x27;myParam&#x27;, process.env.MY_ENV_VARIABLE, 192);</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">//   // ... later ...</span>
<span class="hljs-comment">//   const someParam = flags.myParam;  // default: 192.</span>
<span class="hljs-comment">//   if (someParam &lt; 0) {</span>
<span class="hljs-comment">//     callSomeFunction(someParam);</span>
<span class="hljs-comment">//   }</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">defineIntegerEnvFlag</span>(<span class="hljs-params">
    flags, flagName, envString = <span class="hljs-string">&#x27;&#x27;</span>, defaultValue = <span class="hljs-number">0</span></span>) {
  <span class="hljs-title function_">checkParamType</span>(<span class="hljs-string">&#x27;flags&#x27;</span>, flags, <span class="hljs-string">&#x27;object&#x27;</span>);
  <span class="hljs-title function_">checkParamType</span>(<span class="hljs-string">&#x27;flagName&#x27;</span>, flagName, <span class="hljs-string">&#x27;string&#x27;</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">true</span>);
  <span class="hljs-title function_">checkParamType</span>(<span class="hljs-string">&#x27;envString&#x27;</span>, envString, <span class="hljs-string">&#x27;string&#x27;</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>);
  <span class="hljs-title function_">checkParamType</span>(<span class="hljs-string">&#x27;defaultValue&#x27;</span>, defaultValue, <span class="hljs-string">&#x27;number&#x27;</span>);

  <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">Number</span>.<span class="hljs-title function_">isInteger</span>(defaultValue)) {
    <span class="hljs-keyword">throw</span> <span class="hljs-string">&#x27;bad default value, expected integer, got: &#x27;</span> + defaultValue;
  }

  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(flags, flagName, {
    <span class="hljs-attr">value</span>: <span class="hljs-title function_">readIntegerEnvFlag</span>(envString, defaultValue),
    <span class="hljs-attr">writable</span>: <span class="hljs-literal">false</span>
  });
}

<span class="hljs-comment">// safely read and store a string flag, passed to the app via env variable.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// inputs:</span>
<span class="hljs-comment">//   flags: object. value will be stored as a property of this obj.</span>
<span class="hljs-comment">//   flagName: a name for your flag. access the value later at flags.flagName.</span>
<span class="hljs-comment">//   envString: the string-value of an environment variable to process, as</span>
<span class="hljs-comment">//       retrieved with &#x27;process.env.ENV_VARIABLE&#x27;.</span>
<span class="hljs-comment">//   defaultValue: if supplied, the string value to use by default.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// example usage:</span>
<span class="hljs-comment">//   // in app setup...</span>
<span class="hljs-comment">//   const flags = {};</span>
<span class="hljs-comment">//   defineStringEnvFlag(flags, &#x27;myFlag&#x27;, process.env.MY_ENV_VARIABLE, &#x27;mondo&#x27;);</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">//   // ... later ...</span>
<span class="hljs-comment">//   if (flags.myFlag !== &quot;mondo&quot;) {</span>
<span class="hljs-comment">//     // do something you don&#x27;t normally do in production.</span>
<span class="hljs-comment">//   }</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">defineStringEnvFlag</span>(<span class="hljs-params">
    flags, flagName, envString = <span class="hljs-string">&#x27;&#x27;</span>, defaultValue = <span class="hljs-string">&#x27;&#x27;</span></span>) {
  <span class="hljs-title function_">checkParamType</span>(<span class="hljs-string">&#x27;flags&#x27;</span>, flags, <span class="hljs-string">&#x27;object&#x27;</span>);
  <span class="hljs-title function_">checkParamType</span>(<span class="hljs-string">&#x27;flagName&#x27;</span>, flagName, <span class="hljs-string">&#x27;string&#x27;</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">true</span>);
  <span class="hljs-title function_">checkParamType</span>(<span class="hljs-string">&#x27;envString&#x27;</span>, envString, <span class="hljs-string">&#x27;string&#x27;</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>);
  <span class="hljs-title function_">checkParamType</span>(<span class="hljs-string">&#x27;defaultValue&#x27;</span>, defaultValue, <span class="hljs-string">&#x27;string&#x27;</span>);

  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(flags, flagName, {
    <span class="hljs-attr">value</span>: <span class="hljs-title function_">readStringEnvFlag</span>(envString, defaultValue),
    <span class="hljs-attr">writable</span>: <span class="hljs-literal">false</span>
  });
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  defineBooleanEnvFlag,
  defineIntegerEnvFlag,
  defineStringEnvFlag,
  readBooleanEnvFlag,
  readIntegerEnvFlag,
  readStringEnvFlag
};
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverframeworkmockapp.js"><a href="#toc"><a name="server-framework-mockapp-js">server/framework/mockApp.js</a></a></h2>
<pre><code><span class="hljs-comment">// mockApp.js</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// helper functions useful for testing rest listeners.</span>

<span class="hljs-comment">// creates fake versions of the express app objects, to serve as harness for</span>
<span class="hljs-comment">// rest listeners under test.</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">expressMocks</span>(<span class="hljs-params"></span>) {
  <span class="hljs-comment">// placeholder obj for mocks to store info from code under test (response</span>
  <span class="hljs-comment">// values, other internal details) so they can be verified by unit tests.</span>
  <span class="hljs-comment">//   usage:</span>
  <span class="hljs-comment">//     var mocks = mockUtils.expressMocks();</span>
  <span class="hljs-comment">//     mocks.req.app.locals.queryHandlers[&quot;label&quot;] = fakeQueryHandler;</span>
  <span class="hljs-comment">//     await restListenerUnderTest(mocks.req, mocks.resp);</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">//     // now, you can assert() to validate response.</span>
  <span class="hljs-comment">//     var actualResponse = JSON.parse(mocks.actuals.response_body);</span>
  <span class="hljs-comment">//     assert(...);</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> query handler callbacks may set additional properties here, when</span>
  <span class="hljs-comment">// invoked, to pass detailed information back to test harness for</span>
  <span class="hljs-comment">// assertions (verify parsing of input params, etc.)</span>
  <span class="hljs-keyword">const</span> actuals = {
    <span class="hljs-attr">response_body</span>: <span class="hljs-string">&quot;&quot;</span>,          <span class="hljs-comment">// set on resp.json() or resp.send()</span>
    <span class="hljs-attr">response_finalized</span>: <span class="hljs-literal">false</span>,  <span class="hljs-comment">// set true on resp.json() or resp.send()</span>
    <span class="hljs-attr">response_code</span>: <span class="hljs-number">200</span>          <span class="hljs-comment">// set on resp.status()</span>
  };

  <span class="hljs-comment">// mock request obj, lets code under test know about request parameters and</span>
  <span class="hljs-comment">// app locals.</span>
  <span class="hljs-keyword">const</span> req = {
    <span class="hljs-comment">// caller should set route params here for code under test.</span>
    <span class="hljs-attr">params</span>: {},
    <span class="hljs-comment">// mock app context. express presents the &#x27;app&#x27; obj to callers as a</span>
    <span class="hljs-comment">// property of &#x27;req&#x27;. we take advantage of this to inject dependencies</span>
    <span class="hljs-comment">// and flags into listeners under test.</span>
    <span class="hljs-attr">app</span>: {
      <span class="hljs-attr">locals</span>: {
        <span class="hljs-comment">// mock query handler callbacks, insert a callback with the</span>
        <span class="hljs-comment">// appropriate label to provide data to code under test. handler</span>
        <span class="hljs-comment">// callbacks must be async. see details in opening comments of</span>
        <span class="hljs-comment">// dbRouteListeners.js.</span>
        <span class="hljs-attr">queryHandlers</span>: {},
        <span class="hljs-comment">// mock flags, set these to configure listener behavior.</span>
        <span class="hljs-comment">//</span>
        <span class="hljs-comment">// !!! IMPORTANT !!!:</span>
        <span class="hljs-comment">// if code under test relies on non-falsey defaults for flags</span>
        <span class="hljs-comment">// (integer values), you MUST set that default value in your test.</span>
        <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> import non-falsey defaults from app setup.</span>
        <span class="hljs-attr">dbRouteFlags</span>: {}
      }
    }
  };

  <span class="hljs-comment">// mock response obj, sent to code under test.</span>
  <span class="hljs-keyword">const</span> resp = {
    <span class="hljs-comment">// mock &#x27;json&#x27; function, writes stringified obj to actuals.</span>
    <span class="hljs-attr">json</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">response_obj</span>) {
      <span class="hljs-keyword">if</span> (actuals.<span class="hljs-property">response_finalized</span>) { <span class="hljs-keyword">throw</span> <span class="hljs-string">&#x27;redundant json() call!&#x27;</span>; }
      actuals.<span class="hljs-property">response_body</span> = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(response_obj);
      actuals.<span class="hljs-property">response_finalized</span> = <span class="hljs-literal">true</span>;
      <span class="hljs-keyword">return</span> resp;
    },
    <span class="hljs-comment">// mock &#x27;send&#x27; function, writes response body string to actuals.</span>
    <span class="hljs-attr">send</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">response_body</span>) {
      <span class="hljs-keyword">if</span> (actuals.<span class="hljs-property">response_finalized</span>) { <span class="hljs-keyword">throw</span> <span class="hljs-string">&#x27;redundant send() call!&#x27;</span>; }
      actuals.<span class="hljs-property">response_body</span> = response_body;
      actuals.<span class="hljs-property">response_finalized</span> = <span class="hljs-literal">true</span>;
      <span class="hljs-keyword">return</span> resp;
    },
    <span class="hljs-comment">// mock &#x27;status&#x27; function, writes given http status code to actuals.</span>
    <span class="hljs-attr">status</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">code</span>) {
      <span class="hljs-keyword">if</span> (actuals.<span class="hljs-property">response_finalized</span>) { <span class="hljs-keyword">throw</span> <span class="hljs-string">&#x27;redundant status() call!&#x27;</span>; }
      actuals.<span class="hljs-property">response_code</span> = code;
      <span class="hljs-keyword">return</span> resp;
    }
  };

  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">actuals</span>: actuals,
    <span class="hljs-attr">req</span>: req,
    <span class="hljs-attr">resp</span>: resp
  };
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  expressMocks
};
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverframeworkprototestutils.js"><a href="#toc"><a name="server-framework-prototestutils-js">server/framework/protoTestUtils.js</a></a></h2>
<pre><code><span class="hljs-comment">// protoTestUtils.js</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// test-specific functions for checking types with protocol buffers.</span>

var <span class="hljs-keyword">assert</span> = require(&#x27;<span class="hljs-keyword">assert</span>&#x27;);
var Pbf = require(&#x27;pbf&#x27;);

var protoUtils = require(&#x27;./protoUtils&#x27;);

<span class="hljs-comment">// assert that obj1 and obj2 are both valid protos, and that they represent</span>
<span class="hljs-comment">// equivalent proto messages.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> catch err&#x27;s and assert, rather than throwing errs back to caller.</span>
export <span class="hljs-keyword">function</span> <span class="hljs-keyword">assert</span><span class="hljs-constructor">ProtoEquivalence(<span class="hljs-params">protoDesc</span>, <span class="hljs-params">obj1</span>, <span class="hljs-params">obj2</span>)</span> {
  <span class="hljs-comment">// verify obj&#x27;s are valid as proto. (correct types, no extra fields).</span>
  protoUtils.check<span class="hljs-constructor">Proto(<span class="hljs-params">protoDesc</span>, <span class="hljs-params">obj1</span>)</span>;
  protoUtils.check<span class="hljs-constructor">Proto(<span class="hljs-params">protoDesc</span>, <span class="hljs-params">obj2</span>)</span>;

  <span class="hljs-comment">// encode and reinflate, to standardize / add defaults.</span>
  var reinflated1 = protoUtils.encode<span class="hljs-constructor">AndReinflate(<span class="hljs-params">protoDesc</span>, <span class="hljs-params">obj1</span>)</span>;
  var reinflated2 = protoUtils.encode<span class="hljs-constructor">AndReinflate(<span class="hljs-params">protoDesc</span>, <span class="hljs-params">obj2</span>)</span>;

  <span class="hljs-keyword">assert</span>.deep<span class="hljs-constructor">StrictEqual(<span class="hljs-params">reinflated1</span>, <span class="hljs-params">reinflated2</span>)</span>;
}

export default {
  assertProtoEquivalence
};
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverframeworkprotoutils.js"><a href="#toc"><a name="server-framework-protoutils-js">server/framework/protoUtils.js</a></a></h2>
<pre><code><span class="hljs-comment">// protoUtils.js</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// functions for checking types with protocol buffers, via Pbf proto modules.</span>

<span class="hljs-keyword">var</span> <span class="hljs-title class_">Pbf</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;pbf&#x27;</span>);
<span class="hljs-keyword">var</span> <span class="hljs-title class_">RecursiveDiff</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;recursive-diff&#x27;</span>);
<span class="hljs-keyword">var</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;path&#x27;</span>);
<span class="hljs-keyword">var</span> resolve = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;resolve-protobuf-schema&#x27;</span>);
<span class="hljs-keyword">var</span> compile = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;pbf/compile&#x27;</span>);

<span class="hljs-comment">// Resolves dependencies and compiles a protocol buffer schema from a .proto file.</span>
<span class="hljs-comment">// Heavily inspired by the mapbox pbf compiler cli:</span>
<span class="hljs-comment">// https://github.com/mapbox/pbf/blob/master/bin/pbf</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Note that the filename provided must be presented relative to the root</span>
<span class="hljs-comment">// directory of the project.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// ex: if proto schema is in &#x27;&lt;app_root&gt;/schemas/proto/&#x27;, then you should</span>
<span class="hljs-comment">// provide &#x27;schemas/proto/example.proto&#x27;, *NOT* the relative path from your js</span>
<span class="hljs-comment">// file such as &#x27;../../schemas/proto/example.proto or similar.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// This is due to implementation details of node&#x27;s &#x27;resolve-protobuf-schema&#x27;.</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">compileProto</span>(<span class="hljs-params">filename</span>) {
  <span class="hljs-keyword">const</span> filepath = path.<span class="hljs-title function_">resolve</span>(filename);
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">compile</span>(resolve.<span class="hljs-title function_">sync</span>(filepath));
}

<span class="hljs-comment">// given a plain obj and a Pbf proto message, encode that obj as a proto and then</span>
<span class="hljs-comment">// reinflate it to a new plain object. new object is a deep copy; the original</span>
<span class="hljs-comment">// object is untouched.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// the new object is a deep copy of the original except:</span>
<span class="hljs-comment">//    - unrecognized properties are discarded.</span>
<span class="hljs-comment">//    - matching properties are retained.</span>
<span class="hljs-comment">//    - unset properties are intialized with their default proto values.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// throws err if things go wrong.</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">encodeAndReinflate</span>(<span class="hljs-params">protoDesc, obj</span>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">var</span> pbf = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Pbf</span>();
    protoDesc.<span class="hljs-title function_">write</span>(obj, pbf);
    <span class="hljs-keyword">var</span> finished_buffer = pbf.<span class="hljs-title function_">finish</span>();
    <span class="hljs-keyword">var</span> refilledPbf = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Pbf</span>(finished_buffer);

    <span class="hljs-keyword">return</span> protoDesc.<span class="hljs-title function_">read</span>(refilledPbf);
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;encodeAndReinflate err: &quot;</span> + err);
    <span class="hljs-keyword">throw</span> <span class="hljs-string">&quot;couldn&#x27;t write/read obj. invalid proto description?&quot;</span>;
  }
};

<span class="hljs-comment">// given a Pbf module proto description, create a plain obj with properties</span>
<span class="hljs-comment">// initialized to the fieldnames and default values of that proto.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// throws err if things go wrong.</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">emptyObjFromProto</span>(<span class="hljs-params">protoDesc</span>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">return</span> protoDesc.<span class="hljs-title function_">read</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Pbf</span>());
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;emptyObjFromProto err: &quot;</span> + err);
    <span class="hljs-keyword">throw</span> <span class="hljs-string">&quot;couldn&#x27;t read proto. invalid proto description?&quot;</span>;
  }
};

<span class="hljs-comment">// check if a plain obj conforms to a Pbf module proto description.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// if the object conforms to proto, we return nothing (undefined).</span>
<span class="hljs-comment">// if the object doesn&#x27;t conform to proto, or can&#x27;t be verified, throws err.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// rules for conformance:</span>
<span class="hljs-comment">//   - all obj&#x27;s properties must have a name and type that matches a</span>
<span class="hljs-comment">//       correponding field in the proto message definition.</span>
<span class="hljs-comment">//   - no extraneous properties may be set.</span>
<span class="hljs-comment">//   - obj is allowed to have missing/unset properties (exception: fields</span>
<span class="hljs-comment">//       marked &#x27;required&#x27; in proto must be set. don&#x27;t do this -- use of</span>
<span class="hljs-comment">//       required fields in proto is STRONGLY discouraged.)</span>
<span class="hljs-comment">//   - obj properties may be set to default values that correspond to their</span>
<span class="hljs-comment">//       default values. (strings can be &#x27;&#x27;, objects can be null, booleans can</span>
<span class="hljs-comment">//       be false, int&#x27;s can be 0, etc. (assuming proto3 syntax)).</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">//  protos are checked recursively, so embedded message field obj&#x27;s must also</span>
<span class="hljs-comment">//  pass checks for their proto defs, and so on for embedded message fields of</span>
<span class="hljs-comment">//  those obj&#x27;s.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// example usage:</span>
<span class="hljs-comment">//   try {</span>
<span class="hljs-comment">//     checkProto(MyProto.SomeMessage, obj);</span>
<span class="hljs-comment">//   } catch (err) {</span>
<span class="hljs-comment">//     console.log(&quot;type error, failed proto check: &quot; + err);</span>
<span class="hljs-comment">//     return;</span>
<span class="hljs-comment">//   }</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">checkProto</span>(<span class="hljs-params">protoDesc, obj</span>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// generate another plain object by encoding and reinflating obj as</span>
    <span class="hljs-comment">// proto. the result will have the following properties:</span>
    <span class="hljs-comment">//   1. field names and default values set;</span>
    <span class="hljs-comment">//   2. fields populated in obj remain populated;</span>
    <span class="hljs-comment">//   3. extraneous fields not part of proto definition are removed.</span>
    <span class="hljs-keyword">var</span> reinflated = <span class="hljs-title function_">encodeAndReinflate</span>(protoDesc, obj);  <span class="hljs-comment">// might throw.</span>

    <span class="hljs-comment">// getDiff returns a list of all differences found. empty list means the</span>
    <span class="hljs-comment">// two objects are deeply equal. the objects are compared &#x27;left to right&#x27;,</span>
    <span class="hljs-comment">// order of arguments is important because diff returns more info about additions than deletions.</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// allowed diffs (comparing reinflated ---&gt; obj):</span>
    <span class="hljs-comment">//   &#x27;deleted&#x27; paths: ok. any properties missing from &#x27;obj&#x27; were added</span>
    <span class="hljs-comment">//     during reinflate, so they are proto default values.</span>
    <span class="hljs-comment">//   &#x27;added&#x27; paths: unrecognized properties, never allowed.</span>
    <span class="hljs-comment">//      <span class="hljs-doctag">TODO:</span> consider adding an option for non-strict comparison, allowing</span>
    <span class="hljs-comment">//      extra properties.</span>
    <span class="hljs-comment">//   &#x27;updated&#x27; paths: valid path name, but value was rejected by proto.</span>
    <span class="hljs-comment">//     allow only when the obj value is equivalent to the proto default (ex:</span>
    <span class="hljs-comment">//     null instead of &#x27;&#x27; for a string value).</span>
    <span class="hljs-keyword">var</span> diff = <span class="hljs-title class_">RecursiveDiff</span>.<span class="hljs-title function_">getDiff</span>(reinflated, obj);

    <span class="hljs-comment">// debugging: set true to enable verbose logging for debugging.</span>
    <span class="hljs-comment">// set back to false before submitting.</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-literal">false</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;DEBUG: obj &quot;</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(reinflated));
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;DEBUG: reinflated &quot;</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(reinflated));
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;DEBUG: diff &quot;</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(diff));
    }

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> diff_ind <span class="hljs-keyword">in</span> diff) {
      <span class="hljs-keyword">var</span> d = diff[diff_ind];
      <span class="hljs-keyword">if</span> (d.<span class="hljs-property">op</span> === <span class="hljs-string">&quot;delete&quot;</span>) {
        <span class="hljs-keyword">continue</span>;
      }
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (d.<span class="hljs-property">op</span> === <span class="hljs-string">&quot;update&quot;</span>) {
        <span class="hljs-comment">// context: neo4j driver objects have null for unset strings, while</span>
        <span class="hljs-comment">// proto string fields default to &#x27;&#x27;, so we allow null as a proxy for</span>
        <span class="hljs-comment">// proto defaults.</span>
        <span class="hljs-keyword">if</span> (d.<span class="hljs-property">val</span> === <span class="hljs-literal">null</span>) {
          <span class="hljs-keyword">continue</span>;
        }
        <span class="hljs-comment">// otherwise...</span>
        <span class="hljs-keyword">throw</span> <span class="hljs-string">&quot;unexpected value: &quot;</span> + d.<span class="hljs-property">val</span> + <span class="hljs-string">&quot; at path: &quot;</span> +
          <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(d.<span class="hljs-property">path</span>);
      }
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (d.<span class="hljs-property">op</span> === <span class="hljs-string">&quot;add&quot;</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-string">&quot;unexpected property path: &quot;</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(d.<span class="hljs-property">path</span>);
      }
    }
    <span class="hljs-comment">// nothing to return.</span>
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;checkProto err: &quot;</span> + err);
    <span class="hljs-keyword">throw</span> err;
  }
};

<span class="hljs-comment">// Returns a validator function, to be used with the pocket-dimension service</span>
<span class="hljs-comment">// interface. The returned function takes one plain obj parameter, and returns</span>
<span class="hljs-comment">// true if the obj conforms to the protocol buffer schema expressed by the</span>
<span class="hljs-comment">// pbfEncoder obj, false otherwise. Never throws.</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">buildPbfValidatorFn</span>(<span class="hljs-params">pbfEncoder</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">obj</span>) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-title function_">checkProto</span>(pbfEncoder, obj)
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  compileProto,
  checkProto,
  emptyObjFromProto,
  encodeAndReinflate,
  buildPbfValidatorFn
};
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverframeworkserviceutils.js"><a href="#toc"><a name="server-framework-serviceutils-js">server/framework/serviceUtils.js</a></a></h2>
<pre><code><span class="hljs-comment">// serviceUtils.js</span>
<span class="hljs-keyword">import</span> protoUtils <span class="hljs-keyword">from</span>  <span class="hljs-string">&#x27;./protoUtils&#x27;</span>;
<span class="hljs-keyword">import</span> statusUtils <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./statusUtils&#x27;</span>;

<span class="hljs-comment">// Invokes a local service call without explicit type-checking.</span>
<span class="hljs-comment">// never throws.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// - app is the express &#x27;app&#x27; object.</span>
<span class="hljs-comment">// - handlerFn is a function which takes (app, request_data, response_data),</span>
<span class="hljs-comment">//     populates response_data, and returns a status object, of the type</span>
<span class="hljs-comment">//     created by the helper methods in ./statusUtils.js</span>
<span class="hljs-comment">// - request_data is a plain object representing the request data payload. it</span>
<span class="hljs-comment">//     should conform to the protocol of the RPC&#x27;s &quot;Request&quot; message.</span>
<span class="hljs-comment">// - response_data, if supplied, will be passed in to handlerFn and used to</span>
<span class="hljs-comment">//     contain the data payload of the response. it is the same object which</span>
<span class="hljs-comment">//     appears in the &#x27;data&#x27; property of the return value.</span>
<span class="hljs-keyword">const</span> invokeFlexibleLocalRpcHandler = <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">
    app, handlerFn, request_data, response_data = {}</span>) {
  <span class="hljs-keyword">let</span> response_status;  <span class="hljs-comment">// to contain status, error codes, etc.</span>
  <span class="hljs-keyword">try</span> {
    response_status = <span class="hljs-keyword">await</span> <span class="hljs-title function_">handlerFn</span>(app, request_data, response_data);
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Do something less hokey for error handling.</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;error invoking local service: &quot;</span>, err);
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">error</span>: { <span class="hljs-attr">status</span>: statusUtils.<span class="hljs-title function_">internalErrorStatus</span>() } };
  }

  <span class="hljs-comment">// if the invocation was successful, return response_data directly (no wrapper).</span>
  <span class="hljs-comment">// (if rpcHandler returned nothing, assume status &#x27;OK&#x27;.)</span>
  <span class="hljs-keyword">if</span> (!response_status || statusUtils.<span class="hljs-title function_">isStatusOk</span>(response_status)) {
    <span class="hljs-keyword">return</span> response_data;
  }

  <span class="hljs-comment">// if we&#x27;re here, then the handler fn returned an obj that&#x27;s not an &#x27;OK&#x27;</span>
  <span class="hljs-comment">// status.</span>
  <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">Number</span>.<span class="hljs-title function_">isInteger</span>(response_status.<span class="hljs-property">code</span>)) {
    <span class="hljs-comment">// malformed response status, return INTERNAL_ERROR.</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;error invoking local service; malformed response status: &quot;</span> +
      <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(response_status));
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">error</span>: { <span class="hljs-attr">status</span>: statusUtils.<span class="hljs-title function_">internalErrorStatus</span>() } };
  }

  <span class="hljs-comment">// handler returned a well-formed status representing an error, return it to</span>
  <span class="hljs-comment">// the caller in an &#x27;error&#x27; wrapper.</span>
  <span class="hljs-keyword">return</span> { <span class="hljs-attr">error</span>: { <span class="hljs-attr">status</span>: response_status } };
}

<span class="hljs-comment">// Invoke a local rpc handler, and confirm that the input and output payloads</span>
<span class="hljs-comment">// return &#x27;true&#x27; when passed to their respective validator functions (if present).</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Throws an error if either the passed-in request_data or the populated</span>
<span class="hljs-comment">// response_data breaks from the expected message protocol.</span>
<span class="hljs-keyword">const</span> invokeLocalRpcHandler = <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">
    app, handlerFn, request_validator_fn, response_validator_fn,
    request_data, response_data = {}</span>) {
  <span class="hljs-comment">// ensure that the request_data conforms to expected message protocol.</span>
  <span class="hljs-keyword">if</span> (request_validator_fn) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">request_validator_fn</span>(request_data)) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;Caller supplied invalid request data: &quot;</span>, err);
        <span class="hljs-keyword">return</span> { <span class="hljs-attr">error</span>: { <span class="hljs-attr">status</span>: statusUtils.<span class="hljs-title function_">badRequestStatus</span>() } };
      }
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-comment">// Encountered an exception when attempting to validate.</span>
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;Error when trying to validate request data: &quot;</span>, err);
      <span class="hljs-keyword">return</span> { <span class="hljs-attr">error</span>: { <span class="hljs-attr">status</span>: statusUtils.<span class="hljs-title function_">internalErrorStatus</span>() } };
    }
  }

  <span class="hljs-keyword">const</span> response_or_error = <span class="hljs-keyword">await</span> <span class="hljs-title function_">invokeFlexibleLocalRpcHandler</span>(
      app, handlerFn, request_data, response_data);

  <span class="hljs-comment">// Uncomment to see well-formatted json in the logs for each invoked rpc</span>
  <span class="hljs-comment">// method. Good for demos, good for debugging.</span>
  <span class="hljs-comment">// console.error(&quot;DEBUGGING: ret: &quot; + JSON.stringify(ret, null, 2));</span>

  <span class="hljs-comment">// When the call is successful, &#x27;response_or_error&#x27; refers to the exact same</span>
  <span class="hljs-comment">// object as &#x27;response_data&#x27;.</span>
  <span class="hljs-keyword">if</span> (response_or_error == response_data) {
    <span class="hljs-keyword">if</span> (response_validator_fn) {
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">response_validator_fn</span>(response_data)) {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;Caller supplied invalid response data: &quot;</span>, err);
          <span class="hljs-keyword">return</span> { <span class="hljs-attr">error</span>: { <span class="hljs-attr">status</span>: statusUtils.<span class="hljs-title function_">internalErrorStatus</span>() } };
        }
      } <span class="hljs-keyword">catch</span> (err) {
        <span class="hljs-comment">// Encountered an exception when attempting to validate.</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;Error when trying to validate response data: &quot;</span>, err);
        <span class="hljs-keyword">return</span> { <span class="hljs-attr">error</span>: { <span class="hljs-attr">status</span>: statusUtils.<span class="hljs-title function_">internalErrorStatus</span>() } };
      }
    }
    <span class="hljs-keyword">return</span> response_data;
  }

  <span class="hljs-comment">// if we&#x27;re here, the call invocation returned something other than the</span>
  <span class="hljs-comment">// response_data object, which means we&#x27;re meant to interpret it as a plain</span>
  <span class="hljs-comment">// obj, which should have an &#x27;error&#x27; property that&#x27;s a plain status obj.</span>
  <span class="hljs-keyword">if</span> (!response_or_error.<span class="hljs-property">error</span>
      || !response_or_error.<span class="hljs-property">error</span>.<span class="hljs-property">status</span>
      || !response_or_error.<span class="hljs-property">error</span>.<span class="hljs-property">status</span>.<span class="hljs-property">code</span>) {
    <span class="hljs-comment">// error obj was malformed, return an INTERNAL_ERROR instead.</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;error invoking local service (type-safe); malformed response status: &quot;</span> +
      <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(response_status));
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">error</span>: { <span class="hljs-attr">status</span>: statusUtils.<span class="hljs-title function_">internalErrorStatus</span>() } };
  }

  <span class="hljs-comment">// if we&#x27;re here, the call invocation returned a well-formed error wrapper</span>
  <span class="hljs-comment">// obj. return it to the caller.</span>
  <span class="hljs-keyword">return</span> response_or_error;
}

<span class="hljs-comment">// Invokes a service call locally, based on the info in the passed-in service</span>
<span class="hljs-comment">// obj. If the service obj contains a description of the message protocol to be</span>
<span class="hljs-comment">// used for the given method&#x27;s request and response payloads, then those</span>
<span class="hljs-comment">// message protocols are enforced with checkProto.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Example usage:</span>
<span class="hljs-comment">//   let result = await invokeLocalServiceCall(</span>
<span class="hljs-comment">//       app, queryService, &quot;BusinessEntityIndexSearch&quot;, request_data);</span>
<span class="hljs-comment">//   if (result.meta.status.code !== 200) {</span>
<span class="hljs-comment">//     // bad. throw error.</span>
<span class="hljs-comment">//   }</span>
<span class="hljs-comment">//   let response_data = result.data;</span>
<span class="hljs-keyword">const</span> invokeLocalServiceCall = <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">
    app, service, methodName, request_data, response_data = {}</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">invokeLocalRpcHandler</span>(
    app,
    service.<span class="hljs-property">handlers</span>[methodName],
    service.<span class="hljs-property">requestValidators</span>[methodName],
    service.<span class="hljs-property">responseValidators</span>[methodName],
    request_data, response_data);
}

<span class="hljs-comment">// To be called during app setup. Example usage:</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// const service = {};</span>
<span class="hljs-comment">// registerHandlerCallback(</span>
<span class="hljs-comment">//   service, &quot;ParcelIndexSearch&quot;, parcelSearchFn,</span>
<span class="hljs-comment">//   parcelSearchRequestValidatorFn, parcelSearchResponseValidatorFn);</span>
<span class="hljs-comment">// // and so on for other methods on the service....</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// request_validator_fn and request_encoder_fn are functions which will be</span>
<span class="hljs-comment">// invoked with a single plain obj parameter, the request_data or response_data</span>
<span class="hljs-comment">// of a service call (respectively).</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// If supplied, the validator functions must return a boolean -- true if the</span>
<span class="hljs-comment">// data passes validation, false otherwise.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// To generate a flexible (non-type-safe) service handler, invoke this function</span>
<span class="hljs-comment">// without specifying request_validator_fn or response_validator_fn.</span>
<span class="hljs-keyword">const</span> registerHandlerCallback = <span class="hljs-keyword">function</span>(<span class="hljs-params">service, methodName, handlerFn,
    request_validator_fn = <span class="hljs-literal">null</span>, response_validator_fn = <span class="hljs-literal">null</span></span>) {
  <span class="hljs-keyword">if</span> (!methodName || <span class="hljs-keyword">typeof</span> methodName !== <span class="hljs-string">&quot;string&quot;</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-string">&quot;expected non-empty string methodName, found: &quot;</span> + methodName;
  }
  <span class="hljs-keyword">if</span> (!service.<span class="hljs-property">handlers</span>) { service.<span class="hljs-property">handlers</span> = {}; }
  <span class="hljs-keyword">if</span> (!service.<span class="hljs-property">requestValidators</span>) { service.<span class="hljs-property">requestValidators</span> = {}; }
  <span class="hljs-keyword">if</span> (!service.<span class="hljs-property">responseValidators</span>) { service.<span class="hljs-property">responseValidators</span> = {}; }

  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Set these in such a way that they can&#x27;t be overwritten.</span>
  service.<span class="hljs-property">handlers</span>[methodName] = handlerFn;
  <span class="hljs-keyword">if</span> (request_validator_fn) {
    service.<span class="hljs-property">requestValidators</span>[methodName] = request_validator_fn;
  }
  <span class="hljs-keyword">if</span> (response_validator_fn) {
    service.<span class="hljs-property">responseValidators</span>[methodName] = response_validator_fn;
  }
}


<span class="hljs-comment">// Given a result value returned from an &#x27;invoke&#x27; function above, return true</span>
<span class="hljs-comment">// if the result represents a response_data payload from a successful call.</span>
<span class="hljs-comment">// Return false otherwise.</span>
<span class="hljs-keyword">const</span> isResultOk = <span class="hljs-keyword">function</span>(<span class="hljs-params">result</span>) {
  <span class="hljs-keyword">if</span> (!result) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> result !== <span class="hljs-string">&quot;object&quot;</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">if</span> (result.<span class="hljs-property">error</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;

  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
}

<span class="hljs-comment">// Returns a convenient object wrapper for the service functionality defined</span>
<span class="hljs-comment">// above, to provide a terser syntax for callers.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// usage:</span>
<span class="hljs-comment">// during application setup:</span>
<span class="hljs-comment">//   const handler = buildServiceHandler(&quot;FooService&quot;);</span>
<span class="hljs-comment">//   handler.registerCallback(&quot;Method1&quot;, method1Handler, ...);</span>
<span class="hljs-comment">//   </span>
<span class="hljs-comment">// later:</span>
<span class="hljs-comment">//   const result_or_error = await handler.invoke(app, &quot;Method1&quot;, request_data);</span>
<span class="hljs-comment">//   if (!isResultOk(result_or_error)) {</span>
<span class="hljs-comment">//     // Handle error and return.</span>
<span class="hljs-comment">//     return;</span>
<span class="hljs-comment">//   }</span>
<span class="hljs-comment">//   // If you&#x27;re here, result_or_error contains the response_data as set by</span>
<span class="hljs-comment">//   // the service&#x27;s method2Handler callback fn.</span>
<span class="hljs-keyword">const</span> buildServiceHandler = <span class="hljs-keyword">function</span>(<span class="hljs-params">serviceName</span>) {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">name</span>: serviceName,
    <span class="hljs-attr">invoke</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">app, methodName, request_data, response_data</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">invokeLocalServiceCall</span>(app, <span class="hljs-variable language_">this</span>, methodName, request_data, response_data);
    },
    <span class="hljs-attr">registerCallback</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">
        methodName, handlerFn, request_validator_fn, response_validator_fn</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">registerHandlerCallback</span>(
        <span class="hljs-variable language_">this</span>, methodName, handlerFn, request_validator_fn, response_validator_fn);
    }
  }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  invokeFlexibleLocalRpcHandler,
  invokeLocalRpcHandler,
  invokeLocalServiceCall,
  registerHandlerCallback,
  isResultOk,
  buildServiceHandler
};
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverframeworkstatusutils.js"><a href="#toc"><a name="server-framework-statusutils-js">server/framework/statusUtils.js</a></a></h2>
<pre><code><span class="hljs-comment">// statusUtils.js</span>

<span class="hljs-comment">// Creates a &#x27;status&#x27; object used to represent a successful call.</span>
<span class="hljs-keyword">const</span> okStatus = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">return</span> { <span class="hljs-attr">code</span>: <span class="hljs-number">200</span> }
}

<span class="hljs-comment">// Creates a &#x27;status&#x27; object used to represent an error case, with a numeric</span>
<span class="hljs-comment">// code and an optional string message.</span>
<span class="hljs-keyword">const</span> errorStatus = <span class="hljs-keyword">function</span>(<span class="hljs-params">code, message</span>) {
  <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">Number</span>.<span class="hljs-title function_">isInteger</span>(code)) {
    <span class="hljs-keyword">throw</span> <span class="hljs-string">&quot;expected integer code, found: &quot;</span> + code;
  }

  <span class="hljs-keyword">if</span> (message &amp;&amp; <span class="hljs-keyword">typeof</span> message !== <span class="hljs-string">&quot;string&quot;</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-string">&quot;expected string message, found: &quot;</span> + message
  }

  <span class="hljs-keyword">const</span> ret = { <span class="hljs-attr">code</span>: code };
  <span class="hljs-keyword">if</span> (message) {
    ret.<span class="hljs-property">message</span> = message;
  }
  <span class="hljs-keyword">return</span> ret;
}

<span class="hljs-comment">// Creates a &#x27;status&#x27; object representing &#x27;Bad Request&#x27; (code 400), with an</span>
<span class="hljs-comment">// optional string message.</span>
<span class="hljs-keyword">const</span> badRequestStatus = <span class="hljs-keyword">function</span>(<span class="hljs-params">message</span>) {
  <span class="hljs-keyword">if</span> (!message) { message = <span class="hljs-string">&quot;BAD_REQUEST&quot;</span>; }
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">errorStatus</span>(<span class="hljs-number">400</span>, message);
}

<span class="hljs-comment">// Creates a &#x27;status&#x27; object representing &#x27;Internal Error&#x27; (code 500), with an</span>
<span class="hljs-comment">// optional string message.</span>
<span class="hljs-keyword">const</span> internalErrorStatus = <span class="hljs-keyword">function</span>(<span class="hljs-params">message</span>) {
  <span class="hljs-keyword">if</span> (!message) { message = <span class="hljs-string">&quot;INTERNAL_ERROR&quot;</span>; }
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">errorStatus</span>(<span class="hljs-number">500</span>, message);
}

<span class="hljs-comment">// Creates a &#x27;status&#x27; object representing &#x27;Not Implemented&#x27; (code 501), with an</span>
<span class="hljs-comment">// optional string message.</span>
<span class="hljs-keyword">const</span> notImplementedStatus = <span class="hljs-keyword">function</span>(<span class="hljs-params">message</span>) {
  <span class="hljs-keyword">if</span> (!message) { message = <span class="hljs-string">&quot;NOT_IMPLEMENTED&quot;</span>; }
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">errorStatus</span>(<span class="hljs-number">501</span>, message);
}

<span class="hljs-comment">// Returns true if the status obj represents an &#x27;OK&#x27; status, false otherwise.</span>
<span class="hljs-keyword">const</span> isStatusOk = <span class="hljs-keyword">function</span>(<span class="hljs-params">status</span>) {
  <span class="hljs-keyword">if</span> (!status) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">return</span> status.<span class="hljs-property">code</span> === <span class="hljs-number">200</span>;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  okStatus,
  errorStatus,
  badRequestStatus,
  internalErrorStatus,
  notImplementedStatus,
  isStatusOk
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverindex.js"><a href="#toc"><a name="server-index-js">server/index.js</a></a></h2>
<pre><code><span class="hljs-regexp">//</span> import dotenv from <span class="hljs-string">&#x27;dotenv&#x27;</span>; <span class="hljs-regexp">//</span>replace with docker compose env
import express from <span class="hljs-string">&#x27;express&#x27;</span>;
import rest from <span class="hljs-string">&#x27;./rest/server/rest&#x27;</span>;

<span class="hljs-regexp">//</span> Set environment variables from .env
<span class="hljs-regexp">//</span> dotenv.config();
<span class="hljs-regexp">//</span>constants from .env
<span class="hljs-regexp">//</span>const REST_PORT = process.env.REST_LISTEN_PORT;
const REST_PORT = process.env.REST_PORT; <span class="hljs-regexp">//</span> from Docker instead of .env
const COOKIE_KEY = process.env.COOKIE_KEY;

<span class="hljs-regexp">//</span>servers
const restApp = express();

<span class="hljs-regexp">//</span>servers
rest(restApp, COOKIE_KEY, REST_PORT);

</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverpackage.json"><a href="#toc"><a name="server-package-json">server/package.json</a></a></h2>
<pre><code>{
  <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;sftool-server&quot;</span>,
  <span class="hljs-string">&quot;version&quot;</span>: <span class="hljs-string">&quot;1.0.0&quot;</span>,
  <span class="hljs-string">&quot;description&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,
  <span class="hljs-string">&quot;main&quot;</span>: <span class="hljs-string">&quot;index.js&quot;</span>,
  <span class="hljs-string">&quot;scripts&quot;</span>: {
    <span class="hljs-string">&quot;start&quot;</span>: <span class="hljs-string">&quot;node -r esm index.js&quot;</span>,
    <span class="hljs-string">&quot;dev&quot;</span>: <span class="hljs-string">&quot;nodemon -r esm index.js&quot;</span>,
    <span class="hljs-string">&quot;test&quot;</span>: <span class="hljs-string">&quot;mocha --require esm --reporter spec&quot;</span>
  },
  <span class="hljs-string">&quot;repository&quot;</span>: {
    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;git&quot;</span>,
    <span class="hljs-string">&quot;url&quot;</span>: <span class="hljs-string">&quot;git+https://github.com/arghgr/sftool-server.git&quot;</span>
  },
  <span class="hljs-string">&quot;author&quot;</span>: <span class="hljs-string">&quot;aemp&quot;</span>,
  <span class="hljs-string">&quot;license&quot;</span>: <span class="hljs-string">&quot;ISC&quot;</span>,
  <span class="hljs-string">&quot;bugs&quot;</span>: {
    <span class="hljs-string">&quot;url&quot;</span>: <span class="hljs-string">&quot;https://github.com/arghgr/sftool-server/issues&quot;</span>
  },
  <span class="hljs-string">&quot;homepage&quot;</span>: <span class="hljs-string">&quot;https://github.com/arghgr/sftool-server<span class="hljs-subst">#readme</span>&quot;</span>,
  <span class="hljs-string">&quot;dependencies&quot;</span>: {
    <span class="hljs-string">&quot;ajv&quot;</span>: <span class="hljs-string">&quot;^8.5.0&quot;</span>,
    <span class="hljs-string">&quot;apollo-server-express&quot;</span>: <span class="hljs-string">&quot;^2.19.0&quot;</span>,
    <span class="hljs-string">&quot;babel-plugin-transform-runtime&quot;</span>: <span class="hljs-string">&quot;^6.23.0&quot;</span>,
    <span class="hljs-string">&quot;cookie-session&quot;</span>: <span class="hljs-string">&quot;^1.3.3&quot;</span>,
    <span class="hljs-string">&quot;cors&quot;</span>: <span class="hljs-string">&quot;^2.8.5&quot;</span>,
    <span class="hljs-string">&quot;d3&quot;</span>: <span class="hljs-string">&quot;^5.0.0&quot;</span>,
    <span class="hljs-string">&quot;dotenv&quot;</span>: <span class="hljs-string">&quot;^8.0.0&quot;</span>,
    <span class="hljs-string">&quot;esm&quot;</span>: <span class="hljs-string">&quot;^3.2.25&quot;</span>,
    <span class="hljs-string">&quot;express&quot;</span>: <span class="hljs-string">&quot;^4.17.1&quot;</span>,
    <span class="hljs-string">&quot;express-graphql&quot;</span>: <span class="hljs-string">&quot;^0.9.0&quot;</span>,
    <span class="hljs-string">&quot;express-ipfilter&quot;</span>: <span class="hljs-string">&quot;^1.1.0&quot;</span>,
    <span class="hljs-string">&quot;express-rate-limit&quot;</span>: <span class="hljs-string">&quot;^5.0.0&quot;</span>,
    <span class="hljs-string">&quot;helmet&quot;</span>: <span class="hljs-string">&quot;^3.21.1&quot;</span>,
    <span class="hljs-string">&quot;memory-cache&quot;</span>: <span class="hljs-string">&quot;^0.2.0&quot;</span>,
    <span class="hljs-string">&quot;neo4j-driver&quot;</span>: <span class="hljs-string">&quot;^4.2.2&quot;</span>,
    <span class="hljs-string">&quot;path&quot;</span>: <span class="hljs-string">&quot;^0.12.7&quot;</span>,
    <span class="hljs-string">&quot;pbf&quot;</span>: <span class="hljs-string">&quot;^3.2.1&quot;</span>,
    <span class="hljs-string">&quot;recursive-diff&quot;</span>: <span class="hljs-string">&quot;^1.0.8&quot;</span>,
    <span class="hljs-string">&quot;request&quot;</span>: <span class="hljs-string">&quot;^2.88.0&quot;</span>,
    <span class="hljs-string">&quot;resolve-protobuf-schema&quot;</span>: <span class="hljs-string">&quot;^2.1.0&quot;</span>
  },
  <span class="hljs-string">&quot;devDependencies&quot;</span>: {
    <span class="hljs-string">&quot;jest&quot;</span>: <span class="hljs-string">&quot;^26.6.3&quot;</span>,
    <span class="hljs-string">&quot;mocha&quot;</span>: <span class="hljs-string">&quot;^8.3.1&quot;</span>,
    <span class="hljs-string">&quot;nodemon&quot;</span>: <span class="hljs-string">&quot;^1.19.4&quot;</span>,
    <span class="hljs-string">&quot;supertest&quot;</span>: <span class="hljs-string">&quot;^6.0.1&quot;</span>
  },
  <span class="hljs-string">&quot;jest&quot;</span>: {
    <span class="hljs-string">&quot;testEnvironment&quot;</span>: <span class="hljs-string">&quot;node&quot;</span>,
    <span class="hljs-string">&quot;coveragePathIgnorePatterns&quot;</span>: [
      <span class="hljs-string">&quot;/node_modules/&quot;</span>
    ]
  }
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverresthandlersqueryaboutassessor.js"><a href="#toc"><a name="server-rest-handlers-query-about-assessor-js">server/rest/handlers/query/about/assessor.js</a></a></h2>
<pre><code><span class="hljs-comment">// about/assessor.js</span>

<span class="hljs-keyword">const</span> query = <span class="hljs-string">`
MATCH (n:Metadata)
RETURN {
    source_name: &quot;San Francisco Assessor Office&quot;,
    date_exported: n.sf_assessor
}`</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">assessorSourceQueryHandler</span>(<span class="hljs-params">app</span>) {
  <span class="hljs-keyword">const</span> session = app.<span class="hljs-property">locals</span>.<span class="hljs-property">neo4jDriver</span>.<span class="hljs-title function_">session</span>();
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> session.<span class="hljs-title function_">run</span>(query, {});
    <span class="hljs-keyword">return</span> (result.<span class="hljs-property">records</span>[<span class="hljs-number">0</span>] || []).<span class="hljs-title function_">get</span>(<span class="hljs-number">0</span>);
  } <span class="hljs-keyword">finally</span> {
    <span class="hljs-keyword">await</span> session.<span class="hljs-title function_">close</span>();
  }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  assessorSourceQueryHandler
};
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverresthandlersqueryaboutbusiness.js"><a href="#toc"><a name="server-rest-handlers-query-about-business-js">server/rest/handlers/query/about/business.js</a></a></h2>
<pre><code><span class="hljs-comment">// about/business.js</span>

<span class="hljs-keyword">const</span> query = <span class="hljs-string">`
MATCH (n:Metadata)
RETURN {
    source_name: &quot;California Secretary of State&quot;,
    date_exported: n.ca_businesses
}`</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">businessSourceQueryHandler</span>(<span class="hljs-params">app</span>) {
  <span class="hljs-keyword">const</span> session = app.<span class="hljs-property">locals</span>.<span class="hljs-property">neo4jDriver</span>.<span class="hljs-title function_">session</span>();
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> session.<span class="hljs-title function_">run</span>(query, {});
    <span class="hljs-keyword">return</span> (result.<span class="hljs-property">records</span>[<span class="hljs-number">0</span>] || []).<span class="hljs-title function_">get</span>(<span class="hljs-number">0</span>);
  } <span class="hljs-keyword">finally</span> {
    <span class="hljs-keyword">await</span> session.<span class="hljs-title function_">close</span>();
  }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  businessSourceQueryHandler
};
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverresthandlersqueryabouteviction.js"><a href="#toc"><a name="server-rest-handlers-query-about-eviction-js">server/rest/handlers/query/about/eviction.js</a></a></h2>
<pre><code><span class="hljs-comment">// about/eviction.js</span>

<span class="hljs-keyword">const</span> query = <span class="hljs-string">`
MATCH (n:Metadata)
RETURN {
    source_name: &quot;San Francisco Rent Board&quot;,
    date_exported: n.sf_evictions
}`</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">evictionSourceQueryHandler</span>(<span class="hljs-params">app</span>) {
  <span class="hljs-keyword">const</span> session = app.<span class="hljs-property">locals</span>.<span class="hljs-property">neo4jDriver</span>.<span class="hljs-title function_">session</span>();
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> session.<span class="hljs-title function_">run</span>(query, {});
    <span class="hljs-keyword">return</span> (result.<span class="hljs-property">records</span>[<span class="hljs-number">0</span>] || []).<span class="hljs-title function_">get</span>(<span class="hljs-number">0</span>);
  } <span class="hljs-keyword">finally</span> {
    <span class="hljs-keyword">await</span> session.<span class="hljs-title function_">close</span>();
  }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  evictionSourceQueryHandler
};
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverresthandlersqueryindex.js"><a href="#toc"><a name="server-rest-handlers-query-index-js">server/rest/handlers/query/index.js</a></a></h2>
<pre><code><span class="hljs-comment">// Collects functions that implement the query abstraction layer for ebook api.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Map of query handler functions, to be passed in to the rest listeners via</span>
<span class="hljs-comment">// app.locals.</span>
<span class="hljs-comment">// </span>
<span class="hljs-comment">// This has the advantage of allowing dependency injection -- a set of mock</span>
<span class="hljs-comment">// handlers can be passed in instead, for use in a unit test harness.</span>

<span class="hljs-keyword">import</span> { parcelDetailsQueryHandler } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./parcel/details&#x27;</span>;
<span class="hljs-keyword">import</span> { parcelEvictionsQueryHandler } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./parcel/evictions&#x27;</span>;
<span class="hljs-keyword">import</span> { parcelPortfolioQueryHandler } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./parcel/portfolio&#x27;</span>;
<span class="hljs-keyword">import</span> { parcelOwnersQueryHandler } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./parcel/owners&#x27;</span>;
<span class="hljs-keyword">import</span> { parcelNetworkDetailsQueryHandler } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./parcel/networkDetails&#x27;</span>;
<span class="hljs-keyword">import</span> { parcelRelatedNetworksQueryHandler } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./parcel/relatedNetworks&#x27;</span>;
<span class="hljs-keyword">import</span> { ownerDetailsQueryHandler } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./owner/details&#x27;</span>;
<span class="hljs-keyword">import</span> { ownerEvictionsQueryHandler } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./owner/evictions&#x27;</span>;
<span class="hljs-keyword">import</span> { ownerPortfolioQueryHandler } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./owner/portfolio&#x27;</span>;
<span class="hljs-keyword">import</span> { ownerNetworkDetailsQueryHandler } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./owner/networkDetails&#x27;</span>;
<span class="hljs-keyword">import</span> { ownerRelatedNetworksQueryHandler } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./owner/relatedNetworks&#x27;</span>;
<span class="hljs-keyword">import</span> { neighborhoodEvictionsQueryHandler } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./neighborhood/evictions&#x27;</span>;
<span class="hljs-keyword">import</span> { searchQueryHandler } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./search/search&#x27;</span>;
<span class="hljs-keyword">import</span> { networkGraphQueryHandler }  <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./network/graph&#x27;</span>;
<span class="hljs-keyword">import</span> { networkDetailsQueryHandler }  <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./network/details&#x27;</span>;
<span class="hljs-keyword">import</span> { networkNodesQueryHandler }  <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./network/nodes&#x27;</span>;
<span class="hljs-keyword">import</span> { networkPortfolioQueryHandler }  <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./network/portfolio&#x27;</span>;
<span class="hljs-keyword">import</span> { networkRelatedNetworksQueryHandler }  <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./network/relatedNetworks&#x27;</span>;
<span class="hljs-keyword">import</span> { evictionSourceQueryHandler }  <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./about/eviction&#x27;</span>;
<span class="hljs-keyword">import</span> { assessorSourceQueryHandler }  <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./about/assessor&#x27;</span>;
<span class="hljs-keyword">import</span> { businessSourceQueryHandler }  <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./about/business&#x27;</span>;

<span class="hljs-keyword">const</span> queryHandlers = {
  <span class="hljs-string">&quot;networkGraph&quot;</span>: networkGraphQueryHandler,
  <span class="hljs-string">&quot;networkDetails&quot;</span>: networkDetailsQueryHandler,
  <span class="hljs-string">&quot;networkPortfolio&quot;</span>: networkPortfolioQueryHandler,
  <span class="hljs-string">&quot;networkNodes&quot;</span>: networkNodesQueryHandler,
  <span class="hljs-string">&quot;networkRelatedNetworks&quot;</span>: networkRelatedNetworksQueryHandler,
  <span class="hljs-string">&quot;parcelDetails&quot;</span>: parcelDetailsQueryHandler,
  <span class="hljs-string">&quot;parcelEvictions&quot;</span>: parcelEvictionsQueryHandler,
  <span class="hljs-string">&quot;parcelPortfolio&quot;</span>: parcelPortfolioQueryHandler,
  <span class="hljs-string">&quot;parcelOwners&quot;</span>: parcelOwnersQueryHandler,
  <span class="hljs-string">&quot;parcelNetworkDetails&quot;</span>: parcelNetworkDetailsQueryHandler,
  <span class="hljs-string">&quot;parcelRelatedNetworks&quot;</span>: parcelRelatedNetworksQueryHandler,
  <span class="hljs-string">&quot;ownerDetails&quot;</span>: ownerDetailsQueryHandler,
  <span class="hljs-string">&quot;ownerEvictions&quot;</span>: ownerEvictionsQueryHandler,
  <span class="hljs-string">&quot;ownerPortfolio&quot;</span>: ownerPortfolioQueryHandler,
  <span class="hljs-string">&quot;ownerNetworkDetails&quot;</span>: ownerNetworkDetailsQueryHandler,
  <span class="hljs-string">&quot;ownerRelatedNetworks&quot;</span>: ownerRelatedNetworksQueryHandler,
  <span class="hljs-string">&quot;neighborhoodEvictions&quot;</span>: neighborhoodEvictionsQueryHandler,
  <span class="hljs-string">&quot;search&quot;</span>: searchQueryHandler,
  <span class="hljs-string">&quot;evictionSource&quot;</span>: evictionSourceQueryHandler,
  <span class="hljs-string">&quot;assessorSource&quot;</span>: assessorSourceQueryHandler,
  <span class="hljs-string">&quot;businessSource&quot;</span>: businessSourceQueryHandler
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> queryHandlers;
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverresthandlersqueryneighborhoodevictions.js"><a href="#toc"><a name="server-rest-handlers-query-neighborhood-evictions-js">server/rest/handlers/query/neighborhood/evictions.js</a></a></h2>
<pre><code><span class="hljs-comment">// neighborhood.js</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// query runner backing &#x27;/api/neighborhood/&#x27; routes.</span>

<span class="hljs-comment">// string representing cypher query template.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// given the name of a neighborhood in san francisco, retrieves detailed</span>
<span class="hljs-comment">// information about all the evictions from evictorbook datastore which occured</span>
<span class="hljs-comment">// within that neighborhood&#x27;s boundaries.</span>

<span class="hljs-comment">// need to:</span>
<span class="hljs-comment">//    - only show a single row for each eviction (e.g. if an eviction is matched</span>
<span class="hljs-comment">//      to multiple addresses, some of which are in the neighborhood, need to </span>
<span class="hljs-comment">//      pick just one of the addresses in the neighborhood, and also show</span>
<span class="hljs-comment">//      how many addresses in total were matched to the eviction).</span>
<span class="hljs-comment">//    - show the evictor from the sales transfer data, and also create a list </span>
<span class="hljs-comment">//      of the other evictors found on the eviction petition</span>
const query = `
  <span class="hljs-comment">// first look up all evictions associated with properties in the neighborhood</span>
  MATCH (p:A_Parcel)-[r_eviction]-(eviction:RB_Eviction)
  WHERE p.neighborhood = $neighborhood

  <span class="hljs-comment">// each eviction may be associated with multiple properties. pick one that </span>
  <span class="hljs-comment">// is in the neighborhood</span>

  <span class="hljs-comment">// look up all of the properies associated with each eviction (in the neighborhood)</span>
  <span class="hljs-comment">// count all parcels and pick one to display</span>
  OPTIONAL MATCH (eviction)-[:EVICTION_AT]-(parc:A_Parcel)
  WHERE parc.neighborhood = $neighborhood
  WITH eviction, <span class="hljs-keyword">CASE</span> WHEN parc IS <span class="hljs-keyword">NULL</span> THEN <span class="hljs-number">0</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-keyword">COUNT</span>(DISTINCT parc) - <span class="hljs-number">1</span> END AS num_other_parc, <span class="hljs-keyword">COLLECT</span>(parc)[<span class="hljs-number">0</span>] AS display_parc

  <span class="hljs-comment">// now that we have a single parcel for each eviction, look up the relationship again</span>
  OPTIONAL MATCH (eviction)-[rel_eviction:EVICTION_AT]-(display_parc)

  <span class="hljs-comment">// identify the evictor from sales transfer data</span>
  OPTIONAL MATCH (evictor:RB_Evictor)-[rel_evictor:EVICTED_BY]-(eviction)
  WHERE rel_evictor.evictor_origin = <span class="hljs-string">&quot;SALES_TRANSFER&quot;</span>

  <span class="hljs-comment">// identify additional evictors associated with eviction petition</span>
  OPTIONAL MATCH (extra_evictor:RB_Evictor)-[rel_extra_evictor:EVICTED_BY]-(eviction)
  WHERE rel_extra_evictor.evictor_origin &lt;&gt; <span class="hljs-string">&quot;SALES_TRANSFER&quot;</span>

  WITH display_parc, eviction, num_other_parc, rel_eviction, evictor, <span class="hljs-keyword">CASE</span> WHEN extra_evictor IS <span class="hljs-keyword">NULL</span> THEN [] <span class="hljs-keyword">ELSE</span> <span class="hljs-keyword">COLLECT</span>({
    evictor_name: extra_evictor.evictor,
    <span class="hljs-keyword">source</span>: rel_extra_evictor.evictor_origin
  }) END AS extra_evictors

  OPTIONAL MATCH (evictor)-[:BE_LINKED_TO]-(be_evictor)

  <span class="hljs-comment">// look up the main address to display </span>
  OPTIONAL MATCH (display_parc)-[{ <span class="hljs-keyword">source</span>: <span class="hljs-string">&quot;ASSESSOR&quot;</span>}]-(assess_addr:Parcel_Address) <span class="hljs-comment">// first try to look up the parcel address from assessor</span>
  WITH DISTINCT display_parc, eviction, num_other_parc, rel_eviction, evictor, extra_evictors, be_evictor, <span class="hljs-keyword">CASE</span> WHEN NOT assess_addr IS <span class="hljs-keyword">NULL</span> THEN assess_addr.addr <span class="hljs-keyword">ELSE</span> <span class="hljs-keyword">NULL</span> END AS assessor_addr 

  OPTIONAL MATCH (display_parc)-[{ <span class="hljs-keyword">source</span>: <span class="hljs-string">&quot;EAS&quot;</span>}]-(alt_addr:Parcel_Address) <span class="hljs-comment">// look up an alternate address in case there is none</span>
  WITH DISTINCT display_parc, eviction, num_other_parc, rel_eviction, evictor, extra_evictors, be_evictor, assessor_addr, <span class="hljs-keyword">CASE</span> WHEN NOT alt_addr IS <span class="hljs-keyword">NULL</span> THEN <span class="hljs-keyword">COLLECT</span>(alt_addr)[<span class="hljs-number">0</span>].addr <span class="hljs-keyword">ELSE</span> <span class="hljs-keyword">NULL</span> END AS alt_addr 

  <span class="hljs-comment">// use assessor address if present, otherwise alternative address</span>
  WITH DISTINCT display_parc, eviction, num_other_parc, rel_eviction, evictor, extra_evictors, be_evictor, <span class="hljs-keyword">CASE</span> WHEN assessor_addr IS <span class="hljs-keyword">NULL</span> THEN alt_addr <span class="hljs-keyword">ELSE</span> assessor_addr END AS display_addr 

  <span class="hljs-keyword">RETURN</span> {
    evict_id: eviction.evict_id,
    evict_date: eviction.evict_date,
    evict_addr_orig: eviction.addr_orig,
    units: TOFLOAT(display_parc.units),
    type: eviction.type,
    lat: TOFLOAT(display_parc.lat),
    <span class="hljs-keyword">long</span>: TOFLOAT(display_parc.<span class="hljs-keyword">long</span>),
    addr: display_parc.addr,
    block_lot: display_parc.block_lot,
    num_other_parc: num_other_parc,
    primary_evictor: {
      name: evictor.evictor,
      linked_be: <span class="hljs-keyword">CASE</span> WHEN be_evictor IS <span class="hljs-keyword">NULL</span> THEN <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">ELSE</span> {
          __typename: LABELS(be_evictor)[<span class="hljs-number">0</span>],
          network_id: be_evictor.network_id
      } END
    },
    extra_evictors: extra_evictors,
    match_quality: {
      did_subdivision_occur: rel_eviction.eviction_type,
      addr_match_method: rel_eviction.addr_match_type
    }
  }
  ORDER BY eviction.evict_date DESC
  SKIP <span class="hljs-keyword">TOINTEGER</span>($skip)
  LIMIT <span class="hljs-keyword">TOINTEGER</span>($<span class="hljs-keyword">size</span>)
`;

<span class="hljs-comment">// queryHandler callback. implements query for GetEvictionsByNeighborhood.</span>
<span class="hljs-comment">//  uri: &#x27;/api/neighborhood/:neighborhood/evictions&#x27;,</span>
<span class="hljs-comment">//       &#x27;/api/neighborhood/:neighborhood/evictions/:page&#x27;</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// returns an object with propety &#x27;evictions&#x27; set to a list of evictions.</span>
<span class="hljs-comment">// evictions conform to QueryProto.SFRBEvictionMetadata.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// inputs:</span>
<span class="hljs-comment">//   neighborhood - a string representing the name of a neighborhood in sf,</span>
<span class="hljs-comment">//     exactly as it appears in the graph datastore.</span>
<span class="hljs-comment">//   size - integer &lt; 0, the number of results to return.</span>
<span class="hljs-comment">//   page - integer &lt; 0, described which &#x27;page&#x27; of results to return (1 for the</span>
<span class="hljs-comment">//     first N results, 2 for the second N results, etc., where N is &#x27;size&#x27;).</span>
export async function neighborhoodEvictionsQueryHandler(
    app, neighborhood, page = <span class="hljs-number">1</span>, <span class="hljs-keyword">size</span> = <span class="hljs-number">100</span>) {
  <span class="hljs-comment">// validate input params.</span>

  <span class="hljs-comment">// <span class="hljs-doctag">note:</span> isInteger does an explicit type-check; it does not support</span>
  <span class="hljs-comment">// string-to-number conversion.</span>
  <span class="hljs-keyword">if</span> (!Number.isInteger(page) || (page &lt;= <span class="hljs-number">0</span>)) {
    <span class="hljs-keyword">throw</span> <span class="hljs-string">&quot;neighborhood: bad page, expected integer &gt; 0 got: &quot;</span> +
        page + <span class="hljs-string">&quot; with type &quot;</span> + typeof page;
  }
  <span class="hljs-keyword">if</span> (!Number.isInteger(<span class="hljs-keyword">size</span>) || (page &lt;= <span class="hljs-number">0</span>)) {
    <span class="hljs-keyword">throw</span> <span class="hljs-string">&quot;neighborhood: bad size, expected integer &gt; 0, got: &quot;</span> +
        <span class="hljs-keyword">size</span> + <span class="hljs-string">&quot; with type &quot;</span> + typeof <span class="hljs-keyword">size</span>;
  }
  <span class="hljs-keyword">if</span> (!neighborhood || typeof neighborhood !== <span class="hljs-string">&quot;string&quot;</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-string">&quot;neighborhod: bad name, expected string, got type: &quot;</span> +
        typeof neighborhood;
  }

  <span class="hljs-comment">// query:</span>
  const session = app.locals.neo4jDriver.session();
  <span class="hljs-keyword">try</span> {
    const skip = (page - <span class="hljs-number">1</span>) * <span class="hljs-keyword">size</span>;  <span class="hljs-comment">// no. of results to skip in query.</span>
    const queryResponse = await session.run(query, { neighborhood, skip, <span class="hljs-keyword">size</span> });

    const responseList = [];
    <span class="hljs-keyword">for</span> (const record_ind in queryResponse.records) {
      const record = queryResponse.records[record_ind];
      responseList.<span class="hljs-keyword">push</span>(record.get(<span class="hljs-number">0</span>));
    }
    <span class="hljs-keyword">return</span> responseList;
  } <span class="hljs-keyword">finally</span> {
    await session.close();
  }
}

export <span class="hljs-keyword">default</span> {
  neighborhoodEvictionsQueryHandler
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverresthandlersquerynetworkdetails.js"><a href="#toc"><a name="server-rest-handlers-query-network-details-js">server/rest/handlers/query/network/details.js</a></a></h2>
<pre><code><span class="hljs-comment">// network/details.js</span>

<span class="hljs-keyword">const</span> details_query = `
<span class="hljs-comment">// get total BEs</span>
OPTIONAL <span class="hljs-keyword">MATCH</span> (n:SOS_LP) 
WHERE n.network_id = <span class="hljs-variable">$network_id</span>
WITH <span class="hljs-keyword">CASE</span> WHEN n IS <span class="hljs-literal">NULL</span> THEN <span class="hljs-number">0</span> <span class="hljs-keyword">ELSE</span> COUNT(n) END <span class="hljs-keyword">AS</span> num_lp
OPTIONAL <span class="hljs-keyword">MATCH</span> (n:SOS_Corp) 
WHERE n.network_id = <span class="hljs-variable">$network_id</span>
WITH <span class="hljs-keyword">CASE</span> WHEN n IS <span class="hljs-literal">NULL</span> THEN <span class="hljs-number">0</span> <span class="hljs-keyword">ELSE</span> COUNT(n) END <span class="hljs-keyword">AS</span> num_corp, num_lp
WITH num_corp + num_lp <span class="hljs-keyword">AS</span> total_bes

<span class="hljs-comment">// get most connected BEs</span>
OPTIONAL <span class="hljs-keyword">MATCH</span> (n:SOS_LP) 
WHERE n.network_id = <span class="hljs-variable">$network_id</span>
WITH total_bes, <span class="hljs-keyword">CASE</span> WHEN n IS <span class="hljs-literal">NULL</span> THEN [] <span class="hljs-keyword">ELSE</span> COLLECT(n) END <span class="hljs-keyword">AS</span> be_list
OPTIONAL <span class="hljs-keyword">MATCH</span> (n:SOS_Corp) 
WHERE n.network_id = <span class="hljs-variable">$network_id</span>
WITH total_bes, <span class="hljs-keyword">CASE</span> WHEN n IS <span class="hljs-literal">NULL</span> THEN be_list <span class="hljs-keyword">ELSE</span> COLLECT(n) + be_list END <span class="hljs-keyword">AS</span> be_list

UNWIND (<span class="hljs-keyword">CASE</span> be_list WHEN [] THEN [<span class="hljs-literal">NULL</span>] <span class="hljs-keyword">ELSE</span> be_list END) <span class="hljs-keyword">AS</span> n
WITH total_bes, n, SIZE(()--(n)) <span class="hljs-keyword">AS</span> degree
WITH total_bes, n ORDER BY degree DESC LIMIT <span class="hljs-number">1</span>
WITH total_bes, COLLECT({name_norm: n.name_norm, __typename: LABELS(n)[<span class="hljs-number">0</span>]})[<span class="hljs-number">0</span>] <span class="hljs-keyword">AS</span> top_be 

<span class="hljs-comment">// get most connected owners</span>
OPTIONAL <span class="hljs-keyword">MATCH</span> (n:SOS_Owner) 
WHERE n.network_id = <span class="hljs-variable">$network_id</span>
WITH total_bes, top_be, n, SIZE(()--(n)) <span class="hljs-keyword">AS</span> degree
WITH total_bes, top_be, n ORDER BY degree DESC LIMIT <span class="hljs-number">1</span>
WITH total_bes, top_be, <span class="hljs-keyword">CASE</span> WHEN n IS <span class="hljs-literal">NULL</span> THEN <span class="hljs-number">0</span> <span class="hljs-keyword">ELSE</span> COUNT(n) END <span class="hljs-keyword">AS</span> total_owners, COLLECT({name_norm: n.name_norm})[<span class="hljs-number">0</span>] <span class="hljs-keyword">AS</span> top_owner 

OPTIONAL <span class="hljs-keyword">MATCH</span> (n:Address_Unit) 
WHERE n.network_id = <span class="hljs-variable">$network_id</span>
WITH total_bes, top_be, total_owners, top_owner, n, SIZE(()--(n)) <span class="hljs-keyword">AS</span> degree
WITH total_bes, top_be, total_owners, top_owner, n ORDER BY degree DESC LIMIT <span class="hljs-number">1</span>
WITH total_bes, top_be, total_owners, top_owner, <span class="hljs-keyword">CASE</span> WHEN n IS <span class="hljs-literal">NULL</span> THEN <span class="hljs-number">0</span> <span class="hljs-keyword">ELSE</span> COUNT(n) END <span class="hljs-keyword">AS</span> total_addrs, COLLECT({addr_readable: n.addr_readable})[<span class="hljs-number">0</span>] <span class="hljs-keyword">AS</span> top_addr

<span class="hljs-keyword">RETURN</span> {
  total_bes: total_bes,
  total_addrs: total_addrs,
  total_owners: total_owners,
  top_be: top_be,
  top_owner: top_owner.name_norm,
  top_addr: top_addr.addr_readable
}`;

export async <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">networkDetailsQueryHandler</span>(<span class="hljs-params">app, network_id</span>) </span>{
  <span class="hljs-keyword">const</span> session = app.locals.neo4jDriver.session();
  <span class="hljs-keyword">if</span> (!Number.isInteger(network_id) || (network_id &lt;= <span class="hljs-number">0</span>)) {
    <span class="hljs-keyword">throw</span> <span class="hljs-string">&quot;network_id: bad name, expected integer &gt; 0, got type: &quot;</span> +
        typeof network_id;
  }

  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> result = await session.run(details_query, { network_id });
    <span class="hljs-keyword">return</span> result.records[<span class="hljs-number">0</span>].get(<span class="hljs-number">0</span>);
  } <span class="hljs-keyword">finally</span> {
    await session.close();
  } 
}

export <span class="hljs-keyword">default</span> {
  networkDetailsQueryHandler
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverresthandlersquerynetworkgraph.js"><a href="#toc"><a name="server-rest-handlers-query-network-graph-js">server/rest/handlers/query/network/graph.js</a></a></h2>
<pre><code><span class="hljs-comment">// network/graph.js</span>

<span class="hljs-keyword">const</span> graph_query = `OPTIONAL <span class="hljs-keyword">MATCH</span> (lp:SOS_LP) <span class="hljs-comment">// get the LPs in the network</span>
WHERE lp.network_id = <span class="hljs-variable">$network_id</span>
WITH DISTINCT <span class="hljs-keyword">CASE</span> WHEN lp IS <span class="hljs-literal">NULL</span> THEN [] <span class="hljs-keyword">ELSE</span> COLLECT(DISTINCT lp) END <span class="hljs-keyword">AS</span> node_list

OPTIONAL <span class="hljs-keyword">MATCH</span> (corp:SOS_Corp) <span class="hljs-comment">// get the Corps in the network</span>
WHERE corp.network_id = <span class="hljs-variable">$network_id</span>
WITH DISTINCT <span class="hljs-keyword">CASE</span> WHEN corp IS <span class="hljs-literal">NULL</span> THEN node_list <span class="hljs-keyword">ELSE</span> COLLECT(DISTINCT corp) + node_list END <span class="hljs-keyword">AS</span> node_list

OPTIONAL <span class="hljs-keyword">MATCH</span> (n:SOS_Owner) <span class="hljs-comment">// get the owners for the network</span>
WHERE n.network_id = <span class="hljs-variable">$network_id</span>
WITH DISTINCT <span class="hljs-keyword">CASE</span> WHEN n IS <span class="hljs-literal">NULL</span> THEN node_list <span class="hljs-keyword">ELSE</span> COLLECT(DISTINCT n) + node_list END <span class="hljs-keyword">AS</span> node_list

OPTIONAL <span class="hljs-keyword">MATCH</span> (n:Address_Unit) <span class="hljs-comment">// get the units in the network</span>
WHERE n.network_id = <span class="hljs-variable">$network_id</span>
WITH DISTINCT <span class="hljs-keyword">CASE</span> WHEN n IS <span class="hljs-literal">NULL</span> THEN node_list <span class="hljs-keyword">ELSE</span> COLLECT(DISTINCT n) + node_list END <span class="hljs-keyword">AS</span> node_list

OPTIONAL <span class="hljs-keyword">MATCH</span> (n:A_Parcel) <span class="hljs-comment">// get the properties in the network</span>
WHERE n.network_id = <span class="hljs-variable">$network_id</span>
WITH DISTINCT <span class="hljs-keyword">CASE</span> WHEN n IS <span class="hljs-literal">NULL</span> THEN node_list <span class="hljs-keyword">ELSE</span> COLLECT(DISTINCT n) + node_list END <span class="hljs-keyword">AS</span> node_list

<span class="hljs-comment">// Note from maintainer:</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// startNode(r) and endNode(r) produce the following representation:</span>
<span class="hljs-comment">//   {</span>
<span class="hljs-comment">//     properties: [map of values], // key-value properties of the node.</span>
<span class="hljs-comment">//                                  // <span class="hljs-doctag">NOTE:</span> variable types. vals can be</span>
<span class="hljs-comment">//                                  // int, boolean, string, float, etc.</span>
<span class="hljs-comment">//     identity: &lt;integer_id&gt;,  // internal neo4j node id, subject to change.</span>
<span class="hljs-comment">//     labels: [&lt;typename&gt;],    // ex: &quot;SOS_LP&quot;. our nodes have only 1 label.</span>
<span class="hljs-comment">//   }</span>
<span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> consider including the key-value properties of the relations</span>
<span class="hljs-comment">// themselves, in addition to the key-value properties of the nodes they</span>
<span class="hljs-comment">// connect.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// This representation is the basis for the QueryProto.GraphNode message schema</span>
<span class="hljs-comment">// in type_definitions/proto/query/graph_util.proto . The proto representation</span>
<span class="hljs-comment">// makes some changes to allow for compatibility; see graph_util.proto for</span>
<span class="hljs-comment">// details.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// (end of note)</span>

OPTIONAL <span class="hljs-keyword">MATCH</span> (n)-[r]-(m)
WHERE n IN node_list <span class="hljs-keyword">AND</span> m IN node_list
WITH <span class="hljs-keyword">CASE</span> WHEN r IS <span class="hljs-literal">NULL</span> THEN <span class="hljs-literal">NULL</span> <span class="hljs-keyword">ELSE</span> {start: startNode(r), type: type(r), end: endNode(r)} END <span class="hljs-keyword">AS</span> network_elem
WITH COLLECT(network_elem) <span class="hljs-keyword">AS</span> network_subgraph

<span class="hljs-keyword">RETURN</span> {
    network_subgraph: network_subgraph
}`;

export async <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">networkGraphQueryHandler</span>(<span class="hljs-params">app, network_id</span>) </span>{
  <span class="hljs-keyword">const</span> session = app.locals.neo4jDriver.session();
  <span class="hljs-keyword">if</span> (!Number.isInteger(network_id) || (network_id &lt;= <span class="hljs-number">0</span>)) {
    <span class="hljs-keyword">throw</span> <span class="hljs-string">&quot;network_id: bad name, expected integer &gt; 0, got type: &quot;</span> +
        typeof network_id;
  }

  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> result = await session.run(graph_query, { network_id });
    <span class="hljs-keyword">return</span> result.records[<span class="hljs-number">0</span>].get(<span class="hljs-number">0</span>);
  } <span class="hljs-keyword">finally</span> {
    await session.close();
  } 
}

export <span class="hljs-keyword">default</span> {
  networkGraphQueryHandler
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverresthandlersquerynetworknodes.js"><a href="#toc"><a name="server-rest-handlers-query-network-nodes-js">server/rest/handlers/query/network/nodes.js</a></a></h2>
<pre><code><span class="hljs-comment">// network/nodes.js</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// query runner backing &#x27;/api/network/:network_id/nodes&#x27; routes.</span>

<span class="hljs-comment">// string representing cypher query template.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// given the ID of a network, returns paginated list of entities (i.e. </span>
<span class="hljs-comment">// businesses, business owners, and addresses) in the network</span>

<span class="hljs-keyword">const</span> query = `
  WITH <span class="hljs-variable">$network_id</span> <span class="hljs-keyword">AS</span> network_id

  <span class="hljs-comment">// look up all the addresses in the network</span>
  OPTIONAL <span class="hljs-keyword">MATCH</span> (address_unit:Address_Unit)
  WHERE address_unit.network_id = network_id

  WITH network_id, <span class="hljs-keyword">CASE</span> WHEN address_unit IS <span class="hljs-literal">NULL</span> THEN <span class="hljs-literal">NULL</span> <span class="hljs-keyword">ELSE</span> {
    node: address_unit,
    details: {
      is_business: <span class="hljs-keyword">CASE</span> WHEN EXISTS((address_unit)-[:LISTED_AT]-()) THEN <span class="hljs-literal">TRUE</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-literal">FALSE</span> END,
      is_property_owner: <span class="hljs-keyword">CASE</span> WHEN EXISTS((address_unit)--(:A_Parcel)) THEN <span class="hljs-literal">TRUE</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-literal">FALSE</span> END
    }
  } END <span class="hljs-keyword">AS</span> node_packaged
  WITH network_id, <span class="hljs-keyword">CASE</span> WHEN node_packaged IS <span class="hljs-literal">NULL</span> THEN [] <span class="hljs-keyword">ELSE</span> COLLECT(node_packaged) END <span class="hljs-keyword">AS</span> node_list

  <span class="hljs-comment">// look up all the business owners in the network</span>
  OPTIONAL <span class="hljs-keyword">MATCH</span> (business_owner:SOS_Owner)
  WHERE business_owner.network_id = network_id

  WITH network_id, node_list, <span class="hljs-keyword">CASE</span> WHEN business_owner IS <span class="hljs-literal">NULL</span> THEN <span class="hljs-literal">NULL</span> <span class="hljs-keyword">ELSE</span> {
    node: business_owner,
    details: {}
  } END <span class="hljs-keyword">AS</span> node_packaged
  WITH network_id, <span class="hljs-keyword">CASE</span> WHEN node_packaged IS <span class="hljs-literal">NULL</span> THEN node_list <span class="hljs-keyword">ELSE</span> node_list + COLLECT(node_packaged) END <span class="hljs-keyword">AS</span> node_list

  <span class="hljs-comment">// look up all the LPs in the network</span>
  OPTIONAL <span class="hljs-keyword">MATCH</span> (business_lp:SOS_LP)
  WHERE business_lp.network_id = network_id

  WITH network_id, node_list, <span class="hljs-keyword">CASE</span> WHEN business_lp IS <span class="hljs-literal">NULL</span> THEN <span class="hljs-literal">NULL</span> <span class="hljs-keyword">ELSE</span> {
    node: business_lp,
    details: {}
  } END <span class="hljs-keyword">AS</span> node_packaged
  WITH network_id, <span class="hljs-keyword">CASE</span> WHEN node_packaged IS <span class="hljs-literal">NULL</span> THEN node_list <span class="hljs-keyword">ELSE</span> node_list + COLLECT(node_packaged) END <span class="hljs-keyword">AS</span> node_list

  <span class="hljs-comment">// look up all the Corps in the network</span>
  OPTIONAL <span class="hljs-keyword">MATCH</span> (business_corp:SOS_Corp)
  WHERE business_corp.network_id = network_id

  WITH network_id, node_list, <span class="hljs-keyword">CASE</span> WHEN business_corp IS <span class="hljs-literal">NULL</span> THEN <span class="hljs-literal">NULL</span> <span class="hljs-keyword">ELSE</span> {
    node: business_corp,
    details: {}
  } END <span class="hljs-keyword">AS</span> node_packaged
  WITH network_id, <span class="hljs-keyword">CASE</span> WHEN node_packaged IS <span class="hljs-literal">NULL</span> THEN node_list <span class="hljs-keyword">ELSE</span> node_list + COLLECT(node_packaged) END <span class="hljs-keyword">AS</span> node_list

  UNWIND node_list <span class="hljs-keyword">AS</span> node_package

  WITH node_package.node <span class="hljs-keyword">AS</span> node, node_package.details <span class="hljs-keyword">AS</span> details
  WITH node, details, SIZE((node)--()) <span class="hljs-keyword">AS</span> degree <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Limit this to just relationship in the network (i.e. don&#x27;t include parcel relationships?)</span>
  WITH node, details, degree, LABELS(node)[<span class="hljs-number">0</span>] <span class="hljs-keyword">AS</span> node_type 

  <span class="hljs-keyword">RETURN</span> {
    name: <span class="hljs-keyword">CASE</span> WHEN node_type = <span class="hljs-string">&quot;Address_Unit&quot;</span> THEN node.addr_readable <span class="hljs-keyword">ELSE</span> node.name_norm END,
    type: node_type,
    degree: degree,
    details: details
  }
  ORDER BY degree DESC
`;

<span class="hljs-comment">//  uri: &#x27;/api/network/:network_id/nodes/:page&#x27;</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// inputs:</span>
<span class="hljs-comment">//   network_id - ID of the network</span>
<span class="hljs-comment">//   size - integer &lt; 0, the number of results to return.</span>
<span class="hljs-comment">//   page - integer &gt; 0, described which &#x27;page&#x27; of results to return (1 for the</span>
<span class="hljs-comment">//     first N results, 2 for the second N results, etc., where N is &#x27;size&#x27;).</span>
export async <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">networkNodesQueryHandler</span>(<span class="hljs-params">
    app, network_id</span>) </span>{
  <span class="hljs-comment">// validate input params.</span>

  <span class="hljs-keyword">if</span> (!Number.isInteger(network_id) || (network_id &lt;= <span class="hljs-number">0</span>)) {
    <span class="hljs-keyword">throw</span> <span class="hljs-string">&quot;network: bad id, expected integer &gt; 0, got type: &quot;</span> +
        typeof network_id;
  }

  <span class="hljs-comment">// query:</span>
  <span class="hljs-keyword">const</span> session = app.locals.neo4jDriver.session();
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> queryResponse = await session.run(query, { network_id });

    <span class="hljs-keyword">const</span> resultContainer = {
      nodes: []
    };
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> record_ind in queryResponse.records) {
      <span class="hljs-keyword">const</span> record = queryResponse.records[record_ind];
      resultContainer.nodes.push(record.get(<span class="hljs-number">0</span>));
    }
    <span class="hljs-keyword">return</span> resultContainer;
  } <span class="hljs-keyword">finally</span> {
    await session.close();
  }
}

export <span class="hljs-keyword">default</span> {
  networkNodesQueryHandler
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverresthandlersquerynetworkportfolio.js"><a href="#toc"><a name="server-rest-handlers-query-network-portfolio-js">server/rest/handlers/query/network/portfolio.js</a></a></h2>
<pre><code><span class="hljs-comment">// network/portfolio.js</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// given a network ID, retrieve info about</span>
<span class="hljs-comment">// other properties which may be owned in full or in part by the same</span>
<span class="hljs-comment">// real-estate ownership networks.</span>

<span class="hljs-comment">// string representing a cyper query template.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// network_id should be passed in as a parameter</span>
<span class="hljs-comment">// &#x27;network_id&#x27;.</span>

<span class="hljs-keyword">const</span> query = `

WITH <span class="hljs-variable">$network_id</span> <span class="hljs-keyword">AS</span> network_id

<span class="hljs-comment">// ---- get the related parcels in the network</span>
OPTIONAL <span class="hljs-keyword">MATCH</span> (portfolio_parcel:A_Parcel)
WHERE portfolio_parcel.network_id = network_id

<span class="hljs-comment">// get the owner mailing address</span>
OPTIONAL <span class="hljs-keyword">MATCH</span> (portfolio_parcel)-[:PARC_OWNER_ADDR_AT]-(mailing_addr:Address_Unit)

<span class="hljs-comment">// get the parcel owners</span>
OPTIONAL <span class="hljs-keyword">MATCH</span> (portfolio_parcel)--(owner:A_Parcel_Owner)
OPTIONAL <span class="hljs-keyword">MATCH</span> (owner)-[:BE_LINKED_TO]-(be_owner)

<span class="hljs-comment">// gather the owners</span>
WITH DISTINCT portfolio_parcel, mailing_addr, owner, COLLECT({
    owner_name: owner.ownr_owner_name,
    linked_be: <span class="hljs-keyword">CASE</span> WHEN be_owner IS <span class="hljs-literal">NULL</span> THEN <span class="hljs-literal">NULL</span> <span class="hljs-keyword">ELSE</span> {
        __typename: LABELS(be_owner)[<span class="hljs-number">0</span>],
        network_id: be_owner.network_id
    } END
}) <span class="hljs-keyword">AS</span> owners

<span class="hljs-comment">// gather the Ellis Act evictions to create an eviction count (based on units in the building)</span>
<span class="hljs-comment">// when there is a unit count on the property, use the # of units as the eviction count</span>
<span class="hljs-comment">// otherwise, assume a unit count of 1</span>
OPTIONAL <span class="hljs-keyword">MATCH</span> (portfolio_parcel)--(eviction:RB_Eviction)
WHERE TOUPPER(eviction.type) = <span class="hljs-string">&quot;ELLIS ACT WITHDRAWAL&quot;</span>
WITH DISTINCT portfolio_parcel, mailing_addr, owners, eviction, <span class="hljs-keyword">CASE</span> WHEN portfolio_parcel.units IS <span class="hljs-literal">NULL</span> THEN <span class="hljs-number">1</span> <span class="hljs-keyword">ELSE</span> TOFLOAT(portfolio_parcel.units) END <span class="hljs-keyword">AS</span> ellis_unit_count
<span class="hljs-comment">// since we have used an optional match, if no eviction was found then do not count</span>
WITH DISTINCT portfolio_parcel, mailing_addr, owners, eviction, <span class="hljs-keyword">CASE</span> WHEN eviction IS <span class="hljs-literal">NULL</span> THEN <span class="hljs-number">0</span> <span class="hljs-keyword">ELSE</span> ellis_unit_count END <span class="hljs-keyword">AS</span> ellis_unit_count
WITH DISTINCT portfolio_parcel, mailing_addr, owners, SUM(ellis_unit_count) <span class="hljs-keyword">AS</span> ellis_evicts

<span class="hljs-comment">// gather the non-Ellis Act evictions to create an eviction count (based on # of filings)</span>
OPTIONAL <span class="hljs-keyword">MATCH</span> (portfolio_parcel)--(eviction:RB_Eviction)
WHERE TOUPPER(eviction.type) &lt;&gt; <span class="hljs-string">&quot;ELLIS ACT WITHDRAWAL&quot;</span>

<span class="hljs-comment">// sum the unit-based Ellis eviction total and the filing-based non-Ellis eviction total</span>
WITH DISTINCT portfolio_parcel, mailing_addr, owners, <span class="hljs-keyword">CASE</span> WHEN eviction IS <span class="hljs-literal">NULL</span> THEN ellis_evicts <span class="hljs-keyword">ELSE</span> COUNT(DISTINCT eviction) + ellis_evicts END <span class="hljs-keyword">AS</span> num_evictions

<span class="hljs-comment">// look up the main address to display </span>
OPTIONAL <span class="hljs-keyword">MATCH</span> (portfolio_parcel)-[{ source: <span class="hljs-string">&quot;ASSESSOR&quot;</span>}]-(assess_addr:Parcel_Address) <span class="hljs-comment">// first try to look up the parcel address from assessor</span>
WITH DISTINCT portfolio_parcel, mailing_addr, owners, num_evictions, <span class="hljs-keyword">CASE</span> WHEN NOT assess_addr IS <span class="hljs-literal">NULL</span> THEN assess_addr.addr <span class="hljs-keyword">ELSE</span> <span class="hljs-literal">NULL</span> END <span class="hljs-keyword">AS</span> assessor_addr 

OPTIONAL <span class="hljs-keyword">MATCH</span> (portfolio_parcel)-[{ source: <span class="hljs-string">&quot;EAS&quot;</span>}]-(alt_addr:Parcel_Address) <span class="hljs-comment">// look up an alternate address in case there is none</span>
WITH DISTINCT portfolio_parcel, mailing_addr, owners, num_evictions, assessor_addr, <span class="hljs-keyword">CASE</span> WHEN NOT alt_addr IS <span class="hljs-literal">NULL</span> THEN COLLECT(alt_addr)[<span class="hljs-number">0</span>].addr <span class="hljs-keyword">ELSE</span> <span class="hljs-literal">NULL</span> END <span class="hljs-keyword">AS</span> alt_addr 

<span class="hljs-comment">// use assessor address if present, otherwise alternative address</span>
WITH DISTINCT portfolio_parcel, mailing_addr, owners, num_evictions, <span class="hljs-keyword">CASE</span> WHEN assessor_addr IS <span class="hljs-literal">NULL</span> THEN alt_addr <span class="hljs-keyword">ELSE</span> assessor_addr END <span class="hljs-keyword">AS</span> display_addr 

<span class="hljs-comment">// compile everything together for the related parcels</span>
<span class="hljs-keyword">RETURN</span> <span class="hljs-keyword">CASE</span> WHEN portfolio_parcel IS <span class="hljs-literal">NULL</span> THEN [] <span class="hljs-keyword">ELSE</span> COLLECT({
    addr: display_addr,
    owner_mailing_addr: mailing_addr.addr_readable,
    block_lot: portfolio_parcel.block_lot,
    num_evictions: num_evictions,
    units: TOFLOAT(portfolio_parcel.units),
    lat: TOFLOAT(portfolio_parcel.lat),
    long: TOFLOAT(portfolio_parcel.long),
    neighborhood: portfolio_parcel.neighborhood,
    owners: owners
}) END`;

<span class="hljs-comment">// the input parameter is the network_id for the network</span>
export async <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">networkPortfolioQueryHandler</span>(<span class="hljs-params">app, network_id</span>) </span>{
  <span class="hljs-keyword">if</span> (!Number.isInteger(network_id) || (network_id &lt;= <span class="hljs-number">0</span>)) {
    <span class="hljs-keyword">throw</span> <span class="hljs-string">&quot;network_id: bad name, expected integer &gt; 0, got type: &quot;</span> +
        typeof network_id;
  }
    
  <span class="hljs-keyword">const</span> session = app.locals.neo4jDriver.session();
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> result = await session.run(query, { network_id: network_id });
    <span class="hljs-keyword">return</span> (result.records[<span class="hljs-number">0</span>] || []).get(<span class="hljs-number">0</span>);
  } <span class="hljs-keyword">finally</span> {
    await session.close();
  }
}

export <span class="hljs-keyword">default</span> {
  networkPortfolioQueryHandler
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverresthandlersquerynetworkrelatednetworks.js"><a href="#toc"><a name="server-rest-handlers-query-network-relatednetworks-js">server/rest/handlers/query/network/relatedNetworks.js</a></a></h2>
<pre><code><span class="hljs-comment">// network/relatedNetworks.js</span>

<span class="hljs-keyword">import</span> adj_network_query from <span class="hljs-string">&#x27;../util_queries/adjNetwork&#x27;</span>;

<span class="hljs-keyword">const</span> start_query = `
    WITH $network_id AS network_id
`;

<span class="hljs-keyword">const</span> lp_start = `MATCH (<span class="hljs-keyword">this</span>:SOS_LP)
WHERE <span class="hljs-keyword">this</span>.name_norm = $be_name
WITH <span class="hljs-keyword">this</span>, <span class="hljs-keyword">this</span>.network_id AS network_id
`;

<span class="hljs-keyword">const</span> parc_start = `MATCH (<span class="hljs-keyword">this</span>:A_Parcel)
WHERE <span class="hljs-keyword">this</span>.block_lot = $block_lot
WITH <span class="hljs-keyword">this</span>, <span class="hljs-keyword">this</span>.network_id AS network_id
`;

export async function networkRelatedNetworksQueryHandler(app, network_id) {
  <span class="hljs-keyword">if</span> (!Number.isInteger(network_id) || (network_id &lt;= <span class="hljs-number">0</span>)) {
    <span class="hljs-keyword">throw</span> <span class="hljs-string">&quot;network_id: bad name, expected integer &gt; 0, got type: &quot;</span> +
        typeof network_id;
  }

  <span class="hljs-keyword">const</span> session = app.locals.neo4jDriver.session();
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> result = await session.run(start_query + adj_network_query, { network_id });
    <span class="hljs-keyword">return</span> result.records[<span class="hljs-number">0</span>].<span class="hljs-keyword">get</span>(<span class="hljs-number">0</span>);
  } <span class="hljs-keyword">finally</span> {
    await session.close();
  } 
}

export default {
  networkRelatedNetworksQueryHandler
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverresthandlersqueryownerdetails.js"><a href="#toc"><a name="server-rest-handlers-query-owner-details-js">server/rest/handlers/query/owner/details.js</a></a></h2>
<pre><code><span class="hljs-comment">// owner/details.js</span>

<span class="hljs-keyword">const</span> corp_query = `OPTIONAL MATCH (<span class="hljs-keyword">this</span>:SOS_Corp)
WHERE <span class="hljs-keyword">this</span>.name_norm = $search_string

OPTIONAL MATCH (<span class="hljs-keyword">this</span>)--(addr:Address_Unit)

<span class="hljs-comment">// create section for all office addresses listed for business</span>
WITH <span class="hljs-keyword">this</span>, CASE WHEN addr IS NULL THEN [] ELSE COLLECT(addr.addr_readable) END AS s_office_addresses

<span class="hljs-comment">// create section for all fields either unique to corporations</span>
<span class="hljs-comment">// or whose values have a particular semantic meaning for corporations only</span>
WITH <span class="hljs-keyword">this</span>, s_office_addresses, {
          __typename: LABELS(<span class="hljs-keyword">this</span>)[<span class="hljs-number">0</span>],
          status: <span class="hljs-keyword">this</span>.corporation_status,
          corporation_type: <span class="hljs-keyword">this</span>.corporation_type,
          corporation_tax_base: <span class="hljs-keyword">this</span>.corporation_tax_base,
          ftb_suspension_status: <span class="hljs-keyword">this</span>.ftb_suspension_status,
          corporation_classification: <span class="hljs-keyword">this</span>.corporation_classification,
          corporation_number: <span class="hljs-keyword">this</span>.corporation_number
    } AS s_corp_details

RETURN {
    creation_date: <span class="hljs-keyword">this</span>.incorporation_date,
    name: <span class="hljs-keyword">this</span>.corporation_name,
    network_id: <span class="hljs-keyword">this</span>.network_id,
    be_specific_details: s_corp_details,
    office_addresses: s_office_addresses
}
`;

<span class="hljs-keyword">const</span> lp_query = `MATCH (<span class="hljs-keyword">this</span>:SOS_LP)
WHERE <span class="hljs-keyword">this</span>.name_norm = $search_string

OPTIONAL MATCH (<span class="hljs-keyword">this</span>)--(addr:Address_Unit)

<span class="hljs-comment">// create section for all office addresses listed for business</span>
WITH <span class="hljs-keyword">this</span>, CASE WHEN addr IS NULL THEN [] ELSE COLLECT(addr.addr_readable) END AS s_office_addresses

<span class="hljs-comment">// create section for all fields either unique to LP/LLCs</span>
<span class="hljs-comment">// or whose values have a particular semantic meaning for LP/LLCs only</span>
WITH <span class="hljs-keyword">this</span>, s_office_addresses, {
        __typename: LABELS(<span class="hljs-keyword">this</span>)[<span class="hljs-number">0</span>],
        status: <span class="hljs-keyword">this</span>.status,
        llc_management_code: <span class="hljs-keyword">this</span>.llc_management_code,
        llc_type_of_business: <span class="hljs-keyword">this</span>.llc_type_of_business,
        jurisdiction: <span class="hljs-keyword">this</span>.jurisdiction
    } AS s_lp_details

RETURN {
    creation_date: <span class="hljs-keyword">this</span>.file_date,
    name: <span class="hljs-keyword">this</span>.name,
    network_id: <span class="hljs-keyword">this</span>.network_id,
    be_specific_details: s_lp_details,
    office_addresses: s_office_addresses
}
`;

export async function ownerDetailsQueryHandler(app, be_type, search_string) {
  <span class="hljs-keyword">const</span> session = app.locals.neo4jDriver.session();
  <span class="hljs-keyword">try</span> {
    let query;
    <span class="hljs-keyword">if</span> (be_type === <span class="hljs-string">&quot;corp&quot;</span>) {
      query = corp_query;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (be_type === <span class="hljs-string">&quot;lp&quot;</span>) {
      query = lp_query;
    }

    <span class="hljs-keyword">const</span> result = await session.run(query, { search_string: search_string});
    <span class="hljs-keyword">return</span> result.records[<span class="hljs-number">0</span>].<span class="hljs-keyword">get</span>(<span class="hljs-number">0</span>);
  } <span class="hljs-keyword">finally</span> {
    await session.close();
  } 
}

export default {
  ownerDetailsQueryHandler
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverresthandlersqueryownerevictions.js"><a href="#toc"><a name="server-rest-handlers-query-owner-evictions-js">server/rest/handlers/query/owner/evictions.js</a></a></h2>
<pre><code><span class="hljs-comment">// owner/evictions.js</span>

const corp_start = `MATCH (<span class="hljs-keyword">this</span>:SOS_Corp)
WHERE <span class="hljs-keyword">this</span>.name_norm = $search_string
`;

const lp_start = `MATCH (<span class="hljs-keyword">this</span>:SOS_LP)
WHERE <span class="hljs-keyword">this</span>.name_norm = $search_string
`;

<span class="hljs-comment">// for each eviction matched to this business, need to:</span>
<span class="hljs-comment">//    - collect all other evictors that have been matched to eviction</span>
<span class="hljs-comment">//    - identify exactly one parcel we can display for the eviction, and the number of additional properties</span>

const be_query = `
<span class="hljs-comment">// identify the evictor from sales transfer data</span>
OPTIONAL MATCH (be)-[:BE_LINKED_TO]-(evictor:RB_Evictor)-[rel_evictor:EVICTED_BY]-(eviction)
WHERE be.network_id = <span class="hljs-keyword">this</span>.network_id AND rel_evictor.evictor_origin = <span class="hljs-string">&quot;SALES_TRANSFER&quot;</span>

<span class="hljs-comment">// identify additional evictors associated with eviction petition</span>
OPTIONAL MATCH (extra_evictor:RB_Evictor)-[rel_extra_evictor:EVICTED_BY]-(eviction)
WHERE rel_extra_evictor.evictor_origin &lt;&gt; <span class="hljs-string">&quot;SALES_TRANSFER&quot;</span>

WITH be, eviction, evictor, <span class="hljs-keyword">CASE</span> WHEN extra_evictor IS <span class="hljs-keyword">NULL</span> THEN [] <span class="hljs-keyword">ELSE</span> <span class="hljs-keyword">COLLECT</span>({
  evictor_name: extra_evictor.evictor,
  <span class="hljs-keyword">source</span>: rel_extra_evictor.evictor_origin
}) END AS extra_evictors

<span class="hljs-comment">// count all parcels linked to eviction and pick one to display</span>
<span class="hljs-comment">// <span class="hljs-doctag">Note:</span> as of 3/31/21 DB, all evictions are guaranteed to have at least one parcel assigned,</span>
<span class="hljs-comment">// so num_other_parc will always be non-negative. Need to adjust this if that changes</span>

OPTIONAL MATCH (eviction)-[:EVICTION_AT]-(parc:A_Parcel) <span class="hljs-comment">// match for all parcels</span>
WITH be, evictor, eviction, extra_evictors, <span class="hljs-keyword">COUNT</span>(parc) - <span class="hljs-number">1</span> AS num_other_parc, <span class="hljs-keyword">COLLECT</span>(parc)[<span class="hljs-number">0</span>] AS display_parc

OPTIONAL MATCH (eviction)-[rel_eviction:EVICTION_AT]-(display_parc) <span class="hljs-comment">// get the relation for just the display parcel</span>

<span class="hljs-comment">// look up the main address to display </span>
OPTIONAL MATCH (display_parc)-[{ <span class="hljs-keyword">source</span>: <span class="hljs-string">&quot;ASSESSOR&quot;</span>}]-(assess_addr:Parcel_Address) <span class="hljs-comment">// first try to look up the parcel address from assessor</span>
WITH DISTINCT be, evictor, eviction, extra_evictors, num_other_parc, rel_eviction, display_parc, <span class="hljs-keyword">CASE</span> WHEN NOT assess_addr IS <span class="hljs-keyword">NULL</span> THEN assess_addr.addr <span class="hljs-keyword">ELSE</span> <span class="hljs-keyword">NULL</span> END AS assessor_addr 

OPTIONAL MATCH (display_parc)-[{ <span class="hljs-keyword">source</span>: <span class="hljs-string">&quot;EAS&quot;</span>}]-(alt_addr:Parcel_Address) <span class="hljs-comment">// look up an alternate address in case there is none</span>
WITH DISTINCT be, evictor, eviction, extra_evictors, num_other_parc, rel_eviction, display_parc, assessor_addr, <span class="hljs-keyword">CASE</span> WHEN NOT alt_addr IS <span class="hljs-keyword">NULL</span> THEN <span class="hljs-keyword">COLLECT</span>(alt_addr)[<span class="hljs-number">0</span>].addr <span class="hljs-keyword">ELSE</span> <span class="hljs-keyword">NULL</span> END AS alt_addr 

<span class="hljs-comment">// use assessor address if present, otherwise alternative address</span>
WITH DISTINCT be, evictor, eviction, extra_evictors, num_other_parc, rel_eviction, display_parc, <span class="hljs-keyword">CASE</span> WHEN assessor_addr IS <span class="hljs-keyword">NULL</span> THEN alt_addr <span class="hljs-keyword">ELSE</span> assessor_addr END AS display_addr 

<span class="hljs-keyword">RETURN</span> <span class="hljs-keyword">CASE</span> WHEN eviction IS <span class="hljs-keyword">NULL</span> THEN [] <span class="hljs-keyword">ELSE</span> <span class="hljs-keyword">COLLECT</span>({
    evict_id: eviction.evict_id,
    evict_date: eviction.evict_date,
    evict_addr_orig: eviction.addr_orig,
    type: eviction.type,
    location: {
      units: TOFLOAT(display_parc.units),
      lat: TOFLOAT(display_parc.lat),
      <span class="hljs-keyword">long</span>: TOFLOAT(display_parc.<span class="hljs-keyword">long</span>),
      addr: display_addr,
      block_lot: display_parc.block_lot,
      neighborhood: display_parc.neighborhood,
      num_other_parc: num_other_parc      
    },
    match_quality: {
      did_subdivision_occur: rel_eviction.eviction_type,
      addr_match_method: rel_eviction.addr_match_type
    },
    primary_evictor: {
      name: evictor.evictor,
      linked_be: {
          __typename: LABELS(be)[<span class="hljs-number">0</span>],
          network_id: be.network_id
      }
    },
    extra_evictors: extra_evictors
}) END`;


export async function ownerEvictionsQueryHandler(app, be_type, search_string) {
  const session = app.locals.neo4jDriver.session();
  <span class="hljs-keyword">try</span> {
    let query;
    <span class="hljs-keyword">if</span> (be_type === <span class="hljs-string">&quot;corp&quot;</span>) {
      query = corp_start + be_query;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (be_type === <span class="hljs-string">&quot;lp&quot;</span>) {
      query = lp_start + be_query;
    }

    const result = await session.run(query, { search_string: search_string});
    <span class="hljs-keyword">return</span> result.records[<span class="hljs-number">0</span>].get(<span class="hljs-number">0</span>);
  } <span class="hljs-keyword">finally</span> {
    await session.close();
  } 
}

export <span class="hljs-keyword">default</span> {
  ownerEvictionsQueryHandler
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverresthandlersqueryownernetworkdetails.js"><a href="#toc"><a name="server-rest-handlers-query-owner-networkdetails-js">server/rest/handlers/query/owner/networkDetails.js</a></a></h2>
<pre><code>// owner/networkDetails.js

const corp_start = `MATCH (this:SOS_Corp)
WHERE this.name_norm = $search_string
`;

const lp_start = `MATCH (this:SOS_LP)
WHERE this.name_norm = $search_string
`;

const details_query = `
<span class="hljs-keyword">WITH</span> this.network_id AS network_id

// get total BEs
OPTIONAL MATCH (n:SOS_LP) 
WHERE n.network_id = network_id
<span class="hljs-keyword">WITH</span> network_id, <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> n <span class="hljs-keyword">IS</span> NULL <span class="hljs-keyword">THEN</span> <span class="hljs-number">0</span> <span class="hljs-keyword">ELSE</span> COUNT(n) <span class="hljs-keyword">END</span> AS num_lp
OPTIONAL MATCH (n:SOS_Corp) 
WHERE n.network_id = network_id
<span class="hljs-keyword">WITH</span> network_id, <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> n <span class="hljs-keyword">IS</span> NULL <span class="hljs-keyword">THEN</span> <span class="hljs-number">0</span> <span class="hljs-keyword">ELSE</span> COUNT(n) <span class="hljs-keyword">END</span> AS num_corp, num_lp
<span class="hljs-keyword">WITH</span> network_id, num_corp + num_lp AS total_bes

// get most connected BEs
OPTIONAL MATCH (n:SOS_LP) 
WHERE n.network_id = network_id
<span class="hljs-keyword">WITH</span> network_id, total_bes, <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> n <span class="hljs-keyword">IS</span> NULL <span class="hljs-keyword">THEN</span> [] <span class="hljs-keyword">ELSE</span> COLLECT(n) <span class="hljs-keyword">END</span> AS be_list
OPTIONAL MATCH (n:SOS_Corp) 
WHERE n.network_id = network_id
<span class="hljs-keyword">WITH</span> network_id, total_bes, <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> n <span class="hljs-keyword">IS</span> NULL <span class="hljs-keyword">THEN</span> be_list <span class="hljs-keyword">ELSE</span> COLLECT(n) + be_list <span class="hljs-keyword">END</span> AS be_list

UNWIND (<span class="hljs-keyword">CASE</span> be_list <span class="hljs-keyword">WHEN</span> [] <span class="hljs-keyword">THEN</span> [NULL] <span class="hljs-keyword">ELSE</span> be_list <span class="hljs-keyword">END</span>) AS n
<span class="hljs-keyword">WITH</span> network_id, total_bes, n, SIZE(()<span class="hljs-comment">--(n)) AS degree</span>
<span class="hljs-keyword">WITH</span> network_id, total_bes, n ORDER BY degree DESC LIMIT <span class="hljs-number">1</span>
<span class="hljs-keyword">WITH</span> network_id, total_bes, COLLECT({name_norm: n.name_norm, __typename: LABELS(n)[<span class="hljs-number">0</span>]})[<span class="hljs-number">0</span>] AS top_be 

// get most connected owners
OPTIONAL MATCH (n:SOS_Owner) 
WHERE n.network_id = network_id
<span class="hljs-keyword">WITH</span> network_id, total_bes, top_be, n, SIZE(()<span class="hljs-comment">--(n)) AS degree</span>
<span class="hljs-keyword">WITH</span> network_id, total_bes, top_be, n ORDER BY degree DESC LIMIT <span class="hljs-number">1</span>
<span class="hljs-keyword">WITH</span> network_id, total_bes, top_be, <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> n <span class="hljs-keyword">IS</span> NULL <span class="hljs-keyword">THEN</span> <span class="hljs-number">0</span> <span class="hljs-keyword">ELSE</span> COUNT(n) <span class="hljs-keyword">END</span> AS total_owners, COLLECT({name_norm: n.name_norm})[<span class="hljs-number">0</span>] AS top_owner 

OPTIONAL MATCH (n:Address_Unit) 
WHERE n.network_id = network_id
<span class="hljs-keyword">WITH</span> network_id, total_bes, top_be, total_owners, top_owner, n, SIZE(()<span class="hljs-comment">--(n)) AS degree</span>
<span class="hljs-keyword">WITH</span> network_id, total_bes, top_be, total_owners, top_owner, n ORDER BY degree DESC LIMIT <span class="hljs-number">1</span>
<span class="hljs-keyword">WITH</span> network_id, total_bes, top_be, total_owners, top_owner, <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> n <span class="hljs-keyword">IS</span> NULL <span class="hljs-keyword">THEN</span> <span class="hljs-number">0</span> <span class="hljs-keyword">ELSE</span> COUNT(n) <span class="hljs-keyword">END</span> AS total_addrs, COLLECT({
  addr_readable: n.addr_readable,
  is_business: <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> EXISTS((n)-[:LISTED_AT]-()) <span class="hljs-keyword">THEN</span> <span class="hljs-literal">TRUE</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-literal">FALSE</span> <span class="hljs-keyword">END</span>,
  is_property_owner: <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> EXISTS((n)<span class="hljs-comment">--(:A_Parcel)) THEN TRUE ELSE FALSE END</span>
})[<span class="hljs-number">0</span>] AS top_addr

<span class="hljs-keyword">RETURN</span> {
  total_bes: total_bes,
  total_addrs: total_addrs,
  total_owners: total_owners,
  top_be: <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> top_be.name_norm <span class="hljs-keyword">IS</span> NULL <span class="hljs-keyword">THEN</span> NULL <span class="hljs-keyword">ELSE</span> top_be <span class="hljs-keyword">END</span>,
  top_owner: <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> top_owner.name_norm <span class="hljs-keyword">IS</span> NULL <span class="hljs-keyword">THEN</span> NULL <span class="hljs-keyword">ELSE</span> top_owner <span class="hljs-keyword">END</span>,
  top_addr: <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> top_addr.addr_readable <span class="hljs-keyword">IS</span> NULL <span class="hljs-keyword">THEN</span> NULL <span class="hljs-keyword">ELSE</span> top_addr <span class="hljs-keyword">END</span>
}`;

export async <span class="hljs-keyword">function</span> <span class="hljs-title">ownerNetworkDetailsQueryHandler</span>(app, be_type, search_string) {
  const session = app.locals.neo4jDriver.session();

  let query;
  <span class="hljs-keyword">if</span> (be_type === <span class="hljs-string">&quot;corp&quot;</span>) {
    query = corp_start + details_query;
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (be_type === <span class="hljs-string">&quot;lp&quot;</span>) {
    query = lp_start + details_query;
  }

  try {
    const result = await session.run(query, { be_type, search_string });
    <span class="hljs-keyword">return</span> result.records[<span class="hljs-number">0</span>].get(<span class="hljs-number">0</span>);
  } finally {
    await session.close();
  } 
}

export default {
  ownerNetworkDetailsQueryHandler
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverresthandlersqueryownerportfolio.js"><a href="#toc"><a name="server-rest-handlers-query-owner-portfolio-js">server/rest/handlers/query/owner/portfolio.js</a></a></h2>
<pre><code><span class="hljs-comment">// owner/portfolio.js</span>

<span class="hljs-keyword">const</span> corp_start = `MATCH (<span class="hljs-keyword">this</span>:SOS_Corp)
WHERE <span class="hljs-keyword">this</span>.name_norm = $search_string
`;

<span class="hljs-keyword">const</span> lp_start = `MATCH (<span class="hljs-keyword">this</span>:SOS_LP)
WHERE <span class="hljs-keyword">this</span>.name_norm = $search_string
`;

<span class="hljs-keyword">const</span> be_query = `

<span class="hljs-comment">// ------------- CREATE PROPERTY PORTFOLIO FOR BUSINESS NETWORK ----------------</span>

<span class="hljs-comment">// get the parcels directly owned</span>
OPTIONAL MATCH (<span class="hljs-keyword">this</span>)--(:A_Parcel_Owner)-[:PARC_OWNED_BY]-(owned_parcel)
<span class="hljs-comment">// get the parcels that are part of the &quot;network&quot; or portfolio</span>
OPTIONAL MATCH (portfolio_parcel:A_Parcel)
WHERE portfolio_parcel.network_id = <span class="hljs-keyword">this</span>.network_id

<span class="hljs-comment">// combine the directly owned and the network parcels</span>
WITH <span class="hljs-keyword">this</span>, COLLECT(owned_parcel) + COLLECT(portfolio_parcel) AS full_portfolio_parcels

<span class="hljs-comment">// if we have found no parcels, use null value for parcel</span>
WITH <span class="hljs-keyword">this</span>, CASE WHEN SIZE(full_portfolio_parcels) = <span class="hljs-number">0</span> THEN [NULL] ELSE full_portfolio_parcels END AS full_portfolio_parcels

UNWIND full_portfolio_parcels AS portfolio_parcel
WITH DISTINCT <span class="hljs-keyword">this</span>, portfolio_parcel

<span class="hljs-comment">// gather the property owners for each property in portfolio</span>
OPTIONAL MATCH (portfolio_parcel)-[:PARC_OWNED_BY]-(owner)
OPTIONAL MATCH (owner)-[:BE_LINKED_TO]-(be_owner)

<span class="hljs-comment">// look-up whether each owner is a business</span>
WITH DISTINCT <span class="hljs-keyword">this</span>, portfolio_parcel, COLLECT({
    owner_name: owner.ownr_owner_name,
    linked_be: CASE WHEN be_owner IS NULL THEN NULL ELSE {
        __typename: LABELS(be_owner)[<span class="hljs-number">0</span>],
        network_id: be_owner.network_id
    } END
}) AS owners

<span class="hljs-comment">// gather the Ellis Act evictions to create an eviction count (based on units in the building)</span>
<span class="hljs-comment">// when there is a unit count on the property, use the # of units as the eviction count</span>
<span class="hljs-comment">// otherwise, assume a unit count of 1</span>
OPTIONAL MATCH (portfolio_parcel)--(eviction:RB_Eviction)
WHERE TOUPPER(eviction.type) = <span class="hljs-string">&quot;ELLIS ACT WITHDRAWAL&quot;</span>
WITH DISTINCT <span class="hljs-keyword">this</span>, portfolio_parcel, owners, eviction, CASE WHEN portfolio_parcel.units IS NULL THEN <span class="hljs-number">1</span> ELSE TOFLOAT(portfolio_parcel.units) END AS ellis_unit_count
<span class="hljs-comment">// since we have used an optional match, if no eviction was found then do not count</span>
WITH DISTINCT <span class="hljs-keyword">this</span>, portfolio_parcel, owners, eviction, CASE WHEN eviction IS NULL THEN <span class="hljs-number">0</span> ELSE ellis_unit_count END AS ellis_unit_count
WITH DISTINCT <span class="hljs-keyword">this</span>, portfolio_parcel, owners, SUM(ellis_unit_count) AS ellis_evicts

<span class="hljs-comment">// gather the non-Ellis Act evictions to create an eviction count (based on # of filings)</span>
OPTIONAL MATCH (portfolio_parcel)--(eviction:RB_Eviction)
WHERE TOUPPER(eviction.type) &lt;&gt; <span class="hljs-string">&quot;ELLIS ACT WITHDRAWAL&quot;</span>

<span class="hljs-comment">// sum the unit-based Ellis eviction total and the filing-based non-Ellis eviction total</span>
WITH DISTINCT <span class="hljs-keyword">this</span>, portfolio_parcel, owners, CASE WHEN eviction IS NULL THEN ellis_evicts ELSE COUNT(DISTINCT eviction) + ellis_evicts END AS num_evictions

<span class="hljs-comment">// get the property owner mailing address for the property</span>
OPTIONAL MATCH (portfolio_parcel)-[:PARC_OWNER_ADDR_AT]-(mailing_addr_unit)

<span class="hljs-comment">// look up the main address to display </span>
OPTIONAL MATCH (portfolio_parcel)-[{ source: <span class="hljs-string">&quot;ASSESSOR&quot;</span>}]-(assess_addr:Parcel_Address) <span class="hljs-comment">// first try to look up the parcel address from assessor</span>
WITH DISTINCT <span class="hljs-keyword">this</span>, portfolio_parcel, owners, num_evictions, mailing_addr_unit, CASE WHEN NOT assess_addr IS NULL THEN assess_addr.addr ELSE NULL END AS assessor_addr 

OPTIONAL MATCH (portfolio_parcel)-[{ source: <span class="hljs-string">&quot;EAS&quot;</span>}]-(alt_addr:Parcel_Address) <span class="hljs-comment">// look up an alternate address in case there is none</span>
WITH DISTINCT <span class="hljs-keyword">this</span>, portfolio_parcel, owners, num_evictions, mailing_addr_unit, assessor_addr, CASE WHEN NOT alt_addr IS NULL THEN COLLECT(alt_addr)[<span class="hljs-number">0</span>].addr ELSE NULL END AS alt_addr 

<span class="hljs-comment">// use assessor address if present, otherwise alternative address</span>
WITH DISTINCT <span class="hljs-keyword">this</span>, portfolio_parcel, owners, num_evictions, mailing_addr_unit, CASE WHEN assessor_addr IS NULL THEN alt_addr ELSE assessor_addr END AS display_addr 

<span class="hljs-comment">// compile everything together for the related parcels</span>
WITH DISTINCT <span class="hljs-keyword">this</span>, CASE WHEN portfolio_parcel IS NULL THEN NULL ELSE {
    addr: display_addr,
    block_lot: portfolio_parcel.block_lot,
    num_evictions: num_evictions,
    units: TOFLOAT(portfolio_parcel.units),
    lat: TOFLOAT(portfolio_parcel.lat),
    long: TOFLOAT(portfolio_parcel.long),
    neighborhood: portfolio_parcel.neighborhood,
    owners: owners,
    mailing_address: mailing_addr_unit.addr_readable
} END AS parc_info
WITH DISTINCT <span class="hljs-keyword">this</span>, COLLECT( parc_info) AS s_property_portfolio

RETURN {
    property_portfolio: s_property_portfolio
}`;


export async function ownerPortfolioQueryHandler(app, be_type, search_string) {
  <span class="hljs-keyword">const</span> session = app.locals.neo4jDriver.session();
  <span class="hljs-keyword">try</span> {
    let query;
    <span class="hljs-keyword">if</span> (be_type === <span class="hljs-string">&quot;corp&quot;</span>) {
      query = corp_start + be_query;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (be_type === <span class="hljs-string">&quot;lp&quot;</span>) {
      query = lp_start + be_query;
    }

    <span class="hljs-keyword">const</span> result = await session.run(query, { search_string: search_string});
    <span class="hljs-keyword">return</span> result.records[<span class="hljs-number">0</span>].<span class="hljs-keyword">get</span>(<span class="hljs-number">0</span>);
  } <span class="hljs-keyword">finally</span> {
    await session.close();
  } 
}

export default {
  ownerPortfolioQueryHandler
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverresthandlersqueryownerrelatednetworks.js"><a href="#toc"><a name="server-rest-handlers-query-owner-relatednetworks-js">server/rest/handlers/query/owner/relatedNetworks.js</a></a></h2>
<pre><code><span class="hljs-comment">// owner/relatedNetworks.js</span>

<span class="hljs-keyword">import</span> adj_network_query from <span class="hljs-string">&#x27;../util_queries/adjNetwork&#x27;</span>;

<span class="hljs-keyword">const</span> corp_start = `MATCH (<span class="hljs-keyword">this</span>:SOS_Corp)
WHERE <span class="hljs-keyword">this</span>.name_norm = $search_string
WITH <span class="hljs-keyword">this</span>, <span class="hljs-keyword">this</span>.network_id AS network_id
`;

<span class="hljs-keyword">const</span> lp_start = `MATCH (<span class="hljs-keyword">this</span>:SOS_LP)
WHERE <span class="hljs-keyword">this</span>.name_norm = $search_string
WITH <span class="hljs-keyword">this</span>, <span class="hljs-keyword">this</span>.network_id AS network_id
`;

export async function ownerRelatedNetworksQueryHandler(app, be_type, search_string) {
  <span class="hljs-keyword">const</span> session = app.locals.neo4jDriver.session();
  <span class="hljs-keyword">try</span> {
    let query;
    <span class="hljs-keyword">if</span> (be_type === <span class="hljs-string">&quot;corp&quot;</span>) {
      query = corp_start + adj_network_query;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (be_type === <span class="hljs-string">&quot;lp&quot;</span>) {
      query = lp_start + adj_network_query;
    }

    <span class="hljs-keyword">const</span> result = await session.run(query, { search_string: search_string});
    <span class="hljs-keyword">return</span> result.records[<span class="hljs-number">0</span>].<span class="hljs-keyword">get</span>(<span class="hljs-number">0</span>);
  } <span class="hljs-keyword">finally</span> {
    await session.close();
  } 
}

export default {
  ownerRelatedNetworksQueryHandler
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverresthandlersqueryparceldetails.js"><a href="#toc"><a name="server-rest-handlers-query-parcel-details-js">server/rest/handlers/query/parcel/details.js</a></a></h2>
<pre><code><span class="hljs-comment">// parcel/details.js</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// primary-key lookup for basic info on a parcel.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// this query drives the &#x27;api/parcel/&lt;BLOCK_LOT&gt;/details&#x27; route.</span>

<span class="hljs-comment">// string representing a cyper query template.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// block_lot (parcel primary key) should be passed in as a parameter</span>
<span class="hljs-comment">// &#x27;search_string&#x27;.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// query result obj is parseable as a SFAssessorParcelDetailsQueryResult</span>
<span class="hljs-comment">// message. for context see proto/query/parcel.proto</span>
<span class="hljs-keyword">const</span> query = `

MATCH (<span class="hljs-keyword">this</span>:A_Parcel)
WHERE <span class="hljs-keyword">this</span>.block_lot = $search_string

OPTIONAL MATCH (<span class="hljs-keyword">this</span>)-[{ source: <span class="hljs-string">&quot;ASSESSOR&quot;</span>}]-(assess_addr:Parcel_Address) <span class="hljs-comment">// first try to look up the parcel address from assessor</span>
WITH DISTINCT <span class="hljs-keyword">this</span>, CASE WHEN NOT assess_addr IS NULL THEN assess_addr ELSE NULL END AS display_addr 

OPTIONAL MATCH (<span class="hljs-keyword">this</span>)-[{ source: <span class="hljs-string">&quot;EAS&quot;</span>}]-(alt_addr:Parcel_Address) <span class="hljs-comment">// look up an alternate address in case there is none</span>
WITH DISTINCT <span class="hljs-keyword">this</span>, CASE WHEN NOT alt_addr IS NULL THEN COLLECT(alt_addr)[<span class="hljs-number">0</span>] ELSE display_addr END AS display_addr 

OPTIONAL MATCH (<span class="hljs-keyword">this</span>)--(addr_var:Parcel_Address) <span class="hljs-comment">// look up list of alternative addresses</span>
WHERE ID(addr_var) &lt;&gt; ID(display_addr) OR display_addr IS NULL <span class="hljs-comment">// to handle case when there&#x27;s no address</span>

WITH <span class="hljs-keyword">this</span>, display_addr, COUNT(addr_var) AS tot_alt_addrs, COLLECT(addr_var.addr)[..$max_alt_addrs] AS alt_addr_list
WITH <span class="hljs-keyword">this</span>, display_addr, alt_addr_list, tot_alt_addrs - SIZE(alt_addr_list) AS num_extra_addrs

RETURN {
    parcel_details: {
      yr_built: TOFLOAT(<span class="hljs-keyword">this</span>.yr_built),
      addr_details: {
        main_addr: CASE WHEN display_addr IS NULL THEN NULL ELSE display_addr.addr END,
        addr_variations: alt_addr_list,
        num_extra_addr_variations: num_extra_addrs
      },
      block_lot: <span class="hljs-keyword">this</span>.block_lot,
      lat: TOFLOAT(<span class="hljs-keyword">this</span>.lat),
      long: TOFLOAT(<span class="hljs-keyword">this</span>.long),
      neighborhood: <span class="hljs-keyword">this</span>.neighborhood,
      rent_controlled: TOFLOAT(<span class="hljs-keyword">this</span>.rent_controlled),
      prop_class_code: <span class="hljs-keyword">this</span>.prop_class_code,
      zone: <span class="hljs-keyword">this</span>.zone,
      stories: TOFLOAT(<span class="hljs-keyword">this</span>.stories),
      units: TOFLOAT(<span class="hljs-keyword">this</span>.units),
      rooms: TOFLOAT(<span class="hljs-keyword">this</span>.rooms),
      beds: TOFLOAT(<span class="hljs-keyword">this</span>.beds),
      assess_land_val: TOFLOAT(<span class="hljs-keyword">this</span>.assess_land_val),
      assess_imp_val: TOFLOAT(<span class="hljs-keyword">this</span>.assess_imp_val),
      assess_val_date: <span class="hljs-keyword">this</span>.assess_val_date,
      update_date: <span class="hljs-keyword">this</span>.update_date,
      curr_sales_price: TOFLOAT(<span class="hljs-keyword">this</span>.curr_sales_price),
      curr_sales_date: <span class="hljs-keyword">this</span>.curr_sales_date,
      network_id: <span class="hljs-keyword">this</span>.network_id
    }
}`;

<span class="hljs-comment">// caution!!!! this file started as a copy-paste from the main parcel query</span>
<span class="hljs-comment">// (which used to be in parcel.js, but is now in parcel/legacy.js). see</span>
<span class="hljs-comment">// comments in that file for background.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// IMPORTANT: if you make any changes to this file, make them in legacy.js as</span>
<span class="hljs-comment">// well! this will help us avoid difficult-to-track-down bugs.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> deprecate this file to remove duplicate code.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// the input parameters are:</span>
<span class="hljs-comment">//     - the parcel&#x27;s block_lot, which serves as a primary key</span>
<span class="hljs-comment">//       for sf parcel nodes in the datastore. must be a string.</span>
<span class="hljs-comment">//     - the maximum number of address variations to display (defaults to 5)</span>

<span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> decide whether to add max_alt_addrs as a route parameter</span>

export async function parcelDetailsQueryHandler(app, block_lot, max_alt_addrs = <span class="hljs-number">5</span>) {
  <span class="hljs-keyword">const</span> session = app.locals.neo4jDriver.session();
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> result = await session.run(query, { search_string: block_lot, max_alt_addrs: max_alt_addrs });
    <span class="hljs-keyword">return</span> (result.records[<span class="hljs-number">0</span>] || []).<span class="hljs-keyword">get</span>(<span class="hljs-number">0</span>);
  } <span class="hljs-keyword">finally</span> {
    await session.close();
  }
}

export default {
  parcelDetailsQueryHandler
};
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverresthandlersqueryparcelevictions.js"><a href="#toc"><a name="server-rest-handlers-query-parcel-evictions-js">server/rest/handlers/query/parcel/evictions.js</a></a></h2>
<pre><code><span class="hljs-comment">// parcel/evictions.js</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// given a primary key for a parcel, retreive info about evictions which have</span>
<span class="hljs-comment">// occurred at the property on this parcel.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// this query drives the &#x27;api/parcel/&lt;BLOCK_LOT&gt;/evictions&#x27; route.</span>

<span class="hljs-comment">// string representing a cyper query template.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// block_lot (parcel primary key) should be passed in as a parameter</span>
<span class="hljs-comment">// &#x27;search_string&#x27;.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// query result obj is parseable as a SFAssessorParcelEvictionsQueryResult</span>
<span class="hljs-comment">// message. see type_definitions/proto/query/parcel.proto for context.</span>

<span class="hljs-comment">// for each eviction matched to this parcel, need to:</span>
<span class="hljs-comment">//    - identify the evictor associated through sales transfer</span>
<span class="hljs-comment">//    - all additional evictors that have been matched to eviction</span>
<span class="hljs-comment">//    - handle case when there is no associated evictor</span>
<span class="hljs-comment">//    - identify the number of additional properties this eviction was matched to</span>

<span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> handle case when no name from sales transfer is available, but petition has name(s)</span>

<span class="hljs-keyword">const</span> query = `
<span class="hljs-keyword">MATCH</span> (this:A_Parcel)
WHERE this.block_lot = <span class="hljs-variable">$search_string</span>

OPTIONAL <span class="hljs-keyword">MATCH</span> (eviction)-[rel_eviction:EVICTION_AT]-(this)

<span class="hljs-comment">// identify the evictor from sales transfer data</span>
OPTIONAL <span class="hljs-keyword">MATCH</span> (evictor:RB_Evictor)-[rel_evictor:EVICTED_BY]-(eviction)
WHERE rel_evictor.evictor_origin = <span class="hljs-string">&quot;SALES_TRANSFER&quot;</span>

<span class="hljs-comment">// identify additional evictors associated with eviction petition</span>
OPTIONAL <span class="hljs-keyword">MATCH</span> (extra_evictor:RB_Evictor)-[rel_extra_evictor:EVICTED_BY]-(eviction)
WHERE rel_extra_evictor.evictor_origin &lt;&gt; <span class="hljs-string">&quot;SALES_TRANSFER&quot;</span>

WITH eviction, rel_eviction, evictor, <span class="hljs-keyword">CASE</span> WHEN extra_evictor IS <span class="hljs-literal">NULL</span> THEN [] <span class="hljs-keyword">ELSE</span> COLLECT({
  evictor_name: extra_evictor.evictor,
  source: rel_extra_evictor.evictor_origin
}) END <span class="hljs-keyword">AS</span> extra_evictors

<span class="hljs-comment">// find how many properties this eviction has been linked to</span>
<span class="hljs-comment">// <span class="hljs-doctag">Note:</span> as of 3/31/21 DB, all evictions are guaranteed to have at least one parcel assigned,</span>
<span class="hljs-comment">// so num_other_parc will always be non-negative. Need to adjust this if that changes</span>

OPTIONAL <span class="hljs-keyword">MATCH</span> (eviction)-[:EVICTION_AT]-(parc:A_Parcel)
WITH eviction, rel_eviction, extra_evictors, evictor, COUNT(parc) - <span class="hljs-number">1</span> <span class="hljs-keyword">AS</span> num_other_parc

<span class="hljs-comment">// look-up whether the evictor is a business</span>
OPTIONAL <span class="hljs-keyword">MATCH</span> (evictor)-[:BE_LINKED_TO]-(be_evictor)

<span class="hljs-keyword">RETURN</span> <span class="hljs-keyword">CASE</span> WHEN eviction IS <span class="hljs-literal">NULL</span> THEN [] <span class="hljs-keyword">ELSE</span> COLLECT({
    evict_id: eviction.evict_id,
    evict_date: eviction.evict_date,
    evict_addr_orig: eviction.addr_orig,
    type: eviction.type,
    num_other_parc: num_other_parc,
    extra_evictors: extra_evictors,
    primary_evictor: {
      name: evictor.evictor,
      linked_be: <span class="hljs-keyword">CASE</span> WHEN be_evictor IS <span class="hljs-literal">NULL</span> THEN <span class="hljs-literal">NULL</span> <span class="hljs-keyword">ELSE</span> {
          __typename: LABELS(be_evictor)[<span class="hljs-number">0</span>],
          network_id: be_evictor.network_id
      } END
    },
    match_quality: {
      did_subdivision_occur: rel_eviction.eviction_type,
      addr_match_method: rel_eviction.addr_match_type
    }
}) END`;

<span class="hljs-comment">// the input parameter is the parcel&#x27;s block_lot, which serves as a primary key</span>
<span class="hljs-comment">// for sf parcel nodes in the datastore. it is *not* any information related to</span>
<span class="hljs-comment">// an eviction or evictor directly. must be a string.</span>
export async <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parcelEvictionsQueryHandler</span>(<span class="hljs-params">app, block_lot</span>) </span>{
  <span class="hljs-keyword">const</span> session = app.locals.neo4jDriver.session();
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> result = await session.run(query, { search_string: block_lot });
    <span class="hljs-keyword">return</span> (result.records[<span class="hljs-number">0</span>] || []).get(<span class="hljs-number">0</span>);
  } <span class="hljs-keyword">finally</span> {
    await session.close();
  }
}

export <span class="hljs-keyword">default</span> {
  parcelEvictionsQueryHandler
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverresthandlersqueryparcelnetworkdetails.js"><a href="#toc"><a name="server-rest-handlers-query-parcel-networkdetails-js">server/rest/handlers/query/parcel/networkDetails.js</a></a></h2>
<pre><code>// parcel/networkDetails.js

const details_query = `
MATCH (search:A_Parcel)
WHERE search.block_lot = $parcel_id

<span class="hljs-keyword">WITH</span> search.network_id AS network_id

// get total BEs
OPTIONAL MATCH (n:SOS_LP) 
WHERE n.network_id = network_id
<span class="hljs-keyword">WITH</span> network_id, <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> n <span class="hljs-keyword">IS</span> NULL <span class="hljs-keyword">THEN</span> <span class="hljs-number">0</span> <span class="hljs-keyword">ELSE</span> COUNT(n) <span class="hljs-keyword">END</span> AS num_lp
OPTIONAL MATCH (n:SOS_Corp) 
WHERE n.network_id = network_id
<span class="hljs-keyword">WITH</span> network_id, <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> n <span class="hljs-keyword">IS</span> NULL <span class="hljs-keyword">THEN</span> <span class="hljs-number">0</span> <span class="hljs-keyword">ELSE</span> COUNT(n) <span class="hljs-keyword">END</span> AS num_corp, num_lp
<span class="hljs-keyword">WITH</span> network_id, num_corp + num_lp AS total_bes

// get most connected BEs
OPTIONAL MATCH (n:SOS_LP) 
WHERE n.network_id = network_id
<span class="hljs-keyword">WITH</span> network_id, total_bes, <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> n <span class="hljs-keyword">IS</span> NULL <span class="hljs-keyword">THEN</span> [] <span class="hljs-keyword">ELSE</span> COLLECT(n) <span class="hljs-keyword">END</span> AS be_list
OPTIONAL MATCH (n:SOS_Corp) 
WHERE n.network_id = network_id
<span class="hljs-keyword">WITH</span> network_id, total_bes, <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> n <span class="hljs-keyword">IS</span> NULL <span class="hljs-keyword">THEN</span> be_list <span class="hljs-keyword">ELSE</span> COLLECT(n) + be_list <span class="hljs-keyword">END</span> AS be_list

UNWIND (<span class="hljs-keyword">CASE</span> be_list <span class="hljs-keyword">WHEN</span> [] <span class="hljs-keyword">THEN</span> [NULL] <span class="hljs-keyword">ELSE</span> be_list <span class="hljs-keyword">END</span>) AS n
<span class="hljs-keyword">WITH</span> network_id, total_bes, n, SIZE(()<span class="hljs-comment">--(n)) AS degree</span>
<span class="hljs-keyword">WITH</span> network_id, total_bes, n ORDER BY degree DESC LIMIT <span class="hljs-number">1</span>
<span class="hljs-keyword">WITH</span> network_id, total_bes, COLLECT({name_norm: n.name_norm, __typename: LABELS(n)[<span class="hljs-number">0</span>]})[<span class="hljs-number">0</span>] AS top_be 

// get most connected owners
OPTIONAL MATCH (n:SOS_Owner) 
WHERE n.network_id = network_id
<span class="hljs-keyword">WITH</span> network_id, total_bes, top_be, n, SIZE(()<span class="hljs-comment">--(n)) AS degree</span>
<span class="hljs-keyword">WITH</span> network_id, total_bes, top_be, n ORDER BY degree DESC LIMIT <span class="hljs-number">1</span>
<span class="hljs-keyword">WITH</span> network_id, total_bes, top_be, <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> n <span class="hljs-keyword">IS</span> NULL <span class="hljs-keyword">THEN</span> <span class="hljs-number">0</span> <span class="hljs-keyword">ELSE</span> COUNT(n) <span class="hljs-keyword">END</span> AS total_owners, COLLECT({name_norm: n.name_norm})[<span class="hljs-number">0</span>] AS top_owner 

OPTIONAL MATCH (n:Address_Unit) 
WHERE n.network_id = network_id
<span class="hljs-keyword">WITH</span> network_id, total_bes, top_be, total_owners, top_owner, n, SIZE(()<span class="hljs-comment">--(n)) AS degree</span>
<span class="hljs-keyword">WITH</span> network_id, total_bes, top_be, total_owners, top_owner, n ORDER BY degree DESC LIMIT <span class="hljs-number">1</span>
<span class="hljs-keyword">WITH</span> network_id, total_bes, top_be, total_owners, top_owner, <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> n <span class="hljs-keyword">IS</span> NULL <span class="hljs-keyword">THEN</span> <span class="hljs-number">0</span> <span class="hljs-keyword">ELSE</span> COUNT(n) <span class="hljs-keyword">END</span> AS total_addrs, COLLECT({
  addr_readable: n.addr_readable,
  is_business: <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> EXISTS((n)-[:LISTED_AT]-()) <span class="hljs-keyword">THEN</span> <span class="hljs-literal">TRUE</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-literal">FALSE</span> <span class="hljs-keyword">END</span>,
  is_property_owner: <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> EXISTS((n)<span class="hljs-comment">--(:A_Parcel)) THEN TRUE ELSE FALSE END</span>
})[<span class="hljs-number">0</span>] AS top_addr

<span class="hljs-keyword">RETURN</span> {
  total_bes: total_bes,
  total_addrs: total_addrs,
  total_owners: total_owners,
  top_be: <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> top_be.name_norm <span class="hljs-keyword">IS</span> NULL <span class="hljs-keyword">THEN</span> NULL <span class="hljs-keyword">ELSE</span> top_be <span class="hljs-keyword">END</span>,
  top_owner: <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> top_owner.name_norm <span class="hljs-keyword">IS</span> NULL <span class="hljs-keyword">THEN</span> NULL <span class="hljs-keyword">ELSE</span> top_owner <span class="hljs-keyword">END</span>,
  top_addr: <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> top_addr.addr_readable <span class="hljs-keyword">IS</span> NULL <span class="hljs-keyword">THEN</span> NULL <span class="hljs-keyword">ELSE</span> top_addr <span class="hljs-keyword">END</span>
}`;

export async <span class="hljs-keyword">function</span> <span class="hljs-title">parcelNetworkDetailsQueryHandler</span>(app, parcel_id) {
  const session = app.locals.neo4jDriver.session();

  try {
    const result = await session.run(details_query, { parcel_id });
    <span class="hljs-keyword">return</span> result.records[<span class="hljs-number">0</span>].get(<span class="hljs-number">0</span>);
  } finally {
    await session.close();
  } 
}

export default {
  parcelNetworkDetailsQueryHandler
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverresthandlersqueryparcelowners.js"><a href="#toc"><a name="server-rest-handlers-query-parcel-owners-js">server/rest/handlers/query/parcel/owners.js</a></a></h2>
<pre><code><span class="hljs-comment">// parcel/owners.js</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// given a parcel&#x27;s block_lot (primary key), retrieve info about individuals,</span>
<span class="hljs-comment">// trusts, or businesses believed to be current owners of the parcel, in whole</span>
<span class="hljs-comment">// or in part.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// this query drives the &#x27;api/parcel/&lt;BLOCK_LOT&gt;/owners&#x27; route.</span>

<span class="hljs-comment">// string representing a cyper query template.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// block_lot (parcel primary key) should be passed in as a parameter</span>
<span class="hljs-comment">// &#x27;search_string&#x27;.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// query result obj is parseable as a SFAssessorParcelOwnersQueryResult message.</span>
<span class="hljs-comment">// see proto/queries/parcel.proto for context.</span>
<span class="hljs-keyword">const</span> query = `

MATCH (<span class="hljs-keyword">this</span>:A_Parcel)
WHERE <span class="hljs-keyword">this</span>.block_lot = $search_string

<span class="hljs-comment">// find what other properties are owned by the property&#x27;s owner</span>
OPTIONAL MATCH (parcel:A_Parcel)-[:PARC_OWNED_BY]-(owner)-[:PARC_OWNED_BY]-(<span class="hljs-keyword">this</span>)

WITH DISTINCT <span class="hljs-keyword">this</span>, COUNT(parcel) <span class="hljs-keyword">as</span> s_parcels

OPTIONAL MATCH (ma:Address_Unit)--(<span class="hljs-keyword">this</span>)
OPTIONAL MATCH (<span class="hljs-keyword">this</span>)-[rel_owner]-(owner:A_Parcel_Owner)
OPTIONAL MATCH (owner)-[:BE_LINKED_TO]-(be_owner)

WITH DISTINCT <span class="hljs-keyword">this</span>, s_parcels, COLLECT({
    mailing_address: ma.addr_readable,
    record_date: rel_owner.ownr_record_date,
    perc_owner: TOFLOAT(rel_owner.ownr_perc_owner),
    owner_name: owner.ownr_owner_name,
    linked_be: CASE WHEN be_owner IS NULL THEN NULL ELSE {
        __typename: LABELS(be_owner)[<span class="hljs-number">0</span>],
        network_id: be_owner.network_id,
        name_norm: be_owner.name_norm
    } END
}) AS s_parc_owners

RETURN {
  owners: s_parc_owners, 
  parcels: sum(s_parcels),
  subdivided: CASE WHEN <span class="hljs-keyword">this</span>.subdivided = <span class="hljs-string">&quot;True&quot;</span> THEN True ELSE False END,
  multiple_owners: CASE WHEN <span class="hljs-keyword">this</span>.multiple_owners = <span class="hljs-string">&quot;True&quot;</span> THEN True ELSE False END
}
`;

<span class="hljs-comment">// caution!!!! this file started as a copy-paste from the main parcel query</span>
<span class="hljs-comment">// (which used to be in parcel.js, but is now in parcel/legacy.js). see</span>
<span class="hljs-comment">// comments in that file for background.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// IMPORTANT: if you make any changes to this file, make them in legacy.js as</span>
<span class="hljs-comment">// well! this will help us avoid difficult-to-track-down bugs.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> deprecate this file to remove duplicate code.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> the input parameter is the block_lot of the parcel, *NOT* any</span>
<span class="hljs-comment">// information related to the parcel&#x27;s owner. must be a string.</span>
export async function parcelOwnersQueryHandler(app, block_lot) {
  <span class="hljs-keyword">const</span> session = app.locals.neo4jDriver.session();
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> result = await session.run(query, { search_string: block_lot });
    <span class="hljs-keyword">return</span> (result.records[<span class="hljs-number">0</span>] || []).<span class="hljs-keyword">get</span>(<span class="hljs-number">0</span>);
  } <span class="hljs-keyword">finally</span> {
    await session.close();
  }
}

export default {
  parcelOwnersQueryHandler
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverresthandlersqueryparcelportfolio.js"><a href="#toc"><a name="server-rest-handlers-query-parcel-portfolio-js">server/rest/handlers/query/parcel/portfolio.js</a></a></h2>
<pre><code><span class="hljs-comment">// parcel/portfolio.js</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// given a parcel&#x27;s block_lot (primary key), retrieve info about</span>
<span class="hljs-comment">// other properties which may be owned in full or in part by the same</span>
<span class="hljs-comment">// real-estate ownership networks.</span>

<span class="hljs-comment">// string representing a cyper query template.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// block_lot (parcel primary key) should be passed in as a parameter</span>
<span class="hljs-comment">// &#x27;search_string&#x27;.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// query result obj is parseable as a SFAssessorParcelNetworksQueryResult</span>
<span class="hljs-comment">// message. see proto/query/parcel.proto for context.</span>
const query = `

MATCH (<span class="hljs-keyword">this</span>:A_Parcel)
WHERE <span class="hljs-keyword">this</span>.block_lot = $search_string

<span class="hljs-comment">// ---- get the related parcels in the network (that are not the searched parcel)</span>
OPTIONAL MATCH (portfolio_parcel:A_Parcel)
WHERE portfolio_parcel.network_id = <span class="hljs-keyword">this</span>.network_id AND ID(portfolio_parcel) &lt;&gt; ID(<span class="hljs-keyword">this</span>)

<span class="hljs-comment">// get the owner mailing address</span>
OPTIONAL MATCH (portfolio_parcel)-[:PARC_OWNER_ADDR_AT]-(mailing_addr:Address_Unit)

<span class="hljs-comment">// get the parcel owners</span>
OPTIONAL MATCH (portfolio_parcel)--(owner:A_Parcel_Owner)
OPTIONAL MATCH (owner)-[:BE_LINKED_TO]-(be_owner)

<span class="hljs-comment">// gather the owners</span>
WITH DISTINCT <span class="hljs-keyword">this</span>, portfolio_parcel, mailing_addr, owner, <span class="hljs-keyword">COLLECT</span>({
    owner_name: owner.ownr_owner_name,
    linked_be: <span class="hljs-keyword">CASE</span> WHEN be_owner IS <span class="hljs-keyword">NULL</span> THEN <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">ELSE</span> {
        __typename: LABELS(be_owner)[<span class="hljs-number">0</span>],
        network_id: be_owner.network_id
    } END
}) AS owners

<span class="hljs-comment">// gather the Ellis Act evictions to create an eviction count (based on units in the building)</span>
<span class="hljs-comment">// when there is a unit count on the property, use the # of units as the eviction count</span>
<span class="hljs-comment">// otherwise, assume a unit count of 1</span>
OPTIONAL MATCH (portfolio_parcel)--(eviction:RB_Eviction)
WHERE TOUPPER(eviction.type) = <span class="hljs-string">&quot;ELLIS ACT WITHDRAWAL&quot;</span>
WITH DISTINCT <span class="hljs-keyword">this</span>, portfolio_parcel, mailing_addr, owners, eviction, <span class="hljs-keyword">CASE</span> WHEN portfolio_parcel.units IS <span class="hljs-keyword">NULL</span> THEN <span class="hljs-number">1</span> <span class="hljs-keyword">ELSE</span> TOFLOAT(portfolio_parcel.units) END AS ellis_unit_count
<span class="hljs-comment">// since we have used an optional match, if no eviction was found then do not count</span>
WITH DISTINCT <span class="hljs-keyword">this</span>, portfolio_parcel, mailing_addr, owners, eviction, <span class="hljs-keyword">CASE</span> WHEN eviction IS <span class="hljs-keyword">NULL</span> THEN <span class="hljs-number">0</span> <span class="hljs-keyword">ELSE</span> ellis_unit_count END AS ellis_unit_count
WITH DISTINCT <span class="hljs-keyword">this</span>, portfolio_parcel, mailing_addr, owners, SUM(ellis_unit_count) AS ellis_evicts

<span class="hljs-comment">// gather the non-Ellis Act evictions to create an eviction count (based on # of filings)</span>
OPTIONAL MATCH (portfolio_parcel)--(eviction:RB_Eviction)
WHERE TOUPPER(eviction.type) &lt;&gt; <span class="hljs-string">&quot;ELLIS ACT WITHDRAWAL&quot;</span>

<span class="hljs-comment">// sum the unit-based Ellis eviction total and the filing-based non-Ellis eviction total</span>
WITH DISTINCT <span class="hljs-keyword">this</span>, portfolio_parcel, mailing_addr, owners, <span class="hljs-keyword">CASE</span> WHEN eviction IS <span class="hljs-keyword">NULL</span> THEN ellis_evicts <span class="hljs-keyword">ELSE</span> <span class="hljs-keyword">COUNT</span>(DISTINCT eviction) + ellis_evicts END AS num_evictions

<span class="hljs-comment">// look up the main address to display </span>
OPTIONAL MATCH (portfolio_parcel)-[{ <span class="hljs-keyword">source</span>: <span class="hljs-string">&quot;ASSESSOR&quot;</span>}]-(assess_addr:Parcel_Address) <span class="hljs-comment">// first try to look up the parcel address from assessor</span>
WITH DISTINCT <span class="hljs-keyword">this</span>, portfolio_parcel, mailing_addr, owners, num_evictions, <span class="hljs-keyword">CASE</span> WHEN NOT assess_addr IS <span class="hljs-keyword">NULL</span> THEN assess_addr.addr <span class="hljs-keyword">ELSE</span> <span class="hljs-keyword">NULL</span> END AS assessor_addr 

OPTIONAL MATCH (portfolio_parcel)-[{ <span class="hljs-keyword">source</span>: <span class="hljs-string">&quot;EAS&quot;</span>}]-(alt_addr:Parcel_Address) <span class="hljs-comment">// look up an alternate address in case there is none</span>
WITH DISTINCT <span class="hljs-keyword">this</span>, portfolio_parcel, mailing_addr, owners, num_evictions, assessor_addr, <span class="hljs-keyword">CASE</span> WHEN NOT alt_addr IS <span class="hljs-keyword">NULL</span> THEN <span class="hljs-keyword">COLLECT</span>(alt_addr)[<span class="hljs-number">0</span>].addr <span class="hljs-keyword">ELSE</span> <span class="hljs-keyword">NULL</span> END AS alt_addr 

<span class="hljs-comment">// use assessor address if present, otherwise alternative address</span>
WITH DISTINCT <span class="hljs-keyword">this</span>, portfolio_parcel, mailing_addr, owners, num_evictions, <span class="hljs-keyword">CASE</span> WHEN assessor_addr IS <span class="hljs-keyword">NULL</span> THEN alt_addr <span class="hljs-keyword">ELSE</span> assessor_addr END AS display_addr 

<span class="hljs-comment">// compile everything together for the related parcels</span>
<span class="hljs-keyword">RETURN</span> <span class="hljs-keyword">CASE</span> WHEN portfolio_parcel IS <span class="hljs-keyword">NULL</span> THEN [] <span class="hljs-keyword">ELSE</span> <span class="hljs-keyword">COLLECT</span>({
    addr: display_addr,
    owner_mailing_addr: mailing_addr.addr_readable,
    block_lot: portfolio_parcel.block_lot,
    num_evictions: num_evictions,
    units: TOFLOAT(portfolio_parcel.units),
    lat: TOFLOAT(portfolio_parcel.lat),
    <span class="hljs-keyword">long</span>: TOFLOAT(portfolio_parcel.<span class="hljs-keyword">long</span>),
    neighborhood: portfolio_parcel.neighborhood,
    owners: owners
}) END`;

<span class="hljs-comment">// the input parameter is the block_lot of the parcel, *NOT* any information</span>
<span class="hljs-comment">// about to business networks this parcel is connected to. must be a string.</span>
export async function parcelPortfolioQueryHandler(app, block_lot) {
  const session = app.locals.neo4jDriver.session();
  <span class="hljs-keyword">try</span> {
    const result = await session.run(query, { search_string: block_lot });
    <span class="hljs-keyword">return</span> (result.records[<span class="hljs-number">0</span>] || []).get(<span class="hljs-number">0</span>);
  } <span class="hljs-keyword">finally</span> {
    await session.close();
  }
}

export <span class="hljs-keyword">default</span> {
  parcelPortfolioQueryHandler
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverresthandlersqueryparcelrelatednetworks.js"><a href="#toc"><a name="server-rest-handlers-query-parcel-relatednetworks-js">server/rest/handlers/query/parcel/relatedNetworks.js</a></a></h2>
<pre><code><span class="hljs-comment">// parcel/relatedNetworks.js</span>

<span class="hljs-keyword">import</span> adj_network_query from <span class="hljs-string">&#x27;../util_queries/adjNetwork&#x27;</span>;

<span class="hljs-keyword">const</span> parcel_start = `MATCH (<span class="hljs-keyword">this</span>:A_Parcel)
WHERE <span class="hljs-keyword">this</span>.block_lot = $search_string
WITH <span class="hljs-keyword">this</span>, <span class="hljs-keyword">this</span>.network_id AS network_id
`;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> function parcelRelatedNetworksQueryHandler(app, search_string) {
  <span class="hljs-keyword">const</span> session = app.locals.neo4jDriver.session();
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> session.run(parcel_start + adj_network_query, { search_string: search_string});
    <span class="hljs-keyword">return</span> result.records[<span class="hljs-number">0</span>].<span class="hljs-keyword">get</span>(<span class="hljs-number">0</span>);
  } <span class="hljs-keyword">finally</span> {
    <span class="hljs-keyword">await</span> session.close();
  } 
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  parcelRelatedNetworksQueryHandler
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverresthandlersquerysearchsearch.js"><a href="#toc"><a name="server-rest-handlers-query-search-search-js">server/rest/handlers/query/search/search.js</a></a></h2>
<pre><code><span class="hljs-comment">// search.js</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// contains query handlers for 2.0 full-text search queries.</span>
import statusUtils from &#x27;../../../../framework/statusUtils&#x27;;

<span class="hljs-comment">// Query fragments:</span>
<span class="hljs-keyword">const</span> query_start = `
WITH [] <span class="hljs-keyword">as</span> result_list
`;

<span class="hljs-keyword">const</span> parcel_lookup = `

CALL <span class="hljs-keyword">db</span>.index.fulltext.queryNodes(
&#x27;parcelAddrIndex&#x27;, <span class="hljs-variable">$search</span>) 
YIELD node <span class="hljs-keyword">AS</span> address, <span class="hljs-keyword">score</span> 
WHERE <span class="hljs-keyword">score</span> &gt; <span class="hljs-variable">$score_threshold</span>
WITH result_list, address, <span class="hljs-keyword">score</span>

<span class="hljs-comment">// for each address, look up the parcel(s) associated with it</span>
MATCH (address)--(parc:A_Parcel)

<span class="hljs-comment">// count the number of properties in the network</span>
OPTIONAL MATCH (<span class="hljs-keyword">n</span>:A_Parcel)
WHERE <span class="hljs-keyword">n</span>.network_id = parc.network_id
WITH result_list, <span class="hljs-keyword">score</span>, address, parc, CASE WHEN <span class="hljs-keyword">n</span> IS NULL THEN 0 <span class="hljs-keyword">ELSE</span> <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">n</span>) END <span class="hljs-keyword">AS</span> network_size

<span class="hljs-comment">// sort by the score, and pick the top address for each parcel to display</span>
WITH result_list, <span class="hljs-keyword">score</span>, address, parc, network_size <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">score</span> <span class="hljs-keyword">DESC</span>
WITH result_list, parc, network_size, COLLECT(address)[0] <span class="hljs-keyword">AS</span> display_addr, COLLECT(<span class="hljs-keyword">score</span>)[0] <span class="hljs-keyword">AS</span> display_addr_score

<span class="hljs-comment">// get all of the other addresses for the parcel (if they exist)</span>
OPTIONAL MATCH (parc)--(alt_addrs:Parcel_Address)
WHERE ID(alt_addrs) &lt;&gt; ID(display_addr)

<span class="hljs-comment">// select some of the alt addrs, count the number of extras</span>
WITH result_list, parc, network_size, display_addr, display_addr_score, <span class="hljs-keyword">COUNT</span>(alt_addrs) <span class="hljs-keyword">AS</span> tot_alt_addrs, COLLECT(<span class="hljs-keyword">DISTINCT</span> alt_addrs.addr)[..<span class="hljs-variable">$max_alt_addrs</span>] <span class="hljs-keyword">AS</span> alt_addr_list
WITH result_list, parc, network_size, display_addr, display_addr_score, alt_addr_list, tot_alt_addrs - SIZE(alt_addr_list) <span class="hljs-keyword">AS</span> num_extra_addrs <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> display_addr_score <span class="hljs-keyword">DESC</span>
WITH result_list + COLLECT({
  <span class="hljs-keyword">score</span>: display_addr_score,            <span class="hljs-comment">// the full text index score of the match</span>
  network_size: network_size,           <span class="hljs-comment">// the number of properties in the property&#x27;s network  </span>
  result_name: display_addr.addr,       <span class="hljs-comment">// street address of the matched parcel</span>
  result_type: LABELS(display_addr)[0], <span class="hljs-comment">// &quot;Parcel_Address&quot;</span>
  result_id: parc.block_lot             <span class="hljs-comment">// block lot of matched parcel</span>
}) <span class="hljs-keyword">AS</span> result_list
`;

<span class="hljs-keyword">const</span> business_lookup = `
<span class="hljs-comment">// now search for all of the businesses</span>
CALL <span class="hljs-keyword">db</span>.index.fulltext.queryNodes(
&#x27;businessEntityNameIndex&#x27;, <span class="hljs-variable">$search</span>) 
YIELD node <span class="hljs-keyword">AS</span> business, <span class="hljs-keyword">score</span> <span class="hljs-keyword">AS</span> be_score
WHERE be_score &gt; <span class="hljs-variable">$score_threshold</span>

<span class="hljs-comment">// count the number of properties in the network</span>
OPTIONAL MATCH (<span class="hljs-keyword">n</span>:A_Parcel)
WHERE <span class="hljs-keyword">n</span>.network_id = business.network_id
WITH result_list, business, be_score, CASE WHEN <span class="hljs-keyword">n</span> IS NULL THEN 0 <span class="hljs-keyword">ELSE</span> <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">n</span>) END <span class="hljs-keyword">AS</span> network_size

<span class="hljs-comment">// group together the results for the businesses, combine with list for parcels</span>
WITH result_list + COLLECT({
  <span class="hljs-keyword">score</span>: be_score,                      <span class="hljs-comment">// the full text index score of the match</span>
  network_size: network_size,           <span class="hljs-comment">// the number of properties in the business&#x27;s network</span>
  result_name: business.name_norm,      <span class="hljs-comment">// normalized name of matched business</span>
  result_type: LABELS(business)[0],     <span class="hljs-comment">// &quot;SOS_LP&quot; or &quot;SOS_Corp&quot;</span>
  result_id: business.name_norm         <span class="hljs-comment">// normalized name of matched business </span>
}) <span class="hljs-keyword">AS</span> result_list
`;

<span class="hljs-keyword">const</span> query_sort_and_return = `
<span class="hljs-comment">// unwind list and re-sort (to interleave parcels and businesses)</span>
UNWIND result_list <span class="hljs-keyword">AS</span> result
WITH result <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> result.<span class="hljs-keyword">score</span> <span class="hljs-keyword">DESC</span>

<span class="hljs-keyword">RETURN</span> result
`;

function createLuceneSearchTerm(<span class="hljs-keyword">search</span>) {
  let luceneSearch = <span class="hljs-keyword">search</span>.<span class="hljs-keyword">replace</span>(/[+\-!(){}[\]\^&quot;~*?:\\/]/<span class="hljs-keyword">g</span>, &#x27;\\$&amp;&#x27;) <span class="hljs-comment">// escape all single-character Lucene special characters</span>
  luceneSearch = luceneSearch.<span class="hljs-keyword">replace</span>(/&amp;&amp;/<span class="hljs-keyword">g</span>, &#x27;\\&amp;&amp;&#x27;) <span class="hljs-comment">// escape all &quot;&amp;&amp;&quot;</span>
  luceneSearch = luceneSearch.<span class="hljs-keyword">replace</span>(/\|\|/<span class="hljs-keyword">g</span>, &#x27;\\\|\|&#x27;) <span class="hljs-comment">// escape all &quot;||&quot;</span>

  <span class="hljs-comment">// comment back in to implement fuzzy searching</span>
  <span class="hljs-comment">// luceneSearch = luceneSearch.replace(/(?&lt;=^|\s)\S+(?=\s|$)/g, &#x27;$&amp;~&#x27;) // add &quot;fuzzy search&quot; operator to end of each search term</span>
  <span class="hljs-comment">// note cannot use \b for word boundaries because we want to include all special characters as the search terms</span>

  <span class="hljs-keyword">return</span> luceneSearch
}

export async function searchQueryHandler(
    <span class="hljs-keyword">app</span>, <span class="hljs-keyword">search</span>, include_parcels = true, include_businesses = true,
    score_threshold = 1.0, max_alt_addrs = 10) {
  <span class="hljs-keyword">if</span> (!include_parcels &amp;&amp; !include_businesses) {
    throw <span class="hljs-string">&quot;v2 search: nothing to search for. at least one of include_parcels and include_businesses should be set true.&quot;</span>;
  }
  <span class="hljs-comment">// Assemble query based on the indexes we&#x27;re searching through.</span>
  let <span class="hljs-keyword">query</span> = query_start;
  <span class="hljs-keyword">if</span> (include_parcels) {
    <span class="hljs-keyword">query</span> = <span class="hljs-keyword">query</span> + parcel_lookup;
  }
  <span class="hljs-keyword">if</span> (include_businesses) {
    <span class="hljs-keyword">query</span> = <span class="hljs-keyword">query</span> + business_lookup;
  }
  <span class="hljs-keyword">query</span> = <span class="hljs-keyword">query</span> + query_sort_and_return;

  <span class="hljs-keyword">const</span> session = <span class="hljs-keyword">app</span>.locals.neo4jDriver.session();

  <span class="hljs-keyword">const</span> lucene_search = createLuceneSearchTerm(<span class="hljs-keyword">search</span>);

  try {
    <span class="hljs-comment">// Uses FullText search to look up businesses and properties. For properties,</span>
    <span class="hljs-comment">// finds top parcel address variations </span>
    <span class="hljs-comment">// most similar to search term. Then finds the parcels associated</span>
    <span class="hljs-comment">// with those addresses, and finds all of the different address</span>
    <span class="hljs-comment">// variations for those parcels.</span>

    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> ensure that search term is properly escaped for special characters </span>
    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> turn limit into a parameter from route so this can be used for general purposes.</span>
    <span class="hljs-keyword">const</span> result = await session.<span class="hljs-keyword">run</span>(
      <span class="hljs-keyword">query</span>,
      {
        <span class="hljs-keyword">search</span>: lucene_search,
        score_threshold: score_threshold,
        max_alt_addrs: max_alt_addrs
      }
    );
    let results = [];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> record_ind <span class="hljs-keyword">in</span> result.records) {
      <span class="hljs-keyword">const</span> record = result.records[record_ind];

      results.push(record.<span class="hljs-built_in">get</span>(0));
    }
    <span class="hljs-keyword">return</span> results;
  } finally {
    await session.<span class="hljs-keyword">close</span>();
  } 
}

<span class="hljs-comment">// Wrapper around the queryHandler to satisfy service interface.</span>
export async function handleSearchMethod(<span class="hljs-keyword">app</span>, request_data, response_data) {
  <span class="hljs-comment">// Support for selective filtering of categories. If a filter list is</span>
  <span class="hljs-comment">// present, then allow only the categories that are enumerated in the list.</span>
  <span class="hljs-comment">// Otherwise, allow all categories.</span>
  let include_parcels = true;
  let include_businesses = true;

  <span class="hljs-keyword">if</span> (Array.isArray(request_data.category_filter)
      &amp;&amp; request_data.category_filter.length &gt; 0) {
    <span class="hljs-comment">// String keys here are the enum names from Category in</span>
    <span class="hljs-comment">// type_definitions/proto/search/search.proto</span>
    include_parcels = request_data.category_filter.includes(<span class="hljs-string">&quot;PARCEL&quot;</span>);
    include_businesses = request_data.category_filter.includes(<span class="hljs-string">&quot;BUSINESS_ENTITY&quot;</span>);
  }

  <span class="hljs-comment">// queryHandler returns a list of result objs. in order to satisfy the</span>
  <span class="hljs-comment">// service method interface, wrap this list in an object so it has a</span>
  <span class="hljs-comment">// meaningful property name.</span>
  <span class="hljs-keyword">const</span> queryHandlerResult = await searchQueryHandler(
    <span class="hljs-keyword">app</span>, request_data.<span class="hljs-keyword">query</span>, include_parcels, include_businesses);

  response_data.records = queryHandlerResult;

  <span class="hljs-keyword">return</span> statusUtils.okStatus();
}

export default {
  searchQueryHandler: searchQueryHandler,
  handleSearchMethod: handleSearchMethod
};
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverresthandlersqueryservicehandler.js"><a href="#toc"><a name="server-rest-handlers-query-servicehandler-js">server/rest/handlers/query/serviceHandler.js</a></a></h2>
<pre><code><span class="hljs-comment">// ebookDataSFService/index.js</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Constructs and exports a local service handler for SF query abstraction layer.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// As of 2021/05/11, handles only the &#x27;search&#x27; call. This is to allow that call</span>
<span class="hljs-comment">// to be used seamlessly in the &#x27;unified search&#x27; api, which combines the</span>
<span class="hljs-comment">// database&#x27;s search results with in-memory neighborhood lookup.</span>

<span class="hljs-keyword">import</span> serviceUtils <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../framework/serviceUtils.js&#x27;</span>;
<span class="hljs-keyword">import</span> { handleSearchMethod } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./search/search.js&#x27;</span>;

<span class="hljs-keyword">const</span> queryHandler = serviceUtils.<span class="hljs-title function_">buildServiceHandler</span>(<span class="hljs-string">&quot;EvictorbookQueryService&quot;</span>);

<span class="hljs-comment">// Note: Registering service handler in &#x27;schema-less&#x27; mode, as V2 Data calls</span>
<span class="hljs-comment">// are still in flux.</span>
queryHandler.<span class="hljs-title function_">registerCallback</span>(<span class="hljs-string">&quot;DatabaseSearch&quot;</span>, handleSearchMethod);

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> queryHandler;
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverresthandlersqueryutil_queriesadjnetwork.js"><a href="#toc"><a name="server-rest-handlers-query-util_queries-adjnetwork-js">server/rest/handlers/query/util_queries/adjNetwork.js</a></a></h2>
<pre><code>const adj_network_query = `

// note lack <span class="hljs-keyword">of</span> OPTIONAL MATCH here (will <span class="hljs-keyword">return</span> [] <span class="hljs-keyword">if</span> <span class="hljs-keyword">no</span> related networks)
MATCH (n:Network)-[r]-(adj_network:Network)
<span class="hljs-keyword">WHERE</span> n.network_id = network_id

<span class="hljs-keyword">WITH</span> r, adj_network.network_id <span class="hljs-keyword">AS</span> adj_network_id

// <span class="hljs-keyword">get</span> the number <span class="hljs-keyword">of</span> parcels <span class="hljs-keyword">in</span> the network
OPTIONAL MATCH (parc:A_Parcel)
<span class="hljs-keyword">WHERE</span> parc.network_id = adj_network_id
<span class="hljs-keyword">WITH</span> r, adj_network_id, COUNT(parc) <span class="hljs-keyword">AS</span> num_parcels, SUM(TOINTEGER(parc.units)) <span class="hljs-keyword">AS</span> num_units // handles <span class="hljs-keyword">NULL</span> unit counts <span class="hljs-keyword">as</span> <span class="hljs-number">0</span>

<span class="hljs-keyword">WHERE</span> num_parcels &gt; <span class="hljs-number">0</span> // <span class="hljs-keyword">only</span> <span class="hljs-keyword">show</span> related networks <span class="hljs-keyword">with</span> properties <span class="hljs-keyword">in</span> portfolio

// <span class="hljs-keyword">get</span> the most connected business
OPTIONAL MATCH (n:SOS_LP) 
<span class="hljs-keyword">WHERE</span> n.network_id = adj_network_id
<span class="hljs-keyword">WITH</span> r, adj_network_id, num_parcels, num_units, <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> n <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">THEN</span> [] <span class="hljs-keyword">ELSE</span> COLLECT(n) <span class="hljs-keyword">END</span> <span class="hljs-keyword">AS</span> be_list
OPTIONAL MATCH (n:SOS_Corp) 
<span class="hljs-keyword">WHERE</span> n.network_id = adj_network_id
<span class="hljs-keyword">WITH</span> r, adj_network_id, num_parcels, num_units, <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> n <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">THEN</span> be_list <span class="hljs-keyword">ELSE</span> COLLECT(n) + be_list <span class="hljs-keyword">END</span> <span class="hljs-keyword">AS</span> be_list

UNWIND (<span class="hljs-keyword">CASE</span> be_list <span class="hljs-keyword">WHEN</span> [] <span class="hljs-keyword">THEN</span> [<span class="hljs-keyword">NULL</span>] <span class="hljs-keyword">ELSE</span> be_list <span class="hljs-keyword">END</span>) <span class="hljs-keyword">AS</span> n
// TODO <span class="hljs-comment">-- specify only to use LISTED_AT and ENTITY_OWNED_BY relationships to calculate degree </span>
// (<span class="hljs-keyword">or</span> <span class="hljs-keyword">add</span> rel_be_degree <span class="hljs-keyword">to</span> <span class="hljs-keyword">all</span> businesses <span class="hljs-keyword">in</span> network)
<span class="hljs-keyword">WITH</span> r, adj_network_id, num_parcels, num_units, n, SIZE(()<span class="hljs-comment">--(n)) AS degree ORDER BY degree DESC</span>
<span class="hljs-keyword">WITH</span> r, adj_network_id, num_parcels, num_units, <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> COUNT(n) &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">THEN</span> COLLECT(n)[<span class="hljs-number">0</span>] <span class="hljs-keyword">ELSE</span> [<span class="hljs-keyword">NULL</span>] <span class="hljs-keyword">END</span> <span class="hljs-keyword">AS</span> top_be_list

UNWIND top_be_list <span class="hljs-keyword">AS</span> top_be

// <span class="hljs-keyword">get</span> the most connected business <span class="hljs-keyword">owner</span>
OPTIONAL MATCH (n:SOS_Owner) 
<span class="hljs-keyword">WHERE</span> n.network_id = adj_network_id
<span class="hljs-keyword">WITH</span> r, adj_network_id, num_parcels, num_units, top_be, n <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> n.rel_be_degree // note this uses a different metric <span class="hljs-keyword">from</span> the above
<span class="hljs-keyword">WITH</span> r, adj_network_id, num_parcels, num_units, top_be, <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> COUNT(n) &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">THEN</span> COLLECT(n)[<span class="hljs-number">0</span>] <span class="hljs-keyword">ELSE</span> [<span class="hljs-keyword">NULL</span>] <span class="hljs-keyword">END</span> <span class="hljs-keyword">AS</span> top_owner_list

UNWIND top_owner_list <span class="hljs-keyword">AS</span> top_owner

// <span class="hljs-keyword">get</span> the most connected address
OPTIONAL MATCH (n:Address_Unit) 
<span class="hljs-keyword">WHERE</span> n.network_id = adj_network_id
<span class="hljs-keyword">WITH</span> r, adj_network_id, num_parcels, num_units, top_be, top_owner, n <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> n.rel_be_degree // note this uses a different metric <span class="hljs-keyword">from</span> the above
<span class="hljs-keyword">WITH</span> r, adj_network_id, num_parcels, num_units, top_be, top_owner, <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> COUNT(n) &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">THEN</span> COLLECT(n)[<span class="hljs-number">0</span>] <span class="hljs-keyword">ELSE</span> [<span class="hljs-keyword">NULL</span>] <span class="hljs-keyword">END</span> <span class="hljs-keyword">AS</span> top_addr_list

UNWIND top_addr_list <span class="hljs-keyword">AS</span> top_addr

<span class="hljs-keyword">WITH</span> adj_network_id, {
  network_description: {
    network_id: adj_network_id,
    num_parcels: num_parcels,
    num_units: num_units, 
    top_be: top_be.name_norm,
    top_owner: top_owner.name_norm,
    top_addr: top_addr.addr_readable
  },
  match_explanation: {
    businesses_listed_at_addrs: <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> r.addr_be_match <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">THEN</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">ELSE</span> {
      num_addrs: r.addr_be_match[<span class="hljs-number">0</span>],
      num_businesses: r.addr_be_match[<span class="hljs-number">1</span>]
    } <span class="hljs-keyword">END</span>,
    related_to_excluded: <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> r.excluded_match <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">THEN</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">ELSE</span> {
      num_related_to_excluded: r.excluded_match[<span class="hljs-number">0</span>] + r.excluded_match[<span class="hljs-number">1</span>]
    } <span class="hljs-keyword">END</span>,
    businesses_owning_parcels: <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> r.po_be_match <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">THEN</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">ELSE</span> {
      num_businesses: r.po_be_match[<span class="hljs-number">0</span>],
      num_parcels: r.po_be_match[<span class="hljs-number">1</span>]
    } <span class="hljs-keyword">END</span>,
    parcels_owned_by_same_non_business_owner: <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> r.non_be_prop_owner_match <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">THEN</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">ELSE</span> {
      num_parcels: r.non_be_prop_owner_match[<span class="hljs-number">0</span>] + r.non_be_prop_owner_match[<span class="hljs-number">1</span>]
    } <span class="hljs-keyword">END</span>,
    similar_addresses: <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> r.addr_match <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">THEN</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">ELSE</span> {
      highest_similarity: r.addr_match
    } <span class="hljs-keyword">END</span>    
  }
} <span class="hljs-keyword">AS</span> adj_network_desc <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> num_parcels <span class="hljs-keyword">DESC</span>, num_units <span class="hljs-keyword">DESC</span> // sort <span class="hljs-keyword">by</span> first # <span class="hljs-keyword">of</span> parcels <span class="hljs-keyword">and</span> <span class="hljs-keyword">then</span> units

<span class="hljs-keyword">WITH</span> COLLECT(<span class="hljs-keyword">DISTINCT</span> adj_network_desc) <span class="hljs-keyword">AS</span> adj_list

<span class="hljs-keyword">RETURN</span> adj_list
`;

export <span class="hljs-keyword">default</span> adj_network_query;</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverresthandlersquerytestindex.js"><a href="#toc"><a name="server-rest-handlers-querytest-index-js">server/rest/handlers/queryTest/index.js</a></a></h2>
<pre><code><span class="hljs-comment">// &#x27;Test&#x27; query handlers.</span>
<span class="hljs-keyword">import</span> { sampleTestHandler } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./sample&#x27;</span>;

<span class="hljs-comment">// assemble queryHandler callbacks in a map to be stored in app.locals.</span>
<span class="hljs-comment">// this allows us to inject mock queryHandler functions as dependencies in unit</span>
<span class="hljs-comment">// tests.</span>

<span class="hljs-comment">// add additional test handlers here (search for &quot;Adding Test Queries&quot; in the code </span>
<span class="hljs-comment">// base to see other main places code should be added)</span>

const queryTestHandlers = {
  <span class="hljs-string">&quot;sample&quot;</span>: sampleTestHandler
};

export <span class="hljs-keyword">default</span> queryTestHandlers;
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverresthandlersquerytestsample.js"><a href="#toc"><a name="server-rest-handlers-querytest-sample-js">server/rest/handlers/queryTest/sample.js</a></a></h2>
<pre><code><span class="hljs-comment">// sample.js</span>

<span class="hljs-comment">// boilerplate test query handler, currently returns nothing</span>
<span class="hljs-comment">// use as example for creating additional test handlers</span>

<span class="hljs-comment">// (search for &quot;Adding Test Queries&quot; in the code </span>
<span class="hljs-comment">// base to see other main places code should be added)</span>

<span class="hljs-keyword">const</span> query = <span class="hljs-string">&#x27;RETURN NULL&#x27;</span>;

<span class="hljs-function">export <span class="hljs-keyword">async</span> function <span class="hljs-title">sampleTestHandler</span>(<span class="hljs-params">app, query_param</span>)</span> {
  <span class="hljs-comment">// note this queries against the Test neo4j instance,</span>
  <span class="hljs-comment">// rather than the default </span>
  
  <span class="hljs-comment">// to use the default neo4j instance, use </span>
  <span class="hljs-comment">// const session = app.locals.neo4jDriver.session();</span>

  <span class="hljs-keyword">const</span> session = app.locals.neo4jDriverTest.session();
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> session.run(
      query,
      { query_param: query_param}
    );
    <span class="hljs-keyword">let</span> results = [];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> record_ind <span class="hljs-keyword">in</span> result.records) {
      <span class="hljs-keyword">const</span> <span class="hljs-keyword">record</span> = result.records[record_ind];
      results.push(<span class="hljs-keyword">record</span>.<span class="hljs-keyword">get</span>(<span class="hljs-number">0</span>));
    }
    <span class="hljs-keyword">return</span> results;
  } <span class="hljs-keyword">finally</span> {
    <span class="hljs-keyword">await</span> session.close();
  } 
}

export <span class="hljs-literal">default</span> {
  sampleTestHandler,
};
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverresthandlersquerytestservicehandler.js"><a href="#toc"><a name="server-rest-handlers-querytest-servicehandler-js">server/rest/handlers/queryTest/serviceHandler.js</a></a></h2>
<pre><code><span class="hljs-comment">// ebookDataSFTestService/index.js</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Constructs and exports a local service handler for test SF query abstraction layer.</span>

<span class="hljs-keyword">import</span> serviceUtils <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../framework/serviceUtils.js&#x27;</span>;
<span class="hljs-keyword">import</span> { sampleTestHandler } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./sample.js&#x27;</span>;

<span class="hljs-keyword">const</span> queryTestHandler = serviceUtils.<span class="hljs-title function_">buildServiceHandler</span>(<span class="hljs-string">&quot;EvictorbookQueryTestService&quot;</span>);

<span class="hljs-comment">// Note: Registering service handler in &#x27;schema-less&#x27; mode, as V2 Data calls</span>
<span class="hljs-comment">// are still in flux.</span>
queryTestHandler.<span class="hljs-title function_">registerCallback</span>(<span class="hljs-string">&quot;SampleTest&quot;</span>, sampleTestHandler);

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> queryTestHandler;
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverresthandlersunifiedsearchsearch.js"><a href="#toc"><a name="server-rest-handlers-unifiedsearch-search-js">server/rest/handlers/unifiedSearch/search.js</a></a></h2>
<pre><code><span class="hljs-comment">// search.js</span>

<span class="hljs-comment">// libraries and utilities included from source:</span>
<span class="hljs-keyword">import</span> { checkProto } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../framework/protoUtils&#x27;</span>;
<span class="hljs-keyword">import</span> serviceUtils <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../framework/serviceUtils&#x27;</span>;
<span class="hljs-keyword">import</span> statusUtils <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../framework/statusUtils&#x27;</span>;
<span class="hljs-keyword">import</span> { capsToTitleCase } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../utils/gnarly/stringUtils&#x27;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">NeighborhoodConfigData</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../configData/neighborhoods&#x27;</span>;

<span class="hljs-comment">//////////////////////////////////////////////////////////////</span>
<span class="hljs-comment">// Handler for:</span>
<span class="hljs-comment">// EbookSearchService (Unified search API)</span>
<span class="hljs-comment">// as defined in type_definitions/proto/search/search.proto</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">//   rest api route: GET &#x27;/api/search?q=&lt;query&gt;&#x27;</span>
<span class="hljs-comment">//     where &lt;query&gt; is a url-safe search string.</span>
<span class="hljs-comment">//   rpc Search(SearchRequest) returns (SearchResponse);</span>
<span class="hljs-comment">///////////////////////////////////////////////////////////////</span>

<span class="hljs-comment">// Arbitrary score thresholds to assign to matching neighborhoods.</span>
<span class="hljs-comment">// These will be compared with raw scored from the graph db&#x27;s index search.</span>
<span class="hljs-comment">// Those scores aren&#x27;t normalized, but are monotonically increasing and tend</span>
<span class="hljs-comment">// place the top results at approx 5.0.</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">MAX_NEIGHBORHOOD_SCORE</span> = <span class="hljs-number">6.0</span>;
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">MIN_MATCHING_NEIGHBORHOOD_SCORE</span> = <span class="hljs-number">4.0</span>;

<span class="hljs-comment">// Limit on how many neighborhoods should appear in search results.</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">MAX_NEIGHBORHOOD_RESULTS</span> = <span class="hljs-number">3</span>;

<span class="hljs-keyword">const</span> categoryToLabelMap = {
  <span class="hljs-string">&quot;PARCEL&quot;</span>: <span class="hljs-string">&quot;Address&quot;</span>,
  <span class="hljs-string">&quot;NEIGHBORHOOD_SUMMARY&quot;</span>: <span class="hljs-string">&quot;Neighborhood&quot;</span>,
  <span class="hljs-string">&quot;BUSINESS_ENTITY&quot;</span>: <span class="hljs-string">&quot;Owner&quot;</span>
}

<span class="hljs-comment">// helper function:</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// convert a single business entity query result to a SearchResult obj.</span>
<span class="hljs-comment">// expects qresult to match proto schema query.BusinessEntityIndexRecord, or to</span>
<span class="hljs-comment">// the search result schema returned by /api/v2/search.</span>
<span class="hljs-keyword">const</span> processBusinessQueryResult = <span class="hljs-keyword">function</span>(<span class="hljs-params">qresult</span>) {
  <span class="hljs-keyword">var</span> search_result = {};

  <span class="hljs-comment">// businesss name is name_norm in V1 query schema, result_name when</span>
  <span class="hljs-comment">// returned via /api/v2/search.</span>
  <span class="hljs-keyword">const</span> businessName = qresult.<span class="hljs-property">name_norm</span> || qresult.<span class="hljs-property">result_name</span> || <span class="hljs-literal">null</span>;
  <span class="hljs-comment">// graph node&#x27;s type is __typename in V1 query schema, result_type when</span>
  <span class="hljs-comment">// returned via /api/v2/search.</span>
  <span class="hljs-keyword">const</span> nodeType = qresult.<span class="hljs-property">__typename</span> || qresult.<span class="hljs-property">result_type</span> || <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">if</span> (!businessName || !nodeType) {
    <span class="hljs-comment">// info from this query result is not actionable.</span>
    <span class="hljs-comment">// IMPORTANT: caught within the loop, so we continue to the next item.</span>
    <span class="hljs-keyword">throw</span> <span class="hljs-string">&quot;probably bug: missing info in be-search qresult. &quot;</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(qresult);
  }

  <span class="hljs-comment">// Use string value for enums, see note in search proto.</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Write tests to ensure this string is one of the legal enum values.</span>
  <span class="hljs-comment">// Longer term, remove this hack.</span>
  search_result.<span class="hljs-property">category</span> = <span class="hljs-string">&quot;BUSINESS_ENTITY&quot;</span>;
  search_result.<span class="hljs-property">category_label</span> = categoryToLabelMap[<span class="hljs-string">&quot;BUSINESS_ENTITY&quot;</span>];

  <span class="hljs-comment">// extract info from the business entity&#x27;s typename:</span>
  <span class="hljs-keyword">let</span> beTypeUriParam;   <span class="hljs-comment">// &#x27;corp&#x27; or &#x27;lp&#x27;, for building uri.</span>
  <span class="hljs-keyword">let</span> beTypeEnumLabel;  <span class="hljs-comment">// string value of enum, see note above.</span>
  <span class="hljs-keyword">switch</span> (nodeType) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;SOS_Corp&quot;</span>:
      beTypeUriParam = <span class="hljs-string">&quot;corp&quot;</span>;
      beTypeEnumLabel = <span class="hljs-string">&quot;CALIF_SOS_CORP&quot;</span>;
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;SOS_LP&quot;</span>:
      beTypeUriParam = <span class="hljs-string">&quot;lp&quot;</span>;
      beTypeEnumLabel = <span class="hljs-string">&quot;CALIF_SOS_LP&quot;</span>;
      <span class="hljs-keyword">break</span>;
    <span class="hljs-attr">default</span>:
      <span class="hljs-comment">// IMPORTANT: caught within the loop, will continue to next item.</span>
      <span class="hljs-keyword">throw</span> <span class="hljs-string">&quot;unrecognized be typename: &quot;</span> + nodeType +
        <span class="hljs-string">&quot; ind: &quot;</span> + ind + <span class="hljs-string">&quot; qresult: &quot;</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(qresult);
  }

  <span class="hljs-comment">// category-specific payload:</span>
  <span class="hljs-keyword">const</span> payload = {};  <span class="hljs-comment">// proto schema: search.BusinessSearchPayload</span>
  payload.<span class="hljs-property">db_node_type</span> = nodeType;
  payload.<span class="hljs-property">business_type</span> = beTypeEnumLabel;
  payload.<span class="hljs-property">canonical_name</span> = businessName;
  payload.<span class="hljs-property">canonical_name_safe</span> = <span class="hljs-built_in">encodeURIComponent</span>(payload.<span class="hljs-property">canonical_name</span>);
  payload.<span class="hljs-property">display_name</span> = <span class="hljs-title function_">capsToTitleCase</span>(payload.<span class="hljs-property">canonical_name</span>).<span class="hljs-title function_">trim</span>();

  <span class="hljs-comment">// add completed payload to result:</span>
  search_result.<span class="hljs-property">business_data</span> = payload;

  <span class="hljs-comment">// finally, main result fields:</span>
  search_result.<span class="hljs-property">label</span> = payload.<span class="hljs-property">display_name</span>;

  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Update these to be dynamic for V1/V2 api and React routes.</span>
  search_result.<span class="hljs-property">details_url</span> =
    <span class="hljs-string">&#x27;/owner?search=&#x27;</span> + payload.<span class="hljs-property">canonical_name_safe</span> + <span class="hljs-string">&#x27;&amp;be=&#x27;</span> + beTypeUriParam;
  search_result.<span class="hljs-property">api_url</span> =
    <span class="hljs-string">&#x27;/api/&#x27;</span> + beTypeUriParam + <span class="hljs-string">&#x27;/&#x27;</span> + payload.<span class="hljs-property">canonical_name_safe</span>;

  <span class="hljs-comment">// Only populated for v2 database search results:</span>
  <span class="hljs-keyword">if</span> (qresult.<span class="hljs-property">score</span>) {
    search_result.<span class="hljs-property">ranking_info</span> = { <span class="hljs-attr">raw_score</span>: qresult.<span class="hljs-property">score</span> };
  }

  <span class="hljs-keyword">return</span> search_result;
};



<span class="hljs-comment">// helper function:</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// convert a single parcel query result to a SearchResult obj.</span>
<span class="hljs-comment">// expects qresult to match proto schema query.ParcelIndexRecord or the</span>
<span class="hljs-comment">// response schema of results returned by /api/v2/search query handler.</span>
<span class="hljs-keyword">const</span> processParcelQueryResult = <span class="hljs-keyword">function</span>(<span class="hljs-params">qresult</span>) {
  <span class="hljs-keyword">var</span> search_result = {};

  <span class="hljs-comment">// Address is addr in the V1 query layer, result_name in /api/v2/search.</span>
  <span class="hljs-keyword">const</span> rawAddress = qresult.<span class="hljs-property">addr</span> || qresult.<span class="hljs-property">result_name</span> || <span class="hljs-literal">null</span>;
  <span class="hljs-comment">// Parcel keys are block_lot in V1 query layer, result_id in /api/v2/search.</span>
  <span class="hljs-keyword">const</span> blockLot = qresult.<span class="hljs-property">block_lot</span> || qresult.<span class="hljs-property">result_id</span> || <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">if</span> (!rawAddress || !blockLot) {
    <span class="hljs-comment">// info from this query result is not actionable.</span>
    <span class="hljs-comment">// IMPORTANT: caught within the loop, will continue to next item.</span>
    <span class="hljs-keyword">throw</span> <span class="hljs-string">&quot;probably bug: missing info in parcel-search qresult. &quot;</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(qresult);
  }

  <span class="hljs-comment">// Use string value for enums, see note in search proto.</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Write tests to ensure this string is one of the legal enum values.</span>
  <span class="hljs-comment">// Longer term, remove this hack.</span>
  search_result.<span class="hljs-property">category</span> = <span class="hljs-string">&quot;PARCEL&quot;</span>;
  search_result.<span class="hljs-property">category_label</span> = categoryToLabelMap[<span class="hljs-string">&quot;PARCEL&quot;</span>];

  <span class="hljs-comment">// category-specific payload:</span>
  <span class="hljs-keyword">const</span> payload = {};  <span class="hljs-comment">// proto schema: search.ParcelSearchPayload</span>
  payload.<span class="hljs-property">block_lot</span> = blockLot;
  payload.<span class="hljs-property">block_lot_safe</span> = <span class="hljs-built_in">encodeURIComponent</span>(payload.<span class="hljs-property">block_lot</span>);
  payload.<span class="hljs-property">addr</span> = rawAddress;
  payload.<span class="hljs-property">display_addr</span> = <span class="hljs-title function_">capsToTitleCase</span>(payload.<span class="hljs-property">addr</span>).<span class="hljs-title function_">trim</span>();

  <span class="hljs-comment">// add completed payload to result:</span>
  search_result.<span class="hljs-property">parcel_data</span> = payload;

  <span class="hljs-comment">// finally, main result fields:</span>
  search_result.<span class="hljs-property">label</span> = payload.<span class="hljs-property">display_addr</span>;

  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Update these to be dynamic for V1/V2 api and React routes.</span>
  search_result.<span class="hljs-property">details_url</span> = <span class="hljs-string">&#x27;/parcel?bl=&#x27;</span> + payload.<span class="hljs-property">block_lot_safe</span>;
  search_result.<span class="hljs-property">api_url</span> =
    <span class="hljs-string">&#x27;/api/parcel/&#x27;</span> + payload.<span class="hljs-property">block_lot_safe</span> + <span class="hljs-string">&#x27;/details&#x27;</span>;

  <span class="hljs-keyword">if</span> (qresult.<span class="hljs-property">score</span>) {
    search_result.<span class="hljs-property">ranking_info</span> = { <span class="hljs-attr">raw_score</span>: qresult.<span class="hljs-property">score</span> };
  }

  <span class="hljs-keyword">return</span> search_result;
};

<span class="hljs-comment">// helper function:</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// search neighborhoods by name, return a list of matching neighborhood config</span>
<span class="hljs-comment">// data (which can be directly loaded into a neighborhood search result</span>
<span class="hljs-comment">// payload.)</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// adapted from &#x27;searchUtils.js&#x27; from production branch&#x27;s ui directory.</span>
<span class="hljs-keyword">const</span> searchNeighborhoods = <span class="hljs-keyword">function</span>(<span class="hljs-params">query_string</span>) {
  <span class="hljs-keyword">const</span> resultList = <span class="hljs-title class_">NeighborhoodConfigData</span>.<span class="hljs-property">neighborhoods</span>.<span class="hljs-title function_">map</span>(
      <span class="hljs-function"><span class="hljs-params">configEntry</span> =&gt;</span> {
        <span class="hljs-keyword">const</span> nameUpper = configEntry.<span class="hljs-property">canonical_name</span>;
        <span class="hljs-keyword">const</span> searchTermUpper = query_string.<span class="hljs-title function_">toUpperCase</span>();
        <span class="hljs-keyword">if</span> (nameUpper.<span class="hljs-title function_">indexOf</span>(searchTermUpper) &gt; -<span class="hljs-number">1</span>) {
          <span class="hljs-keyword">const</span> scoredEntry = { ...configEntry };  <span class="hljs-comment">// shallow copy.</span>
          <span class="hljs-comment">// Quick hack: linear interpolation, score neighborhood results</span>
          <span class="hljs-comment">// higher when the query string matches more of the name.</span>
          <span class="hljs-keyword">let</span> minScore = <span class="hljs-variable constant_">MIN_MATCHING_NEIGHBORHOOD_SCORE</span>;
          <span class="hljs-keyword">let</span> maxScore = <span class="hljs-variable constant_">MAX_NEIGHBORHOOD_SCORE</span>;
          <span class="hljs-keyword">if</span> (searchTermUpper.<span class="hljs-property">length</span> &lt;= <span class="hljs-number">2</span>) {
            <span class="hljs-comment">// For very short terms, it doesn&#x27;t make sense to rank highly.</span>
            minScore = minScore - <span class="hljs-number">2.0</span>;
          }
          <span class="hljs-keyword">const</span> scoreRange = maxScore - minScore;

          <span class="hljs-keyword">const</span> substringLenRatio = (searchTermUpper.<span class="hljs-property">length</span> / nameUpper.<span class="hljs-property">length</span>);
          <span class="hljs-keyword">const</span> prefixModifier =
            (nameUpper.<span class="hljs-title function_">indexOf</span>(searchTermUpper) === <span class="hljs-number">0</span>) ? <span class="hljs-number">2.0</span> : -<span class="hljs-number">0.5</span>;

          scoredEntry.<span class="hljs-property">score</span> = (
            minScore +
            prefixModifier +
            ((substringLenRatio) * (scoreRange)));
          <span class="hljs-keyword">return</span> scoredEntry;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
      }).<span class="hljs-title function_">filter</span>(
        <span class="hljs-function"><span class="hljs-params">configEntry</span> =&gt;</span> configEntry !== <span class="hljs-literal">null</span>
      );

  <span class="hljs-keyword">return</span> resultList;
};

<span class="hljs-comment">// helper function:</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// assemble neighborhood config payload into search result.</span>
<span class="hljs-keyword">const</span> processNeighborhoodResult = <span class="hljs-keyword">function</span>(<span class="hljs-params">raw_neighborhood_result</span>) {
  <span class="hljs-comment">// if we&#x27;re here, the neighborhood search fn returned a valid payload.</span>
  <span class="hljs-comment">// assemble the search result:</span>
  <span class="hljs-keyword">const</span> search_result = {};

  <span class="hljs-comment">// Use string value for enums, see note in search proto.</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Write tests to ensure this string is one of the legal enum values.</span>
  <span class="hljs-comment">// Longer term, remove this hack.</span>
  search_result.<span class="hljs-property">category</span> = <span class="hljs-string">&quot;NEIGHBORHOOD_SUMMARY&quot;</span>;
  search_result.<span class="hljs-property">category_label</span> = categoryToLabelMap[<span class="hljs-string">&quot;NEIGHBORHOOD_SUMMARY&quot;</span>];

  <span class="hljs-keyword">const</span> payload = {
    <span class="hljs-attr">canonical_name</span>: raw_neighborhood_result.<span class="hljs-property">canonical_name</span>,
    <span class="hljs-attr">canonical_name_safe</span>: raw_neighborhood_result.<span class="hljs-property">canonical_name_safe</span>,
    <span class="hljs-attr">display_name</span>: raw_neighborhood_result.<span class="hljs-property">display_name</span>,
    <span class="hljs-attr">id</span>: raw_neighborhood_result.<span class="hljs-property">id</span>
  };

  search_result.<span class="hljs-property">neighborhood_data</span> = payload;

  <span class="hljs-comment">// finally, main result fields:</span>
  search_result.<span class="hljs-property">label</span> = payload.<span class="hljs-property">display_name</span>;

  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Update these to be dynamic for V1/V2 api and React routes.</span>
  search_result.<span class="hljs-property">details_url</span> =
    <span class="hljs-string">&#x27;/neighborhood?search=&#x27;</span> + payload.<span class="hljs-property">canonical_name_safe</span>;
  search_result.<span class="hljs-property">api_url</span> =
    <span class="hljs-string">&#x27;/api/neighborhood/&#x27;</span> + payload.<span class="hljs-property">canonical_name_safe</span>;

  <span class="hljs-keyword">if</span> (raw_neighborhood_result.<span class="hljs-property">score</span>) {
    search_result.<span class="hljs-property">ranking_info</span> = { <span class="hljs-attr">raw_score</span>: raw_neighborhood_result.<span class="hljs-property">score</span> };
  }

  <span class="hljs-keyword">return</span> search_result;
};

<span class="hljs-comment">// helper function:</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Given a populted response_data, apply re-ranking / post-processing to the</span>
<span class="hljs-comment">// result list. This could include post-filtering results by some criteria,</span>
<span class="hljs-comment">// re-scoring to accomodate relevance information that&#x27;s not captured in the</span>
<span class="hljs-comment">// graph, and/or interleaving to provide a coherent result set across several</span>
<span class="hljs-comment">// document types.</span>
<span class="hljs-keyword">const</span> postrankAndFilterSearchResults = <span class="hljs-keyword">function</span>(<span class="hljs-params">response_data</span>) {
  <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(response_data.<span class="hljs-property">results</span>)) <span class="hljs-keyword">return</span>;

  <span class="hljs-comment">// Sort by raw-score.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> This would be a good place to apply a fudge-factor for</span>
  <span class="hljs-comment">// raising or lowering certain businesses in result rankings.</span>
  response_data.<span class="hljs-property">results</span>.<span class="hljs-title function_">sort</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">first,second</span>) {
    <span class="hljs-keyword">const</span> safeGetScore = <span class="hljs-keyword">function</span>(<span class="hljs-params">result</span>) {
      <span class="hljs-keyword">if</span> (!result || !result.<span class="hljs-property">ranking_info</span> || !result.<span class="hljs-property">ranking_info</span>.<span class="hljs-property">raw_score</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-number">0.0</span>;
      }
      <span class="hljs-keyword">return</span> result.<span class="hljs-property">ranking_info</span>.<span class="hljs-property">raw_score</span>;
    };

    <span class="hljs-comment">// We want high-scoring results to appear earlier, so second-first gives</span>
    <span class="hljs-comment">// the correct ordering.</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">safeGetScore</span>(second) - <span class="hljs-title function_">safeGetScore</span>(first);
  });

  <span class="hljs-comment">// Count neighborhood results and prune if there are too many.</span>
  <span class="hljs-comment">// !!! HACK ALERT: This is extremely gross. !!!</span>
  <span class="hljs-keyword">let</span> neighborhoodsSeen = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> ind = <span class="hljs-number">0</span>; ind &lt; response_data.<span class="hljs-property">results</span>.<span class="hljs-property">length</span>; ind++) {
    <span class="hljs-keyword">if</span> (response_data.<span class="hljs-property">results</span>[ind].<span class="hljs-property">category</span> === <span class="hljs-string">&quot;NEIGHBORHOOD_SUMMARY&quot;</span>) {
      neighborhoodsSeen++;
      <span class="hljs-keyword">if</span> (neighborhoodsSeen &gt; <span class="hljs-variable constant_">MAX_NEIGHBORHOOD_RESULTS</span>) {
        <span class="hljs-comment">// sentinel value. replace the entry to mark for deletion, then delete</span>
        <span class="hljs-comment">// in a second pass.</span>
        response_data.<span class="hljs-property">results</span>[ind] = <span class="hljs-string">&quot;DELETE_ME&quot;</span>;
      }
    }
  }
  <span class="hljs-comment">// Remove the elements that were soft-deleted above. (Keep elements that</span>
  <span class="hljs-comment">// aren&#x27;t equal to the sentinel value.)</span>
  response_data.<span class="hljs-property">results</span> = response_data.<span class="hljs-property">results</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">elem</span>) {
    <span class="hljs-keyword">return</span> elem !== <span class="hljs-string">&quot;DELETE_ME&quot;</span>;
  });
  <span class="hljs-comment">// !!! End of HACK ALERT !!!</span>
};

<span class="hljs-comment">//////////////////////////////////////////////////////////////</span>
<span class="hljs-comment">// Actual handler for EbookSearchService.Search rpc:</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">//   rest api route: GET &#x27;/api/search?q=&lt;query&gt;&#x27;</span>
<span class="hljs-comment">//     where &lt;query&gt; is a url-safe search string.</span>
<span class="hljs-comment">//   rpc Search(SearchRequest) returns (SearchResponse);</span>
<span class="hljs-comment">//////////////////////////////////////////////////////////////</span>

<span class="hljs-comment">// app: express &#x27;app&#x27; handle, as passed to an express route via &#x27;req&#x27;.</span>
<span class="hljs-comment">// request_data: plain obj that matches proto schema: search.SearchRequest</span>
<span class="hljs-comment">// response_data: plain obj that matches proto schema: search.SearchResponse</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleSearch</span>(<span class="hljs-params">app, request_data, response_data</span>) {
  <span class="hljs-comment">// ======================================================================</span>
  <span class="hljs-comment">// Collect parcel and neighborhood search results by calling their query</span>
  <span class="hljs-comment">// listeners, then populate the values into response obj.</span>
  <span class="hljs-comment">// ======================================================================</span>

  <span class="hljs-comment">// Rather than calling &#x27;await&#x27; on the handler results directly, start both</span>
  <span class="hljs-comment">// queries and allow them to run simultaneously, then &#x27;await&#x27; the promises.</span>
  <span class="hljs-keyword">let</span> beQueryPromise;
  <span class="hljs-keyword">let</span> parcelQueryPromise;

  beQueryPromise = app.<span class="hljs-property">locals</span>.<span class="hljs-property">services</span>.<span class="hljs-property">queryHandler</span>.<span class="hljs-title function_">invoke</span>(
    app, <span class="hljs-string">&quot;DatabaseSearch&quot;</span>,
    { <span class="hljs-attr">query</span>: request_data.<span class="hljs-property">query_string</span>, <span class="hljs-attr">category_filter</span>: [<span class="hljs-string">&quot;BUSINESS_ENTITY&quot;</span>] });

  parcelQueryPromise = app.<span class="hljs-property">locals</span>.<span class="hljs-property">services</span>.<span class="hljs-property">queryHandler</span>.<span class="hljs-title function_">invoke</span>(
    app, <span class="hljs-string">&quot;DatabaseSearch&quot;</span>,
    { <span class="hljs-attr">query</span>: request_data.<span class="hljs-property">query_string</span>, <span class="hljs-attr">category_filter</span>: [<span class="hljs-string">&quot;PARCEL&quot;</span>] });

  <span class="hljs-comment">// Business and parcel handlers both return a wrapper obj with &#x27;records&#x27; list.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// Await the results here and check for errors.</span>
  <span class="hljs-keyword">const</span> beQueryResponseOrError = <span class="hljs-keyword">await</span> beQueryPromise;
  <span class="hljs-keyword">if</span> (!serviceUtils.<span class="hljs-title function_">isResultOk</span>(beQueryResponseOrError)) {
    <span class="hljs-comment">// Log and continue, since we can still give partial results.</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;Unified Search: probably bug - BE search query returned error. &quot;</span> +
          <span class="hljs-string">&quot; query_string: &quot;</span> + request_data.<span class="hljs-property">query_string</span> + <span class="hljs-string">&quot;; &quot;</span> +
          <span class="hljs-string">&quot; error response: &quot;</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(beQueryResponseOrError));
  }

  <span class="hljs-keyword">const</span> parcelQueryResponseOrError = <span class="hljs-keyword">await</span> parcelQueryPromise;
  <span class="hljs-keyword">if</span> (!serviceUtils.<span class="hljs-title function_">isResultOk</span>(parcelQueryResponseOrError)) {
    <span class="hljs-comment">// Log and continue, since we can still give partial results.</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;Unified Search: probably bug - parcel search query returned error. &quot;</span> +
          <span class="hljs-string">&quot; query_string: &quot;</span> + request_data.<span class="hljs-property">query_string</span> + <span class="hljs-string">&quot;; &quot;</span> +
          <span class="hljs-string">&quot; error response: &quot;</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(parcelQueryResponseOrError));
  }

  <span class="hljs-comment">// for each query, extract a list of records from the method&#x27;s response data.</span>
  <span class="hljs-keyword">const</span> be_qresults = beQueryResponseOrError.<span class="hljs-property">records</span> || [];
  <span class="hljs-keyword">const</span> parcel_qresults = parcelQueryResponseOrError.<span class="hljs-property">records</span> || [];

  <span class="hljs-comment">// Retrieve neighborhood results from local helper function:</span>
  <span class="hljs-keyword">const</span> neighborhood_results = <span class="hljs-title function_">searchNeighborhoods</span>(request_data.<span class="hljs-property">query_string</span>) || [];


  <span class="hljs-comment">// ==================</span>
  <span class="hljs-comment">// populate results:</span>
  <span class="hljs-comment">// ==================</span>

  response_data.<span class="hljs-property">results</span> = [];

  <span class="hljs-comment">// First, we aggregate the results into a single list. Then, we&#x27;ll re-rank</span>
  <span class="hljs-comment">// and post filter to interleave results of various categories.</span>

  <span class="hljs-comment">// add the neighborhood results first:</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> ind <span class="hljs-keyword">in</span> neighborhood_results) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// as retrieved from server/configData/neighborhoods.js</span>
      <span class="hljs-comment">// (same schema as SearchProto.NeighborhoodSearchPayload, for now).</span>
      <span class="hljs-keyword">const</span> neighborhood_config = neighborhood_results[ind];

      <span class="hljs-keyword">if</span> (!neighborhood_config.<span class="hljs-property">canonical_name</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-string">&quot;probably bug: missing info in neighborhood result. &quot;</span> +
          <span class="hljs-string">&quot; query_string: &quot;</span> + request_data.<span class="hljs-property">query_string</span> +
          <span class="hljs-string">&quot; ind: &quot;</span> + i + <span class="hljs-string">&quot; qresult: &quot;</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(qresult);
      }

      <span class="hljs-keyword">const</span> search_result = <span class="hljs-title function_">processNeighborhoodResult</span>(neighborhood_config);

      <span class="hljs-comment">// add the response-format result to the main response_data.</span>
      response_data.<span class="hljs-property">results</span>.<span class="hljs-title function_">push</span>(search_result);
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;neighborhood search_result error, continuing: &#x27;</span>, err);
      <span class="hljs-keyword">continue</span>;
    }
  }

  <span class="hljs-comment">// then business results:</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> ind <span class="hljs-keyword">in</span> be_qresults) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// proto schema: query.BusinessEntityIndexRecord</span>
      <span class="hljs-keyword">const</span> qresult = be_qresults[ind];

      <span class="hljs-comment">// build a SearchResult data obj from the query result.</span>
      <span class="hljs-comment">// if this throws an error, we catch and continue to the next item.</span>
      <span class="hljs-comment">// proto schema: search.SearchResult:</span>
      <span class="hljs-keyword">const</span> search_result = <span class="hljs-title function_">processBusinessQueryResult</span>(qresult);

      <span class="hljs-comment">// add populated result to the main response_data.</span>
      response_data.<span class="hljs-property">results</span>.<span class="hljs-title function_">push</span>(search_result);
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;business entity search_result error, continuing: &#x27;</span>, err);
      <span class="hljs-keyword">continue</span>;
    }
  }

  <span class="hljs-comment">// now the parcel results:</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> ind <span class="hljs-keyword">in</span> parcel_qresults) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// proto schema: query.ParcelIndexRecord</span>
      <span class="hljs-keyword">const</span> qresult = parcel_qresults[ind];

      <span class="hljs-comment">// build a SearchResult data obj from the query result.</span>
      <span class="hljs-comment">// if this throws an error, we catch and continue to the next item.</span>
      <span class="hljs-comment">// proto schema: search.SearchResult:</span>
      <span class="hljs-keyword">const</span> search_result = <span class="hljs-title function_">processParcelQueryResult</span>(qresult);

      <span class="hljs-comment">// add the response-format result to the main response_data.</span>
      response_data.<span class="hljs-property">results</span>.<span class="hljs-title function_">push</span>(search_result);
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;parcel search_result error, continuing: &#x27;</span>, err);
      <span class="hljs-keyword">continue</span>;
    }
  }

  <span class="hljs-comment">// If we&#x27;re here, response_data obj is populated with all result types.</span>
  <span class="hljs-comment">// Re-rank the search results to apply a single coherent ranking.</span>
  <span class="hljs-title function_">postrankAndFilterSearchResults</span>(response_data);

  <span class="hljs-comment">// Now, the response_data obj is populated and it has the final</span>
  <span class="hljs-comment">// ranking/sorting. We can return without issue, since the service calling</span>
  <span class="hljs-comment">// framework will type-check the contents of response_data.</span>
  <span class="hljs-keyword">return</span> statusUtils.<span class="hljs-title function_">okStatus</span>();
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  handleSearch
};
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverresthandlersunifiedsearchservicehandler.js"><a href="#toc"><a name="server-rest-handlers-unifiedsearch-servicehandler-js">server/rest/handlers/unifiedSearch/serviceHandler.js</a></a></h2>
<pre><code><span class="hljs-comment">// ebookSearchService/index.js</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// constructs and exports a local service handler for EbookSearchService.</span>

<span class="hljs-keyword">import</span> <span class="hljs-title class_">Ajv</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;ajv&#x27;</span>;
<span class="hljs-keyword">import</span> serviceUtils <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../framework/serviceUtils.js&#x27;</span>;
<span class="hljs-keyword">import</span> { handleSearch } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./search&#x27;</span>;

<span class="hljs-comment">// Schema definitions to be used with Ajv json-schema validator:</span>
<span class="hljs-keyword">import</span> searchRequestSchema <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../schemas/src/unifiedSearch/search_request&#x27;</span>;
<span class="hljs-keyword">import</span> searchResponseSchema <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../schemas/src/unifiedSearch/search_response&#x27;</span>;

<span class="hljs-keyword">const</span> ajv = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Ajv</span>();

<span class="hljs-keyword">const</span> unifiedSearchHandler = serviceUtils.<span class="hljs-title function_">buildServiceHandler</span>(<span class="hljs-string">&quot;EbookSearchService&quot;</span>);

unifiedSearchHandler.<span class="hljs-title function_">registerCallback</span>(
  <span class="hljs-string">&quot;Search&quot;</span>, handleSearch,
    ajv.<span class="hljs-title function_">compile</span>(searchRequestSchema), ajv.<span class="hljs-title function_">compile</span>(searchResponseSchema));

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> unifiedSearchHandler;

</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverrestroutesconversionhelpers.js"><a href="#toc"><a name="server-rest-routes-conversionhelpers-js">server/rest/routes/conversionHelpers.js</a></a></h2>
<pre><code><span class="hljs-comment">// conversionHelpers.js</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// utilities for converting from one format to another in the rest api</span>
<span class="hljs-comment">// listeners, ex: converting between different proto messages.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// in the case of ebook&#x27;s rest listeners, some api 1.0 objects are not possible</span>
<span class="hljs-comment">// to represent directly as proto. this file contains helpers for dealing with</span>
<span class="hljs-comment">// those cases.</span>

<span class="hljs-comment">// convert a &#x27;network_subgraph&#x27; as it appears in the actual neo4j-driver query</span>
<span class="hljs-comment">// result to a format that&#x27;s compatible with proto type-checking. see</span>
<span class="hljs-comment">// type_definitions/proto/query/graph_util.proto</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// safety: the input object is unchanged, and the output object contains no</span>
<span class="hljs-comment">// references to its constituent objects.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// input: list of relations as expressed in the &#x27;network_subgraph&#x27; property of</span>
<span class="hljs-comment">//   the neo4j-driver response for Network queries (see</span>
<span class="hljs-comment">//   server/rest/handlers/network.js)</span>
<span class="hljs-comment">// output: list of obj&#x27;s matching GraphRelation protos, where &#x27;properties&#x27; map</span>
<span class="hljs-comment">//   is replaced with &#x27;properties_json.&#x27;</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> as of 2021/03/23, RestProto.GraphRelation and QueryProto.GraphRelation</span>
<span class="hljs-comment">// are semantically identical, so it doesn&#x27;t matter which one we use.</span>
<span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> update this conversion fn when/if the two protos diverge.</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">driverToProtoSubgraph</span>(<span class="hljs-params">driver_subgraph</span>) {
  <span class="hljs-keyword">var</span> relation_proto_list = [];  <span class="hljs-comment">// list of GraphRelation protos.</span>

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> ind = <span class="hljs-number">0</span>; ind &lt; driver_subgraph.<span class="hljs-property">length</span>; ind++) {
    <span class="hljs-keyword">const</span> driver_relation = driver_subgraph[ind];

    <span class="hljs-keyword">const</span> start_proto = {
      <span class="hljs-attr">identity</span>: driver_relation.<span class="hljs-property">start</span>.<span class="hljs-property">identity</span>,      <span class="hljs-comment">// number. value copy.</span>
      <span class="hljs-attr">labels</span>: [ ... driver_relation.<span class="hljs-property">start</span>.<span class="hljs-property">labels</span> ],  <span class="hljs-comment">// shallow copy (strings).</span>
      <span class="hljs-attr">properties_json</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(driver_relation.<span class="hljs-property">start</span>.<span class="hljs-property">properties</span>)
    };

    <span class="hljs-keyword">const</span> end_proto = {
      <span class="hljs-attr">identity</span>: driver_relation.<span class="hljs-property">end</span>.<span class="hljs-property">identity</span>,      <span class="hljs-comment">// number. value copy.</span>
      <span class="hljs-attr">labels</span>: [ ... driver_relation.<span class="hljs-property">end</span>.<span class="hljs-property">labels</span> ],  <span class="hljs-comment">// shallow copy (strings).</span>
      <span class="hljs-attr">properties_json</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(driver_relation.<span class="hljs-property">end</span>.<span class="hljs-property">properties</span>)
    };

    <span class="hljs-keyword">const</span> relation_proto = {
      <span class="hljs-attr">type</span>: driver_relation.<span class="hljs-property">type</span>,  <span class="hljs-comment">// string. value copy (strings are immutable)</span>
      <span class="hljs-attr">start</span>: start_proto,
      <span class="hljs-attr">end</span>: end_proto,
    };
    relation_proto_list.<span class="hljs-title function_">push</span>(relation_proto);
  }

  <span class="hljs-keyword">return</span> relation_proto_list;
}

<span class="hljs-comment">// reverse of the above conversion fn. convert a &#x27;network_subgraph&#x27; from</span>
<span class="hljs-comment">// proto-compatible format to neo4j-driver result format. see above.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// safety: the input object is unchanged, and the output object contains no</span>
<span class="hljs-comment">// references to its constituent objects.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// input: list of obj&#x27;s matching GraphRelation protos, where node properties</span>
<span class="hljs-comment">//   are expressed as &#x27;properties_json&#x27;.</span>
<span class="hljs-comment">// output: list of relations matching neo4j-driver output schema, where node</span>
<span class="hljs-comment">//   &#x27;properties&#x27; is a non-type-safe map of properties (values may be strings,</span>
<span class="hljs-comment">//   numbers, etc.)</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> as of 2021/03/23, RestProto.GraphRelation and QueryProto.GraphRelation</span>
<span class="hljs-comment">// are semantically identical, so it doesn&#x27;t matter which one we use.</span>
<span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> update this conversion fn when/if the two protos diverge.</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">protoToDriverSubgraph</span>(<span class="hljs-params">relation_proto_list</span>) {
  <span class="hljs-keyword">var</span> driver_subgraph = [];  <span class="hljs-comment">// list of neo4j-driver relation obj&#x27;s.</span>

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> ind = <span class="hljs-number">0</span>; ind &lt; relation_proto_list.<span class="hljs-property">length</span>; ind++) {
    <span class="hljs-keyword">const</span> relation_proto = relation_proto_list[ind];

    <span class="hljs-keyword">const</span> start_proto = relation_proto.<span class="hljs-property">start</span>;
    <span class="hljs-keyword">const</span> start_obj = {
      <span class="hljs-attr">identity</span>: start_proto.<span class="hljs-property">identity</span>,      <span class="hljs-comment">// number. value copy.</span>
      <span class="hljs-attr">labels</span>: [ ... start_proto.<span class="hljs-property">labels</span> ],  <span class="hljs-comment">// shallow copy (strings).</span>
      <span class="hljs-attr">properties</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(start_proto.<span class="hljs-property">properties_json</span>)
    };

    <span class="hljs-keyword">const</span> end_proto = relation_proto.<span class="hljs-property">end</span>;
    <span class="hljs-keyword">const</span> end_obj = {
      <span class="hljs-attr">identity</span>: end_proto.<span class="hljs-property">identity</span>,      <span class="hljs-comment">// number. value copy.</span>
      <span class="hljs-attr">labels</span>: [ ... end_proto.<span class="hljs-property">labels</span> ],  <span class="hljs-comment">// shallow copy (strings).</span>
      <span class="hljs-attr">properties</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(end_proto.<span class="hljs-property">properties_json</span>)
    };

    <span class="hljs-keyword">const</span> driver_relation = {
      <span class="hljs-attr">type</span>: relation_proto.<span class="hljs-property">type</span>,  <span class="hljs-comment">// string. value copy (strings are immutable)</span>
      <span class="hljs-attr">start</span>: start_obj,
      <span class="hljs-attr">end</span>: end_obj,
    };
    driver_subgraph.<span class="hljs-title function_">push</span>(driver_relation);
  }

  <span class="hljs-keyword">return</span> driver_subgraph;
}

<span class="hljs-comment">// helper function:</span>
<span class="hljs-comment">// convert the return value of a queryHandlers[&quot;network&quot;] call into</span>
<span class="hljs-comment">// proto-compatible format for type-checking.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// see driverToProtoSubgraph above.</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">driverToProtoNetworkResult</span>(<span class="hljs-params">driver_result</span>) {
  <span class="hljs-keyword">var</span> out_proto = { ... driver_result };  <span class="hljs-comment">// shallow copy</span>

  out_proto.<span class="hljs-property">network_subgraph</span> =
    <span class="hljs-title function_">driverToProtoSubgraph</span>(driver_result.<span class="hljs-property">network_subgraph</span>);

  <span class="hljs-keyword">return</span> out_proto;
}

<span class="hljs-comment">// helper function:</span>
<span class="hljs-comment">// convert a proto-compatible &#x27;network&#x27; query response to neo4j-driver</span>
<span class="hljs-comment">// compatible format, for direct comparison to queryHandlers[&quot;network&quot;] result</span>
<span class="hljs-comment">// and compatibility with api 1.0</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// accepts input obj conforming to any of the following protos:</span>
<span class="hljs-comment">//   QueryProto.NetworkParcelQueryResult</span>
<span class="hljs-comment">//   QueryProto.NetworkBusinessEntityQueryResult</span>
<span class="hljs-comment">//   RestProto.GetNetworkParcelResponse</span>
<span class="hljs-comment">//   RestProto.GetNetworkBusinessEntityResponse</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// see protoToDriverSubgraph above.</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">protoToDriverNetworkResult</span>(<span class="hljs-params">input_proto</span>) {
  <span class="hljs-keyword">var</span> out_obj = { ... input_proto };  <span class="hljs-comment">// shallow copy.</span>

  out_obj.<span class="hljs-property">network_subgraph</span> =
    <span class="hljs-title function_">protoToDriverSubgraph</span>(input_proto.<span class="hljs-property">network_subgraph</span>);

  <span class="hljs-keyword">return</span> out_obj;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  driverToProtoSubgraph,
  protoToDriverSubgraph,
  driverToProtoNetworkResult,
  protoToDriverNetworkResult
};
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverrestroutesdbroutelisteners.js"><a href="#toc"><a name="server-rest-routes-dbroutelisteners-js">server/rest/routes/dbRouteListeners.js</a></a></h2>
<pre><code><span class="hljs-comment">// dbRouteListeners.js</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Contains request listeners for the REST api endpoints.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Based on the original server/rest/routes/dbRoutes.js with business logic</span>
<span class="hljs-comment">// authored by dpsgit, as seen in the &#x27;production&#x27; branch. See commits:</span>
<span class="hljs-comment">// 67ce41aa, 28ab2d3b, and others.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// These functions can be invoked by registering as express &#x27;app&#x27; callbacks (see</span>
<span class="hljs-comment">// dbRouteSetup.js), or invoked directly in unit tests.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// In either case, this file&#x27;s listener function access data through</span>
<span class="hljs-comment">// queryHandler callback functions, stored in the app context.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// In production, query handler functions will invoke the neo4j db driver and</span>
<span class="hljs-comment">// issue a query to the database. In unit tests, these callbacks are mock</span>
<span class="hljs-comment">// functions which return injected test data.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Example usage:</span>
<span class="hljs-comment">//    const search_string = req.params.block_lot;</span>
<span class="hljs-comment">//    const queryResult = await</span>
<span class="hljs-comment">//        req.app.locals.queryHandlers[&quot;parcelEvictions&quot;](req.app, search_string);</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// These query handler callback functions must be async, by definition.</span>
<span class="hljs-comment">// See setup code in dbRouteSetup.js for the canonical list of keys.</span>

<span class="hljs-keyword">import</span> Ajv from <span class="hljs-string">&#x27;ajv&#x27;</span>;

<span class="hljs-keyword">import</span> { businessPostProcessing, relatedNetworkPostProcessing, networkNodePostProcessing } from <span class="hljs-string">&#x27;./dbRoutePostProcessing.js&#x27;</span>;

<span class="hljs-comment">// generate validator fns:</span>
<span class="hljs-type">const</span> <span class="hljs-variable">ajv</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Ajv</span>();

<span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Move the validation calls to the handlers themselves so they&#x27;re stored</span>
<span class="hljs-comment">// alongside the actual database lookups.</span>
<span class="hljs-type">const</span> <span class="hljs-variable">relatedNetworkListValidatorFn</span> <span class="hljs-operator">=</span> ajv.compile(require(<span class="hljs-string">&#x27;../../schemas/src/query/responses/common_related_network_response&#x27;</span>));
<span class="hljs-type">const</span> <span class="hljs-variable">portfolioListValidatorFn</span> <span class="hljs-operator">=</span> ajv.compile(require(<span class="hljs-string">&#x27;../../schemas/src/query/responses/common_portfolio_response&#x27;</span>));
<span class="hljs-type">const</span> <span class="hljs-variable">databaseSearchResultListValidatorFn</span> <span class="hljs-operator">=</span> ajv.compile(require(<span class="hljs-string">&#x27;../../schemas/src/query/responses/search_response&#x27;</span>));
<span class="hljs-type">const</span> <span class="hljs-variable">neighborhoodEvictionsValidatorFn</span> <span class="hljs-operator">=</span> ajv.compile(require(<span class="hljs-string">&#x27;../../schemas/src/query/responses/neighborhood_evictions_response&#x27;</span>));
<span class="hljs-type">const</span> <span class="hljs-variable">networkDetailsValidatorFn</span> <span class="hljs-operator">=</span> ajv.compile(require(<span class="hljs-string">&#x27;../../schemas/src/query/responses/network_details_response&#x27;</span>));
<span class="hljs-type">const</span> <span class="hljs-variable">networkGraphValidatorFn</span> <span class="hljs-operator">=</span> ajv.compile(require(<span class="hljs-string">&#x27;../../schemas/src/query/responses/network_graph_response&#x27;</span>));
<span class="hljs-type">const</span> <span class="hljs-variable">networkNodesValidatorFn</span> <span class="hljs-operator">=</span> ajv.compile(require(<span class="hljs-string">&#x27;../../schemas/src/query/responses/network_nodes_response&#x27;</span>));
<span class="hljs-type">const</span> <span class="hljs-variable">ownerDetailsValidatorFn</span> <span class="hljs-operator">=</span> ajv.compile(require(<span class="hljs-string">&#x27;../../schemas/src/query/responses/owner_business_details_response&#x27;</span>));
<span class="hljs-type">const</span> <span class="hljs-variable">ownerEvictionsValidatorFn</span> <span class="hljs-operator">=</span> ajv.compile(require(<span class="hljs-string">&#x27;../../schemas/src/query/responses/owner_evictions_response&#x27;</span>));
<span class="hljs-type">const</span> <span class="hljs-variable">ownerPortfolioValidatorFn</span> <span class="hljs-operator">=</span> ajv.compile(require(<span class="hljs-string">&#x27;../../schemas/src/query/responses/owner_portfolio_response&#x27;</span>));
<span class="hljs-type">const</span> <span class="hljs-variable">parcelDetailsValidatorFn</span> <span class="hljs-operator">=</span> ajv.compile(require(<span class="hljs-string">&#x27;../../schemas/src/query/responses/parcel_details_response&#x27;</span>));
<span class="hljs-type">const</span> <span class="hljs-variable">parcelEvictionsValidatorFn</span> <span class="hljs-operator">=</span> ajv.compile(require(<span class="hljs-string">&#x27;../../schemas/src/query/responses/parcel_evictions_response&#x27;</span>));
<span class="hljs-type">const</span> <span class="hljs-variable">parcelOwnersValidatorFn</span> <span class="hljs-operator">=</span> ajv.compile(require(<span class="hljs-string">&#x27;../../schemas/src/query/responses/parcel_owners_response&#x27;</span>));


<span class="hljs-comment">// =======================================================</span>
<span class="hljs-comment">// =======================================================</span>
<span class="hljs-comment">// </span>
<span class="hljs-comment">// REST LISTENERS FOR V2.0 DATABASE</span>
<span class="hljs-comment">// </span>
<span class="hljs-comment">// =======================================================</span>
<span class="hljs-comment">// =======================================================</span>


<span class="hljs-comment">// =======================================</span>
<span class="hljs-comment">//  REST listener for GetParcelDetails</span>
<span class="hljs-comment">//  uri: &#x27;/api/parcel/:parcel_id/details&#x27;</span>
<span class="hljs-comment">// =======================================</span>
export async function <span class="hljs-title function_">getParcelDetails</span><span class="hljs-params">(req, res)</span> {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// todo: validate the request.</span>

    <span class="hljs-comment">// assemble and execute query:</span>
    <span class="hljs-type">const</span> <span class="hljs-variable">search_string</span> <span class="hljs-operator">=</span> req.params.parcel_id;
    <span class="hljs-type">const</span> <span class="hljs-variable">queryResult</span> <span class="hljs-operator">=</span> await
      req.app.locals.queryHandlers[<span class="hljs-string">&quot;parcelDetails&quot;</span>](req.app, search_string);

    <span class="hljs-keyword">if</span> (!queryResult.parcel_details) {
      <span class="hljs-comment">// if there&#x27;s no parcel details expected, either something went wrong</span>
      <span class="hljs-comment">// with the database or the db returned an empty result. since we need a</span>
      <span class="hljs-comment">// little optimism, and because it lets usidentify this error case</span>
      <span class="hljs-comment">// easily, we&#x27;ll return 404 here.</span>
      res.status(<span class="hljs-number">404</span>).send(<span class="hljs-string">&quot;not found&quot;</span>);
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">if</span> (req.app.locals.dbRouteFlags.validate_query_responses &amp;&amp;
          !parcelDetailsValidatorFn(queryResult.parcel_details)) {
      console.error(parcelDetailsValidatorFn.errors);
      console.error(<span class="hljs-string">&quot;data: &quot;</span> + JSON.stringify(queryResult.parcel_details));
      <span class="hljs-keyword">throw</span> <span class="hljs-string">&quot;Query result didn&#x27;t pass validation!&quot;</span>;
    }

    <span class="hljs-comment">// post-processing:</span>
    <span class="hljs-comment">// We rely on the fact that there&#x27;s currently no transformation logic for</span>
    <span class="hljs-comment">// parcel/details. When/if we do add this logic (for example, to convert</span>
    <span class="hljs-comment">// addresses to friendly format), this will need to be validated</span>
    <span class="hljs-comment">// separately.</span>
    <span class="hljs-type">const</span> <span class="hljs-variable">responseBody</span> <span class="hljs-operator">=</span> {
      parcel_details: queryResult.parcel_details
    };

    <span class="hljs-comment">// write to response:</span>
    res.json(responseBody);
  } <span class="hljs-keyword">catch</span> (err) {
    console.error(<span class="hljs-string">&#x27;getParcelDetails error: &#x27;</span>, err);
    res.status(<span class="hljs-number">500</span>).send(<span class="hljs-string">&quot;internal error&quot;</span>);
  }
}

<span class="hljs-comment">// =========================================</span>
<span class="hljs-comment">//  REST listener for GetParcelEvictions</span>
<span class="hljs-comment">//  uri: &#x27;/api/parcel/:parcel_id/evictions&#x27;</span>
<span class="hljs-comment">// =========================================</span>
export async function <span class="hljs-title function_">getParcelEvictions</span><span class="hljs-params">(req, res)</span> {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// todo: validate the request.</span>

    <span class="hljs-comment">// assemble and execute query:</span>
    <span class="hljs-type">const</span> <span class="hljs-variable">search_string</span> <span class="hljs-operator">=</span> req.params.parcel_id;
    <span class="hljs-type">const</span> <span class="hljs-variable">queryResult</span> <span class="hljs-operator">=</span> await
      req.app.locals.queryHandlers[<span class="hljs-string">&quot;parcelEvictions&quot;</span>](req.app, search_string);

    <span class="hljs-keyword">if</span> (req.app.locals.dbRouteFlags.validate_query_responses &amp;&amp;
          !parcelEvictionsValidatorFn(queryResult)) {
      <span class="hljs-keyword">throw</span> <span class="hljs-string">&quot;Query result didn&#x27;t pass validation!&quot;</span>;
    }

    <span class="hljs-comment">// write to response:</span>
    res.json(queryResult);
  } <span class="hljs-keyword">catch</span> (err) {
    console.error(<span class="hljs-string">&#x27;getParcelEvictions error: &#x27;</span>, err);
    res.status(<span class="hljs-number">500</span>).send(<span class="hljs-string">&quot;internal error&quot;</span>);
  }
}

<span class="hljs-comment">// ========================================</span>
<span class="hljs-comment">//  REST listener for GetParcelNetworks</span>
<span class="hljs-comment">//  uri: &#x27;/api/parcel/:parcel_id/portfolio&#x27;</span>
<span class="hljs-comment">// ========================================</span>
export async function <span class="hljs-title function_">getParcelPortfolio</span><span class="hljs-params">(req, res)</span> {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// todo: validate the request.</span>

    <span class="hljs-comment">// assemble and execute query:</span>
    <span class="hljs-type">const</span> <span class="hljs-variable">search_string</span> <span class="hljs-operator">=</span> req.params.parcel_id;
    <span class="hljs-type">const</span> <span class="hljs-variable">queryResult</span> <span class="hljs-operator">=</span> await
      req.app.locals.queryHandlers[<span class="hljs-string">&quot;parcelPortfolio&quot;</span>](req.app, search_string);

    <span class="hljs-keyword">if</span> (req.app.locals.dbRouteFlags.validate_query_responses &amp;&amp;
          !parcelPortfolioValidatorFn(queryResult)) {
      <span class="hljs-keyword">throw</span> <span class="hljs-string">&quot;Query result didn&#x27;t pass validation!&quot;</span>;
    }

    <span class="hljs-type">const</span> <span class="hljs-variable">responseBody</span> <span class="hljs-operator">=</span> queryResult;

    res.json(responseBody);
  } <span class="hljs-keyword">catch</span> (err) {
    console.error(<span class="hljs-string">&#x27;getParcelPortfolio error: &#x27;</span>, err);
    res.status(<span class="hljs-number">500</span>).send(<span class="hljs-string">&quot;internal error&quot;</span>);
  }
}

<span class="hljs-comment">// ======================================</span>
<span class="hljs-comment">//  REST listener for GetParcelOwners</span>
<span class="hljs-comment">//  uri: &#x27;/api/parcel/:parcel_id/owners&#x27;</span>
<span class="hljs-comment">// ======================================</span>
export async function <span class="hljs-title function_">getParcelOwners</span><span class="hljs-params">(req, res)</span> {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// todo: validate the request.</span>

    <span class="hljs-comment">// assemble and execute query:</span>
    <span class="hljs-type">const</span> <span class="hljs-variable">search_string</span> <span class="hljs-operator">=</span> req.params.parcel_id;
    <span class="hljs-type">const</span> <span class="hljs-variable">queryResult</span> <span class="hljs-operator">=</span> await
      req.app.locals.queryHandlers[<span class="hljs-string">&quot;parcelOwners&quot;</span>](req.app, search_string);

    <span class="hljs-keyword">if</span> (req.app.locals.dbRouteFlags.validate_query_responses &amp;&amp;
          !parcelOwnersValidatorFn(queryResult)) {
      <span class="hljs-keyword">throw</span> <span class="hljs-string">&quot;Query result didn&#x27;t pass validation!&quot;</span>;
    }

    res.json(queryResult);
  } <span class="hljs-keyword">catch</span> (err) {
    console.error(<span class="hljs-string">&#x27;getParcelOwners error: &#x27;</span>, err);
    res.status(<span class="hljs-number">500</span>).send(<span class="hljs-string">&quot;internal error&quot;</span>);
  }
}

<span class="hljs-comment">// =====================================================</span>
<span class="hljs-comment">//  REST listener for GetParcelNetworkDetails</span>
<span class="hljs-comment">//  uri: GET &#x27;/api/parcel/:parcel_id/networkDetails&#x27;</span>
<span class="hljs-comment">// =====================================================</span>
export <span class="hljs-type">const</span> <span class="hljs-variable">getParcelNetworkDetails</span> <span class="hljs-operator">=</span> async <span class="hljs-title function_">function</span><span class="hljs-params">(req, res)</span> {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// todo: validate the request.</span>

    <span class="hljs-comment">// assemble and execute query:</span>
    <span class="hljs-type">const</span> <span class="hljs-variable">search_string</span> <span class="hljs-operator">=</span> req.params.parcel_id;

    <span class="hljs-type">const</span> <span class="hljs-variable">queryResult</span> <span class="hljs-operator">=</span> await req.app.locals.queryHandlers[<span class="hljs-string">&quot;parcelNetworkDetails&quot;</span>](
      req.app, search_string);

    <span class="hljs-comment">// if (req.app.locals.dbRouteFlags.validate_query_responses &amp;&amp;</span>
    <span class="hljs-comment">//       !networkDetailsValidatorFn(queryResult)) {</span>
    <span class="hljs-comment">//   throw &quot;Query result didn&#x27;t pass validation!&quot;;</span>
    <span class="hljs-comment">// }</span>

    res.json(queryResult);
  } <span class="hljs-keyword">catch</span> (err) {
    console.error(<span class="hljs-string">&#x27;getParcelNetworkDetails error: &#x27;</span>, err);
    res.status(<span class="hljs-number">500</span>).send(<span class="hljs-string">&quot;internal error&quot;</span>);
  }
};

<span class="hljs-comment">// ======================================</span>
<span class="hljs-comment">//  REST listener for GetParcelRelatedNetworks</span>
<span class="hljs-comment">//  uri: &#x27;/api/parcel/:parcel_id/relatedNetworks&#x27;</span>
<span class="hljs-comment">// ======================================</span>
export async function <span class="hljs-title function_">getParcelRelatedNetworks</span><span class="hljs-params">(req, res)</span> {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// todo: validate the request.</span>

    <span class="hljs-comment">// assemble and execute query:</span>
    <span class="hljs-type">const</span> <span class="hljs-variable">search_string</span> <span class="hljs-operator">=</span> req.params.parcel_id;
    <span class="hljs-type">const</span> <span class="hljs-variable">queryResult</span> <span class="hljs-operator">=</span> await
      req.app.locals.queryHandlers[<span class="hljs-string">&quot;parcelRelatedNetworks&quot;</span>](
        req.app, search_string);

    <span class="hljs-type">const</span> <span class="hljs-variable">restructured_data</span> <span class="hljs-operator">=</span> relatedNetworkPostProcessing(queryResult);

    <span class="hljs-comment">// confirm queryHandler response fits the expected schema:</span>
    <span class="hljs-keyword">if</span> (req.app.locals.dbRouteFlags.validate_query_responses &amp;&amp;
          !relatedNetworksListValidatorFn(restructured_data)) {
      <span class="hljs-keyword">throw</span> <span class="hljs-string">&quot;Query result didn&#x27;t pass validation!&quot;</span>;
    }

    res.json(restructured_data);
  } <span class="hljs-keyword">catch</span> (err) {
    console.error(<span class="hljs-string">&#x27;getParcelRelatedNetworks error: &#x27;</span>, err);
    res.status(<span class="hljs-number">500</span>).send(<span class="hljs-string">&quot;internal error&quot;</span>);
  }
}

<span class="hljs-comment">// ===============================</span>
<span class="hljs-comment">//  REST listener for GetOwnerDetails</span>
<span class="hljs-comment">//  uri: &#x27;/api/owner/:business_type/:business_id/details&#x27;</span>
<span class="hljs-comment">// ===============================</span>
export <span class="hljs-type">const</span> <span class="hljs-variable">getOwnerDetails</span> <span class="hljs-operator">=</span> async <span class="hljs-title function_">function</span><span class="hljs-params">(req, res)</span> {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// todo: validate the request.</span>

    <span class="hljs-comment">// assemble and execute query:</span>
    <span class="hljs-type">const</span> <span class="hljs-variable">search_string</span> <span class="hljs-operator">=</span> req.params.business_id;
    <span class="hljs-type">const</span> <span class="hljs-variable">be_type</span> <span class="hljs-operator">=</span> req.params.business_type;

    <span class="hljs-keyword">if</span> (be_type !== <span class="hljs-string">&quot;lp&quot;</span>
        &amp;&amp; be_type !== <span class="hljs-string">&quot;corp&quot;</span>) {
      <span class="hljs-comment">// wrong input_type.</span>
      res.status(<span class="hljs-number">400</span>).send(
        <span class="hljs-string">&#x27;Invalid business entity search type (must be &quot;lp&quot; or &quot;corp&quot;)&#x27;</span>);
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-type">const</span> <span class="hljs-variable">queryResult</span> <span class="hljs-operator">=</span> await
      req.app.locals.queryHandlers[<span class="hljs-string">&quot;ownerDetails&quot;</span>](
        req.app, be_type, search_string);

    <span class="hljs-comment">// confirm queryHandler response fits the expected schema:</span>
    <span class="hljs-keyword">if</span> (req.app.locals.dbRouteFlags.validate_query_responses &amp;&amp;
          !ownerDetailsValidatorFn(queryResult)) {
      <span class="hljs-keyword">throw</span> <span class="hljs-string">&quot;Query result didn&#x27;t pass validation!&quot;</span>;
    }

    <span class="hljs-comment">// here, we modify the contents of the result and re-map short string keys</span>
    <span class="hljs-comment">// to human-readable labels.</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// this is the behavior of the april 2020 preview build.</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// however, this approach has some limitations. for example, it could be</span>
    <span class="hljs-comment">// useful for the client to have access to both a short code and a</span>
    <span class="hljs-comment">// human-readable label, and the current api does not allow these.</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// another property of this approach: query abstraction layer and rest</span>
    <span class="hljs-comment">// layer have fields with identical names but very different semantics.</span>
    <span class="hljs-comment">// this increases cognitive load for maintainers, and as a result can be</span>
    <span class="hljs-comment">// considered error-prone.</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// todo: revisit this api. as a potential model for annotated readable</span>
    <span class="hljs-comment">// labels, see address components in g__maps geocoding api.</span>

    <span class="hljs-comment">// now, back to the actual post-processing...</span>

    <span class="hljs-type">let</span> <span class="hljs-variable">restructured_data</span> <span class="hljs-operator">=</span> businessPostProcessing(be_type, queryResult);

    <span class="hljs-comment">// all done, set result in response body.</span>
    res.json(restructured_data);
  } <span class="hljs-keyword">catch</span> (err) {
    console.error(<span class="hljs-string">&#x27;getOwnerDetails error: &#x27;</span>, err);
    res.status(<span class="hljs-number">500</span>).send(<span class="hljs-string">&quot;internal error&quot;</span>);
  }
};

<span class="hljs-comment">// ===============================</span>
<span class="hljs-comment">//  REST listener for GetOwnerEvictions</span>
<span class="hljs-comment">//  uri: &#x27;/api/owner/:business_type/:business_id/evictions&#x27;</span>
<span class="hljs-comment">// ===============================</span>
export <span class="hljs-type">const</span> <span class="hljs-variable">getOwnerEvictions</span> <span class="hljs-operator">=</span> async <span class="hljs-title function_">function</span><span class="hljs-params">(req, res)</span> {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// todo: validate the request.</span>

    <span class="hljs-comment">// assemble and execute query:</span>
    <span class="hljs-type">const</span> <span class="hljs-variable">search_string</span> <span class="hljs-operator">=</span> req.params.business_id;
    <span class="hljs-type">const</span> <span class="hljs-variable">be_type</span> <span class="hljs-operator">=</span> req.params.business_type;

    <span class="hljs-keyword">if</span> (be_type !== <span class="hljs-string">&quot;lp&quot;</span>
        &amp;&amp; be_type !== <span class="hljs-string">&quot;corp&quot;</span>) {
      <span class="hljs-comment">// wrong input_type.</span>
      res.status(<span class="hljs-number">400</span>).send(
        <span class="hljs-string">&#x27;Invalid business entity search type (must be &quot;lp&quot; or &quot;corp&quot;)&#x27;</span>);
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-type">const</span> <span class="hljs-variable">queryResult</span> <span class="hljs-operator">=</span> await
      req.app.locals.queryHandlers[<span class="hljs-string">&quot;ownerEvictions&quot;</span>](
        req.app, be_type, search_string);

    <span class="hljs-keyword">if</span> (req.app.locals.dbRouteFlags.validate_query_responses &amp;&amp;
          !ownerEvictionsValidatorFn(queryResult)) {
      <span class="hljs-keyword">throw</span> <span class="hljs-string">&quot;Query result didn&#x27;t pass validation!&quot;</span>;
    }

    <span class="hljs-comment">// all done, set result in response body.</span>
    res.json(queryResult);
  } <span class="hljs-keyword">catch</span> (err) {
    console.error(<span class="hljs-string">&#x27;getOwnerEvictions error: &#x27;</span>, err);
    res.status(<span class="hljs-number">500</span>).send(<span class="hljs-string">&quot;internal error&quot;</span>);
  }
};

<span class="hljs-comment">// ===============================</span>
<span class="hljs-comment">//  REST listener for GetOwnerPortfolio</span>
<span class="hljs-comment">//  uri: &#x27;/api/owner/:business_type/:business_id/portfolio&#x27;</span>
<span class="hljs-comment">// ===============================</span>
export <span class="hljs-type">const</span> <span class="hljs-variable">getOwnerPortfolio</span> <span class="hljs-operator">=</span> async <span class="hljs-title function_">function</span><span class="hljs-params">(req, res)</span> {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// todo: validate the request.</span>

    <span class="hljs-comment">// assemble and execute query:</span>
    <span class="hljs-type">const</span> <span class="hljs-variable">search_string</span> <span class="hljs-operator">=</span> req.params.business_id;
    <span class="hljs-type">const</span> <span class="hljs-variable">be_type</span> <span class="hljs-operator">=</span> req.params.business_type;

    <span class="hljs-keyword">if</span> (be_type !== <span class="hljs-string">&quot;lp&quot;</span>
        &amp;&amp; be_type !== <span class="hljs-string">&quot;corp&quot;</span>) {
      <span class="hljs-comment">// wrong input_type.</span>
      res.status(<span class="hljs-number">400</span>).send(
        <span class="hljs-string">&#x27;Invalid business entity search type (must be &quot;lp&quot; or &quot;corp&quot;)&#x27;</span>);
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-type">const</span> <span class="hljs-variable">queryResult</span> <span class="hljs-operator">=</span> await
      req.app.locals.queryHandlers[<span class="hljs-string">&quot;ownerPortfolio&quot;</span>](
        req.app, be_type, search_string);

    <span class="hljs-keyword">if</span> (req.app.locals.dbRouteFlags.validate_query_responses &amp;&amp;
          !ownerPortfolioValidatorFn(queryResult)) {
      <span class="hljs-keyword">throw</span> <span class="hljs-string">&quot;Query result didn&#x27;t pass validation!&quot;</span>;
    }

    <span class="hljs-comment">// all done, set result in response body.</span>
    res.json(queryResult);
  } <span class="hljs-keyword">catch</span> (err) {
    console.error(<span class="hljs-string">&#x27;getOwnerPortfolio error: &#x27;</span>, err);
    res.status(<span class="hljs-number">500</span>).send(<span class="hljs-string">&quot;internal error&quot;</span>);
  }
};

<span class="hljs-comment">// =====================================================</span>
<span class="hljs-comment">//  REST listener for GetOwnerNetworkDetails</span>
<span class="hljs-comment">//  uri: GET &#x27;/api/owner/:business_type/:business_id/networkDetails&#x27;</span>
<span class="hljs-comment">// =====================================================</span>
export <span class="hljs-type">const</span> <span class="hljs-variable">getOwnerNetworkDetails</span> <span class="hljs-operator">=</span> async <span class="hljs-title function_">function</span><span class="hljs-params">(req, res)</span> {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// todo: validate the request.</span>

    <span class="hljs-comment">// assemble and execute query:</span>
    <span class="hljs-type">const</span> <span class="hljs-variable">search_string</span> <span class="hljs-operator">=</span> req.params.business_id;
    <span class="hljs-type">const</span> <span class="hljs-variable">be_type</span> <span class="hljs-operator">=</span> req.params.business_type;

    <span class="hljs-keyword">if</span> (be_type !== <span class="hljs-string">&quot;lp&quot;</span>
        &amp;&amp; be_type !== <span class="hljs-string">&quot;corp&quot;</span>) {
      <span class="hljs-comment">// wrong input_type.</span>
      res.status(<span class="hljs-number">400</span>).send(
        <span class="hljs-string">&#x27;Invalid business entity search type (must be &quot;lp&quot; or &quot;corp&quot;)&#x27;</span>);
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-type">const</span> <span class="hljs-variable">queryResult</span> <span class="hljs-operator">=</span> await req.app.locals.queryHandlers[<span class="hljs-string">&quot;ownerNetworkDetails&quot;</span>](
      req.app, be_type, search_string);

    <span class="hljs-comment">// if (req.app.locals.dbRouteFlags.validate_query_responses &amp;&amp;</span>
    <span class="hljs-comment">//       !networkDetailsValidatorFn(queryResult)) {</span>
    <span class="hljs-comment">//   throw &quot;Query result didn&#x27;t pass validation!&quot;;</span>
    <span class="hljs-comment">// }</span>

    res.json(queryResult);
  } <span class="hljs-keyword">catch</span> (err) {
    console.error(<span class="hljs-string">&#x27;getOwnerNetworkDetails error: &#x27;</span>, err);
    res.status(<span class="hljs-number">500</span>).send(<span class="hljs-string">&quot;internal error&quot;</span>);
  }
};

<span class="hljs-comment">// ===============================</span>
<span class="hljs-comment">//  REST listener for GetOwnerRelatedNetworks</span>
<span class="hljs-comment">//  uri: &#x27;/api/owner/:business_type/:business_id/relatedNetworks&#x27;</span>
<span class="hljs-comment">// ===============================</span>
export <span class="hljs-type">const</span> <span class="hljs-variable">getOwnerRelatedNetworks</span> <span class="hljs-operator">=</span> async <span class="hljs-title function_">function</span><span class="hljs-params">(req, res)</span> {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// todo: validate the request.</span>

    <span class="hljs-comment">// assemble and execute query:</span>
    <span class="hljs-type">const</span> <span class="hljs-variable">search_string</span> <span class="hljs-operator">=</span> req.params.business_id;
    <span class="hljs-type">const</span> <span class="hljs-variable">be_type</span> <span class="hljs-operator">=</span> req.params.business_type;

    <span class="hljs-keyword">if</span> (be_type !== <span class="hljs-string">&quot;lp&quot;</span>
        &amp;&amp; be_type !== <span class="hljs-string">&quot;corp&quot;</span>) {
      <span class="hljs-comment">// wrong input_type.</span>
      res.status(<span class="hljs-number">400</span>).send(
        <span class="hljs-string">&#x27;Invalid business entity search type (must be &quot;lp&quot; or &quot;corp&quot;)&#x27;</span>);
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-type">const</span> <span class="hljs-variable">queryResult</span> <span class="hljs-operator">=</span> await
      req.app.locals.queryHandlers[<span class="hljs-string">&quot;ownerRelatedNetworks&quot;</span>](
        req.app, be_type, search_string);

    <span class="hljs-type">const</span> <span class="hljs-variable">restructured_data</span> <span class="hljs-operator">=</span> relatedNetworkPostProcessing(queryResult);

    <span class="hljs-keyword">if</span> (req.app.locals.dbRouteFlags.validate_query_responses &amp;&amp;
          !relatedNetworkListValidatorFn(restructured_data)) {
      <span class="hljs-keyword">throw</span> <span class="hljs-string">&quot;Query result didn&#x27;t pass validation!&quot;</span>;
    }

    <span class="hljs-comment">// all done, set result in response body.</span>
    res.json(restructured_data);
  } <span class="hljs-keyword">catch</span> (err) {
    console.error(<span class="hljs-string">&#x27;getOwnerRelatedNetworks error: &#x27;</span>, err);
    res.status(<span class="hljs-number">500</span>).send(<span class="hljs-string">&quot;internal error&quot;</span>);
  }
};

<span class="hljs-comment">// =====================================================</span>
<span class="hljs-comment">//  REST listener for GetNetworkDetails</span>
<span class="hljs-comment">//  uri: GET &#x27;/api/network/:network_id/details&#x27;</span>
<span class="hljs-comment">// =====================================================</span>
export <span class="hljs-type">const</span> <span class="hljs-variable">getNetworkDetails</span> <span class="hljs-operator">=</span> async <span class="hljs-title function_">function</span><span class="hljs-params">(req, res)</span> {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// assemble and execute query:</span>

    <span class="hljs-comment">// parse params from strings. do this explicitly here to avoid relying on</span>
    <span class="hljs-comment">// edge cases for string-to-number conversion later on. Math.floor() does</span>
    <span class="hljs-comment">// string-to-number conversion and returns integer part.</span>
    <span class="hljs-comment">//   &quot;&quot; -&gt; 0 -&gt; default, undefined -&gt; NaN -&gt; default, &quot;2.1&quot; -&gt; 2</span>
    <span class="hljs-type">const</span> <span class="hljs-variable">network_id</span> <span class="hljs-operator">=</span> Math.floor(req.params.network_id);

    <span class="hljs-type">const</span> <span class="hljs-variable">queryResult</span> <span class="hljs-operator">=</span> await req.app.locals.queryHandlers[<span class="hljs-string">&quot;networkDetails&quot;</span>](
      req.app, network_id);

    <span class="hljs-keyword">if</span> (req.app.locals.dbRouteFlags.validate_query_responses &amp;&amp;
          !networkDetailsValidatorFn(queryResult)) {
      <span class="hljs-keyword">throw</span> <span class="hljs-string">&quot;Query result didn&#x27;t pass validation!&quot;</span>;
    }

    res.json(queryResult);
  } <span class="hljs-keyword">catch</span> (err) {
    console.error(<span class="hljs-string">&#x27;getNetworkDetails error: &#x27;</span>, err);
    res.status(<span class="hljs-number">500</span>).send(<span class="hljs-string">&quot;internal error&quot;</span>);
  }
};

<span class="hljs-comment">// =====================================================</span>
<span class="hljs-comment">//  REST listener for GetNetworkNodes</span>
<span class="hljs-comment">//  uri: GET &#x27;/api/network/:network_id/nodes&#x27;</span>
<span class="hljs-comment">// =====================================================</span>
export <span class="hljs-type">const</span> <span class="hljs-variable">getNetworkNodes</span> <span class="hljs-operator">=</span> async <span class="hljs-title function_">function</span><span class="hljs-params">(req, res)</span> {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// assemble and execute query:</span>

    <span class="hljs-comment">// parse params from strings. do this explicitly here to avoid relying on</span>
    <span class="hljs-comment">// edge cases for string-to-number conversion later on. Math.floor() does</span>
    <span class="hljs-comment">// string-to-number conversion and returns integer part.</span>
    <span class="hljs-comment">//   &quot;&quot; -&gt; 0 -&gt; default, undefined -&gt; NaN -&gt; default, &quot;2.1&quot; -&gt; 2</span>
    <span class="hljs-type">const</span> <span class="hljs-variable">network_id</span> <span class="hljs-operator">=</span> Math.floor(req.params.network_id);

    <span class="hljs-type">const</span> <span class="hljs-variable">queryResult</span> <span class="hljs-operator">=</span> await req.app.locals.queryHandlers[<span class="hljs-string">&quot;networkNodes&quot;</span>](
      req.app, network_id);

    <span class="hljs-keyword">if</span> (req.app.locals.dbRouteFlags.validate_query_responses &amp;&amp;
          !networkNodesValidatorFn(queryResult)) {
      <span class="hljs-keyword">throw</span> <span class="hljs-string">&quot;Query result didn&#x27;t pass validation!&quot;</span>;
    }

    <span class="hljs-type">const</span> <span class="hljs-variable">restructured_data</span> <span class="hljs-operator">=</span> networkNodePostProcessing(queryResult);

    res.json(restructured_data);
  } <span class="hljs-keyword">catch</span> (err) {
    console.error(<span class="hljs-string">&#x27;getNetworkNodes error: &#x27;</span>, err);
    res.status(<span class="hljs-number">500</span>).send(<span class="hljs-string">&quot;internal error&quot;</span>);
  }
};

<span class="hljs-comment">// =====================================================</span>
<span class="hljs-comment">//  REST listener for GetNetworkPortfolio</span>
<span class="hljs-comment">//  uri: GET &#x27;/api/network/:network_id/portfolio&#x27;</span>
<span class="hljs-comment">// =====================================================</span>
export <span class="hljs-type">const</span> <span class="hljs-variable">getNetworkPortfolio</span> <span class="hljs-operator">=</span> async <span class="hljs-title function_">function</span><span class="hljs-params">(req, res)</span> {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// assemble and execute query:</span>

    <span class="hljs-comment">// parse params from strings. do this explicitly here to avoid relying on</span>
    <span class="hljs-comment">// edge cases for string-to-number conversion later on. Math.floor() does</span>
    <span class="hljs-comment">// string-to-number conversion and returns integer part.</span>
    <span class="hljs-comment">//   &quot;&quot; -&gt; 0 -&gt; default, undefined -&gt; NaN -&gt; default, &quot;2.1&quot; -&gt; 2</span>
    <span class="hljs-type">const</span> <span class="hljs-variable">network_id</span> <span class="hljs-operator">=</span> Math.floor(req.params.network_id);

    <span class="hljs-type">const</span> <span class="hljs-variable">queryResult</span> <span class="hljs-operator">=</span> await req.app.locals.queryHandlers[<span class="hljs-string">&quot;networkPortfolio&quot;</span>](
      req.app, network_id);

    <span class="hljs-keyword">if</span> (req.app.locals.dbRouteFlags.validate_query_responses &amp;&amp;
          !portfolioListValidatorFn(queryResult)) {
      <span class="hljs-keyword">throw</span> <span class="hljs-string">&quot;Query result didn&#x27;t pass validation!&quot;</span>;
    }

    res.json(queryResult);
  } <span class="hljs-keyword">catch</span> (err) {
    console.error(<span class="hljs-string">&#x27;getNetworkPortfolio error: &#x27;</span>, err);
    res.status(<span class="hljs-number">500</span>).send(<span class="hljs-string">&quot;internal error&quot;</span>);
  }
};

<span class="hljs-comment">// =====================================================</span>
<span class="hljs-comment">//  REST listener for GetNetworkGraph</span>
<span class="hljs-comment">//  uri: GET &#x27;/api/network/:network_id/graph&#x27;</span>
<span class="hljs-comment">// =====================================================</span>
export <span class="hljs-type">const</span> <span class="hljs-variable">getNetworkGraph</span> <span class="hljs-operator">=</span> async <span class="hljs-title function_">function</span><span class="hljs-params">(req, res)</span> {
  <span class="hljs-keyword">try</span> {

    <span class="hljs-comment">// assemble and execute query:</span>

    <span class="hljs-comment">// parse params from strings. do this explicitly here to avoid relying on</span>
    <span class="hljs-comment">// edge cases for string-to-number conversion later on. Math.floor() does</span>
    <span class="hljs-comment">// string-to-number conversion and returns integer part.</span>
    <span class="hljs-comment">//   &quot;&quot; -&gt; 0 -&gt; default, undefined -&gt; NaN -&gt; default, &quot;2.1&quot; -&gt; 2</span>
    <span class="hljs-type">const</span> <span class="hljs-variable">network_id</span> <span class="hljs-operator">=</span> Math.floor(req.params.network_id);

    <span class="hljs-type">const</span> <span class="hljs-variable">queryResult</span> <span class="hljs-operator">=</span> await req.app.locals.queryHandlers[<span class="hljs-string">&quot;networkGraph&quot;</span>](
      req.app, network_id);

    <span class="hljs-keyword">if</span> (req.app.locals.dbRouteFlags.validate_query_responses &amp;&amp;
          !networkGraphValidatorFn(queryResult)) {
      <span class="hljs-keyword">throw</span> <span class="hljs-string">&quot;Query result didn&#x27;t pass validation!&quot;</span>;
    }

    res.json(queryResult);
  } <span class="hljs-keyword">catch</span> (err) {
    console.error(<span class="hljs-string">&#x27;getNetworkGraph error: &#x27;</span>, err);
    res.status(<span class="hljs-number">500</span>).send(<span class="hljs-string">&quot;internal error&quot;</span>);
  }
};

<span class="hljs-comment">// =====================================================</span>
<span class="hljs-comment">//  REST listener for GetNetworkRelatedNetworks</span>
<span class="hljs-comment">//  uri: GET &#x27;/api/network/:network_id/relatedNetworks&#x27;</span>
<span class="hljs-comment">// =====================================================</span>
export <span class="hljs-type">const</span> <span class="hljs-variable">getNetworkRelatedNetworks</span> <span class="hljs-operator">=</span> async <span class="hljs-title function_">function</span><span class="hljs-params">(req, res)</span> {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// assemble and execute query:</span>

    <span class="hljs-comment">// parse params from strings. do this explicitly here to avoid relying on</span>
    <span class="hljs-comment">// edge cases for string-to-number conversion later on. Math.floor() does</span>
    <span class="hljs-comment">// string-to-number conversion and returns integer part.</span>
    <span class="hljs-comment">//   &quot;&quot; -&gt; 0 -&gt; default, undefined -&gt; NaN -&gt; default, &quot;2.1&quot; -&gt; 2</span>
    <span class="hljs-type">const</span> <span class="hljs-variable">network_id</span> <span class="hljs-operator">=</span> Math.floor(req.params.network_id);

    <span class="hljs-type">const</span> <span class="hljs-variable">queryResult</span> <span class="hljs-operator">=</span> await req.app.locals.queryHandlers[<span class="hljs-string">&quot;networkRelatedNetworks&quot;</span>](
      req.app, network_id);

    <span class="hljs-type">const</span> <span class="hljs-variable">restructured_data</span> <span class="hljs-operator">=</span> relatedNetworkPostProcessing(queryResult);

    <span class="hljs-keyword">if</span> (req.app.locals.dbRouteFlags.validate_query_responses &amp;&amp;
          !relatedNetworkListValidatorFn(restructured_data)) {
      <span class="hljs-keyword">throw</span> <span class="hljs-string">&quot;Query result didn&#x27;t pass validation!&quot;</span>;
    }

    res.json(restructured_data);
  } <span class="hljs-keyword">catch</span> (err) {
    console.error(<span class="hljs-string">&#x27;getNetworkRelatedNetworks error: &#x27;</span>, err);
    res.status(<span class="hljs-number">500</span>).send(<span class="hljs-string">&quot;internal error&quot;</span>);
  }
};

<span class="hljs-comment">// ===================================================</span>
<span class="hljs-comment">//  REST listener for GetEvictionsByNeighborhood</span>
<span class="hljs-comment">//  uri: GET &#x27;/api/neighborhood/:neighborhood/evictions&#x27;,</span>
<span class="hljs-comment">//       GET &#x27;/api/neighborhood/:neighborhood/evictions/:page&#x27;</span>
<span class="hljs-comment">// ===================================================</span>
export <span class="hljs-type">const</span> <span class="hljs-variable">getNeighborhoodEvictions</span> <span class="hljs-operator">=</span> async <span class="hljs-title function_">function</span><span class="hljs-params">(req, res)</span> {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// todo: request validation.</span>

    <span class="hljs-comment">// assemble and execute query:</span>
    <span class="hljs-type">const</span> <span class="hljs-variable">maxPageSize</span> <span class="hljs-operator">=</span> req.app.locals.dbRouteFlags.neighborhood_max_page_size;

    <span class="hljs-type">const</span> <span class="hljs-variable">neighborhoodName</span> <span class="hljs-operator">=</span> req.params.neighborhood.toUpperCase();
    <span class="hljs-comment">// parse params from strings. do this explicitly here to avoid relying on</span>
    <span class="hljs-comment">// edge cases for string-to-number conversion later on. Math.floor() does</span>
    <span class="hljs-comment">// string-to-number conversion and returns integer part.</span>
    <span class="hljs-comment">//   &quot;&quot; -&gt; 0 -&gt; default, undefined -&gt; NaN -&gt; default, &quot;2.1&quot; -&gt; 2</span>
    <span class="hljs-type">const</span> <span class="hljs-variable">page</span> <span class="hljs-operator">=</span> Math.floor(req.params.page) || <span class="hljs-number">1</span>;   <span class="hljs-comment">// caution: 0 -&gt; 1</span>
    <span class="hljs-type">const</span> <span class="hljs-variable">size</span> <span class="hljs-operator">=</span> Math.floor(req.query.size) || <span class="hljs-number">100</span>;  <span class="hljs-comment">// caution: 0 -&gt; 100</span>

    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> confirm query params fit the expected schema.</span>

    <span class="hljs-type">const</span> <span class="hljs-variable">queryResult</span> <span class="hljs-operator">=</span> await
      req.app.locals.queryHandlers[<span class="hljs-string">&quot;neighborhoodEvictions&quot;</span>](
        req.app, neighborhoodName, page, size);

    <span class="hljs-comment">// confirm queryHandler response fits the expected schema:</span>
    <span class="hljs-keyword">if</span> (req.app.locals.dbRouteFlags.validate_query_responses &amp;&amp;
      !neighborhoodEvictionsValidatorFn(queryResult)) {
      <span class="hljs-keyword">throw</span> <span class="hljs-string">&quot;Query result didn&#x27;t pass validation!&quot;</span>;
    }

    <span class="hljs-comment">// post-processing:</span>

    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> convert dates, addresses, etc., in &#x27;result&#x27; to human-readable</span>
    <span class="hljs-comment">// format suitable for transmission to client app.</span>
    <span class="hljs-comment">// see: https://github.com/antievictionmappingproject/evictorbook/issues/205</span>
    res.json(queryResult);
  } <span class="hljs-keyword">catch</span> (err) {
    console.error(<span class="hljs-string">&#x27;getNeighborhoodEvictions error: &#x27;</span>, err);
    res.status(<span class="hljs-number">500</span>).send(<span class="hljs-string">&quot;internal error&quot;</span>);
  }
};

<span class="hljs-comment">// ===================================</span>
<span class="hljs-comment">//  REST listener for Search</span>
<span class="hljs-comment">//  uri: GET &#x27;/api/search/:search_term&#x27;</span>
<span class="hljs-comment">// ===================================</span>
export <span class="hljs-type">const</span> <span class="hljs-variable">getSearch</span> <span class="hljs-operator">=</span> async <span class="hljs-title function_">function</span><span class="hljs-params">(req, res)</span> {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-type">const</span> <span class="hljs-variable">address</span> <span class="hljs-operator">=</span> req.params.search_term;

    <span class="hljs-type">const</span> <span class="hljs-variable">queryResult</span> <span class="hljs-operator">=</span> await
      req.app.locals.queryHandlers[<span class="hljs-string">&quot;search&quot;</span>](req.app, address);

    <span class="hljs-keyword">if</span> (req.app.locals.dbRouteFlags.validate_query_responses &amp;&amp;
          !databaseSearchResultListValidatorFn(queryResult)) {
      <span class="hljs-keyword">throw</span> <span class="hljs-string">&quot;Query result didn&#x27;t pass validation!&quot;</span>;
    }

    res.json(queryResult);
  } <span class="hljs-keyword">catch</span> (err) {
    console.error(<span class="hljs-string">&#x27;getSearch error: &#x27;</span>, err);
    res.status(<span class="hljs-number">500</span>).send(<span class="hljs-string">&quot;internal error&quot;</span>);
  }
};

<span class="hljs-comment">// ===================================</span>
<span class="hljs-comment">//  REST listener for GetEvictionSource</span>
<span class="hljs-comment">//  uri: GET &#x27;/api/about/eviction&#x27;</span>
<span class="hljs-comment">// ===================================</span>
export <span class="hljs-type">const</span> <span class="hljs-variable">getEvictionSource</span> <span class="hljs-operator">=</span> async <span class="hljs-title function_">function</span><span class="hljs-params">(req, res)</span> {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-type">const</span> <span class="hljs-variable">queryResult</span> <span class="hljs-operator">=</span> await
      req.app.locals.queryHandlers[<span class="hljs-string">&quot;evictionSource&quot;</span>](req.app);

    res.json(queryResult);
  } <span class="hljs-keyword">catch</span> (err) {
    console.error(<span class="hljs-string">&#x27;getEvictionSource error: &#x27;</span>, err);
    res.status(<span class="hljs-number">500</span>).send(<span class="hljs-string">&quot;internal error&quot;</span>);
  }
};

<span class="hljs-comment">// ===================================</span>
<span class="hljs-comment">//  REST listener for GetAssessorSource</span>
<span class="hljs-comment">//  uri: GET &#x27;/api/about/assessor&#x27;</span>
<span class="hljs-comment">// ===================================</span>
export <span class="hljs-type">const</span> <span class="hljs-variable">getAssessorSource</span> <span class="hljs-operator">=</span> async <span class="hljs-title function_">function</span><span class="hljs-params">(req, res)</span> {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-type">const</span> <span class="hljs-variable">queryResult</span> <span class="hljs-operator">=</span> await
      req.app.locals.queryHandlers[<span class="hljs-string">&quot;assessorSource&quot;</span>](req.app);

    res.json(queryResult);
  } <span class="hljs-keyword">catch</span> (err) {
    console.error(<span class="hljs-string">&#x27;getAssessorSource error: &#x27;</span>, err);
    res.status(<span class="hljs-number">500</span>).send(<span class="hljs-string">&quot;internal error&quot;</span>);
  }
};

<span class="hljs-comment">// ===================================</span>
<span class="hljs-comment">//  REST listener for GetBusinessSource</span>
<span class="hljs-comment">//  uri: GET &#x27;/api/about/business&#x27;</span>
<span class="hljs-comment">// ===================================</span>
export <span class="hljs-type">const</span> <span class="hljs-variable">getBusinessSource</span> <span class="hljs-operator">=</span> async <span class="hljs-title function_">function</span><span class="hljs-params">(req, res)</span> {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-type">const</span> <span class="hljs-variable">queryResult</span> <span class="hljs-operator">=</span> await
      req.app.locals.queryHandlers[<span class="hljs-string">&quot;businessSource&quot;</span>](req.app);

    res.json(queryResult);
  } <span class="hljs-keyword">catch</span> (err) {
    console.error(<span class="hljs-string">&#x27;getBusinessSource error: &#x27;</span>, err);
    res.status(<span class="hljs-number">500</span>).send(<span class="hljs-string">&quot;internal error&quot;</span>);
  }
};

<span class="hljs-comment">// additional route handlers:</span>

<span class="hljs-comment">// ========================================================================</span>
<span class="hljs-comment">//  REST listener for PingRequest (test basic functionality/health check).</span>
<span class="hljs-comment">//  uri: &#x27;/api/ping&#x27;</span>
<span class="hljs-comment">// ========================================================================</span>
export <span class="hljs-type">const</span> <span class="hljs-variable">handlePingRequest</span> <span class="hljs-operator">=</span> async <span class="hljs-title function_">function</span><span class="hljs-params">(req, res)</span> {
  <span class="hljs-comment">// nothing useful in request body.</span>
  <span class="hljs-type">const</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> {
    result: <span class="hljs-string">&quot;PONG&quot;</span>,
    status: <span class="hljs-string">&quot;OK&quot;</span>
  };

  <span class="hljs-comment">// debugging, remove before merge:</span>
  <span class="hljs-comment">// update (2021/03/19): starting to like this, might leave it in.</span>
  console.error(<span class="hljs-string">&quot;ping: dbRouteFlags: &quot;</span>, req.app.locals.dbRouteFlags);

  res.json(result);
}

<span class="hljs-comment">// ===================================</span>
<span class="hljs-comment">//  REST listener for a sample test</span>
<span class="hljs-comment">//  Note: This is boilerplate code to be used to add </span>
<span class="hljs-comment">//  test queries, enabled if there is a test Neo4j URI </span>
<span class="hljs-comment">//  added to the docker compose flags. </span>

<span class="hljs-comment">//  Search for &quot;Adding Test Queries&quot; in the code base to see other </span>
<span class="hljs-comment">//  main places code should be added</span>

<span class="hljs-comment">//  uri: GET &#x27;/api/test/sample/:query_param&#x27;</span>
<span class="hljs-comment">// ===================================</span>
export <span class="hljs-type">const</span> <span class="hljs-variable">getTestSample</span> <span class="hljs-operator">=</span> async <span class="hljs-title function_">function</span><span class="hljs-params">(req, res)</span> {
  <span class="hljs-keyword">try</span> {
    console.log(<span class="hljs-string">&quot;getTestSample&quot;</span>)

    <span class="hljs-type">const</span> <span class="hljs-variable">query_param</span> <span class="hljs-operator">=</span> req.params.query_param;

    <span class="hljs-type">const</span> <span class="hljs-variable">queryResult</span> <span class="hljs-operator">=</span> await
      req.app.locals.queryTestHandlers[<span class="hljs-string">&quot;sample&quot;</span>](req.app, query_param);

    res.json(queryResult);
  } <span class="hljs-keyword">catch</span> (err) {
    console.error(<span class="hljs-string">&#x27;getTestSample error: &#x27;</span>, err);
    res.status(<span class="hljs-number">500</span>).send(<span class="hljs-string">&quot;internal error&quot;</span>);
  }
};

export <span class="hljs-keyword">default</span> {
  getParcelDetails,
  getParcelEvictions,
  getParcelPortfolio,
  getParcelOwners,
  getParcelNetworkDetails,
  getParcelRelatedNetworks,
  getOwnerDetails,
  getOwnerEvictions,
  getOwnerPortfolio,
  getOwnerNetworkDetails,
  getOwnerRelatedNetworks,
  getNetworkDetails,
  getNetworkNodes,
  getNetworkPortfolio,
  getNetworkGraph,
  getNetworkRelatedNetworks,
  getNeighborhoodEvictions,
  getSearch,
  getEvictionSource,
  getAssessorSource,
  getBusinessSource,
  handlePingRequest,
  getTestSample
};
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverrestroutesdbroutepostprocessing.js"><a href="#toc"><a name="server-rest-routes-dbroutepostprocessing-js">server/rest/routes/dbRoutePostProcessing.js</a></a></h2>
<pre><code><span class="hljs-comment">// dbRoutePostProcessing.js</span>

<span class="hljs-comment">// contains post-processing functions for returns from Cypher queries,</span>
<span class="hljs-comment">// for use in dbRouteListeners.js</span>

<span class="hljs-keyword">import</span> { capsToTitleCase } from <span class="hljs-string">&#x27;../../utils/gnarly/stringUtils&#x27;</span>;

export <span class="hljs-keyword">const</span> networkNodePostProcessing = function(response) {
    response.nodes = response.nodes.map(node =&gt; {
      let renamed_type;
      switch (node.type) {
        case <span class="hljs-string">&quot;SOS_LP&quot;</span>:
          renamed_type = <span class="hljs-string">&quot;Business (Limited Partnership)&quot;</span>;
          <span class="hljs-keyword">break</span>;
        case <span class="hljs-string">&quot;SOS_Corp&quot;</span>:
          renamed_type = <span class="hljs-string">&quot;Business (Corporation)&quot;</span>;
          <span class="hljs-keyword">break</span>;
        case <span class="hljs-string">&quot;Address_Unit&quot;</span>:
          <span class="hljs-keyword">if</span> (node.details.is_business &amp;&amp; node.details.is_property_owner)
            renamed_type = <span class="hljs-string">&quot;Property Owner and Business Office Address&quot;</span>;
          <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (node.details.is_property_owner)
            renamed_type = <span class="hljs-string">&quot;Property Owner Mailing Address&quot;</span>;
          <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (node.details.is_business)
            renamed_type = <span class="hljs-string">&quot;Business Office Address&quot;</span>;
          <span class="hljs-keyword">else</span>
            renamed_type = <span class="hljs-string">&quot;Address&quot;</span>;

          <span class="hljs-keyword">break</span>;
        case <span class="hljs-string">&quot;SOS_Owner&quot;</span>:
          renamed_type = <span class="hljs-string">&quot;Business Owner&quot;</span>;
          <span class="hljs-keyword">break</span>;
        default:
          renamed_type = node.type
      }
      
      <span class="hljs-keyword">return</span> {
        name: node.name,
        degree: node.degree,
        type: node.type,
        type_readable: renamed_type
      }
    });

    <span class="hljs-keyword">return</span> response
}

export <span class="hljs-keyword">const</span> businessPostProcessing = function(be_type, response) {
    <span class="hljs-keyword">if</span> (be_type !== <span class="hljs-string">&quot;lp&quot;</span> &amp;&amp; be_type !== <span class="hljs-string">&quot;corp&quot;</span>) {
      <span class="hljs-comment">// wrong input_type.</span>
      <span class="hljs-keyword">throw</span> <span class="hljs-string">&quot;Invalid business entity search type (must be &#x27;lp&#x27; or &#x27;corp&#x27;)&quot;</span>;
    }

    <span class="hljs-comment">// convert addresses to title case</span>
    response.office_addresses = response.office_addresses.map(addr =&gt; 
      capsToTitleCase(addr)
    );

    <span class="hljs-keyword">if</span> (be_type === <span class="hljs-string">&quot;lp&quot;</span>) {
      response = lpPostProcessing(response);
    } <span class="hljs-keyword">else</span> {
      response = corpPostProcessing(response);
    }

    <span class="hljs-keyword">return</span> response;
}

<span class="hljs-keyword">const</span> corpPostProcessing = function(response) {
      <span class="hljs-comment">// remap the corporation code</span>
    let status;
    switch(response.be_specific_details.status) {
      case <span class="hljs-string">&quot;1&quot;</span>:
        status = <span class="hljs-string">&quot;Active&quot;</span>;
        <span class="hljs-keyword">break</span>;
      case <span class="hljs-string">&quot;2&quot;</span>:
        status = <span class="hljs-string">&quot;Suspended&quot;</span>;
        <span class="hljs-keyword">break</span>;
      case <span class="hljs-string">&quot;3&quot;</span>:
        status = <span class="hljs-string">&quot;Canceled&quot;</span>;
        <span class="hljs-keyword">break</span>;
      case <span class="hljs-string">&quot;4&quot;</span>:
        status = <span class="hljs-string">&quot;Surrendered&quot;</span>;
        <span class="hljs-keyword">break</span>;
      case <span class="hljs-string">&quot;5&quot;</span>:
        status = <span class="hljs-string">&quot;Term expired&quot;</span>;
        <span class="hljs-keyword">break</span>;
      case <span class="hljs-string">&quot;6&quot;</span>:
        status = <span class="hljs-string">&quot;Dissolved&quot;</span>;
        <span class="hljs-keyword">break</span>;
      case <span class="hljs-string">&quot;7&quot;</span>:
        status = <span class="hljs-string">&quot;Forfeited&quot;</span>;
        <span class="hljs-keyword">break</span>;
      case <span class="hljs-string">&quot;8&quot;</span>:
        status = <span class="hljs-string">&quot;Deleted&quot;</span>;
        <span class="hljs-keyword">break</span>;
      case <span class="hljs-string">&quot;9&quot;</span>:
        status = <span class="hljs-string">&quot;Inactive&quot;</span>;
        <span class="hljs-keyword">break</span>;
      case <span class="hljs-string">&quot;C&quot;</span>:
        status = <span class="hljs-string">&quot;Merged Out&quot;</span>;
        <span class="hljs-keyword">break</span>;
      case <span class="hljs-string">&quot;E&quot;</span>:
        status = <span class="hljs-string">&quot;State to Federal Bank Conversion&quot;</span>;
        <span class="hljs-keyword">break</span>;
      case <span class="hljs-string">&quot;F&quot;</span>:
        status = <span class="hljs-string">&quot;Conditionally dissolved (No tax clearance)&quot;</span>;
        <span class="hljs-keyword">break</span>;
      default:
        status = <span class="hljs-string">&quot;Converted Out&quot;</span>;
    }
    response.be_specific_details.status = status;

    <span class="hljs-comment">// remap the corporation type</span>
    let corporation_type;
    switch(response.be_specific_details.corporation_type) {
      case <span class="hljs-string">&quot;ARTS&quot;</span>:
        corporation_type = <span class="hljs-string">&quot;Articles of Incorporation&quot;</span>;
        <span class="hljs-keyword">break</span>;
      case <span class="hljs-string">&quot;S&amp;DC&quot;</span>:
        corporation_type = <span class="hljs-string">&quot;Statement &amp; Designation By Foreign Corporation&quot;</span>;
        <span class="hljs-keyword">break</span>;
      case <span class="hljs-string">&quot;S&amp;DA&quot;</span>:
        corporation_type = <span class="hljs-string">&quot;Statement &amp; Designation By Foreign Association&quot;</span>;
        <span class="hljs-keyword">break</span>;
      case <span class="hljs-string">&quot;FNRE&quot;</span>:
        corporation_type = <span class="hljs-string">&quot;Foreign Name Registration&quot;</span>;
        <span class="hljs-keyword">break</span>;
      default:
        corporation_type = <span class="hljs-string">&quot;&quot;</span>;
    }
    response.be_specific_details.corporation_type = corporation_type;

    <span class="hljs-comment">// remap the corporation tax base</span>
    let corporation_tax_base;
    switch(response.be_specific_details.corporation_tax_base) {
      case <span class="hljs-string">&quot;S&quot;</span>:
        corporation_tax_base = <span class="hljs-string">&quot;Stock&quot;</span>;
        <span class="hljs-keyword">break</span>;
      case <span class="hljs-string">&quot;N&quot;</span>:
        corporation_tax_base = <span class="hljs-string">&quot;Non-Stock (Nonprofit)&quot;</span>;
        <span class="hljs-keyword">break</span>;
      default:
        corporation_tax_base = <span class="hljs-string">&quot;&quot;</span>;
    }
    response.be_specific_details.corporation_tax_base = corporation_tax_base;

    <span class="hljs-comment">// remap the corporation tax base</span>
    let ftb_suspension_status;
    switch(response.be_specific_details.ftb_suspension_status) {
      case <span class="hljs-string">&quot;F&quot;</span>:
        ftb_suspension_status = <span class="hljs-string">&quot;Forfeited&quot;</span>;
        <span class="hljs-keyword">break</span>;
      case <span class="hljs-string">&quot;S&quot;</span>:
        ftb_suspension_status = <span class="hljs-string">&quot;Suspended&quot;</span>;
        <span class="hljs-keyword">break</span>;
      default:
        ftb_suspension_status = <span class="hljs-string">&quot;Not Suspended (In Good Standing)&quot;</span>;
    }
    response.be_specific_details.ftb_suspension_status = ftb_suspension_status;

    <span class="hljs-comment">// remap the corporation classification</span>
    let corporation_classification;
    switch(response.be_specific_details.corporation_classification) {
      case <span class="hljs-string">&quot;AG&quot;</span>:
        corporation_classification = <span class="hljs-string">&quot;Agricultural Cooperative&quot;</span>;
        <span class="hljs-keyword">break</span>;
      case <span class="hljs-string">&quot;CR&quot;</span>:
        corporation_classification = <span class="hljs-string">&quot;Credit Union&quot;</span>;
        <span class="hljs-keyword">break</span>;
      case <span class="hljs-string">&quot;MU&quot;</span>:
        corporation_classification = <span class="hljs-string">&quot;Mutual Benefit&quot;</span>;
        <span class="hljs-keyword">break</span>;
      case <span class="hljs-string">&quot;OC&quot;</span>:
        corporation_classification = <span class="hljs-string">&quot;Other Cooperative&quot;</span>;
        <span class="hljs-keyword">break</span>;
      case <span class="hljs-string">&quot;PB&quot;</span>:
        corporation_classification = <span class="hljs-string">&quot;Public Benefit&quot;</span>;
        <span class="hljs-keyword">break</span>;
      case <span class="hljs-string">&quot;RE&quot;</span>:
        corporation_classification = <span class="hljs-string">&quot;Religious&quot;</span>;
        <span class="hljs-keyword">break</span>;
      case <span class="hljs-string">&quot;SL&quot;</span>:
        corporation_classification = <span class="hljs-string">&quot;Corporation Sole&quot;</span>;
        <span class="hljs-keyword">break</span>;
      case <span class="hljs-string">&quot;UN&quot;</span>:
        corporation_classification = <span class="hljs-string">&quot;Unclassified&quot;</span>;
        <span class="hljs-keyword">break</span>;
      default:
        corporation_classification = <span class="hljs-string">&quot;&quot;</span>;
    }
    response.be_specific_details.corporation_classification =
        corporation_classification;

    <span class="hljs-keyword">return</span> response;
}

export <span class="hljs-keyword">const</span> lpPostProcessing = function(response) {
    let status;
    switch(response.be_specific_details.status) {
      case <span class="hljs-string">&quot;A&quot;</span>:
        status = <span class="hljs-string">&quot;Active&quot;</span>;
        <span class="hljs-keyword">break</span>;
      case <span class="hljs-string">&quot;B&quot;</span>:
        status = <span class="hljs-string">&quot;Dishonored Check&quot;</span>;
        <span class="hljs-keyword">break</span>;
      case <span class="hljs-string">&quot;C&quot;</span>:
        status = <span class="hljs-string">&quot;Canceled&quot;</span>;
        <span class="hljs-keyword">break</span>;
      case <span class="hljs-string">&quot;D&quot;</span>:
        status = <span class="hljs-string">&quot;Dissolved&quot;</span>;
        <span class="hljs-keyword">break</span>;
      case <span class="hljs-string">&quot;P&quot;</span>:
        status = <span class="hljs-string">&quot;Pending Cancellation&quot;</span>;
        <span class="hljs-keyword">break</span>;
      case <span class="hljs-string">&quot;F&quot;</span>:
        status = <span class="hljs-string">&quot;Franchise Tax Board (FTB) Suspended/Forfeited&quot;</span>;
        <span class="hljs-keyword">break</span>;
      case <span class="hljs-string">&quot;M&quot;</span>:
        status = <span class="hljs-string">&quot;Merged Out&quot;</span>;
        <span class="hljs-keyword">break</span>;
      case <span class="hljs-string">&quot;O&quot;</span>:
        status = <span class="hljs-string">&quot;Converted Out&quot;</span>;
        <span class="hljs-keyword">break</span>;
      case <span class="hljs-string">&quot;S&quot;</span>:
        status = <span class="hljs-string">&quot;Secretary of State (SOS) Suspended/Forfeited&quot;</span>;
        <span class="hljs-keyword">break</span>;
      case <span class="hljs-string">&quot;2&quot;</span>:
        status = <span class="hljs-string">&quot;SOS/FTB Suspended/Forfeited&quot;</span>;
        <span class="hljs-keyword">break</span>;
      default:
        status = <span class="hljs-string">&quot;&quot;</span>;
    }
    response.be_specific_details.status = status;

    <span class="hljs-comment">// remap the filing type</span>
    let filing_type;
    switch(response.be_specific_details.filing_type) {
      case <span class="hljs-string">&quot;D&quot;</span>:
        filing_type = <span class="hljs-string">&quot;Domestic Filing&quot;</span>;
        <span class="hljs-keyword">break</span>;
      case <span class="hljs-string">&quot;F&quot;</span>:
        filing_type = <span class="hljs-string">&quot;Foreign Filing&quot;</span>;
        <span class="hljs-keyword">break</span>;
      default:
        status = <span class="hljs-string">&quot;&quot;</span>;
    }
    response.be_specific_details.filing_type = filing_type;

    <span class="hljs-comment">// remap the management code</span>
    let llc_management_code;
    switch(response.be_specific_details.llc_management_code) {
      case <span class="hljs-string">&quot;1&quot;</span>:
        llc_management_code = <span class="hljs-string">&quot;One Manager&quot;</span>;
        <span class="hljs-keyword">break</span>;
      case <span class="hljs-string">&quot;M&quot;</span>:
        llc_management_code = <span class="hljs-string">&quot;More Than One Manager&quot;</span>;
        <span class="hljs-keyword">break</span>;
      case <span class="hljs-string">&quot;A&quot;</span>:
        llc_management_code = <span class="hljs-string">&quot;All Members are Managers&quot;</span>;
        <span class="hljs-keyword">break</span>;
      default:
        status = <span class="hljs-string">&quot;&quot;</span>;
    }
    response.be_specific_details.llc_management_code = llc_management_code;

    <span class="hljs-comment">// LLC type of business comes directly from source data, will be capitalized (if present)</span>
    <span class="hljs-keyword">if</span> (response.be_specific_details.llc_type_of_business) {
      response.be_specific_details.llc_type_of_business = capsToTitleCase(response.be_specific_details.llc_type_of_business);
    }

    <span class="hljs-keyword">return</span> response;
}

<span class="hljs-comment">/* relatedNetworkPostProcessing: Restructures the data returned
 * for related networks to make for easier processing. Specifically,
 * removes the match explanations from separate fields (which may be null)
 * under the `match_explanation` field and turns them
 * into a single `explanations` array containing the non-null match 
 * explanations.
 */</span>
export <span class="hljs-keyword">const</span> relatedNetworkPostProcessing = function(response) {
    <span class="hljs-keyword">const</span> explanationTypes = [<span class="hljs-string">&quot;businesses_listed_at_addrs&quot;</span>, 
                              <span class="hljs-string">&quot;related_to_excluded&quot;</span>,
                              <span class="hljs-string">&quot;businesses_owning_parcels&quot;</span>, 
                              <span class="hljs-string">&quot;parcels_owned_by_same_non_business_owner&quot;</span>,
                              <span class="hljs-string">&quot;similar_addresses&quot;</span>];

    response = response.map((relatedNetwork) =&gt; {
      relatedNetwork.explanations = explanationTypes.map((exp) =&gt; (
        {
          exp_type: exp,
          exp_metrics: relatedNetwork.match_explanation[exp]              
        }
      ))

      relatedNetwork.explanations = relatedNetwork.explanations.filter(function (el) {
        <span class="hljs-keyword">return</span> el.exp_metrics != <span class="hljs-literal">null</span>;
      }); 

      delete relatedNetwork.match_explanation;

      <span class="hljs-keyword">return</span> relatedNetwork;    
    })


    <span class="hljs-keyword">return</span> response;
}</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverrestroutesdbroutesetup.js"><a href="#toc"><a name="server-rest-routes-dbroutesetup-js">server/rest/routes/dbRouteSetup.js</a></a></h2>
<pre><code><span class="hljs-keyword">import</span> memoryCache <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;memory-cache&#x27;</span>;

<span class="hljs-keyword">import</span> queryHandlers <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../handlers/query&#x27;</span>;
<span class="hljs-keyword">import</span> queryTestHandlers <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../handlers/queryTest&#x27;</span>; <span class="hljs-comment">// only used if test Neo4j URI is given</span>

<span class="hljs-keyword">import</span> dbRouteListeners <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./dbRouteListeners.js&#x27;</span>;

<span class="hljs-comment">// TODO - determine how to unify with default (V2 routes)</span>
<span class="hljs-keyword">import</span> unifiedSearch <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./unifiedSearch.js&#x27;</span>;

<span class="hljs-comment">// Service handler interfaces.</span>
<span class="hljs-comment">// TODO(Dana): Deprecate and remove.</span>
<span class="hljs-keyword">import</span> unifiedSearchHandler <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../handlers/unifiedSearch/serviceHandler.js&#x27;</span>;
<span class="hljs-keyword">import</span> queryHandler <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../handlers/query/serviceHandler.js&#x27;</span>;
<span class="hljs-keyword">import</span> queryTestHandler <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../handlers/queryTest/serviceHandler.js&#x27;</span>; <span class="hljs-comment">// only used if test Neo4j URI is given</span>

<span class="hljs-keyword">import</span> dbRouteFlags <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../flags/dbRouteFlags.js&#x27;</span>;
<span class="hljs-keyword">import</span> neo4jBackend <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../backends/neo4jBackend.js&#x27;</span>;

<span class="hljs-comment">// response caching:</span>
<span class="hljs-keyword">const</span> cache = <span class="hljs-keyword">new</span> memoryCache.<span class="hljs-title class_">Cache</span>();

<span class="hljs-comment">// Returns an express middleware arrow-function which attaches relevant</span>
<span class="hljs-comment">// response headers and performs the cache lookup/maintainence.</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">buildCacheMiddleware</span> = (<span class="hljs-params">duration</span>) =&gt; {  <span class="hljs-comment">// duration in minutes</span>
  <span class="hljs-keyword">if</span> (!duration || duration &lt; <span class="hljs-number">0</span>) {
    <span class="hljs-comment">// Short-circuit, if there&#x27;s no duration set then return a passthrough fn.</span>
    <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> { <span class="hljs-title function_">next</span>(); };
  }

  <span class="hljs-comment">// Otherwise, return a fn that stores responses in an in-memory cache.</span>
  <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> duration_sec = duration * <span class="hljs-number">60</span>;  <span class="hljs-comment">// to seconds</span>

    <span class="hljs-comment">// Set header to instruct clients to maintain their own cache, in addition</span>
    <span class="hljs-comment">// to the serverside one.</span>
    res.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;Cache-Control&#x27;</span>, <span class="hljs-string">`public, max-age=<span class="hljs-subst">${duration_sec}</span>`</span>);

    <span class="hljs-keyword">const</span> key =  <span class="hljs-string">&#x27;__eb_api__&#x27;</span> + req.<span class="hljs-property">originalUrl</span> || req.<span class="hljs-property">url</span>;
    <span class="hljs-keyword">const</span> cacheContent = cache.<span class="hljs-title function_">get</span>(key);
    <span class="hljs-keyword">if</span> (cacheContent) {
      res.<span class="hljs-title function_">send</span>(cacheContent);
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;cache hit&#x27;</span>);
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-comment">// If we&#x27;re here, cache.get() returned no response body.</span>
    res.<span class="hljs-property">sendResponse</span> = res.<span class="hljs-property">send</span>;
    res.<span class="hljs-property">send</span> = <span class="hljs-function">(<span class="hljs-params">body</span>) =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;cache miss&#x27;</span>);
      cache.<span class="hljs-title function_">put</span>(key, body, duration_sec * <span class="hljs-number">1000</span>);  <span class="hljs-comment">// to millis</span>
      res.<span class="hljs-title function_">sendResponse</span>(body);
    }
    <span class="hljs-title function_">next</span>();
  };
};

<span class="hljs-comment">// amount of time to keep responses in cache, where applicable.</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">CACHE_DURATION_MINUTES</span> = <span class="hljs-number">1</span>;

<span class="hljs-comment">// export routes.</span>
<span class="hljs-comment">// this is an arrow-function invoked by framework at startup. &#x27;app&#x27; parameter</span>
<span class="hljs-comment">// is the express app object, used to set application state.</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> (app) =&gt; {
  app.<span class="hljs-title function_">enable</span>(<span class="hljs-string">&#x27;etag&#x27;</span>);

  <span class="hljs-comment">// callback functions to implement query abstraction layer.</span>
  app.<span class="hljs-property">locals</span>.<span class="hljs-property">queryHandlers</span> = queryHandlers;
  app.<span class="hljs-property">locals</span>.<span class="hljs-property">queryTestHandlers</span> = queryTestHandlers;

  <span class="hljs-comment">// flags to control db route behavior.</span>
  app.<span class="hljs-property">locals</span>.<span class="hljs-property">dbRouteFlags</span> = dbRouteFlags;

  <span class="hljs-comment">// configure the neo4j database backends.</span>
  app.<span class="hljs-property">locals</span>.<span class="hljs-property">neo4jDriver</span> = <span class="hljs-title function_">neo4jBackend</span>({ <span class="hljs-attr">use_test_endpoint</span>: <span class="hljs-literal">false</span> });

  <span class="hljs-comment">// if specified in docker flags, create another Neo4j driver pointing </span>
  <span class="hljs-comment">// to the remote, testing db. Also enables a set of test API routes </span>
  <span class="hljs-comment">// that query this DB. </span>
  <span class="hljs-keyword">if</span> (dbRouteFlags.<span class="hljs-property">enable_test</span>) {
    app.<span class="hljs-property">locals</span>.<span class="hljs-property">neo4jDriverTest</span> = <span class="hljs-title function_">neo4jBackend</span>({ <span class="hljs-attr">use_test_endpoint</span>: <span class="hljs-literal">true</span> });
  }

  <span class="hljs-comment">// local service handlers.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// work-in-progress / proof-of-concept: treat v1 queries as a service. if</span>
  <span class="hljs-comment">// this works, then we can remove the ad-hoc queryHandler construct.</span>
  <span class="hljs-keyword">if</span> (!app.<span class="hljs-property">locals</span>.<span class="hljs-property">services</span>) {
    app.<span class="hljs-property">locals</span>.<span class="hljs-property">services</span> = {};
  }
  app.<span class="hljs-property">locals</span>.<span class="hljs-property">services</span>.<span class="hljs-property">unifiedSearchHandler</span> = unifiedSearchHandler;
  app.<span class="hljs-property">locals</span>.<span class="hljs-property">services</span>.<span class="hljs-property">queryHandler</span> = queryHandler;
  app.<span class="hljs-property">locals</span>.<span class="hljs-property">services</span>.<span class="hljs-property">queryTestHandler</span> = queryTestHandler;

  <span class="hljs-keyword">let</span> cacheFn;
  <span class="hljs-keyword">if</span> (dbRouteFlags.<span class="hljs-property">disable_cache</span>) {
    <span class="hljs-comment">// Short-circuit, if cache is disabled then use a passthrough fn:</span>
    cacheFn = <span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> { <span class="hljs-title function_">next</span>(); };
  } <span class="hljs-keyword">else</span> {
    cacheFn = <span class="hljs-title function_">buildCacheMiddleware</span>(<span class="hljs-variable constant_">CACHE_DURATION_MINUTES</span>);
  }

  <span class="hljs-comment">// TODO - review these and see which should stay in</span>

  <span class="hljs-comment">// // route for health-check / basic functionality testing.</span>
  <span class="hljs-comment">// app.get(&#x27;/api/ping&#x27;, dbRouteListeners.handlePingRequest);</span>

  <span class="hljs-comment">// // routes for index-based searches.</span>
  <span class="hljs-comment">// app.get(&#x27;/api/be-search/:search&#x27;, cacheFn, dbRouteListeners.searchBENames);</span>
  <span class="hljs-comment">// app.get(&#x27;/api/parcel-search/:search&#x27;, cacheFn, dbRouteListeners.searchParcelNames);</span>

  <span class="hljs-keyword">if</span> (dbRouteFlags.<span class="hljs-property">enable_unified_search</span>) {
    <span class="hljs-comment">// route for unified search api.</span>
    <span class="hljs-comment">// send query string with &#x27;q&#x27; query param: &#x27;/api/search?q=foo&#x27;</span>
    app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/api/search&#x27;</span>, cacheFn, unifiedSearch.<span class="hljs-property">unifiedSearchListener</span>);
  }

  <span class="hljs-comment">// ROUTES FOR INDEX-BASED SEARCHES</span>
  <span class="hljs-comment">//    search_term: search term to use when looking up owners (business name)</span>
  <span class="hljs-comment">//                 and parcels (street address)</span>
  <span class="hljs-comment">// app.get(&#x27;/api/search/:search_term&#x27;, cacheFn, dbRouteListeners.getSearch);</span>

  <span class="hljs-comment">// ROUTES FOR NEIGHBORHOOD VIEW</span>
  app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/api/neighborhood/:neighborhood/evictions&#x27;</span>, cacheFn, dbRouteListeners.<span class="hljs-property">getNeighborhoodEvictions</span>);
  app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/api/neighborhood/:neighborhood/evictions/:page&#x27;</span>, cacheFn, dbRouteListeners.<span class="hljs-property">getNeighborhoodEvictions</span>);

  <span class="hljs-comment">// ROUTES FOR OWNER VIEW</span>
  <span class="hljs-comment">//    business_id: currently the &#x27;name_norm&#x27; field for both LPs and Corps (e.g. &quot;55 DOLORES STREET LLC&quot;)</span>
  <span class="hljs-comment">//    business_type: can be either &#x27;lp&#x27; or &#x27;corp&#x27;</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// details about the searched business:</span>
  app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/api/owner/:business_type/:business_id/details&#x27;</span>, cacheFn, dbRouteListeners.<span class="hljs-property">getOwnerDetails</span>);
  <span class="hljs-comment">// evictions conducted by the searched business:</span>
  app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/api/owner/:business_type/:business_id/evictions&#x27;</span>, cacheFn, dbRouteListeners.<span class="hljs-property">getOwnerEvictions</span>);
  <span class="hljs-comment">// portfolio of properties owned by business network:</span>
  app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/api/owner/:business_type/:business_id/portfolio&#x27;</span>, cacheFn, dbRouteListeners.<span class="hljs-property">getOwnerPortfolio</span>);
  <span class="hljs-comment">// details of network containing business:</span>
  app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/api/owner/:business_type/:business_id/networkDetails&#x27;</span>, cacheFn, dbRouteListeners.<span class="hljs-property">getOwnerNetworkDetails</span>);
  <span class="hljs-comment">// potential networks related to business network:</span>
  app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/api/owner/:business_type/:business_id/relatedNetworks&#x27;</span>, cacheFn, dbRouteListeners.<span class="hljs-property">getOwnerRelatedNetworks</span>);

  <span class="hljs-comment">// ROUTES FOR NETWORK VIEW</span>
  <span class="hljs-comment">//    network_id: unique, numerical identifier for ownership network</span>
  <span class="hljs-comment">//</span>
  app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/api/network/:network_id/details&#x27;</span>, cacheFn, dbRouteListeners.<span class="hljs-property">getNetworkDetails</span>);
  app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/api/network/:network_id/portfolio&#x27;</span>, cacheFn, dbRouteListeners.<span class="hljs-property">getNetworkPortfolio</span>);
  app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/api/network/:network_id/nodes&#x27;</span>, cacheFn, dbRouteListeners.<span class="hljs-property">getNetworkNodes</span>);
  app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/api/network/:network_id/graph&#x27;</span>, cacheFn, dbRouteListeners.<span class="hljs-property">getNetworkGraph</span>);
  <span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> this is equivalent to the returns from the parcel / owner routes:</span>
  app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/api/network/:network_id/relatedNetworks&#x27;</span>, cacheFn, dbRouteListeners.<span class="hljs-property">getNetworkRelatedNetworks</span>);

  <span class="hljs-comment">// ROUTES FOR PARCEL VIEW</span>
  <span class="hljs-comment">//    parcel_id: currently the &#x27;block_lot&#x27; field (e.g. &quot;3502033&quot;)</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// details about the searched property:</span>
  app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/api/parcel/:parcel_id/details&#x27;</span>, cacheFn, dbRouteListeners.<span class="hljs-property">getParcelDetails</span>);
  <span class="hljs-comment">// evictions at the searched property:</span>
  app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/api/parcel/:parcel_id/evictions&#x27;</span>, cacheFn, dbRouteListeners.<span class="hljs-property">getParcelEvictions</span>);
  <span class="hljs-comment">// portfolio of properties that the searched property is part of:</span>
  app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/api/parcel/:parcel_id/portfolio&#x27;</span>, cacheFn, dbRouteListeners.<span class="hljs-property">getParcelPortfolio</span>);
  <span class="hljs-comment">// property owners for searched property:</span>
  app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/api/parcel/:parcel_id/owners&#x27;</span>, cacheFn, dbRouteListeners.<span class="hljs-property">getParcelOwners</span>);
  <span class="hljs-comment">// details of network containing parcel:</span>
  app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/api/parcel/:parcel_id/networkDetails&#x27;</span>, cacheFn, dbRouteListeners.<span class="hljs-property">getParcelNetworkDetails</span>);
  <span class="hljs-comment">// potential networks related to the property:</span>
  app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/api/parcel/:parcel_id/relatedNetworks&#x27;</span>, cacheFn, dbRouteListeners.<span class="hljs-property">getParcelRelatedNetworks</span>);

  <span class="hljs-comment">// ROUTES FOR DATA SOURCE DETAILS</span>
  <span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> This is not a comprehensive list of data sources</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// get details on the City eviction data source</span>
  app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/api/about/eviction&#x27;</span>, cacheFn, dbRouteListeners.<span class="hljs-property">getEvictionSource</span>);
  <span class="hljs-comment">// get details on the County property ownership / assessor data source</span>
  app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/api/about/assessor&#x27;</span>, cacheFn, dbRouteListeners.<span class="hljs-property">getAssessorSource</span>);
  <span class="hljs-comment">// get details on the State business data source</span>
  app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/api/about/business&#x27;</span>, cacheFn, dbRouteListeners.<span class="hljs-property">getBusinessSource</span>);

  <span class="hljs-comment">// route for health-check / basic functionality testing.</span>
  app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/api/ping&#x27;</span>, dbRouteListeners.<span class="hljs-property">handlePingRequest</span>);

  <span class="hljs-keyword">if</span> (dbRouteFlags.<span class="hljs-property">enable_test</span>) {
    <span class="hljs-comment">// add test queries here (search for &quot;Adding Test Queries&quot; in the code base to see other main places</span>
    <span class="hljs-comment">// code should be added)</span>

    <span class="hljs-comment">// placeholder sample test query, returns nothing</span>
    app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/api/test/sample/:query_param&#x27;</span>, cacheFn, dbRouteListeners.<span class="hljs-property">getTestSample</span>);
  }

}

</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverrestroutessessionroutes.js"><a href="#toc"><a name="server-rest-routes-sessionroutes-js">server/rest/routes/sessionRoutes.js</a></a></h2>
<pre><code><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> (app, loginLimiter) =&gt; {
  <span class="hljs-comment">//constants</span>
  <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">USERNAME</span> = process.<span class="hljs-property">env</span>.<span class="hljs-property">UI_USERNAME</span>;
  <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PASSWORD</span> = process.<span class="hljs-property">env</span>.<span class="hljs-property">UI_PASSWORD</span>;
  <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">TEMP_PASSWORD</span> = process.<span class="hljs-property">env</span>.<span class="hljs-property">UI_TEMP_PASSWORD</span>;

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">isUser</span> = (<span class="hljs-params">username, password</span>) =&gt; {
    <span class="hljs-keyword">return</span> username === <span class="hljs-variable constant_">USERNAME</span> &amp;&amp;
      ( password === <span class="hljs-variable constant_">PASSWORD</span> || password === <span class="hljs-variable constant_">TEMP_PASSWORD</span> )
  }

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">sessionChecker</span> = (<span class="hljs-params">req, res</span>) =&gt; {
    <span class="hljs-keyword">const</span> { user } = req.<span class="hljs-property">session</span>;
    <span class="hljs-keyword">if</span> ( user !== <span class="hljs-literal">undefined</span> &amp;&amp; <span class="hljs-title function_">isUser</span>(user.<span class="hljs-property">username</span>, user.<span class="hljs-property">password</span>) ) {
      res.<span class="hljs-title function_">send</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">response</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">newUser</span>: user }));
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;Session checker false.&quot;</span>);
      <span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> change back, res.send(JSON.stringify({ response: false }));</span>
      <span class="hljs-comment">//this can be toggled to turn off the login</span>
      res.<span class="hljs-title function_">send</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">response</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">newUser</span>: user }));
    }
  };

  <span class="hljs-comment">// route logic for login</span>
  app
    .<span class="hljs-title function_">route</span>(<span class="hljs-string">&quot;/session/login&quot;</span>)
    .<span class="hljs-title function_">get</span>(sessionChecker, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;session checker finished&quot;</span>);
    })
    .<span class="hljs-title function_">post</span>(loginLimiter, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> { username, password } = req.<span class="hljs-property">body</span>;

      <span class="hljs-keyword">if</span> ( <span class="hljs-title function_">isUser</span>(username, password) ) {
        <span class="hljs-keyword">const</span> newUser = {
          username,
          password,
        };

        <span class="hljs-comment">//add user object to session</span>
        req.<span class="hljs-property">session</span>.<span class="hljs-property">user</span> = newUser;
        res.<span class="hljs-title function_">send</span>(
          <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({
            <span class="hljs-attr">response</span>: <span class="hljs-literal">true</span>,
            newUser,
            <span class="hljs-attr">rateLimit</span>: req.<span class="hljs-property">rateLimit</span>, <span class="hljs-comment">//this can be used in the client</span>
          })
        );
      } <span class="hljs-keyword">else</span> {
        res.<span class="hljs-title function_">send</span>(
          <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({
            <span class="hljs-attr">response</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-attr">newUser</span>: <span class="hljs-literal">null</span>,
            <span class="hljs-attr">rateLimit</span>: req.<span class="hljs-property">rateLimit</span>, <span class="hljs-comment">//this can be used in the client</span>
          })
        );
      }
    });

  <span class="hljs-comment">//route logic for logout</span>
  app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;/session/logout&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
    <span class="hljs-comment">//destroy the sesssion</span>
    req.<span class="hljs-property">session</span> = <span class="hljs-literal">null</span>;
    res.<span class="hljs-title function_">send</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">message</span>: <span class="hljs-string">&quot;Session ended.&quot;</span> }));
  });
};
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverrestroutesunifiedsearch.js"><a href="#toc"><a name="server-rest-routes-unifiedsearch-js">server/rest/routes/unifiedSearch.js</a></a></h2>
<pre><code><span class="hljs-comment">// unifiedSearch.js</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Contains request listener for the unified search REST endpoint. Handles the</span>
<span class="hljs-comment">// business logic only, not the route configuration/setup. see</span>
<span class="hljs-comment">// type_definitions/proto/search/search.proto for a description of the request</span>
<span class="hljs-comment">// and response schemas.</span>

<span class="hljs-comment">// libraries and utilities included from source:</span>
<span class="hljs-keyword">import</span> { checkProto } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../framework/protoUtils&#x27;</span>;
<span class="hljs-keyword">import</span> { capsToTitleCase } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../utils/gnarly/stringUtils&#x27;</span>;
<span class="hljs-keyword">import</span> serviceUtils <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../framework/serviceUtils&#x27;</span>;
<span class="hljs-keyword">import</span> statusUtils <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../framework/statusUtils&#x27;</span>;

<span class="hljs-comment">// EbookSearchService:</span>

<span class="hljs-comment">// ==================================================================</span>
<span class="hljs-comment">//  REST listener for Search (unified search call).</span>
<span class="hljs-comment">//  uri: GET &#x27;/api/search?q=&lt;query&gt;&#x27;</span>
<span class="hljs-comment">// =================================================================</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">unifiedSearchListener</span>(<span class="hljs-params">req, res</span>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> app = req.<span class="hljs-property">app</span>;

    <span class="hljs-comment">// extract search string from the uri query params.</span>
    <span class="hljs-keyword">const</span> queryString = req.<span class="hljs-property">query</span>.<span class="hljs-property">q</span>;
    <span class="hljs-keyword">const</span> databaseVersionTag = req.<span class="hljs-property">query</span>.<span class="hljs-property">db_version</span>;

    <span class="hljs-comment">// request validation:</span>
    <span class="hljs-keyword">if</span> (!queryString) {
      <span class="hljs-comment">// can&#x27;t find anything if no query is provided.</span>
      res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>);
      res.<span class="hljs-title function_">json</span>({
        <span class="hljs-attr">error</span>: { <span class="hljs-attr">status</span>: statusUtils.<span class="hljs-title function_">badRequestStatus</span>(<span class="hljs-string">&quot;bad request; unparseable query string&quot;</span>) }
      });
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">const</span> request_data = {};  <span class="hljs-comment">// search.SearchRequest proto schema.</span>
    request_data.<span class="hljs-property">query_string</span> = queryString;
    <span class="hljs-keyword">if</span> (databaseVersionTag) {
      request_data.<span class="hljs-property">database_version</span> = databaseVersionTag;
    }
    
    <span class="hljs-keyword">const</span> responseOrError = <span class="hljs-keyword">await</span> app.<span class="hljs-property">locals</span>.<span class="hljs-property">services</span>.<span class="hljs-property">unifiedSearchHandler</span>.<span class="hljs-title function_">invoke</span>(
        app, <span class="hljs-string">&quot;Search&quot;</span>, request_data);
    
    <span class="hljs-comment">// Since we have no additional post-processing, we can return the result</span>
    <span class="hljs-comment">// directly. If the service call was correctly-formed but returned an</span>
    <span class="hljs-comment">// error, then the function call &#x27;serviceUtils.isResultOk(responseOrError)&#x27;</span>
    <span class="hljs-comment">// would return false.</span>

    res.<span class="hljs-title function_">json</span>(responseOrError);
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;Search error: &#x27;</span>, err);
    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Put this in a utility function.</span>
    res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>);
    res.<span class="hljs-title function_">json</span>({
      <span class="hljs-attr">error</span>: { <span class="hljs-attr">status</span>: statusUtils.<span class="hljs-title function_">internalErrorStatus</span>() }
    });
  }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  unifiedSearchListener
};
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverrestserverrest.js"><a href="#toc"><a name="server-rest-server-rest-js">server/rest/server/rest.js</a></a></h2>
<pre><code><span class="hljs-keyword">import</span> bodyParser <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;body-parser&quot;</span>;
<span class="hljs-keyword">import</span> cookieSession <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;cookie-session&quot;</span>;
<span class="hljs-keyword">import</span> helmet <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;helmet&quot;</span>;
<span class="hljs-keyword">import</span> express <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;express&quot;</span>;
<span class="hljs-keyword">import</span> cors <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;cors&quot;</span>;
<span class="hljs-keyword">import</span> dbRouteSetup <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../routes/dbRouteSetup&quot;</span>;
<span class="hljs-keyword">import</span> sessionRoutes <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../routes/sessionRoutes&quot;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">IpFilter</span> <span class="hljs-keyword">as</span> ipfilter } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;express-ipfilter&quot;</span>;
<span class="hljs-keyword">import</span> rateLimit <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;express-rate-limit&quot;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> (app, cookieKey, port) =&gt; {
  app.<span class="hljs-title function_">set</span>(<span class="hljs-string">&quot;trust proxy&quot;</span>, <span class="hljs-number">1</span>); <span class="hljs-comment">// trust first proxy</span>

  <span class="hljs-comment">// cookie management.</span>
  <span class="hljs-comment">// track the logged-in user across sessions</span>
  <span class="hljs-keyword">const</span> expiryDate = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() + <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">96000</span>); <span class="hljs-comment">// 4 days</span>

  app.<span class="hljs-title function_">use</span>(
    <span class="hljs-title function_">cookieSession</span>({
      <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;session&quot;</span>,
      <span class="hljs-attr">keys</span>: [cookieKey],
      <span class="hljs-attr">expires</span>: expiryDate
      <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> !!! <span class="hljs-doctag">NOTE:</span> THESE WILL NEED TO BE UPDATED FOR PRODUCTION !!!</span>
      <span class="hljs-comment">// secure: true,</span>
      <span class="hljs-comment">// httpOnly: true,</span>
      <span class="hljs-comment">// domain: &#x27;example.com&#x27;,</span>
      <span class="hljs-comment">// path: &#x27;/login&#x27;,</span>
      <span class="hljs-comment">// expires: expiryDate</span>
    })
  );

  <span class="hljs-comment">// security config:</span>
  app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">helmet</span>());
  app.<span class="hljs-title function_">disable</span>(<span class="hljs-string">&quot;x-powered-by&quot;</span>);

  <span class="hljs-comment">// cors</span>
  app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">cors</span>());

  <span class="hljs-comment">// for parsing restApplication/json:</span>
  app.<span class="hljs-title function_">use</span>(bodyParser.<span class="hljs-title function_">json</span>());

  <span class="hljs-comment">// for parsing restApplication/x-www-form-urlencoded:</span>
  app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">urlencoded</span>({ <span class="hljs-attr">extended</span>: <span class="hljs-literal">true</span> }));

  <span class="hljs-comment">// TODO  The whitelist will need to be updated for production</span>
  <span class="hljs-comment">// ipfilter. whitelist IPs</span>
  <span class="hljs-comment">// const ips = [&quot;127.0.0.1&quot;, &quot;::ffff:127.0.0.1&quot;];</span>
  <span class="hljs-comment">// app.use(ipfilter(ips, { mode: &#x27;allow&#x27; }));</span>

  <span class="hljs-comment">// set default rate limiting config, for rest api:</span>
  <span class="hljs-keyword">const</span> apiLimiter = <span class="hljs-title function_">rateLimit</span>({
    <span class="hljs-attr">windowMs</span>: <span class="hljs-number">5</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>, <span class="hljs-comment">// 5 minutes</span>
    <span class="hljs-attr">max</span>: <span class="hljs-number">1000</span>,
    <span class="hljs-attr">skipSuccessfulRequests</span>: <span class="hljs-literal">false</span>
  });
  app.<span class="hljs-title function_">use</span>(<span class="hljs-string">&#x27;/api/&#x27;</span>, apiLimiter);

  <span class="hljs-comment">// rate limiting for login</span>
  <span class="hljs-keyword">const</span> loginLimiter = <span class="hljs-title function_">rateLimit</span>({
    <span class="hljs-attr">windowMs</span>: <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>, <span class="hljs-comment">// 1 hour window</span>
    <span class="hljs-attr">max</span>: <span class="hljs-number">50</span>, <span class="hljs-comment">// start blocking after 50 requests</span>
    <span class="hljs-attr">skipSuccessfulRequests</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">message</span>: <span class="hljs-string">&quot;Too many logins, please try again after an hour.&quot;</span>
  });

  <span class="hljs-comment">// set up rest routes.</span>
  <span class="hljs-title function_">dbRouteSetup</span>(app);

  <span class="hljs-comment">// set up login/session routes. use loginLimiter instead of apiLimiter.</span>
  <span class="hljs-title function_">sessionRoutes</span>(app, loginLimiter);

  <span class="hljs-comment">// start listening, on the specified port</span>
  app.<span class="hljs-title function_">listen</span>(port, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`REST API server ready at http://localhost:<span class="hljs-subst">${port}</span>`</span>);
  });
};
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemasreadme.md"><a href="#toc"><a name="server-schemas-readme-md">server/schemas/README.md</a></a></h2>
<pre><code><span class="hljs-type">Json</span>-<span class="hljs-keyword">Schema</span> Templates

This directory contains <span class="hljs-type">json</span>-<span class="hljs-keyword">schema</span> definitions <span class="hljs-keyword">for</span> use <span class="hljs-keyword">in</span> the node <span class="hljs-keyword">server</span>. The intent <span class="hljs-keyword">is</span> <span class="hljs-keyword">to</span> allow <span class="hljs-keyword">for</span> a definition <span class="hljs-keyword">language</span> that<span class="hljs-string">&#x27;s legible and editable for all developers on the evictorbook project.

json-schema has two core advantages over a separate schema-definition language like protocol buffers. First, it&#x27;</span>s designed <span class="hljs-keyword">to</span> have one-<span class="hljs-keyword">to</span>-one compatibility <span class="hljs-keyword">with</span> everything that can be expressed <span class="hljs-keyword">in</span> <span class="hljs-type">json</span> (<span class="hljs-keyword">in</span> contrast <span class="hljs-keyword">to</span> the protocol <span class="hljs-keyword">buffers</span> <span class="hljs-keyword">schema</span> <span class="hljs-keyword">language</span>, which has <span class="hljs-keyword">some</span> unfortunate edge-cases <span class="hljs-keyword">in</span> <span class="hljs-type">json</span> intercompatibility). Second, the definitions are represented <span class="hljs-keyword">in</span> the specification <span class="hljs-keyword">as</span> <span class="hljs-type">json</span> descriptions, so it doesn<span class="hljs-string">&#x27;t require any additions to the toolchain other than a validation library. We&#x27;</span>ve opted <span class="hljs-keyword">for</span> Ajv, the most widely-supported <span class="hljs-type">json</span>-<span class="hljs-keyword">schema</span> <span class="hljs-keyword">validator</span> <span class="hljs-keyword">in</span> the javascript <span class="hljs-keyword">language</span>.

Problems <span class="hljs-keyword">with</span> <span class="hljs-type">json</span>-<span class="hljs-keyword">schema</span>: There <span class="hljs-keyword">is</span> a proliferation <span class="hljs-keyword">of</span> draft specifications, <span class="hljs-keyword">and</span> many features are <span class="hljs-keyword">not</span> widely supported across validation libraries. The <span class="hljs-type">json</span> <span class="hljs-keyword">format</span> does <span class="hljs-keyword">not</span> natively support <span class="hljs-keyword">inline</span> comments, so it<span class="hljs-string">&#x27;s very difficult to write effective annotations for schema definitions. Most damagingly, schema definitions are difficult to re-use: while the specification offers some support for schema re-use across files, the syntax is cumbersome and error-prone, and not uniformly supported.

To work around these challenges, we&#x27;</span>ve opted <span class="hljs-keyword">to</span> specify our <span class="hljs-type">json</span>-<span class="hljs-keyword">schema</span> definitions <span class="hljs-keyword">in</span> the form <span class="hljs-keyword">of</span> .js files. <span class="hljs-keyword">Each</span> .js file <span class="hljs-keyword">is</span> a commonjs module that exports a single <span class="hljs-keyword">object</span> literal which represents a <span class="hljs-type">json</span>-<span class="hljs-keyword">schema</span>.

This means we can easily <span class="hljs-keyword">write</span> <span class="hljs-keyword">in</span>-<span class="hljs-type">line</span> comments, <span class="hljs-keyword">and</span> we can take advantage <span class="hljs-keyword">of</span> javscript<span class="hljs-string">&#x27;s built-in mechanisms for cross-file inclusion. Individual object schemas are defined in their own .js files so they can be re-used. To include a nested schema, simply call `require(&lt;&quot;filename&quot;&gt;)` inline.

Avoid using `definitions` and `$ref` in the json-schema literals; these won&#x27;</span>t translate well <span class="hljs-keyword">when</span> included <span class="hljs-keyword">in</span> other files. <span class="hljs-keyword">Instead</span>, rely <span class="hljs-keyword">on</span> `require` <span class="hljs-keyword">as</span> described above.

These <span class="hljs-keyword">schema</span> definitions can be directly used <span class="hljs-keyword">in</span> Node <span class="hljs-keyword">with</span> either `require` <span class="hljs-keyword">or</span> `<span class="hljs-keyword">import</span>` syntax.

<span class="hljs-keyword">To</span> resolve one <span class="hljs-keyword">of</span> these <span class="hljs-keyword">schemas</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">all</span> its imports <span class="hljs-keyword">to</span> <span class="hljs-type">json</span> (<span class="hljs-keyword">for</span> example, <span class="hljs-keyword">to</span> use <span class="hljs-keyword">in</span> a <span class="hljs-type">json</span>-<span class="hljs-keyword">schema</span> <span class="hljs-keyword">validator</span> <span class="hljs-keyword">in</span> another <span class="hljs-keyword">language</span>), run the <span class="hljs-keyword">following</span> <span class="hljs-keyword">from</span> the command <span class="hljs-type">line</span>:

`node compile2json.js &lt;filename&gt; &gt; outfile.json`

Note that you<span class="hljs-string">&#x27;ll lose the inline js comments and any manual formatting from the original definitions.
</span></pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemascompile2json.js"><a href="#toc"><a name="server-schemas-compile2json-js">server/schemas/compile2json.js</a></a></h2>
<pre><code><span class="hljs-comment">// Reads a filename from the command line, interprets it as a module which</span>
<span class="hljs-comment">// exports a json-compatible object, and writes it as pretty-printed json to</span>
<span class="hljs-comment">// standard out.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Used to &quot;compile&quot; .js object definitions to json. See README.md</span>
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;fs&quot;</span>);

<span class="hljs-keyword">const</span> filename = process.<span class="hljs-property">argv</span>[<span class="hljs-number">2</span>];
<span class="hljs-keyword">const</span> resolved = <span class="hljs-built_in">require</span>(filename);

<span class="hljs-comment">// The additional parameters cause the json string to be pretty-printed with an</span>
<span class="hljs-comment">// indent of 2 spaces. Remove them for a more compact single-line json.</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(resolved, <span class="hljs-literal">null</span>, <span class="hljs-number">2</span>));
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemascompile_all_schemas.sh"><a href="#toc"><a name="server-schemas-compile_all_schemas-sh">server/schemas/compile_all_schemas.sh</a></a></h2>
<pre><code><span class="hljs-comment"># compile_all_schemas.sh</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Convenience script to convert all the &#x27;.js&#x27; schemas into json with</span>
<span class="hljs-comment"># dependencies resolved. Good for testing whether the schemas result in valid</span>
<span class="hljs-comment"># javascript objects.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># You almost certainly don&#x27;t want to commit the resulting json files to github</span>
<span class="hljs-comment"># (because it would be annoying to track whether this script has been run), so</span>
<span class="hljs-comment"># you can use delete_all_json.sh afterwards to clean up all json files in</span>
<span class="hljs-comment"># the schema directory.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># <span class="hljs-doctag">NOTE:</span> This script attempts to delete the existing json files before</span>
<span class="hljs-comment"># recompiling, so you&#x27;ll see extraneous &#x27;file does not exist&#x27; errors during that</span>
<span class="hljs-comment"># step on your first run. These are safe to ignore.</span>

<span class="hljs-comment"># make sure we&#x27;re working from the directory of the script, not the caller&#x27;s</span>
<span class="hljs-comment"># working directory.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># found on stack overflow, tested on linux mint 19. if you find compatibilty</span>
<span class="hljs-comment"># issues with your platform, please uploaded fixes or workarounds here. thanks!</span>
DIR=<span class="hljs-string">&quot;<span class="hljs-subst">$( cd <span class="hljs-string">&quot;<span class="hljs-subst">$( dirname <span class="hljs-string">&quot;<span class="hljs-variable">${BASH_SOURCE[0]}</span>&quot;</span> )</span>&quot;</span> &amp;&gt; /dev/null &amp;&amp; pwd)</span>&quot;</span>

<span class="hljs-built_in">pushd</span> <span class="hljs-variable">$DIR</span>
<span class="hljs-keyword">for</span> filename <span class="hljs-keyword">in</span> $(find ./src -name <span class="hljs-string">&quot;*.js&quot;</span>); <span class="hljs-keyword">do</span> outfile=<span class="hljs-string">&quot;<span class="hljs-variable">$filename</span>&quot;</span><span class="hljs-string">&quot;on&quot;</span>; <span class="hljs-built_in">rm</span> <span class="hljs-variable">$outfile</span> ; node ./compile2json.js <span class="hljs-variable">$filename</span> &gt; <span class="hljs-variable">$outfile</span> ; <span class="hljs-keyword">done</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;done. if you see any errors other than &#x27;rm: cannot remove &lt;filename&gt;: No such file or directory&#x27;, then the js schemas did not evaluate to valid json objects.&quot;</span>
<span class="hljs-built_in">popd</span>
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemasdelete_all_json.sh"><a href="#toc"><a name="server-schemas-delete_all_json-sh">server/schemas/delete_all_json.sh</a></a></h2>
<pre><code><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># delete_all_json.sh</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Deletes all .json files in the schema directory. Use this after &#x27;compile_all_schemas.sh&#x27; to clean your workspace after a successful compilation. </span>


<span class="hljs-comment"># make sure we&#x27;re working from the directory of the script, not the caller&#x27;s</span>
<span class="hljs-comment"># working directory.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># found on stack overflow, tested on linux mint 19. if you find compatibilty</span>
<span class="hljs-comment"># issues with your platform, please uploaded fixes or workarounds here. thanks!</span>
DIR=<span class="hljs-string">&quot;<span class="hljs-subst">$( cd <span class="hljs-string">&quot;<span class="hljs-subst">$( dirname <span class="hljs-string">&quot;<span class="hljs-variable">${BASH_SOURCE[0]}</span>&quot;</span> )</span>&quot;</span> &amp;&gt; /dev/null &amp;&amp; pwd)</span>&quot;</span>

<span class="hljs-built_in">echo</span> Removing .json files from <span class="hljs-variable">$DIR</span>

<span class="hljs-keyword">for</span> filename <span class="hljs-keyword">in</span> $(find <span class="hljs-variable">$DIR</span>/src -name <span class="hljs-string">&quot;*.json&quot;</span>); <span class="hljs-keyword">do</span> <span class="hljs-built_in">rm</span> <span class="hljs-variable">$filename</span> ; <span class="hljs-keyword">done</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;done&quot;</span>
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemaslegacyhowto_compile_protos.md"><a href="#toc"><a name="server-schemas-legacy-howto_compile_protos-md">server/schemas/legacy/HOWTO_Compile_protos.md</a></a></h2>
<pre><code>HOWTO Compile protos

To compile the protos <span class="hljs-keyword">in</span> this directory <span class="hljs-keyword">and</span> generate static code for python <span class="hljs-keyword">and</span>
js, run the following script:

  ./compile_protos.sh

You will need to install `protoc` <span class="hljs-keyword">as</span> well <span class="hljs-keyword">as</span> `pbf`. See details below.

Compile protos to python generated code:
- Install protoc (see below).
- `protoc --python_out=&lt;path_to_output&gt;/python <span class="hljs-comment">*.proto`
- protoc generates one output file for each input file in the command line invocation.

Compile protos to pbf js code:
- Install mapbox pbf (see below).
- `pbf in.proto &gt; out.js`
- <span class="hljs-doctag">Note:</span> in.proto should &#x27;import&#x27; all the other proto files you need for the module. mapbox pbf&#x27;s compiler merges all dependencies into a single module.
- <span class="hljs-doctag">Note:</span> mapbox pbf uses node&#x27;s built-in proto schema resolver rather than google&#x27;s (presumably for licensing reasons). this leads to inconsistent behavior regarding imports and package names, so we&#x27;re keeping the directory structure simple. 

Installing protoc (the original proto compiler):
- Ubuntu and debian-based distros: sudo apt install protobuf-compiler
- Mac: brew install protobuf
- Other distros: see https://google.github.io/proto-lens/installing-protoc.html for example commands to download and install precompiled binaries
- If you&#x27;re feeling spicy: clone https://github.com/protocolbuffers/protobuf and compile from source. 

Installing mapbox pbf:
- With nodejs and npm installed, run: npm install -g pbf

</span></pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemaslegacyreadme.md"><a href="#toc"><a name="server-schemas-legacy-readme-md">server/schemas/legacy/README.md</a></a></h2>
<pre><code><span class="hljs-type">Type</span> definitions <span class="hljs-keyword">for</span> the evictorbook project.

<span class="hljs-type">Consider</span> <span class="hljs-keyword">this</span> the canonical source <span class="hljs-keyword">for</span> schemas on datastores, csv&#x27;s, http/rest messages in transit, json-based config messages, and anything <span class="hljs-keyword">else</span> that&#x27;s a clean interface boundary that lends itself to <span class="hljs-class"><span class="hljs-keyword">type</span><span class="hljs-title">-checking</span>.</span>

<span class="hljs-type">Definitions</span> are written in proto, aka the protocol buffers <span class="hljs-class"><span class="hljs-keyword">type</span> <span class="hljs-title">definition</span> <span class="hljs-title">language</span>. <span class="hljs-title">See</span> <span class="hljs-title">readme</span> <span class="hljs-title">file</span> <span class="hljs-title">in</span> .<span class="hljs-title">/proto/</span> <span class="hljs-title">subdirectory</span> <span class="hljs-title">for</span> <span class="hljs-title">details</span> <span class="hljs-title">on</span> <span class="hljs-title">this</span> <span class="hljs-title">format</span>.</span>

<span class="hljs-type">Index</span>:
- ./proto - the <span class="hljs-class"><span class="hljs-keyword">type</span> <span class="hljs-title">definitions</span> <span class="hljs-title">themselves</span>. <span class="hljs-title">descriptions</span> <span class="hljs-title">of</span> <span class="hljs-title">file</span> <span class="hljs-title">and</span> <span class="hljs-title">message</span> <span class="hljs-title">schemas</span> <span class="hljs-title">used</span> <span class="hljs-title">in</span> <span class="hljs-title">the</span> <span class="hljs-title">ebook</span> <span class="hljs-title">codebase</span>, <span class="hljs-keyword">with</span> <span class="hljs-title">per-field</span> <span class="hljs-title">comments</span>.</span>
- ./gen - autogenerated code to use those <span class="hljs-class"><span class="hljs-keyword">type</span> <span class="hljs-title">definitions</span> <span class="hljs-title">in</span> <span class="hljs-title">js</span>, <span class="hljs-title">py</span>.</span>
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemaslegacycompile_protos.sh"><a href="#toc"><a name="server-schemas-legacy-compile_protos-sh">server/schemas/legacy/compile_protos.sh</a></a></h2>
<pre><code><span class="hljs-comment">#!/bin/bash</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># compile_protos.sh</span>

<span class="hljs-comment"># Quick and dirty script to compile protos, writing python generated code and</span>
<span class="hljs-comment"># mapbox pbf modules for js.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># DEPRECATED as of 2021/06/14. This should be considered legacy code, and is</span>
<span class="hljs-comment"># included here on the off-chance that someone will need to generate</span>
<span class="hljs-comment"># protocol-buffer encoder code from these schemas for external use.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># This script is not very robust (doesn&#x27;t handle error-checking, etc). If you</span>
<span class="hljs-comment"># run it, you&#x27;ll notice that it needs the output directories to be created</span>
<span class="hljs-comment"># ahead of time.</span>



<span class="hljs-comment"># make sure we&#x27;re working from the directory of the script, not the caller&#x27;s</span>
<span class="hljs-comment"># working directory.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># found on stack overflow, tested on linux mint 19. if you find compatibilty</span>
<span class="hljs-comment"># issues with your platform, please uploaded fixes or workarounds here. thanks!</span>
DIR=<span class="hljs-string">&quot;$( cd &quot;</span>$( dirname <span class="hljs-string">&quot;${BASH_SOURCE[0]}&quot;</span> )<span class="hljs-string">&quot; &amp;&gt; /dev/null &amp;&amp; pwd)&quot;</span>
echo <span class="hljs-variable">$DIR</span>

<span class="hljs-comment"># compile proto packages:</span>

<span class="hljs-comment"># <span class="hljs-doctag">NOTE:</span> Mapbox pbf compiler cli uses node&#x27;s bespoke protocol buffer compiler,</span>
<span class="hljs-comment"># which generates rather terse error messages. Therefore, we use the official</span>
<span class="hljs-comment"># &#x27;protoc&#x27; compiler to build python modules in parallel, to get reasonable</span>
<span class="hljs-comment"># error message when things go wrong.</span>

<span class="hljs-comment"># 1. graph protos</span>
pushd <span class="hljs-variable">$DIR</span><span class="hljs-regexp">/proto/g</span>raph
<span class="hljs-comment"># clear existing generated code:</span>
rm ..<span class="hljs-regexp">/../g</span>en<span class="hljs-regexp">/python/g</span>raph/*
rm ..<span class="hljs-regexp">/../g</span>en<span class="hljs-regexp">/js/g</span>raph/*
<span class="hljs-comment"># generate python code with protoc:</span>
protoc --python_out=..<span class="hljs-regexp">/../g</span>en<span class="hljs-regexp">/python/g</span>raph *.proto
<span class="hljs-comment"># generate js pbf module:</span>
pbf graph.proto &gt; ..<span class="hljs-regexp">/../g</span>en<span class="hljs-regexp">/js/g</span>raph/index.js
popd

<span class="hljs-comment"># 2. query abstraction layer protos</span>
pushd <span class="hljs-variable">$DIR</span><span class="hljs-regexp">/proto/</span>query
<span class="hljs-comment"># clear existing generated code:</span>
rm ..<span class="hljs-regexp">/../g</span>en<span class="hljs-regexp">/python/</span>query/*
rm ..<span class="hljs-regexp">/../g</span>en<span class="hljs-regexp">/js/</span>query/*
<span class="hljs-comment"># generate python code with protoc:</span>
protoc --python_out=..<span class="hljs-regexp">/../g</span>en<span class="hljs-regexp">/python/</span>query *.proto
<span class="hljs-comment"># generate js pbf module:</span>
pbf query.proto &gt; ..<span class="hljs-regexp">/../g</span>en<span class="hljs-regexp">/js/</span>query/index.js
popd

<span class="hljs-comment"># 3. rest api protos</span>
pushd <span class="hljs-variable">$DIR</span><span class="hljs-regexp">/proto/</span>rest
<span class="hljs-comment"># clear existing generated code:</span>
rm ..<span class="hljs-regexp">/../g</span>en<span class="hljs-regexp">/python/</span>rest/*
rm ..<span class="hljs-regexp">/../g</span>en<span class="hljs-regexp">/js/</span>rest/*
<span class="hljs-comment"># generate python code with protoc:</span>
protoc --python_out=..<span class="hljs-regexp">/../g</span>en<span class="hljs-regexp">/python/</span>rest *.proto
<span class="hljs-comment"># generate js pbf modules:</span>
pbf rest.proto &gt; ..<span class="hljs-regexp">/../g</span>en<span class="hljs-regexp">/js/</span>rest/index.js
popd

<span class="hljs-comment"># 4. unified search protos</span>
pushd <span class="hljs-variable">$DIR</span><span class="hljs-regexp">/proto/</span>search
<span class="hljs-comment"># clear existing generated code:</span>
rm ..<span class="hljs-regexp">/../g</span>en<span class="hljs-regexp">/python/</span>search/*
rm ..<span class="hljs-regexp">/../g</span>en<span class="hljs-regexp">/js/</span>search/*
<span class="hljs-comment"># generate python code with protoc:</span>
protoc --python_out=..<span class="hljs-regexp">/../g</span>en<span class="hljs-regexp">/python/</span>search *.proto
<span class="hljs-comment"># generate js pbf modules:</span>
pbf search.proto &gt; ..<span class="hljs-regexp">/../g</span>en<span class="hljs-regexp">/js/</span>search/index.js
popd

echo <span class="hljs-string">&quot;done compiling.&quot;</span>


<span class="hljs-comment"># final step -- copy the generated js into server/ so it can be read by the node container.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># <span class="hljs-doctag">TODO:</span> find a more elegant solution here. one option is to move the proto/</span>
<span class="hljs-comment"># directory under server/, but this has issues for sharing the protos among</span>
<span class="hljs-comment"># multiple applications.</span>

<span class="hljs-comment"># NOTE(2021/06/14): Removing this step as the proto definitions have been moved</span>
<span class="hljs-comment"># under the server/ directory, so there&#x27;s no need to copy. It&#x27;s unlikely that</span>
<span class="hljs-comment"># we&#x27;ll need to programatically copy these, as we&#x27;re sunsetting the use of</span>
<span class="hljs-comment"># protocol buffers for general schema definitions in ebook.</span>

<span class="hljs-comment">#pushd $DIR</span>
<span class="hljs-comment">#cp -r ./gen/js/* ../server/gen-proto/</span>
<span class="hljs-comment">#popd</span>

<span class="hljs-comment"># <span class="hljs-doctag">TODO:</span> add actual error handling.</span>
<span class="hljs-comment"># echo &quot;copied generated code.&quot;</span>
echo <span class="hljs-string">&quot; if you&#x27;ve made it this far and you don&#x27;t see an error message above, you&#x27;re done and everything&#x27;s ok.&quot;</span>

<span class="hljs-comment"># done.</span>

</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemaslegacymd-generatedreadme.md"><a href="#toc"><a name="server-schemas-legacy-md-generated-readme-md">server/schemas/legacy/md-generated/README.md</a></a></h2>
<pre><code># <span class="hljs-keyword">Generated</span> Markdown doc

Consider this the &quot;user-friendly&quot; <span class="hljs-keyword">version</span> <span class="hljs-keyword">of</span> the <span class="hljs-keyword">schema</span> documentation. __NOTE that it contains detailed information about the research methodology so it should <span class="hljs-keyword">only</span> be shared <span class="hljs-keyword">with</span> <span class="hljs-keyword">trusted</span> partners!__

* __graph/docs.md__: complete <span class="hljs-keyword">schema</span> description <span class="hljs-keyword">of</span> the evictorbook <span class="hljs-number">1.0</span> serving graph, which provides the serving data <span class="hljs-keyword">from</span> the initial evictorbook <span class="hljs-keyword">release</span> <span class="hljs-keyword">on</span> may <span class="hljs-number">1</span>, <span class="hljs-number">2020</span> through present.
* __rest/docs.md__: complete description <span class="hljs-keyword">of</span> evictorbook <span class="hljs-number">1.0</span> rest api. endpoints, uris, parameters, response <span class="hljs-type">json</span> <span class="hljs-keyword">schemas</span>, etc.
* __query/docs.md__: complete description <span class="hljs-keyword">of</span> <span class="hljs-type">internal</span> evictorbook query-abstraction-layer, which <span class="hljs-keyword">is</span> the interface boundary <span class="hljs-keyword">between</span> <span class="hljs-keyword">server</span>-side javascript (<span class="hljs-keyword">server</span>/rest/routes/) <span class="hljs-keyword">and</span> runtime cypher queries (<span class="hljs-keyword">server</span>/rest/handlers/). a reference guide <span class="hljs-keyword">for</span> <span class="hljs-keyword">server</span>-side devs, <span class="hljs-keyword">and</span> the basis <span class="hljs-keyword">for</span> <span class="hljs-keyword">server</span>-side unit tests.

Auto-<span class="hljs-keyword">generated</span> <span class="hljs-keyword">from</span> ../proto <span class="hljs-keyword">using</span> https://github.com/pseudomuto/protoc-gen-doc, <span class="hljs-keyword">with</span> necessary hand-edits <span class="hljs-keyword">to</span> fix things that were confusing <span class="hljs-keyword">or</span> straight-up broken <span class="hljs-keyword">in</span> the generator<span class="hljs-string">&#x27;s output. In the future, we&#x27;</span>ll streamline the proto-<span class="hljs-keyword">to</span>-markdown process so hand-edits are necessary, but <span class="hljs-keyword">until</span> <span class="hljs-keyword">then</span>, expect the Markdown <span class="hljs-keyword">to</span> be updated less frequently.

Word <span class="hljs-keyword">to</span> the wise: <span class="hljs-keyword">if</span> you<span class="hljs-string">&#x27;re a developer and looking for the canonical, up-to-date documentation that can be directly used in code, see the .proto files themselves in ../proto. Those files are intended to be read by both developers and compilers. However, if you are unfamiliar with the .proto language and are seeking an overview of the ebook schema contents, this is the place.

(end note on the generator: before I forget, there&#x27;</span>s another issue: protoc-gen-doc requires <span class="hljs-string">&#x27;go&#x27;</span> <span class="hljs-keyword">to</span> <span class="hljs-keyword">work</span>, <span class="hljs-keyword">and</span> it uses a docker container <span class="hljs-keyword">as</span> a compatibility layer. which gets really annoying/confusing <span class="hljs-keyword">when</span> we try <span class="hljs-keyword">to</span> mix <span class="hljs-keyword">if</span> <span class="hljs-keyword">with</span> our docker setup. <span class="hljs-keyword">for</span> that reason, i don<span class="hljs-string">&#x27;t want to make the md generator a critical part of the dev toolchain. -Dana)

</span></pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemaslegacymd-generatedgraphdocs.md"><a href="#toc"><a name="server-schemas-legacy-md-generated-graph-docs-md">server/schemas/legacy/md-generated/graph/docs.md</a></a></h2>
<pre><code><span class="hljs-comment"># Evictorbook Graph Schema Definition </span>
<span class="hljs-variable">&lt;a name=&quot;top&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### Note for readers</span>

The documentation featured below was originally written in a format called &#x27;proto&#x27;, and then converted to Markdown. proto is a schema definition language that&#x27;s intended to be both machine-readable and developer-readable. The motivation is to declare the machine-readable schema directly alongside human-readable comments, in the same file, so the canonical documentation always matches the schema enforced in code. The disadvantage is that .proto syntax requires some getting used to.

In order to produce a more user-friendly and widely readable documentation, we use an automated tool to convert the &#x27;proto&#x27; files into Markdown. The text descriptions here are imported directly from the comments in the &#x27;proto&#x27; files. This introduces some quirks in formatting (for example, multi-line comments are compressed into a single line in order to fit into the Markdown tables below). Let us know how we did; the Markdown formatting is a work in progress, so let us know if you have suggestions to improve this formatting or make it more readable.

That&#x27;s the disclaimer. Read on for the documentation.

<span class="hljs-comment">## Table of Contents</span>

- [graph.proto](<span class="hljs-comment">#graph.proto)</span>
    - [Graph](<span class="hljs-comment">#graph.Graph)</span>
    - [Graph.NodeCollection](<span class="hljs-comment">#graph.Graph.NodeCollection)</span>
    - [Graph.RelationCollection](<span class="hljs-comment">#graph.Graph.RelationCollection)</span>
  
- [nodes.proto](<span class="hljs-comment">#nodes.proto)</span>
    - [NodeType](<span class="hljs-comment">#graph.NodeType)</span>

    - [AddressMainData](<span class="hljs-comment">#graph.AddressMainData)</span>
    - [AddressUnitData](<span class="hljs-comment">#graph.AddressUnitData)</span>
    - [CalSOSCorpData](<span class="hljs-comment">#graph.CalSOSCorpData)</span>
    - [CalSOSLPData](<span class="hljs-comment">#graph.CalSOSLPData)</span>
    - [CalSOSOwnerData](<span class="hljs-comment">#graph.CalSOSOwnerData)</span>
    - [NodeDetails](<span class="hljs-comment">#graph.NodeDetails)</span>
    - [SFAssessorParcelData](<span class="hljs-comment">#graph.SFAssessorParcelData)</span>
    - [SFAssessorParcelOwnerData](<span class="hljs-comment">#graph.SFAssessorParcelOwnerData)</span>
    - [SFRentBoardEvictionData](<span class="hljs-comment">#graph.SFRentBoardEvictionData)</span>
    - [SFRentBoardEvictorData](<span class="hljs-comment">#graph.SFRentBoardEvictorData)</span>
  
- [relations.proto](<span class="hljs-comment">#relations.proto)</span>
    - [RelationType](<span class="hljs-comment">#graph.RelationType)</span>

    - [BELinkedToRelationData](<span class="hljs-comment">#graph.BELinkedToRelationData)</span>
    - [EntityOwnedByRelationData](<span class="hljs-comment">#graph.EntityOwnedByRelationData)</span>
    - [EvictedByRelationData](<span class="hljs-comment">#graph.EvictedByRelationData)</span>
    - [EvictionAtRelationData](<span class="hljs-comment">#graph.EvictionAtRelationData)</span>
    - [ListedAtRelationData](<span class="hljs-comment">#graph.ListedAtRelationData)</span>
    - [OfficerForRelationData](<span class="hljs-comment">#graph.OfficerForRelationData)</span>
    - [ParcOwnedByRelationData](<span class="hljs-comment">#graph.ParcOwnedByRelationData)</span>
    - [ParcelOwnerAtAddressRelationData](<span class="hljs-comment">#graph.ParcelOwnerAtAddressRelationData)</span>
    - [RelationDetails](<span class="hljs-comment">#graph.RelationDetails)</span>
    - [UnitAtRelationData](<span class="hljs-comment">#graph.UnitAtRelationData)</span>



<span class="hljs-variable">&lt;a name=&quot;graph.proto&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>
<span class="hljs-variable">&lt;p align=&quot;right&quot;&gt;</span><span class="hljs-variable">&lt;a href=&quot;#top&quot;&gt;</span>Top<span class="hljs-variable">&lt;/a&gt;</span><span class="hljs-variable">&lt;/p&gt;</span>

<span class="hljs-comment">## graph.proto</span>



<span class="hljs-variable">&lt;a name=&quot;graph.Graph&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### Graph</span>
Represents the complete contents of the evictorbook serving graph.

TODO: Introduce a &amp;<span class="hljs-comment">#39;metadata&amp;#39; sub-message.</span>


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> node_collection </span>|<span class="hljs-string"> [Graph.NodeCollection](#graph.Graph.NodeCollection) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Decribes the set of nodes in the graph, identified by unique string key. </span>|
|<span class="hljs-string"> relation_collection </span>|<span class="hljs-string"> [Graph.RelationCollection](#graph.Graph.RelationCollection) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Describes the set of relations (aka edges) among nodes in the graph. </span>|






<span class="hljs-variable">&lt;a name=&quot;graph.Graph.NodeCollection&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### Graph.NodeCollection</span>
Container message for nodes in the graph.

We present a wrapper message to have room to add additional fields which
are strongly associated with the node list (metadata, flags, etc).


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> nodes </span>|<span class="hljs-string"> list&lt; [NodeDetails](#graph.NodeDetails) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> list of nodes in the graph. </span>|






<span class="hljs-variable">&lt;a name=&quot;graph.Graph.RelationCollection&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### Graph.RelationCollection</span>
Container message for relations in the graph.

As with NodeCollection above, we present a wrapper message to reserve
space for add additional fields that are strongly associated with the
relation list (metadata, flags, etc).


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> relations </span>|<span class="hljs-string"> list&lt; [RelationDetails](#graph.RelationDetails) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> list of relations in the graph, identified by the unique string keys of the source and destination nodes. </span>|





 

 

 

 



<span class="hljs-variable">&lt;a name=&quot;nodes.proto&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>
<span class="hljs-variable">&lt;p align=&quot;right&quot;&gt;</span><span class="hljs-variable">&lt;a href=&quot;#top&quot;&gt;</span>Top<span class="hljs-variable">&lt;/a&gt;</span><span class="hljs-variable">&lt;/p&gt;</span>

<span class="hljs-comment">## nodes.proto</span>
notes.proto

This file contains message definitions representing the nodes in the
evictorbook graph.



<span class="hljs-variable">&lt;a name=&quot;graph.NodeType&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### NodeType</span>
Types of entities that appear as nodes in the evictorbook-sf graph.

Names of these values correspond directly to the strings used for tags in
the evictorbook serving database, so they&amp;<span class="hljs-comment">#39;re terse and require some</span>
explanation.

These names are &amp;<span class="hljs-comment">#39;namespaced&amp;#39; with prefixes depending on their source:</span>
 
```
  prefix  |<span class="hljs-string">  source
 -------------------------------------------
  A       </span>|<span class="hljs-string">  San Francisco Assessor&amp;#39;s office
  SOS     </span>|<span class="hljs-string">  California Sec. of State business index
  RB      </span>|<span class="hljs-string">  SF Rent Board
```

&amp;#34;Address&amp;#34; nodes have no namespace, and are generated when parsing
documents from any source. In other words, the types which begin with
&amp;#34;ADDRESS&amp;#34; have no implied data source.

Below, you&amp;#39;ll find message descriptions for the data payloads of each of
these types. See those descriptions for more details.

</span>|<span class="hljs-string"> Name </span>|<span class="hljs-string"> Number </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ------ </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> NODE_TYPE_UNSPECIFIED </span>|<span class="hljs-string"> 0 </span>|<span class="hljs-string"> Default value. Treat as unset. </span>|
|<span class="hljs-string"> A_PARCEL </span>|<span class="hljs-string"> 1 </span>|<span class="hljs-string"> Corresponds to node type &amp;#34;A_Parcel&amp;#34;.  Represents a physical parcel, as it&amp;#39;s described in records from the SF Assessor&amp;#39;s office. Contains fields for the parcel&amp;#39;s location and physical characteristics. </span>|
|<span class="hljs-string"> A_PARCEL_OWNER </span>|<span class="hljs-string"> 2 </span>|<span class="hljs-string"> Corresponds to node type &amp;#34;A_Parcel_Owner&amp;#34;. </span>|
|<span class="hljs-string"> SOS_LP </span>|<span class="hljs-string"> 3 </span>|<span class="hljs-string"> Corresponds to node type &amp;#34;SOS_LP&amp;#34;.  A limited partnership or an LLC, as it&amp;#39;s represented in the California Secretary of State business entity index. </span>|
|<span class="hljs-string"> SOS_CORP </span>|<span class="hljs-string"> 4 </span>|<span class="hljs-string"> Corresponds to node type &amp;#34;SOS_Corp&amp;#34;.  A for-profit corporation, as it&amp;#39;s represented in the California Secretary of State business entity index. </span>|
|<span class="hljs-string"> SOS_OWNER </span>|<span class="hljs-string"> 5 </span>|<span class="hljs-string"> Corresponds to node type &amp;#34;SOS_Owner&amp;#34;.  A person or business-entity which has an ownership interest in another business-entity, as described in the California Secretary of State business entity index. </span>|
|<span class="hljs-string"> RB_EVICTION </span>|<span class="hljs-string"> 6 </span>|<span class="hljs-string"> Corresponds to node type &amp;#34;RB_Eviction&amp;#34;.  A record of an eviction which occurred in San Francisco, as represented in SF Rent Board records. </span>|
|<span class="hljs-string"> RB_EVICTOR </span>|<span class="hljs-string"> 7 </span>|<span class="hljs-string"> Corresponds to node type &amp;#34;RB_Evictor&amp;#34;.  Represents a person or entity who instigated an eviction, according to information from eviction records and/or sales transfer records. </span>|
|<span class="hljs-string"> ADDRESS_MAIN </span>|<span class="hljs-string"> 8 </span>|<span class="hljs-string"> Corresponds to node type &amp;#34;Address_Main&amp;#34;.  Full address, without unit. May represent the address of a parcel&amp;#39;s owner, or an address associated with a business entity or one of its officers.  The idea is to provide a single node that acts as a building or lot&amp;#39;s conceptual &amp;#34;anchor&amp;#34; node, while ADDRESS_UNIT nodes represent individual units that can be resolved at that address. </span>|
|<span class="hljs-string"> ADDRESS_UNIT </span>|<span class="hljs-string"> 9 </span>|<span class="hljs-string"> Corresponds to node type &amp;#34;Address_Unit&amp;#34;.  Full address, including a unit number if applicable. May represent the address of a parcel&amp;#39;s owner, or an address associated with a business entity or one of its officers.  Address_Unit graph nodes are analysed with connected component analysis, and the network_id of the address&amp;#39;s component is stored in this node. </span>|



<span class="hljs-variable">&lt;a name=&quot;graph.NodeDetails&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### NodeDetails</span>
Represents a single node in the graph.

Contains graph metadata (id, labels, type) as well as type-safe descriptions of the node&#x27;s payload (key-value properties). set only one of the &#x27;data&#x27; fields below, as appropriate for the node&#x27;s type.

|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> identity </span>|<span class="hljs-string"> [int64](#int64) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> internal graph db id for this node. </span>|
|<span class="hljs-string"> labels </span>|<span class="hljs-string"> list&lt; [string](#string) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> the node types that this node has. in our graph, nodes always have a single type, as of 2021/03/12, but this may change in the future. </span>|
|<span class="hljs-string"> type </span>|<span class="hljs-string"> [NodeType](#graph.NodeType) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> the semantic type of the node, as an enum. </span>|
|<span class="hljs-string"> unique_string_key </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> a string key which uniquely identifies this node (among other nodes of its type). each node type has a field which is designated as the unique key. see definitions inline.  TODO: annotate key fields in a machine-readable way. </span>|
|<span class="hljs-string"> sf_assessor_parcel_data </span>|<span class="hljs-string"> [SFAssessorParcelData](#graph.SFAssessorParcelData) </span>|<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|
|<span class="hljs-string"> sf_assessor_parcel_owner_data </span>|<span class="hljs-string"> [SFAssessorParcelOwnerData](#graph.SFAssessorParcelOwnerData) </span>|<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|
|<span class="hljs-string"> cal_sos_limited_business_data </span>|<span class="hljs-string"> [CalSOSLPData](#graph.CalSOSLPData) </span>|<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|
|<span class="hljs-string"> cal_sos_corporation_data </span>|<span class="hljs-string"> [CalSOSCorpData](#graph.CalSOSCorpData) </span>|<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|
|<span class="hljs-string"> cal_sos_business_owner_data </span>|<span class="hljs-string"> [CalSOSOwnerData](#graph.CalSOSOwnerData) </span>|<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|
|<span class="hljs-string"> sfrb_eviction_data </span>|<span class="hljs-string"> [SFRentBoardEvictionData](#graph.SFRentBoardEvictionData) </span>|<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|
|<span class="hljs-string"> sfrb_evictor_data </span>|<span class="hljs-string"> [SFRentBoardEvictorData](#graph.SFRentBoardEvictorData) </span>|<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|
|<span class="hljs-string"> address_main_data </span>|<span class="hljs-string"> [AddressMainData](#graph.AddressMainData) </span>|<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|
|<span class="hljs-string"> address_unit_data </span>|<span class="hljs-string"> [AddressUnitData](#graph.AddressUnitData) </span>|<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|



<span class="hljs-variable">&lt;a name=&quot;graph.AddressMainData&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### AddressMainData</span>
Node type: Address_Main

Full address, without unit. May represent the address of a parcel&amp;<span class="hljs-comment">#39;s owner,</span>
or an address associated with a business entity or one of its officers.

&amp;<span class="hljs-comment">#39;Address_Main&amp;#39; represents a conceptual &amp;#39;anchor&amp;#39; or entry point for all</span>
possible units at a given top-level street address. In contrast, its
counterpart &amp;<span class="hljs-comment">#39;Address_Unit&amp;#39; represents a &amp;#39;resolved&amp;#39; address that can</span>
actually be contacted, with unit number if applicable. See details in
Address_Unit description below.

TODO: Consider a structured representation of the address for more robust
comparisons.


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> addr </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> The address, represented as a single string.  TODO: Describe format guidelines -- does this need a city and zip, for example?  TODO: Describe whether and how this string was normalized. </span>|






<span class="hljs-variable">&lt;a name=&quot;graph.AddressUnitData&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### AddressUnitData</span>
Node type: Address_Unit

Represents a resolved address, with unit number if necessary, which can be
contacted by mail or visited in person. May represent the address of a
parcel&amp;<span class="hljs-comment">#39;s owner, or an address associated with a business entity or one of</span>
its officers.

This node exists even for addresses which contain only a single unit. See
description of Address_Main above. Single-unit addresses are considered to
be a special case, where the conceptual &amp;<span class="hljs-comment">#39;main&amp;#39; address happens to</span>
correspond to the &amp;<span class="hljs-comment">#39;resolved&amp;#39; (unit-level) address.</span>

Address_Unit graph nodes are analysed with connected component analysis,
and the network_id of the address&amp;<span class="hljs-comment">#39;s component is stored in this node.</span>

TODO: Consider a structured representation for more robust comparisons, as
with Address_Main above.


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> addr </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> The address, represented as a single string.  TODO: Describe format guidelines -- does this need a city and zip, for example?  TODO: Describe whether and how this string was normalized. </span>|
|<span class="hljs-string"> network_id </span>|<span class="hljs-string"> [int64](#int64) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Network component id of the business-network component which is primarily associated with this unit-level address.  These network component id&amp;#39;s are assigned during component analysis in the evictorbook data pipeline.  For more info about network component id&amp;#39;s assigned in the evictorbook graph, see documentation on &amp;#39;c_id&amp;#39; and &amp;#39;network_id&amp;#39; in CalSOSLPData and CalSOSCorpData messages.  See the developer guide for a detailed description of the evictorbook&amp;#39;s network connection methodology in the section &amp;#34;Network Connection Method - Detailed &amp;gt; During DB Creation&amp;#34;. As of 2020/09/09, network_id assignment is described in step &amp;#39;III&amp;#39;. of that section. </span>|






<span class="hljs-variable">&lt;a name=&quot;graph.CalSOSCorpData&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### CalSOSCorpData</span>
Node type: SOS_Corp

A corporation, as described in the Calif. Sec. of State business entity
index.


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> name_norm </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Normalized name of the business, derived from the name in Calif. Sec. of State business records.  TODO: Describe or link specifics of the string normalization. </span>|
|<span class="hljs-string"> transaction_date </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Transaction date of the document which established this corporation, according to the California Secretary of State business registry.  Date is represented as a string with format &amp;#39;CCYYMMDD&amp;#39;. </span>|
|<span class="hljs-string"> corporation_number </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> An 8 digit Corporate Identification Number, from the California Secretary of State business registry. </span>|
|<span class="hljs-string"> incorporation_date </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Date on which this corporation was incorporated, according to the California Secretary of State business registry.  Date is represented as a string with format &amp;#39;CCYYMMDD&amp;#39;. </span>|
|<span class="hljs-string"> corporation_status </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Status of the corporation, as a string containing a code from Calif. Sec. of State business entity records. The values are described as follows in the database schema documentation:  1 = Active 2 = Suspended 3 = Canceled 4 = Surrendered 5 = Term expired 6 = Dissolved 7 = Forfeited 8 = Deleted 9 = Inactive C = Merged Out E = State to Federal Bank Conversion F = Conditionally dissolved (No tax clearance) Not sure about code = Converted Out  In the 05/2020 production database, the codes which appear are: &amp;#34;0&amp;#34;-&amp;#34;9&amp;#34;, &amp;#34;C&amp;#34; </span>|
|<span class="hljs-string"> corporation_type </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Description of the legal process used to establish this corporation, according to Calif. Sec. of state records. The allowed values and their meanings are listed below.  ARTS = Articles of Incorporation S&amp;amp;DC = Statement &amp;amp; Designation By Foreign Corporation S&amp;amp;DA = Statement &amp;amp; Designation By Foreign Association FNRE = Foreign Name Registration  present in 05/2020 production database: &amp;#34;ARTS&amp;#34;, &amp;#34;S&amp;amp;DC&amp;#34;. </span>|
|<span class="hljs-string"> corporation_tax_base </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Description of the tax-base of the corporation, according to calif. sec. of state records. this indicates whether a corporation is for-profit or non-profit.  S = Stock N = Non-Stock (Nonprofit) </span>|
|<span class="hljs-string"> corporation_classification </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Additional corporate classifications which may convey special status, such as &amp;#39;religious&amp;#39; or &amp;#39;agricultural cooperative&amp;#39; according to calif. sec. of state business entity records.  AG = Agricultural Cooperative CR = Credit Union MU = Mutual Benefit OC = Other Cooperative PB = Public Benefit RE = Religious SL = Corporation Sole UN = Unclassified </span>|
|<span class="hljs-string"> term_expiration_date </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Limited Term expiration date. Format = CCYYMMDD </span>|
|<span class="hljs-string"> ftb_suspension_status </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Describes whether this corporation is in good standing with the california franchise tax board (ftb).  &amp;#39;&amp;#39; = Not Suspended (In Good Standing) (empty string) F = Forfeited S = Suspended </span>|
|<span class="hljs-string"> ftb_suspension_date </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> If this corporation has been subject to action by the franchise tax board as described in &amp;#39;ftb_suspension_status&amp;#34;, then this field contains a string representation of the date of that action.  Date is represented as a string with format &amp;#39;CCYYMMDD&amp;#39;. </span>|
|<span class="hljs-string"> so_file_number </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Statement of information file number, per calif sec of state records. </span>|
|<span class="hljs-string"> so_file_date </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Last complete statement (of information?) file date.  Date is represented as a string with format &amp;#39;CCYYMMDD&amp;#39;. </span>|
|<span class="hljs-string"> corporation_name </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Name of corporation, directly from calif. sec. of state records without normalization. </span>|
|<span class="hljs-string"> co_name </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> &amp;#39;Care of&amp;#39; Name, meaning the &amp;#39;c/o&amp;#39; addressee which should be included on mail intended for the corporation. </span>|
|<span class="hljs-string"> agent_name </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Name and contact info of Agent for Service of Process  !!! CAUTION !!! Different naming conventions from SOS_LP fields with similar info! </span>|
|<span class="hljs-string"> agent_address_line_1 </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|
|<span class="hljs-string"> agent_address_line_2 </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|
|<span class="hljs-string"> agent_address_city </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|
|<span class="hljs-string"> agent_address_state_county </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> The state component of the agent-for-service addr.  NOTE: These are not cleaned! Most corps have value &amp;#34;CA&amp;#34;, but some have suffixes (intended to indicate county code?)  examples of odd entries in 05/2020 production db: &amp;#34;CA 9&amp;#34;, &amp;#34;CA 5126&amp;#34;, &amp;#34;CAA&amp;#34;, &amp;#34;A&amp;#34;. </span>|
|<span class="hljs-string"> agent_address_zip_code </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Sometimes these are 5-digit codes, sometimes these are 9-digit. TODO: cleanup. </span>|
|<span class="hljs-string"> state_or_foreign_country </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> TODO: Describe this field; there&amp;#39;s no description in the schema document.  As of 2020/09/09, working understanding is that if the corporation is not &amp;#39;domestic&amp;#39; (internal to calif.), then this field describes a u.s. state other than california, or a country outside the u.s., where this corporation originated. </span>|
|<span class="hljs-string"> c_id </span>|<span class="hljs-string"> [int64](#int64) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Business entity component id, generated by the evictorbook data pipeline via connected component analysis.  Each SOS_Corp and SOS_LP graph node in the graph is assigned a &amp;#39;c_id&amp;#39;.  Two SOS_Corp and/or SOS_LP graph nodes share a c_id if there exists a path connecting those graph nodes in the subgraph of {SOS_Corp</span>|<span class="hljs-string">SOS_LP} graph nodes and {OFFICER_FOR} edges.  See the developer guide for a detailed description of the evictorbook&amp;#39;s network connection methodology in the section &amp;#34;Network Connection Method - Detailed &amp;gt; During DB Creation&amp;#34;. As of 2020/09/09, c_id assignment is described in step &amp;#39;I&amp;#39; of that section. </span>|
|<span class="hljs-string"> network_id </span>|<span class="hljs-string"> [int64](#int64) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Parcel ownership network component id, generated by the evictorbook data pipeline via connected component analysis.  SOS_Corp, SOS_LP, and SOS_Owner graph nodes are required to have a network_id, and Address_Unit graph nodes may optionally have a network_id.   Two graph nodes share a network_id if there is a path connecting those graph nodes in the subgraph of {SOS_Corp</span>|<span class="hljs-string">SOS_LP</span>|<span class="hljs-string">SOS_Owner</span>|<span class="hljs-string">Address_Unit} graph nodes and { OFFICER_FOR </span>|<span class="hljs-string"> ENTITY_OWNED BY </span>|<span class="hljs-string"> LISTED_AT } edges.  &amp;#39;network_id&amp;#39; components are aggregations of one or more &amp;#39;c_id&amp;#39; components, connected by a path in the subgraph described above.  So, graph nodes that share a &amp;#39;c_id&amp;#39; also share a &amp;#39;network_id&amp;#39;, but graph nodes that share a &amp;#39;network_id&amp;#39; do NOT NECESSARILY share a &amp;#39;c_id&amp;#39;.  See the developer guide for a detailed description of the evictorbook&amp;#39;s network connection methodology in the section &amp;#34;Network Connection Method - Detailed &amp;gt; During DB Creation&amp;#34;. As of 2020/09/09, network_id assignment is described in step &amp;#39;III&amp;#39;. of that section. </span>|






<span class="hljs-variable">&lt;a name=&quot;graph.CalSOSLPData&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### CalSOSLPData</span>
Node type: SOS_LP

A limited partnership or an LLC, as decribed in the Calif. Sec. of State
business entity index.


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> name_norm </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Normalized name of the partnership or llc, derived from the name used in Calif Sec. of State business records. TODO: Describe or link specifics of the string normalization. </span>|
|<span class="hljs-string"> jurisdiction_llc </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> LLC only: state or county for formation of foreign llc. </span>|
|<span class="hljs-string"> llc_management_code </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> LLC only: management structure. 1 = One Manager M = More Than One Manager A = All Members are Managers LLC ONLY </span>|
|<span class="hljs-string"> llc_type_of_business </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> LLC only: type of business. </span>|
|<span class="hljs-string"> file_number </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Format is CCYYJJJN9999 CCYY = Century and Year. JJJ = Julian day of year. N = Record Type 0 = LP Record 1 = LLC Record 9999 = Sequence Number </span>|
|<span class="hljs-string"> file_date </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Date of initial filing, represented as CCYYMMDD </span>|
|<span class="hljs-string"> status </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Identifies current status of LP/LLC A = Active B = Dishonored Check C = Canceled D = Dissolved P = Pending Cancellation F = Franchise Tax Board (FTB) Suspended/Forfeited M = Merged out O = Converted out S = Secretary of State (SOS) Suspended/Forfeited 2 = SOS/FTB Suspended/Forfeited </span>|
|<span class="hljs-string"> filing_type </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Filing type: foreign &amp;#34;F&amp;#34; or domestic &amp;#34;D&amp;#34;. </span>|
|<span class="hljs-string"> name </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> California Limited Partnership or LLC Name, non-normalized. </span>|
|<span class="hljs-string"> jurisdiction </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> State or country of formation for foreign limited partnerships. </span>|
|<span class="hljs-string"> agent_name </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Agent of service contact info.  !! CAUTION !! These fields follow a different naming convention than their conterparts in SOS_Corp. </span>|
|<span class="hljs-string"> agent_address_1 </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|
|<span class="hljs-string"> agent_address_2 </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|
|<span class="hljs-string"> agent_city </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|
|<span class="hljs-string"> agent_state </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|
|<span class="hljs-string"> agent_zip </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|
|<span class="hljs-string"> term </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Date or cause of termination.  This is a free-form text field and can follow many formats, depending on context. Examples of typical contents:   - date in &amp;#34;MM/DD/YY&amp;#34; format. some records allow &amp;#39;00&amp;#39; for month or date. - date in &amp;#34;MM/DD/YY&amp;#34; format with qualifying suffix. examples: &amp;#34;01/01/15 OR EVENT&amp;#34;, &amp;#34;01/15/40 OR PER AGMT&amp;#34;, &amp;#34;02/15/33\*&amp;#34; - date in &amp;#34;MMDDYY&amp;#34; format - date in &amp;#34;MM/DD/YYYY&amp;#34; format (for some 90&amp;#39;s records).  In general, if you&amp;#39;re looking at this, expect it to be difficult to parse.  TODO: document exhaustively and/or apply cleanup in pipeline. </span>|
|<span class="hljs-string"> c_id </span>|<span class="hljs-string"> [int64](#int64) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Business entity component id, generated by the evictorbook data pipeline via connected component analysis.  Each SOS_Corp and SOS_LP graph node in the graph is assigned a &amp;#39;c_id&amp;#39;.  Two SOS_Corp and/or SOS_LP graph nodes share a c_id if there exists a path connecting those graph nodes in the subgraph of {SOS_Corp</span>|<span class="hljs-string">SOS_LP} graph nodes and {OFFICER_FOR} edges.  See the developer guide for a detailed description of the evictorbook&amp;#39;s network connection methodology in the section &amp;#34;Network Connection Method - Detailed &amp;gt; During DB Creation&amp;#34;. As of 2020/09/09, c_id assignment is described in step &amp;#39;I&amp;#39; of that section. </span>|
|<span class="hljs-string"> network_id </span>|<span class="hljs-string"> [int64](#int64) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Network component id of the connected component this owner belongs to. This uniquely specifies the ownership network this owner belongs to, according to connected component analysis in the evictorbook data pipeline.  &amp;#39;network_id&amp;#39; components are aggregations of one or more &amp;#39;c_id&amp;#39; components, connected by a path in the subgraph described above.  So, graph nodes that share a &amp;#39;c_id&amp;#39; also share a &amp;#39;network_id&amp;#39;, but graph nodes that share a &amp;#39;network_id&amp;#39; do NOT NECESSARILY share a &amp;#39;c_id&amp;#39;.  See the developer guide for a detailed description of the evictorbook&amp;#39;s network connection methodology in the section &amp;#34;Network Connection Method - Detailed &amp;gt; During DB Creation&amp;#34;. As of 2020/09/09, network_id assignment is described in step &amp;#39;III&amp;#39;. of that section. </span>|






<span class="hljs-variable">&lt;a name=&quot;graph.CalSOSOwnerData&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### CalSOSOwnerData</span>
Node type: SOS_Owner

A person or business-entity which has an ownership interest in another
business-entity.

NOTE: <span class="hljs-keyword">Need</span> clarification on how this related to &amp;<span class="hljs-comment">#39;ENTITY_OWNED_BY&amp;#39; -- it</span>
seems as though if both nodes in the ENTITY_OWNED_BY relationship are
business-entities, then would be difficult to tell which entity owns the
other. Might be missing something here. -dee 10/2020


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> name_norm </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Normalized name of the person or entity who&amp;#39;s a stakeholder in a corporation or limited partnership.  TODO: Describe or link specifics of the string normalization. </span>|
|<span class="hljs-string"> network_id </span>|<span class="hljs-string"> [int64](#int64) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Network component id of the connected component this owner belongs to. This uniquely specifies the ownership network this owner belongs to, according to connected component analysis in the evictorbook data pipeline.  For more info about network component id&amp;#39;s assigned in the evictorbook graph, see documentation on &amp;#39;c_id&amp;#39; and &amp;#39;network_id&amp;#39; in CalSOSLPData and CalSOSCorpData.  See the developer guide for a detailed description of the evictorbook&amp;#39;s network connection methodology in the section &amp;#34;Network Connection Method - Detailed &amp;gt; During DB Creation&amp;#34;. As of 2020/09/09, network_id assignment is described in step &amp;#39;III&amp;#39;. of that section. </span>|







<span class="hljs-variable">&lt;a name=&quot;graph.SFAssessorParcelData&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### SFAssessorParcelData</span>
Node type: A_Parcel

Represents a physical parcel, as it&amp;<span class="hljs-comment">#39;s described in records from the SF</span>
Assessor&amp;<span class="hljs-comment">#39;s office. Contains fields for the parcel&amp;#39;s location and physical</span>
characteristics.


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> block_lot </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Block lot string, which uniquely specifies a parcel in SF city and county assessor records. This is a unique key for A_Parcel nodes in the database. </span>|
|<span class="hljs-string"> prop_class_code </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Property class code according to the SF assessor&amp;#39;s office. For values and their definitions see: https://data.sfgov.org/Housing-and-Buildings/Reference-Assessor-Recorder-Property-Class-Codes/pa56-ek2h/data </span>|
|<span class="hljs-string"> neighborhood_code </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> TODO Confirm semantics. Full neighborhood name is stored as &amp;#39;neighborhood&amp;#39;, below. </span>|
|<span class="hljs-string"> zone </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Identifier for the zoning district this parcel occupies. San Francisco zoning district identifiers can be found here: https://sfplanninggis.org/pim/map.html?layers=Zoning%20Districts </span>|
|<span class="hljs-string"> stories </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Height of the buildings in this parcel, in stories.  TODO: investigate behavior for multi-building parcels. </span>|
|<span class="hljs-string"> units </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Number of units that occupy this real-estate parcel. </span>|
|<span class="hljs-string"> rooms </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Number of rooms in the property on this parcel. </span>|
|<span class="hljs-string"> beds </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Number of bedrooms in the property on this parcel. </span>|
|<span class="hljs-string"> yr_built </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Calendar year in which the buildings on this real-estate parcel were first constructed. TODO: confirm behavior for multi-unit parcels. </span>|
|<span class="hljs-string"> parc_start_no </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> If the parcel occupies a single street number, this field contains that street number. Otherwise, it contains the lowest street number in the range of street numbers that this parcel occupies. </span>|
|<span class="hljs-string"> parc_end_no </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> If this parcel occupies multiple street numbers, this field contains the highest street number in the range of occupied street numbers.  TODO: Clarify behavior for single-street-number parcels. </span>|
|<span class="hljs-string"> parc_street_name </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> The name of the street of this parcel&amp;#39;s address, as it appears in county assessor records. </span>|
|<span class="hljs-string"> parc_street_type </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Suffix of the street part of this parcel&amp;#39;s address, as it appears in county assessor records. </span>|
|<span class="hljs-string"> parc_unit_no </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Unit number component of this parcel&amp;#39;s address, as it appears in county assessor records.  TODO Clarify behavior when the parcel has no subunits. </span>|
|<span class="hljs-string"> parc_zip </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> The zip code of this parcel&amp;#39;s address, as it appears in county assessor records. </span>|
|<span class="hljs-string"> update_date </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Date on which this parcel&amp;#39;s address was last updated, according to records from the assessor&amp;#39;s office. Format: CCYYMMDD </span>|
|<span class="hljs-string"> assess_land_val </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Monetary value of the land this real-estate parcel occupies, according to the most recent assessment on file, in US dollars. </span>|
|<span class="hljs-string"> assess_imp_val </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Monetary value of structures built on the land this parcel occupies, according to the most recent assessment on file, in US collars. </span>|
|<span class="hljs-string"> assess_val_date </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Date on which the parcel&amp;#39;s value was last assessed. Format: CCYYMMDD </span>|
|<span class="hljs-string"> curr_sales_price </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> TODO clarify the semantics here. Units are in US dollars. </span>|
|<span class="hljs-string"> curr_sales_date </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> TODO clarify the semantics here. Units are in US dollars. </span>|
|<span class="hljs-string"> rent_controlled </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Assessment of the rent-control status of this parcel: 0 (default) if data unavailable to determine rent controlled status, 1 if likely rent controlled, 2 if doubtful that this is rent controlled </span>|
|<span class="hljs-string"> addr </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> A string representing the parcel&amp;#39;s street address, including street number, street name and suffix, and unit number. The parcel is assumed to be within SF city/county limits.  Notes from schema definition sheet: Full address in the format of &amp;#34;ST_START_NO-ST_END_NO ST_NAME ST_TYPE (Unit UNIT)&amp;#34; (w/o end no if no address range, w/o parentheses if no unit) </span>|
|<span class="hljs-string"> long </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Longitude, in degrees, of a point within this parcel&amp;#39;s boundaries. string representing a floating-point number. </span>|
|<span class="hljs-string"> lat </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Latitude, in degrees, of a point within this parcel&amp;#39;s boundaries. string representing a floating-point number. </span>|
|<span class="hljs-string"> neighborhood </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Name of the neighborhood this parcel occupies. As of 2020/09/26, it&amp;#39;s assumed that all parcels are within SF city and county, so these are San Francisco neighborhoods.  Neighborhoods are assigned using SF polygons.  Values correspond to names of the neighborhood polygons described at: https://data.sfgov.org/Geographic-Locations-and-Boundaries/SF-Find-Neighborhoods/pty2-tcw4 </span>|






<span class="hljs-variable">&lt;a name=&quot;graph.SFAssessorParcelOwnerData&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### SFAssessorParcelOwnerData</span>
Node type: A_Parcel_Owner

Describes an individual or entity that&amp;<span class="hljs-comment">#39;s directly listed, by name, as an</span>
owner of a parcel in SF Assessor records.

NOTE: In the current schema, owners are uniquely identified by name, which
introduces potential for false positives. This is a property of the schema
that we should revisit for future revisions.


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> owner_name </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Name of owner listed on parcel.

TODO Briefly describe how/whether this data was normalized. </span>|






<span class="hljs-variable">&lt;a name=&quot;graph.SFRentBoardEvictionData&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### SFRentBoardEvictionData</span>
Node type: RB_Eviction

A record of an eviction which occurred in San Francisco, as represented in
SF Rent Board records.


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> evict_id </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Eviction ID, unique in aemp&amp;#39;s records.  IMPORTANT: This is derived from the petition ID of the eviction in rent board records, but in some cases it&amp;#39;s appended with a suffix. Therefore, it *cannot* safely be used for direct string comparison with RB records.  TODO: Document the specifics of the eviction ID suffixes.  TODO: Mitigate the impact of the ID shift by preserving the raw petition id in this node. </span>|
|<span class="hljs-string"> evict_date </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Format: CCYYMMDD </span>|
|<span class="hljs-string"> amount </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Buyout amount in USD, if applicable. </span>|
|<span class="hljs-string"> units </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Number of units whose occupants were evicted, if known. </span>|
|<span class="hljs-string"> type </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Type of eviction, for example &amp;#34;Buyout Declaration&amp;#34; or &amp;#34;Ellis Act Withdrawal&amp;#34;.  TODO: Enumerate all legal values here. Eventually, consider replacing this with an enum. </span>|
|<span class="hljs-string"> ellis_evictor </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Attributed evictors according to ellis act withdrawal records. Only populated for evictions of type &amp;#34;Ellis Act Withdrawal&amp;#34;.  TODO Verify semantics. Ad-hoc testing on EB Web shows a list of multiple ellis evictors, which appear to be derived from interpreting a string as a comma-separated list. As of 2020/09/09, the relationship between this string and the EB Web api is not well documented. </span>|






<span class="hljs-variable">&lt;a name=&quot;graph.SFRentBoardEvictorData&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### SFRentBoardEvictorData</span>
Node type: RB_Evictor 

Represents a person or entity who instigated an eviction, according to
information from sales transfer records.


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> evictor </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Name of the entity that instigated the eviction, as it appears in documents relating to the eviction. This may be an individual or a business.  TODO Describe whether and how this string was normalized. </span>|






 

 

 



<span class="hljs-variable">&lt;a name=&quot;relations.proto&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>
<span class="hljs-variable">&lt;p align=&quot;right&quot;&gt;</span><span class="hljs-variable">&lt;a href=&quot;#top&quot;&gt;</span>Top<span class="hljs-variable">&lt;/a&gt;</span><span class="hljs-variable">&lt;/p&gt;</span>

<span class="hljs-comment">## relations.proto</span>
relations.proto

This file contains message definitions that conceptually represent the
relations (edges) connecting nodes in the evictorbook graph database.

<span class="hljs-variable">&lt;a name=&quot;graph.RelationType&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### RelationType</span>
RelationType

Type enum for the potential connections between nodes in the ebook graph.
For more details see comments on the &amp;<span class="hljs-comment">#39;RelationData&amp;#39; messages below.</span>

|<span class="hljs-string"> Name </span>|<span class="hljs-string"> Number </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ------ </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> RELATION_TYPE_UNSPECIFIED </span>|<span class="hljs-string"> 0 </span>|<span class="hljs-string"> Default value. Treat as unset. </span>|
|<span class="hljs-string"> EVICTED_BY </span>|<span class="hljs-string"> 1 </span>|<span class="hljs-string"> Relation type: EVICTED_BY  Represents a hypothesis attributing an individual for being responsible in insigating an eviction.  See EvictedByRelationData description for details. </span>|
|<span class="hljs-string"> EVICTION_AT </span>|<span class="hljs-string"> 2 </span>|<span class="hljs-string"> Relation type: EVICTION_AT  Associates an SF Rent Board eviction record with the dwelling from which one or more tenants were evicted.  See EvictionAtRelationData description for details. </span>|
|<span class="hljs-string"> LISTED_AT </span>|<span class="hljs-string"> 3 </span>|<span class="hljs-string"> Relation type: LISTED_AT  Describes an address associated with a business entity in Secretary of state records.  See ListedAtRelationData description for details. </span>|
|<span class="hljs-string"> ENTITY_OWNED_BY </span>|<span class="hljs-string"> 4 </span>|<span class="hljs-string"> Relation type: ENTITY_OWNED_BY  Indicates that an SOS_Owner has a stake in a SOS business entity (the target entity may be either a limited business (LP) or a corporation (Corp)).  See EntityOwnedByRelationData description for details. </span>|
|<span class="hljs-string"> OFFICER_FOR </span>|<span class="hljs-string"> 5 </span>|<span class="hljs-string"> Relation type: OFFICER_FOR  Indicates that one business entity is an officer for another business entity (which seems pretty weird).  See OfficerForRelationData description for details. </span>|
|<span class="hljs-string"> BE_LINKED_TO </span>|<span class="hljs-string"> 6 </span>|<span class="hljs-string"> Relation type: BE_LINKED_TO Connects a business node (SOS_Corp or SOS_LP) to a parcel-owner or attributed evictor (A_Parcel_Owner or RB_Evictor). The A_Parcel_Owner or RB_Evictor is considered to *be* the business. That is, this means we believe the business is the same entity as the reported owner or evictor. This is based on string matching the names of the recorded owner/attributed evictor with the names of businesses from california sec. of state business data. </span>|
|<span class="hljs-string"> PARC_OWNED_BY </span>|<span class="hljs-string"> 7 </span>|<span class="hljs-string"> Relation type: PARC_OWNED_BY  Describes a direct owner relationship between a parcel and an individual/entity that&amp;#39;s listed as an owner via assessor property tax records.  See ParcelOwnedByRelationData description for details. </span>|
|<span class="hljs-string"> UNIT_AT </span>|<span class="hljs-string"> 8 </span>|<span class="hljs-string"> Relation type: UNIT_AT  Indicates that an Address_Unit node correponds to the main parcel address at Address_Main.  See UnitAtRelationData description for details. </span>|
|<span class="hljs-string"> PARC_OWNER_ADDR_AT </span>|<span class="hljs-string"> 9 </span>|<span class="hljs-string"> Relation type: PARC_OWNER_ADDR_AT  Indicates that a parcel owner can be reached at this mailing address. TODO: Clarify, does this mean the address is listed as owner occupied? Or is this derived from some other signal?  See ParcelOwnerAtAddressRelationData description for details. </span>|





<span class="hljs-variable">&lt;a name=&quot;graph.RelationDetails&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### RelationDetails</span>
Represents a single relation (edge) in the graph.


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> type </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> string containing the type of the relation. </span>|
|<span class="hljs-string"> start_identity </span>|<span class="hljs-string"> [int64](#int64) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> internal neo4j id for the start node. </span>|
|<span class="hljs-string"> end_identity </span>|<span class="hljs-string"> [int64](#int64) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> internal neo4j id for the end node. </span>|
|<span class="hljs-string"> relation_type </span>|<span class="hljs-string"> [RelationType](#graph.RelationType) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> type, as an enum specific to eb graph semantics. the value names of this enum correspond to the string values used for &amp;#39;type&amp;#39;. </span>|
|<span class="hljs-string"> start_string_key </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> semantic unique key for start node. </span>|
|<span class="hljs-string"> end_string_key </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> semantic unique string key for end node (destination). </span>|
|<span class="hljs-string"> evicted_by_relation_data </span>|<span class="hljs-string"> [EvictedByRelationData](#graph.EvictedByRelationData) </span>|<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|
|<span class="hljs-string"> eviction_located_at_relation_data </span>|<span class="hljs-string"> [EvictionAtRelationData](#graph.EvictionAtRelationData) </span>|<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|
|<span class="hljs-string"> business_listed_at_relation_data </span>|<span class="hljs-string"> [ListedAtRelationData](#graph.ListedAtRelationData) </span>|<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|
|<span class="hljs-string"> business_entity_owned_by_relation_data </span>|<span class="hljs-string"> [EntityOwnedByRelationData](#graph.EntityOwnedByRelationData) </span>|<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|
|<span class="hljs-string"> business_officer_for_relation_data </span>|<span class="hljs-string"> [OfficerForRelationData](#graph.OfficerForRelationData) </span>|<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|
|<span class="hljs-string"> owner_or_evictor_linked_to_business_relation_data </span>|<span class="hljs-string"> [BELinkedToRelationData](#graph.BELinkedToRelationData) </span>|<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|
|<span class="hljs-string"> parcel_owned_by_relation_data </span>|<span class="hljs-string"> [ParcOwnedByRelationData](#graph.ParcOwnedByRelationData) </span>|<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|
|<span class="hljs-string"> unit_at_relation_data </span>|<span class="hljs-string"> [UnitAtRelationData](#graph.UnitAtRelationData) </span>|<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|
|<span class="hljs-string"> parcel_owner_at_address_relation_data </span>|<span class="hljs-string"> [ParcelOwnerAtAddressRelationData](#graph.ParcelOwnerAtAddressRelationData) </span>|<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|




<span class="hljs-variable">&lt;a name=&quot;graph.BELinkedToRelationData&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### BELinkedToRelationData</span>
Relation type: BE_LINKED_TO

Connects a business node (SOS_Corp or SOS_LP) to a parcel-owner or attributed evictor (A_Parcel_Owner or RB_Evictor).
The A_Parcel_Owner or RB_Evictor is considered to <span class="hljs-symbol">*</span>be<span class="hljs-symbol">*</span> the business. That is, this means we believe the business is the same entity as the reported owner or evictor. This is based on string matching the names of the recorded owner/attributed evictor with the names of businesses from california sec. of state business data.

Start node: RB_Evictor or A_Parcel_Owner node, identifying an agent believed to have instigated an eviction from SF Rent Board records, or a property-holding entity described in SF Assessor data.

End node: SOS_LP or SOS_Corp node representing a business entity in California Sec of State index, which is believed to be acting in the role of parcel owner or attributed evictor.





<span class="hljs-variable">&lt;a name=&quot;graph.EntityOwnedByRelationData&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### EntityOwnedByRelationData</span>
Relation type: ENTITY_OWNED_BY

Indicates that an SOS_Owner has a stake in a SOS business entity (the
target entity may be either a limited business (LP) or a corporation
(Corp)).

Start node: SOS_Corp or SOS_LP node, identified by its unique normalized
business name in the California Sec. of State business registry.

End node: SOS_Owner node, identified by the normalized name of that
owner in the California Sec. of State business registry.

NOTE: This collapsing of all identically-named owners in the business
registry is the likely the source of over-connections in our graph
methodology, and is on the list of items to revisit as we revise the
pipeline.

Empty as of 2020/12/29, as the relation carries no data payload other than
the fact of its own presence.






<span class="hljs-variable">&lt;a name=&quot;graph.EvictedByRelationData&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### EvictedByRelationData</span>
Relation type: EVICTED_BY

Represents a hypothesis attributing an individual for being responsible in
insigating an eviction.

Start node: RB_Eviction node describing SF Rent Board eviction record,
keyed by unique id. Note that evictorbook graph unique ID&amp;<span class="hljs-comment">#39;s for evictions</span>
may differ from id&amp;<span class="hljs-comment">#39;s in other databases because a one-character suffix is</span>
sometimes appended. TODO: Describe details.

End node: RB_Evictor node describing an individual believed to be
responsible for instigating the eviction.


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> multiple_sales_matches </span>|<span class="hljs-string"> [bool](#bool) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> todo clarify semantics. </span>|






<span class="hljs-variable">&lt;a name=&quot;graph.EvictionAtRelationData&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### EvictionAtRelationData</span>
Relation type: EVICTION_AT

Associates an SF Rent Board eviction record with the dwelling from which
one or more tenants were evicted.

Start node: RB_Eviction node describing SF Rent Board eviction record,
keyed by unique id. See caveat on eviction id&amp;<span class="hljs-comment">#39;s in comments for</span>
EvictedByRelationData, above.

End node: A_Parcel node, describing a parcel from SF Assessor
records, keyed by the parcel&amp;<span class="hljs-comment">#39;s unique &amp;#34;block lot&amp;#34;.</span>


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> multiple_addr_matches </span>|<span class="hljs-string"> [bool](#bool) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> todo clarify semantics. </span>|






<span class="hljs-variable">&lt;a name=&quot;graph.ListedAtRelationData&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### ListedAtRelationData</span>
Relation type: LISTED_AT

Describes an address associated with a business entity in Secretary of
state records.

TODO: Clarify the semantic meaning of this address; I believe it&amp;<span class="hljs-comment">#39;s a</span>
mailing address but need to confirm.

Start node: SOS_Corp or SOS_LP node, identified by its unique normalized
business name in the California Sec. of State business registry.

End node: Address_Unit describing a unit-level address at which
this business entity can be contacted.

Empty as of 2020/12/29, as the relation carries no data payload other than
the fact of its own presence.






<span class="hljs-variable">&lt;a name=&quot;graph.OfficerForRelationData&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### OfficerForRelationData</span>
Relation type: OFFICER_FOR

Indicates that one business entity is an officer for another business
entity (which seems pretty weird).

Start node: The &amp;<span class="hljs-comment">#39;serving&amp;#39; SOS_LP or SOS_Corp node, identified by its</span>
unique business name in the California Sec. of State business index.

End: The &amp;<span class="hljs-comment">#39;served at&amp;#39; SOS_LP or SOS_Corp node, identified by the</span>
same means as the start node.

Empty as of 2020/12/29, as the relation carries no data payload other than
the fact of its own presence.






<span class="hljs-variable">&lt;a name=&quot;graph.ParcOwnedByRelationData&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### ParcOwnedByRelationData</span>
Relation type: PARC_OWNED_BY

Describes a direct owner relationship between a parcel and an
individual/entity that&amp;<span class="hljs-comment">#39;s listed as an owner via assessor property tax</span>
records.

Start node: A_Parcel node from SF Assessor records, identified by &amp;<span class="hljs-comment">#39;block</span>
lot&amp;<span class="hljs-comment">#39;.</span>

End node: A_Parcel_Owner node from SF Assessor records, identified
by name directly in the documentation for the start node&amp;<span class="hljs-comment">#39;s real-estate</span>
parcel.


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> perc_owner </span>|<span class="hljs-string"> [int32](#int32) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Ownership percentage documented in SF Assessor records, expressed as an integer between 0 and 100, inclusive. </span>|
|<span class="hljs-string"> record_date </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Date in CCYYMMDD of the documents in SF Assessor records which demonstrate this ownership. </span>|






<span class="hljs-variable">&lt;a name=&quot;graph.ParcelOwnerAtAddressRelationData&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### ParcelOwnerAtAddressRelationData</span>
Relation type: PARC_OWNER_ADDR_AT

Indicates that a parcel owner can be reached at this mailing address.

TODO: Clarify whether this indicates the address was listed as
owner-occupied, as this may be relevant information.

Start node: A_Parcel_Owner node, describing a property owner identified by
name in SF Assessor records.

End node: Address_Unit node representing a resolved street address, with
unit number if applicable. SF Assessor records indicate that the owner can
be contacted by mail at this address.

Empty as of 2020/12/29, as the relation carries no data payload other than
the fact of its own presence.






<span class="hljs-variable">&lt;a name=&quot;graph.UnitAtRelationData&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### UnitAtRelationData</span>
Relation type: UNIT_AT

Indicates that an Address_Unit node correponds to the main parcel address
at Address_Main.

This edge exists even for addresses which contain only a single unit. The
reason is that &amp;<span class="hljs-comment">#39;Address_Main&amp;#39; nodes conceptually represent the entire set</span>
of possible units at that street address, whereas &amp;<span class="hljs-comment">#39;Address_Unit&amp;#39; nodes</span>
represent a resolved address that can actually be contacted. Single-unit
addresses are considered to be a special case where there happens to be a
one-to-one correspondence between the two.

Start node: Address_Unit node representing a definite, contactable address
complete with unit number. TODO: Describe formatting of that node&amp;<span class="hljs-comment">#39;s key.</span>

End node: Address_Main node, identified by an address with the unit
information scrubbed, which represents all potential units at that street
address. TODO: Describe formatting of that node&amp;<span class="hljs-comment">#39;s key.</span>

Empty as of 2020/12/29, as the relation carries no data payload other than
the fact of its own presence.





 


 

 

</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemaslegacymd-generatedquerydocs.md"><a href="#toc"><a name="server-schemas-legacy-md-generated-query-docs-md">server/schemas/legacy/md-generated/query/docs.md</a></a></h2>
<pre><code><span class="hljs-comment"># Evictorbook Query Abstraction Layer Documentation</span>
<span class="hljs-variable">&lt;a name=&quot;top&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### Note for readers</span>

The documentation featured below was originally written in a format called &#x27;proto&#x27;, and then converted to Markdown. proto is a schema definition language that&#x27;s intended to be both machine-readable and developer-readable. The motivation is to declare the machine-readable schema directly alongside human-readable comments, in the same file, so the canonical documentation always matches the schema enforced in code. The disadvantage is that .proto syntax requires some getting used to.

In order to produce a more user-friendly and widely readable documentation, we use an automated tool to convert the &#x27;proto&#x27; files into Markdown. The text descriptions here are imported directly from the comments in the &#x27;proto&#x27; files. This introduces some quirks in formatting (for example, multi-line comments are compressed into a single line in order to fit into the Markdown tables below). Let us know how we did; the Markdown formatting is a work in progress, so let us know if you have suggestions to improve this formatting or make it more readable.

That&#x27;s the disclaimer. Read on for the documentation.

<span class="hljs-comment">## Table of Contents</span>

- [query.proto](<span class="hljs-comment">#query.proto)</span>
    - [EvictorbookQueriesAsService](<span class="hljs-comment">#query.EvictorbookQueriesAsService)</span>

    - [BusinessEntityIndexRecord](<span class="hljs-comment">#query.BusinessEntityIndexRecord)</span>
    - [BusinessEntityIndexSearchParams](<span class="hljs-comment">#query.BusinessEntityIndexSearchParams)</span>
    - [BusinessEntityIndexSearchResult](<span class="hljs-comment">#query.BusinessEntityIndexSearchResult)</span>
    - [CalSOSCorporationQueryParams](<span class="hljs-comment">#query.CalSOSCorporationQueryParams)</span>
    - [CalSOSCorporationQueryResult](<span class="hljs-comment">#query.CalSOSCorporationQueryResult)</span>
    - [CalSOSLimitedBusinessQueryParams](<span class="hljs-comment">#query.CalSOSLimitedBusinessQueryParams)</span>
    - [CalSOSLimitedBusinessQueryResult](<span class="hljs-comment">#query.CalSOSLimitedBusinessQueryResult)</span>
    - [EvictionsByNeighborhoodQueryParams](<span class="hljs-comment">#query.EvictionsByNeighborhoodQueryParams)</span>
    - [EvictionsByNeighborhoodQueryResult](<span class="hljs-comment">#query.EvictionsByNeighborhoodQueryResult)</span>
    - [NetworkBusinessEntityQueryParams](<span class="hljs-comment">#query.NetworkBusinessEntityQueryParams)</span>
    - [NetworkBusinessEntityQueryResult](<span class="hljs-comment">#query.NetworkBusinessEntityQueryResult)</span>
    - [NetworkParcelQueryParams](<span class="hljs-comment">#query.NetworkParcelQueryParams)</span>
    - [NetworkParcelQueryResult](<span class="hljs-comment">#query.NetworkParcelQueryResult)</span>
    - [ParcelIndexRecord](<span class="hljs-comment">#query.ParcelIndexRecord)</span>
    - [ParcelIndexSearchParams](<span class="hljs-comment">#query.ParcelIndexSearchParams)</span>
    - [ParcelIndexSearchResult](<span class="hljs-comment">#query.ParcelIndexSearchResult)</span>
    - [SFParcelDetailsQueryParams](<span class="hljs-comment">#query.SFParcelDetailsQueryParams)</span>
    - [SFParcelDetailsQueryResult](<span class="hljs-comment">#query.SFParcelDetailsQueryResult)</span>
    - [SFParcelEvictionsQueryParams](<span class="hljs-comment">#query.SFParcelEvictionsQueryParams)</span>
    - [SFParcelEvictionsQueryResult](<span class="hljs-comment">#query.SFParcelEvictionsQueryResult)</span>
    - [SFParcelLegacyQueryParams](<span class="hljs-comment">#query.SFParcelLegacyQueryParams)</span>
    - [SFParcelLegacyQueryResult](<span class="hljs-comment">#query.SFParcelLegacyQueryResult)</span>
    - [SFParcelNetworksQueryParams](<span class="hljs-comment">#query.SFParcelNetworksQueryParams)</span>
    - [SFParcelNetworksQueryResult](<span class="hljs-comment">#query.SFParcelNetworksQueryResult)</span>
    - [SFParcelOwnersQueryParams](<span class="hljs-comment">#query.SFParcelOwnersQueryParams)</span>
    - [SFParcelOwnersQueryResult](<span class="hljs-comment">#query.SFParcelOwnersQueryResult)</span>
  
- [business.proto](<span class="hljs-comment">#business.proto)</span>
    - [CalSOSCorporationDetails](<span class="hljs-comment">#query.CalSOSCorporationDetails)</span>
    - [CalSOSLimitedBusinessDetails](<span class="hljs-comment">#query.CalSOSLimitedBusinessDetails)</span>
  
- [eviction.proto](<span class="hljs-comment">#eviction.proto)</span>
    - [SFRBEvictionMetadata](<span class="hljs-comment">#query.SFRBEvictionMetadata)</span>
  
- [graph_util.proto](<span class="hljs-comment">#graph_util.proto)</span>
    - [GraphNode](<span class="hljs-comment">#query.GraphNode)</span>
    - [GraphRelation](<span class="hljs-comment">#query.GraphRelation)</span>
  
- [network.proto](<span class="hljs-comment">#network.proto)</span>
    - [BusinessNetworkIdentifier](<span class="hljs-comment">#query.BusinessNetworkIdentifier)</span>
    - [NetworkLocationInfo](<span class="hljs-comment">#query.NetworkLocationInfo)</span>
  
- [parcel.proto](<span class="hljs-comment">#parcel.proto)</span>
    - [BusinessOwnedParcelInfo](<span class="hljs-comment">#query.BusinessOwnedParcelInfo)</span>
    - [NetworkedParcelInfo](<span class="hljs-comment">#query.NetworkedParcelInfo)</span>
    - [NetworkedParcelOwner](<span class="hljs-comment">#query.NetworkedParcelOwner)</span>
    - [SFAssessorParcelDetails](<span class="hljs-comment">#query.SFAssessorParcelDetails)</span>
    - [SFAssessorParcelOwner](<span class="hljs-comment">#query.SFAssessorParcelOwner)</span>
  
- [util.proto](<span class="hljs-comment">#util.proto)</span>
    - [NormalizedName](<span class="hljs-comment">#query.NormalizedName)</span>
    - [ReadableAddress](<span class="hljs-comment">#query.ReadableAddress)</span>
  
- [Scalar Value Types](<span class="hljs-comment">#scalar-value-types)</span>


<span class="hljs-variable">&lt;a name=&quot;query.proto&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>
<span class="hljs-variable">&lt;p align=&quot;right&quot;&gt;</span><span class="hljs-variable">&lt;a href=&quot;#top&quot;&gt;</span>Top<span class="hljs-variable">&lt;/a&gt;</span><span class="hljs-variable">&lt;/p&gt;</span>

<span class="hljs-comment">## query.proto</span>
query.proto

proto messages describing the neo4j CYPHER queries used at runtime by the
ebook node server. these definitions serve as a query abstraction layer.

this serves dual purposes:

first, they offer a clear reference point for developers seeking to
understand the runtime queries.

second, they offer a clear point of integration so the server&amp;<span class="hljs-comment">#39;s js business</span>
logic can be written and tested independently of the live database. see
usage in server/rest/routes/dbRouteListeners.js.

this strategy is effective for building resilience into systems that rely on
interpreted query languages.



<span class="hljs-variable">&lt;a name=&quot;query.EvictorbookQueriesAsService&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### EvictorbookQueriesAsService</span>
description of ebook&amp;<span class="hljs-comment">#39;s query abstraction layer.</span>

don&amp;<span class="hljs-comment">#39;t worry about the &amp;#39;service&amp;#39; and &amp;#39;rpc&amp;#39; syntax. all we&amp;#39;re doing here is</span>
conceptualizing the eb node server&amp;<span class="hljs-comment">#39;s query interface with the neo4j database.</span>

we won&amp;<span class="hljs-comment">#39;t actually be invoking these queries with the proto library&amp;#39;s &amp;#34;service&amp;#34; functionality, though if we wanted to, we could implement a wrapper to do just that. this is just a helpful framework for collecting together a list of &amp;#39;param&amp;#39; and &amp;#39;result&amp;#39; messages.</span>

this is also very useful for documenting REST apis, as we can apply the proto type definitions to type-checking the request and response payloads, whatever format they&amp;<span class="hljs-comment">#39;re written in (json, etc.).</span>

corp / lp / business queries:

|<span class="hljs-string"> Method Name </span>|<span class="hljs-string"> Request Type </span>|<span class="hljs-string"> Response Type </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----------- </span>|<span class="hljs-string"> ------------ </span>|<span class="hljs-string"> ------------- </span>|<span class="hljs-string"> ------------</span>|
|<span class="hljs-string"> CalSOSCorporationQuery </span>|<span class="hljs-string"> [CalSOSCorporationQueryParams](#query.CalSOSCorporationQueryParams) </span>|<span class="hljs-string"> [CalSOSCorporationQueryResult](#query.CalSOSCorporationQueryResult) </span>|<span class="hljs-string"> query corporation info by normalized business name. </span>|
|<span class="hljs-string"> CalSOSLimitedBusinessQuery </span>|<span class="hljs-string"> [CalSOSLimitedBusinessQueryParams](#query.CalSOSLimitedBusinessQueryParams) </span>|<span class="hljs-string"> [CalSOSLimitedBusinessQueryResult](#query.CalSOSLimitedBusinessQueryResult) </span>|<span class="hljs-string"> query limited partnership / llc info by normalized business name.  TODO: combine this with the &amp;#39;corporation&amp;#39; query to make a single query which could handle both cases. alternatively, it may be simpler to implement that at the web service level in the node runtime. </span>|
|<span class="hljs-string"> EvictionsByNeighborhoodQuery </span>|<span class="hljs-string"> [EvictionsByNeighborhoodQueryParams](#query.EvictionsByNeighborhoodQueryParams) </span>|<span class="hljs-string"> [EvictionsByNeighborhoodQueryResult](#query.EvictionsByNeighborhoodQueryResult) </span>|<span class="hljs-string"> query details for individual evictions, filtered by neighborhood.  TODO: extend or replace with a query that allows for other filters. </span>|
|<span class="hljs-string"> SFParcelLegacyQuery </span>|<span class="hljs-string"> [SFParcelLegacyQueryParams](#query.SFParcelLegacyQueryParams) </span>|<span class="hljs-string"> [SFParcelLegacyQueryResult](#query.SFParcelLegacyQueryResult) </span>|<span class="hljs-string"> DEPRECATED. prefer more specific parcel queries below.  get details about a parcel from sf assessor records, keyed by the parcel&amp;#39;s block lot identifier, as well as info about evictions at the property, suspected owners, etc.  rest api route: &amp;#39;api/parcel/&amp;lt;BLOCK_LOT&amp;gt;&amp;#39; query js: server/rest/handlers/parcel/legacy.js </span>|
|<span class="hljs-string"> SFParcelDetailsQuery </span>|<span class="hljs-string"> [SFParcelDetailsQueryParams](#query.SFParcelDetailsQueryParams) </span>|<span class="hljs-string"> [SFParcelDetailsQueryResult](#query.SFParcelDetailsQueryResult) </span>|<span class="hljs-string"> get details about a parcel from sf assessor records, keyed by block_lot.  rest api route: &amp;#39;api/parcel/&amp;lt;BLOCK_LOT&amp;gt;/details&amp;#39; query js: server/rest/handlers/parcel/details.js </span>|
|<span class="hljs-string"> SFParcelEvictionsQuery </span>|<span class="hljs-string"> [SFParcelEvictionsQueryParams](#query.SFParcelEvictionsQueryParams) </span>|<span class="hljs-string"> [SFParcelEvictionsQueryResult](#query.SFParcelEvictionsQueryResult) </span>|<span class="hljs-string"> get details about evictions which occurred at a given parcel, keyed by block_lot.  rest api route: &amp;#39;api/parcel/&amp;lt;BLOCK_LOT&amp;gt;/evictions&amp;#39; query js: server/rest/handlers/parcel/evictions.js </span>|
|<span class="hljs-string"> SFParcelOwnersQuery </span>|<span class="hljs-string"> [SFParcelOwnersQueryParams](#query.SFParcelOwnersQueryParams) </span>|<span class="hljs-string"> [SFParcelOwnersQueryResult](#query.SFParcelOwnersQueryResult) </span>|<span class="hljs-string"> get info about individuals, businesses, and/or trusts believed to own the parcel in full or in part.  rest api route: &amp;#39;api/parcel/&amp;lt;BLOCK_LOT&amp;gt;/owners&amp;#39; query js: server/rest/handlers/parcel/owners.js </span>|
|<span class="hljs-string"> SFParcelNetworksQuery </span>|<span class="hljs-string"> [SFParcelNetworksQueryParams](#query.SFParcelNetworksQueryParams) </span>|<span class="hljs-string"> [SFParcelNetworksQueryResult](#query.SFParcelNetworksQueryResult) </span>|<span class="hljs-string"> get info about real-estate business networks believed to have a stake in this parcel, as well as other parcels which those networks may have a vested interest in.  NOTE: performance bottleneck, invoke with caution.  rest api route: &amp;#39;api/parcel/&amp;lt;BLOCK_LOT&amp;gt;/networks&amp;#39; query js: server/rest/handlers/parcel/networks.js </span>|
|<span class="hljs-string"> NetworkBusinessEntityQuery </span>|<span class="hljs-string"> [NetworkBusinessEntityQueryParams](#query.NetworkBusinessEntityQueryParams) </span>|<span class="hljs-string"> [NetworkBusinessEntityQueryResult](#query.NetworkBusinessEntityQueryResult) </span>|<span class="hljs-string"> given a network_id and a business entity which belongs to that network, return a local view of the network centered around that business. </span>|
|<span class="hljs-string"> NetworkParcelQuery </span>|<span class="hljs-string"> [NetworkParcelQueryParams](#query.NetworkParcelQueryParams) </span>|<span class="hljs-string"> [NetworkParcelQueryResult](#query.NetworkParcelQueryResult) </span>|<span class="hljs-string"> given a network_id and a parcel block_lot which is under that network&amp;#39;s influence, return a view of the network centered around that parcel. </span>|
|<span class="hljs-string"> BusinessEntityIndexSearch </span>|<span class="hljs-string"> [BusinessEntityIndexSearchParams](#query.BusinessEntityIndexSearchParams) </span>|<span class="hljs-string"> [BusinessEntityIndexSearchResult](#query.BusinessEntityIndexSearchResult) </span>|<span class="hljs-string"> used for search feature on front page. performs prefix-based index lookup on business entities (both &amp;#39;corp&amp;#39; and &amp;#39;lp&amp;#39;) by normalized name.  TODO: extend or replace with more robust/flexible search algorithm. </span>|
|<span class="hljs-string"> ParcelIndexSearch </span>|<span class="hljs-string"> [ParcelIndexSearchParams](#query.ParcelIndexSearchParams) </span>|<span class="hljs-string"> [ParcelIndexSearchResult](#query.ParcelIndexSearchResult) </span>|<span class="hljs-string"> used for search feature on front page. performs prefix-based lookup on sf assessor parcel records on lot-level address strings.  TODO: extend or replace with more robust/flexible search algorithm. </span>|

<span class="hljs-variable">&lt;a name=&quot;query.BusinessEntityIndexRecord&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### BusinessEntityIndexRecord</span>
a single business entity search result.


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> \_\_typename </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> the type name of the ebook graph node representing this business, &amp;#34;SOS_Corp&amp;#34; or &amp;#34;SOS_LP&amp;#34;.  included explicitly, so that the calling code can distinguish between corporation and limited-business nodes. </span>|
|<span class="hljs-string"> name_norm </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> the business entity&amp;#39;s name, after normalization. this name can be used as a query parameter for retrieving information about a corporation or limited-business.  todo: document the normalization scheme. </span>|






<span class="hljs-variable">&lt;a name=&quot;query.BusinessEntityIndexSearchParams&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### BusinessEntityIndexSearchParams</span>
business entity search. queries are interpreted as a prefix-tree search on
the normalized set of business entity names.


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> query </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|






<span class="hljs-variable">&lt;a name=&quot;query.BusinessEntityIndexSearchResult&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### BusinessEntityIndexSearchResult</span>
aggregation of matching search records. this would be a good place to add
pagination tokens or other metadata about the results.


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> records </span>|<span class="hljs-string"> list&lt; [BusinessEntityIndexRecord](#query.BusinessEntityIndexRecord) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> list of individual matching records. </span>|






<span class="hljs-variable">&lt;a name=&quot;query.CalSOSCorporationQueryParams&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### CalSOSCorporationQueryParams</span>
parameters for cal sos corporation query.


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> search_string </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> normalized name of the business, derived from the name found in california sec. of state business records. must be an exact string match. </span>|






<span class="hljs-variable">&lt;a name=&quot;query.CalSOSCorporationQueryResult&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### CalSOSCorporationQueryResult</span>
query result:


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> be_details </span>|<span class="hljs-string"> [CalSOSCorporationDetails](#query.CalSOSCorporationDetails) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> details about the business (founding date, filing number, mailing address, officers, etc.) </span>|
|<span class="hljs-string"> parcels_owned </span>|<span class="hljs-string"> list&lt; [BusinessOwnedParcelInfo](#query.BusinessOwnedParcelInfo) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> details about parcels which are directly owned by this business. </span>|
|<span class="hljs-string"> evictions </span>|<span class="hljs-string"> list&lt; [SFRBEvictionMetadata](#query.SFRBEvictionMetadata) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> evictions via sf rent board that may have been instigated by this business (alone or w/ other agents). includes id numbers for further lookup.  ellis act withdrawal evictions include names of plaintiffs. </span>|
|<span class="hljs-string"> network_parcels </span>|<span class="hljs-string"> list&lt; [NetworkedParcelInfo](#query.NetworkedParcelInfo) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> parcels which this corporation may have a financial interest in, via business connections. corporate networks are inferred by ebook graph analysis. </span>|






<span class="hljs-variable">&lt;a name=&quot;query.CalSOSLimitedBusinessQueryParams&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### CalSOSLimitedBusinessQueryParams</span>
Corresponds to the query defined in server/rest/handlers/lp.js

given the normalized name of a limited business (limited partnership or
limited liability corporation) from calif sec. of state business registry,
get detailed info about that business and its observed real-estate
holdings in sf.


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> search_string </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Normalized name of the business, derived from the name found in California Sec. of State business records. </span>|






<span class="hljs-variable">&lt;a name=&quot;query.CalSOSLimitedBusinessQueryResult&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### CalSOSLimitedBusinessQueryResult</span>
Query result:


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> be_details </span>|<span class="hljs-string"> [CalSOSLimitedBusinessDetails](#query.CalSOSLimitedBusinessDetails) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Details about the limited partnership or llc in question. </span>|
|<span class="hljs-string"> parcels_owned </span>|<span class="hljs-string"> list&lt; [BusinessOwnedParcelInfo](#query.BusinessOwnedParcelInfo) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Details about parcels which are directly owned by this business entity. </span>|
|<span class="hljs-string"> evictions </span>|<span class="hljs-string"> list&lt; [SFRBEvictionMetadata](#query.SFRBEvictionMetadata) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Brief description of evictions from the SF Rent Board which this business entity may have instigated (alone or with other agents). Includes id numbers for further lookup, and in the case of an Ellis Act Withdrawal includes the names of the plaintiff(s). </span>|
|<span class="hljs-string"> network_parcels </span>|<span class="hljs-string"> list&lt; [NetworkedParcelInfo](#query.NetworkedParcelInfo) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> Descriptions of parcels which, though not directly owned by this business entity, may be owned by another entity that it&amp;#39;s related to through a real-estate holding network. The networks are identified by the evictorbook pipeline via connected component analysis. </span>|






<span class="hljs-variable">&lt;a name=&quot;query.EvictionsByNeighborhoodQueryParams&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### EvictionsByNeighborhoodQueryParams</span>
corresponds to query in server/rest/handlers/neighborhood.js

given the name of a neighborhood in san francisco, retrieves detailed
information about all the evictions from evictorbook datastore which occured
within that neighborhood&amp;<span class="hljs-comment">#39;s boundaries.</span>

TODO: explore alternate pagination api&amp;<span class="hljs-comment">#39;s (continuation token?)</span>

query parameters:


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> neighborhood </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> neighorhood name. must be exact match. </span>|
|<span class="hljs-string"> page </span>|<span class="hljs-string"> [int32](#int32) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> pagination. if set nonzero, show the nth page of results. if zero or unset, query will return the first page. </span>|
|<span class="hljs-string"> size </span>|<span class="hljs-string"> [int32](#int32) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> pagination. if set nonzero, result pages are have this many entries. must be set &amp;gt;= 1 if pages is set. </span>|






<span class="hljs-variable">&lt;a name=&quot;query.EvictionsByNeighborhoodQueryResult&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### EvictionsByNeighborhoodQueryResult</span>
query result:


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> evictions </span>|<span class="hljs-string"> list&lt; [SFRBEvictionMetadata](#query.SFRBEvictionMetadata) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> details about evictions which occurred on a property in this neighborhood. includes info derived during ebook data analysis, plus info about the parcel where the eviction occurred. </span>|






<span class="hljs-variable">&lt;a name=&quot;query.NetworkBusinessEntityQueryParams&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### NetworkBusinessEntityQueryParams</span>
params in server/rest/handlers/network.js &amp;<span class="hljs-comment">#39;business&amp;#39; query.</span>


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> be_name </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> normalized name of the business, derived from the name found in california sec. of state business records. </span>|
|<span class="hljs-string"> input_type </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> &amp;#34;corp&amp;#34; or &amp;#34;lp&amp;#34;, depending on whether the business is a corporation or limited-partnership/llc. </span>|






<span class="hljs-variable">&lt;a name=&quot;query.NetworkBusinessEntityQueryResult&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### NetworkBusinessEntityQueryResult</span>
result of server/rest/handlers/network.js &amp;<span class="hljs-comment">#39;business&amp;#39; query.</span>


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> name_norm </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> normalized name of the business, matching be_name parameter from input. </span>|
|<span class="hljs-string"> network_subgraph </span>|<span class="hljs-string"> list&lt; [GraphRelation](#query.GraphRelation) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> list of graph relations (edges) which make up a connected subgraph of the ebook graph, representing the business network and its elements.  each item here contains full descriptions of the relation&amp;#39;s source and destination node, so the caller can reconstruct the subgraph.  COMPATIBILITY NOTE: this proto message differs from neo4j driver object schemas, so conversion is required. see comments on GraphRelation definition. </span>|
|<span class="hljs-string"> total_bes </span>|<span class="hljs-string"> [int32](#int32) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> total count of business entities which appear in this network (including both corporations and limited-partnerships/llc&amp;#39;s). </span>|
|<span class="hljs-string"> top_bes </span>|<span class="hljs-string"> list&lt; [NormalizedName](#query.NormalizedName) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> normalized names of most-connected business in the network. (SOS_Corp or SOS_LP nodes with highest degree).  optional field \_\_typename is set, so caller can disambiguate between business types. returns 5 entries as of 2021/03/12. </span>|
|<span class="hljs-string"> top_owners </span>|<span class="hljs-string"> list&lt; [NormalizedName](#query.NormalizedName) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> normalized names of owners-of-businesses most connected in the graph (SOS_Owner nodes with matching network_id, with highest degree). these owners can be individuals, or other businesses. returns 5 entries as of 2021/03/12. optional field &amp;#39;\_\_typename&amp;#39; is NOT set.  see SOS_Owner node / CalSOSOwnerData in graph/nodes.proto. </span>|
|<span class="hljs-string"> top_addrs </span>|<span class="hljs-string"> list&lt; [ReadableAddress](#query.ReadableAddress) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> readable addresses which are the most well-connected in the graph. (Address_Unit nodes with matching network_id with highest degree). returns 5 entries as of 2021/03/12.  TODO: describe what causes these addresses to be considered for inclusion. clarify if they&amp;#39;re physical addresses of component businesses/owners of the network, or real-estate properties held by the network. see Address_Unit node / AddressUnitData in graph/nodes.proto. </span>|






<span class="hljs-variable">&lt;a name=&quot;query.NetworkParcelQueryParams&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### NetworkParcelQueryParams</span>
params in server/rest/handlers/network.js &amp;<span class="hljs-comment">#39;parcel&amp;#39; query.</span>


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> block_lot </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> the block_lot of a parcel, which uniquely identifies it in the ebook graph and in sf assessor records. required. </span>|






<span class="hljs-variable">&lt;a name=&quot;query.NetworkParcelQueryResult&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### NetworkParcelQueryResult</span>
result of server/rest/handlers/network.js &amp;<span class="hljs-comment">#39;parcel&amp;#39; query.</span>


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> addr </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> string representing the parcel&amp;#39;s street address, including street number, street name and suffix, and unit number. The parcel is assumed to be within SF city/county limits.  See &amp;#39;addr&amp;#39; in A_Parcel node as described by SFAssessorParcelData in graph/nodes.proto. </span>|
|<span class="hljs-string"> network_subgraph </span>|<span class="hljs-string"> list&lt; [GraphRelation](#query.GraphRelation) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> list of graph relations (edges) which make up a connected subgraph of the ebook graph, representing the business network and its elements.  each item here contains full descriptions of the relation&amp;#39;s source and destination node, so the caller can reconstruct the subgraph.  COMPATIBILITY NOTE: this proto message differs from neo4j driver object schemas, so conversion is required. see comments on GraphRelation definition. </span>|
|<span class="hljs-string"> total_bes </span>|<span class="hljs-string"> [int32](#int32) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> total count of business entities which appear in this network (including both corporations and limited-partnerships/llc&amp;#39;s). </span>|
|<span class="hljs-string"> top_bes </span>|<span class="hljs-string"> list&lt; [NormalizedName](#query.NormalizedName) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> see comment in NetworkBusinessEntityQueryResult above. </span>|
|<span class="hljs-string"> top_owners </span>|<span class="hljs-string"> list&lt; [NormalizedName](#query.NormalizedName) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> see comment in NetworkBusinessEntityQueryResult above. </span>|
|<span class="hljs-string"> top_addrs </span>|<span class="hljs-string"> list&lt; [ReadableAddress](#query.ReadableAddress) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> see comment in NetworkBusinessEntityQueryResult above. </span>|






<span class="hljs-variable">&lt;a name=&quot;query.ParcelIndexRecord&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### ParcelIndexRecord</span>
an individual parcel search result.


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> addr </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> the street address component of this parcel&amp;#39;s physical address.  todo: clarify whether this is lot-level address or unit-level. </span>|
|<span class="hljs-string"> block_lot </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> the parcel&amp;#39;s block lot number, which uniquely identifies a parcel in the sf assessor&amp;#39;s data. </span>|






<span class="hljs-variable">&lt;a name=&quot;query.ParcelIndexSearchParams&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### ParcelIndexSearchParams</span>
parcel search. query is implemented as a prefix-tree search on the parcels&amp;<span class="hljs-comment">#39;</span>
lot-level address strings.


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> query </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> prefix string for an sf assessor parcel&amp;#39;s lot-level address, as it appears in normalized form in the ebook dataset.

todo: clarify formatting and the role of unit number. </span>|






<span class="hljs-variable">&lt;a name=&quot;query.ParcelIndexSearchResult&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### ParcelIndexSearchResult</span>
aggregation of parcel search results.


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> records </span>|<span class="hljs-string"> list&lt; [ParcelIndexRecord](#query.ParcelIndexRecord) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> list of individual matching records. </span>|






<span class="hljs-variable">&lt;a name=&quot;query.SFParcelDetailsQueryParams&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### SFParcelDetailsQueryParams</span>
params in server/rest/handlers/parcel/details.js


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> search_string </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> block lot identifier of a parcel, as is appears in sf assessor records. exact string match only. </span>|






<span class="hljs-variable">&lt;a name=&quot;query.SFParcelDetailsQueryResult&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### SFParcelDetailsQueryResult</span>
result in server/rest/handlers/parcel/details.js


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> parcel_details </span>|<span class="hljs-string"> [SFAssessorParcelDetails](#query.SFAssessorParcelDetails) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> detailed info about the parcel (location, physical properties, etc.). </span>|






<span class="hljs-variable">&lt;a name=&quot;query.SFParcelEvictionsQueryParams&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### SFParcelEvictionsQueryParams</span>
params in server/rest/handlers/parcel/evictions.js


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> search_string </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> block lot identifier of a parcel, as is appears in sf assessor records. exact string match only. </span>|






<span class="hljs-variable">&lt;a name=&quot;query.SFParcelEvictionsQueryResult&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### SFParcelEvictionsQueryResult</span>
result in server/rest/handlers/parcel/evictions.js


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> evictions </span>|<span class="hljs-string"> list&lt; [SFRBEvictionMetadata](#query.SFRBEvictionMetadata) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> info about evictions believed to have occurred on the propert(y/ies) on this parcel. </span>|






<span class="hljs-variable">&lt;a name=&quot;query.SFParcelLegacyQueryParams&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### SFParcelLegacyQueryParams</span>
query params in server/rest/handlers/parcel/legacy.js


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> search_string </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> block lot identifier of a parcel, as is appears in sf assessor records. exact string match only. </span>|






<span class="hljs-variable">&lt;a name=&quot;query.SFParcelLegacyQueryResult&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### SFParcelLegacyQueryResult</span>
result in server/rest/handlers/parcel/legacy.js


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> parcel_details </span>|<span class="hljs-string"> [SFAssessorParcelDetails](#query.SFAssessorParcelDetails) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> detailed info about the parcel (location, physical properties, etc.). </span>|
|<span class="hljs-string"> owners </span>|<span class="hljs-string"> list&lt; [SFAssessorParcelOwner](#query.SFAssessorParcelOwner) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> individuals, businesses, trusts, etc., which are believed to own the parcel in full or in part. </span>|
|<span class="hljs-string"> evictions </span>|<span class="hljs-string"> list&lt; [SFRBEvictionMetadata](#query.SFRBEvictionMetadata) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> info about evictions believed to have occurred on the propert(y/ies) on this parcel. </span>|
|<span class="hljs-string"> network_parcels </span>|<span class="hljs-string"> list&lt; [NetworkedParcelInfo](#query.NetworkedParcelInfo) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> brief decsriptions of parcels which may be related through business relations among parcel owners. </span>|
|<span class="hljs-string"> possible_networks </span>|<span class="hljs-string"> list&lt; [NetworkLocationInfo](#query.NetworkLocationInfo) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> identifiers for real-estate business networks which the parcel may be associated with. </span>|






<span class="hljs-variable">&lt;a name=&quot;query.SFParcelNetworksQueryParams&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### SFParcelNetworksQueryParams</span>
params in server/rest/handlers/parcel/networks.js


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> search_string </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> block lot identifier of a parcel, as is appears in sf assessor records. exact string match only. </span>|






<span class="hljs-variable">&lt;a name=&quot;query.SFParcelNetworksQueryResult&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### SFParcelNetworksQueryResult</span>
result in server/rest/handlers/parcel/networks.js


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> owners </span>|<span class="hljs-string"> list&lt; [SFAssessorParcelOwner](#query.SFAssessorParcelOwner) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> individuals or businesses believed to own the parcel, in full or in part.

owner info is required for interpreting best network_id&amp;#39;s downstream. </span>|
|<span class="hljs-string"> network_parcels </span>|<span class="hljs-string"> list&lt; [NetworkedParcelInfo](#query.NetworkedParcelInfo) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> brief decsriptions of parcels which may be related through business relations among parcel owners. </span>|
|<span class="hljs-string"> possible_networks </span>|<span class="hljs-string"> list&lt; [NetworkLocationInfo](#query.NetworkLocationInfo) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> identifiers for real-estate business networks which the parcel may be associated with. </span>|






<span class="hljs-variable">&lt;a name=&quot;query.SFParcelOwnersQueryParams&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### SFParcelOwnersQueryParams</span>
params in server/rest/handlers/parcel/owners.js


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> search_string </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> block lot identifier of a parcel, as is appears in sf assessor records. exact string match only. </span>|






<span class="hljs-variable">&lt;a name=&quot;query.SFParcelOwnersQueryResult&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### SFParcelOwnersQueryResult</span>
result in server/rest/handlers/parcel/owners.js


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> owners </span>|<span class="hljs-string"> list&lt; [SFAssessorParcelOwner](#query.SFAssessorParcelOwner) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> individuals or businesses believed to own the parcel, in full or in part. </span>|
|<span class="hljs-string"> parcels </span>|<span class="hljs-string"> [int32](#int32) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> total number of parcels believed to be owned by all the full and part owners of the queried parcel. </span>|





 

 

<span class="hljs-variable">&lt;a name=&quot;business.proto&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>
<span class="hljs-variable">&lt;p align=&quot;right&quot;&gt;</span><span class="hljs-variable">&lt;a href=&quot;#top&quot;&gt;</span>Top<span class="hljs-variable">&lt;/a&gt;</span><span class="hljs-variable">&lt;/p&gt;</span>

<span class="hljs-comment">## business.proto</span>
query/business.proto

contains messages related to corporations and other businesses from the
calif sec. of state business registry, as they appear in ebook&amp;<span class="hljs-comment">#39;s query</span>
abstraction layer.


<span class="hljs-variable">&lt;a name=&quot;query.CalSOSCorporationDetails&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### CalSOSCorporationDetails</span>
fields in this message correspond to fields of the same name in SOS_Corp
vertices in the neo4j schema. proto messages describing that schema are
found in the graph/ directory.

as of 2020/09/26, this is a direct clone of the graph node schema, with one
exception: this message is missing the normalized corporation name
&amp;<span class="hljs-comment">#39;name_norm&amp;#39;, which serves as a unique key. although the two are currently</span>
very similar, we prefer to define two separate messages to allow for the
schema and the query abstraction to evolve independently.


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> transaction_date </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> transaction date of the document which established this corporation, according to the california secretary of state business registry.  format: &amp;#39;CCMMYYDD&amp;#39;. </span>|
|<span class="hljs-string"> corporation_number </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> an 8 digit corporate identification number, from the california secretary of state business registry. </span>|
|<span class="hljs-string"> incorporation_date </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> date on which this corporation was incorporated, according to the california secretary of state business registry. format: &amp;#39;CCYYMMDD&amp;#39; </span>|
|<span class="hljs-string"> corporation_status </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> status of the corporation, as a string containing a code from calif. sec. of state business entity records. The values are described as follows in the database schema documentation:  1 = Active 2 = Suspended 3 = Canceled 4 = Surrendered 5 = Term expired 6 = Dissolved 7 = Forfeited 8 = Deleted 9 = Inactive C = Merged Out E = State to Federal Bank Conversion F = Conditionally dissolved (No tax clearance) Not sure about code = Converted Out </span>|
|<span class="hljs-string"> corporation_type </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> description of the legal process used to establish this corporation, according to Calif. Sec. of state records. The allowed values and their meanings are listed below.  ARTS = Articles of Incorporation S&amp;amp;DC = Statement &amp;amp; Designation By Foreign Corporation S&amp;amp;DA = Statement &amp;amp; Designation By Foreign Association FNRE = Foreign Name Registration </span>|
|<span class="hljs-string"> corporation_tax_base </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> description of the tax-base of the corporation, according to calif. sec. of state records. this indicates whether a corporation is for-profit or non-profit.  S = Stock N = Non-Stock (Nonprofit) </span>|
|<span class="hljs-string"> corporation_classification </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> additional corporate classifications which may convey special status, such as &amp;#39;religious&amp;#39; or &amp;#39;agricultural cooperative&amp;#39; according to calif. sec. of state business entity records.  G = Agricultural Cooperative CR = Credit Union MU = Mutual Benefit OC = Other Cooperative PB = Public Benefit RE = Religious SL = Corporation Sole UN = Unclassified </span>|
|<span class="hljs-string"> term_expiration_date </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> limited term expiration date. TODO: describe what this means. format: &amp;#39;CCYYMMDD&amp;#39; </span>|
|<span class="hljs-string"> ftb_suspension_status </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> describes whether this corporation is in good standing with the california franchise tax board (ftb).  ‘ ‘ (Blank) = Not Suspended (In Good Standing) F = Forfeited S = Suspended </span>|
|<span class="hljs-string"> ftb_suspension_date </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> if this corporation has been subject to action by the franchise tax board as described in &amp;#39;ftb_suspension_status&amp;#39;, then this field contains a string representation of the date of that action.  format: &amp;#39;CCYYMMDD&amp;#39; </span>|
|<span class="hljs-string"> so_file_number </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> statement of information file number, per calif sec of state records. </span>|
|<span class="hljs-string"> so_file_date </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> last complete statement (of information?) file date. format: &amp;#39;CCYYMMDD&amp;#39; </span>|
|<span class="hljs-string"> corporation_name </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> name of corporation, directly from calif. sec. of state records without normalization. </span>|
|<span class="hljs-string"> co_name </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> &amp;#39;care of&amp;#39; name, meaning the &amp;#39;c/o&amp;#39; addressee which should be included on mail intended for the corporation. </span>|
|<span class="hljs-string"> agent_name </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> name of agent of process, as it appears on mailing address. </span>|
|<span class="hljs-string"> agent_address_line_1 </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> mailing address for agent of process, line 1. </span>|
|<span class="hljs-string"> agent_address_line_2 </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> mailing address for agent of process, line 2. </span>|
|<span class="hljs-string"> agent_address_city </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> city component of agent of process&amp;#39;s mailing address. </span>|
|<span class="hljs-string"> agent_address_state_county </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> todo: clarify what this means. is it state or county? or both???? </span>|
|<span class="hljs-string"> agent_address_zip_code </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> todo: clarify whether these are 5-digit or 9-digit postal codes. </span>|
|<span class="hljs-string"> state_or_foreign_country </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> if the corporation is not &amp;#39;domestic&amp;#39; (internal to calif.), then this field specified a u.s. state other than california, or a country outside the u.s., where this corporation originated. </span>|
|<span class="hljs-string"> c_id </span>|<span class="hljs-string"> [int64](#int64) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> business entity component id, generated by the evictorbook data pipeline via connected component analysis.  See comments inline in BusinessNetworkIdentifier from network.proto for a detailed explanation. </span>|
|<span class="hljs-string"> network_id </span>|<span class="hljs-string"> [int64](#int64) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> parcel ownership network component id, generated by the evictorbook data pipeline via connected component analysis.  SOS_Corp, SOS_LP, and SOS_Owner vertices are required to have a network_id, and Address_Unit vertices may optionally have a network_id.   See comments inline in BusinessNetworkIdentifier from network.proto for a detailed explanation. </span>|






<span class="hljs-variable">&lt;a name=&quot;query.CalSOSLimitedBusinessDetails&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### CalSOSLimitedBusinessDetails</span>
closely follows CalSOSLimitedBusinessData in the graph proto defintion.
we define a message here, to allow for the graph schema and the query
abstraction to evolve separately.


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> jurisdiction_llc </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> llc only: state or county for formation of foreign llc.  TODO: confirm/deny that this is unset for messages representing limited partnerships. </span>|
|<span class="hljs-string"> llc_management_code </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> llc only: management structure.  1 = One Manager M = More Than One Manager A = All Members are Managers  todo: confirm/deny that this is unset for messages representing limited partnerships. </span>|
|<span class="hljs-string"> llc_type_of_business </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> llc only: type of business. todo: provide examples. todo: confirm/deny that this is unset for messages representing limited partnerships. </span>|
|<span class="hljs-string"> file_number </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> the filing number of the business entity, which is derived from the date on which its filing paperwork was filed. the number is presented as a string, with the format described below:  format: &amp;#39;CCYYJJJN9999&amp;#39; CCYY = century and year JJJ = julian day of year N = record type: 0 = lp record 1 = llc record 9999 = sequence number </span>|
|<span class="hljs-string"> file_date </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> date of original filing for this business. represents the same calendar date as the date component of file_number, but follows a different format. format: &amp;#39;CCYYMMDD&amp;#39; </span>|
|<span class="hljs-string"> status </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> identifies current status of lp/llc, as represented in calif. sec. of state business entity records.   A : active B : dishonored check C : canceled D : dissolved P : pending cancellation F : franchise tax board (ftb) suspended/forfeited M : merged out O : converted out S : secretary of state (sos) suspended/forfeited 2 : sos/ftb suspended/forfeited </span>|
|<span class="hljs-string"> filing_type </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> filing type (foreign or domestic) of this lp or llc, as represented in calif. sec. of state business entity registry.   todo: clarify behavior for partnerships that originate from other u.s. states. todo: clarify the precise values that can be returned by the database. </span>|
|<span class="hljs-string"> name </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> the raw, non-normalized name of this calif. limited partnership or llc, as represented in calif. sec. of state business entity registry. </span>|
|<span class="hljs-string"> jurisdiction </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> state or country of formation for foreign limited partnerships. </span>|
|<span class="hljs-string"> agent_name </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> name of agent of process, as it appears on mailing address. </span>|
|<span class="hljs-string"> agent_address_1 </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> mailing address for agent of process, line 1.  CAUTION: naming convention differs from similar field in corp details. </span>|
|<span class="hljs-string"> agent_address_2 </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> mailing address for agent of process, line 2.  CAUTION: naming convention differs from similar field in corp details. </span>|
|<span class="hljs-string"> agent_city </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> city component of agent of process&amp;#39;s mailing address.  CAUTION: naming convention differs from similar field in corp details. </span>|
|<span class="hljs-string"> agent_state </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> component of agent of process&amp;#39;s mailing address.  CAUTION: naming convention differs from similar field in corp details. </span>|
|<span class="hljs-string"> agent_zip </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> todo: clarify whether these are 5-digit or 9-digit postal codes.  CAUTION: naming convention differs from similar field in corp details. </span>|
|<span class="hljs-string"> term </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> cause of termination, if this lp/llc has been terminated. todo: add examples. </span>|
|<span class="hljs-string"> c_id </span>|<span class="hljs-string"> [int64](#int64) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> business entity component id, generated by the evictorbook data pipeline via connected component analysis.  see comments inline in BusinessNetworkIdentifier from network.proto for a detailed explanation. </span>|
|<span class="hljs-string"> network_id </span>|<span class="hljs-string"> [int64](#int64) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> parcel ownership network component id, generated by the evictorbook data pipeline via connected component analysis.  SOS_Corp, SOS_LP, and SOS_Owner nodes are required to have a network_id, and Address_Unit nodes may optionally have a network_id. 

see comments inline in BusinessNetworkIdentifier from network.proto for a detailed explanation. </span>|





 

 

 

 



<span class="hljs-variable">&lt;a name=&quot;eviction.proto&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>
<span class="hljs-variable">&lt;p align=&quot;right&quot;&gt;</span><span class="hljs-variable">&lt;a href=&quot;#top&quot;&gt;</span>Top<span class="hljs-variable">&lt;/a&gt;</span><span class="hljs-variable">&lt;/p&gt;</span>

<span class="hljs-comment">## eviction.proto</span>
query/eviction.proto

contains messages related to eviction records as they appear in the
query-layer abstraction of ebook&amp;<span class="hljs-comment">#39;s serving js.</span>


<span class="hljs-variable">&lt;a name=&quot;query.SFRBEvictionMetadata&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### SFRBEvictionMetadata</span>
consolidated info about an eviction in sf rent board records. 

as of 2020/09/26, there are two flavors of eviction structs in ebook
queries. this message describes the union of those structs, and is used to
represent both.

eviction details in location-based query results (neighborhood.js) include
info about the attributed evictor and their business network.

that info is not present in business-based query results (corp.js, et al),
so those fields are left unset. see comments inline.

////////////////////////////////////////////////////
fields describing the eviction record itself:
////////////////////////////////////////////////////


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> evict_id </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> unique id for RB_Eviction nodes in ebook dataset.  this is typically derived from sf rent board&amp;#39;s petition id, but is *NOT* equivalent. DO NOT USE THIS FOR DIRECT COMPARISON TO SFRB RECORDS. </span>|
|<span class="hljs-string"> evict_date </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> date on which this eviction took effect, according to public records. format: &amp;#39;CCYYMMDD&amp;#39;. </span>|
|<span class="hljs-string"> type </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> type of eviction, for example &amp;#34;Buyout Declaration&amp;#34; or &amp;#34;Ellis Act Withdrawal&amp;#34;. todo: document supported values for this field. </span>|
|<span class="hljs-string"> ellis_evictor </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> attributed evictors according to ellis act withdrawal records. only populated for evictions of type &amp;#34;Ellis Act Withdrawal&amp;#34;  todo verify semantics. ad-hoc testing on april 2020 dataset shows a list of multiple ellis evictors, which appear to be derived from interpreting a string as a comma-separated list. As of 2020/09/26, the relationship between this string and the ebook is not well documented. </span>|
|<span class="hljs-string"> multiple_sales_matches </span>|<span class="hljs-string"> [bool](#bool) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> a property of the EVICTED_BY relation connecting an SOS_Corp node with this eviction&amp;#39;s RB_Eviction node.  todo: document what this field means. </span>|
|<span class="hljs-string"> block_lot </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> block_lot of the parcel where this eviction tool place. uniquely specifies a parcel in sf assessor records. unique key for A_Parcel nodes in the database. </span>|
|<span class="hljs-string"> units </span>|<span class="hljs-string"> [double](#double) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> num. units at the parcel where this eviction took place (via assessor records). </span>|
|<span class="hljs-string"> lat </span>|<span class="hljs-string"> [double](#double) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> latitude (in degrees) of a point within the boundaries of the parcel where this eviction took place. </span>|
|<span class="hljs-string"> long </span>|<span class="hljs-string"> [double](#double) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> longitude (in degrees) of a point within the boundaries of the parcel where this eviction took place. </span>|
|<span class="hljs-string"> addr </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> street address of the parcel where this eviction took place (via assessor records). see &amp;#39;addr&amp;#39; field of DirectlyOwnedParcelInfo. </span>|
|<span class="hljs-string"> neighborhood </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> name of the neighorhood that encompasses the parcel where this eviction took place (via assessor records). see &amp;#39;neighborhood&amp;#39; field of DirectlyOwnedParcelInfo. </span>|
|<span class="hljs-string"> multiple_addr_matches </span>|<span class="hljs-string"> [bool](#bool) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> a property of the EVICTION_AT relation connecting this eviction to a parcel record in the ebook dataset. todo: document what this field means. </span>|
|<span class="hljs-string"> name </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> only set when this eviction is part of a location-based query (ex: neighborhood lookup). when set, contains the name of an attributed evictor, or &amp;#34;Unknown&amp;#34; if there are no attributed evictors.  when this message is part of a business-info query result, name is unset. </span>|
|<span class="hljs-string"> linked_be </span>|<span class="hljs-string"> [BusinessNetworkIdentifier](#query.BusinessNetworkIdentifier) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> contains id&amp;#39;s used to refer to a business holding network. only set when eviction message is part of a location-based query (ex: lookup by neighborhood). unset when this message appears in a business-info query result. </span>|





 

 

 

 



<span class="hljs-variable">&lt;a name=&quot;graph_util.proto&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>
<span class="hljs-variable">&lt;p align=&quot;right&quot;&gt;</span><span class="hljs-variable">&lt;a href=&quot;#top&quot;&gt;</span>Top<span class="hljs-variable">&lt;/a&gt;</span><span class="hljs-variable">&lt;/p&gt;</span>

<span class="hljs-comment">## graph_util.proto</span>
query/graph_util.proto

contains helper messages for describing neo4j graphs.


<span class="hljs-variable">&lt;a name=&quot;query.GraphNode&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### GraphNode</span>
representation of a node in the graph, including internal details
particular to the graph&amp;<span class="hljs-comment">#39;s instantiation.</span>

based on the json schema of neo4j data driver&amp;<span class="hljs-comment">#39;s query results.</span>


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> identity </span>|<span class="hljs-string"> [int64](#int64) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> internal graph db id for this node. </span>|
|<span class="hljs-string"> labels </span>|<span class="hljs-string"> list&lt; [string](#string) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> the node types that this node has. in our graph, nodes always have a single type, as of 2021/03/12, but this may change in the future. </span>|
|<span class="hljs-string"> properties_json </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> a json string representing a map of this node&amp;#39;s properties, where the keys are the property names and the values are strings, numbers, or objects.  NOTE: this field does not appear in the response objects returned by neo4j-driver.  in the neo4j driver&amp;#39;s response, &amp;#39;properties&amp;#39; is a plain object. this is convenient for the programming api, but it means that the driver&amp;#39;s query response can never be fully-type-safely specified as proto.  this is because the schema of &amp;#39;properties&amp;#39; is unpredictable (determined by the contents of the db). you could choose to represent it as a map of strings/bytes/Any/etc., but the native json representation of the proto wouldn&amp;#39;t match the actual neo4j driver&amp;#39;s response.  since we can&amp;#39;t acheive perfect compatibility, the simplest strategy is to encode the &amp;#39;properties&amp;#39; object as json. callers should &amp;#39;JSON.parse&amp;#39; the value of &amp;#39;properties_json&amp;#39; into &amp;#39;properties&amp;#39; to achieve compatibility with the neo4j driver api.  similarly, callers should &amp;#39;JSON.stringify&amp;#39; the &amp;#39;properties&amp;#39; value of a neo4j driver response into &amp;#39;properties_json&amp;#39; to allow encoding as proto. </span>|
|<span class="hljs-string"> properties </span>|<span class="hljs-string"> [bytes](#bytes) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> **Deprecated.** see above. the neo4j-driver object equivalent uses the name &amp;#39;properties&amp;#39;; to make conversion code clearer, don&amp;#39;t reuse that name. </span>|






<span class="hljs-variable">&lt;a name=&quot;query.GraphRelation&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### GraphRelation</span>
representation of a relation (edge) in the graph, including internal details
particular to the graph&amp;<span class="hljs-comment">#39;s instantiation. based on the js obj schema of</span>
neo4j-driver&amp;<span class="hljs-comment">#39;s query results.</span>

NOTE: a GraphRelation as described here contains the complete set of info
for both nodes that it connects! that means that storing a graph as a list
of these GraphRelation objects is inefficient, because the same node may be
described many times (once for each connecting edge).


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> start </span>|<span class="hljs-string"> [GraphNode](#query.GraphNode) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> origin node of the relation. </span>|
|<span class="hljs-string"> end </span>|<span class="hljs-string"> [GraphNode](#query.GraphNode) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> destination node of the relation. NOTE: as of 2021/03/12, edges are treated as though they bidirectional in ebook graph analysis. </span>|
|<span class="hljs-string"> type </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> the relation/edge&amp;#39;s type in the graph (&amp;#34;ENTITY_OWNED_BY&amp;#34;, etc.). </span>|





 

 

 

 



<span class="hljs-variable">&lt;a name=&quot;network.proto&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>
<span class="hljs-variable">&lt;p align=&quot;right&quot;&gt;</span><span class="hljs-variable">&lt;a href=&quot;#top&quot;&gt;</span>Top<span class="hljs-variable">&lt;/a&gt;</span><span class="hljs-variable">&lt;/p&gt;</span>

<span class="hljs-comment">## network.proto</span>
query/network.proto

type definitions for network analysis of businesses, property-holders, and
evictors in ebook serving query abstraction layer.


<span class="hljs-variable">&lt;a name=&quot;query.BusinessNetworkIdentifier&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### BusinessNetworkIdentifier</span>
id&amp;<span class="hljs-comment">#39;s used to refer to a real-estate holding network, as modeled by</span>
analysis of the calif. sec. of state business registry.

see the developer guide for a detailed description of the evictorbook&amp;<span class="hljs-comment">#39;s</span>
network connection methodology in the section &amp;<span class="hljs-comment">#34;Network Connection Method -</span>
Detailed &amp;gt; During DB Creation&amp;<span class="hljs-comment">#34;.</span>

c_id assignment is described in step &amp;<span class="hljs-comment">#39;I&amp;#39; of that section and network_id</span>
assignment is described in step &amp;<span class="hljs-comment">#39;III&amp;#39;.</span>


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> \_\_typename </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> type of business record in ebook datastore (&amp;#34;SOS_LP&amp;#34;, &amp;#34;SOS_Corp&amp;#34;) from which this business information was extracted. </span>|
|<span class="hljs-string"> network_id </span>|<span class="hljs-string"> [int64](#int64) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> business network id of this business in ebook datastore, as inferred by graph analysis. see graph schema documentation for details. </span>|
|<span class="hljs-string"> c_id </span>|<span class="hljs-string"> [int64](#int64) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> connected component id of this business in ebook datastore, as inferred by graph analysis. all businesses with the same c_id must also have the same network_id, though two businesses with the same network_id may have different c_id&amp;#39;s. see graph documentation and developer guide for details. </span>|






<span class="hljs-variable">&lt;a name=&quot;query.NetworkLocationInfo&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### NetworkLocationInfo</span>
id and location characteristics of a real-estate business network.


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> addr_readable </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> an address in the ebook datastore where the central owning entity of a real-estate business network is believed to be located. </span>|
|<span class="hljs-string"> network_id </span>|<span class="hljs-string"> [int64](#int64) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> network id of the real-estate business network believed to be headquartered at addr_readable. </span>|





 

 

 

 



<span class="hljs-variable">&lt;a name=&quot;parcel.proto&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>
<span class="hljs-variable">&lt;p align=&quot;right&quot;&gt;</span><span class="hljs-variable">&lt;a href=&quot;#top&quot;&gt;</span>Top<span class="hljs-variable">&lt;/a&gt;</span><span class="hljs-variable">&lt;/p&gt;</span>

<span class="hljs-comment">## parcel.proto</span>
query/parcel.proto

describes the CYPHER queries invoked at serving-time to retrieve
parcel-related information from the ebook datastore.


<span class="hljs-variable">&lt;a name=&quot;query.BusinessOwnedParcelInfo&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### BusinessOwnedParcelInfo</span>
consolidated info about a parcel, as presented from the context of the
business entity that owns the parcel.

as of 2020/09/26, this message mirrors the subquery in js commented with
&amp;<span class="hljs-comment">#34;get the parcels directly owned&amp;#34;.</span>

except for num_evictions, these fields correspond one-to-one to fields of
the same name in A_Parcel nodes. defining another message here instead of
attempting to reuse, so we can allow the schema and query interface boundary
to evolve independently.


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> block_lot </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> block lot string, which uniquely specifies a parcel in sf city and county assessor records. this is a unique key for A_Parcel nodes in the database. </span>|
|<span class="hljs-string"> record_date </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> date listed on the documents which record this corporation&amp;#39;s ownership of the parcel, as recorded in the &amp;#39;PARC_OWNED_BY&amp;#39; relation that connects the A_Parcel node with the SOS_Corp node.  format: CCYYMMDD </span>|
|<span class="hljs-string"> perc_owner </span>|<span class="hljs-string"> [double](#double) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> ownership percentage, as documented in the &amp;#39;PARC_OWNED_BY&amp;#39; relation connecting the A_Parcel node with the SOS_Corp node.  ownership percentage is expressed as an integer between 0 and 100, but returned as a floating point number. </span>|
|<span class="hljs-string"> addr </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> a string representing the parcel&amp;#39;s street address, including street number, street name and suffix, and unit number. the parcel is assumed to be within sf city/county limits. </span>|
|<span class="hljs-string"> num_evictions </span>|<span class="hljs-string"> [int32](#int32) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> number of RB_Eviction nodes with an EVICTION_AT relationship to this parcel&amp;#39;s A_Parcel node. </span>|
|<span class="hljs-string"> units </span>|<span class="hljs-string"> [double](#double) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> number of units that this parcel consists of, according to sf city and county assessor records. </span>|
|<span class="hljs-string"> lat </span>|<span class="hljs-string"> [double](#double) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> latitude, in degrees, of a point within this parcel&amp;#39;s boundaries.  todo: formally specify bounds. </span>|
|<span class="hljs-string"> long </span>|<span class="hljs-string"> [double](#double) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> longitude, in degrees, of a point within this parcel&amp;#39;s boundaries.  todo: formally specify bounds. </span>|
|<span class="hljs-string"> neighborhood </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> name of the neighborhood this parcel occupies. as of 2020/09/26, it&amp;#39;s assumed that all parcels are within sf city and county, so these are san francisco neighborhoods.  values correspond to names of the neighborhood polygons described at: https://data.sfgov.org/Geographic-Locations-and-Boundaries/SF-Find-Neighborhoods/pty2-tcw4 </span>|






<span class="hljs-variable">&lt;a name=&quot;query.NetworkedParcelInfo&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### NetworkedParcelInfo</span>
brief description of a parcel which is not directly owned by the corporation
being searched for, but which may be connected through real-estate holding
network of business entities and owners.

derived from the subquery commented &amp;<span class="hljs-comment">#34;// compile everything together for the</span>
related parcels&amp;<span class="hljs-comment">#34; in server/rest/handlers/corp.js, as of 2020/09/26.</span>


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> addr </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> address of the networked parcel, as derived from sf assessor records. </span>|
|<span class="hljs-string"> block_lot </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> the block_lot of the parcel, primary key in ebook datastore and sf assessor records. </span>|
|<span class="hljs-string"> num_evictions </span>|<span class="hljs-string"> [int32](#int32) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> total amount of evictions believed to have occurred at the networked property, which appear in ebook&amp;#39;s datastore. no bounds on eviction date. </span>|
|<span class="hljs-string"> units </span>|<span class="hljs-string"> [int32](#int32) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> number of units on the networked property (for multi-building properties, this is the sum total of units on the property). </span>|
|<span class="hljs-string"> lat </span>|<span class="hljs-string"> [double](#double) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> latitude (in degrees) of a point within the networked property. </span>|
|<span class="hljs-string"> long </span>|<span class="hljs-string"> [double](#double) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> longitude (in degrees) of a point within the networked property. </span>|
|<span class="hljs-string"> neighborhood </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> name of the neighborhood this parcel occupies. see SFAssessorParcelDetails for description of valid neighborhood names. </span>|
|<span class="hljs-string"> possible_networks </span>|<span class="hljs-string"> list&lt; [NetworkLocationInfo](#query.NetworkLocationInfo) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> identifiers for real-estate business networks which the networked parcel may be associated with. in other words, these are networks with a second-degree relatinship to the original parcel. </span>|
|<span class="hljs-string"> owners </span>|<span class="hljs-string"> list&lt; [NetworkedParcelOwner](#query.NetworkedParcelOwner) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> individuals, businesses, or other legal entities believed to own the networked parcel in whole or in part. </span>|






<span class="hljs-variable">&lt;a name=&quot;query.NetworkedParcelOwner&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### NetworkedParcelOwner</span>
brief description of an individual, business, or trust, etc., which may own
a parcel associated with a real-estate business network.


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> owner_name </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> owner of the networked parcel, as it appears in that parcel&amp;#39;s assessor records. </span>|
|<span class="hljs-string"> linked_be </span>|<span class="hljs-string"> [BusinessNetworkIdentifier](#query.BusinessNetworkIdentifier) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> set when owner of the networked parcel is believed to be linked to a business entity/network. </span>|
|<span class="hljs-string"> ma_network_id </span>|<span class="hljs-string"> [int64](#int64) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> set when mailing_address is believed to also be the cental mailing address of a real-estate business network central business&amp;#39;s hq. in that case, it&amp;#39;s the network id of the business network headquartered at that address. </span>|
|<span class="hljs-string"> mailing_address </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> physical mailing address where the owner can be contacted, according to assessor records. </span>|






<span class="hljs-variable">&lt;a name=&quot;query.SFAssessorParcelDetails&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### SFAssessorParcelDetails</span>
detailed info about a real-estate parcel from the sf assessor&amp;<span class="hljs-comment">#39;s office.</span>

corresponds to the object returned by parcel/details.js.
originally derived from parcel_details subquery in parcel.js (deprecated).


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> yr_built </span>|<span class="hljs-string"> [int32](#int32) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> year in which the buildings on this real-estate parcel were first constructed. TODO: describe behavior for multi-building parcels. </span>|
|<span class="hljs-string"> addr </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> string containing parcel&amp;#39;s street address, including street number, street name and suffix, and unit number. parcel is assumed to be within sf city/county limits.  notes from schema definition sheet: full address in the format of &amp;#34;ST_START_NO-ST_END_NO ST_NAME ST_TYPE (Unit UNIT)&amp;#34; (w/o end no if no address range, w/o parentheses if no unit) </span>|
|<span class="hljs-string"> block_lot </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> &amp;#39;block_lot&amp;#39; identifier. unique key for a parcel in sf assessor records, and uniqye key for A_Parcel nodes in the database. </span>|
|<span class="hljs-string"> lat </span>|<span class="hljs-string"> [double](#double) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> latitude in degrees of a point within this parcel&amp;#39;s boundaries.  TODO: specify bounds. </span>|
|<span class="hljs-string"> long </span>|<span class="hljs-string"> [double](#double) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> longitude in degrees of a point within this parcel&amp;#39;s boundaries.  TODO: specify bounds. </span>|
|<span class="hljs-string"> neighborhood </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> name of the neighborhood this parcel occupies. as of 2020/09/26, it&amp;#39;s assumed that all parcels are within sf city and county, so these are san francisco neighborhoods.  neighborhoods assigned using sf polygons.  names and polygon boundaries: https://data.sfgov.org/Geographic-Locations-and-Boundaries/SF-Find-Neighborhoods/pty2-tcw4 </span>|
|<span class="hljs-string"> rent_controlled </span>|<span class="hljs-string"> [int32](#int32) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> rough assessment of this parcel&amp;#39;s rent-control status.  0 (default) if data unavailable to determine rent controlled status, 1 if likely rent controlled, 2 if doubtful that this is rent controlled </span>|
|<span class="hljs-string"> prop_class_code </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> property class code, via sf assessor&amp;#39;s office. definitons: https://data.sfgov.org/Housing-and-Buildings/Reference-Assessor-Recorder-Property-Class-Codes/pa56-ek2h/data </span>|
|<span class="hljs-string"> zone </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> i.d. for the zoning district this parcel occupies. sf zoning district definitions: https://sfplanninggis.org/pim/map.html?layers=Zoning%20Districts </span>|
|<span class="hljs-string"> stories </span>|<span class="hljs-string"> [int32](#int32) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> how tall is the building on this parcel, in stories. TODO: behavior for multi-building parcels? </span>|
|<span class="hljs-string"> units </span>|<span class="hljs-string"> [int32](#int32) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> number of physical units within this logical real-estate parcel. </span>|
|<span class="hljs-string"> rooms </span>|<span class="hljs-string"> [int32](#int32) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> number of total rooms within buildings on this parcel (for multi-unit parcels, this is the sum of rooms among all units.) </span>|
|<span class="hljs-string"> beds </span>|<span class="hljs-string"> [int32](#int32) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> number of total bedrooms on this parcel (for multi-unit parcels, this is the sum of bedrooms among all units.) </span>|
|<span class="hljs-string"> assess_land_val </span>|<span class="hljs-string"> [int32](#int32) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> assessor valuation of the &amp;#39;land&amp;#39; base value, i.e. the parcel&amp;#39;s theoretical value if it had no buildings on it. </span>|
|<span class="hljs-string"> assess_imp_val </span>|<span class="hljs-string"> [int32](#int32) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> assessor valuation of the &amp;#39;improvement&amp;#39; done to the land via development, as of most recent assessment. units in u.s. dollars. </span>|
|<span class="hljs-string"> assess_val_date </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> date when the parcel&amp;#39;s value was last assessed. format: CCYYMMDD </span>|
|<span class="hljs-string"> update_date </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> date on which this parcel&amp;#39;s address was last updated, via assessor records. format: CCYYMMDD </span>|
|<span class="hljs-string"> curr_sales_price </span>|<span class="hljs-string"> [int32](#int32) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> units in u.s. dollars. TODO: document when and how this gets populated. </span>|
|<span class="hljs-string"> curr_sales_date </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> format: CCYYMMDD TODO: document when and how this gets populated. </span>|
|<span class="hljs-string"> parc_start_no </span>|<span class="hljs-string"> [int32](#int32) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> if the logical parcel occupies more than one street number, then this field contains the lowest street number in that range.  if the logical parcel occupies only one street number, then this field contains that number.  TODO: why no parc_end_no field? </span>|
|<span class="hljs-string"> parc_street_name </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> main name part of the street/route name of the parcel&amp;#39;s address. (ex: &amp;#34;geary&amp;#34;, &amp;#34;first&amp;#34;, &amp;#34;taylor&amp;#34;, etc.)  TODO: describe capitalization, stylization, etc. </span>|
|<span class="hljs-string"> parc_street_type </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> street suffix (ex: &amp;#34;st&amp;#34;, &amp;#34;ln&amp;#34;) of the parcel&amp;#39;s address.  TODO: describe capitalization, stylization, etc. </span>|
|<span class="hljs-string"> parc_unit_no </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> unit or subpremise identifier. just the number or letter. </span>|
|<span class="hljs-string"> parc_zip </span>|<span class="hljs-string"> [int32](#int32) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> five-digit u.s. postal code of the parcel&amp;#39;s address, as an integer. </span>|






<span class="hljs-variable">&lt;a name=&quot;query.SFAssessorParcelOwner&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### SFAssessorParcelOwner</span>
an owner, as seen in server/rest/handlers/parcel/owners.js.


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> mailing_address </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> physical mailing address where this owner can be reached, according to assessor parcel records. </span>|
|<span class="hljs-string"> record_date </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> date this ownership was documented, as it appears in the PARC_OWNED_BY (ParcelOwnedBy) relation connecting the parcel node with an A_Parcel_Owner vertex.  format: CCYYMMDD </span>|
|<span class="hljs-string"> perc_owner </span>|<span class="hljs-string"> [int32](#int32) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> ownership percentage, as a number between 0 and 100, as it appears in the PARC_OWNED_BY (ParcelOwnedBy) relation connecting the parcel node with an A_Parcel_Owner vertex. </span>|
|<span class="hljs-string"> owner_name </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> name of owner listed on parcel records from SF assessor&amp;#39;s office.  todo briefly describe how/whether this data was normalized. </span>|
|<span class="hljs-string"> linked_be </span>|<span class="hljs-string"> [BusinessNetworkIdentifier](#query.BusinessNetworkIdentifier) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> id&amp;#39;s used to refer to a real-estate holding network, as modeled by analysis of the calif. sec. of state business registry.  if &amp;#39;linked_be&amp;#39; is set to a non-empty message, then these id&amp;#39;s describe the real-estate business network which our data indicates this owner is affiliated with. </span>|





 

 

 

 






<span class="hljs-variable">&lt;a name=&quot;util.proto&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>
<span class="hljs-variable">&lt;p align=&quot;right&quot;&gt;</span><span class="hljs-variable">&lt;a href=&quot;#top&quot;&gt;</span>Top<span class="hljs-variable">&lt;/a&gt;</span><span class="hljs-variable">&lt;/p&gt;</span>

<span class="hljs-comment">## util.proto</span>
query/util.proto

contains helper messages which are useful in the query abstraction layer
proto definitons.


<span class="hljs-variable">&lt;a name=&quot;query.NormalizedName&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### NormalizedName</span>
convience wrapper for normalized names.
semantically neutral, used in a variety of contexts.


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> name_norm </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> a normalized name, as it appears in the graph. </span>|
|<span class="hljs-string"> \_\_typename </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> optional. node type of the graph node where this name_norm was found. typically set for names of business entities, where there is a need to differentiate between SOS_Corp and SOS_LP. </span>|






<span class="hljs-variable">&lt;a name=&quot;query.ReadableAddress&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### ReadableAddress</span>
convenience wrapper for human-readable addresses.
TODO: describe normalization, etc.


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> addr_readable </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> readable/friendly representation of an address. normalization and internal structure may vary based on where this; check the containing message for details. </span>|





 

 

 

 

</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemaslegacymd-generatedrestdocs.md"><a href="#toc"><a name="server-schemas-legacy-md-generated-rest-docs-md">server/schemas/legacy/md-generated/rest/docs.md</a></a></h2>
<pre><code><span class="hljs-comment"># Evictorbook Rest API 1.0 Documentation</span>
<span class="hljs-variable">&lt;a name=&quot;top&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### Note for readers</span>

The documentation featured below was originally written in a format called &#x27;proto&#x27;, and then converted to Markdown. proto is a schema definition language that&#x27;s intended to be both machine-readable and developer-readable. The motivation is to declare the machine-readable schema directly alongside human-readable comments, in the same file, so the canonical documentation always matches the schema enforced in code. The disadvantage is that .proto syntax requires some getting used to.

In order to produce a more user-friendly and widely readable documentation, we use an automated tool to convert the &#x27;proto&#x27; files into Markdown. The text descriptions here are imported directly from the comments in the &#x27;proto&#x27; files. This introduces some quirks in formatting (for example, multi-line comments are compressed into a single line in order to fit into the Markdown tables below). Let us know how we did; the Markdown formatting is a work in progress, so let us know if you have suggestions to improve this formatting or make it more readable.

That&#x27;s the disclaimer. Read on for the documentation.

<span class="hljs-comment">## Table of Contents</span>

- [rest.proto](<span class="hljs-comment">#rest.proto)</span>
    - [EvictorbookRestService](<span class="hljs-comment">#rest.EvictorbookRestService)</span>

    - [BusinessEntitySearchRequest](<span class="hljs-comment">#rest.BusinessEntitySearchRequest)</span>
    - [BusinessEntitySearchResponse](<span class="hljs-comment">#rest.BusinessEntitySearchResponse)</span>
    - [GetCorpRequest](<span class="hljs-comment">#rest.GetCorpRequest)</span>
    - [GetCorpResponse](<span class="hljs-comment">#rest.GetCorpResponse)</span>
    - [GetEvictionsByNeighborhoodRequest](<span class="hljs-comment">#rest.GetEvictionsByNeighborhoodRequest)</span>
    - [GetEvictionsByNeighborhoodResponse](<span class="hljs-comment">#rest.GetEvictionsByNeighborhoodResponse)</span>
    - [GetLPRequest](<span class="hljs-comment">#rest.GetLPRequest)</span>
    - [GetLPResponse](<span class="hljs-comment">#rest.GetLPResponse)</span>
    - [GetNetworkBusinessEntityRequest](<span class="hljs-comment">#rest.GetNetworkBusinessEntityRequest)</span>
    - [GetNetworkBusinessEntityResponse](<span class="hljs-comment">#rest.GetNetworkBusinessEntityResponse)</span>
    - [GetNetworkParcelRequest](<span class="hljs-comment">#rest.GetNetworkParcelRequest)</span>
    - [GetNetworkParcelResponse](<span class="hljs-comment">#rest.GetNetworkParcelResponse)</span>
    - [GetParcelDetailsRequest](<span class="hljs-comment">#rest.GetParcelDetailsRequest)</span>
    - [GetParcelDetailsResponse](<span class="hljs-comment">#rest.GetParcelDetailsResponse)</span>
    - [GetParcelEvictionsRequest](<span class="hljs-comment">#rest.GetParcelEvictionsRequest)</span>
    - [GetParcelEvictionsResponse](<span class="hljs-comment">#rest.GetParcelEvictionsResponse)</span>
    - [GetParcelNetworksRequest](<span class="hljs-comment">#rest.GetParcelNetworksRequest)</span>
    - [GetParcelNetworksResponse](<span class="hljs-comment">#rest.GetParcelNetworksResponse)</span>
    - [GetParcelOwnersRequest](<span class="hljs-comment">#rest.GetParcelOwnersRequest)</span>
    - [GetParcelOwnersResponse](<span class="hljs-comment">#rest.GetParcelOwnersResponse)</span>
    - [GetParcelRequest](<span class="hljs-comment">#rest.GetParcelRequest)</span>
    - [GetParcelResponse](<span class="hljs-comment">#rest.GetParcelResponse)</span>
    - [ParcelSearchRequest](<span class="hljs-comment">#rest.ParcelSearchRequest)</span>
    - [ParcelSearchResponse](<span class="hljs-comment">#rest.ParcelSearchResponse)</span>
    - [RequestContext](<span class="hljs-comment">#rest.RequestContext)</span>
  
- [business.proto](<span class="hljs-comment">#business.proto)</span>
    - [CorporationDetails](<span class="hljs-comment">#rest.CorporationDetails)</span>
    - [LimitedBusinessDetails](<span class="hljs-comment">#rest.LimitedBusinessDetails)</span>
  
- [eviction.proto](<span class="hljs-comment">#eviction.proto)</span>
    - [EvictionMetadata](<span class="hljs-comment">#rest.EvictionMetadata)</span>
  
- [graph_util.proto](<span class="hljs-comment">#graph_util.proto)</span>
    - [GraphNode](<span class="hljs-comment">#rest.GraphNode)</span>
    - [GraphRelation](<span class="hljs-comment">#rest.GraphRelation)</span>
  
- [network.proto](<span class="hljs-comment">#network.proto)</span>
    - [NetworkSummary](<span class="hljs-comment">#rest.NetworkSummary)</span>
  
- [network_ids.proto](<span class="hljs-comment">#network_ids.proto)</span>
    - [BusinessNetworkIdentifier](<span class="hljs-comment">#rest.BusinessNetworkIdentifier)</span>
    - [NetworkLocationInfo](<span class="hljs-comment">#rest.NetworkLocationInfo)</span>
  
- [parcel.proto](<span class="hljs-comment">#parcel.proto)</span>
    - [NetworkedParcelSummary](<span class="hljs-comment">#rest.NetworkedParcelSummary)</span>
    - [NetworkedParcelSummary.NetworkedParcelOwner](<span class="hljs-comment">#rest.NetworkedParcelSummary.NetworkedParcelOwner)</span>
    - [ParcelBriefOwnershipInfo](<span class="hljs-comment">#rest.ParcelBriefOwnershipInfo)</span>
    - [ParcelDetails](<span class="hljs-comment">#rest.ParcelDetails)</span>
    - [ParcelOwner](<span class="hljs-comment">#rest.ParcelOwner)</span>
  
- [util.proto](<span class="hljs-comment">#util.proto)</span>
    - [NormalizedName](<span class="hljs-comment">#rest.NormalizedName)</span>
    - [ReadableAddress](<span class="hljs-comment">#rest.ReadableAddress)</span>
    - [StringVector](<span class="hljs-comment">#rest.StringVector)</span>
  
- [Scalar Value Types](<span class="hljs-comment">#scalar-value-types)</span>

<span class="hljs-variable">&lt;a name=&quot;rest.proto&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>
<span class="hljs-variable">&lt;p align=&quot;right&quot;&gt;</span><span class="hljs-variable">&lt;a href=&quot;#top&quot;&gt;</span>Top<span class="hljs-variable">&lt;/a&gt;</span><span class="hljs-variable">&lt;/p&gt;</span>

<span class="hljs-comment">## rest.proto</span>
rest.proto

top-level description of ebook rest api. describes the rest routes (rpc&amp;<span class="hljs-comment">#39;s),</span>
and their request/response formats.

<span class="hljs-variable">&lt;a name=&quot;rest.EvictorbookRestService&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### EvictorbookRestService</span>


|<span class="hljs-string"> Method Name </span>|<span class="hljs-string"> Request Type </span>|<span class="hljs-string"> Response Type </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----------- </span>|<span class="hljs-string"> ------------ </span>|<span class="hljs-string"> ------------- </span>|<span class="hljs-string"> ------------</span>|
|<span class="hljs-string"> GetParcel </span>|<span class="hljs-string"> [GetParcelRequest](#rest.GetParcelRequest) </span>|<span class="hljs-string"> [GetParcelResponse](#rest.GetParcelResponse) </span>|<span class="hljs-string"> deprecated -- legacy endpoint, prefer more specific parcel calls below. rest api v1 route: &amp;#39;api/parcel/:block_lot&amp;#39; </span>|
|<span class="hljs-string"> GetParcelDetails </span>|<span class="hljs-string"> [GetParcelDetailsRequest](#rest.GetParcelDetailsRequest) </span>|<span class="hljs-string"> [GetParcelDetailsResponse](#rest.GetParcelDetailsResponse) </span>|<span class="hljs-string"> get details about a parcel from sf assessor records, keyed by block_lot. rest api v1 route: &amp;#39;api/parcel/:block_lot/details&amp;#39; </span>|
|<span class="hljs-string"> GetParcelEvictions </span>|<span class="hljs-string"> [GetParcelEvictionsRequest](#rest.GetParcelEvictionsRequest) </span>|<span class="hljs-string"> [GetParcelEvictionsResponse](#rest.GetParcelEvictionsResponse) </span>|<span class="hljs-string"> get details about evictions which occurred at a given parcel, keyed by block_lot. rest api v1 route: &amp;#39;api/parcel/:block_lot/evictions&amp;#39; </span>|
|<span class="hljs-string"> GetParcelNetworks </span>|<span class="hljs-string"> [GetParcelNetworksRequest](#rest.GetParcelNetworksRequest) </span>|<span class="hljs-string"> [GetParcelNetworksResponse](#rest.GetParcelNetworksResponse) </span>|<span class="hljs-string"> get info about real-estate business networks believed to have a stake in this parcel, as well as other parcels which those networks may have a vested interest in. NOTE: performance bottleneck, invoke with caution. rest api v1 route: &amp;#39;api/parcel/:block_lot/networks&amp;#39; </span>|
|<span class="hljs-string"> GetParcelOwners </span>|<span class="hljs-string"> [GetParcelOwnersRequest](#rest.GetParcelOwnersRequest) </span>|<span class="hljs-string"> [GetParcelOwnersResponse](#rest.GetParcelOwnersResponse) </span>|<span class="hljs-string"> get info about individuals, businesses, and/or trusts believed to own the parcel in full or in part. rest api v1 route: &amp;#39;api/parcel/:block_lot/owners&amp;#39; </span>|
|<span class="hljs-string"> GetCorp </span>|<span class="hljs-string"> [GetCorpRequest](#rest.GetCorpRequest) </span>|<span class="hljs-string"> [GetCorpResponse](#rest.GetCorpResponse) </span>|<span class="hljs-string"> get info about a corporation, which may be part of a real-estate-owning business network. rest api v1 route: &amp;#39;/api/corp/:name&amp;#39; </span>|
|<span class="hljs-string"> GetLP </span>|<span class="hljs-string"> [GetLPRequest](#rest.GetLPRequest) </span>|<span class="hljs-string"> [GetLPResponse](#rest.GetLPResponse) </span>|<span class="hljs-string"> get info about a limited partnership or llc, which may be part of a real-estate-owning business network. rest api v1 route: &amp;#39;/api/lp/:name&amp;#39; </span>|
|<span class="hljs-string"> GetNetworkParcel </span>|<span class="hljs-string"> [GetNetworkParcelRequest](#rest.GetNetworkParcelRequest) </span>|<span class="hljs-string"> [GetNetworkParcelResponse](#rest.GetNetworkParcelResponse) </span>|<span class="hljs-string"> given a network_id and a parcel block_lot which is under that network&amp;#39;s influence, return a view of the network centered around that parcel. rest api v1 route: &amp;#39;/api/network/parcel/:network_id/:search_string&amp;#39; </span>|
|<span class="hljs-string"> GetNetworkBusinessEntity </span>|<span class="hljs-string"> [GetNetworkBusinessEntityRequest](#rest.GetNetworkBusinessEntityRequest) </span>|<span class="hljs-string"> [GetNetworkBusinessEntityResponse](#rest.GetNetworkBusinessEntityResponse) </span>|<span class="hljs-string"> given a network_id and a business entity which belongs to that network, return a local view of the network centered around that business. rest api v1 route: &amp;#39;/api/network/:input_type/:search_string&amp;#39; </span>|
|<span class="hljs-string"> GetEvictionsByNeighborhood </span>|<span class="hljs-string"> [GetEvictionsByNeighborhoodRequest](#rest.GetEvictionsByNeighborhoodRequest) </span>|<span class="hljs-string"> [GetEvictionsByNeighborhoodResponse](#rest.GetEvictionsByNeighborhoodResponse) </span>|<span class="hljs-string"> given the name of a neighborhood in san francisco, return eviction records from the eb datastore which occurred in that neighborhood. rest api v1 route: &amp;#39;/api/neighborhood/:neighborhood&amp;#39; and &amp;#39;/api/neighborhood/:neighborhood/:page&amp;#39; </span>|
|<span class="hljs-string"> ParcelSearch </span>|<span class="hljs-string"> [ParcelSearchRequest](#rest.ParcelSearchRequest) </span>|<span class="hljs-string"> [ParcelSearchResponse](#rest.ParcelSearchResponse) </span>|<span class="hljs-string"> used for search feature on front page. performs prefix-based index lookup on business entities (both &amp;#39;corp&amp;#39; and &amp;#39;lp&amp;#39;) by normalized name. rest api v1 route: &amp;#39;/api/parcel-search/:search&amp;#39; </span>|
|<span class="hljs-string"> BusinessEntitySearch </span>|<span class="hljs-string"> [BusinessEntitySearchRequest](#rest.BusinessEntitySearchRequest) </span>|<span class="hljs-string"> [BusinessEntitySearchResponse](#rest.BusinessEntitySearchResponse) </span>|<span class="hljs-string"> used for search feature on front page. performs prefix-based lookup on business entities (both &amp;#39;corp&amp;#39; and &amp;#39;lp&amp;#39;) by normalized name. rest api v1 route: &amp;#39;/api/be-search/:search&amp;#39; </span>|

 


<span class="hljs-variable">&lt;a name=&quot;rest.BusinessEntitySearchRequest&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### BusinessEntitySearchRequest</span>

used for search feature on front page. performs prefix-based index lookup
on business entities (both &#x27;corp&#x27; and &#x27;lp&#x27;) by normalized name.

rest api v1 route: &#x27;/api/be-search/:search&#x27;


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> context </span>|<span class="hljs-string"> [RequestContext](#rest.RequestContext) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> request context, see above. </span>|
|<span class="hljs-string"> search </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> query string, to be interpreted as a business-entity name prefix. todo: describe constraints, normalization, etc. </span>|






<span class="hljs-variable">&lt;a name=&quot;rest.BusinessEntitySearchResponse&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### BusinessEntitySearchResponse</span>

used for search feature on front page. performs prefix-based index lookup
on business entities (both &#x27;corp&#x27; and &#x27;lp&#x27;) by normalized name.

rest api v1 route: &#x27;/api/be-search/:search&#x27;


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> \_\_typename </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> represents the type of business entity, but only in an obscure way. context: it&amp;#39;s the node-type of the business&amp;#39;s record in the eb database. TODO: deprecate and replace with enum.  values: &amp;#34;SOS_Corp&amp;#34; if the business is a corporation. &amp;#34;SOS_LP&amp;#34; if the business is a limited partnership or llc. </span>|
|<span class="hljs-string"> name </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> canonical name of the business entity, as it appears in the california secretary of state business registry. </span>|






<span class="hljs-variable">&lt;a name=&quot;rest.GetCorpRequest&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### GetCorpRequest</span>


get info about a corporation, which may be part of a real-estate-owning
business network.

rest api v1 route: &#x27;/api/corp/:name&#x27;

|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> context </span>|<span class="hljs-string"> [RequestContext](#rest.RequestContext) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> request context, see above. </span>|
|<span class="hljs-string"> name </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> name of a corporation to look up, as it appears in the California Secretary of State business registry. todo: describe constraints on normalization, etc. </span>|






<span class="hljs-variable">&lt;a name=&quot;rest.GetCorpResponse&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### GetCorpResponse</span>


get info about a corporation, which may be part of a real-estate-owning
business network.

rest api v1 route: &#x27;/api/corp/:name&#x27;

|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> be_details </span>|<span class="hljs-string"> [CorporationDetails](#rest.CorporationDetails) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> details about this business. note: compared to equivalent query proto, several string fields are remapped short keys to human-readable friendly labels: corporation_status, corporation_type, corporation_tax_base, ftb_suspension_status, corporation_classification. </span>|
|<span class="hljs-string"> parcels_owned </span>|<span class="hljs-string"> list&lt; [ParcelBriefOwnershipInfo](#rest.ParcelBriefOwnershipInfo) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> brief descriptions of the parcels believed to be owned by this business, in whole or in part. </span>|
|<span class="hljs-string"> evictions </span>|<span class="hljs-string"> list&lt; [EvictionMetadata](#rest.EvictionMetadata) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> info about evictions we attribute to this business entity. </span>|
|<span class="hljs-string"> networks </span>|<span class="hljs-string"> list&lt; [NetworkedParcelSummary](#rest.NetworkedParcelSummary) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> despite the name, this is a list of *parcels*, which may be owned by the network associated with this business. COMPATIBILITY NOTE: contains a multimap field, which requires some additional conversion to move from proto-compatibile to existing rest json response. see NetworkParcelSummary.possible_networks for details. </span>|






<span class="hljs-variable">&lt;a name=&quot;rest.GetEvictionsByNeighborhoodRequest&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### GetEvictionsByNeighborhoodRequest</span>


given the name of a neighborhood in san francisco, return eviction 
records from the eb datastore which occurred in that neighborhood.

rest api v1 route: &#x27;/api/neighborhood/:neighborhood&#x27;
               and &#x27;/api/neighborhood/:neighborhood/:page&#x27;

|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> context </span>|<span class="hljs-string"> [RequestContext](#rest.RequestContext) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> request context, see above. </span>|
|<span class="hljs-string"> neighborhood </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> name of a neighborhood in sf. geographical filter for eviction records. names should correspond to the neighborhood polygons described at: https://data.sfgov.org/Geographic-Locations-and-Boundaries/SF-Find-Neighborhoods/pty2-tcw4 </span>|
|<span class="hljs-string"> page </span>|<span class="hljs-string"> [int32](#int32) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> pagination. if page is set &amp;gt; 0, rpc returns the &amp;lt;page&amp;gt;th page of &amp;lt;size&amp;gt; results. if page is unset or set &amp;lt;= 0, rpc returns the first page. </span>|
|<span class="hljs-string"> size </span>|<span class="hljs-string"> [int32](#int32) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> pagination. the number of results to store on a single page. defaults to 100. if unset or set &amp;lt;= 0, rpc uses the default page size. in production, size cannot be increased beyond the default. for development, larger page sizes may be enabled with debug flags. todo: establish a continuation token or some other signal for the caller to know if there are more results beyond the current page. </span>|






<span class="hljs-variable">&lt;a name=&quot;rest.GetEvictionsByNeighborhoodResponse&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### GetEvictionsByNeighborhoodResponse</span>


given the name of a neighborhood in san francisco, return eviction 
records from the eb datastore which occurred in that neighborhood.

rest api v1 route: &#x27;/api/neighborhood/:neighborhood&#x27;
               and &#x27;/api/neighborhood/:neighborhood/:page&#x27;

|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> evictions </span>|<span class="hljs-string"> list&lt; [EvictionMetadata](#rest.EvictionMetadata) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> info about evictions in the ebook datastore which occurred within the requested neighborhood&amp;#39;s boundaries. NOTE FOR COMPATIBLITY: rest api v1 response json represents a list of evicton objects directly, rather than an object with a list property. in order to achieve compatibility with rest api v1 wire protocol, extract and JSON.stringify this list. </span>|






<span class="hljs-variable">&lt;a name=&quot;rest.GetLPRequest&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### GetLPRequest</span>


get info about a limited partnership or llc, which may be part of a
real-estate-owning business network.

rest api v1 route: &#x27;/api/lp/:name&#x27;

|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> context </span>|<span class="hljs-string"> [RequestContext](#rest.RequestContext) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> request context, see above. </span>|
|<span class="hljs-string"> name </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> name of a limited partnership or llc to look up, as it appears in the California Secretary of State business registry. todo: describe constraints on normalization, etc. </span>|






<span class="hljs-variable">&lt;a name=&quot;rest.GetLPResponse&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### GetLPResponse</span>


get info about a limited partnership or llc, which may be part of a
real-estate-owning business network.

rest api v1 route: &#x27;/api/lp/:name&#x27;

|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> be_details </span>|<span class="hljs-string"> [LimitedBusinessDetails](#rest.LimitedBusinessDetails) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> details about this business. note: compared to equivalent query proto, several string fields are remapped short keys to human-readable friendly labels: status, filing type, llc_management_code. </span>|
|<span class="hljs-string"> parcels_owned </span>|<span class="hljs-string"> list&lt; [ParcelBriefOwnershipInfo](#rest.ParcelBriefOwnershipInfo) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> brief descriptions of the parcels believed to be owned by this business, in whole or in part. </span>|
|<span class="hljs-string"> evictions </span>|<span class="hljs-string"> list&lt; [EvictionMetadata](#rest.EvictionMetadata) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> info about evictions we attribute to this business entity. </span>|
|<span class="hljs-string"> networks </span>|<span class="hljs-string"> list&lt; [NetworkedParcelSummary](#rest.NetworkedParcelSummary) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> despite the name, this is a list of *parcels*, which may be owned by the network associated with this business. COMPATIBILITY NOTE: contains a multimap field, which requires some additional conversion to move from proto-compatibile to existing rest json response. see NetworkParcelSummary.possible_networks for details. </span>|






<span class="hljs-variable">&lt;a name=&quot;rest.GetNetworkBusinessEntityRequest&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### GetNetworkBusinessEntityRequest</span>

given a business entity which belongs to a network, return a local view of
the network centered around that business.

rest api v1 route: &#x27;/api/network/:input_type/:search_string&#x27;


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> context </span>|<span class="hljs-string"> [RequestContext](#rest.RequestContext) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> request context, see above. </span>|
|<span class="hljs-string"> input_type </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> &amp;#34;corp&amp;#34; or &amp;#34;lp&amp;#34;, depending on whether the business to query is a corporation or a limited-partnership/llc. </span>|
|<span class="hljs-string"> search_string </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> normalized name of a business, derived from the name found in california sec. of state business records. </span>|






<span class="hljs-variable">&lt;a name=&quot;rest.GetNetworkBusinessEntityResponse&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### GetNetworkBusinessEntityResponse</span>

given a business entity which belongs to a network, return a local view of
the network centered around that business.

rest api v1 route: &#x27;/api/network/:input_type/:search_string&#x27;


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> name_norm </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> normalized name of the business, matching be_name parameter from input. </span>|
|<span class="hljs-string"> network_subgraph </span>|<span class="hljs-string"> list&lt; [GraphRelation](#rest.GraphRelation) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> list of graph relations (edges) which make up a connected subgraph of the ebook graph, representing the business network and its elements. each item here contains full descriptions of the relation&amp;#39;s source and destination node, so the caller can reconstruct the subgraph. COMPATIBILITY NOTE: this proto message differs slightly from neo4j driver object schemas, so some conversion is required. see comments on GraphRelation definition. </span>|
|<span class="hljs-string"> total_bes </span>|<span class="hljs-string"> [int32](#int32) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> total count of business entities which appear in this network (including both corporations and limited-partnerships/llc&amp;#39;s). </span>|
|<span class="hljs-string"> top_bes </span>|<span class="hljs-string"> list&lt; [NormalizedName](#rest.NormalizedName) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> normalized names of most-connected business in the network. (SOS_Corp or SOS_LP nodes with highest degree). optional field \_\_typename is set, so caller can disambiguate between business types. returns 5 entries as of 2021/03/12. </span>|
|<span class="hljs-string"> top_owners </span>|<span class="hljs-string"> list&lt; [NormalizedName](#rest.NormalizedName) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> normalized names of owners-of-businesses most connected in the graph. (SOS_Owner nodes with matching network_id, with highest degree). optional field \_\_typename is NOT set. note: these owners can be individuals, or other businesses. returns 5 entries as of 2021/03/12. see SOS_Owner node / CalSOSOwnerData in graph/nodes.proto. </span>|
|<span class="hljs-string"> top_addrs </span>|<span class="hljs-string"> list&lt; [ReadableAddress](#rest.ReadableAddress) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> readable addresses which are the most well-connected in the graph. (Address_Unit nodes with matching network_id with highest degree). TODO: describe what causes these addresses to be considered for inclusion. clarify if they&amp;#39;re physical addresses of component businesses/owners of the network, or real-estate properties held by the network. returns 5 entries as of 2021/03/12. see Address_Unit node / AddressUnitData in graph/nodes.proto. </span>|






<span class="hljs-variable">&lt;a name=&quot;rest.GetNetworkParcelRequest&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### GetNetworkParcelRequest</span>


given a network_id and a parcel block_lot which is under that network&#x27;s
influence, return a view of the network centered around that parcel.

rest api v1 route: &#x27;/api/network/parcel/:network_id/:search_string&#x27;

|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> context </span>|<span class="hljs-string"> [RequestContext](#rest.RequestContext) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> request context, see above. </span>|
|<span class="hljs-string"> network_id </span>|<span class="hljs-string"> [int64](#int64) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> the network_id of the business network we want to retreieve. See BusinessNetworkIdentifier for semantics. required. </span>|
|<span class="hljs-string"> search_string </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> the block_lot (unique key) of a parcel which is associated with this network. </span>|






<span class="hljs-variable">&lt;a name=&quot;rest.GetNetworkParcelResponse&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### GetNetworkParcelResponse</span>

given a network_id and a parcel block_lot which is under that network&#x27;s
influence, return a view of the network centered around that parcel.

rest api v1 route: &#x27;/api/network/parcel/:network_id/:search_string&#x27;


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> addr </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> string representing the parcel&amp;#39;s street address, including street number, street name and suffix, and unit number. The parcel is assumed to be within SF city/county limits. See &amp;#39;addr&amp;#39; in A_Parcel node as described by SFAssessorParcelData in graph/nodes.proto. </span>|
|<span class="hljs-string"> network_subgraph </span>|<span class="hljs-string"> list&lt; [GraphRelation](#rest.GraphRelation) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> list of graph relations (edges) which make up a connected subgraph of the ebook graph, representing the business network and its elements. each item here contains full descriptions of the relation&amp;#39;s source and destination node, so the caller can reconstruct the subgraph. COMPATIBILITY NOTE: this proto message differs slightly from neo4j driver object schemas, so some conversion is required. see comments on GraphRelation definition. </span>|
|<span class="hljs-string"> total_bes </span>|<span class="hljs-string"> [int32](#int32) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> total count of business entities which appear in this network (including both corporations and limited-partnerships/llc&amp;#39;s). </span>|
|<span class="hljs-string"> top_bes </span>|<span class="hljs-string"> list&lt; [NormalizedName](#rest.NormalizedName) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> see GetNetworkBusinessEntityResponse above. </span>|
|<span class="hljs-string"> top_owners </span>|<span class="hljs-string"> list&lt; [NormalizedName](#rest.NormalizedName) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> see GetNetworkBusinessEntityResponse above. </span>|
|<span class="hljs-string"> top_addrs </span>|<span class="hljs-string"> list&lt; [ReadableAddress](#rest.ReadableAddress) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> see GetNetworkBusinessEntityResponse above. </span>|






<span class="hljs-variable">&lt;a name=&quot;rest.GetParcelDetailsRequest&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### GetParcelDetailsRequest</span>

get details about a parcel from sf assessor records, keyed by block_lot.

rest api v1 route: &#x27;api/parcel/:block_lot/details&#x27;


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> context </span>|<span class="hljs-string"> [RequestContext](#rest.RequestContext) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> request context, see above. </span>|
|<span class="hljs-string"> block_lot </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> block lot identifier of a parcel, as is appears in sf assessor records. exact string match only. </span>|






<span class="hljs-variable">&lt;a name=&quot;rest.GetParcelDetailsResponse&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### GetParcelDetailsResponse</span>

get details about a parcel from sf assessor records, keyed by block_lot.

rest api v1 route: &#x27;api/parcel/:block_lot/details&#x27;


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> parcel_details </span>|<span class="hljs-string"> [ParcelDetails](#rest.ParcelDetails) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> detailed info about the parcel with the requested block_lot (location, physical properties, etc.). </span>|






<span class="hljs-variable">&lt;a name=&quot;rest.GetParcelEvictionsRequest&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### GetParcelEvictionsRequest</span>

get details about evictions which occurred at a given parcel, keyed by
block_lot.

rest api v1 route: &#x27;api/parcel/:block_lot/evictions&#x27;


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> context </span>|<span class="hljs-string"> [RequestContext](#rest.RequestContext) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> request context, see above. </span>|
|<span class="hljs-string"> block_lot </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> block lot identifier of a parcel, as is appears in sf assessor records. exact string match only. </span>|






<span class="hljs-variable">&lt;a name=&quot;rest.GetParcelEvictionsResponse&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### GetParcelEvictionsResponse</span>

get details about evictions which occurred at a given parcel, keyed by
block_lot.

rest api v1 route: &#x27;api/parcel/:block_lot/evictions&#x27;


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> evictions </span>|<span class="hljs-string"> list&lt; [EvictionMetadata](#rest.EvictionMetadata) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> info about evictions believed to have occurred on the propert(y/ies) on the parcel with the requested block_lot. </span>|






<span class="hljs-variable">&lt;a name=&quot;rest.GetParcelNetworksRequest&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### GetParcelNetworksRequest</span>


get info about real-estate business networks believed to have a stake in
this parcel, as well as other parcels which those networks may have a
vested interest in.
NOTE: performance bottleneck, invoke with caution.

rest api v1 route: &#x27;api/parcel/:block_lot/networks&#x27;

|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> context </span>|<span class="hljs-string"> [RequestContext](#rest.RequestContext) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> request context, see above. </span>|
|<span class="hljs-string"> block_lot </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> block lot identifier of a parcel, as is appears in sf assessor records. exact string match only. </span>|






<span class="hljs-variable">&lt;a name=&quot;rest.GetParcelNetworksResponse&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### GetParcelNetworksResponse</span>

get info about real-estate business networks believed to have a stake in
this parcel, as well as other parcels which those networks may have a
vested interest in.
NOTE: performance bottleneck, invoke with caution.

rest api v1 route: &#x27;api/parcel/:block_lot/networks&#x27;

|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> networks </span>|<span class="hljs-string"> map&lt; string, [NetworkSummary](#rest.NetworkSummary) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> info about real-estate business networks which may have a financial interest in this parcel. keys: network_id&amp;#39;s, as they appear in BusinessNetworkIdentifier messages. </span>|






<span class="hljs-variable">&lt;a name=&quot;rest.GetParcelOwnersRequest&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### GetParcelOwnersRequest</span>


get info about individuals, businesses, and/or trusts believed to own the
parcel in full or in part.

rest api v1 route: &#x27;api/parcel/:block_lot/owners&#x27;

|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> context </span>|<span class="hljs-string"> [RequestContext](#rest.RequestContext) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> request context, see above. </span>|
|<span class="hljs-string"> block_lot </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> block lot identifier of a parcel, as is appears in sf assessor records. exact string match only. </span>|






<span class="hljs-variable">&lt;a name=&quot;rest.GetParcelOwnersResponse&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### GetParcelOwnersResponse</span>

get info about individuals, businesses, and/or trusts believed to own the
parcel in full or in part.

rest api v1 route: &#x27;api/parcel/:block_lot/owners&#x27;


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> owners </span>|<span class="hljs-string"> list&lt; [ParcelOwner](#rest.ParcelOwner) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> individuals, businesses, trusts, etc., which are believed to own the requested parcel in full or in part. </span>|






<span class="hljs-variable">&lt;a name=&quot;rest.GetParcelRequest&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### GetParcelRequest</span>

deprecated -- legacy endpoint, prefer more specific parcel calls below.

rest api v1 route: &#x27;api/parcel/:block_lot&#x27;


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> context </span>|<span class="hljs-string"> [RequestContext](#rest.RequestContext) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> request context, see above. </span>|
|<span class="hljs-string"> block_lot </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> block lot identifier of a parcel, as is appears in sf assessor records. exact string match only. </span>|






<span class="hljs-variable">&lt;a name=&quot;rest.GetParcelResponse&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### GetParcelResponse</span>

deprecated -- legacy endpoint, prefer more specific parcel calls below.

rest api v1 route: &#x27;api/parcel/:block_lot&#x27;


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> parcel_details </span>|<span class="hljs-string"> [ParcelDetails](#rest.ParcelDetails) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> detailed info about the parcel (location, physical properties, etc.). </span>|
|<span class="hljs-string"> owners </span>|<span class="hljs-string"> list&lt; [ParcelOwner](#rest.ParcelOwner) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> individuals, businesses, trusts, etc., which are believed to own the parcel in full or in part. </span>|
|<span class="hljs-string"> evictions </span>|<span class="hljs-string"> list&lt; [EvictionMetadata](#rest.EvictionMetadata) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> info about evictions believed to have occurred on the propert(y/ies) on this parcel. </span>|
|<span class="hljs-string"> networks </span>|<span class="hljs-string"> map&lt; string, [NetworkSummary](#rest.NetworkSummary) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> info about real-estate business networks which may have a financial interest in this parcel. keys: network_id&amp;#39;s, as they appear in BusinessNetworkIdentifier messages. </span>|









<span class="hljs-variable">&lt;a name=&quot;rest.ParcelSearchRequest&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### ParcelSearchRequest</span>

used for search feature on front page. performs prefix-based lookup on sf
assessor parcel records on lot-level address strings.

rest api v1 route: &#x27;/api/parcel-search/:search&#x27;


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> context </span>|<span class="hljs-string"> [RequestContext](#rest.RequestContext) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> request context, see above. </span>|
|<span class="hljs-string"> search </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> query string, to be interpreted as an address prefix. todo: describe constraints, normalization, etc. </span>|






<span class="hljs-variable">&lt;a name=&quot;rest.ParcelSearchResponse&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### ParcelSearchResponse</span>

used for search feature on front page. performs prefix-based lookup on sf
assessor parcel records on lot-level address strings.

rest api v1 route: &#x27;/api/parcel-search/:search&#x27;


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> block_lot </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> the block_lot of this parcel in sf assessor records. unique key in ebook rest api. </span>|
|<span class="hljs-string"> addr </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> human-readable address of the real-estate parcel in sf assessor records. TODO: describe normalization, etc. </span>|






<span class="hljs-variable">&lt;a name=&quot;rest.RequestContext&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### RequestContext</span>
placeholder for info about the incoming request (session id, request_id,
permissions, etc.)

todo: populate with relevant fields.





 

 

 





<span class="hljs-variable">&lt;a name=&quot;business.proto&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>
<span class="hljs-variable">&lt;p align=&quot;right&quot;&gt;</span><span class="hljs-variable">&lt;a href=&quot;#top&quot;&gt;</span>Top<span class="hljs-variable">&lt;/a&gt;</span><span class="hljs-variable">&lt;/p&gt;</span>

<span class="hljs-comment">## business.proto</span>
rest/business.proto

message definitions for business entities (corporations and
limited-partnerships/llc&amp;<span class="hljs-comment">#39;s) as they appear in the ebook api.</span>


<span class="hljs-variable">&lt;a name=&quot;rest.CorporationDetails&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### CorporationDetails</span>



|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> transaction_date </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> transaction date of the document which established this corporation, according to the california secretary of state business registry. format: &amp;#39;CCMMYYDD&amp;#39;. </span>|
|<span class="hljs-string"> corporation_number </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> an 8 digit corporate identification number, from the california secretary of state business registry. </span>|
|<span class="hljs-string"> incorporation_date </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> date on which this corporation was incorporated, according to the california secretary of state business registry. format: &amp;#39;CCYYMMDD&amp;#39; </span>|
|<span class="hljs-string"> corporation_status </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> status of the corporation, via calif. sec of state business records. NOTE: these are human-readable labels, unlike equivalent query-proto field. TODO: list the labels here. TODO: replace with a more flexible and informative representation. </span>|
|<span class="hljs-string"> corporation_type </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> describes the legal process used to establish this business, according to calif. sec of state business records. NOTE: these are human-readable labels, unlike equivalent query-proto field. TODO: list the labels here. TODO: replace with a more flexible and informative representation. </span>|
|<span class="hljs-string"> corporation_tax_base </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> tax base trype of the corporate, according to calif. sec of state records. NOTE: these are human-readable labels, unlike equivalent query-proto field. TODO: list the labels here. TODO: replace with a more flexible and informative representation. </span>|
|<span class="hljs-string"> corporation_classification </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> additional corporate classifications which may convey special status, such as &amp;#39;religious&amp;#39; or &amp;#39;agricultural cooperative&amp;#39; according to calif. sec. of state business entity records. NOTE: these are human-readable labels, unlike equivalent query-proto field. TODO: list the labels here. TODO: replace with a more flexible and informative representation. </span>|
|<span class="hljs-string"> term_expiration_date </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> limited term expiration date. TODO: explain what this means. format: &amp;#39;CCYYMMDD&amp;#39; </span>|
|<span class="hljs-string"> ftb_suspension_status </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> describes whether this corporation is in good standing with the california franchise tax board (ftb). NOTE: these are human-readable labels, unlike equivalent query-proto field. TODO: list the labels here. TODO: replace with a more flexible and informative representation. </span>|
|<span class="hljs-string"> ftb_suspension_date </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> if this corporation has been subject to action by the franchise tax board as described in &amp;#39;ftb_suspension_status&amp;#39;, then this field contains a string representation of the date of that action. format: &amp;#39;CCYYMMDD&amp;#39; </span>|
|<span class="hljs-string"> so_file_number </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> statement of information file number, per calif sec of state records. </span>|
|<span class="hljs-string"> so_file_date </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> last complete statement (of information?) file date. format: &amp;#39;CCYYMMDD&amp;#39; </span>|
|<span class="hljs-string"> corporation_name </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> name of corporation, directly from calif. sec. of state records without normalization. </span>|
|<span class="hljs-string"> co_name </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> &amp;#39;care of&amp;#39; name, meaning the &amp;#39;c/o&amp;#39; addressee which should be included on mail intended for the corporation. </span>|
|<span class="hljs-string"> agent_name </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> name of agent of process, as it appears on mailing address. </span>|
|<span class="hljs-string"> agent_address_line_1 </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> mailing address for agent of process, line 1. </span>|
|<span class="hljs-string"> agent_address_line_2 </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> mailing address for agent of process, line 2. </span>|
|<span class="hljs-string"> agent_address_city </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> city component of agent of process&amp;#39;s mailing address. </span>|
|<span class="hljs-string"> agent_address_state_county </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> TODO: clarify what this means. is it state or county? or both???? </span>|
|<span class="hljs-string"> agent_address_zip_code </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> TODO: clarify whether these are 5-digit or 9-digit postal codes. </span>|
|<span class="hljs-string"> state_or_foreign_country </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> if the corporation is not &amp;#39;domestic&amp;#39; (internal to calif.), then this field specified a u.s. state other than california, or a country outside the u.s., where this corporation originated. </span>|
|<span class="hljs-string"> c_id </span>|<span class="hljs-string"> [int64](#int64) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> business entity component id, generated by the ebook data pipeline via connected component analysis. see BusinessNetworkIdentifier in network_ids.proto for details. </span>|
|<span class="hljs-string"> network_id </span>|<span class="hljs-string"> [int64](#int64) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> parcel ownership network component id, generated by the ebook data pipeline via connected component analysis. see BusinessNetworkIdentifier in network_ids.proto for details. </span>|






<span class="hljs-variable">&lt;a name=&quot;rest.LimitedBusinessDetails&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### LimitedBusinessDetails</span>



|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> jurisdiction_llc </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> llc only: state or county for formation of foreign llc. </span>|
|<span class="hljs-string"> llc_management_code </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> llc only: management structure. NOTE: these are human-readable labels, unlike equivalent query-proto field. TODO: list the labels here. TODO: this approach lends itself poorly to localization and is cumbersome to use in the client. replace with a more flexible and informative representation. </span>|
|<span class="hljs-string"> llc_type_of_business </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> llc only: type of business. TODO: provide examples. </span>|
|<span class="hljs-string"> file_number </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> the filing number of the business entity, which is derived from the date on which its filing paperwork was filed. the number is presented as a string, with the format described below: format: &amp;#39;CCYYJJJN9999&amp;#39; CCYY = century and year JJJ = julian day of year N = record type: 0 = lp record 1 = llc record 9999 = sequence number </span>|
|<span class="hljs-string"> file_date </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> date of original filing for this business. represents the same calendar date as the date component of file_number, but follows a different format. format: &amp;#39;CCYYMMDD&amp;#39; </span>|
|<span class="hljs-string"> status </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> identifies current status of lp/llc, as represented in calif. sec. of state business entity records. NOTE: these are human-readable labels, unlike equivalent query-proto field. TODO: list the labels here. TODO: this approach lends itself poorly to localization and is cumbersome to use in the client. replace with a more flexible and informative representation. </span>|
|<span class="hljs-string"> filing_type </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> filing type (foreign or domestic) of this lp or llc, as represented in calif. sec. of state business entity registry. NOTE: these are human-readable labels, in contrast to the equivalent query-proto field&amp;#39;s abbreviations. TODO: this approach lends itself poorly to localization and is cumbersome to use in the client. replace with a more flexible and informative representation. TODO: list the labels here. </span>|
|<span class="hljs-string"> name </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> the raw, non-normalized name of this calif. limited partnership or llc, as represented in calif. sec. of state business entity registry. </span>|
|<span class="hljs-string"> jurisdiction </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> state or country of formation for foreign limited partnerships. </span>|
|<span class="hljs-string"> agent_name </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> name of agent of process, as it appears on mailing address. </span>|
|<span class="hljs-string"> agent_address_1 </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> mailing address for agent of process, line 1. CAUTION: naming convention differs from similar field in corp details. </span>|
|<span class="hljs-string"> agent_address_2 </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> mailing address for agent of process, line 2. CAUTION: naming convention differs from similar field in corp details. </span>|
|<span class="hljs-string"> agent_city </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> city component of agent of process&amp;#39;s mailing address. CAUTION: naming convention differs from similar field in corp details. </span>|
|<span class="hljs-string"> agent_state </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> component of agent of process&amp;#39;s mailing address. CAUTION: naming convention differs from similar field in corp details. </span>|
|<span class="hljs-string"> agent_zip </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> todo: clarify whether these are 5-digit or 9-digit postal codes. CAUTION: naming convention differs from similar field in corp details. </span>|
|<span class="hljs-string"> term </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> cause of termination, if this lp/llc has been terminated. TODO: add examples. </span>|
|<span class="hljs-string"> c_id </span>|<span class="hljs-string"> [int64](#int64) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> business entity component id, generated by the ebook data pipeline via connected component analysis. see BusinessNetworkIdentifier in network_ids.proto for details. </span>|
|<span class="hljs-string"> network_id </span>|<span class="hljs-string"> [int64](#int64) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> parcel ownership network component id, generated by the ebook data pipeline via connected component analysis. see BusinessNetworkIdentifier in network_ids.proto for details. </span>|





 

 

 

 



<span class="hljs-variable">&lt;a name=&quot;eviction.proto&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>
<span class="hljs-variable">&lt;p align=&quot;right&quot;&gt;</span><span class="hljs-variable">&lt;a href=&quot;#top&quot;&gt;</span>Top<span class="hljs-variable">&lt;/a&gt;</span><span class="hljs-variable">&lt;/p&gt;</span>

<span class="hljs-comment">## eviction.proto</span>
rest/eviction.proto

messages representing evictions and related metadata in ebook api.


<span class="hljs-variable">&lt;a name=&quot;rest.EvictionMetadata&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### EvictionMetadata</span>
fields describing the eviction itself:


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> evict_id </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> unique id for the eviction in ebook api. this is typically derived from sf rent board&amp;#39;s petition id, but is *NOT* equivalent. DO NOT USE THIS FOR DIRECT COMPARISON TO SFRB RECORDS. TODO: replace this with a less confusing opaque id, and add a field which accurately presents the eviction&amp;#39;s sf rent board petition id (primary key in rent board records). </span>|
|<span class="hljs-string"> evict_date </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> date on which this eviction took effect, according to public records. format: &amp;#39;CCYYMMDD&amp;#39;. </span>|
|<span class="hljs-string"> type </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> type of eviction, for example &amp;#34;Buyout Declaration&amp;#34; or &amp;#34;Ellis Act Withdrawal&amp;#34;. todo: document supported values for this field. </span>|
|<span class="hljs-string"> ellis_evictor </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> attributed evictors according to ellis act withdrawal records. only populated for evictions of type &amp;#34;Ellis Act Withdrawal&amp;#34; TODO: deprecate this, replace with a well-structured repeated field. this is a vestige of v1 data pipeline, and it contains a comma-separated list of names that&amp;#39;s really not worth parsing. </span>|
|<span class="hljs-string"> multiple_sales_matches </span>|<span class="hljs-string"> [bool](#bool) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> no one knows what this field means. TODO: deprecate and remove. </span>|
|<span class="hljs-string"> block_lot </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> block_lot of the parcel where this eviction tool place. uniquely specifies a parcel in sf assessor records. unique key for parcel in ebook api. </span>|
|<span class="hljs-string"> units </span>|<span class="hljs-string"> [double](#double) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> num. units at the parcel where this eviction took place (via assessor records). </span>|
|<span class="hljs-string"> lat </span>|<span class="hljs-string"> [double](#double) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> latitude (in degrees) of a point within the boundaries of the parcel where this eviction took place. </span>|
|<span class="hljs-string"> long </span>|<span class="hljs-string"> [double](#double) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> longitude (in degrees) of a point within the boundaries of the parcel where this eviction took place. </span>|
|<span class="hljs-string"> addr </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> street address of the parcel where this eviction took place (via assessor records). see &amp;#39;addr&amp;#39; details in parcel.proto </span>|
|<span class="hljs-string"> neighborhood </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> name of the neighorhood that encompasses the parcel where this eviction took place (via assessor records). see details in parcel.proto </span>|
|<span class="hljs-string"> multiple_addr_matches </span>|<span class="hljs-string"> [bool](#bool) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> no one knows what this means. TODO: deprecate and remove. </span>|
|<span class="hljs-string"> name </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> only set when this eviction is part of a location-based query (ex: neighborhood lookup). when set, contains the name of an attributed evictor, or &amp;#34;Unknown&amp;#34; if there are no attributed evictors. when this message is part of a business-info query result, name is unset. TODO: deprecate and remove this, it&amp;#39;s not helpful and the name is seriously confusing. </span>|
|<span class="hljs-string"> linked_be </span>|<span class="hljs-string"> [BusinessNetworkIdentifier](#rest.BusinessNetworkIdentifier) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> contains id&amp;#39;s used to refer to a business holding network. only set when eviction message is part of a location-based query (ex: lookup by neighborhood). unset when this message appears in a Corporation / Limited Business result. TODO: either standardize this or remove it. </span>|





 

 

 

 



<span class="hljs-variable">&lt;a name=&quot;graph_util.proto&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>
<span class="hljs-variable">&lt;p align=&quot;right&quot;&gt;</span><span class="hljs-variable">&lt;a href=&quot;#top&quot;&gt;</span>Top<span class="hljs-variable">&lt;/a&gt;</span><span class="hljs-variable">&lt;/p&gt;</span>

<span class="hljs-comment">## graph_util.proto</span>
rest/graph_util.proto

contains helper messages for describing neo4j graphs.


<span class="hljs-variable">&lt;a name=&quot;rest.GraphNode&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### GraphNode</span>
representation of a node in the graph, including internal details
particular to the graph&amp;<span class="hljs-comment">#39;s instantiation.</span>

based on the json schema of neo4j data driver&amp;<span class="hljs-comment">#39;s query results.</span>


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> identity </span>|<span class="hljs-string"> [int64](#int64) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> internal graph db id for this node. </span>|
|<span class="hljs-string"> labels </span>|<span class="hljs-string"> list&lt; [string](#string) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> the node types that this node has. in our graph, nodes always have a single type, as of 2021/03/12, but this may change in the future. </span>|
|<span class="hljs-string"> properties_json </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> a json string representing a map of this node&amp;#39;s properties, where the keys are the property names and the values are strings, numbers, or objects. NOTE: this field does not appear in the response objects returned by neo4j-driver. in the neo4j driver&amp;#39;s response, &amp;#39;properties&amp;#39; is a plain object. this is convenient for the programming api, but it means that the driver&amp;#39;s query response can never be fully-type-safely specified as proto. this is because the schema of &amp;#39;properties&amp;#39; is unpredictable (determined by the contents of the db). you could choose to represent it as a map of strings/bytes/Any/etc., but the native json representation of the proto wouldn&amp;#39;t match the actual neo4j driver&amp;#39;s response. since we can&amp;#39;t acheive perfect compatibility, the simplest strategy is to encode the &amp;#39;properties&amp;#39; object as json. callers should &amp;#39;JSON.parse&amp;#39; the value of &amp;#39;properties_json&amp;#39; into &amp;#39;properties&amp;#39; to achieve compatibility with the neo4j driver api. similarly, callers should &amp;#39;JSON.stringify&amp;#39; the &amp;#39;properties&amp;#39; value of a neo4j driver response into &amp;#39;properties_json&amp;#39; to allow encoding as proto. </span>|
|<span class="hljs-string"> properties </span>|<span class="hljs-string"> [bytes](#bytes) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> **Deprecated.** see above. the neo4j-driver object equivalent uses the name &amp;#39;properties&amp;#39;; to make conversion code clearer, don&amp;#39;t reuse that name. </span>|






<span class="hljs-variable">&lt;a name=&quot;rest.GraphRelation&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### GraphRelation</span>
representation of a relation (edge) in the graph, including internal details
particular to the graph&amp;<span class="hljs-comment">#39;s instantiation. based on the js obj schema of</span>
neo4j-driver&amp;<span class="hljs-comment">#39;s query results.</span>

NOTE: a GraphRelation as described here contains the complete set of info
for both nodes that it connects! that means that storing a graph as a list
of these GraphRelation objects is inefficient, because the same node may be
described many times (once for each connecting edge).


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> start </span>|<span class="hljs-string"> [GraphNode](#rest.GraphNode) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> origin node of the relation. </span>|
|<span class="hljs-string"> end </span>|<span class="hljs-string"> [GraphNode](#rest.GraphNode) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> destination node of the relation. NOTE: as of 2021/03/12, edges are treated as though they bidirectional in ebook graph analysis. </span>|
|<span class="hljs-string"> type </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> the relation/edge&amp;#39;s type in the graph (&amp;#34;ENTITY_OWNED_BY&amp;#34;, etc.). </span>|





 

 

 

 



<span class="hljs-variable">&lt;a name=&quot;network.proto&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>
<span class="hljs-variable">&lt;p align=&quot;right&quot;&gt;</span><span class="hljs-variable">&lt;a href=&quot;#top&quot;&gt;</span>Top<span class="hljs-variable">&lt;/a&gt;</span><span class="hljs-variable">&lt;/p&gt;</span>

<span class="hljs-comment">## network.proto</span>
rest/network.proto

messages representing real-estate business networks and their holdings in
the ebook api.


<span class="hljs-variable">&lt;a name=&quot;rest.NetworkSummary&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### NetworkSummary</span>
top-level overview of a real-estate network. this is the network view used
in the &amp;<span class="hljs-comment">#39;parcel&amp;#39; rest endpoints.</span>

TODO: add a network_id field for easy identification in client.


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> searched_mail_address </span>|<span class="hljs-string"> list&lt; [string](#string) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> mailing addresses which may identify this network. this is *NOT* an exhaustive list of addresses within the network. </span>|
|<span class="hljs-string"> related_parcels </span>|<span class="hljs-string"> list&lt; [NetworkedParcelSummary](#rest.NetworkedParcelSummary) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> info about parcels which may be related via both being financial interests of this real-estate business network. TODO: remove this, replace with just the id&amp;#39;s and perhaps address. the client can retrieve parcel details if needed. &amp;#39;possible_networks&amp;#39; may be a field we need to expose through other means. </span>|





 

 

 

 



<span class="hljs-variable">&lt;a name=&quot;network_ids.proto&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>
<span class="hljs-variable">&lt;p align=&quot;right&quot;&gt;</span><span class="hljs-variable">&lt;a href=&quot;#top&quot;&gt;</span>Top<span class="hljs-variable">&lt;/a&gt;</span><span class="hljs-variable">&lt;/p&gt;</span>

<span class="hljs-comment">## network_ids.proto</span>
rest/network_ids.proto

messages representing network id&amp;<span class="hljs-comment">#39;s and other identifier structs used in</span>
ebook api.


<span class="hljs-variable">&lt;a name=&quot;rest.BusinessNetworkIdentifier&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### BusinessNetworkIdentifier</span>
id&amp;<span class="hljs-comment">#39;s used to refer to a real-estate holding network, as modeled by</span>
analysis of the calif. sec. of state business registry.

see the developer guide for a detailed description of the evictorbook&amp;<span class="hljs-comment">#39;s</span>
network connection methodology in the section &amp;<span class="hljs-comment">#34;Network Connection Method -</span>
Detailed &amp;gt; During DB Creation&amp;<span class="hljs-comment">#34;.</span>

c_id assignment is described in step &amp;<span class="hljs-comment">#39;I&amp;#39; of that section and network_id</span>
assignment is described in step &amp;<span class="hljs-comment">#39;III&amp;#39;.</span>


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> \_\_typename </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> type of business record in ebook datastore (&amp;#34;SOS\_LP&amp;#34;, &amp;#34;SOS\_Corp&amp;#34;) from which this business information was extracted. </span>|
|<span class="hljs-string"> network_id </span>|<span class="hljs-string"> [int64](#int64) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> business network id of this business in ebook datastore, as inferred by graph analysis. see graph schema documentation for details. </span>|
|<span class="hljs-string"> c_id </span>|<span class="hljs-string"> [int64](#int64) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> connected component id of this business in ebook datastore, as inferred by graph analysis. all businesses with the same c_id must also have the same network_id, though two businesses with the same network_id may have different c_id&amp;#39;s. see graph documentation and developer guide for details. </span>|






<span class="hljs-variable">&lt;a name=&quot;rest.NetworkLocationInfo&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### NetworkLocationInfo</span>
id and location characteristics of a real-estate business network.


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> addr_readable </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> an address in the ebook datastore where the central owning entity of a real-estate business network is believed to be located. </span>|
|<span class="hljs-string"> network_id </span>|<span class="hljs-string"> [int64](#int64) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> network id of the real-estate business network believed to be headquartered at addr_readable. </span>|





 

 

 

 



<span class="hljs-variable">&lt;a name=&quot;parcel.proto&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>
<span class="hljs-variable">&lt;p align=&quot;right&quot;&gt;</span><span class="hljs-variable">&lt;a href=&quot;#top&quot;&gt;</span>Top<span class="hljs-variable">&lt;/a&gt;</span><span class="hljs-variable">&lt;/p&gt;</span>

<span class="hljs-comment">## parcel.proto</span>
rest/parcel.proto

parcel-related messages as they appear in ebook api v1 responses.


<span class="hljs-variable">&lt;a name=&quot;rest.NetworkedParcelSummary&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### NetworkedParcelSummary</span>
contextual info about a parcel, in relation to a particular real-estate
business network. see NetworkSummary in rest/network.proto for usage.

///////////////////////////
 metadata about parcel:
///////////////////////////


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> block_lot </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> block_lot of the parcel in assessor records. primary key in ebook api. </span>|
|<span class="hljs-string"> addr </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> address of the parcel, as derived from sf assessor records. </span>|
|<span class="hljs-string"> num_evictions </span>|<span class="hljs-string"> [int32](#int32) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> total amount of evictions believed to have occurred at the networked property, which appear in ebook&amp;#39;s datastore. no bounds on eviction date. </span>|
|<span class="hljs-string"> units </span>|<span class="hljs-string"> [int32](#int32) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> number of units that the relevant parcel consists of, according to sf city and county assessor records. for multi-building properties, this is the sum of all units among buildings on the property. </span>|
|<span class="hljs-string"> lat </span>|<span class="hljs-string"> [double](#double) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> latitude (in degrees) of a point within the networked property. </span>|
|<span class="hljs-string"> long </span>|<span class="hljs-string"> [double](#double) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> longitude (in degrees) of a point within the networked property. </span>|
|<span class="hljs-string"> neighborhood </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> name of the neighborhood this parcel occupies. see parcel.proto for description of valid neighborhood names. </span>|
|<span class="hljs-string"> owners </span>|<span class="hljs-string"> list&lt; [NetworkedParcelSummary.NetworkedParcelOwner](#rest.NetworkedParcelSummary.NetworkedParcelOwner) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|
|<span class="hljs-string"> possible_networks </span>|<span class="hljs-string"> map&lt; string, [StringVector](#rest.StringVector) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> contains metadata about networks which this parcel may belong to. keys are network_id&amp;#39;s, as they appear in BusinessNetworkIdentifier msg&amp;#39;s. values are a list of strings representing mailing addresses which may identify a business in this network. !!! This is *NOT* an exhaustive list of addresses within the network. !!! COMPATIBILITY NOTE: in api 1.0 json representation, possible_networks is a json multimap. multimaps are not suported natively in proto, so we define a StringVector message to use as a replacement. NOTE: until clients are migrated away from json multimap, will support configuration flags to return json with original multimaps. see config flags in /server/rest/routes/dbRouteSetup.js. </span>|
|<span class="hljs-string"> connection_type </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> optional. when present, describes the provenance of the information in possible_networks. &amp;#34;NETWORK_EXACT&amp;#34;: possible_networks contains a single network, identified by mailing address info from the parcel&amp;#39;s recorded owner. &amp;#34;NETWORK_NONEXACT&amp;#34;: possible_networks contains one or more networks, considered &amp;#39;possible&amp;#39; matches based on indirect connections. &amp;#34;NON_NETWORK&amp;#34;: no network_id found, map contains placeholder network with key &amp;#34;NON_NETWORK&amp;#34; and single mailing address copied from parcel owner records. TODO: deprecate and replace with an enum. </span>|






<span class="hljs-variable">&lt;a name=&quot;rest.NetworkedParcelSummary.NetworkedParcelOwner&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### NetworkedParcelSummary.NetworkedParcelOwner</span>
individuals, businesses, or other legal entities believed to own the
networked parcel in whole or in part.


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> owner_name </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> owner of the networked parcel, as it appears in that parcel&amp;#39;s assessor records. </span>|
|<span class="hljs-string"> linked_be </span>|<span class="hljs-string"> [BusinessNetworkIdentifier](#rest.BusinessNetworkIdentifier) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> set only when this owner of the networked parcel is believed to be linked to a business entity/network. contains id&amp;#39;s for that linked business network. </span>|
|<span class="hljs-string"> ma_network_id </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> set when mailing_address is believed to also be the cental mailing address of a real-estate business network central business&amp;#39;s hq. in that case, it&amp;#39;s the network id of the business network headquartered at that address. </span>|
|<span class="hljs-string"> mailing_address </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> physical mailing address where the owner can be contacted, according to assessor records. </span>|








<span class="hljs-variable">&lt;a name=&quot;rest.ParcelBriefOwnershipInfo&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### ParcelBriefOwnershipInfo</span>
Summary of parcel info, with less information than ParcelDetails. Used in
business lookup calls to describe parcels owned by that business.


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> block_lot </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> &amp;#39;block_lot&amp;#39; identifier. unique key for a parcel in sf assessor records, and unique key for A_Parcel nodes in the database. </span>|
|<span class="hljs-string"> record_date </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> date listed on the documents recording ownership of the parcel. todo: describe behavior for parcels with multiple owners. format: CCYYMMDD </span>|
|<span class="hljs-string"> perc_owner </span>|<span class="hljs-string"> [double](#double) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> ownership percentage, of the assigned owner, expressed as an integer between 0 and 100, returned as a floating point number. </span>|
|<span class="hljs-string"> addr </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> a string representing the parcel&amp;#39;s street address, including street number, street name and suffix, and unit number. the parcel is assumed to be within sf city/county limits. </span>|
|<span class="hljs-string"> num_evictions </span>|<span class="hljs-string"> [int32](#int32) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> number of recorded evictions associated with this parcel in the ebook graph. </span>|
|<span class="hljs-string"> units </span>|<span class="hljs-string"> [double](#double) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> number of units that this parcel consists of, according to sf city and county assessor records. </span>|
|<span class="hljs-string"> lat </span>|<span class="hljs-string"> [double](#double) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> latitude, in degrees, of a point within this parcel&amp;#39;s boundaries. </span>|
|<span class="hljs-string"> long </span>|<span class="hljs-string"> [double](#double) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> longitude, in degrees, of a point within this parcel&amp;#39;s boundaries. </span>|
|<span class="hljs-string"> neighborhood </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> name of the neighborhood this parcel occupies. as of 2021/03/11, it&amp;#39;s assumed that all parcels are within sf city and county, so these are sf neighborhoods. values correspond to names of the neighborhood polygons described at: https://data.sfgov.org/Geographic-Locations-and-Boundaries/SF-Find-Neighborhoods/pty2-tcw4 </span>|






<span class="hljs-variable">&lt;a name=&quot;rest.ParcelDetails&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### ParcelDetails</span>
detailed info about a real-estate parcel from the sf assessor&amp;<span class="hljs-comment">#39;s office.</span>


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> yr_built </span>|<span class="hljs-string"> [int32](#int32) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> year in which the buildings on this real-estate parcel were first constructed. TODO: describe behavior for multi-building parcels. </span>|
|<span class="hljs-string"> addr </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> string containing parcel&amp;#39;s street address, including street number, street name and suffix, and unit number. parcel is assumed to be within sf city/county limits. notes from schema definition sheet: full address in the format of &amp;#34;ST_START_NO-ST_END_NO ST_NAME ST_TYPE (Unit UNIT)&amp;#34; (w/o end no if no address range, w/o parentheses if no unit) </span>|
|<span class="hljs-string"> block_lot </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> &amp;#39;block_lot&amp;#39; identifier. unique key for a parcel in sf assessor records, and unique key for A_Parcel nodes in the database. </span>|
|<span class="hljs-string"> lat </span>|<span class="hljs-string"> [double](#double) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> latitude in degrees of a point within this parcel&amp;#39;s boundaries. TODO: specify bounds. </span>|
|<span class="hljs-string"> long </span>|<span class="hljs-string"> [double](#double) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> longitude in degrees of a point within this parcel&amp;#39;s boundaries. TODO: specify bounds. </span>|
|<span class="hljs-string"> neighborhood </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> name of the neighborhood this parcel occupies. as of 2020/09/26, it&amp;#39;s assumed that all parcels are within sf city and county, so these are san francisco neighborhoods. neighborhoods assigned using sf polygons. names and polygon boundaries: https://data.sfgov.org/Geographic-Locations-and-Boundaries/SF-Find-Neighborhoods/pty2-tcw4 TODO: deprecate this field in favor of a NeighborhoodInfo struct or canonical neighborhood_id. </span>|
|<span class="hljs-string"> rent_controlled </span>|<span class="hljs-string"> [int32](#int32) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> rough assessment of this parcel&amp;#39;s rent-control status. 0 (default) if data unavailable to determine rent controlled status, 1 if likely rent controlled, 2 if doubtful that this is rent controlled TODO: replace with an enum. </span>|
|<span class="hljs-string"> prop_class_code </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> property class code, via sf assessor&amp;#39;s office. definitons: https://data.sfgov.org/Housing-and-Buildings/Reference-Assessor-Recorder-Property-Class-Codes/pa56-ek2h/data TODO: replace with an enum. </span>|
|<span class="hljs-string"> zone </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> i.d. for the zoning district this parcel occupies. sf zoning district definitions: https://sfplanninggis.org/pim/map.html?layers=Zoning%20Districts TODO: replace with an enum. </span>|
|<span class="hljs-string"> stories </span>|<span class="hljs-string"> [int32](#int32) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> how tall is the building on this parcel, in stories. TODO: behavior for multi-building parcels? </span>|
|<span class="hljs-string"> units </span>|<span class="hljs-string"> [int32](#int32) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> number of physical units within this logical real-estate parcel. </span>|
|<span class="hljs-string"> rooms </span>|<span class="hljs-string"> [int32](#int32) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> number of total rooms within buildings on this parcel (for multi-unit parcels, this is the sum of rooms among all units.) </span>|
|<span class="hljs-string"> beds </span>|<span class="hljs-string"> [int32](#int32) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> number of total bedrooms on this parcel (for multi-unit parcels, this is the sum of bedrooms among all units.) </span>|
|<span class="hljs-string"> assess_land_val </span>|<span class="hljs-string"> [int32](#int32) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> assessor valuation of the &amp;#39;land&amp;#39; base value, i.e. the parcel&amp;#39;s theoretical value if it had no buildings on it. </span>|
|<span class="hljs-string"> assess_imp_val </span>|<span class="hljs-string"> [int32](#int32) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> assessor valuation of the &amp;#39;improvement&amp;#39; done to the land via development, as of most recent assessment. units in u.s. dollars. </span>|
|<span class="hljs-string"> assess_val_date </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> date when the parcel&amp;#39;s value was last assessed. format: CCYYMMDD </span>|
|<span class="hljs-string"> update_date </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> date on which this parcel&amp;#39;s address was last updated, via assessor records. format: CCYYMMDD </span>|
|<span class="hljs-string"> curr_sales_price </span>|<span class="hljs-string"> [int32](#int32) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> TODO: document the provenance of this information, and when it is set. units in u.s. dollars. </span>|
|<span class="hljs-string"> curr_sales_date </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> TODO: document the provenance of this information, and when it is set. format: CCYYMMDD </span>|
|<span class="hljs-string"> parc_start_no </span>|<span class="hljs-string"> [int32](#int32) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> if the logical parcel occupies more than one street number, then this field contains the lowest street number in that range. if the logical parcel occupies only one street number, then this field contains that number. TODO: why no parc_end_no field? TODO: replace with a well-defined address message. </span>|
|<span class="hljs-string"> parc_street_name </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> main name part of the street/route name of the parcel&amp;#39;s address. (ex: &amp;#34;geary&amp;#34;, &amp;#34;first&amp;#34;, &amp;#34;taylor&amp;#34;, etc.) TODO: describe capitalization, stylization, etc. TODO: replace with a well-defined address message. </span>|
|<span class="hljs-string"> parc_street_type </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> street suffix (ex: &amp;#34;st&amp;#34;, &amp;#34;ln&amp;#34;) of the parcel&amp;#39;s address. TODO: describe capitalization, stylization, etc. TODO: replace with a well-defined address message. </span>|
|<span class="hljs-string"> parc_unit_no </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> unit or subpremise identifier. just the number or letter. TODO: replace with a well-defined address message. </span>|
|<span class="hljs-string"> parc_zip </span>|<span class="hljs-string"> [int32](#int32) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> five-digit u.s. postal code of the parcel&amp;#39;s address, as an integer. TODO: replace with a well-defined address message. </span>|






<span class="hljs-variable">&lt;a name=&quot;rest.ParcelOwner&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### ParcelOwner</span>
info about an individual, business, trust, or other legal entity which owns
a real-estate parcel, in full or in part.

<span class="hljs-symbol">*</span>NOT<span class="hljs-symbol">*</span> to be confused with a property corporation.  this message contains
only information that is accessible from assessor records for the relevant
parcel.


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> mailing_address </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> physical mailing address where this owner can be reached, according to assessor parcel records. </span>|
|<span class="hljs-string"> record_date </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> date on which this ownership was documented, according to assessor records. format: CCYYMMDD </span>|
|<span class="hljs-string"> perc_owner </span>|<span class="hljs-string"> [int32](#int32) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> ownership percentage, as a number between 0 and 100, as it appears in assessor records. a value of &amp;#39;100&amp;#39; indicates full ownership. a lesser value indicates partial ownership. note that for some parcels, we may have information about some but not all owners. do *NOT* rely on the ownership percentages for recorded owners adding up to 100. </span>|
|<span class="hljs-string"> owner_name </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> name of owner listed on parcel records from assessor&amp;#39;s office. todo: briefly describe how/whether this data was normalized. </span>|
|<span class="hljs-string"> linked_be </span>|<span class="hljs-string"> [BusinessNetworkIdentifier](#rest.BusinessNetworkIdentifier) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> id&amp;#39;s used to refer to a real-estate holding network, as modeled by analysis of the calif. sec. of state business registry. if &amp;#39;linked_be&amp;#39; is set to a non-empty message, then these id&amp;#39;s describe the real-estate business network which our data indicates this owner is affiliated with. </span>|





 

 

 

 





<span class="hljs-variable">&lt;a name=&quot;util.proto&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>
<span class="hljs-variable">&lt;p align=&quot;right&quot;&gt;</span><span class="hljs-variable">&lt;a href=&quot;#top&quot;&gt;</span>Top<span class="hljs-variable">&lt;/a&gt;</span><span class="hljs-variable">&lt;/p&gt;</span>

<span class="hljs-comment">## util.proto</span>



<span class="hljs-variable">&lt;a name=&quot;rest.NormalizedName&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### NormalizedName</span>
convience wrapper for normalized names.
semantically neutral, used in a variety of contexts.


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> name_norm </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> a normalized name, as it appears in the graph. </span>|
|<span class="hljs-string"> \_\_typename </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> optional. node type of the graph node where this name_norm was found. typically set for names of business entities, where there is a need to differentiate between SOS_Corp and SOS_LP. </span>|






<span class="hljs-variable">&lt;a name=&quot;rest.ReadableAddress&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### ReadableAddress</span>
convenience wrapper for human-readable addresses.
TODO: describe normalization, etc.


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> addr_readable </span>|<span class="hljs-string"> [string](#string) </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> readable/friendly representation of an address. normalization and internal structure may vary based on where this; check the containing message for details. </span>|






<span class="hljs-variable">&lt;a name=&quot;rest.StringVector&quot;&gt;</span><span class="hljs-variable">&lt;/a&gt;</span>

<span class="hljs-comment">### StringVector</span>
a simple wrapper around repeated strings.

this is useful because doesn&amp;<span class="hljs-comment">#39;t natively support multimaps (maps of lists).</span>
to accomodate, we instead create a map where values are StringVector
messages.

if you need a multimap of a different type, create another Vector message in this
file.


|<span class="hljs-string"> Field </span>|<span class="hljs-string"> Type </span>|<span class="hljs-string"> Label </span>|<span class="hljs-string"> Description </span>|
|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> ----------- </span>|
|<span class="hljs-string"> value </span>|<span class="hljs-string"> list&lt; [string](#string) &gt; </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> string values contained in this vector. </span>|





 

 

 

 



<span class="hljs-comment">## Scalar Value Types</span>

|<span class="hljs-string"> .proto Type </span>|<span class="hljs-string"> Notes </span>|<span class="hljs-string"> C++ </span>|<span class="hljs-string"> Java </span>|<span class="hljs-string"> Python </span>|<span class="hljs-string"> Go </span>|<span class="hljs-string"> C# </span>|<span class="hljs-string"> PHP </span>|<span class="hljs-string"> Ruby </span>|
|<span class="hljs-string"> ----------- </span>|<span class="hljs-string"> ----- </span>|<span class="hljs-string"> --- </span>|<span class="hljs-string"> ---- </span>|<span class="hljs-string"> ------ </span>|<span class="hljs-string"> -- </span>|<span class="hljs-string"> -- </span>|<span class="hljs-string"> --- </span>|<span class="hljs-string"> ---- </span>|
|<span class="hljs-string"> &lt;a name=&quot;double&quot; /&gt; double </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> double </span>|<span class="hljs-string"> double </span>|<span class="hljs-string"> float </span>|<span class="hljs-string"> float64 </span>|<span class="hljs-string"> double </span>|<span class="hljs-string"> float </span>|<span class="hljs-string"> Float </span>|
|<span class="hljs-string"> &lt;a name=&quot;float&quot; /&gt; float </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> float </span>|<span class="hljs-string"> float </span>|<span class="hljs-string"> float </span>|<span class="hljs-string"> float32 </span>|<span class="hljs-string"> float </span>|<span class="hljs-string"> float </span>|<span class="hljs-string"> Float </span>|
|<span class="hljs-string"> &lt;a name=&quot;int32&quot; /&gt; int32 </span>|<span class="hljs-string"> Uses variable-length encoding. Inefficient for encoding negative numbers – if your field is likely to have negative values, use sint32 instead. </span>|<span class="hljs-string"> int32 </span>|<span class="hljs-string"> int </span>|<span class="hljs-string"> int </span>|<span class="hljs-string"> int32 </span>|<span class="hljs-string"> int </span>|<span class="hljs-string"> integer </span>|<span class="hljs-string"> Bignum or Fixnum (as required) </span>|
|<span class="hljs-string"> &lt;a name=&quot;int64&quot; /&gt; int64 </span>|<span class="hljs-string"> Uses variable-length encoding. Inefficient for encoding negative numbers – if your field is likely to have negative values, use sint64 instead. </span>|<span class="hljs-string"> int64 </span>|<span class="hljs-string"> long </span>|<span class="hljs-string"> int/long </span>|<span class="hljs-string"> int64 </span>|<span class="hljs-string"> long </span>|<span class="hljs-string"> integer/string </span>|<span class="hljs-string"> Bignum </span>|
|<span class="hljs-string"> &lt;a name=&quot;uint32&quot; /&gt; uint32 </span>|<span class="hljs-string"> Uses variable-length encoding. </span>|<span class="hljs-string"> uint32 </span>|<span class="hljs-string"> int </span>|<span class="hljs-string"> int/long </span>|<span class="hljs-string"> uint32 </span>|<span class="hljs-string"> uint </span>|<span class="hljs-string"> integer </span>|<span class="hljs-string"> Bignum or Fixnum (as required) </span>|
|<span class="hljs-string"> &lt;a name=&quot;uint64&quot; /&gt; uint64 </span>|<span class="hljs-string"> Uses variable-length encoding. </span>|<span class="hljs-string"> uint64 </span>|<span class="hljs-string"> long </span>|<span class="hljs-string"> int/long </span>|<span class="hljs-string"> uint64 </span>|<span class="hljs-string"> ulong </span>|<span class="hljs-string"> integer/string </span>|<span class="hljs-string"> Bignum or Fixnum (as required) </span>|
|<span class="hljs-string"> &lt;a name=&quot;sint32&quot; /&gt; sint32 </span>|<span class="hljs-string"> Uses variable-length encoding. Signed int value. These more efficiently encode negative numbers than regular int32s. </span>|<span class="hljs-string"> int32 </span>|<span class="hljs-string"> int </span>|<span class="hljs-string"> int </span>|<span class="hljs-string"> int32 </span>|<span class="hljs-string"> int </span>|<span class="hljs-string"> integer </span>|<span class="hljs-string"> Bignum or Fixnum (as required) </span>|
|<span class="hljs-string"> &lt;a name=&quot;sint64&quot; /&gt; sint64 </span>|<span class="hljs-string"> Uses variable-length encoding. Signed int value. These more efficiently encode negative numbers than regular int64s. </span>|<span class="hljs-string"> int64 </span>|<span class="hljs-string"> long </span>|<span class="hljs-string"> int/long </span>|<span class="hljs-string"> int64 </span>|<span class="hljs-string"> long </span>|<span class="hljs-string"> integer/string </span>|<span class="hljs-string"> Bignum </span>|
|<span class="hljs-string"> &lt;a name=&quot;fixed32&quot; /&gt; fixed32 </span>|<span class="hljs-string"> Always four bytes. More efficient than uint32 if values are often greater than 2^28. </span>|<span class="hljs-string"> uint32 </span>|<span class="hljs-string"> int </span>|<span class="hljs-string"> int </span>|<span class="hljs-string"> uint32 </span>|<span class="hljs-string"> uint </span>|<span class="hljs-string"> integer </span>|<span class="hljs-string"> Bignum or Fixnum (as required) </span>|
|<span class="hljs-string"> &lt;a name=&quot;fixed64&quot; /&gt; fixed64 </span>|<span class="hljs-string"> Always eight bytes. More efficient than uint64 if values are often greater than 2^56. </span>|<span class="hljs-string"> uint64 </span>|<span class="hljs-string"> long </span>|<span class="hljs-string"> int/long </span>|<span class="hljs-string"> uint64 </span>|<span class="hljs-string"> ulong </span>|<span class="hljs-string"> integer/string </span>|<span class="hljs-string"> Bignum </span>|
|<span class="hljs-string"> &lt;a name=&quot;sfixed32&quot; /&gt; sfixed32 </span>|<span class="hljs-string"> Always four bytes. </span>|<span class="hljs-string"> int32 </span>|<span class="hljs-string"> int </span>|<span class="hljs-string"> int </span>|<span class="hljs-string"> int32 </span>|<span class="hljs-string"> int </span>|<span class="hljs-string"> integer </span>|<span class="hljs-string"> Bignum or Fixnum (as required) </span>|
|<span class="hljs-string"> &lt;a name=&quot;sfixed64&quot; /&gt; sfixed64 </span>|<span class="hljs-string"> Always eight bytes. </span>|<span class="hljs-string"> int64 </span>|<span class="hljs-string"> long </span>|<span class="hljs-string"> int/long </span>|<span class="hljs-string"> int64 </span>|<span class="hljs-string"> long </span>|<span class="hljs-string"> integer/string </span>|<span class="hljs-string"> Bignum </span>|
|<span class="hljs-string"> &lt;a name=&quot;bool&quot; /&gt; bool </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> bool </span>|<span class="hljs-string"> boolean </span>|<span class="hljs-string"> boolean </span>|<span class="hljs-string"> bool </span>|<span class="hljs-string"> bool </span>|<span class="hljs-string"> boolean </span>|<span class="hljs-string"> TrueClass/FalseClass </span>|
|<span class="hljs-string"> &lt;a name=&quot;string&quot; /&gt; string </span>|<span class="hljs-string"> A string must always contain UTF-8 encoded or 7-bit ASCII text. </span>|<span class="hljs-string"> string </span>|<span class="hljs-string"> String </span>|<span class="hljs-string"> str/unicode </span>|<span class="hljs-string"> string </span>|<span class="hljs-string"> string </span>|<span class="hljs-string"> string </span>|<span class="hljs-string"> String (UTF-8) </span>|
|<span class="hljs-string"> &lt;a name=&quot;bytes&quot; /&gt; bytes </span>|<span class="hljs-string"> May contain any arbitrary sequence of bytes. </span>|<span class="hljs-string"> string </span>|<span class="hljs-string"> ByteString </span>|<span class="hljs-string"> str </span>|<span class="hljs-string"> []byte </span>|<span class="hljs-string"> ByteString </span>|<span class="hljs-string"> string </span>|<span class="hljs-string"> String (ASCII-8BIT) </span>|

</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemaslegacyprotoreadme.md"><a href="#toc"><a name="server-schemas-legacy-proto-readme-md">server/schemas/legacy/proto/README.md</a></a></h2>
<pre><code><span class="hljs-comment"># Type definitions in the</span> <span class="hljs-comment">proto</span> <span class="hljs-comment">language</span><span class="hljs-string">.</span>

<span class="hljs-comment">## What on earth is</span> <span class="hljs-comment">&#x27;proto&#x27;?</span>

<span class="hljs-comment">TLDR:</span> <span class="hljs-comment">&#x27;protocol</span> <span class="hljs-comment">buffers&#x27;</span> <span class="hljs-comment">is</span> <span class="hljs-comment">a</span> <span class="hljs-comment">cross</span><span class="hljs-literal">-</span><span class="hljs-comment">platform</span><span class="hljs-string">,</span> <span class="hljs-comment">language</span><span class="hljs-literal">-</span><span class="hljs-comment">agnostic library for defining reusable</span> <span class="hljs-comment">schemas</span><span class="hljs-string">.</span> <span class="hljs-comment">&#x27;proto&#x27; is the language used to write those schema</span> <span class="hljs-comment">defitions</span><span class="hljs-string">.</span>

<span class="hljs-comment">&#x27;protocol</span> <span class="hljs-comment">buffers&#x27;</span> <span class="hljs-comment">consists</span> <span class="hljs-comment">of:</span>
  <span class="hljs-comment">1</span><span class="hljs-string">.</span> <span class="hljs-comment">A</span> <span class="hljs-comment">non</span><span class="hljs-literal">-</span><span class="hljs-comment">Turing</span><span class="hljs-literal">-</span><span class="hljs-comment">complete</span><span class="hljs-string">,</span> <span class="hljs-comment">self</span><span class="hljs-literal">-</span><span class="hljs-comment">describing</span> <span class="hljs-comment">&quot;data</span> <span class="hljs-comment">defintion</span> <span class="hljs-comment">language&quot;</span> <span class="hljs-comment">called</span> <span class="hljs-comment">&#x27;proto&#x27;</span>
  <span class="hljs-comment">2</span><span class="hljs-string">.</span> <span class="hljs-comment">A</span> <span class="hljs-comment">convenient</span><span class="hljs-string">,</span> <span class="hljs-comment">flexible</span><span class="hljs-string">,</span> <span class="hljs-comment">well</span><span class="hljs-literal">-</span><span class="hljs-comment">supported</span><span class="hljs-string">,</span> <span class="hljs-comment">platform</span><span class="hljs-literal">-</span><span class="hljs-comment">agnostic</span> <span class="hljs-comment">library</span> <span class="hljs-comment">called</span> <span class="hljs-comment">&#x27;protobuf&#x27;</span><span class="hljs-string">,</span> <span class="hljs-comment">widely available in many programming</span> <span class="hljs-comment">languages</span><span class="hljs-string">,</span> <span class="hljs-comment">which allow us to use those data definitions. (If that library doesn&#x27;t fit</span> <span class="hljs-comment">your</span> <span class="hljs-comment">requirements</span><span class="hljs-string">,</span> <span class="hljs-comment">there are a wide range</span> <span class="hljs-comment">of supplemental proto libraries as generally available open source</span> <span class="hljs-comment">software</span><span class="hljs-string">.</span><span class="hljs-comment">)</span>
  <span class="hljs-comment">3</span><span class="hljs-string">.</span> <span class="hljs-comment">A built-in compact data serialization</span> <span class="hljs-comment">format</span><span class="hljs-string">,</span> <span class="hljs-comment">fully integrated into the library</span><span class="hljs-string">,</span> <span class="hljs-comment">which you can use if you find it convenient</span><span class="hljs-string">.</span> <span class="hljs-comment">If the compact format doesn&#x27;t</span> <span class="hljs-comment">fit</span> <span class="hljs-comment">your</span> <span class="hljs-comment">requirements</span><span class="hljs-string">,</span> <span class="hljs-comment">you can instead serialize to</span> <span class="hljs-comment">json</span> <span class="hljs-comment">or</span> <span class="hljs-comment">csv</span><span class="hljs-string">,</span> <span class="hljs-comment">or any other format </span>-- <span class="hljs-comment">all you need is an</span> <span class="hljs-comment">adapter</span><span class="hljs-string">.</span>

<span class="hljs-comment">## Why is this approach</span> <span class="hljs-comment">good?</span> <span class="hljs-comment">(the</span> <span class="hljs-comment">model</span><span class="hljs-string">.</span><span class="hljs-comment">)</span>

<span class="hljs-comment">The reason this is good is simple: it preserves the best part of programming with sql-based databases</span><span class="hljs-string">.</span> <span class="hljs-comment">(While it&#x27;s a simple idea</span><span class="hljs-string">,</span> <span class="hljs-comment">it is a bit of</span> <span class="hljs-comment">a</span> <span class="hljs-comment">long</span> <span class="hljs-comment">walk</span><span class="hljs-string">,</span> <span class="hljs-comment">so</span> <span class="hljs-comment">bear</span> <span class="hljs-comment">with</span> <span class="hljs-comment">me</span><span class="hljs-string">.</span><span class="hljs-string">.</span><span class="hljs-string">.</span><span class="hljs-comment">)</span><span class="hljs-string">.</span>

<span class="hljs-comment">In</span> <span class="hljs-comment">traditional</span> <span class="hljs-comment">SQL</span> <span class="hljs-comment">databases</span> <span class="hljs-comment">systems</span><span class="hljs-string">,</span> <span class="hljs-comment">the schema is written in</span> <span class="hljs-comment">a</span> <span class="hljs-comment">less</span><span class="hljs-literal">-</span><span class="hljs-comment">expressive</span><span class="hljs-string">,</span> <span class="hljs-comment">non</span><span class="hljs-literal">-</span><span class="hljs-comment">Turing</span><span class="hljs-literal">-</span><span class="hljs-comment">complete</span> <span class="hljs-comment">&quot;schema</span> <span class="hljs-comment">definition</span> <span class="hljs-comment">language&quot; rather than the full</span> <span class="hljs-comment">&quot;programming</span> <span class="hljs-comment">language&quot;</span> <span class="hljs-comment">or</span> <span class="hljs-comment">&quot;query</span> <span class="hljs-comment">language&quot;</span><span class="hljs-string">.</span> <span class="hljs-comment">This prompts developers to take special steps when interacting</span> <span class="hljs-comment">across</span> <span class="hljs-comment">boundaries</span><span class="hljs-string">,</span> <span class="hljs-comment">as</span> <span class="hljs-comment">when</span> <span class="hljs-comment">the</span> <span class="hljs-comment">&quot;database</span> <span class="hljs-comment">client&quot; requests information from the</span> <span class="hljs-comment">&quot;database</span> <span class="hljs-comment">server&quot;</span><span class="hljs-string">.</span>

<span class="hljs-comment">Developers treat the client-server boundary</span> <span class="hljs-comment">like</span> <span class="hljs-comment">an</span> <span class="hljs-comment">airlock</span><span class="hljs-string">.</span> <span class="hljs-comment">The</span> <span class="hljs-comment">&quot;client&quot;</span> <span class="hljs-comment">and</span> <span class="hljs-comment">&quot;server&quot; speak to one another through short code fragments</span> <span class="hljs-comment">(written in a full Turing</span><span class="hljs-literal">-</span><span class="hljs-comment">complete</span> <span class="hljs-comment">&quot;query</span> <span class="hljs-comment">language&quot;)</span><span class="hljs-string">,</span> <span class="hljs-comment">which are rigorously tested against the agreed-upon schema definitions</span><span class="hljs-string">.</span>

<span class="hljs-comment">As a helpful side effect</span><span class="hljs-string">,</span> <span class="hljs-comment">the developer is encouraged to write self-contained modules which interact cleanly with one</span> <span class="hljs-comment">another</span><span class="hljs-string">.</span> <span class="hljs-comment">In</span> <span class="hljs-comment">the</span> <span class="hljs-comment">case</span> <span class="hljs-comment">of</span> <span class="hljs-comment">a</span> <span class="hljs-comment">traditional</span> <span class="hljs-comment">SQL</span> <span class="hljs-comment">database</span><span class="hljs-string">,</span> <span class="hljs-comment">those modules are all loosely</span> <span class="hljs-comment">integrated</span> <span class="hljs-comment">together</span> <span class="hljs-comment">by their common reliance on the database schema. In</span> <span class="hljs-comment">other</span> <span class="hljs-comment">words</span><span class="hljs-string">,</span> <span class="hljs-comment">a traditional type-safe database schema</span> <span class="hljs-comment">&quot;tricks</span> <span class="hljs-comment">us&quot;</span> <span class="hljs-comment">into</span> <span class="hljs-comment">writing</span> <span class="hljs-comment">maintainable</span><span class="hljs-string">,</span> <span class="hljs-comment">modular</span> <span class="hljs-comment">code</span><span class="hljs-string">.</span>

<span class="hljs-comment">Contrast this approach with other</span> <span class="hljs-comment">ways</span> <span class="hljs-comment">of</span> <span class="hljs-comment">processing</span> <span class="hljs-comment">information</span><span class="hljs-string">.</span> <span class="hljs-comment">In some high-level programming languages</span> <span class="hljs-comment">(such</span> <span class="hljs-comment">as</span> <span class="hljs-comment">C</span>++ <span class="hljs-comment">and</span> <span class="hljs-comment">Java)</span><span class="hljs-string">,</span> <span class="hljs-comment">developers are encouraged to tightly couple their code defintions with their type definitions</span><span class="hljs-string">.</span> <span class="hljs-comment">That tight coupling tends to introduce unintended complications when decomposing software across multiple</span> <span class="hljs-comment">processes</span> <span class="hljs-comment">or</span> <span class="hljs-comment">services</span><span class="hljs-string">.</span> <span class="hljs-comment">(And</span> <span class="hljs-comment">unfortunately</span> <span class="hljs-comment">for</span> <span class="hljs-comment">us</span><span class="hljs-string">,</span> <span class="hljs-comment">decomposing software across multipe processes</span> <span class="hljs-comment">or</span> <span class="hljs-comment">servers</span> <span class="hljs-comment">is</span> <span class="hljs-comment">_exactly_</span> <span class="hljs-comment">what</span> <span class="hljs-comment">we</span> <span class="hljs-comment">need</span> <span class="hljs-comment">to</span> <span class="hljs-comment">do in distributed systems development</span><span class="hljs-string">.</span><span class="hljs-comment">) Those complications tend towards code which is difficult to test and maintain</span><span class="hljs-string">.</span>

<span class="hljs-comment">##</span> <span class="hljs-comment">Bringing</span> <span class="hljs-comment">it</span> <span class="hljs-comment">back</span><span class="hljs-string">.</span><span class="hljs-string">.</span><span class="hljs-string">.</span> <span class="hljs-comment">(applying this approach to proto</span><span class="hljs-string">.</span><span class="hljs-comment">)</span>

<span class="hljs-comment">You</span> <span class="hljs-comment">may</span> <span class="hljs-comment">be</span> <span class="hljs-comment">asking</span><span class="hljs-string">,</span> <span class="hljs-comment">what does this description of</span> <span class="hljs-comment">SQL</span> <span class="hljs-comment">have</span> <span class="hljs-comment">to</span> <span class="hljs-comment">do</span> <span class="hljs-comment">with</span> <span class="hljs-comment">proto?</span> <span class="hljs-comment">Well</span><span class="hljs-string">,</span> <span class="hljs-comment">surprisingly</span><span class="hljs-string">,</span> <span class="hljs-comment">a</span> <span class="hljs-comment">lot</span><span class="hljs-string">.</span> <span class="hljs-comment">Read</span> <span class="hljs-comment">on:</span>

<span class="hljs-comment">The whole gimmick with protocol</span> <span class="hljs-comment">buffers</span> <span class="hljs-comment">is</span><span class="hljs-string">,</span> <span class="hljs-comment">we get access to a</span> <span class="hljs-comment">generic</span> <span class="hljs-comment">&quot;data</span> <span class="hljs-comment">definition</span> <span class="hljs-comment">language&quot; gives us the exact</span> <span class="hljs-comment">same</span> <span class="hljs-comment">advantage</span><span class="hljs-string">,</span> <span class="hljs-comment">as</span> <span class="hljs-comment">SQL</span> <span class="hljs-comment">schemas</span><span class="hljs-string">.</span> <span class="hljs-comment">But</span><span class="hljs-string">,</span> <span class="hljs-comment">this generic definition language *is free from the constraints</span> <span class="hljs-comment">of</span> <span class="hljs-comment">any</span> <span class="hljs-comment">specific</span> <span class="hljs-comment">datastore*</span><span class="hljs-string">.</span> <span class="hljs-comment">the</span> <span class="hljs-comment">&#x27;proto&#x27;</span> <span class="hljs-comment">language</span> <span class="hljs-comment">is</span> <span class="hljs-comment">non</span><span class="hljs-literal">-</span><span class="hljs-comment">Turing</span><span class="hljs-literal">-</span><span class="hljs-comment">complete</span><span class="hljs-string">,</span> <span class="hljs-comment">just</span> <span class="hljs-comment">like</span> <span class="hljs-comment">SQL&#x27;s</span> <span class="hljs-comment">&#x27;schema</span> <span class="hljs-comment">defintion</span> <span class="hljs-comment">langage&#x27;</span> <span class="hljs-comment">subset</span><span class="hljs-string">,</span> <span class="hljs-comment">which</span> <span class="hljs-comment">means  the proto language can</span> <span class="hljs-comment">only</span> <span class="hljs-comment">express</span> <span class="hljs-comment">_the</span> <span class="hljs-comment">composition_</span> <span class="hljs-comment">of</span> <span class="hljs-comment">a</span> <span class="hljs-comment">data</span> <span class="hljs-comment">artifact; it can&#x27;t express the</span> <span class="hljs-comment">_algorithms_ that manipulate those artifacts</span><span class="hljs-string">.</span>

<span class="hljs-comment">There&#x27;s</span> <span class="hljs-comment">an</span> <span class="hljs-comment">additional</span> <span class="hljs-comment">detail</span><span class="hljs-string">,</span> <span class="hljs-comment">and it&#x27;s absolutely crucial to proto&#x27;s success: it can</span> <span class="hljs-comment">describe</span> <span class="hljs-comment">tree</span><span class="hljs-literal">-</span><span class="hljs-comment">like</span><span class="hljs-string">,</span> <span class="hljs-comment">complex</span> <span class="hljs-comment">data</span> <span class="hljs-comment">structures; it&#x27;s not limited to tabular formats. This solves</span> <span class="hljs-comment">the</span> <span class="hljs-comment">so</span><span class="hljs-literal">-</span><span class="hljs-comment">called</span> <span class="hljs-comment">&quot;impedence</span> <span class="hljs-comment">mismatch</span> <span class="hljs-comment">problem&quot; which has plagued SQL database systems for 30</span><span class="hljs-literal">+</span> <span class="hljs-comment">years</span><span class="hljs-string">.</span> <span class="hljs-comment">(For</span> <span class="hljs-comment">a</span> <span class="hljs-comment">description</span> <span class="hljs-comment">of</span> <span class="hljs-comment">the</span> <span class="hljs-comment">&quot;impedence</span> <span class="hljs-comment">mismatch</span> <span class="hljs-comment">problem&quot;</span><span class="hljs-string">,</span> <span class="hljs-comment">see database expert Martin Fowler&#x27;s</span> <span class="hljs-comment">talk</span> <span class="hljs-comment">from</span> <span class="hljs-comment">GOTO</span> <span class="hljs-comment">2012</span> <span class="hljs-comment">(relevant excerpt linked here: https://youtu</span><span class="hljs-string">.</span><span class="hljs-comment">be/qI_g07C_Q5I?t=109</span> <span class="hljs-string">.</span><span class="hljs-comment">)</span>

<span class="hljs-comment">Proto definitions have been used in a wide variety</span> <span class="hljs-comment">of domains to document the interface boundaries that exist</span> <span class="hljs-comment">in</span> <span class="hljs-comment">software</span> <span class="hljs-comment">systems</span><span class="hljs-string">,</span> <span class="hljs-comment">and have flourished in the open-source ecosystem since 2012</span><span class="hljs-literal">-</span><span class="hljs-comment">2015</span><span class="hljs-string">.</span> <span class="hljs-comment">Here</span> <span class="hljs-comment">are</span> <span class="hljs-comment">some</span> <span class="hljs-comment">examples:</span>
  <span class="hljs-literal">-</span> <span class="hljs-comment">Alternative</span> <span class="hljs-comment">to</span> <span class="hljs-comment">XML for large static data</span> <span class="hljs-comment">dumps</span><span class="hljs-string">,</span> <span class="hljs-comment">particularly</span> <span class="hljs-comment">in</span> <span class="hljs-comment">map</span> <span class="hljs-comment">data:</span>
    <span class="hljs-literal">-</span> <span class="hljs-comment">Documentation for usage in OpenStreetMap:</span> <span class="hljs-comment">https://wiki</span><span class="hljs-string">.</span><span class="hljs-comment">openstreetmap</span><span class="hljs-string">.</span><span class="hljs-comment">org/wiki/PBF_Format</span>
  <span class="hljs-literal">-</span> <span class="hljs-comment">Real</span><span class="hljs-literal">-</span><span class="hljs-comment">time serving and rendering of</span> <span class="hljs-comment">map</span> <span class="hljs-comment">data:</span>
    <span class="hljs-literal">-</span> <span class="hljs-comment">example</span> <span class="hljs-comment">definition:</span> <span class="hljs-comment">https://github</span><span class="hljs-string">.</span><span class="hljs-comment">com/mapbox/vector</span><span class="hljs-literal">-</span><span class="hljs-comment">tile</span><span class="hljs-literal">-</span><span class="hljs-comment">spec/blob/master/2</span><span class="hljs-string">.</span><span class="hljs-comment">1/vector_tile</span><span class="hljs-string">.</span><span class="hljs-comment">proto</span>
  <span class="hljs-literal">-</span> <span class="hljs-comment">Message passing for real-time distributed</span> <span class="hljs-comment">systems:</span>
    <span class="hljs-literal">-</span> <span class="hljs-comment">Moby</span> <span class="hljs-comment">(docker</span> <span class="hljs-comment">upstream)</span> <span class="hljs-comment">networking</span> <span class="hljs-comment">protocol</span><span class="hljs-string">,</span> <span class="hljs-comment">definition:</span> <span class="hljs-comment">https://github</span><span class="hljs-string">.</span><span class="hljs-comment">com/moby/libnetwork/blob/d0951081b35fa4216fc4f0064bf065beeb55a74b/networkdb/networkdb</span><span class="hljs-string">.</span><span class="hljs-comment">proto</span>
    <span class="hljs-literal">-</span> <span class="hljs-comment">usage:</span> <span class="hljs-comment">https://github</span><span class="hljs-string">.</span><span class="hljs-comment">com/moby/libnetwork/blob/d0951081b35fa4216fc4f0064bf065beeb55a74b/networkdb/delegate</span><span class="hljs-string">.</span><span class="hljs-comment">go</span>
  <span class="hljs-literal">-</span> <span class="hljs-comment">Large</span><span class="hljs-literal">-</span><span class="hljs-comment">scale data storage in machine</span> <span class="hljs-comment">learning</span> <span class="hljs-comment">/ parallel data processing frameworks:</span>
    <span class="hljs-literal">-</span> <span class="hljs-comment">canonical storage format for TensorFlow:</span> <span class="hljs-comment">https://github</span><span class="hljs-string">.</span><span class="hljs-comment">com/tensorflow/tensorflow/blob/2687479a7cebb4dda26a83f022fb818387b10bfe/tensorflow/core/example/example</span><span class="hljs-string">.</span><span class="hljs-comment">proto</span>
    <span class="hljs-literal">-</span> <span class="hljs-comment">usage</span> <span class="hljs-comment">in</span> <span class="hljs-comment">python:</span> <span class="hljs-comment">https://github</span><span class="hljs-string">.</span><span class="hljs-comment">com/tensorflow/tensorflow/blob/6bb7f19c3d2c11c39da951f388f9112e0649ecfc/tensorflow/python/keras/feature_column/sequence_feature_column_integration_test</span><span class="hljs-string">.</span><span class="hljs-comment">py</span>
  <span class="hljs-literal">-</span> <span class="hljs-comment">Interface specifications for next-generation Apple</span> <span class="hljs-comment">machine</span> <span class="hljs-comment">learning</span> <span class="hljs-comment">models</span>
    <span class="hljs-literal">-</span> <span class="hljs-comment">example</span> <span class="hljs-comment">definition</span><span class="hljs-string">,</span> <span class="hljs-comment">see the whole directory: https://github</span><span class="hljs-string">.</span><span class="hljs-comment">com/apple/coremltools/blob/master/mlmodel/format/NearestNeighbors</span><span class="hljs-string">.</span><span class="hljs-comment">proto</span>
  <span class="hljs-literal">-</span> <span class="hljs-comment">Descriptions</span> <span class="hljs-comment">of</span> <span class="hljs-comment">REST/JSON request and response payloads</span> <span class="hljs-comment">(TODO</span> <span class="hljs-comment">find</span> <span class="hljs-comment">open</span><span class="hljs-literal">-</span><span class="hljs-comment">source</span> <span class="hljs-comment">examples)</span><span class="hljs-string">.</span>
  <span class="hljs-literal">-</span> <span class="hljs-comment">Database schemas for the persistent</span> <span class="hljs-comment">storage</span> <span class="hljs-comment">layer</span> <span class="hljs-comment">(TODO</span> <span class="hljs-comment">find</span> <span class="hljs-comment">open</span><span class="hljs-literal">-</span><span class="hljs-comment">source</span> <span class="hljs-comment">examples)</span><span class="hljs-string">.</span>
  <span class="hljs-literal">-</span> <span class="hljs-comment">Documentation</span> <span class="hljs-comment">of csv columns for batch</span> <span class="hljs-comment">jobs</span> <span class="hljs-comment">(TODO</span> <span class="hljs-comment">find</span> <span class="hljs-comment">open</span><span class="hljs-literal">-</span><span class="hljs-comment">source</span> <span class="hljs-comment">examples)</span><span class="hljs-string">.</span>

<span class="hljs-comment">If</span> <span class="hljs-comment">we define a set of semantic type-safe schemas for</span> <span class="hljs-comment">these</span> <span class="hljs-comment">all</span> <span class="hljs-comment">of these formats in a single common interface language</span><span class="hljs-string">,</span> <span class="hljs-comment">we can get that same</span> <span class="hljs-comment">&quot;SQL</span> <span class="hljs-comment">bonus&quot;</span><span class="hljs-string">.</span> <span class="hljs-comment">We</span> <span class="hljs-comment">get</span> <span class="hljs-comment">to</span>  <span class="hljs-comment">&quot;trick</span> <span class="hljs-comment">ourselves&quot; into writing testable and</span> <span class="hljs-comment">modular</span> <span class="hljs-comment">code</span><span class="hljs-string">,</span> <span class="hljs-comment">throughout</span> <span class="hljs-comment">our</span> <span class="hljs-comment">distributed</span> <span class="hljs-comment">system</span><span class="hljs-string">,</span> <span class="hljs-comment">no matter what language it&#x27;s in. And since the proto language is platform</span><span class="hljs-literal">-</span><span class="hljs-comment">agnostic</span><span class="hljs-string">,</span> <span class="hljs-comment">and</span> <span class="hljs-comment">programming</span><span class="hljs-literal">-</span><span class="hljs-comment">language</span><span class="hljs-literal">-</span><span class="hljs-comment">agnostic</span><span class="hljs-string">,</span> <span class="hljs-comment">we get a clean and testable way to mix and match components written</span> <span class="hljs-comment">in</span> <span class="hljs-comment">different</span> <span class="hljs-comment">languages</span><span class="hljs-string">,</span> <span class="hljs-comment">for</span> <span class="hljs-comment">free</span><span class="hljs-string">.</span>

<span class="hljs-comment">This lets is write code that is easily extensible</span> <span class="hljs-comment">and</span> <span class="hljs-comment">scalable</span><span class="hljs-string">,</span> <span class="hljs-comment">without altering our fundamental workflow</span><span class="hljs-string">.</span>

<span class="hljs-comment">##</span> <span class="hljs-comment">Benefits</span> <span class="hljs-comment">for</span> <span class="hljs-comment">documentation</span>

<span class="hljs-comment">There&#x27;s another hidden bonus to</span> <span class="hljs-comment">using</span> <span class="hljs-comment">proto</span><span class="hljs-string">,</span> <span class="hljs-comment">and it&#x27;s related to documentation:</span>

<span class="hljs-comment">With</span> <span class="hljs-comment">the</span> <span class="hljs-comment">benefit</span> <span class="hljs-comment">of some clear comments and</span> <span class="hljs-comment">good</span> <span class="hljs-comment">documentation</span> <span class="hljs-comment">practices</span><span class="hljs-string">,</span> <span class="hljs-comment">the</span> <span class="hljs-comment">schema</span><span class="hljs-literal">-</span><span class="hljs-comment">definition</span> <span class="hljs-comment">folder</span> <span class="hljs-comment">of your codebase can become the central go-to for canonical documentation about the entire distributed system. The goal is to make one place for the</span> <span class="hljs-comment">source</span><span class="hljs-literal">-</span><span class="hljs-comment">of</span><span class="hljs-literal">-</span><span class="hljs-comment">truth</span><span class="hljs-string">,</span> <span class="hljs-comment">and to make that source</span><span class="hljs-literal">-</span><span class="hljs-comment">of</span><span class="hljs-literal">-</span><span class="hljs-comment">truth accessible to both humans</span> <span class="hljs-comment">and</span> <span class="hljs-comment">computer</span> <span class="hljs-comment">programs</span><span class="hljs-string">.</span>

<span class="hljs-comment">You</span> <span class="hljs-comment">may</span> <span class="hljs-comment">be</span> <span class="hljs-comment">surprised</span> <span class="hljs-comment">to</span> <span class="hljs-comment">learn</span><span class="hljs-string">,</span> <span class="hljs-comment">in</span> <span class="hljs-comment">fact</span><span class="hljs-string">,</span> <span class="hljs-comment">that many large-profile production services</span> <span class="hljs-comment">generate</span> <span class="hljs-comment">their</span> <span class="hljs-comment">API documentation from a </span><span class="hljs-string">.</span><span class="hljs-comment">proto definition file. This is how the accompanying Markdown</span> <span class="hljs-comment">version</span> <span class="hljs-comment">of this documentation was generated</span><span class="hljs-string">.</span>

<span class="hljs-comment">##</span> <span class="hljs-comment">Further</span> <span class="hljs-comment">reading</span>

<span class="hljs-literal">-</span> <span class="hljs-comment">Proto</span> <span class="hljs-comment">language</span> <span class="hljs-comment">documentation:</span> <span class="hljs-comment">https://developers</span><span class="hljs-string">.</span><span class="hljs-comment">google</span><span class="hljs-string">.</span><span class="hljs-comment">com/protocol</span><span class="hljs-literal">-</span><span class="hljs-comment">buffers/docs/overview</span>
  <span class="hljs-literal">-</span> <span class="hljs-comment">The</span> <span class="hljs-comment">official</span> <span class="hljs-comment">doc</span><span class="hljs-string">,</span> <span class="hljs-comment">canonical reference for the proto</span> <span class="hljs-comment">definition</span> <span class="hljs-comment">language</span> <span class="hljs-comment">itself</span><span class="hljs-string">,</span> <span class="hljs-comment">and example usage code highlighting</span> <span class="hljs-comment">C</span>++<span class="hljs-string">,</span> <span class="hljs-comment">Java</span><span class="hljs-string">,</span> <span class="hljs-comment">Python</span><span class="hljs-string">,</span> <span class="hljs-comment">and</span> <span class="hljs-comment">Go</span><span class="hljs-string">.</span> <span class="hljs-comment">(javascript</span><span class="hljs-string">,</span> <span class="hljs-comment">as</span> <span class="hljs-comment">established</span><span class="hljs-string">,</span> <span class="hljs-comment">is a second-class citizen in</span> <span class="hljs-comment">the</span> <span class="hljs-comment">proto</span> <span class="hljs-comment">world;</span> <span class="hljs-comment">see</span> <span class="hljs-comment">below</span><span class="hljs-string">.</span><span class="hljs-comment">)</span>
 
<span class="hljs-literal">-</span> <span class="hljs-comment">Thrift</span> <span class="hljs-comment">whitepaper</span> <span class="hljs-comment">(aka</span> <span class="hljs-comment">april</span> <span class="hljs-comment">fools</span> <span class="hljs-comment">whitepaper):</span> <span class="hljs-comment">https://thrift</span><span class="hljs-string">.</span><span class="hljs-comment">apache</span><span class="hljs-string">.</span><span class="hljs-comment">org/static/files/thrift</span><span class="hljs-literal">-</span><span class="hljs-comment">20070401</span><span class="hljs-string">.</span><span class="hljs-comment">pdf</span>
  <span class="hljs-literal">-</span> <span class="hljs-comment">This</span> <span class="hljs-comment">eight</span><span class="hljs-literal">-</span><span class="hljs-comment">pager</span> <span class="hljs-comment">from</span> <span class="hljs-comment">2007 is the best publicly available introduction to this</span> <span class="hljs-comment">style</span> <span class="hljs-comment">of distributed systems development. Context:</span> <span class="hljs-comment">&#x27;thrift&#x27; is a copycat-reimplementation of</span> <span class="hljs-comment">proto</span><span class="hljs-string">,</span> <span class="hljs-comment">made</span> <span class="hljs-comment">my a corporate rival. The whitepaper is a rare window into the internal</span> <span class="hljs-comment">machinations</span> <span class="hljs-comment">of proprietary software development. Key</span> <span class="hljs-comment">sentence</span><span class="hljs-string">,</span> <span class="hljs-comment">regarding</span> <span class="hljs-comment">the</span> <span class="hljs-comment">use</span> <span class="hljs-comment">of multiple programming languages interacting seamlessly in a distributed</span> <span class="hljs-comment">system:</span> <span class="hljs-comment">&quot;Thrift has allowed the search team to leverage each language for its strengths and to develop code at a rapid pace</span><span class="hljs-string">.</span><span class="hljs-comment">&quot;</span>

<span class="hljs-literal">-</span> <span class="hljs-comment">Sawzall</span> <span class="hljs-comment">paper:</span> <span class="hljs-comment">https://static</span><span class="hljs-string">.</span><span class="hljs-comment">googleusercontent</span><span class="hljs-string">.</span><span class="hljs-comment">com/media/research</span><span class="hljs-string">.</span><span class="hljs-comment">google</span><span class="hljs-string">.</span><span class="hljs-comment">com/en//archive/sawzall</span><span class="hljs-literal">-</span><span class="hljs-comment">sciprog</span><span class="hljs-string">.</span><span class="hljs-comment">pdf</span> 
  <span class="hljs-literal">-</span> <span class="hljs-comment">Contains the original publicly available</span> <span class="hljs-comment">description</span> <span class="hljs-comment">of</span> <span class="hljs-comment">&#x27;protocol</span> <span class="hljs-comment">buffers&#x27;</span><span class="hljs-string">,</span> <span class="hljs-comment">circa</span> <span class="hljs-comment">2005</span><span class="hljs-string">.</span> <span class="hljs-comment">While it ostensibly describes a query language known as</span> <span class="hljs-comment">&#x27;sawzall&#x27;</span> <span class="hljs-comment">(since</span> <span class="hljs-comment">deprecated)</span><span class="hljs-string">,</span> <span class="hljs-comment">the</span> <span class="hljs-comment">real</span> <span class="hljs-comment">value</span> <span class="hljs-comment">of this paper is the</span> <span class="hljs-comment">incidental</span> <span class="hljs-comment">description</span> <span class="hljs-comment">of</span> <span class="hljs-comment">&#x27;proto&#x27; woven throughout. See pp</span><span class="hljs-string">.</span> <span class="hljs-comment">6</span><span class="hljs-literal">-</span><span class="hljs-comment">7</span><span class="hljs-string">,</span> <span class="hljs-comment">9</span><span class="hljs-literal">-</span><span class="hljs-comment">10</span><span class="hljs-string">,</span> <span class="hljs-comment">19</span><span class="hljs-literal">-</span><span class="hljs-comment">20</span><span class="hljs-string">,</span> <span class="hljs-comment">23</span><span class="hljs-string">.</span> <span class="hljs-comment">(add back the double &#x27;/&#x27;</span> <span class="hljs-comment">after</span> <span class="hljs-comment">&#x27;en&#x27; if the link doesn&#x27;t</span> <span class="hljs-comment">work</span><span class="hljs-string">.</span><span class="hljs-comment">)</span>

<span class="hljs-literal">-</span> <span class="hljs-comment">Library documentation for third-party javscript</span> <span class="hljs-comment">implementations:</span>
  <span class="hljs-literal">-</span> <span class="hljs-comment">protobufjs:</span> <span class="hljs-comment">https://github</span><span class="hljs-string">.</span><span class="hljs-comment">com/protobufjs/protobuf</span><span class="hljs-string">.</span><span class="hljs-comment">js</span>
    <span class="hljs-literal">-</span> <span class="hljs-comment">Primary use case: integration with</span> <span class="hljs-comment">C</span>++ <span class="hljs-comment">proto implementation and extension of</span> <span class="hljs-comment">C</span>++ <span class="hljs-comment">proto development patterns into javascript</span><span class="hljs-string">.</span>
  <span class="hljs-literal">-</span> <span class="hljs-comment">pbf:</span> <span class="hljs-comment">https://github</span><span class="hljs-string">.</span><span class="hljs-comment">com/mapbox/pbf</span>
    <span class="hljs-literal">-</span> <span class="hljs-comment">Primary</span> <span class="hljs-comment">use</span> <span class="hljs-comment">case:</span> <span class="hljs-comment">lightweight</span><span class="hljs-string">,</span> <span class="hljs-comment">pure</span> <span class="hljs-comment">js proto compiler and serializer</span><span class="hljs-string">.</span> <span class="hljs-comment">bare</span><span class="hljs-literal">-</span><span class="hljs-comment">bones; the open-source version is just the core functionality</span><span class="hljs-string">,</span> <span class="hljs-comment">and we&#x27;ve written utility functions to incorporate it into</span> <span class="hljs-comment">our</span> <span class="hljs-comment">existing</span> <span class="hljs-comment">js</span> <span class="hljs-comment">code</span><span class="hljs-string">.</span>
      <span class="hljs-literal">-</span> <span class="hljs-comment">example</span> <span class="hljs-comment">usage</span> <span class="hljs-comment">(schema</span> <span class="hljs-comment">definition):</span> <span class="hljs-comment">https://github</span><span class="hljs-string">.</span><span class="hljs-comment">com/mapbox/vector</span><span class="hljs-literal">-</span><span class="hljs-comment">tile</span><span class="hljs-literal">-</span><span class="hljs-comment">spec/blob/master/2</span><span class="hljs-string">.</span><span class="hljs-comment">1/vector_tile</span><span class="hljs-string">.</span><span class="hljs-comment">proto</span>
      <span class="hljs-literal">-</span> <span class="hljs-comment">example</span> <span class="hljs-comment">usage</span> <span class="hljs-comment">(wrapper</span> <span class="hljs-comment">library):</span> <span class="hljs-comment">https://github</span><span class="hljs-string">.</span><span class="hljs-comment">com/mapbox/vt</span><span class="hljs-literal">-</span><span class="hljs-comment">pbf/blob/086d4beed533d944075196872d8c11ef76f7870a/lib/geojson_wrapper</span><span class="hljs-string">.</span><span class="hljs-comment">js</span>
      <span class="hljs-literal">-</span> <span class="hljs-comment">example</span> <span class="hljs-comment">usage</span> <span class="hljs-comment">(actual</span> <span class="hljs-comment">code):</span> <span class="hljs-comment">https://github</span><span class="hljs-string">.</span><span class="hljs-comment">com/mapbox/vt</span><span class="hljs-literal">-</span><span class="hljs-comment">pbf/blob/086d4beed533d944075196872d8c11ef76f7870a/index</span><span class="hljs-string">.</span><span class="hljs-comment">js</span>

<span class="hljs-comment">##</span> <span class="hljs-comment">If you&#x27;re interested: proto language</span> <span class="hljs-comment">history</span><span class="hljs-string">,</span> <span class="hljs-comment">and motivation for technology choice</span><span class="hljs-string">.</span>

<span class="hljs-comment">Now for some background on the technology choices: the</span> <span class="hljs-comment">&#x27;protocol</span> <span class="hljs-comment">buffers&#x27; language and library were designed and implemented at</span> <span class="hljs-comment">&#x27;A</span> <span class="hljs-comment">Large</span> <span class="hljs-comment">Search</span> <span class="hljs-comment">Company&#x27;</span> <span class="hljs-comment">in</span> <span class="hljs-comment">2001</span><span class="hljs-string">.</span> <span class="hljs-comment">It was never intended to</span> <span class="hljs-comment">be widely available in open</span><span class="hljs-literal">-</span><span class="hljs-comment">source</span><span class="hljs-string">,</span> <span class="hljs-comment">and for many years it was considered to be closely-held proprietary technology. However</span><span class="hljs-string">,</span> <span class="hljs-comment">in</span> <span class="hljs-comment">an</span> <span class="hljs-comment">unexpected</span> <span class="hljs-comment">twist</span><span class="hljs-string">,</span> <span class="hljs-comment">&#x27;A</span> <span class="hljs-comment">Large</span> <span class="hljs-comment">Search</span> <span class="hljs-comment">Company&#x27;</span> <span class="hljs-comment">was</span> <span class="hljs-comment">outflanked</span> <span class="hljs-comment">by</span> <span class="hljs-comment">a</span> <span class="hljs-comment">corporate</span> <span class="hljs-comment">rival</span><span class="hljs-string">,</span> <span class="hljs-comment">and was strategically forced to open-source the proto language and the protocol buffers</span> <span class="hljs-comment">library</span> <span class="hljs-comment">on</span> <span class="hljs-comment">07/07/2008</span> <span class="hljs-comment">(If you take a moment to reflect on the</span> <span class="hljs-comment">particular</span> <span class="hljs-comment">significance</span> <span class="hljs-comment">of</span> <span class="hljs-comment">july</span> <span class="hljs-comment">2008 in world economic history</span><span class="hljs-string">,</span> <span class="hljs-comment">you might conclude that this a date where you&#x27;d only anounce something if</span> <span class="hljs-comment">you</span> <span class="hljs-comment">were</span> <span class="hljs-comment">&#x27;feeling</span> <span class="hljs-comment">lucky&#x27;</span><span class="hljs-string">.</span><span class="hljs-comment">)</span>

<span class="hljs-comment">The</span> <span class="hljs-comment">public</span> <span class="hljs-comment">release</span> <span class="hljs-comment">of</span> <span class="hljs-comment">&#x27;protocol</span> <span class="hljs-comment">buffers&#x27; was quickly followed by the corporate rival&#x27;s re</span><span class="hljs-literal">-</span><span class="hljs-comment">implementation</span><span class="hljs-string">,</span> <span class="hljs-comment">&#x27;thrift&#x27;</span><span class="hljs-string">,</span> <span class="hljs-comment">which became widely available just in time for christmas</span> <span class="hljs-comment">in</span> <span class="hljs-comment">2009</span><span class="hljs-string">.</span>

<span class="hljs-comment">The two libraries are very</span> <span class="hljs-comment">similar</span> <span class="hljs-comment">in</span> <span class="hljs-comment">concept</span><span class="hljs-string">,</span> <span class="hljs-comment">and if you&#x27;ve used one</span><span class="hljs-string">,</span> <span class="hljs-comment">you can quickly acclimate to</span> <span class="hljs-comment">the</span> <span class="hljs-comment">other</span><span class="hljs-string">.</span> <span class="hljs-comment">However</span><span class="hljs-string">,</span> <span class="hljs-comment">the reason you should use</span> <span class="hljs-comment">&#x27;protocol</span> <span class="hljs-comment">buffers&#x27;</span> <span class="hljs-comment">instead</span> <span class="hljs-comment">of</span> <span class="hljs-comment">&#x27;thrift&#x27;</span> <span class="hljs-comment">is</span> <span class="hljs-comment">that</span> <span class="hljs-comment">&#x27;protocol</span> <span class="hljs-comment">buffers&#x27; is much more efficiently</span> <span class="hljs-comment">engineered</span><span class="hljs-string">.</span> <span class="hljs-comment">&#x27;proto&#x27; is the one that had to work in order support the unprecedented</span> <span class="hljs-comment">operational</span> <span class="hljs-comment">requirements</span> <span class="hljs-comment">of</span> <span class="hljs-comment">&#x27;A Large Search Company Web</span> <span class="hljs-comment">Search&#x27;</span> <span class="hljs-comment">in</span> <span class="hljs-comment">2001</span><span class="hljs-literal">-</span><span class="hljs-comment">04</span><span class="hljs-string">.</span> <span class="hljs-comment">in</span> <span class="hljs-comment">contrast</span><span class="hljs-string">,</span> <span class="hljs-comment">&#x27;thrift&#x27; only had to work well enough to kind</span><span class="hljs-literal">-</span><span class="hljs-comment">of</span><span class="hljs-literal">-</span><span class="hljs-comment">scale</span><span class="hljs-literal">-</span><span class="hljs-comment">up a prominent social networking website. I have used both libraries and can</span> <span class="hljs-comment">assure</span> <span class="hljs-comment">you</span><span class="hljs-string">,</span> <span class="hljs-comment">you will notice the difference</span><span class="hljs-string">.</span>

<span class="hljs-comment">Important note: one factor which has traditionally held &#x27;protocol</span> <span class="hljs-comment">buffers&#x27; back from widespread adoption</span> <span class="hljs-comment">outside</span> <span class="hljs-comment">of proprietary code ecosystems is</span> <span class="hljs-comment">the</span> <span class="hljs-comment">lack</span> <span class="hljs-comment">of first-class javascript support. (This</span> <span class="hljs-comment">is</span> <span class="hljs-comment">ironic;</span> <span class="hljs-comment">after</span> <span class="hljs-comment">all</span><span class="hljs-string">,</span> <span class="hljs-comment">&#x27;A</span> <span class="hljs-comment">Large</span> <span class="hljs-comment">Search</span> <span class="hljs-comment">Company&#x27; helped put javascript on the map with its</span> <span class="hljs-string">.</span><span class="hljs-string">.</span><span class="hljs-string">.</span> <span class="hljs-comment">er</span><span class="hljs-string">.</span><span class="hljs-string">.</span><span class="hljs-string">.</span> <span class="hljs-comment">map</span><span class="hljs-string">.</span><span class="hljs-comment">) The reasons for this</span> <span class="hljs-comment">have</span> <span class="hljs-comment">to</span> <span class="hljs-comment">do with the specific organizational</span> <span class="hljs-comment">incentives</span> <span class="hljs-comment">within</span> <span class="hljs-comment">&#x27;A</span> <span class="hljs-comment">Large</span> <span class="hljs-comment">Search</span> <span class="hljs-comment">Company&#x27;</span><span class="hljs-string">.</span> <span class="hljs-comment">The</span> <span class="hljs-comment">short</span> <span class="hljs-comment">version</span> <span class="hljs-comment">is</span><span class="hljs-string">,</span> <span class="hljs-comment">there</span> <span class="hljs-comment">is</span> <span class="hljs-comment">an</span> <span class="hljs-comment">officiall</span> <span class="hljs-comment">supported</span> <span class="hljs-comment">&#x27;A</span> <span class="hljs-comment">Large</span> <span class="hljs-comment">Search</span> <span class="hljs-comment">Company&#x27;</span> <span class="hljs-comment">js</span> <span class="hljs-comment">proto</span> <span class="hljs-comment">library</span><span class="hljs-string">,</span> <span class="hljs-comment">but it&#x27;s bad and you should avoid it. There are two widely available</span> <span class="hljs-comment">alternatives:</span> <span class="hljs-comment">&#x27;protobufjs&#x27;</span> <span class="hljs-comment">by the web assembly project</span><span class="hljs-string">,</span> <span class="hljs-comment">and</span> <span class="hljs-comment">&#x27;pbf&#x27;</span><span class="hljs-string">,</span> <span class="hljs-comment">by a prominent map software</span> <span class="hljs-comment">company</span> <span class="hljs-comment">(&#x27;xobpam&#x27;</span> <span class="hljs-comment">spell</span> <span class="hljs-comment">backwards</span><span class="hljs-string">,</span> <span class="hljs-comment">find</span> <span class="hljs-comment">it</span> <span class="hljs-comment">on</span> <span class="hljs-comment">github)</span><span class="hljs-string">.</span> <span class="hljs-comment">We opt to use the</span> <span class="hljs-comment">&#x27;xobmap&#x27;</span><span class="hljs-literal">-</span><span class="hljs-comment">spelled</span><span class="hljs-literal">-</span><span class="hljs-comment">backwards</span> <span class="hljs-comment">&#x27;pbf&#x27; library because it aligns with our idiomatic js</span> <span class="hljs-comment">usage</span><span class="hljs-string">,</span> <span class="hljs-comment">has a very low footprint</span><span class="hljs-string">,</span> <span class="hljs-comment">and is production-tested at scale</span><span class="hljs-string">.</span> <span class="hljs-comment">In order to integrate &#x27;xobpam&#x27;</span><span class="hljs-literal">-</span><span class="hljs-comment">spelled</span><span class="hljs-literal">-</span><span class="hljs-comment">backwards</span> <span class="hljs-comment">&#x27;pbf&#x27; into our javascript codebase</span><span class="hljs-string">,</span> <span class="hljs-comment">we had to write some</span> <span class="hljs-comment">custom</span> <span class="hljs-comment">utilities</span><span class="hljs-string">,</span> <span class="hljs-comment">which</span> <span class="hljs-comment">we&#x27;d</span> <span class="hljs-comment">be happy to share. </span>

<span class="hljs-comment">Another important note: being who</span> <span class="hljs-comment">they</span> <span class="hljs-comment">are</span><span class="hljs-string">,</span> <span class="hljs-comment">the</span> <span class="hljs-comment">stakeholders</span> <span class="hljs-comment">of</span> <span class="hljs-comment">&#x27;A</span> <span class="hljs-comment">Large</span> <span class="hljs-comment">Search</span> <span class="hljs-comment">Company&#x27; will try to upsell you into using a</span> <span class="hljs-comment">bunch</span> <span class="hljs-comment">of value-add libraries alongside protocol</span> <span class="hljs-comment">buffers</span><span class="hljs-string">.</span> <span class="hljs-comment">In</span> <span class="hljs-comment">general</span><span class="hljs-string">,</span> <span class="hljs-comment">I advise a healthy suspicion</span> <span class="hljs-comment">of</span> <span class="hljs-comment">the</span> <span class="hljs-comment">value</span><span class="hljs-literal">-</span><span class="hljs-comment">adds</span><span class="hljs-string">.</span> <span class="hljs-comment">As is often the case</span><span class="hljs-string">,</span> <span class="hljs-comment">the best solution is to find reliable building blocks with very few moving</span> <span class="hljs-comment">parts</span><span class="hljs-string">,</span> <span class="hljs-comment">and hack them together by whatever means you can</span><span class="hljs-string">.</span>

<span class="hljs-comment">There are other alternatives to</span> <span class="hljs-comment">protocol</span> <span class="hljs-comment">buffers:</span> <span class="hljs-comment">&#x27;parquet&#x27;</span> <span class="hljs-comment">and</span> <span class="hljs-comment">&#x27;flatbuffers&#x27; are extension layers build</span> <span class="hljs-comment">on</span> <span class="hljs-comment">top</span> <span class="hljs-comment">of thrift and protocol buffers</span><span class="hljs-string">,</span> <span class="hljs-comment">respectively</span><span class="hljs-string">,</span> <span class="hljs-comment">and they each allow for efficient data access by natively storing data in a columnar fashion. &#x27;parquet&#x27; is optimized for batch jobs on backend servers</span><span class="hljs-string">,</span> <span class="hljs-comment">whereas</span> <span class="hljs-comment">&#x27;flatbuffers&#x27; is flexible and efficient enough to use for</span> <span class="hljs-comment">backend</span> <span class="hljs-comment">jobs</span> <span class="hljs-comment">or in-memory to power realtime computer graphics applications. &#x27;spark&#x27;&#x27;s</span> <span class="hljs-comment">&#x27;distributed</span> <span class="hljs-comment">data</span> <span class="hljs-comment">sets&#x27; are also closely influenced</span> <span class="hljs-comment">by</span> <span class="hljs-comment">this</span> <span class="hljs-comment">model</span><span class="hljs-string">,</span> <span class="hljs-comment">and the implementation relies on</span> <span class="hljs-comment">&#x27;thrift&#x27;</span><span class="hljs-string">.</span> <span class="hljs-comment">however</span><span class="hljs-string">,</span> <span class="hljs-comment">these libraries are more specialized and heavyweight than their</span> <span class="hljs-comment">ancestors</span> <span class="hljs-comment">&#x27;proto&#x27;</span> <span class="hljs-comment">and</span> <span class="hljs-comment">&#x27;thrift&#x27;</span><span class="hljs-string">,</span> <span class="hljs-comment">and tend to have limited</span> <span class="hljs-comment">library</span> <span class="hljs-comment">support</span><span class="hljs-string">.</span>

<span class="hljs-comment">Based on our engineering feasiblity analysis in second-half 2020</span><span class="hljs-string">,</span> <span class="hljs-comment">all</span> <span class="hljs-comment">of</span> <span class="hljs-comment">this</span> <span class="hljs-comment">makes</span> <span class="hljs-comment">&#x27;protocol</span> <span class="hljs-comment">buffers&#x27; the most effective choice for agnostic schema definitions</span><span class="hljs-string">.</span>

<span class="hljs-comment">TODO: add examples for usage</span> <span class="hljs-comment">in</span> <span class="hljs-comment">various</span> <span class="hljs-comment">languages</span><span class="hljs-string">,</span> <span class="hljs-comment">and simple utilities for type</span><span class="hljs-literal">-</span><span class="hljs-comment">checking csv&#x27;s and json against</span> <span class="hljs-comment">proto</span> <span class="hljs-comment">definitions</span><span class="hljs-string">.</span>
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemaslegacyprotographgraph.proto"><a href="#toc"><a name="server-schemas-legacy-proto-graph-graph-proto">server/schemas/legacy/proto/graph/graph.proto</a></a></h2>
<pre><code><span class="hljs-comment">// graph.proto</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Overall container file for message definitions representing the evictorbook</span>
<span class="hljs-comment">// graph. As of 2020/12/29, the same schema is used to represent the live</span>
<span class="hljs-comment">// serving database as well as the intermediate graph databases which we use</span>
<span class="hljs-comment">// when generating our graph analysis, pruning nodes and edges, etc.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Some fields, such as &#x27;network_id&#x27; and &#x27;c_id&#x27; (for component) are only</span>
<span class="hljs-comment">// populated and semantically meaningful after some analysis has been performed</span>
<span class="hljs-comment">// on the graph. This will hopefully be clear from context, and remains an</span>
<span class="hljs-comment">// ongoing effort to document thoroughly.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Motivation: We use&#x27;s neo4j&#x27;s schemaless mode, to allow for flexibility in</span>
<span class="hljs-comment">// our scripts. This has its advantages, but it places significant cognitive</span>
<span class="hljs-comment">// load on developers who are using it. Because there is no explicit type</span>
<span class="hljs-comment">// safety mechanism, the burden of type safety is placed on the developer</span>
<span class="hljs-comment">// writing queries. As a result, it&#x27;s fatiguing to write code that interacts</span>
<span class="hljs-comment">// with a schemaless persistence layer. More discouraging still, this situation</span>
<span class="hljs-comment">// can make it even more difficult than usual to write useful tests.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// The goal of these datastore-independent message schemas is to represent all</span>
<span class="hljs-comment">// of the graph node and relation types which appear in our graph db.</span>
<span class="hljs-comment">// Developers can use this interface definition file as an evolving reference,</span>
<span class="hljs-comment">// and use the auto-generated proto code as a guide to ensure type safety when</span>
<span class="hljs-comment">// writing code (in any language) that interacts with database artifacts.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// When reading from neo4j, we can pack the schemaless graph node data</span>
<span class="hljs-comment">// structures into these well-defined messages, and then proceed to manipulate</span>
<span class="hljs-comment">// that data with the benefit of static typing. Similarly, when writing to the</span>
<span class="hljs-comment">// database, our programs might first create an object using the protobuf</span>
<span class="hljs-comment">// library to ensuring type safety, and then copy that object&#x27;s fields into the</span>
<span class="hljs-comment">// datastore to ensure no extraneous data is inadvertantly passed on.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Defining messages in proto language also allows for schema evolution and</span>
<span class="hljs-comment">// backwards compatibility, which is a great benefit on an evolving project</span>
<span class="hljs-comment">// like evictorbook.</span>

syntax = <span class="hljs-string">&quot;proto3&quot;</span>;

<span class="hljs-keyword">import</span> <span class="hljs-string">&quot;nodes.proto&quot;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">&quot;relations.proto&quot;</span>;

<span class="hljs-keyword">package</span> graph;

<span class="hljs-comment">// Represents the complete contents of the evictorbook serving graph.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Introduce a &#x27;metadata&#x27; sub-message.</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">Graph</span> </span>{
  <span class="hljs-comment">// Container message for nodes in the graph.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// We present a wrapper message to have room to add additional fields which</span>
  <span class="hljs-comment">// are strongly associated with the node list (metadata, flags, etc).</span>
  <span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">NodeCollection</span> </span>{
    <span class="hljs-comment">// list of nodes in the graph.</span>
    <span class="hljs-keyword">repeated</span> NodeDetails nodes = <span class="hljs-number">1</span>;
  }

  <span class="hljs-comment">// Decribes the set of nodes in the graph, identified by unique string key.</span>
  NodeCollection node_collection = <span class="hljs-number">1</span>;

  <span class="hljs-comment">// Container message for relations in the graph.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// As with NodeCollection above, we present a wrapper message to reserve</span>
  <span class="hljs-comment">// space for add additional fields that are strongly associated with the</span>
  <span class="hljs-comment">// relation list (metadata, flags, etc).</span>
  <span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">RelationCollection</span> </span>{
    <span class="hljs-comment">// list of relations in the graph, identified by the unique string keys of</span>
    <span class="hljs-comment">// the source and destination nodes.</span>
    <span class="hljs-keyword">repeated</span> RelationDetails relations = <span class="hljs-number">1</span>;
  }

  <span class="hljs-comment">// Describes the set of relations (aka edges) among nodes in the graph.</span>
  RelationCollection relation_collection = <span class="hljs-number">2</span>;
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemaslegacyprotographnodes.proto"><a href="#toc"><a name="server-schemas-legacy-proto-graph-nodes-proto">server/schemas/legacy/proto/graph/nodes.proto</a></a></h2>
<pre><code><span class="hljs-comment">// notes.proto</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// This file contains message definitions representing the nodes in the</span>
<span class="hljs-comment">// evictorbook graph.</span>
syntax = <span class="hljs-string">&quot;proto3&quot;</span>;

<span class="hljs-keyword">package</span> graph;

<span class="hljs-comment">// Represents a single node in the graph.</span>
message NodeDetails {
  <span class="hljs-comment">// internal graph db id for this node.</span>
  <span class="hljs-type">int64</span> <span class="hljs-variable">identity</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

  <span class="hljs-comment">// the node types that this node has. in our graph, nodes always have a</span>
  <span class="hljs-comment">// single type, as of 2021/03/12, but this may change in the future.</span>
  repeated <span class="hljs-type">string</span> <span class="hljs-variable">labels</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;

  <span class="hljs-comment">// the semantic type of the node, as an enum.</span>
  <span class="hljs-type">NodeType</span> <span class="hljs-variable">type</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;

  <span class="hljs-comment">// a string key which uniquely identifies this node (among other nodes of its</span>
  <span class="hljs-comment">// type). each node type has a field which is designated as the unique key.</span>
  <span class="hljs-comment">// see definitions inline.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> annotate key fields in a machine-readable way.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">unique_string_key</span> <span class="hljs-operator">=</span> <span class="hljs-number">4</span>;

  <span class="hljs-comment">// Describes the data payload of the node.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// set only the &#x27;data&#x27; field which corresponds to the node&#x27;s type,</span>
  <span class="hljs-comment">// specified above. see full message defintions below.</span>
  oneof data {
    <span class="hljs-type">SFAssessorParcelData</span> <span class="hljs-variable">sf_assessor_parcel_data</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;
    <span class="hljs-type">SFAssessorParcelOwnerData</span> <span class="hljs-variable">sf_assessor_parcel_owner_data</span> <span class="hljs-operator">=</span> <span class="hljs-number">6</span>;
    <span class="hljs-type">CalSOSLPData</span> <span class="hljs-variable">cal_sos_limited_business_data</span> <span class="hljs-operator">=</span> <span class="hljs-number">7</span>;
    <span class="hljs-type">CalSOSCorpData</span> <span class="hljs-variable">cal_sos_corporation_data</span> <span class="hljs-operator">=</span> <span class="hljs-number">8</span>;
    <span class="hljs-type">CalSOSOwnerData</span> <span class="hljs-variable">cal_sos_business_owner_data</span> <span class="hljs-operator">=</span> <span class="hljs-number">9</span>;
    <span class="hljs-type">SFRentBoardEvictionData</span> <span class="hljs-variable">sfrb_eviction_data</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;
    <span class="hljs-type">SFRentBoardEvictorData</span> <span class="hljs-variable">sfrb_evictor_data</span> <span class="hljs-operator">=</span> <span class="hljs-number">11</span>;
    <span class="hljs-type">AddressMainData</span> <span class="hljs-variable">address_main_data</span> <span class="hljs-operator">=</span> <span class="hljs-number">12</span>;
    <span class="hljs-type">AddressUnitData</span> <span class="hljs-variable">address_unit_data</span> <span class="hljs-operator">=</span> <span class="hljs-number">13</span>;
  }
}

<span class="hljs-comment">// Types of entities that appear as nodes in the evictorbook-sf graph.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Names of these values correspond directly to the strings used for tags in</span>
<span class="hljs-comment">// the evictorbook serving database, so they&#x27;re terse and require some</span>
<span class="hljs-comment">// explanation.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// These names are &#x27;namespaced&#x27; with prefixes depending on their source:</span>
<span class="hljs-comment">//  </span>
<span class="hljs-comment">//   prefix  |  source</span>
<span class="hljs-comment">//  -------------------------------------------</span>
<span class="hljs-comment">//   A       |  San Francisco Assessor&#x27;s office</span>
<span class="hljs-comment">//   SOS     |  California Sec. of State business index</span>
<span class="hljs-comment">//   RB      |  SF Rent Board</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// &quot;Address&quot; nodes have no namespace, and are generated when parsing</span>
<span class="hljs-comment">// documents from any source. In other words, the types which begin with</span>
<span class="hljs-comment">// &quot;ADDRESS&quot; have no implied data source.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Below, you&#x27;ll find message descriptions for the data payloads of each of</span>
<span class="hljs-comment">// these types. See those descriptions for more details.</span>
<span class="hljs-keyword">enum</span> <span class="hljs-title class_">NodeType</span> {
  <span class="hljs-comment">// Default value. Treat as unset.</span>
  NODE_TYPE_UNSPECIFIED = <span class="hljs-number">0</span>;
  
  <span class="hljs-comment">// Corresponds to node type &quot;A_Parcel&quot;.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// Represents a physical parcel, as it&#x27;s described in records from the SF</span>
  <span class="hljs-comment">// Assessor&#x27;s office. Contains fields for the parcel&#x27;s location and physical</span>
  <span class="hljs-comment">// characteristics. </span>
  A_PARCEL = <span class="hljs-number">1</span>;

  <span class="hljs-comment">// Corresponds to node type &quot;A_Parcel_Owner&quot;.</span>
  A_PARCEL_OWNER = <span class="hljs-number">2</span>;

  <span class="hljs-comment">// Corresponds to node type &quot;SOS_LP&quot;.</span>
    <span class="hljs-comment">//</span>
  <span class="hljs-comment">// A limited partnership or an LLC, as it&#x27;s represented in the California</span>
  <span class="hljs-comment">// Secretary of State business entity index.</span>
  SOS_LP = <span class="hljs-number">3</span>;

  <span class="hljs-comment">// Corresponds to node type &quot;SOS_Corp&quot;.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// A for-profit corporation, as it&#x27;s represented in the California Secretary</span>
  <span class="hljs-comment">// of State business entity index.</span>
  SOS_CORP = <span class="hljs-number">4</span>;

  <span class="hljs-comment">// Corresponds to node type &quot;SOS_Owner&quot;.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// A person or business-entity which has an ownership interest in another</span>
  <span class="hljs-comment">// business-entity, as described in the California Secretary of State</span>
  <span class="hljs-comment">// business entity index.</span>
  SOS_OWNER = <span class="hljs-number">5</span>;

  <span class="hljs-comment">// Corresponds to node type &quot;RB_Eviction&quot;.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// A record of an eviction which occurred in San Francisco, as represented in</span>
  <span class="hljs-comment">// SF Rent Board records.</span>
  RB_EVICTION = <span class="hljs-number">6</span>;

  <span class="hljs-comment">// Corresponds to node type &quot;RB_Evictor&quot;.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// Represents a person or entity who instigated an eviction, according to</span>
  <span class="hljs-comment">// information from eviction records and/or sales transfer records.</span>
  RB_EVICTOR = <span class="hljs-number">7</span>;

  <span class="hljs-comment">// Corresponds to node type &quot;Address_Main&quot;.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// Full address, without unit. May represent the address of a parcel&#x27;s owner,</span>
  <span class="hljs-comment">// or an address associated with a business entity or one of its officers.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// The idea is to provide a single node that acts as a building or lot&#x27;s</span>
  <span class="hljs-comment">// conceptual &quot;anchor&quot; node, while ADDRESS_UNIT nodes represent individual</span>
  <span class="hljs-comment">// units that can be resolved at that address.</span>
  ADDRESS_MAIN = <span class="hljs-number">8</span>;

  <span class="hljs-comment">// Corresponds to node type &quot;Address_Unit&quot;.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// Full address, including a unit number if applicable. May represent the</span>
  <span class="hljs-comment">// address of a parcel&#x27;s owner, or an address associated with a business</span>
  <span class="hljs-comment">// entity or one of its officers.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// Address_Unit graph nodes are analysed with connected component analysis,</span>
  <span class="hljs-comment">// and the network_id of the address&#x27;s component is stored in this node.</span>
  ADDRESS_UNIT = <span class="hljs-number">9</span>;
}


<span class="hljs-comment">// Node type: A_Parcel</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Represents a physical parcel, as it&#x27;s described in records from the SF</span>
<span class="hljs-comment">// Assessor&#x27;s office. Contains fields for the parcel&#x27;s location and physical</span>
<span class="hljs-comment">// characteristics. </span>
message SFAssessorParcelData {
  <span class="hljs-comment">// Block lot string, which uniquely specifies a parcel in SF city and county</span>
  <span class="hljs-comment">// assessor records. This is a unique key for A_Parcel nodes in the database.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">block_lot</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

  <span class="hljs-comment">// Property class code according to the SF assessor&#x27;s office.</span>
  <span class="hljs-comment">// For values and their definitions see:</span>
  <span class="hljs-comment">// https://data.sfgov.org/Housing-and-Buildings/Reference-Assessor-Recorder-Property-Class-Codes/pa56-ek2h/data</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">prop_class_code</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;

  <span class="hljs-comment">// TODO Confirm semantics. Full neighborhood name is stored as</span>
  <span class="hljs-comment">// &#x27;neighborhood&#x27;, below.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">neighborhood_code</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;

  <span class="hljs-comment">// Identifier for the zoning district this parcel occupies.</span>
  <span class="hljs-comment">// San Francisco zoning district identifiers can be found here:</span>
  <span class="hljs-comment">// https://sfplanninggis.org/pim/map.html?layers=Zoning%20Districts</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">zone</span> <span class="hljs-operator">=</span> <span class="hljs-number">4</span>;

  <span class="hljs-comment">// Height of the buildings in this parcel, in stories.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> investigate behavior for multi-building parcels. </span>
  <span class="hljs-type">string</span> <span class="hljs-variable">stories</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;

  <span class="hljs-comment">// Number of units that occupy this real-estate parcel.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">units</span> <span class="hljs-operator">=</span> <span class="hljs-number">6</span>;

  <span class="hljs-comment">// Number of rooms in the property on this parcel.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">rooms</span> <span class="hljs-operator">=</span> <span class="hljs-number">7</span>;

  <span class="hljs-comment">// Number of bedrooms in the property on this parcel.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">beds</span> <span class="hljs-operator">=</span> <span class="hljs-number">8</span>;

  <span class="hljs-comment">// Calendar year in which the buildings on this real-estate parcel were first</span>
  <span class="hljs-comment">// constructed.</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> confirm behavior for multi-unit parcels.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">yr_built</span> <span class="hljs-operator">=</span> <span class="hljs-number">9</span>;

  <span class="hljs-comment">// Fields 11 to 16 are components of a structured address, as represented in </span>
  <span class="hljs-comment">// county assessor records.</span>

  <span class="hljs-comment">// If the parcel occupies a single street number, this field contains that</span>
  <span class="hljs-comment">// street number. Otherwise, it contains the lowest street number in the</span>
  <span class="hljs-comment">// range of street  numbers that this parcel occupies.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">parc_start_no</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;

  <span class="hljs-comment">// If this parcel occupies multiple street numbers, this field contains the </span>
  <span class="hljs-comment">// highest street number in the range of occupied street numbers.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Clarify behavior for single-street-number parcels.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">parc_end_no</span> <span class="hljs-operator">=</span> <span class="hljs-number">11</span>;

  <span class="hljs-comment">// The name of the street of this parcel&#x27;s address, as it appears in county</span>
  <span class="hljs-comment">// assessor records.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">parc_street_name</span> <span class="hljs-operator">=</span> <span class="hljs-number">12</span>;

  <span class="hljs-comment">// Suffix of the street part of this parcel&#x27;s address, as it appears in</span>
  <span class="hljs-comment">// county assessor records.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">parc_street_type</span> <span class="hljs-operator">=</span> <span class="hljs-number">13</span>;

  <span class="hljs-comment">// Unit number component of this parcel&#x27;s address, as it appears in county</span>
  <span class="hljs-comment">// assessor records.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// TODO Clarify behavior when the parcel has no subunits.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">parc_unit_no</span> <span class="hljs-operator">=</span> <span class="hljs-number">14</span>;

  <span class="hljs-comment">// The zip code of this parcel&#x27;s address, as it appears in county assessor</span>
  <span class="hljs-comment">// records.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">parc_zip</span> <span class="hljs-operator">=</span> <span class="hljs-number">15</span>;

  <span class="hljs-comment">// Date on which this parcel&#x27;s address was last updated, according to records</span>
  <span class="hljs-comment">// from the assessor&#x27;s office.</span>
  <span class="hljs-comment">// Format: CCYYMMDD</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">update_date</span> <span class="hljs-operator">=</span> <span class="hljs-number">16</span>;

  <span class="hljs-comment">// Monetary value of the land this real-estate parcel occupies, according to</span>
  <span class="hljs-comment">// the most recent assessment on file, in US dollars.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">assess_land_val</span> <span class="hljs-operator">=</span> <span class="hljs-number">17</span>;

  <span class="hljs-comment">// Monetary value of structures built on the land this parcel occupies,</span>
  <span class="hljs-comment">// according to the most recent assessment on file, in US collars.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">assess_imp_val</span> <span class="hljs-operator">=</span> <span class="hljs-number">18</span>;

  <span class="hljs-comment">// Date on which the parcel&#x27;s value was last assessed.</span>
  <span class="hljs-comment">// Format: CCYYMMDD</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">assess_val_date</span> <span class="hljs-operator">=</span> <span class="hljs-number">19</span>;

  <span class="hljs-comment">// TODO clarify the semantics here.</span>
  <span class="hljs-comment">// Units are in US dollars.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">curr_sales_price</span> <span class="hljs-operator">=</span> <span class="hljs-number">20</span>;

  <span class="hljs-comment">// TODO clarify the semantics here.</span>
  <span class="hljs-comment">// Units are in US dollars.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">curr_sales_date</span> <span class="hljs-operator">=</span> <span class="hljs-number">21</span>;

  <span class="hljs-comment">// Assessment of the rent-control status of this parcel:</span>
  <span class="hljs-comment">// 0 (default) if data unavailable to determine rent controlled status, </span>
  <span class="hljs-comment">// 1 if likely rent controlled,</span>
  <span class="hljs-comment">// 2 if doubtful that this is rent controlled</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">rent_controlled</span> <span class="hljs-operator">=</span> <span class="hljs-number">22</span>;

  <span class="hljs-comment">// A string representing the parcel&#x27;s street address, including street</span>
  <span class="hljs-comment">// number, street name and suffix, and unit number. The parcel is assumed to</span>
  <span class="hljs-comment">// be within SF city/county limits.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// Notes from schema definition sheet:</span>
  <span class="hljs-comment">// Full address in the format of &quot;ST_START_NO-ST_END_NO ST_NAME ST_TYPE (Unit</span>
  <span class="hljs-comment">// UNIT)&quot; (w/o end no if no address range, w/o parentheses if no unit)</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">addr</span> <span class="hljs-operator">=</span> <span class="hljs-number">23</span>;

  <span class="hljs-comment">// Longitude, in degrees, of a point within this parcel&#x27;s boundaries.</span>
  <span class="hljs-comment">// string representing a floating-point number.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">long</span> <span class="hljs-operator">=</span> <span class="hljs-number">24</span>;

  <span class="hljs-comment">// Latitude, in degrees, of a point within this parcel&#x27;s boundaries.</span>
  <span class="hljs-comment">// string representing a floating-point number.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">lat</span> <span class="hljs-operator">=</span> <span class="hljs-number">25</span>;

  <span class="hljs-comment">// Name of the neighborhood this parcel occupies. As of 2020/09/26, it&#x27;s</span>
  <span class="hljs-comment">// assumed that all parcels are within SF city and county, so these are San</span>
  <span class="hljs-comment">// Francisco neighborhoods.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// Neighborhoods are assigned using SF polygons.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// Values correspond to names of the neighborhood polygons</span>
  <span class="hljs-comment">// described at:</span>
  <span class="hljs-comment">// https://data.sfgov.org/Geographic-Locations-and-Boundaries/SF-Find-Neighborhoods/pty2-tcw4</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">neighborhood</span> <span class="hljs-operator">=</span> <span class="hljs-number">26</span>;
}

<span class="hljs-comment">// Node type: A_Parcel_Owner</span>
<span class="hljs-comment">// </span>
<span class="hljs-comment">// Describes an individual or entity that&#x27;s directly listed, by name, as an</span>
<span class="hljs-comment">// owner of a parcel in SF Assessor records.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> In the current schema, owners are uniquely identified by name, which</span>
<span class="hljs-comment">// introduces potential for false positives. This is a property of the schema</span>
<span class="hljs-comment">// that we should revisit for future revisions.</span>
message SFAssessorParcelOwnerData {
  <span class="hljs-comment">// Name of owner listed on parcel.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// TODO Briefly describe how/whether this data was normalized.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">owner_name</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
}

<span class="hljs-comment">// Node type: SOS_LP</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// A limited partnership or an LLC, as decribed in the Calif. Sec. of State</span>
<span class="hljs-comment">// business entity index.</span>
message CalSOSLPData {
  <span class="hljs-comment">// Normalized name of the partnership or llc, derived from the name used in</span>
  <span class="hljs-comment">// Calif Sec. of State business records.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Describe or link specifics of the string normalization.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">name_norm</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

  <span class="hljs-comment">// LLC only: state or county for formation of foreign llc.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">jurisdiction_llc</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;
 
  <span class="hljs-comment">// LLC only: management structure.</span>
  <span class="hljs-comment">// 1 = One Manager</span>
  <span class="hljs-comment">// M = More Than One Manager</span>
  <span class="hljs-comment">// A = All Members are Managers</span>
  <span class="hljs-comment">// LLC ONLY</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">llc_management_code</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;

  <span class="hljs-comment">// LLC only: type of business.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">llc_type_of_business</span> <span class="hljs-operator">=</span> <span class="hljs-number">4</span>;

  <span class="hljs-comment">// Format is CCYYJJJN9999</span>
  <span class="hljs-comment">// CCYY = Century and Year.</span>
  <span class="hljs-comment">// JJJ = Julian day of year.</span>
  <span class="hljs-comment">// N = Record Type</span>
  <span class="hljs-comment">// 0 = LP Record</span>
  <span class="hljs-comment">// 1 = LLC Record</span>
  <span class="hljs-comment">// 9999 = Sequence Number </span>
  <span class="hljs-type">string</span> <span class="hljs-variable">file_number</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;

  <span class="hljs-comment">// Date of initial filing, represented as CCYYMMDD</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">file_date</span> <span class="hljs-operator">=</span> <span class="hljs-number">6</span>;

  <span class="hljs-comment">//  Identifies current status of LP/LLC</span>
  <span class="hljs-comment">//  A = Active</span>
  <span class="hljs-comment">//  B = Dishonored Check</span>
  <span class="hljs-comment">//  C = Canceled</span>
  <span class="hljs-comment">//  D = Dissolved</span>
  <span class="hljs-comment">//  P = Pending Cancellation</span>
  <span class="hljs-comment">//  F = Franchise Tax Board (FTB) Suspended/Forfeited</span>
  <span class="hljs-comment">//  M = Merged out</span>
  <span class="hljs-comment">//  O = Converted out</span>
  <span class="hljs-comment">//  S = Secretary of State (SOS) Suspended/Forfeited</span>
  <span class="hljs-comment">//  2 = SOS/FTB Suspended/Forfeited</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">status</span> <span class="hljs-operator">=</span> <span class="hljs-number">7</span>; 

  <span class="hljs-comment">// Filing type: foreign &quot;F&quot; or domestic &quot;D&quot;.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">filing_type</span> <span class="hljs-operator">=</span> <span class="hljs-number">8</span>;

  <span class="hljs-comment">// California Limited Partnership or LLC Name, non-normalized.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> <span class="hljs-number">9</span>;

  <span class="hljs-comment">// State or country of formation for foreign limited partnerships.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">jurisdiction</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;

  <span class="hljs-comment">// Agent of service contact info.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// !! CAUTION !! These fields follow a different naming convention than their</span>
  <span class="hljs-comment">// conterparts in SOS_Corp.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">agent_name</span> <span class="hljs-operator">=</span> <span class="hljs-number">11</span>;
  <span class="hljs-type">string</span> <span class="hljs-variable">agent_address_1</span> <span class="hljs-operator">=</span> <span class="hljs-number">12</span>;
  <span class="hljs-type">string</span> <span class="hljs-variable">agent_address_2</span> <span class="hljs-operator">=</span> <span class="hljs-number">13</span>;
  <span class="hljs-type">string</span> <span class="hljs-variable">agent_city</span> <span class="hljs-operator">=</span> <span class="hljs-number">14</span>;
  <span class="hljs-type">string</span> <span class="hljs-variable">agent_state</span> <span class="hljs-operator">=</span> <span class="hljs-number">15</span>;
  <span class="hljs-type">string</span> <span class="hljs-variable">agent_zip</span> <span class="hljs-operator">=</span> <span class="hljs-number">16</span>;

  <span class="hljs-comment">// Date or cause of termination.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// This is a free-form text field and can follow many formats, depending on</span>
  <span class="hljs-comment">// context. Examples of typical contents:</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">//  - date in &quot;MM/DD/YY&quot; format. some records allow &#x27;00&#x27; for month or date.</span>
  <span class="hljs-comment">//  - date in &quot;MM/DD/YY&quot; format with qualifying suffix.</span>
  <span class="hljs-comment">//       examples: &quot;01/01/15 OR EVENT&quot;, &quot;01/15/40 OR PER AGMT&quot;, &quot;02/15/33*&quot;</span>
  <span class="hljs-comment">//  - date in &quot;MMDDYY&quot; format</span>
  <span class="hljs-comment">//  - date in &quot;MM/DD/YYYY&quot; format (for some 90&#x27;s records).</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// In general, if you&#x27;re looking at this, expect it to be difficult to parse.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> document exhaustively and/or apply cleanup in pipeline.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">term</span> <span class="hljs-operator">=</span> <span class="hljs-number">17</span>;

  <span class="hljs-comment">// Business entity component id, generated by the evictorbook data pipeline</span>
  <span class="hljs-comment">// via connected component analysis.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// Each SOS_Corp and SOS_LP graph node in the graph is assigned a &#x27;c_id&#x27;.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// Two SOS_Corp and/or SOS_LP graph nodes share a c_id if there exists a</span>
  <span class="hljs-comment">// path connecting those graph nodes in the subgraph of {SOS_Corp|SOS_LP}</span>
  <span class="hljs-comment">// graph nodes and {OFFICER_FOR} edges.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// See the developer guide for a detailed description of the evictorbook&#x27;s</span>
  <span class="hljs-comment">// network connection methodology in the section &quot;Network Connection Method -</span>
  <span class="hljs-comment">// Detailed &gt; During DB Creation&quot;. As of 2020/09/09, c_id assignment is</span>
  <span class="hljs-comment">// described in step &#x27;I&#x27; of that section.</span>
  <span class="hljs-type">int64</span> <span class="hljs-variable">c_id</span> <span class="hljs-operator">=</span> <span class="hljs-number">18</span>;

  <span class="hljs-comment">// Network component id of the connected component this owner belongs to.</span>
  <span class="hljs-comment">// This uniquely specifies the ownership network this owner belongs to,</span>
  <span class="hljs-comment">// according to connected component analysis in the evictorbook data</span>
  <span class="hljs-comment">// pipeline.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// &#x27;network_id&#x27; components are aggregations of one or more &#x27;c_id&#x27;</span>
  <span class="hljs-comment">// components, connected by a path in the subgraph described above.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// So, graph nodes that share a &#x27;c_id&#x27; also share a &#x27;network_id&#x27;, but graph</span>
  <span class="hljs-comment">// nodes that share a &#x27;network_id&#x27; do NOT NECESSARILY share a &#x27;c_id&#x27;.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// See the developer guide for a detailed description of the evictorbook&#x27;s</span>
  <span class="hljs-comment">// network connection methodology in the section &quot;Network Connection Method -</span>
  <span class="hljs-comment">// Detailed &gt; During DB Creation&quot;. As of 2020/09/09, network_id assignment is</span>
  <span class="hljs-comment">// described in step &#x27;III&#x27;. of that section.</span>
  <span class="hljs-type">int64</span> <span class="hljs-variable">network_id</span> <span class="hljs-operator">=</span> <span class="hljs-number">19</span>;
}

<span class="hljs-comment">// Node type: SOS_Corp</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// A corporation, as described in the Calif. Sec. of State business entity</span>
<span class="hljs-comment">// index.</span>
message CalSOSCorpData {
  <span class="hljs-comment">// Normalized name of the business, derived from the name in Calif. Sec. of</span>
  <span class="hljs-comment">// State business records.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Describe or link specifics of the string normalization.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">name_norm</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

  <span class="hljs-comment">// Transaction date of the document which established this corporation,</span>
  <span class="hljs-comment">// according to the California Secretary of State business registry.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// Date is represented as a string with format &#x27;CCYYMMDD&#x27;.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">transaction_date</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;

  <span class="hljs-comment">// An 8 digit Corporate Identification Number, from the California Secretary</span>
  <span class="hljs-comment">// of State business registry.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">corporation_number</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;

  <span class="hljs-comment">// Date on which this corporation was incorporated, according to the</span>
  <span class="hljs-comment">// California Secretary of State business registry.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// Date is represented as a string with format &#x27;CCYYMMDD&#x27;.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">incorporation_date</span> <span class="hljs-operator">=</span> <span class="hljs-number">4</span>;

  <span class="hljs-comment">// Status of the corporation, as a string containing a code from Calif. Sec.</span>
  <span class="hljs-comment">// of State business entity records. The values are described as follows in</span>
  <span class="hljs-comment">// the database schema documentation:</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// 1 = Active</span>
  <span class="hljs-comment">// 2 = Suspended</span>
  <span class="hljs-comment">// 3 = Canceled</span>
  <span class="hljs-comment">// 4 = Surrendered</span>
  <span class="hljs-comment">// 5 = Term expired</span>
  <span class="hljs-comment">// 6 = Dissolved</span>
  <span class="hljs-comment">// 7 = Forfeited</span>
  <span class="hljs-comment">// 8 = Deleted</span>
  <span class="hljs-comment">// 9 = Inactive</span>
  <span class="hljs-comment">// C = Merged Out</span>
  <span class="hljs-comment">// E = State to Federal Bank Conversion</span>
  <span class="hljs-comment">// F = Conditionally dissolved (No tax clearance)</span>
  <span class="hljs-comment">// Not sure about code = Converted Out</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// In the 05/2020 production database, the codes which appear are: &quot;0&quot;-&quot;9&quot;, &quot;C&quot;</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">corporation_status</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;

  <span class="hljs-comment">// Description of the legal process used to establish this corporation,</span>
  <span class="hljs-comment">// according to Calif. Sec. of state records. The allowed values and their</span>
  <span class="hljs-comment">// meanings are listed below.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// ARTS = Articles of Incorporation</span>
  <span class="hljs-comment">// S&amp;DC = Statement &amp; Designation By Foreign Corporation</span>
  <span class="hljs-comment">// S&amp;DA = Statement &amp; Designation By Foreign Association</span>
  <span class="hljs-comment">// FNRE = Foreign Name Registration</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// present in 05/2020 production database: &quot;ARTS&quot;, &quot;S&amp;DC&quot;.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">corporation_type</span> <span class="hljs-operator">=</span> <span class="hljs-number">6</span>;

  <span class="hljs-comment">// Description of the tax-base of the corporation, according to calif. sec.</span>
  <span class="hljs-comment">// of state records. this indicates whether a corporation is for-profit or</span>
  <span class="hljs-comment">// non-profit.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// S = Stock</span>
  <span class="hljs-comment">// N = Non-Stock (Nonprofit)</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">corporation_tax_base</span> <span class="hljs-operator">=</span> <span class="hljs-number">7</span>;

  <span class="hljs-comment">// Additional corporate classifications which may convey special status, such</span>
  <span class="hljs-comment">// as &#x27;religious&#x27; or &#x27;agricultural cooperative&#x27; according to calif. sec. of</span>
  <span class="hljs-comment">// state business entity records.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// AG = Agricultural Cooperative</span>
  <span class="hljs-comment">// CR = Credit Union</span>
  <span class="hljs-comment">// MU = Mutual Benefit</span>
  <span class="hljs-comment">// OC = Other Cooperative</span>
  <span class="hljs-comment">// PB = Public Benefit</span>
  <span class="hljs-comment">// RE = Religious</span>
  <span class="hljs-comment">// SL = Corporation Sole</span>
  <span class="hljs-comment">// UN = Unclassified</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">corporation_classification</span> <span class="hljs-operator">=</span> <span class="hljs-number">8</span>;

  <span class="hljs-comment">// Limited Term expiration date. Format = CCYYMMDD</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">term_expiration_date</span> <span class="hljs-operator">=</span> <span class="hljs-number">9</span>;

  <span class="hljs-comment">// Describes whether this corporation is in good standing with the california</span>
  <span class="hljs-comment">// franchise tax board (ftb).</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// &#x27;&#x27; = Not Suspended (In Good Standing) (empty string)</span>
  <span class="hljs-comment">// F = Forfeited</span>
  <span class="hljs-comment">// S = Suspended</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">ftb_suspension_status</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;

  <span class="hljs-comment">// If this corporation has been subject to action by the franchise tax board</span>
  <span class="hljs-comment">// as described in &#x27;ftb_suspension_status&quot;, then this field contains a string</span>
  <span class="hljs-comment">// representation of the date of that action.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// Date is represented as a string with format &#x27;CCYYMMDD&#x27;.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">ftb_suspension_date</span> <span class="hljs-operator">=</span> <span class="hljs-number">11</span>;

  <span class="hljs-comment">// Statement of information file number, per calif sec of state records.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">so_file_number</span> <span class="hljs-operator">=</span> <span class="hljs-number">12</span>;

  <span class="hljs-comment">// Last complete statement (of information?) file date.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// Date is represented as a string with format &#x27;CCYYMMDD&#x27;.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">so_file_date</span> <span class="hljs-operator">=</span> <span class="hljs-number">13</span>;

  <span class="hljs-comment">// Name of corporation, directly from calif. sec. of state records without</span>
  <span class="hljs-comment">// normalization.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">corporation_name</span> <span class="hljs-operator">=</span> <span class="hljs-number">14</span>;

  <span class="hljs-comment">// &#x27;Care of&#x27; Name, meaning the &#x27;c/o&#x27; addressee which should be included on</span>
  <span class="hljs-comment">// mail intended for the corporation.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">co_name</span> <span class="hljs-operator">=</span> <span class="hljs-number">15</span>;

  <span class="hljs-comment">// Name and contact info of Agent for Service of Process</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// !!! CAUTION !!! Different naming conventions from SOS_LP fields with</span>
  <span class="hljs-comment">// similar info!</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">agent_name</span> <span class="hljs-operator">=</span> <span class="hljs-number">16</span>;
  <span class="hljs-type">string</span> <span class="hljs-variable">agent_address_line_1</span> <span class="hljs-operator">=</span> <span class="hljs-number">17</span>;
  <span class="hljs-type">string</span> <span class="hljs-variable">agent_address_line_2</span> <span class="hljs-operator">=</span> <span class="hljs-number">18</span>;
  <span class="hljs-type">string</span> <span class="hljs-variable">agent_address_city</span> <span class="hljs-operator">=</span> <span class="hljs-number">19</span>;

  <span class="hljs-comment">// The state component of the agent-for-service addr.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> These are not cleaned! Most corps have value &quot;CA&quot;, but some have</span>
  <span class="hljs-comment">// suffixes (intended to indicate county code?)</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// examples of odd entries in 05/2020 production db:</span>
  <span class="hljs-comment">//    &quot;CA 9&quot;, &quot;CA 5126&quot;, &quot;CAA&quot;, &quot;A&quot;.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">agent_address_state_county</span> <span class="hljs-operator">=</span> <span class="hljs-number">20</span>;

  <span class="hljs-comment">// Sometimes these are 5-digit codes, sometimes these are 9-digit.</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> cleanup.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">agent_address_zip_code</span> <span class="hljs-operator">=</span> <span class="hljs-number">21</span>;

  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Describe this field; there&#x27;s no description in the schema document.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// As of 2020/09/09, working understanding is that if the corporation is not</span>
  <span class="hljs-comment">// &#x27;domestic&#x27; (internal to calif.), then this field describes a u.s. state</span>
  <span class="hljs-comment">// other than california, or a country outside the u.s., where this</span>
  <span class="hljs-comment">// corporation originated.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">state_or_foreign_country</span> <span class="hljs-operator">=</span> <span class="hljs-number">22</span>;

  <span class="hljs-comment">// Business entity component id, generated by the evictorbook data pipeline</span>
  <span class="hljs-comment">// via connected component analysis.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// Each SOS_Corp and SOS_LP graph node in the graph is assigned a &#x27;c_id&#x27;.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// Two SOS_Corp and/or SOS_LP graph nodes share a c_id if there exists a</span>
  <span class="hljs-comment">// path connecting those graph nodes in the subgraph of {SOS_Corp|SOS_LP}</span>
  <span class="hljs-comment">// graph nodes and {OFFICER_FOR} edges.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// See the developer guide for a detailed description of the evictorbook&#x27;s</span>
  <span class="hljs-comment">// network connection methodology in the section &quot;Network Connection Method -</span>
  <span class="hljs-comment">// Detailed &gt; During DB Creation&quot;. As of 2020/09/09, c_id assignment is</span>
  <span class="hljs-comment">// described in step &#x27;I&#x27; of that section.</span>
  <span class="hljs-type">int64</span> <span class="hljs-variable">c_id</span> <span class="hljs-operator">=</span> <span class="hljs-number">23</span>;

  <span class="hljs-comment">// Parcel ownership network component id, generated by the evictorbook data</span>
  <span class="hljs-comment">// pipeline via connected component analysis.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// SOS_Corp, SOS_LP, and SOS_Owner graph nodes are required to have a</span>
  <span class="hljs-comment">// network_id, and Address_Unit graph nodes may optionally have a</span>
  <span class="hljs-comment">// network_id. </span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// Two graph nodes share a network_id if there is a path connecting those</span>
  <span class="hljs-comment">// graph nodes in the subgraph of {SOS_Corp|SOS_LP|SOS_Owner|Address_Unit}</span>
  <span class="hljs-comment">// graph nodes and { OFFICER_FOR | ENTITY_OWNED BY | LISTED_AT } edges.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// &#x27;network_id&#x27; components are aggregations of one or more &#x27;c_id&#x27;</span>
  <span class="hljs-comment">// components, connected by a path in the subgraph described above.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// So, graph nodes that share a &#x27;c_id&#x27; also share a &#x27;network_id&#x27;, but graph</span>
  <span class="hljs-comment">// nodes that share a &#x27;network_id&#x27; do NOT NECESSARILY share a &#x27;c_id&#x27;.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// See the developer guide for a detailed description of the evictorbook&#x27;s</span>
  <span class="hljs-comment">// network connection methodology in the section &quot;Network Connection Method -</span>
  <span class="hljs-comment">// Detailed &gt; During DB Creation&quot;. As of 2020/09/09, network_id assignment is</span>
  <span class="hljs-comment">// described in step &#x27;III&#x27;. of that section.</span>
  <span class="hljs-type">int64</span> <span class="hljs-variable">network_id</span> <span class="hljs-operator">=</span> <span class="hljs-number">24</span>;
}

<span class="hljs-comment">// Node type: SOS_Owner</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// A person or business-entity which has an ownership interest in another</span>
<span class="hljs-comment">// business-entity.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> Need clarification on how this related to &#x27;ENTITY_OWNED_BY&#x27; -- it</span>
<span class="hljs-comment">// seems as though if both nodes in the ENTITY_OWNED_BY relationship are</span>
<span class="hljs-comment">// business-entities, then would be difficult to tell which entity owns the</span>
<span class="hljs-comment">// other. Might be missing something here. -dee 10/2020</span>
message CalSOSOwnerData {
  <span class="hljs-comment">// Normalized name of the person or entity who&#x27;s a stakeholder in a</span>
  <span class="hljs-comment">// corporation or limited partnership.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Describe or link specifics of the string normalization.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">name_norm</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

  <span class="hljs-comment">// Network component id of the connected component this owner belongs to.</span>
  <span class="hljs-comment">// This uniquely specifies the ownership network this owner belongs to,</span>
  <span class="hljs-comment">// according to connected component analysis in the evictorbook data</span>
  <span class="hljs-comment">// pipeline.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// For more info about network component id&#x27;s assigned in the evictorbook</span>
  <span class="hljs-comment">// graph, see documentation on &#x27;c_id&#x27; and &#x27;network_id&#x27; in CalSOSLPData and</span>
  <span class="hljs-comment">// CalSOSCorpData.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// See the developer guide for a detailed description of the evictorbook&#x27;s</span>
  <span class="hljs-comment">// network connection methodology in the section &quot;Network Connection Method -</span>
  <span class="hljs-comment">// Detailed &gt; During DB Creation&quot;. As of 2020/09/09, network_id assignment is</span>
  <span class="hljs-comment">// described in step &#x27;III&#x27;. of that section.</span>
  <span class="hljs-type">int64</span> <span class="hljs-variable">network_id</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;
}

<span class="hljs-comment">// Node type: RB_Eviction</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// A record of an eviction which occurred in San Francisco, as represented in</span>
<span class="hljs-comment">// SF Rent Board records.</span>
message SFRentBoardEvictionData {
  <span class="hljs-comment">// Eviction ID, unique in aemp&#x27;s records.</span>
  <span class="hljs-comment">// </span>
  <span class="hljs-comment">// IMPORTANT:  This is derived from the petition ID of the eviction in rent</span>
  <span class="hljs-comment">// board records, but in some cases it&#x27;s appended with a suffix. Therefore,</span>
  <span class="hljs-comment">// it *cannot* safely be used for direct string comparison with RB records.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Document the specifics of the eviction ID suffixes.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Mitigate the impact of the ID shift by preserving the raw petition</span>
  <span class="hljs-comment">// id in this node.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">evict_id</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

  <span class="hljs-comment">// Format: CCYYMMDD</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">evict_date</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;

  <span class="hljs-comment">// Buyout amount in USD, if applicable.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">amount</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;

  <span class="hljs-comment">// Number of units whose occupants were evicted, if known.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">units</span> <span class="hljs-operator">=</span> <span class="hljs-number">4</span>;

  <span class="hljs-comment">// Type of eviction, for example &quot;Buyout Declaration&quot; or &quot;Ellis Act</span>
  <span class="hljs-comment">// Withdrawal&quot;.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Enumerate all legal values here. Eventually, consider replacing</span>
  <span class="hljs-comment">// this with an enum.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">type</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;

  <span class="hljs-comment">// Attributed evictors according to ellis act withdrawal records. Only</span>
  <span class="hljs-comment">// populated for evictions of type &quot;Ellis Act Withdrawal&quot;.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// TODO Verify semantics. Ad-hoc testing on EB Web shows a list of multiple</span>
  <span class="hljs-comment">// ellis evictors, which appear to be derived from interpreting a string as a</span>
  <span class="hljs-comment">// comma-separated list. As of 2020/09/09, the relationship between this</span>
  <span class="hljs-comment">// string and the EB Web api is not well documented.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">ellis_evictor</span> <span class="hljs-operator">=</span> <span class="hljs-number">6</span>;
}

<span class="hljs-comment">// Node type: RB_Evictor </span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Represents a person or entity who instigated an eviction, according to</span>
<span class="hljs-comment">// information from sales transfer records.</span>
message SFRentBoardEvictorData {
  <span class="hljs-comment">// Name of the entity that instigated the eviction, as it appears in</span>
  <span class="hljs-comment">// documents relating to the eviction. This may be an individual or a</span>
  <span class="hljs-comment">// business.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// TODO Describe whether and how this string was normalized.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">evictor</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
}

<span class="hljs-comment">// Node type: Address_Main</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Full address, without unit. May represent the address of a parcel&#x27;s owner,</span>
<span class="hljs-comment">// or an address associated with a business entity or one of its officers.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// &#x27;Address_Main&#x27; represents a conceptual &#x27;anchor&#x27; or entry point for all</span>
<span class="hljs-comment">// possible units at a given top-level street address. In contrast, its</span>
<span class="hljs-comment">// counterpart &#x27;Address_Unit&#x27; represents a &#x27;resolved&#x27; address that can</span>
<span class="hljs-comment">// actually be contacted, with unit number if applicable. See details in</span>
<span class="hljs-comment">// Address_Unit description below.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Consider a structured representation of the address for more robust</span>
<span class="hljs-comment">// comparisons.</span>
message AddressMainData {
  <span class="hljs-comment">// The address, represented as a single string.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Describe format guidelines -- does this need a city and zip, for</span>
  <span class="hljs-comment">// example?</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Describe whether and how this string was normalized.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">addr</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
}

<span class="hljs-comment">// Node type: Address_Unit</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Represents a resolved address, with unit number if necessary, which can be</span>
<span class="hljs-comment">// contacted by mail or visited in person. May represent the address of a</span>
<span class="hljs-comment">// parcel&#x27;s owner, or an address associated with a business entity or one of</span>
<span class="hljs-comment">// its officers.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// This node exists even for addresses which contain only a single unit. See</span>
<span class="hljs-comment">// description of Address_Main above. Single-unit addresses are considered to</span>
<span class="hljs-comment">// be a special case, where the conceptual &#x27;main&#x27; address happens to</span>
<span class="hljs-comment">// correspond to the &#x27;resolved&#x27; (unit-level) address.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Address_Unit graph nodes are analysed with connected component analysis,</span>
<span class="hljs-comment">// and the network_id of the address&#x27;s component is stored in this node.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Consider a structured representation for more robust comparisons, as</span>
<span class="hljs-comment">// with Address_Main above.</span>
message AddressUnitData {
  <span class="hljs-comment">// The address, represented as a single string.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Describe format guidelines -- does this need a city and zip, for</span>
  <span class="hljs-comment">// example?</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Describe whether and how this string was normalized.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">addr</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

  <span class="hljs-comment">// Network component id of the business-network component which is primarily</span>
  <span class="hljs-comment">// associated with this unit-level address.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// These network component id&#x27;s are assigned during component analysis in the</span>
  <span class="hljs-comment">// evictorbook data pipeline.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// For more info about network component id&#x27;s assigned in the evictorbook</span>
  <span class="hljs-comment">// graph, see documentation on &#x27;c_id&#x27; and &#x27;network_id&#x27; in CalSOSLPData and</span>
  <span class="hljs-comment">// CalSOSCorpData messages.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// See the developer guide for a detailed description of the evictorbook&#x27;s</span>
  <span class="hljs-comment">// network connection methodology in the section &quot;Network Connection Method -</span>
  <span class="hljs-comment">// Detailed &gt; During DB Creation&quot;. As of 2020/09/09, network_id assignment is</span>
  <span class="hljs-comment">// described in step &#x27;III&#x27;. of that section.</span>
  <span class="hljs-type">int64</span> <span class="hljs-variable">network_id</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;
}

</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemaslegacyprotographrelations.proto"><a href="#toc"><a name="server-schemas-legacy-proto-graph-relations-proto">server/schemas/legacy/proto/graph/relations.proto</a></a></h2>
<pre><code><span class="hljs-comment">// relations.proto</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// This file contains message definitions that conceptually represent the</span>
<span class="hljs-comment">// relations (edges) connecting nodes in the evictorbook graph database. </span>
syntax = <span class="hljs-string">&quot;proto3&quot;</span>;

<span class="hljs-keyword">package</span> graph;

<span class="hljs-comment">// Represents a single relation (edge) in the graph.</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">RelationDetails</span> </span>{
  <span class="hljs-comment">////////////////////////////////////////////</span>
  <span class="hljs-comment">// fields representing neo4j db internals:</span>
  <span class="hljs-comment">////////////////////////////////////////////</span>

  <span class="hljs-comment">// string containing the type of the relation.</span>
  <span class="hljs-built_in">string</span> type = <span class="hljs-number">1</span>;

  <span class="hljs-comment">// internal neo4j id for the start node.</span>
  <span class="hljs-built_in">int64</span> start_identity = <span class="hljs-number">2</span>;

  <span class="hljs-comment">// internal neo4j id for the end node.</span>
  <span class="hljs-built_in">int64</span> end_identity = <span class="hljs-number">3</span>;

  <span class="hljs-comment">////////////////////////////////////////////</span>
  <span class="hljs-comment">// fields representing eb graph semantics: </span>
  <span class="hljs-comment">////////////////////////////////////////////</span>

  <span class="hljs-comment">// type, as an enum specific to eb graph semantics. the value names of this</span>
  <span class="hljs-comment">// enum correspond to the string values used for &#x27;type&#x27;.</span>
  RelationType relation_type = <span class="hljs-number">4</span>;

  <span class="hljs-comment">// semantic unique key for start node.</span>
  <span class="hljs-built_in">string</span> start_string_key = <span class="hljs-number">5</span>;

  <span class="hljs-comment">// semantic unique string key for end node (destination).</span>
  <span class="hljs-built_in">string</span> end_string_key = <span class="hljs-number">6</span>;

  <span class="hljs-comment">// data payload. describes annotations on the graph relations (such as</span>
  <span class="hljs-comment">// weights on an edge, or additional properties or flags).</span>
  <span class="hljs-comment">// </span>
  <span class="hljs-comment">// for relation types with no annotations, we define a placeholder message so</span>
  <span class="hljs-comment">// there&#x27;s a place to add them if needed.</span>
  <span class="hljs-keyword">oneof</span> data {
    EvictedByRelationData evicted_by_relation_data = <span class="hljs-number">7</span>;
    EvictionAtRelationData eviction_located_at_relation_data = <span class="hljs-number">8</span>;
    ListedAtRelationData business_listed_at_relation_data = <span class="hljs-number">9</span>;
    EntityOwnedByRelationData business_entity_owned_by_relation_data = <span class="hljs-number">10</span>;
    OfficerForRelationData business_officer_for_relation_data = <span class="hljs-number">11</span>;
    BELinkedToRelationData
        owner_or_evictor_linked_to_business_relation_data = <span class="hljs-number">12</span>;
    ParcOwnedByRelationData parcel_owned_by_relation_data = <span class="hljs-number">13</span>;
    UnitAtRelationData unit_at_relation_data = <span class="hljs-number">14</span>;
    ParcelOwnerAtAddressRelationData
        parcel_owner_at_address_relation_data = <span class="hljs-number">15</span>;
  }
}

<span class="hljs-comment">// RelationType</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Type enum for the potential connections between nodes in the ebook graph.</span>
<span class="hljs-comment">// For more details see comments on the &#x27;RelationData&#x27; messages below.</span>
<span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">RelationType</span> </span>{
  <span class="hljs-comment">// Default value. Treat as unset.</span>
  RELATION_TYPE_UNSPECIFIED = <span class="hljs-number">0</span>;

  <span class="hljs-comment">// Relation type: EVICTED_BY</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// Represents a hypothesis attributing an individual for being responsible in</span>
  <span class="hljs-comment">// insigating an eviction.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// See EvictedByRelationData description for details.</span>
  EVICTED_BY = <span class="hljs-number">1</span>;

  <span class="hljs-comment">// Relation type: EVICTION_AT</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// Associates an SF Rent Board eviction record with the dwelling from which</span>
  <span class="hljs-comment">// one or more tenants were evicted.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// See EvictionAtRelationData description for details.</span>
  EVICTION_AT = <span class="hljs-number">2</span>;

  <span class="hljs-comment">// Relation type: LISTED_AT</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// Describes an address associated with a business entity in Secretary of</span>
  <span class="hljs-comment">// state records.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// See ListedAtRelationData description for details.</span>
  LISTED_AT = <span class="hljs-number">3</span>;
  
  <span class="hljs-comment">// Relation type: ENTITY_OWNED_BY</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// Indicates that an SOS_Owner has a stake in a SOS business entity (the</span>
  <span class="hljs-comment">// target entity may be either a limited business (LP) or a corporation</span>
  <span class="hljs-comment">// (Corp)).</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// See EntityOwnedByRelationData description for details.</span>
  ENTITY_OWNED_BY = <span class="hljs-number">4</span>;

  <span class="hljs-comment">// Relation type: OFFICER_FOR</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// Indicates that one business entity is an officer for another business</span>
  <span class="hljs-comment">// entity (which seems pretty weird).</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// See OfficerForRelationData description for details.</span>
  OFFICER_FOR = <span class="hljs-number">5</span>;

  <span class="hljs-comment">// Relation type: BE_LINKED_TO</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// Connects a business node (SOS_Corp or SOS_LP) to a parcel-owner or</span>
  <span class="hljs-comment">// attributed evictor (A_Parcel_Owner or RB_Evictor).</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// The A_Parcel_Owner or RB_Evictor is considered to *be* the business. That</span>
  <span class="hljs-comment">// is, this means we believe the business is the same entity as the reported</span>
  <span class="hljs-comment">// owner or evictor. This is based on string matching the names of the</span>
  <span class="hljs-comment">// recorded owner/attributed evictor with the names of businesses from</span>
  <span class="hljs-comment">// california sec. of state business data.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// See BELinkedToRelationData description for details.</span>
  BE_LINKED_TO = <span class="hljs-number">6</span>;

  <span class="hljs-comment">// Relation type: PARC_OWNED_BY</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// Describes a direct owner relationship between a parcel and an</span>
  <span class="hljs-comment">// individual/entity that&#x27;s listed as an owner via assessor property tax</span>
  <span class="hljs-comment">// records.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// See ParcelOwnedByRelationData description for details.</span>
  PARC_OWNED_BY = <span class="hljs-number">7</span>;

  <span class="hljs-comment">// Relation type: UNIT_AT</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// Indicates that an Address_Unit node correponds to the main parcel address</span>
  <span class="hljs-comment">// at Address_Main.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// See UnitAtRelationData description for details.</span>
  UNIT_AT = <span class="hljs-number">8</span>;

  <span class="hljs-comment">// Relation type: PARC_OWNER_ADDR_AT</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// Indicates that a parcel owner can be reached at this mailing address.</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Clarify, does this mean the address is listed as owner occupied? Or</span>
  <span class="hljs-comment">// is this derived from some other signal?</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// See ParcelOwnerAtAddressRelationData description for details.</span>
  PARC_OWNER_ADDR_AT = <span class="hljs-number">9</span>;
}

<span class="hljs-comment">// Relation type: EVICTED_BY</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Represents a hypothesis attributing an individual for being responsible in</span>
<span class="hljs-comment">// insigating an eviction.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Start node: RB_Eviction node describing SF Rent Board eviction record,</span>
<span class="hljs-comment">// keyed by unique id. Note that evictorbook graph unique ID&#x27;s for evictions</span>
<span class="hljs-comment">// may differ from id&#x27;s in other databases because a one-character suffix is</span>
<span class="hljs-comment">// sometimes appended. <span class="hljs-doctag">TODO:</span> Describe details.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// End node: RB_Evictor node describing an individual believed to be</span>
<span class="hljs-comment">// responsible for instigating the eviction.</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">EvictedByRelationData</span> </span>{
  <span class="hljs-comment">// todo clarify semantics.</span>
  <span class="hljs-built_in">bool</span> multiple_sales_matches = <span class="hljs-number">1</span>;
}

<span class="hljs-comment">// Relation type: EVICTION_AT</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Associates an SF Rent Board eviction record with the dwelling from which</span>
<span class="hljs-comment">// one or more tenants were evicted.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Start node: RB_Eviction node describing SF Rent Board eviction record,</span>
<span class="hljs-comment">// keyed by unique id. See caveat on eviction id&#x27;s in comments for</span>
<span class="hljs-comment">// EvictedByRelationData, above.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// End node: A_Parcel node, describing a parcel from SF Assessor</span>
<span class="hljs-comment">// records, keyed by the parcel&#x27;s unique &quot;block lot&quot;.</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">EvictionAtRelationData</span> </span>{
  <span class="hljs-comment">// todo clarify semantics.</span>
  <span class="hljs-built_in">bool</span> multiple_addr_matches = <span class="hljs-number">1</span>;
}

<span class="hljs-comment">// Relation type: LISTED_AT</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Describes an address associated with a business entity in Secretary of</span>
<span class="hljs-comment">// state records.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Clarify the semantic meaning of this address; I believe it&#x27;s a</span>
<span class="hljs-comment">// mailing address but need to confirm.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Start node: SOS_Corp or SOS_LP node, identified by its unique normalized</span>
<span class="hljs-comment">// business name in the California Sec. of State business registry.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// End node: Address_Unit describing a unit-level address at which</span>
<span class="hljs-comment">// this business entity can be contacted.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Empty as of 2020/12/29, as the relation carries no data payload other than</span>
<span class="hljs-comment">// the fact of its own presence.</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">ListedAtRelationData</span> </span>{
}

<span class="hljs-comment">// Relation type: ENTITY_OWNED_BY</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Indicates that an SOS_Owner has a stake in a SOS business entity (the</span>
<span class="hljs-comment">// target entity may be either a limited business (LP) or a corporation</span>
<span class="hljs-comment">// (Corp)).</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Start node: SOS_Corp or SOS_LP node, identified by its unique normalized</span>
<span class="hljs-comment">// business name in the California Sec. of State business registry.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// End node: SOS_Owner node, identified by the normalized name of that</span>
<span class="hljs-comment">// owner in the California Sec. of State business registry.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> This collapsing of all identically-named owners in the business</span>
<span class="hljs-comment">// registry is the likely the source of over-connections in our graph</span>
<span class="hljs-comment">// methodology, and is on the list of items to revisit as we revise the</span>
<span class="hljs-comment">// pipeline.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Empty as of 2020/12/29, as the relation carries no data payload other than</span>
<span class="hljs-comment">// the fact of its own presence.</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">EntityOwnedByRelationData</span> </span>{
}

<span class="hljs-comment">// Relation type: OFFICER_FOR</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Indicates that one business entity is an officer for another business</span>
<span class="hljs-comment">// entity (which seems pretty weird).</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Start node: The &#x27;serving&#x27; SOS_LP or SOS_Corp node, identified by its</span>
<span class="hljs-comment">// unique business name in the California Sec. of State business index.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// End: The &#x27;served at&#x27; SOS_LP or SOS_Corp node, identified by the</span>
<span class="hljs-comment">// same means as the start node.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Empty as of 2020/12/29, as the relation carries no data payload other than</span>
<span class="hljs-comment">// the fact of its own presence.</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">OfficerForRelationData</span> </span>{
}

<span class="hljs-comment">// Relation type: BE_LINKED_TO</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Connects a business node (SOS_Corp or SOS_LP) to a parcel-owner or</span>
<span class="hljs-comment">// attributed evictor (A_Parcel_Owner or RB_Evictor).</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// The A_Parcel_Owner or RB_Evictor is considered to *be* the business. That</span>
<span class="hljs-comment">// is, this means we believe the business is the same entity as the reported</span>
<span class="hljs-comment">// owner or evictor. This is based on string matching the names of the</span>
<span class="hljs-comment">// recorded owner/attributed evictor with the names of businesses from</span>
<span class="hljs-comment">// california sec. of state business data.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Start node: RB_Evictor or A_Parcel_Owner node, identifying an agent</span>
<span class="hljs-comment">// believed to have instigated an eviction from SF Rent Board records, or a</span>
<span class="hljs-comment">// property-holding entity described in SF Assessor data.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// End node: SOS_LP or SOS_Corp node representing a business entity in</span>
<span class="hljs-comment">// California Sec of State index, which is believed to be acting in the role of</span>
<span class="hljs-comment">// parcel owner or attributed evictor.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Empty, as this relation carries no data payload other than the fact of its</span>
<span class="hljs-comment">// own presence.</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">BELinkedToRelationData</span> </span>{
}

<span class="hljs-comment">// Relation type: PARC_OWNED_BY</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Describes a direct owner relationship between a parcel and an</span>
<span class="hljs-comment">// individual/entity that&#x27;s listed as an owner via assessor property tax</span>
<span class="hljs-comment">// records.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Start node: A_Parcel node from SF Assessor records, identified by &#x27;block</span>
<span class="hljs-comment">// lot&#x27;.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// End node: A_Parcel_Owner node from SF Assessor records, identified</span>
<span class="hljs-comment">// by name directly in the documentation for the start node&#x27;s real-estate</span>
<span class="hljs-comment">// parcel.</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">ParcOwnedByRelationData</span> </span>{
  <span class="hljs-comment">// Ownership percentage documented in SF Assessor records, expressed as an</span>
  <span class="hljs-comment">// integer between 0 and 100, inclusive.</span>
    <span class="hljs-built_in">int32</span> perc_owner = <span class="hljs-number">1</span>;

  <span class="hljs-comment">// Date in CCYYMMDD of the documents in SF Assessor records which</span>
  <span class="hljs-comment">// demonstrate this ownership.</span>
    <span class="hljs-built_in">string</span> record_date = <span class="hljs-number">2</span>;
}

<span class="hljs-comment">// Relation type: UNIT_AT</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Indicates that an Address_Unit node correponds to the main parcel address</span>
<span class="hljs-comment">// at Address_Main.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// This edge exists even for addresses which contain only a single unit. The</span>
<span class="hljs-comment">// reason is that &#x27;Address_Main&#x27; nodes conceptually represent the entire set</span>
<span class="hljs-comment">// of possible units at that street address, whereas &#x27;Address_Unit&#x27; nodes</span>
<span class="hljs-comment">// represent a resolved address that can actually be contacted. Single-unit</span>
<span class="hljs-comment">// addresses are considered to be a special case where there happens to be a</span>
<span class="hljs-comment">// one-to-one correspondence between the two.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Start node: Address_Unit node representing a definite, contactable address</span>
<span class="hljs-comment">// complete with unit number. <span class="hljs-doctag">TODO:</span> Describe formatting of that node&#x27;s key.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// End node: Address_Main node, identified by an address with the unit</span>
<span class="hljs-comment">// information scrubbed, which represents all potential units at that street</span>
<span class="hljs-comment">// address. <span class="hljs-doctag">TODO:</span> Describe formatting of that node&#x27;s key.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Empty as of 2020/12/29, as the relation carries no data payload other than</span>
<span class="hljs-comment">// the fact of its own presence.</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">UnitAtRelationData</span> </span>{
}

<span class="hljs-comment">// Relation type: PARC_OWNER_ADDR_AT</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Indicates that a parcel owner can be reached at this mailing address.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Clarify whether this indicates the address was listed as</span>
<span class="hljs-comment">// owner-occupied, as this may be relevant information.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Start node: A_Parcel_Owner node, describing a property owner identified by</span>
<span class="hljs-comment">// name in SF Assessor records.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// End node: Address_Unit node representing a resolved street address, with</span>
<span class="hljs-comment">// unit number if applicable. SF Assessor records indicate that the owner can</span>
<span class="hljs-comment">// be contacted by mail at this address.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Empty as of 2020/12/29, as the relation carries no data payload other than</span>
<span class="hljs-comment">// the fact of its own presence.</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">ParcelOwnerAtAddressRelationData</span> </span>{
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemaslegacyprotoquerybusiness.proto"><a href="#toc"><a name="server-schemas-legacy-proto-query-business-proto">server/schemas/legacy/proto/query/business.proto</a></a></h2>
<pre><code><span class="hljs-comment">// query/business.proto</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// contains messages related to corporations and other businesses from the</span>
<span class="hljs-comment">// calif sec. of state business registry, as they appear in ebook&#x27;s query</span>
<span class="hljs-comment">// abstraction layer.</span>
syntax = <span class="hljs-string">&quot;proto3&quot;</span>;

<span class="hljs-keyword">package</span> query;

<span class="hljs-comment">////////////////////////////////////////</span>
<span class="hljs-comment">//  corp / lp / business  messages</span>
<span class="hljs-comment">////////////////////////////////////////</span>

<span class="hljs-comment">// fields in this message correspond to fields of the same name in SOS_Corp</span>
<span class="hljs-comment">// vertices in the neo4j schema. proto messages describing that schema are</span>
<span class="hljs-comment">// found in the graph/ directory.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// as of 2020/09/26, this is a direct clone of the graph node schema, with one</span>
<span class="hljs-comment">// exception: this message is missing the normalized corporation name</span>
<span class="hljs-comment">// &#x27;name_norm&#x27;, which serves as a unique key. although the two are currently</span>
<span class="hljs-comment">// very similar, we prefer to define two separate messages to allow for the</span>
<span class="hljs-comment">// schema and the query abstraction to evolve independently.</span>
message CalSOSCorporationDetails {
  <span class="hljs-comment">// transaction date of the document which established this corporation,</span>
  <span class="hljs-comment">// according to the california secretary of state business registry.</span>
  <span class="hljs-comment">// </span>
  <span class="hljs-comment">// format: &#x27;CCMMYYDD&#x27;.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">transaction_date</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

  <span class="hljs-comment">// an 8 digit corporate identification number, from the california secretary</span>
  <span class="hljs-comment">// of state business registry.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">corporation_number</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;

  <span class="hljs-comment">// date on which this corporation was incorporated, according to the</span>
  <span class="hljs-comment">// california secretary of state business registry.</span>
  <span class="hljs-comment">// format: &#x27;CCYYMMDD&#x27;</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">incorporation_date</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;

  <span class="hljs-comment">// status of the corporation, as a string containing a code from calif. sec.</span>
  <span class="hljs-comment">// of state business entity records. The values are described as follows in</span>
  <span class="hljs-comment">// the database schema documentation:</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// 1 = Active</span>
  <span class="hljs-comment">// 2 = Suspended</span>
  <span class="hljs-comment">// 3 = Canceled</span>
  <span class="hljs-comment">// 4 = Surrendered</span>
  <span class="hljs-comment">// 5 = Term expired</span>
  <span class="hljs-comment">// 6 = Dissolved</span>
  <span class="hljs-comment">// 7 = Forfeited</span>
  <span class="hljs-comment">// 8 = Deleted</span>
  <span class="hljs-comment">// 9 = Inactive</span>
  <span class="hljs-comment">// C = Merged Out</span>
  <span class="hljs-comment">// E = State to Federal Bank Conversion</span>
  <span class="hljs-comment">// F = Conditionally dissolved (No tax clearance)</span>
  <span class="hljs-comment">// Not sure about code = Converted Out</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">corporation_status</span> <span class="hljs-operator">=</span> <span class="hljs-number">4</span>;

  <span class="hljs-comment">// description of the legal process used to establish this corporation,</span>
  <span class="hljs-comment">// according to Calif. Sec. of state records. The allowed values and their</span>
  <span class="hljs-comment">// meanings are listed below.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// ARTS = Articles of Incorporation</span>
  <span class="hljs-comment">// S&amp;DC = Statement &amp; Designation By Foreign Corporation</span>
  <span class="hljs-comment">// S&amp;DA = Statement &amp; Designation By Foreign Association</span>
  <span class="hljs-comment">// FNRE = Foreign Name Registration</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">corporation_type</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;

  <span class="hljs-comment">// description of the tax-base of the corporation, according to calif. sec.</span>
  <span class="hljs-comment">// of state records. this indicates whether a corporation is for-profit or</span>
  <span class="hljs-comment">// non-profit.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// S = Stock</span>
  <span class="hljs-comment">// N = Non-Stock (Nonprofit)</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">corporation_tax_base</span> <span class="hljs-operator">=</span> <span class="hljs-number">6</span>;

  <span class="hljs-comment">// additional corporate classifications which may convey special status, such</span>
  <span class="hljs-comment">// as &#x27;religious&#x27; or &#x27;agricultural cooperative&#x27; according to calif. sec. of</span>
  <span class="hljs-comment">// state business entity records.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// G = Agricultural Cooperative</span>
  <span class="hljs-comment">// CR = Credit Union</span>
  <span class="hljs-comment">// MU = Mutual Benefit</span>
  <span class="hljs-comment">// OC = Other Cooperative</span>
  <span class="hljs-comment">// PB = Public Benefit</span>
  <span class="hljs-comment">// RE = Religious</span>
  <span class="hljs-comment">// SL = Corporation Sole</span>
  <span class="hljs-comment">// UN = Unclassified</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">corporation_classification</span> <span class="hljs-operator">=</span> <span class="hljs-number">7</span>;

  <span class="hljs-comment">// limited term expiration date.</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> describe what this means.</span>
  <span class="hljs-comment">// format: &#x27;CCYYMMDD&#x27;</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">term_expiration_date</span> <span class="hljs-operator">=</span> <span class="hljs-number">8</span>;

  <span class="hljs-comment">// describes whether this corporation is in good standing with the california</span>
  <span class="hljs-comment">// franchise tax board (ftb).</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// ‘ ‘ (Blank) = Not Suspended (In Good Standing)</span>
  <span class="hljs-comment">// F = Forfeited</span>
  <span class="hljs-comment">// S = Suspended</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">ftb_suspension_status</span> <span class="hljs-operator">=</span> <span class="hljs-number">9</span>;

  <span class="hljs-comment">// if this corporation has been subject to action by the franchise tax board</span>
  <span class="hljs-comment">// as described in &#x27;ftb_suspension_status&#x27;, then this field contains a string</span>
  <span class="hljs-comment">// representation of the date of that action.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// format: &#x27;CCYYMMDD&#x27;</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">ftb_suspension_date</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;

  <span class="hljs-comment">// statement of information file number, per calif sec of state records.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">so_file_number</span> <span class="hljs-operator">=</span> <span class="hljs-number">11</span>;

  <span class="hljs-comment">// last complete statement (of information?) file date.</span>
  <span class="hljs-comment">// format: &#x27;CCYYMMDD&#x27;</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">so_file_date</span> <span class="hljs-operator">=</span> <span class="hljs-number">12</span>;

  <span class="hljs-comment">// name of corporation, directly from calif. sec. of state records without</span>
  <span class="hljs-comment">// normalization.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">corporation_name</span> <span class="hljs-operator">=</span> <span class="hljs-number">13</span>;

  <span class="hljs-comment">// &#x27;care of&#x27; name, meaning the &#x27;c/o&#x27; addressee which should be included on</span>
  <span class="hljs-comment">// mail intended for the corporation.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">co_name</span> <span class="hljs-operator">=</span> <span class="hljs-number">14</span>;

  <span class="hljs-comment">// name of agent of process, as it appears on mailing address.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">agent_name</span> <span class="hljs-operator">=</span> <span class="hljs-number">15</span>;

  <span class="hljs-comment">// mailing address for agent of process, line 1.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">agent_address_line_1</span> <span class="hljs-operator">=</span> <span class="hljs-number">16</span>;

  <span class="hljs-comment">// mailing address for agent of process, line 2.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">agent_address_line_2</span> <span class="hljs-operator">=</span> <span class="hljs-number">17</span>;

  <span class="hljs-comment">// city component of agent of process&#x27;s mailing address.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">agent_address_city</span> <span class="hljs-operator">=</span> <span class="hljs-number">18</span>;

  <span class="hljs-comment">// todo: clarify what this means. is it state or county? or both????</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">agent_address_state_county</span> <span class="hljs-operator">=</span> <span class="hljs-number">19</span>;

  <span class="hljs-comment">// todo: clarify whether these are 5-digit or 9-digit postal codes.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">agent_address_zip_code</span> <span class="hljs-operator">=</span> <span class="hljs-number">20</span>;

  <span class="hljs-comment">// if the corporation is not &#x27;domestic&#x27; (internal to calif.), then this field</span>
  <span class="hljs-comment">// specified a u.s. state other than california, or a country outside the</span>
  <span class="hljs-comment">// u.s., where this corporation originated.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">state_or_foreign_country</span> <span class="hljs-operator">=</span> <span class="hljs-number">23</span>;

  <span class="hljs-comment">// business entity component id, generated by the evictorbook data pipeline</span>
  <span class="hljs-comment">// via connected component analysis.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// See comments inline in BusinessNetworkIdentifier from network.proto for</span>
  <span class="hljs-comment">// a detailed explanation.</span>
  <span class="hljs-type">int64</span> <span class="hljs-variable">c_id</span> <span class="hljs-operator">=</span> <span class="hljs-number">24</span>;

  <span class="hljs-comment">// parcel ownership network component id, generated by the evictorbook data</span>
  <span class="hljs-comment">// pipeline via connected component analysis.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// SOS_Corp, SOS_LP, and SOS_Owner vertices are required to have a</span>
  <span class="hljs-comment">// network_id, and Address_Unit vertices may optionally have a network_id. </span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// See comments inline in BusinessNetworkIdentifier from network.proto for</span>
  <span class="hljs-comment">// a detailed explanation.</span>
  <span class="hljs-type">int64</span> <span class="hljs-variable">network_id</span> <span class="hljs-operator">=</span> <span class="hljs-number">25</span>;
}

<span class="hljs-comment">// closely follows CalSOSLimitedBusinessData in the graph proto defintion.</span>
<span class="hljs-comment">// we define a message here, to allow for the graph schema and the query</span>
<span class="hljs-comment">// abstraction to evolve separately.</span>
message CalSOSLimitedBusinessDetails {
  <span class="hljs-comment">// llc only: state or county for formation of foreign llc.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> confirm/deny that this is unset for messages representing limited</span>
  <span class="hljs-comment">// partnerships.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">jurisdiction_llc</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
 
  <span class="hljs-comment">// llc only: management structure.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// 1 = One Manager</span>
  <span class="hljs-comment">// M = More Than One Manager</span>
  <span class="hljs-comment">// A = All Members are Managers</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// todo: confirm/deny that this is unset for messages representing limited</span>
  <span class="hljs-comment">// partnerships.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">llc_management_code</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;

  <span class="hljs-comment">// llc only: type of business.</span>
  <span class="hljs-comment">// todo: provide examples.</span>
  <span class="hljs-comment">// todo: confirm/deny that this is unset for messages representing limited</span>
  <span class="hljs-comment">// partnerships.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">llc_type_of_business</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;

  <span class="hljs-comment">// the filing number of the business entity, which is derived from the date</span>
  <span class="hljs-comment">// on which its filing paperwork was filed. the number is presented as a</span>
  <span class="hljs-comment">// string, with the format described below:</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// format: &#x27;CCYYJJJN9999&#x27;</span>
  <span class="hljs-comment">//   CCYY = century and year</span>
  <span class="hljs-comment">//   JJJ = julian day of year</span>
  <span class="hljs-comment">//   N = record type:</span>
  <span class="hljs-comment">//       0 = lp record</span>
  <span class="hljs-comment">//       1 = llc record</span>
  <span class="hljs-comment">//   9999 = sequence number </span>
  <span class="hljs-type">string</span> <span class="hljs-variable">file_number</span> <span class="hljs-operator">=</span> <span class="hljs-number">4</span>;

  <span class="hljs-comment">// date of original filing for this business. represents the same calendar</span>
  <span class="hljs-comment">// date as the date component of file_number, but follows a different format.</span>
  <span class="hljs-comment">// format: &#x27;CCYYMMDD&#x27;</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">file_date</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;

  <span class="hljs-comment">//  identifies current status of lp/llc, as represented in calif. sec. of</span>
  <span class="hljs-comment">//  state business entity records.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">//  A : active</span>
  <span class="hljs-comment">//  B : dishonored check</span>
  <span class="hljs-comment">//  C : canceled</span>
  <span class="hljs-comment">//  D : dissolved</span>
  <span class="hljs-comment">//  P : pending cancellation</span>
  <span class="hljs-comment">//  F : franchise tax board (ftb) suspended/forfeited</span>
  <span class="hljs-comment">//  M : merged out</span>
  <span class="hljs-comment">//  O : converted out</span>
  <span class="hljs-comment">//  S : secretary of state (sos) suspended/forfeited</span>
  <span class="hljs-comment">//  2 : sos/ftb suspended/forfeited</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">status</span> <span class="hljs-operator">=</span> <span class="hljs-number">6</span>; 

  <span class="hljs-comment">// filing type (foreign or domestic) of this lp or llc, as represented in</span>
  <span class="hljs-comment">// calif. sec. of state business entity registry. </span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// todo: clarify behavior for partnerships that originate from other u.s.</span>
  <span class="hljs-comment">// states.</span>
  <span class="hljs-comment">// todo: clarify the precise values that can be returned by the database.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">filing_type</span> <span class="hljs-operator">=</span> <span class="hljs-number">7</span>;

  <span class="hljs-comment">// the raw, non-normalized name of this calif. limited partnership or llc,</span>
  <span class="hljs-comment">// as represented in calif. sec. of state business entity registry.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> <span class="hljs-number">8</span>;

  <span class="hljs-comment">// state or country of formation for foreign limited partnerships.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">jurisdiction</span> <span class="hljs-operator">=</span> <span class="hljs-number">9</span>;

  <span class="hljs-comment">// name of agent of process, as it appears on mailing address.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">agent_name</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;

  <span class="hljs-comment">// mailing address for agent of process, line 1.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// CAUTION: naming convention differs from similar field in corp details.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">agent_address_1</span> <span class="hljs-operator">=</span> <span class="hljs-number">11</span>;

  <span class="hljs-comment">// mailing address for agent of process, line 2.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// CAUTION: naming convention differs from similar field in corp details.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">agent_address_2</span> <span class="hljs-operator">=</span> <span class="hljs-number">12</span>;

  <span class="hljs-comment">// city component of agent of process&#x27;s mailing address.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// CAUTION: naming convention differs from similar field in corp details.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">agent_city</span> <span class="hljs-operator">=</span> <span class="hljs-number">13</span>;

  <span class="hljs-comment">// component of agent of process&#x27;s mailing address.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// CAUTION: naming convention differs from similar field in corp details.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">agent_state</span> <span class="hljs-operator">=</span> <span class="hljs-number">14</span>;

  <span class="hljs-comment">// todo: clarify whether these are 5-digit or 9-digit postal codes.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// CAUTION: naming convention differs from similar field in corp details.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">agent_zip</span> <span class="hljs-operator">=</span> <span class="hljs-number">15</span>;

  <span class="hljs-comment">// cause of termination, if this lp/llc has been terminated. </span>
  <span class="hljs-comment">// todo: add examples.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">term</span> <span class="hljs-operator">=</span> <span class="hljs-number">16</span>;

  <span class="hljs-comment">// business entity component id, generated by the evictorbook data pipeline</span>
  <span class="hljs-comment">// via connected component analysis.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// see comments inline in BusinessNetworkIdentifier from network.proto for</span>
  <span class="hljs-comment">// a detailed explanation.</span>
  <span class="hljs-type">int64</span> <span class="hljs-variable">c_id</span> <span class="hljs-operator">=</span> <span class="hljs-number">17</span>;

  <span class="hljs-comment">// parcel ownership network component id, generated by the evictorbook data</span>
  <span class="hljs-comment">// pipeline via connected component analysis.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// SOS_Corp, SOS_LP, and SOS_Owner nodes are required to have a network_id,</span>
  <span class="hljs-comment">// and Address_Unit nodes may optionally have a network_id. </span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// see comments inline in BusinessNetworkIdentifier from network.proto for</span>
  <span class="hljs-comment">// a detailed explanation.</span>
  <span class="hljs-type">int64</span> <span class="hljs-variable">network_id</span> <span class="hljs-operator">=</span> <span class="hljs-number">18</span>;
}

</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemaslegacyprotoqueryeviction.proto"><a href="#toc"><a name="server-schemas-legacy-proto-query-eviction-proto">server/schemas/legacy/proto/query/eviction.proto</a></a></h2>
<pre><code><span class="hljs-comment">// query/eviction.proto</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// contains messages related to eviction records as they appear in the</span>
<span class="hljs-comment">// query-layer abstraction of ebook&#x27;s serving js. </span>
syntax = <span class="hljs-string">&quot;proto3&quot;</span>;

<span class="hljs-keyword">import</span> <span class="hljs-string">&quot;network.proto&quot;</span>;

<span class="hljs-keyword">package</span> query;

<span class="hljs-comment">////////////////////////</span>
<span class="hljs-comment">//  eviction messages</span>
<span class="hljs-comment">////////////////////////</span>

<span class="hljs-comment">// consolidated info about an eviction in sf rent board records. </span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// as of 2020/09/26, there are two flavors of eviction structs in ebook</span>
<span class="hljs-comment">// queries. this message describes the union of those structs, and is used to</span>
<span class="hljs-comment">// represent both.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// eviction details in location-based query results (neighborhood.js) include</span>
<span class="hljs-comment">// info about the attributed evictor and their business network.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// that info is not present in business-based query results (corp.js, et al),</span>
<span class="hljs-comment">// so those fields are left unset. see comments inline.</span>
message SFRBEvictionMetadata {
  <span class="hljs-comment">//////////////////////////////////////////////////////</span>
  <span class="hljs-comment">// fields describing the eviction record itself:</span>
  <span class="hljs-comment">//////////////////////////////////////////////////////</span>

  <span class="hljs-comment">// unique id for RB_Eviction nodes in ebook dataset.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// this is typically derived from sf rent board&#x27;s petition id, but is *NOT*</span>
  <span class="hljs-comment">// equivalent. DO NOT USE THIS FOR DIRECT COMPARISON TO SFRB RECORDS.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">evict_id</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

  <span class="hljs-comment">// date on which this eviction took effect, according to public records.</span>
  <span class="hljs-comment">// format: &#x27;CCYYMMDD&#x27;.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">evict_date</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;

  <span class="hljs-comment">// type of eviction, for example &quot;Buyout Declaration&quot; or &quot;Ellis Act</span>
  <span class="hljs-comment">// Withdrawal&quot;.  todo: document supported values for this field.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">type</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;

  <span class="hljs-comment">// attributed evictors according to ellis act withdrawal records. only</span>
  <span class="hljs-comment">// populated for evictions of type &quot;Ellis Act Withdrawal&quot;</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// todo verify semantics. ad-hoc testing on april 2020 dataset shows a list</span>
  <span class="hljs-comment">// of multiple ellis evictors, which appear to be derived from interpreting a</span>
  <span class="hljs-comment">// string as a comma-separated list. As of 2020/09/26, the relationship</span>
  <span class="hljs-comment">// between this string and the ebook is not well documented.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">ellis_evictor</span> <span class="hljs-operator">=</span> <span class="hljs-number">4</span>;

  <span class="hljs-comment">// a property of the EVICTED_BY relation connecting an SOS_Corp node with</span>
  <span class="hljs-comment">// this eviction&#x27;s RB_Eviction node.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// todo: document what this field means.</span>
  <span class="hljs-type">bool</span> <span class="hljs-variable">multiple_sales_matches</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;

  <span class="hljs-comment">///////////////////////////////////////////////////////////////////</span>
  <span class="hljs-comment">// fields describing the parcel where this eviction took place:</span>
  <span class="hljs-comment">///////////////////////////////////////////////////////////////////</span>

  <span class="hljs-comment">// block_lot of the parcel where this eviction tool place. uniquely specifies</span>
  <span class="hljs-comment">// a parcel in sf assessor records. unique key for A_Parcel nodes in the</span>
  <span class="hljs-comment">// database.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">block_lot</span> <span class="hljs-operator">=</span> <span class="hljs-number">6</span>;

  <span class="hljs-comment">// num. units at the parcel where this eviction took place (via assessor</span>
  <span class="hljs-comment">// records).</span>
  <span class="hljs-type">double</span> <span class="hljs-variable">units</span> <span class="hljs-operator">=</span> <span class="hljs-number">7</span>;

  <span class="hljs-comment">// latitude (in degrees) of a point within the boundaries of the parcel where</span>
  <span class="hljs-comment">// this eviction took place.</span>
  <span class="hljs-type">double</span> <span class="hljs-variable">lat</span> <span class="hljs-operator">=</span> <span class="hljs-number">8</span>;

  <span class="hljs-comment">// longitude (in degrees) of a point within the boundaries of the parcel where</span>
  <span class="hljs-comment">// this eviction took place.</span>
  <span class="hljs-type">double</span> <span class="hljs-variable">long</span> <span class="hljs-operator">=</span> <span class="hljs-number">9</span>;

  <span class="hljs-comment">// street address of the parcel where this eviction took place (via assessor</span>
  <span class="hljs-comment">// records). see &#x27;addr&#x27; field of DirectlyOwnedParcelInfo.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">addr</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;

  <span class="hljs-comment">// name of the neighorhood that encompasses the parcel where this eviction</span>
  <span class="hljs-comment">// took place (via assessor records). see &#x27;neighborhood&#x27; field of</span>
  <span class="hljs-comment">// DirectlyOwnedParcelInfo.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">neighborhood</span> <span class="hljs-operator">=</span> <span class="hljs-number">11</span>; 

  <span class="hljs-comment">// a property of the EVICTION_AT relation connecting this eviction to a</span>
  <span class="hljs-comment">// parcel record in the ebook dataset.  todo: document what this field means.</span>
  <span class="hljs-type">bool</span> <span class="hljs-variable">multiple_addr_matches</span> <span class="hljs-operator">=</span> <span class="hljs-number">12</span>;


  <span class="hljs-comment">///////////////////////////////////////////////////////////////////</span>
  <span class="hljs-comment">// fields describing attributed evictors and business networks:</span>
  <span class="hljs-comment">///////////////////////////////////////////////////////////////////</span>

  <span class="hljs-comment">// only set when this eviction is part of a location-based query (ex:</span>
  <span class="hljs-comment">// neighborhood lookup). when set, contains the name of an attributed</span>
  <span class="hljs-comment">// evictor, or &quot;Unknown&quot; if there are no attributed evictors.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// when this message is part of a business-info query result, name is unset.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> <span class="hljs-number">13</span>;

  <span class="hljs-comment">// contains id&#x27;s used to refer to a business holding network.</span>
  <span class="hljs-comment">//  </span>
  <span class="hljs-comment">// only set when eviction message is part of a location-based query (ex:</span>
  <span class="hljs-comment">// lookup by neighborhood). unset when this message appears in a</span>
  <span class="hljs-comment">// business-info query result.</span>
  <span class="hljs-type">BusinessNetworkIdentifier</span> <span class="hljs-variable">linked_be</span> <span class="hljs-operator">=</span> <span class="hljs-number">14</span>;
}

</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemaslegacyprotoquerygraph_util.proto"><a href="#toc"><a name="server-schemas-legacy-proto-query-graph_util-proto">server/schemas/legacy/proto/query/graph_util.proto</a></a></h2>
<pre><code><span class="hljs-comment">// query/graph_util.proto</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// contains helper messages for describing neo4j graphs.</span>
syntax = <span class="hljs-string">&quot;proto3&quot;</span>;

<span class="hljs-keyword">package</span> query;

<span class="hljs-comment">// this schema, based on the neo4j-driver api, is good for representing</span>
<span class="hljs-comment">// arbitrary graphs, so it would be useful to adapt the graph proto layer to</span>
<span class="hljs-comment">// use it as well.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// IMPORTANT: see comments on &#x27;properties&#x27; below; there are some gotchas.</span>

<span class="hljs-comment">////////////////////////////////////</span>
<span class="hljs-comment">// actual definitions begin here:</span>
<span class="hljs-comment">////////////////////////////////////</span>

<span class="hljs-comment">// representation of a node in the graph, including internal details</span>
<span class="hljs-comment">// particular to the graph&#x27;s instantiation.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// based on the json schema of neo4j data driver&#x27;s query results.</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">GraphNode</span> </span>{
  <span class="hljs-comment">// internal graph db id for this node.</span>
  <span class="hljs-built_in">int64</span> identity = <span class="hljs-number">1</span>;

  <span class="hljs-comment">// the node types that this node has. in our graph, nodes always have a</span>
  <span class="hljs-comment">// single type, as of 2021/03/12, but this may change in the future.</span>
  <span class="hljs-keyword">repeated</span> <span class="hljs-built_in">string</span> labels = <span class="hljs-number">2</span>;

  <span class="hljs-comment">// a json string representing a map of this node&#x27;s properties, where the keys</span>
  <span class="hljs-comment">// are the property names and the values are strings, numbers, or objects.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> this field does not appear in the response objects returned by</span>
  <span class="hljs-comment">// neo4j-driver.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// in the neo4j driver&#x27;s response, &#x27;properties&#x27; is a plain object. this is</span>
  <span class="hljs-comment">// convenient for the programming api, but it means that the driver&#x27;s query</span>
  <span class="hljs-comment">// response can never be fully-type-safely specified as proto.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// this is because the schema of &#x27;properties&#x27; is unpredictable (determined by</span>
  <span class="hljs-comment">// the contents of the db). you could choose to represent it as a map of</span>
  <span class="hljs-comment">// strings/bytes/Any/etc., but the native json representation of the proto</span>
  <span class="hljs-comment">// wouldn&#x27;t match the actual neo4j driver&#x27;s response.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// since we can&#x27;t acheive perfect compatibility, the simplest strategy is to</span>
  <span class="hljs-comment">// encode the &#x27;properties&#x27; object as json. callers should &#x27;JSON.parse&#x27; the</span>
  <span class="hljs-comment">// value of &#x27;properties_json&#x27; into &#x27;properties&#x27; to achieve compatibility with</span>
  <span class="hljs-comment">// the neo4j driver api.</span>
  <span class="hljs-comment">// </span>
  <span class="hljs-comment">// similarly, callers should &#x27;JSON.stringify&#x27; the &#x27;properties&#x27; value of a</span>
  <span class="hljs-comment">// neo4j driver response into &#x27;properties_json&#x27; to allow encoding as proto.</span>
  <span class="hljs-built_in">string</span> properties_json = <span class="hljs-number">3</span>;

  <span class="hljs-comment">// see above. the neo4j-driver object equivalent uses the name &#x27;properties&#x27;;</span>
  <span class="hljs-comment">// to make conversion code clearer, don&#x27;t reuse that name.</span>
  <span class="hljs-built_in">bytes</span> properties = <span class="hljs-number">4</span> [deprecated = <span class="hljs-literal">true</span>];
}

<span class="hljs-comment">// representation of a relation (edge) in the graph, including internal details</span>
<span class="hljs-comment">// particular to the graph&#x27;s instantiation. based on the js obj schema of</span>
<span class="hljs-comment">// neo4j-driver&#x27;s query results.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> a GraphRelation as described here contains the complete set of info</span>
<span class="hljs-comment">// for both nodes that it connects! that means that storing a graph as a list</span>
<span class="hljs-comment">// of these GraphRelation objects is inefficient, because the same node may be</span>
<span class="hljs-comment">// described many times (once for each connecting edge).</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">GraphRelation</span> </span>{
  <span class="hljs-comment">// origin node of the relation.</span>
  GraphNode start = <span class="hljs-number">1</span>;

  <span class="hljs-comment">// destination node of the relation. <span class="hljs-doctag">NOTE:</span> as of 2021/03/12, edges are</span>
  <span class="hljs-comment">// treated as though they bidirectional in ebook graph analysis.</span>
  GraphNode end = <span class="hljs-number">2</span>;

  <span class="hljs-comment">// the relation/edge&#x27;s type in the graph (&quot;ENTITY_OWNED_BY&quot;, etc.).</span>
  <span class="hljs-built_in">string</span> type = <span class="hljs-number">3</span>;
}

</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemaslegacyprotoquerynetwork.proto"><a href="#toc"><a name="server-schemas-legacy-proto-query-network-proto">server/schemas/legacy/proto/query/network.proto</a></a></h2>
<pre><code><span class="hljs-comment">// query/network.proto</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// type definitions for network analysis of businesses, property-holders, and</span>
<span class="hljs-comment">// evictors in ebook serving query abstraction layer.</span>
syntax = <span class="hljs-string">&quot;proto3&quot;</span>;

<span class="hljs-keyword">package</span> query;

<span class="hljs-comment">// id and location characteristics of a real-estate business network.</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">NetworkLocationInfo</span> </span>{
  <span class="hljs-comment">// an address in the ebook datastore where the central owning entity of a</span>
  <span class="hljs-comment">// real-estate business network is believed to be located.</span>
  <span class="hljs-built_in">string</span> addr_readable = <span class="hljs-number">1</span>;

  <span class="hljs-comment">// network id of the real-estate business network believed to be</span>
  <span class="hljs-comment">// headquartered at addr_readable.</span>
  <span class="hljs-built_in">int64</span> network_id = <span class="hljs-number">2</span>;
}

<span class="hljs-comment">// id&#x27;s used to refer to a real-estate holding network, as modeled by</span>
<span class="hljs-comment">// analysis of the calif. sec. of state business registry.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// see the developer guide for a detailed description of the evictorbook&#x27;s</span>
<span class="hljs-comment">// network connection methodology in the section &quot;Network Connection Method -</span>
<span class="hljs-comment">// Detailed &gt; During DB Creation&quot;.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// c_id assignment is described in step &#x27;I&#x27; of that section and network_id</span>
<span class="hljs-comment">// assignment is described in step &#x27;III&#x27;.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> This message name is inaccurate; it really represents a Business, not</span>
<span class="hljs-comment">// a Network. Need to rename.</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">BusinessNetworkIdentifier</span> </span>{
  <span class="hljs-comment">// type of business record in ebook datastore (&quot;SOS_LP&quot;, &quot;SOS_Corp&quot;) from</span>
  <span class="hljs-comment">// which this business information was extracted.</span>
  <span class="hljs-built_in">string</span> __typename = <span class="hljs-number">1</span>;

  <span class="hljs-comment">// business network id of this business in ebook datastore, as inferred</span>
  <span class="hljs-comment">// by graph analysis. see graph schema documentation for details.</span>
  <span class="hljs-built_in">int64</span> network_id = <span class="hljs-number">2</span>;

  <span class="hljs-comment">// connected component id of this business in ebook datastore, as</span>
  <span class="hljs-comment">// inferred by graph analysis. all businesses with the same c_id must</span>
  <span class="hljs-comment">// also have the same network_id, though two businesses with the same</span>
  <span class="hljs-comment">// network_id may have different c_id&#x27;s. see graph documentation and</span>
  <span class="hljs-comment">// developer guide for details.</span>
  <span class="hljs-built_in">int64</span> c_id = <span class="hljs-number">3</span>;

  <span class="hljs-comment">// normalized name of the business in the ebook datastore (node type:</span>
  <span class="hljs-comment">// &quot;SOS_LP&quot; or &quot;SOS_Corp&quot;) from which this network information was extracted.</span>
  <span class="hljs-built_in">string</span> name_norm = <span class="hljs-number">4</span>;
}

</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemaslegacyprotoqueryparcel.proto"><a href="#toc"><a name="server-schemas-legacy-proto-query-parcel-proto">server/schemas/legacy/proto/query/parcel.proto</a></a></h2>
<pre><code><span class="hljs-comment">// query/parcel.proto</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// describes the CYPHER queries invoked at serving-time to retrieve</span>
<span class="hljs-comment">// parcel-related information from the ebook datastore.</span>
syntax = <span class="hljs-string">&quot;proto3&quot;</span>;

<span class="hljs-keyword">import</span> <span class="hljs-string">&quot;network.proto&quot;</span>;

<span class="hljs-keyword">package</span> query;

<span class="hljs-comment">/////////////////////////////</span>
<span class="hljs-comment">//  Parcel detail messages: </span>
<span class="hljs-comment">/////////////////////////////</span>

<span class="hljs-comment">// detailed info about a real-estate parcel from the sf assessor&#x27;s office.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// corresponds to the object returned by parcel/details.js.</span>
<span class="hljs-comment">// originally derived from parcel_details subquery in parcel.js (deprecated).</span>
message SFAssessorParcelDetails {
  <span class="hljs-comment">// year in which the buildings on this real-estate parcel were first constructed.</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> describe behavior for multi-building parcels.</span>
  <span class="hljs-type">int32</span> <span class="hljs-variable">yr_built</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

  <span class="hljs-comment">// string containing parcel&#x27;s street address, including street number, street</span>
  <span class="hljs-comment">// name and suffix, and unit number. parcel is assumed to be within sf</span>
  <span class="hljs-comment">// city/county limits.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// notes from schema definition sheet:</span>
  <span class="hljs-comment">// full address in the format of &quot;ST_START_NO-ST_END_NO ST_NAME ST_TYPE (Unit</span>
  <span class="hljs-comment">// UNIT)&quot; (w/o end no if no address range, w/o parentheses if no unit)</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">addr</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;

  <span class="hljs-comment">// &#x27;block_lot&#x27; identifier. unique key for a parcel in sf assessor records,</span>
  <span class="hljs-comment">// and uniqye key for A_Parcel nodes in the database.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">block_lot</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;

  <span class="hljs-comment">// latitude in degrees of a point within this parcel&#x27;s boundaries.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> specify bounds.</span>
  <span class="hljs-type">double</span> <span class="hljs-variable">lat</span> <span class="hljs-operator">=</span> <span class="hljs-number">4</span>;

  <span class="hljs-comment">// longitude in degrees of a point within this parcel&#x27;s boundaries.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> specify bounds.</span>
  <span class="hljs-type">double</span> <span class="hljs-variable">long</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;

  <span class="hljs-comment">// name of the neighborhood this parcel occupies. as of 2020/09/26, it&#x27;s</span>
  <span class="hljs-comment">// assumed that all parcels are within sf city and county, so these are san</span>
  <span class="hljs-comment">// francisco neighborhoods.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// neighborhoods assigned using sf polygons.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// names and polygon boundaries:</span>
  <span class="hljs-comment">// https://data.sfgov.org/Geographic-Locations-and-Boundaries/SF-Find-Neighborhoods/pty2-tcw4</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">neighborhood</span> <span class="hljs-operator">=</span> <span class="hljs-number">6</span>;

  <span class="hljs-comment">// rough assessment of this parcel&#x27;s rent-control status.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// 0 (default) if data unavailable to determine rent controlled status, </span>
  <span class="hljs-comment">// 1 if likely rent controlled,</span>
  <span class="hljs-comment">// 2 if doubtful that this is rent controlled</span>
  <span class="hljs-type">int32</span> <span class="hljs-variable">rent_controlled</span> <span class="hljs-operator">=</span> <span class="hljs-number">7</span>;

  <span class="hljs-comment">// property class code, via sf assessor&#x27;s office.</span>
  <span class="hljs-comment">// definitons:</span>
  <span class="hljs-comment">// https://data.sfgov.org/Housing-and-Buildings/Reference-Assessor-Recorder-Property-Class-Codes/pa56-ek2h/data</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">prop_class_code</span> <span class="hljs-operator">=</span> <span class="hljs-number">8</span>;

  <span class="hljs-comment">// i.d. for the zoning district this parcel occupies.</span>
  <span class="hljs-comment">// sf zoning district definitions:</span>
  <span class="hljs-comment">// https://sfplanninggis.org/pim/map.html?layers=Zoning%20Districts</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">zone</span> <span class="hljs-operator">=</span> <span class="hljs-number">9</span>;

  <span class="hljs-comment">// how tall is the building on this parcel, in stories.</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> behavior for multi-building parcels?</span>
  <span class="hljs-type">int32</span> <span class="hljs-variable">stories</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;

  <span class="hljs-comment">// number of physical units within this logical real-estate parcel.</span>
  <span class="hljs-type">int32</span> <span class="hljs-variable">units</span> <span class="hljs-operator">=</span> <span class="hljs-number">11</span>;

  <span class="hljs-comment">// number of total rooms within buildings on this parcel (for multi-unit</span>
  <span class="hljs-comment">// parcels, this is the sum of rooms among all units.)</span>
  <span class="hljs-type">int32</span> <span class="hljs-variable">rooms</span> <span class="hljs-operator">=</span> <span class="hljs-number">12</span>;

  <span class="hljs-comment">// number of total bedrooms on this parcel (for multi-unit parcels, this is</span>
  <span class="hljs-comment">// the sum of bedrooms among all units.)</span>
  <span class="hljs-type">int32</span> <span class="hljs-variable">beds</span> <span class="hljs-operator">=</span> <span class="hljs-number">13</span>;

  <span class="hljs-comment">// assessor valuation of the &#x27;land&#x27; base value, i.e. the parcel&#x27;s theoretical</span>
  <span class="hljs-comment">// value if it had no buildings on it.</span>
  <span class="hljs-type">int32</span> <span class="hljs-variable">assess_land_val</span> <span class="hljs-operator">=</span> <span class="hljs-number">14</span>;

  <span class="hljs-comment">// assessor valuation of the &#x27;improvement&#x27; done to the land via development,</span>
  <span class="hljs-comment">// as of most recent assessment. units in u.s. dollars.</span>
  <span class="hljs-type">int32</span> <span class="hljs-variable">assess_imp_val</span> <span class="hljs-operator">=</span> <span class="hljs-number">15</span>;

  <span class="hljs-comment">// date when the parcel&#x27;s value was last assessed. format: CCYYMMDD</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">assess_val_date</span> <span class="hljs-operator">=</span> <span class="hljs-number">16</span>;

  <span class="hljs-comment">// date on which this parcel&#x27;s address was last updated, via assessor</span>
  <span class="hljs-comment">// records. format: CCYYMMDD</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">update_date</span> <span class="hljs-operator">=</span> <span class="hljs-number">17</span>;

  <span class="hljs-comment">// units in u.s. dollars.  <span class="hljs-doctag">TODO:</span> document when and how this gets populated.</span>
  <span class="hljs-type">int32</span> <span class="hljs-variable">curr_sales_price</span> <span class="hljs-operator">=</span> <span class="hljs-number">18</span>;

  <span class="hljs-comment">// format: CCYYMMDD  <span class="hljs-doctag">TODO:</span> document when and how this gets populated.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">curr_sales_date</span> <span class="hljs-operator">=</span> <span class="hljs-number">19</span>;

  <span class="hljs-comment">// if the logical parcel occupies more than one street number, then this field</span>
  <span class="hljs-comment">// contains the lowest street number in that range.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// if the logical parcel occupies only one street number, then this field</span>
  <span class="hljs-comment">// contains that number.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> why no parc_end_no field? </span>
  <span class="hljs-type">int32</span> <span class="hljs-variable">parc_start_no</span> <span class="hljs-operator">=</span> <span class="hljs-number">20</span>;

  <span class="hljs-comment">// main name part of the street/route name of the parcel&#x27;s address.</span>
  <span class="hljs-comment">// (ex: &quot;geary&quot;, &quot;first&quot;, &quot;taylor&quot;, etc.)</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> describe capitalization, stylization, etc.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">parc_street_name</span> <span class="hljs-operator">=</span> <span class="hljs-number">21</span>;

  <span class="hljs-comment">// street suffix (ex: &quot;st&quot;, &quot;ln&quot;) of the parcel&#x27;s address.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> describe capitalization, stylization, etc.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">parc_street_type</span> <span class="hljs-operator">=</span> <span class="hljs-number">22</span>;

  <span class="hljs-comment">// unit or subpremise identifier. just the number or letter. </span>
  <span class="hljs-type">string</span> <span class="hljs-variable">parc_unit_no</span> <span class="hljs-operator">=</span> <span class="hljs-number">23</span>;

  <span class="hljs-comment">// five-digit u.s. postal code of the parcel&#x27;s address, as an integer.</span>
  <span class="hljs-type">int32</span> <span class="hljs-variable">parc_zip</span> <span class="hljs-operator">=</span> <span class="hljs-number">24</span>;
}

<span class="hljs-comment">/////////////////////////////</span>
<span class="hljs-comment">//  Parcel owner messages: </span>
<span class="hljs-comment">/////////////////////////////</span>

<span class="hljs-comment">// an owner, as seen in server/rest/handlers/parcel/owners.js.</span>
message SFAssessorParcelOwner {
  <span class="hljs-comment">// physical mailing address where this owner can be reached, according to</span>
  <span class="hljs-comment">// assessor parcel records.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">mailing_address</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

  <span class="hljs-comment">// date this ownership was documented, as it appears in the PARC_OWNED_BY</span>
  <span class="hljs-comment">// (ParcelOwnedBy) relation connecting the parcel node with an A_Parcel_Owner</span>
  <span class="hljs-comment">// vertex.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// format: CCYYMMDD</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">record_date</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;

  <span class="hljs-comment">// ownership percentage, as a number between 0 and 100, as it appears in the</span>
  <span class="hljs-comment">// PARC_OWNED_BY (ParcelOwnedBy) relation connecting the parcel node with</span>
  <span class="hljs-comment">// an A_Parcel_Owner vertex.</span>
  <span class="hljs-type">double</span> <span class="hljs-variable">perc_owner</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;

  <span class="hljs-comment">// name of owner listed on parcel records from SF assessor&#x27;s office.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// todo briefly describe how/whether this data was normalized.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">owner_name</span> <span class="hljs-operator">=</span> <span class="hljs-number">4</span>;

  <span class="hljs-comment">// optional.</span>
  <span class="hljs-comment">// this is populated if and only if we believe this owner is a business,</span>
  <span class="hljs-comment">// which we have identified with california sec. of state business records.</span>
  <span class="hljs-comment">// contains information about the owning business, and its inferred</span>
  <span class="hljs-comment">// real-estate business network connections.</span>
  <span class="hljs-type">BusinessNetworkIdentifier</span> <span class="hljs-variable">linked_be</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;
}

<span class="hljs-comment">// consolidated info about a parcel, as presented from the context of the</span>
<span class="hljs-comment">// business entity that owns the parcel.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// as of 2020/09/26, this message mirrors the subquery in js commented with</span>
<span class="hljs-comment">// &quot;get the parcels directly owned&quot;.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// except for num_evictions, these fields correspond one-to-one to fields of</span>
<span class="hljs-comment">// the same name in A_Parcel nodes. defining another message here instead of</span>
<span class="hljs-comment">// attempting to reuse, so we can allow the schema and query interface boundary</span>
<span class="hljs-comment">// to evolve independently.</span>
message BusinessOwnedParcelInfo {
  <span class="hljs-comment">// block lot string, which uniquely specifies a parcel in sf city and county</span>
  <span class="hljs-comment">// assessor records. this is a unique key for A_Parcel nodes in the database.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">block_lot</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

  <span class="hljs-comment">// date listed on the documents which record this corporation&#x27;s ownership of</span>
  <span class="hljs-comment">// the parcel, as recorded in the &#x27;PARC_OWNED_BY&#x27; relation that connects the</span>
  <span class="hljs-comment">// A_Parcel node with the SOS_Corp node.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// format: CCYYMMDD</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">record_date</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;

  <span class="hljs-comment">// ownership percentage, as documented in the &#x27;PARC_OWNED_BY&#x27; relation</span>
  <span class="hljs-comment">// connecting the A_Parcel node with the SOS_Corp node.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// ownership percentage is expressed as an integer between 0 and 100, but</span>
  <span class="hljs-comment">// returned as a floating point number.</span>
  <span class="hljs-type">double</span> <span class="hljs-variable">perc_owner</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;

  <span class="hljs-comment">// a string representing the parcel&#x27;s street address, including street</span>
  <span class="hljs-comment">// number, street name and suffix, and unit number. the parcel is assumed to</span>
  <span class="hljs-comment">// be within sf city/county limits.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">addr</span> <span class="hljs-operator">=</span> <span class="hljs-number">4</span>;

  <span class="hljs-comment">// number of RB_Eviction nodes with an EVICTION_AT relationship to this</span>
  <span class="hljs-comment">// parcel&#x27;s A_Parcel node.</span>
   <span class="hljs-type">int32</span> <span class="hljs-variable">num_evictions</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;

  <span class="hljs-comment">// number of units that this parcel consists of, according to sf city and</span>
  <span class="hljs-comment">// county assessor records.</span>
  <span class="hljs-type">double</span> <span class="hljs-variable">units</span> <span class="hljs-operator">=</span> <span class="hljs-number">6</span>;

  <span class="hljs-comment">// latitude, in degrees, of a point within this parcel&#x27;s boundaries.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// todo: formally specify bounds.</span>
  <span class="hljs-type">double</span> <span class="hljs-variable">lat</span> <span class="hljs-operator">=</span> <span class="hljs-number">7</span>;

  <span class="hljs-comment">// longitude, in degrees, of a point within this parcel&#x27;s boundaries.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// todo: formally specify bounds.</span>
  <span class="hljs-type">double</span> <span class="hljs-variable">long</span> <span class="hljs-operator">=</span> <span class="hljs-number">8</span>;

  <span class="hljs-comment">// name of the neighborhood this parcel occupies. as of 2020/09/26, it&#x27;s</span>
  <span class="hljs-comment">// assumed that all parcels are within sf city and county, so these are san</span>
  <span class="hljs-comment">// francisco neighborhoods.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// values correspond to names of the neighborhood polygons</span>
  <span class="hljs-comment">// described at:</span>
  <span class="hljs-comment">// https://data.sfgov.org/Geographic-Locations-and-Boundaries/SF-Find-Neighborhoods/pty2-tcw4</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">neighborhood</span> <span class="hljs-operator">=</span> <span class="hljs-number">9</span>;
}

<span class="hljs-comment">////////////////////////////////</span>
<span class="hljs-comment">//  Networked parcel messages: </span>
<span class="hljs-comment">////////////////////////////////</span>

<span class="hljs-comment">// brief description of an individual, business, or trust, etc., which may own</span>
<span class="hljs-comment">// a parcel associated with a real-estate business network.</span>
message NetworkedParcelOwner {
  <span class="hljs-comment">// owner of the networked parcel, as it appears in that parcel&#x27;s assessor</span>
  <span class="hljs-comment">// records.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">owner_name</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

  <span class="hljs-comment">// optional.</span>
  <span class="hljs-comment">// this is populated if and only if we believe this owner is a business,</span>
  <span class="hljs-comment">// which we have identified with california sec. of state business records.</span>
  <span class="hljs-comment">// contains information about the owning business, and its inferred</span>
  <span class="hljs-comment">// real-estate business network connections.</span>
  <span class="hljs-type">BusinessNetworkIdentifier</span> <span class="hljs-variable">linked_be</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;

  <span class="hljs-comment">// set when mailing_address is believed to also be the cental mailing</span>
  <span class="hljs-comment">// address of a real-estate business network central business&#x27;s hq. in</span>
  <span class="hljs-comment">// that case, it&#x27;s the network id of the business network headquartered</span>
  <span class="hljs-comment">// at that address.</span>
  <span class="hljs-type">int64</span> <span class="hljs-variable">ma_network_id</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;

  <span class="hljs-comment">// physical mailing address where the owner can be contacted, according</span>
  <span class="hljs-comment">// to assessor records.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">mailing_address</span> <span class="hljs-operator">=</span> <span class="hljs-number">4</span>; 
}

<span class="hljs-comment">// brief description of a parcel which is not directly owned by the corporation</span>
<span class="hljs-comment">// being searched for, but which may be connected through real-estate holding</span>
<span class="hljs-comment">// network of business entities and owners.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// derived from the subquery commented &quot;// compile everything together for the</span>
<span class="hljs-comment">// related parcels&quot; in server/rest/handlers/corp.js, as of 2020/09/26. </span>
message NetworkedParcelInfo {
  <span class="hljs-comment">// address of the networked parcel, as derived from sf assessor records.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">addr</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

  <span class="hljs-comment">// the block_lot of the parcel, primary key in ebook datastore and sf</span>
  <span class="hljs-comment">// assessor records.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">block_lot</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;

  <span class="hljs-comment">// total amount of evictions believed to have occurred at the networked</span>
  <span class="hljs-comment">// property, which appear in ebook&#x27;s datastore. no bounds on eviction date.</span>
  <span class="hljs-type">int32</span> <span class="hljs-variable">num_evictions</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;

  <span class="hljs-comment">// number of units on the networked property (for multi-building</span>
  <span class="hljs-comment">// properties, this is the sum total of units on the property).</span>
  <span class="hljs-type">int32</span> <span class="hljs-variable">units</span> <span class="hljs-operator">=</span> <span class="hljs-number">4</span>;

  <span class="hljs-comment">// latitude (in degrees) of a point within the networked property.</span>
  <span class="hljs-type">double</span> <span class="hljs-variable">lat</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;

  <span class="hljs-comment">// longitude (in degrees) of a point within the networked property.</span>
  <span class="hljs-type">double</span> <span class="hljs-variable">long</span> <span class="hljs-operator">=</span> <span class="hljs-number">6</span>;

  <span class="hljs-comment">// name of the neighborhood this parcel occupies.</span>
  <span class="hljs-comment">// see SFAssessorParcelDetails for description of valid neighborhood names.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">neighborhood</span> <span class="hljs-operator">=</span> <span class="hljs-number">7</span>;

  <span class="hljs-comment">// identifiers for real-estate business networks which the networked parcel</span>
  <span class="hljs-comment">// may be associated with. in other words, these are networks with a</span>
  <span class="hljs-comment">// second-degree relatinship to the original parcel.</span>
  repeated <span class="hljs-type">NetworkLocationInfo</span> <span class="hljs-variable">possible_networks</span> <span class="hljs-operator">=</span> <span class="hljs-number">8</span>; 

  <span class="hljs-comment">// individuals, businesses, or other legal entities believed to own the</span>
  <span class="hljs-comment">// networked parcel in whole or in part.</span>
  repeated <span class="hljs-type">NetworkedParcelOwner</span> <span class="hljs-variable">owners</span> <span class="hljs-operator">=</span> <span class="hljs-number">9</span>;
}

</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemaslegacyprotoqueryquery.proto"><a href="#toc"><a name="server-schemas-legacy-proto-query-query-proto">server/schemas/legacy/proto/query/query.proto</a></a></h2>
<pre><code><span class="hljs-comment">// query.proto</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// proto messages describing the neo4j CYPHER queries used at runtime by the</span>
<span class="hljs-comment">// ebook node server. these definitions serve as a query abstraction layer.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// this serves dual purposes:</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// first, they offer a clear reference point for developers seeking to</span>
<span class="hljs-comment">// understand the runtime queries.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// second, they offer a clear point of integration so the server&#x27;s js business</span>
<span class="hljs-comment">// logic can be written and tested independently of the live database. see</span>
<span class="hljs-comment">// usage in server/rest/routes/dbRouteListeners.js.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// this strategy is effective for building resilience into systems that rely on</span>
<span class="hljs-comment">// interpreted query languages.</span>
syntax = <span class="hljs-string">&quot;proto3&quot;</span>;

<span class="hljs-keyword">import</span> <span class="hljs-string">&quot;business.proto&quot;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">&quot;eviction.proto&quot;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">&quot;graph_util.proto&quot;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">&quot;network.proto&quot;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">&quot;parcel.proto&quot;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">&quot;util.proto&quot;</span>;

<span class="hljs-keyword">package</span> query;

<span class="hljs-comment">// description of ebook&#x27;s query abstraction layer.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// exists to serve as a concrete and testable interface boundary between the</span>
<span class="hljs-comment">// modules that interact directly with the database via CYPHER, and the modules</span>
<span class="hljs-comment">// which are written in pure javascript.</span>
<span class="hljs-class"><span class="hljs-keyword">service</span> <span class="hljs-title">EvictorbookQueryServiceV1</span> </span>{
  <span class="hljs-comment">// corp / lp / business queries:</span>

  <span class="hljs-comment">// query corporation info by normalized business name.</span>
  <span class="hljs-function"><span class="hljs-keyword">rpc</span> CalSOSCorporationQuery(CalSOSCorporationQueryParams) <span class="hljs-keyword">returns</span>
    (CalSOSCorporationQueryResult)</span>;

  <span class="hljs-comment">// query limited partnership / llc info by normalized business name.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> combine this with the &#x27;corporation&#x27; query to make a single query</span>
  <span class="hljs-comment">// which could handle both cases. alternatively, it may be simpler to</span>
  <span class="hljs-comment">// implement that at the web service level in the node runtime.</span>
  <span class="hljs-function"><span class="hljs-keyword">rpc</span> CalSOSLimitedBusinessQuery(CalSOSLimitedBusinessQueryParams)
    <span class="hljs-keyword">returns</span> (CalSOSLimitedBusinessQueryResult)</span>;

  <span class="hljs-comment">// eviction queries:</span>

  <span class="hljs-comment">// query details for individual evictions, filtered by neighborhood.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> extend or replace with a query that allows for other filters.</span>
  <span class="hljs-function"><span class="hljs-keyword">rpc</span> EvictionsByNeighborhoodQuery(EvictionsByNeighborhoodQueryParams) <span class="hljs-keyword">returns</span>
    (EvictionsByNeighborhoodQueryResult)</span>;

  <span class="hljs-comment">// parcel queries:</span>

  <span class="hljs-comment">// DEPRECATED. prefer more specific parcel queries below.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// get details about a parcel from sf assessor records, keyed by the parcel&#x27;s</span>
  <span class="hljs-comment">// block lot identifier, as well as info about evictions at the property,</span>
  <span class="hljs-comment">// suspected owners, etc.</span>
  <span class="hljs-comment">// </span>
  <span class="hljs-comment">// rest api route: &#x27;api/parcel/&lt;BLOCK_LOT&gt;&#x27;</span>
  <span class="hljs-comment">// query js: server/rest/handlers/parcel/legacy.js</span>
  <span class="hljs-function"><span class="hljs-keyword">rpc</span> SFParcelLegacyQuery(SFParcelLegacyQueryParams) <span class="hljs-keyword">returns</span>
    (SFParcelLegacyQueryResult)</span>;

  <span class="hljs-comment">// get details about a parcel from sf assessor records, keyed by block_lot.</span>
  <span class="hljs-comment">// </span>
  <span class="hljs-comment">// rest api route: &#x27;api/parcel/&lt;BLOCK_LOT&gt;/details&#x27;</span>
  <span class="hljs-comment">// query js: server/rest/handlers/parcel/details.js</span>
  <span class="hljs-function"><span class="hljs-keyword">rpc</span> SFParcelDetailsQuery(SFParcelDetailsQueryParams) <span class="hljs-keyword">returns</span>
    (SFParcelDetailsQueryResult)</span>;

  <span class="hljs-comment">// get details about evictions which occurred at a given parcel, keyed by</span>
  <span class="hljs-comment">// block_lot.</span>
  <span class="hljs-comment">// </span>
  <span class="hljs-comment">// rest api route: &#x27;api/parcel/&lt;BLOCK_LOT&gt;/evictions&#x27;</span>
  <span class="hljs-comment">// query js: server/rest/handlers/parcel/evictions.js</span>
  <span class="hljs-function"><span class="hljs-keyword">rpc</span> SFParcelEvictionsQuery(SFParcelEvictionsQueryParams) <span class="hljs-keyword">returns</span>
    (SFParcelEvictionsQueryResult)</span>;

  <span class="hljs-comment">// get info about individuals, businesses, and/or trusts believed to own the</span>
  <span class="hljs-comment">// parcel in full or in part.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// rest api route: &#x27;api/parcel/&lt;BLOCK_LOT&gt;/owners&#x27;</span>
  <span class="hljs-comment">// query js: server/rest/handlers/parcel/owners.js</span>
  <span class="hljs-function"><span class="hljs-keyword">rpc</span> SFParcelOwnersQuery(SFParcelOwnersQueryParams) <span class="hljs-keyword">returns</span>
    (SFParcelOwnersQueryResult)</span>;

  <span class="hljs-comment">// get info about real-estate business networks believed to have a stake in</span>
  <span class="hljs-comment">// this parcel, as well as other parcels which those networks may have a</span>
  <span class="hljs-comment">// vested interest in.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> performance bottleneck, invoke with caution.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// rest api route: &#x27;api/parcel/&lt;BLOCK_LOT&gt;/networks&#x27;</span>
  <span class="hljs-comment">// query js: server/rest/handlers/parcel/networks.js</span>
  <span class="hljs-function"><span class="hljs-keyword">rpc</span> SFParcelNetworksQuery(SFParcelNetworksQueryParams) <span class="hljs-keyword">returns</span>
    (SFParcelNetworksQueryResult)</span>;

  <span class="hljs-comment">// given a network_id and a business entity which belongs to that network,</span>
  <span class="hljs-comment">// return a local view of the network centered around that business.</span>
  <span class="hljs-function"><span class="hljs-keyword">rpc</span> NetworkBusinessEntityQuery(NetworkBusinessEntityQueryParams) <span class="hljs-keyword">returns</span>
    (NetworkBusinessEntityQueryResult)</span>;

  <span class="hljs-comment">// given a network_id and a parcel block_lot which is under that network&#x27;s</span>
  <span class="hljs-comment">// influence, return a view of the network centered around that parcel.</span>
  <span class="hljs-function"><span class="hljs-keyword">rpc</span> NetworkParcelQuery(NetworkParcelQueryParams) <span class="hljs-keyword">returns</span>
    (NetworkParcelQueryResult)</span>;

  <span class="hljs-comment">// search queries:</span>

  <span class="hljs-comment">// used for search feature on front page. performs prefix-based index lookup</span>
  <span class="hljs-comment">// on business entities (both &#x27;corp&#x27; and &#x27;lp&#x27;) by normalized name.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> extend or replace with more robust/flexible search algorithm.</span>
  <span class="hljs-function"><span class="hljs-keyword">rpc</span> BusinessEntityIndexSearch(BusinessEntityIndexSearchParams) <span class="hljs-keyword">returns</span>
    (BusinessEntityIndexSearchResult)</span>;

  <span class="hljs-comment">// used for search feature on front page. performs prefix-based lookup on sf</span>
  <span class="hljs-comment">// assessor parcel records on lot-level address strings.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> extend or replace with more robust/flexible search algorithm.</span>
  <span class="hljs-function"><span class="hljs-keyword">rpc</span> ParcelIndexSearch(ParcelIndexSearchParams) <span class="hljs-keyword">returns</span>
    (ParcelIndexSearchResult)</span>;
}

<span class="hljs-comment">// top-level queries are defined here to avoid circular dependencies.</span>

<span class="hljs-comment">//////////////////////////////////////</span>
<span class="hljs-comment">//  Corp/LP/Business query messages</span>
<span class="hljs-comment">//////////////////////////////////////</span>

<span class="hljs-comment">// parameters for cal sos corporation query.</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">CalSOSCorporationQueryParams</span> </span>{
  <span class="hljs-comment">// normalized name of the business, derived from the name found in california</span>
  <span class="hljs-comment">// sec. of state business records. must be an exact string match.</span>
  <span class="hljs-built_in">string</span> search_string = <span class="hljs-number">1</span>;
}

<span class="hljs-comment">// query result:</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">CalSOSCorporationQueryResult</span> </span>{
  <span class="hljs-comment">// details about the business (founding date, filing number, mailing address,</span>
  <span class="hljs-comment">// officers, etc.)</span>
  CalSOSCorporationDetails be_details = <span class="hljs-number">1</span>;

  <span class="hljs-comment">// details about parcels which are directly owned by this business.</span>
  <span class="hljs-keyword">repeated</span> BusinessOwnedParcelInfo parcels_owned = <span class="hljs-number">2</span>;
  
  <span class="hljs-comment">// evictions via sf rent board that may have been instigated by this business</span>
  <span class="hljs-comment">// (alone or w/ other agents). includes id numbers for further lookup.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// ellis act withdrawal evictions include names of plaintiffs.</span>
  <span class="hljs-keyword">repeated</span> SFRBEvictionMetadata evictions = <span class="hljs-number">3</span>;

  <span class="hljs-comment">// parcels which this corporation may have a financial interest in, via</span>
  <span class="hljs-comment">// business connections. corporate networks are inferred by ebook graph</span>
  <span class="hljs-comment">// analysis.</span>
  <span class="hljs-keyword">repeated</span> NetworkedParcelInfo network_parcels = <span class="hljs-number">4</span>;
}

<span class="hljs-comment">// Corresponds to the query defined in server/rest/handlers/lp.js</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// given the normalized name of a limited business (limited partnership or</span>
<span class="hljs-comment">// limited liability corporation) from calif sec. of state business registry,</span>
<span class="hljs-comment">// get detailed info about that business and its observed real-estate</span>
<span class="hljs-comment">// holdings in sf.</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">CalSOSLimitedBusinessQueryParams</span> </span>{
  <span class="hljs-comment">// Normalized name of the business, derived from the name found in California</span>
  <span class="hljs-comment">// Sec. of State business records.</span>
  <span class="hljs-built_in">string</span> search_string = <span class="hljs-number">1</span>;
}

<span class="hljs-comment">// Query result:</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">CalSOSLimitedBusinessQueryResult</span> </span>{
  <span class="hljs-comment">// Details about the limited partnership or llc in question.</span>
  CalSOSLimitedBusinessDetails be_details = <span class="hljs-number">1</span>;

  <span class="hljs-comment">// Details about parcels which are directly owned by this business entity.</span>
  <span class="hljs-keyword">repeated</span> BusinessOwnedParcelInfo parcels_owned = <span class="hljs-number">2</span>;
  
  <span class="hljs-comment">// Brief description of evictions from the SF Rent Board which this business</span>
  <span class="hljs-comment">// entity may have instigated (alone or with other agents). Includes id</span>
  <span class="hljs-comment">// numbers for further lookup, and in the case of an Ellis Act Withdrawal</span>
  <span class="hljs-comment">// includes the names of the plaintiff(s).</span>
  <span class="hljs-keyword">repeated</span> SFRBEvictionMetadata evictions = <span class="hljs-number">3</span>;

  <span class="hljs-comment">// Descriptions of parcels which, though not directly owned by this business</span>
  <span class="hljs-comment">// entity, may be owned by another entity that it&#x27;s related to through a</span>
  <span class="hljs-comment">// real-estate holding network. The networks are identified by the</span>
  <span class="hljs-comment">// evictorbook pipeline via connected component analysis.</span>
  <span class="hljs-keyword">repeated</span> NetworkedParcelInfo network_parcels = <span class="hljs-number">4</span>;
}

<span class="hljs-comment">///////////////////////////////</span>
<span class="hljs-comment">//  Eviction query messages</span>
<span class="hljs-comment">///////////////////////////////</span>

<span class="hljs-comment">// corresponds to query in server/rest/handlers/neighborhood.js</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// given the name of a neighborhood in san francisco, retrieves detailed</span>
<span class="hljs-comment">// information about all the evictions from evictorbook datastore which occured</span>
<span class="hljs-comment">// within that neighborhood&#x27;s boundaries.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> explore alternate pagination api&#x27;s (continuation token?)</span>
<span class="hljs-comment">// </span>
<span class="hljs-comment">// query parameters:</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">EvictionsByNeighborhoodQueryParams</span> </span>{
  <span class="hljs-comment">// neighorhood name. must be exact match.</span>
  <span class="hljs-built_in">string</span> neighborhood = <span class="hljs-number">1</span>;

  <span class="hljs-comment">// pagination. if set nonzero, show the nth page of results. </span>
  <span class="hljs-comment">// warning: if zero or unset, query will return all results at once.</span>
  <span class="hljs-built_in">int32</span> page = <span class="hljs-number">2</span>;

  <span class="hljs-comment">// pagination. if set nonzero, result pages are have this many entries.</span>
  <span class="hljs-comment">// maximum 100. must be set &gt;= 1 if pages is set.</span>
  <span class="hljs-built_in">int32</span> size = <span class="hljs-number">3</span>;
}

<span class="hljs-comment">// query result:</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">EvictionsByNeighborhoodQueryResult</span> </span>{
  <span class="hljs-comment">// details about evictions which occurred on a property in this neighborhood.</span>
  <span class="hljs-comment">// includes info derived during ebook data analysis, plus info about the</span>
  <span class="hljs-comment">// parcel where the eviction occurred.</span>
  <span class="hljs-keyword">repeated</span> SFRBEvictionMetadata evictions = <span class="hljs-number">1</span>;
}

<span class="hljs-comment">////////////////////////////</span>
<span class="hljs-comment">// Parcel query messages</span>
<span class="hljs-comment">////////////////////////////</span>

<span class="hljs-comment">// query params in server/rest/handlers/parcel/legacy.js</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">SFParcelLegacyQueryParams</span> </span>{
  <span class="hljs-comment">// block lot identifier of a parcel, as is appears in sf assessor records.</span>
  <span class="hljs-comment">// exact string match only.</span>
  <span class="hljs-built_in">string</span> search_string = <span class="hljs-number">1</span>;
}

<span class="hljs-comment">// result in server/rest/handlers/parcel/legacy.js</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">SFParcelLegacyQueryResult</span> </span>{
  <span class="hljs-comment">// detailed info about the parcel (location, physical properties, etc.).</span>
  SFAssessorParcelDetails parcel_details = <span class="hljs-number">1</span>;

  <span class="hljs-comment">// individuals, businesses, trusts, etc., which are believed to own the</span>
  <span class="hljs-comment">// parcel in full or in part.</span>
  <span class="hljs-keyword">repeated</span> SFAssessorParcelOwner owners = <span class="hljs-number">2</span>;

  <span class="hljs-comment">// info about evictions believed to have occurred on the propert(y/ies) on</span>
  <span class="hljs-comment">// this parcel.</span>
  <span class="hljs-keyword">repeated</span> SFRBEvictionMetadata evictions = <span class="hljs-number">3</span>;

  <span class="hljs-comment">// brief decsriptions of parcels which may be related through business</span>
  <span class="hljs-comment">// relations among parcel owners.</span>
  <span class="hljs-keyword">repeated</span> NetworkedParcelInfo network_parcels = <span class="hljs-number">4</span>;
  
  <span class="hljs-comment">// identifiers for real-estate business networks which the parcel may be</span>
  <span class="hljs-comment">// associated with.</span>
  <span class="hljs-keyword">repeated</span> NetworkLocationInfo possible_networks = <span class="hljs-number">5</span>;

  reserved <span class="hljs-number">6</span>;  <span class="hljs-comment">// wire-compatibility with SFOwnersQueryResult, see below.</span>
}

<span class="hljs-comment">// params in server/rest/handlers/parcel/details.js</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">SFParcelDetailsQueryParams</span> </span>{
  <span class="hljs-comment">// block lot identifier of a parcel, as is appears in sf assessor records.</span>
  <span class="hljs-comment">// exact string match only.</span>
  <span class="hljs-built_in">string</span> search_string = <span class="hljs-number">1</span>;
}

<span class="hljs-comment">// result in server/rest/handlers/parcel/details.js</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">SFParcelDetailsQueryResult</span> </span>{
  <span class="hljs-comment">// detailed info about the parcel (location, physical properties, etc.).</span>
  SFAssessorParcelDetails parcel_details = <span class="hljs-number">1</span>;
}

<span class="hljs-comment">// params in server/rest/handlers/parcel/evictions.js</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">SFParcelEvictionsQueryParams</span> </span>{
  <span class="hljs-comment">// block lot identifier of a parcel, as is appears in sf assessor records.</span>
  <span class="hljs-comment">// exact string match only.</span>
  <span class="hljs-built_in">string</span> search_string = <span class="hljs-number">1</span>;

  reserved <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>;  <span class="hljs-comment">// wire-compatibility with SFParcelLegacyQueryResult</span>
}

<span class="hljs-comment">// result in server/rest/handlers/parcel/evictions.js</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">SFParcelEvictionsQueryResult</span> </span>{
  <span class="hljs-comment">// info about evictions believed to have occurred on the propert(y/ies) on</span>
  <span class="hljs-comment">// this parcel.</span>
  <span class="hljs-keyword">repeated</span> SFRBEvictionMetadata evictions = <span class="hljs-number">2</span>;

  reserved <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>;  <span class="hljs-comment">// wire-compatibility with SFParcelLegacyQueryResult</span>
}

<span class="hljs-comment">// params in server/rest/handlers/parcel/networks.js</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">SFParcelNetworksQueryParams</span> </span>{
  <span class="hljs-comment">// block lot identifier of a parcel, as is appears in sf assessor records.</span>
  <span class="hljs-comment">// exact string match only.</span>
  <span class="hljs-built_in">string</span> search_string = <span class="hljs-number">1</span>;
}

<span class="hljs-comment">// result in server/rest/handlers/parcel/networks.js</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">SFParcelNetworksQueryResult</span> </span>{
  <span class="hljs-comment">// individuals or businesses believed to own the parcel, in full or in part.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// owner info is required for interpreting best network_id&#x27;s downstream.</span>
  <span class="hljs-keyword">repeated</span> SFAssessorParcelOwner owners = <span class="hljs-number">3</span>;

  <span class="hljs-comment">// brief decsriptions of parcels which may be related through business</span>
  <span class="hljs-comment">// relations among parcel owners.</span>
  <span class="hljs-keyword">repeated</span> NetworkedParcelInfo network_parcels = <span class="hljs-number">4</span>;
  
  <span class="hljs-comment">// identifiers for real-estate business networks which the parcel may be</span>
  <span class="hljs-comment">// associated with.</span>
  <span class="hljs-keyword">repeated</span> NetworkLocationInfo possible_networks = <span class="hljs-number">5</span>;

  reserved <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">6</span>;  <span class="hljs-comment">// wire-compatibility with SFParcelLegacyQueryResult.</span>
}

<span class="hljs-comment">// params in server/rest/handlers/parcel/owners.js</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">SFParcelOwnersQueryParams</span> </span>{
  <span class="hljs-comment">// block lot identifier of a parcel, as is appears in sf assessor records.</span>
  <span class="hljs-comment">// exact string match only.</span>
  <span class="hljs-built_in">string</span> search_string = <span class="hljs-number">1</span>;
}

<span class="hljs-comment">// result in server/rest/handlers/parcel/owners.js</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">SFParcelOwnersQueryResult</span> </span>{
  <span class="hljs-comment">// individuals or businesses believed to own the parcel, in full or in part.</span>
  <span class="hljs-keyword">repeated</span> SFAssessorParcelOwner owners = <span class="hljs-number">3</span>;

  <span class="hljs-comment">// total number of parcels believed to be owned by all the full and part</span>
  <span class="hljs-comment">// owners of the queried parcel.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// added in late 2020, not a part of the original may 2020 api.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Verify that this is useful, and that it means what we think it does.</span>
  <span class="hljs-built_in">int32</span> parcels = <span class="hljs-number">6</span>;

  reserved <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>;  <span class="hljs-comment">// wire-compatibility with SFParcelLegacyQueryResult</span>
}

<span class="hljs-comment">// params in server/rest/handlers/network.js &#x27;business&#x27; query.</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">NetworkBusinessEntityQueryParams</span> </span>{
  <span class="hljs-comment">// normalized name of the business, derived from the name found in california</span>
  <span class="hljs-comment">// sec. of state business records.</span>
  <span class="hljs-built_in">string</span> be_name = <span class="hljs-number">1</span>;

  <span class="hljs-comment">// &quot;corp&quot; or &quot;lp&quot;, depending on whether the business is a corporation or</span>
  <span class="hljs-comment">// limited-partnership/llc.</span>
  <span class="hljs-built_in">string</span> input_type = <span class="hljs-number">2</span>;
}

<span class="hljs-comment">// result of server/rest/handlers/network.js &#x27;business&#x27; query.</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">NetworkBusinessEntityQueryResult</span> </span>{
  <span class="hljs-comment">// normalized name of the business, matching be_name parameter from input.</span>
  <span class="hljs-built_in">string</span> name_norm = <span class="hljs-number">1</span>;

  <span class="hljs-comment">// list of graph relations (edges) which make up a connected subgraph of the</span>
  <span class="hljs-comment">// ebook graph, representing the business network and its elements.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// each item here contains full descriptions of the relation&#x27;s source and</span>
  <span class="hljs-comment">// destination node, so the caller can reconstruct the subgraph.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// COMPATIBILITY <span class="hljs-doctag">NOTE:</span> this proto message differs from neo4j driver object</span>
  <span class="hljs-comment">// schemas, so conversion is required. see comments on GraphRelation</span>
  <span class="hljs-comment">// definition.</span>
  <span class="hljs-keyword">repeated</span> GraphRelation network_subgraph = <span class="hljs-number">2</span>;
  
  <span class="hljs-comment">// total count of business entities which appear in this network (including</span>
  <span class="hljs-comment">// both corporations and limited-partnerships/llc&#x27;s).</span>
  <span class="hljs-built_in">int32</span> total_bes = <span class="hljs-number">3</span>;

  <span class="hljs-comment">// normalized names of most-connected business in the network.</span>
  <span class="hljs-comment">// (SOS_Corp or SOS_LP nodes with highest degree).</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// optional field __typename is set, so caller can disambiguate between</span>
  <span class="hljs-comment">// business types. returns 5 entries as of 2021/03/12.</span>
  <span class="hljs-keyword">repeated</span> NormalizedName top_bes = <span class="hljs-number">4</span>;

  <span class="hljs-comment">// normalized names of owners-of-businesses most connected in the graph</span>
  <span class="hljs-comment">// (SOS_Owner nodes with matching network_id, with highest degree). these</span>
  <span class="hljs-comment">// owners can be individuals, or other businesses. returns 5 entries as of</span>
  <span class="hljs-comment">// 2021/03/12. optional field &#x27;__typename&#x27; is NOT set.</span>
  <span class="hljs-comment">// </span>
  <span class="hljs-comment">// see SOS_Owner node / CalSOSOwnerData in graph/nodes.proto.</span>
  <span class="hljs-keyword">repeated</span> NormalizedName top_owners = <span class="hljs-number">5</span>;

  <span class="hljs-comment">// readable addresses which are the most well-connected in the graph.</span>
  <span class="hljs-comment">// (Address_Unit nodes with matching network_id with highest degree). returns</span>
  <span class="hljs-comment">// 5 entries as of 2021/03/12.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> describe what causes these addresses to be considered for inclusion.</span>
  <span class="hljs-comment">// clarify if they&#x27;re physical addresses of component businesses/owners of</span>
  <span class="hljs-comment">// the network, or real-estate properties held by the network.</span>
  <span class="hljs-comment">// see Address_Unit node / AddressUnitData in graph/nodes.proto.</span>
  <span class="hljs-keyword">repeated</span> ReadableAddress top_addrs = <span class="hljs-number">6</span>;
}

<span class="hljs-comment">// params in server/rest/handlers/network.js &#x27;parcel&#x27; query.</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">NetworkParcelQueryParams</span> </span>{
  <span class="hljs-comment">// the block_lot of a parcel, which uniquely identifies it in the ebook graph</span>
  <span class="hljs-comment">// and in sf assessor records. required.</span>
  <span class="hljs-built_in">string</span> block_lot = <span class="hljs-number">1</span>;

}

<span class="hljs-comment">// result of server/rest/handlers/network.js &#x27;parcel&#x27; query.</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">NetworkParcelQueryResult</span> </span>{
  <span class="hljs-comment">// string representing the parcel&#x27;s street address, including street number,</span>
  <span class="hljs-comment">// street name and suffix, and unit number. The parcel is assumed to be</span>
  <span class="hljs-comment">// within SF city/county limits.</span>
  <span class="hljs-comment">// </span>
  <span class="hljs-comment">// See &#x27;addr&#x27; in A_Parcel node as described by SFAssessorParcelData in</span>
  <span class="hljs-comment">// graph/nodes.proto.</span>
  <span class="hljs-built_in">string</span> addr = <span class="hljs-number">1</span>;

  <span class="hljs-comment">// list of graph relations (edges) which make up a connected subgraph of the</span>
  <span class="hljs-comment">// ebook graph, representing the business network and its elements.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// each item here contains full descriptions of the relation&#x27;s source and</span>
  <span class="hljs-comment">// destination node, so the caller can reconstruct the subgraph.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// COMPATIBILITY <span class="hljs-doctag">NOTE:</span> this proto message differs from neo4j driver object</span>
  <span class="hljs-comment">// schemas, so conversion is required. see comments on GraphRelation</span>
  <span class="hljs-comment">// definition.</span>
  <span class="hljs-keyword">repeated</span> GraphRelation network_subgraph = <span class="hljs-number">2</span>;

  <span class="hljs-comment">// total count of business entities which appear in this network (including</span>
  <span class="hljs-comment">// both corporations and limited-partnerships/llc&#x27;s).</span>
  <span class="hljs-built_in">int32</span> total_bes = <span class="hljs-number">3</span>;

  <span class="hljs-comment">// see comment in NetworkBusinessEntityQueryResult above.</span>
  <span class="hljs-keyword">repeated</span> NormalizedName top_bes = <span class="hljs-number">4</span>;

  <span class="hljs-comment">// see comment in NetworkBusinessEntityQueryResult above.</span>
  <span class="hljs-keyword">repeated</span> NormalizedName top_owners = <span class="hljs-number">5</span>;

  <span class="hljs-comment">// see comment in NetworkBusinessEntityQueryResult above.</span>
  <span class="hljs-keyword">repeated</span> ReadableAddress top_addrs = <span class="hljs-number">6</span>;
}

<span class="hljs-comment">////////////////////////</span>
<span class="hljs-comment">//  Search messages: </span>
<span class="hljs-comment">////////////////////////</span>

<span class="hljs-comment">// business entity and parcel string-based search are defined below.</span>

<span class="hljs-comment">// business entity search. queries are interpreted as a prefix-tree search on</span>
<span class="hljs-comment">// the normalized set of business entity names.</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">BusinessEntityIndexSearchParams</span> </span>{
  <span class="hljs-built_in">string</span> query = <span class="hljs-number">1</span>;
}

<span class="hljs-comment">// aggregation of matching search records. this would be a good place to add</span>
<span class="hljs-comment">// pagination tokens or other metadata about the results.</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">BusinessEntityIndexSearchResult</span> </span>{
  <span class="hljs-comment">// list of individual matching records.</span>
  <span class="hljs-keyword">repeated</span> BusinessEntityIndexRecord records = <span class="hljs-number">1</span>; 
}

<span class="hljs-comment">// a single business entity search result.</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">BusinessEntityIndexRecord</span> </span>{
  <span class="hljs-comment">// the type name of the ebook graph node representing this business,</span>
  <span class="hljs-comment">// &quot;SOS_Corp&quot; or &quot;SOS_LP&quot;.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// included explicitly, so that the calling code can distinguish between</span>
  <span class="hljs-comment">// corporation and limited-business nodes.</span>
  <span class="hljs-built_in">string</span> __typename = <span class="hljs-number">1</span>;

  <span class="hljs-comment">// the business entity&#x27;s name, after normalization. this name can be used as</span>
  <span class="hljs-comment">// a query parameter for retrieving information about a corporation or</span>
  <span class="hljs-comment">// limited-business.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// todo: document the normalization scheme.</span>
  <span class="hljs-built_in">string</span> name_norm = <span class="hljs-number">2</span>;
}

<span class="hljs-comment">// parcel search. query is implemented as a prefix-tree search on the parcels&#x27;</span>
<span class="hljs-comment">// lot-level address strings.</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">ParcelIndexSearchParams</span> </span>{
  <span class="hljs-comment">// prefix string for an sf assessor parcel&#x27;s lot-level address, as it appears</span>
  <span class="hljs-comment">// in normalized form in the ebook dataset.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// todo: clarify formatting and the role of unit number. </span>
  <span class="hljs-built_in">string</span> query = <span class="hljs-number">1</span>;
}

<span class="hljs-comment">// aggregation of parcel search results.</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">ParcelIndexSearchResult</span> </span>{
  <span class="hljs-comment">// list of individual matching records.</span>
  <span class="hljs-keyword">repeated</span> ParcelIndexRecord records = <span class="hljs-number">1</span>;
}

<span class="hljs-comment">// an individual parcel search result.</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">ParcelIndexRecord</span> </span>{
  <span class="hljs-comment">// the street address component of this parcel&#x27;s physical address.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// todo: clarify whether this is lot-level address or unit-level.</span>
  <span class="hljs-built_in">string</span> addr = <span class="hljs-number">1</span>;

  <span class="hljs-comment">// the parcel&#x27;s block lot number, which uniquely identifies a parcel in the</span>
  <span class="hljs-comment">// sf assessor&#x27;s data.</span>
  <span class="hljs-built_in">string</span> block_lot = <span class="hljs-number">2</span>;
}

</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemaslegacyprotoqueryutil.proto"><a href="#toc"><a name="server-schemas-legacy-proto-query-util-proto">server/schemas/legacy/proto/query/util.proto</a></a></h2>
<pre><code><span class="hljs-comment">// query/util.proto</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// contains helper messages which are useful in the query abstraction layer</span>
<span class="hljs-comment">// proto definitons.</span>
syntax = <span class="hljs-string">&quot;proto3&quot;</span>;

<span class="hljs-keyword">package</span> query;

<span class="hljs-comment">// convience wrapper for normalized names.</span>
<span class="hljs-comment">// semantically neutral, used in a variety of contexts.</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">NormalizedName</span> </span>{
  <span class="hljs-comment">// a normalized name, as it appears in the graph.</span>
  <span class="hljs-built_in">string</span> name_norm = <span class="hljs-number">1</span>;

  <span class="hljs-comment">// optional. node type of the graph node where this name_norm was found.</span>
  <span class="hljs-comment">// typically set for names of business entities, where there is a need to</span>
  <span class="hljs-comment">// differentiate between SOS_Corp and SOS_LP.</span>
  <span class="hljs-built_in">string</span> __typename = <span class="hljs-number">2</span>;
}

<span class="hljs-comment">// convenience wrapper for human-readable addresses.</span>
<span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> describe normalization, etc.</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">ReadableAddress</span> </span>{
  <span class="hljs-comment">// readable/friendly representation of an address. normalization and internal</span>
  <span class="hljs-comment">// structure may vary based on where this; check the containing message for</span>
  <span class="hljs-comment">// details.</span>
  <span class="hljs-built_in">string</span> addr_readable = <span class="hljs-number">1</span>;
}

</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemaslegacyprotorestbusiness.proto"><a href="#toc"><a name="server-schemas-legacy-proto-rest-business-proto">server/schemas/legacy/proto/rest/business.proto</a></a></h2>
<pre><code><span class="hljs-comment">// rest/business.proto</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// message definitions for business entities (corporations and</span>
<span class="hljs-comment">// limited-partnerships/llc&#x27;s) as they appear in the ebook api.</span>
syntax = <span class="hljs-string">&quot;proto3&quot;</span>;

<span class="hljs-keyword">package</span> rest;

message CorporationDetails {
  <span class="hljs-comment">// transaction date of the document which established this corporation,</span>
  <span class="hljs-comment">// according to the california secretary of state business registry.</span>
  <span class="hljs-comment">// </span>
  <span class="hljs-comment">// format: &#x27;CCMMYYDD&#x27;.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">transaction_date</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

  <span class="hljs-comment">// an 8 digit corporate identification number, from the california secretary</span>
  <span class="hljs-comment">// of state business registry.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">corporation_number</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;

  <span class="hljs-comment">// date on which this corporation was incorporated, according to the</span>
  <span class="hljs-comment">// california secretary of state business registry.</span>
  <span class="hljs-comment">// format: &#x27;CCYYMMDD&#x27;</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">incorporation_date</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;

  <span class="hljs-comment">// status of the corporation, via calif. sec of state business records.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> these are human-readable labels, unlike equivalent query-proto field.</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> list the labels here.</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> replace with a more flexible and informative representation.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">corporation_status</span> <span class="hljs-operator">=</span> <span class="hljs-number">4</span>;

  <span class="hljs-comment">// describes the legal process used to establish this business, according to</span>
  <span class="hljs-comment">// calif. sec of state business records.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> these are human-readable labels, unlike equivalent query-proto field.</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> list the labels here.</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> replace with a more flexible and informative representation.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">corporation_type</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;

  <span class="hljs-comment">// tax base trype of the corporate, according to calif. sec of state records.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> these are human-readable labels, unlike equivalent query-proto field.</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> list the labels here.</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> replace with a more flexible and informative representation.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">corporation_tax_base</span> <span class="hljs-operator">=</span> <span class="hljs-number">6</span>;

  <span class="hljs-comment">// additional corporate classifications which may convey special status, such</span>
  <span class="hljs-comment">// as &#x27;religious&#x27; or &#x27;agricultural cooperative&#x27; according to calif. sec. of</span>
  <span class="hljs-comment">// state business entity records.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> these are human-readable labels, unlike equivalent query-proto field.</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> list the labels here.</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> replace with a more flexible and informative representation.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">corporation_classification</span> <span class="hljs-operator">=</span> <span class="hljs-number">7</span>;

  <span class="hljs-comment">// limited term expiration date.</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> explain what this means.</span>
  <span class="hljs-comment">// format: &#x27;CCYYMMDD&#x27;</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">term_expiration_date</span> <span class="hljs-operator">=</span> <span class="hljs-number">8</span>;

  <span class="hljs-comment">// describes whether this corporation is in good standing with the california</span>
  <span class="hljs-comment">// franchise tax board (ftb).</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> these are human-readable labels, unlike equivalent query-proto field.</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> list the labels here.</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> replace with a more flexible and informative representation.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">ftb_suspension_status</span> <span class="hljs-operator">=</span> <span class="hljs-number">9</span>;

  <span class="hljs-comment">// if this corporation has been subject to action by the franchise tax board</span>
  <span class="hljs-comment">// as described in &#x27;ftb_suspension_status&#x27;, then this field contains a string</span>
  <span class="hljs-comment">// representation of the date of that action.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// format: &#x27;CCYYMMDD&#x27;</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">ftb_suspension_date</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;

  <span class="hljs-comment">// statement of information file number, per calif sec of state records.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">so_file_number</span> <span class="hljs-operator">=</span> <span class="hljs-number">11</span>;

  <span class="hljs-comment">// last complete statement (of information?) file date.</span>
  <span class="hljs-comment">// format: &#x27;CCYYMMDD&#x27;</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">so_file_date</span> <span class="hljs-operator">=</span> <span class="hljs-number">12</span>;

  <span class="hljs-comment">// name of corporation, directly from calif. sec. of state records without</span>
  <span class="hljs-comment">// normalization.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">corporation_name</span> <span class="hljs-operator">=</span> <span class="hljs-number">13</span>;

  <span class="hljs-comment">// &#x27;care of&#x27; name, meaning the &#x27;c/o&#x27; addressee which should be included on</span>
  <span class="hljs-comment">// mail intended for the corporation.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">co_name</span> <span class="hljs-operator">=</span> <span class="hljs-number">14</span>;

  <span class="hljs-comment">// name of agent of process, as it appears on mailing address.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">agent_name</span> <span class="hljs-operator">=</span> <span class="hljs-number">15</span>;

  <span class="hljs-comment">// mailing address for agent of process, line 1.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">agent_address_line_1</span> <span class="hljs-operator">=</span> <span class="hljs-number">16</span>;

  <span class="hljs-comment">// mailing address for agent of process, line 2.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">agent_address_line_2</span> <span class="hljs-operator">=</span> <span class="hljs-number">17</span>;

  <span class="hljs-comment">// city component of agent of process&#x27;s mailing address.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">agent_address_city</span> <span class="hljs-operator">=</span> <span class="hljs-number">18</span>;

  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> clarify what this means. is it state or county? or both????</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">agent_address_state_county</span> <span class="hljs-operator">=</span> <span class="hljs-number">19</span>;

  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> clarify whether these are 5-digit or 9-digit postal codes.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">agent_address_zip_code</span> <span class="hljs-operator">=</span> <span class="hljs-number">20</span>;

  <span class="hljs-comment">// if the corporation is not &#x27;domestic&#x27; (internal to calif.), then this field</span>
  <span class="hljs-comment">// specified a u.s. state other than california, or a country outside the</span>
  <span class="hljs-comment">// u.s., where this corporation originated.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">state_or_foreign_country</span> <span class="hljs-operator">=</span> <span class="hljs-number">23</span>;

  <span class="hljs-comment">// business entity component id, generated by the ebook data pipeline</span>
  <span class="hljs-comment">// via connected component analysis.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// see BusinessNetworkIdentifier in network_ids.proto for details.</span>
  <span class="hljs-type">int64</span> <span class="hljs-variable">c_id</span> <span class="hljs-operator">=</span> <span class="hljs-number">24</span>;

  <span class="hljs-comment">// parcel ownership network component id, generated by the ebook data</span>
  <span class="hljs-comment">// pipeline via connected component analysis.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// see BusinessNetworkIdentifier in network_ids.proto for details.</span>
  <span class="hljs-type">int64</span> <span class="hljs-variable">network_id</span> <span class="hljs-operator">=</span> <span class="hljs-number">25</span>;
}

message LimitedBusinessDetails {
  <span class="hljs-comment">// llc only: state or county for formation of foreign llc.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">jurisdiction_llc</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
 
  <span class="hljs-comment">// llc only: management structure.</span>
  <span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> these are human-readable labels, unlike equivalent query-proto field.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> list the labels here.</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> this approach lends itself poorly to localization and is cumbersome</span>
  <span class="hljs-comment">//   to use in the client. replace with a more flexible and informative</span>
  <span class="hljs-comment">//   representation.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">llc_management_code</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;

  <span class="hljs-comment">// llc only: type of business.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> provide examples.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">llc_type_of_business</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;

  <span class="hljs-comment">// the filing number of the business entity, which is derived from the date</span>
  <span class="hljs-comment">// on which its filing paperwork was filed. the number is presented as a</span>
  <span class="hljs-comment">// string, with the format described below:</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// format: &#x27;CCYYJJJN9999&#x27;</span>
  <span class="hljs-comment">//   CCYY = century and year</span>
  <span class="hljs-comment">//   JJJ = julian day of year</span>
  <span class="hljs-comment">//   N = record type:</span>
  <span class="hljs-comment">//       0 = lp record</span>
  <span class="hljs-comment">//       1 = llc record</span>
  <span class="hljs-comment">//   9999 = sequence number </span>
  <span class="hljs-type">string</span> <span class="hljs-variable">file_number</span> <span class="hljs-operator">=</span> <span class="hljs-number">4</span>;

  <span class="hljs-comment">// date of original filing for this business. represents the same calendar</span>
  <span class="hljs-comment">// date as the date component of file_number, but follows a different format.</span>
  <span class="hljs-comment">// format: &#x27;CCYYMMDD&#x27;</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">file_date</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;

  <span class="hljs-comment">// identifies current status of lp/llc, as represented in calif. sec. of</span>
  <span class="hljs-comment">// state business entity records.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> these are human-readable labels, unlike equivalent query-proto field.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> list the labels here.</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> this approach lends itself poorly to localization and is cumbersome</span>
  <span class="hljs-comment">//   to use in the client. replace with a more flexible and informative</span>
  <span class="hljs-comment">//   representation.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">status</span> <span class="hljs-operator">=</span> <span class="hljs-number">6</span>; 

  <span class="hljs-comment">// filing type (foreign or domestic) of this lp or llc, as represented in</span>
  <span class="hljs-comment">// calif. sec. of state business entity registry. </span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> these are human-readable labels, in contrast to the equivalent</span>
  <span class="hljs-comment">// query-proto field&#x27;s abbreviations.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> this approach lends itself poorly to localization and is cumbersome</span>
  <span class="hljs-comment">//   to use in the client. replace with a more flexible and informative</span>
  <span class="hljs-comment">//   representation.</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> list the labels here.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">filing_type</span> <span class="hljs-operator">=</span> <span class="hljs-number">7</span>;

  <span class="hljs-comment">// the raw, non-normalized name of this calif. limited partnership or llc,</span>
  <span class="hljs-comment">// as represented in calif. sec. of state business entity registry.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> <span class="hljs-number">8</span>;

  <span class="hljs-comment">// state or country of formation for foreign limited partnerships.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">jurisdiction</span> <span class="hljs-operator">=</span> <span class="hljs-number">9</span>;

  <span class="hljs-comment">// name of agent of process, as it appears on mailing address.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">agent_name</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;

  <span class="hljs-comment">// mailing address for agent of process, line 1.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// CAUTION: naming convention differs from similar field in corp details.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">agent_address_1</span> <span class="hljs-operator">=</span> <span class="hljs-number">11</span>;

  <span class="hljs-comment">// mailing address for agent of process, line 2.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// CAUTION: naming convention differs from similar field in corp details.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">agent_address_2</span> <span class="hljs-operator">=</span> <span class="hljs-number">12</span>;

  <span class="hljs-comment">// city component of agent of process&#x27;s mailing address.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// CAUTION: naming convention differs from similar field in corp details.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">agent_city</span> <span class="hljs-operator">=</span> <span class="hljs-number">13</span>;

  <span class="hljs-comment">// component of agent of process&#x27;s mailing address.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// CAUTION: naming convention differs from similar field in corp details.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">agent_state</span> <span class="hljs-operator">=</span> <span class="hljs-number">14</span>;

  <span class="hljs-comment">// todo: clarify whether these are 5-digit or 9-digit postal codes.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// CAUTION: naming convention differs from similar field in corp details.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">agent_zip</span> <span class="hljs-operator">=</span> <span class="hljs-number">15</span>;

  <span class="hljs-comment">// cause of termination, if this lp/llc has been terminated. </span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> add examples.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">term</span> <span class="hljs-operator">=</span> <span class="hljs-number">16</span>;

  <span class="hljs-comment">// business entity component id, generated by the ebook data pipeline</span>
  <span class="hljs-comment">// via connected component analysis.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// see BusinessNetworkIdentifier in network_ids.proto for details.</span>
  <span class="hljs-type">int64</span> <span class="hljs-variable">c_id</span> <span class="hljs-operator">=</span> <span class="hljs-number">17</span>;

  <span class="hljs-comment">// parcel ownership network component id, generated by the ebook data</span>
  <span class="hljs-comment">// pipeline via connected component analysis.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// see BusinessNetworkIdentifier in network_ids.proto for details.</span>
  <span class="hljs-type">int64</span> <span class="hljs-variable">network_id</span> <span class="hljs-operator">=</span> <span class="hljs-number">18</span>;
}

</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemaslegacyprotoresteviction.proto"><a href="#toc"><a name="server-schemas-legacy-proto-rest-eviction-proto">server/schemas/legacy/proto/rest/eviction.proto</a></a></h2>
<pre><code><span class="hljs-comment">// rest/eviction.proto</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// messages representing evictions and related metadata in ebook api.</span>
syntax = <span class="hljs-string">&quot;proto3&quot;</span>;

<span class="hljs-keyword">import</span> <span class="hljs-string">&quot;network_ids.proto&quot;</span>;

<span class="hljs-keyword">package</span> rest;

message EvictionMetadata {
  <span class="hljs-comment">///////////////////////////////////////////////////////////////////</span>
  <span class="hljs-comment">// fields describing the eviction itself:</span>
  <span class="hljs-comment">///////////////////////////////////////////////////////////////////</span>

  <span class="hljs-comment">// unique id for the eviction in ebook api.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// this is typically derived from sf rent board&#x27;s petition id, but is *NOT*</span>
  <span class="hljs-comment">// equivalent. DO NOT USE THIS FOR DIRECT COMPARISON TO SFRB RECORDS.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> replace this with a less confusing opaque id, and add a field which</span>
  <span class="hljs-comment">// accurately presents the eviction&#x27;s sf rent board petition id (primary key</span>
  <span class="hljs-comment">// in rent board records).</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">evict_id</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

  <span class="hljs-comment">// date on which this eviction took effect, according to public records.</span>
  <span class="hljs-comment">// format: &#x27;CCYYMMDD&#x27;.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">evict_date</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;

  <span class="hljs-comment">// type of eviction, for example &quot;Buyout Declaration&quot; or &quot;Ellis Act</span>
  <span class="hljs-comment">// Withdrawal&quot;.  todo: document supported values for this field.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">type</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;

  <span class="hljs-comment">// attributed evictors according to ellis act withdrawal records. only</span>
  <span class="hljs-comment">// populated for evictions of type &quot;Ellis Act Withdrawal&quot;</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> deprecate this, replace with a well-structured repeated field. this</span>
  <span class="hljs-comment">// is a vestige of v1 data pipeline, and it contains a comma-separated list</span>
  <span class="hljs-comment">// of names that&#x27;s really not worth parsing.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">ellis_evictor</span> <span class="hljs-operator">=</span> <span class="hljs-number">4</span>;

  <span class="hljs-comment">// no one knows what this field means.</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> deprecate and remove.</span>
  <span class="hljs-type">bool</span> <span class="hljs-variable">multiple_sales_matches</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;

  <span class="hljs-comment">///////////////////////////////////////////////////////////////////</span>
  <span class="hljs-comment">// fields representing the parcel where this eviction took place:</span>
  <span class="hljs-comment">///////////////////////////////////////////////////////////////////</span>

  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> move these to their own sub-message, or provide a just the block_lot</span>
  <span class="hljs-comment">// id so the client can retrieve those details in its own way.</span>

  <span class="hljs-comment">// block_lot of the parcel where this eviction tool place. uniquely specifies</span>
  <span class="hljs-comment">// a parcel in sf assessor records.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// unique key for parcel in ebook api.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">block_lot</span> <span class="hljs-operator">=</span> <span class="hljs-number">6</span>;

  <span class="hljs-comment">// num. units at the parcel where this eviction took place (via assessor</span>
  <span class="hljs-comment">// records).</span>
  <span class="hljs-type">double</span> <span class="hljs-variable">units</span> <span class="hljs-operator">=</span> <span class="hljs-number">7</span>;

  <span class="hljs-comment">// latitude (in degrees) of a point within the boundaries of the parcel where</span>
  <span class="hljs-comment">// this eviction took place.</span>
  <span class="hljs-type">double</span> <span class="hljs-variable">lat</span> <span class="hljs-operator">=</span> <span class="hljs-number">8</span>;

  <span class="hljs-comment">// longitude (in degrees) of a point within the boundaries of the parcel where</span>
  <span class="hljs-comment">// this eviction took place.</span>
  <span class="hljs-type">double</span> <span class="hljs-variable">long</span> <span class="hljs-operator">=</span> <span class="hljs-number">9</span>;

  <span class="hljs-comment">// street address of the parcel where this eviction took place (via assessor</span>
  <span class="hljs-comment">// records). see &#x27;addr&#x27; details in parcel.proto</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">addr</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;

  <span class="hljs-comment">// name of the neighorhood that encompasses the parcel where this eviction</span>
  <span class="hljs-comment">// took place (via assessor records). see details in parcel.proto</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">neighborhood</span> <span class="hljs-operator">=</span> <span class="hljs-number">11</span>; 

  <span class="hljs-comment">// no one knows what this means.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> deprecate and remove.</span>
  <span class="hljs-type">bool</span> <span class="hljs-variable">multiple_addr_matches</span> <span class="hljs-operator">=</span> <span class="hljs-number">12</span>;

    
  <span class="hljs-comment">///////////////////////////////////////////////////////////////////</span>
  <span class="hljs-comment">// fields describing attributed evictors:</span>
  <span class="hljs-comment">///////////////////////////////////////////////////////////////////</span>

  <span class="hljs-comment">// only set when this eviction is part of a location-based query (ex:</span>
  <span class="hljs-comment">// neighborhood lookup). when set, contains the name of an attributed</span>
  <span class="hljs-comment">// evictor, or &quot;Unknown&quot; if there are no attributed evictors.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// when this message is part of a business-info query result, name is unset.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> deprecate and remove this, it&#x27;s not helpful and the name is</span>
  <span class="hljs-comment">// seriously confusing.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> <span class="hljs-number">13</span>;

  <span class="hljs-comment">///////////////////////////////////////////////////////////////////</span>
  <span class="hljs-comment">// fields describing attributed business networks:</span>
  <span class="hljs-comment">///////////////////////////////////////////////////////////////////</span>

  <span class="hljs-comment">// note: this is only populated if the eviction message is part of a</span>
  <span class="hljs-comment">// range-based query (such as EvictionsByNeighborhood). it&#x27;s not populted</span>
  <span class="hljs-comment">// when the eviction appears in a parcel query.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// for range-based queries like EvictionsByNeighborhood, the following holds:</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// this is populated if and only if we believe the parcel&#x27;s owner is a</span>
  <span class="hljs-comment">// business, which we have identified with california sec. of state business</span>
  <span class="hljs-comment">// records. contains information about the owning business, and its inferred</span>
  <span class="hljs-comment">// real-estate business network connections.</span>
  <span class="hljs-type">BusinessNetworkIdentifier</span> <span class="hljs-variable">linked_be</span> <span class="hljs-operator">=</span> <span class="hljs-number">14</span>;
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemaslegacyprotorestgraph_util.proto"><a href="#toc"><a name="server-schemas-legacy-proto-rest-graph_util-proto">server/schemas/legacy/proto/rest/graph_util.proto</a></a></h2>
<pre><code><span class="hljs-comment">// rest/graph_util.proto</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// contains helper messages for describing neo4j graphs.</span>
syntax = <span class="hljs-string">&quot;proto3&quot;</span>;

<span class="hljs-keyword">package</span> rest;

<span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span></span>
<span class="hljs-comment">// forked from ../query/graph_util.proto.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// context for notes below: the original ebook API rest responses for network</span>
<span class="hljs-comment">// graph visualization directly included graph representations from the</span>
<span class="hljs-comment">// neo4j-driver library. as such, the exact structure of the GraphNode rest</span>
<span class="hljs-comment">// obj&#x27;s cannot accurately be encoded as proto.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// see notes on &#x27;properties&#x27; below for more info and the workaround.</span>
<span class="hljs-comment">//   -ubuvoid</span>

<span class="hljs-comment">////////////////////////////////////</span>
<span class="hljs-comment">// actual definitions begin here:</span>
<span class="hljs-comment">////////////////////////////////////</span>

<span class="hljs-comment">// representation of a node in the graph, including internal details</span>
<span class="hljs-comment">// particular to the graph&#x27;s instantiation.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// based on the json schema of neo4j data driver&#x27;s query results.</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">GraphNode</span> </span>{
  <span class="hljs-comment">// internal graph db id for this node.</span>
  <span class="hljs-built_in">int64</span> identity = <span class="hljs-number">1</span>;

  <span class="hljs-comment">// the node types that this node has. in our graph, nodes always have a</span>
  <span class="hljs-comment">// single type, as of 2021/03/12, but this may change in the future.</span>
  <span class="hljs-keyword">repeated</span> <span class="hljs-built_in">string</span> labels = <span class="hljs-number">2</span>;

  <span class="hljs-comment">// a json string representing a map of this node&#x27;s properties, where the keys</span>
  <span class="hljs-comment">// are the property names and the values are strings, numbers, or objects.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> this field does not appear in the response objects returned by</span>
  <span class="hljs-comment">// neo4j-driver.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// in the neo4j driver&#x27;s response, &#x27;properties&#x27; is a plain object. this is</span>
  <span class="hljs-comment">// convenient for the programming api, but it means that the driver&#x27;s query</span>
  <span class="hljs-comment">// response can never be fully-type-safely specified as proto.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// this is because the schema of &#x27;properties&#x27; is unpredictable (determined by</span>
  <span class="hljs-comment">// the contents of the db). you could choose to represent it as a map of</span>
  <span class="hljs-comment">// strings/bytes/Any/etc., but the native json representation of the proto</span>
  <span class="hljs-comment">// wouldn&#x27;t match the actual neo4j driver&#x27;s response.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// since we can&#x27;t acheive perfect compatibility, the simplest strategy is to</span>
  <span class="hljs-comment">// encode the &#x27;properties&#x27; object as json. callers should &#x27;JSON.parse&#x27; the</span>
  <span class="hljs-comment">// value of &#x27;properties_json&#x27; into &#x27;properties&#x27; to achieve compatibility with</span>
  <span class="hljs-comment">// the neo4j driver api.</span>
  <span class="hljs-comment">// </span>
  <span class="hljs-comment">// similarly, callers should &#x27;JSON.stringify&#x27; the &#x27;properties&#x27; value of a</span>
  <span class="hljs-comment">// neo4j driver response into &#x27;properties_json&#x27; to allow encoding as proto.</span>
  <span class="hljs-built_in">string</span> properties_json = <span class="hljs-number">3</span>;

  <span class="hljs-comment">// see above. the neo4j-driver object equivalent uses the name &#x27;properties&#x27;;</span>
  <span class="hljs-comment">// to make conversion code clearer, don&#x27;t reuse that name.</span>
  <span class="hljs-built_in">bytes</span> properties = <span class="hljs-number">4</span> [deprecated = <span class="hljs-literal">true</span>];

  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> add another representation of &#x27;properties&#x27; that&#x27;s more well-suited</span>
  <span class="hljs-comment">// to querying directly from proto.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// one suggestion: map&lt;string, GraphProperty&gt; properties_map = 5;</span>
  <span class="hljs-comment">// where GraphProperty contains oneof stringValue, intValue, etc.</span>
}

<span class="hljs-comment">// representation of a relation (edge) in the graph, including internal details</span>
<span class="hljs-comment">// particular to the graph&#x27;s instantiation. based on the js obj schema of</span>
<span class="hljs-comment">// neo4j-driver&#x27;s query results.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> a GraphRelation as described here contains the complete set of info</span>
<span class="hljs-comment">// for both nodes that it connects! that means that storing a graph as a list</span>
<span class="hljs-comment">// of these GraphRelation objects is inefficient, because the same node may be</span>
<span class="hljs-comment">// described many times (once for each connecting edge).</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">GraphRelation</span> </span>{
  <span class="hljs-comment">// origin node of the relation.</span>
  GraphNode start = <span class="hljs-number">1</span>;

  <span class="hljs-comment">// destination node of the relation. <span class="hljs-doctag">NOTE:</span> as of 2021/03/12, edges are</span>
  <span class="hljs-comment">// treated as though they bidirectional in ebook graph analysis.</span>
  GraphNode end = <span class="hljs-number">2</span>;

  <span class="hljs-comment">// the relation/edge&#x27;s type in the graph (&quot;ENTITY_OWNED_BY&quot;, etc.).</span>
  <span class="hljs-built_in">string</span> type = <span class="hljs-number">3</span>;
}

</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemaslegacyprotorestnetwork.proto"><a href="#toc"><a name="server-schemas-legacy-proto-rest-network-proto">server/schemas/legacy/proto/rest/network.proto</a></a></h2>
<pre><code><span class="hljs-comment">// rest/network.proto</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// messages representing real-estate business networks and their holdings in</span>
<span class="hljs-comment">// the ebook api.</span>
syntax = <span class="hljs-string">&quot;proto3&quot;</span>;

<span class="hljs-keyword">import</span> <span class="hljs-string">&quot;parcel.proto&quot;</span>;

<span class="hljs-keyword">package</span> rest;

<span class="hljs-comment">// top-level overview of a real-estate network. this is the network view used</span>
<span class="hljs-comment">// in the &#x27;parcel&#x27; rest endpoints.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> add a network_id field for easy identification in client.</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">NetworkSummary</span> </span>{
  <span class="hljs-comment">// mailing addresses which may identify this network. this is *NOT* an</span>
  <span class="hljs-comment">// exhaustive list of addresses within the network.</span>
  <span class="hljs-keyword">repeated</span> <span class="hljs-built_in">string</span> searched_mail_address = <span class="hljs-number">1</span>;

  <span class="hljs-comment">// info about parcels which may be related via both being financial interests</span>
  <span class="hljs-comment">// of this real-estate business network.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> remove this, replace with just the id&#x27;s and perhaps address. the</span>
  <span class="hljs-comment">// client can retrieve parcel details if needed. &#x27;possible_networks&#x27; may be a</span>
  <span class="hljs-comment">// field we need to expose through other means.</span>
  <span class="hljs-keyword">repeated</span> NetworkedParcelSummary related_parcels = <span class="hljs-number">2</span>;
}

</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemaslegacyprotorestnetwork_ids.proto"><a href="#toc"><a name="server-schemas-legacy-proto-rest-network_ids-proto">server/schemas/legacy/proto/rest/network_ids.proto</a></a></h2>
<pre><code><span class="hljs-comment">// rest/network_ids.proto</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// messages representing network id&#x27;s and other identifier structs used in</span>
<span class="hljs-comment">// ebook api.</span>
syntax = <span class="hljs-string">&quot;proto3&quot;</span>;

<span class="hljs-keyword">package</span> rest;

<span class="hljs-comment">// id and location characteristics of a real-estate business network.</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">NetworkLocationInfo</span> </span>{
  <span class="hljs-comment">// an address in the ebook datastore where the central owning entity of a</span>
  <span class="hljs-comment">// real-estate business network is believed to be located.</span>
  <span class="hljs-built_in">string</span> addr_readable = <span class="hljs-number">1</span>;

  <span class="hljs-comment">// network id of the real-estate business network believed to be</span>
  <span class="hljs-comment">// headquartered at addr_readable.</span>
  <span class="hljs-built_in">int64</span> network_id = <span class="hljs-number">2</span>;
}

<span class="hljs-comment">// id&#x27;s used to refer to a real-estate holding network, as modeled by</span>
<span class="hljs-comment">// analysis of the calif. sec. of state business registry.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// see the developer guide for a detailed description of the evictorbook&#x27;s</span>
<span class="hljs-comment">// network connection methodology in the section &quot;Network Connection Method -</span>
<span class="hljs-comment">// Detailed &gt; During DB Creation&quot;.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// c_id assignment is described in step &#x27;I&#x27; of that section and network_id</span>
<span class="hljs-comment">// assignment is described in step &#x27;III&#x27;.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> This message name is inaccurate; it really represents a Business, not</span>
<span class="hljs-comment">// a Network. Need to rename.</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">BusinessNetworkIdentifier</span> </span>{
  <span class="hljs-comment">// type of business record in ebook datastore (&quot;SOS_LP&quot;, &quot;SOS_Corp&quot;) from</span>
  <span class="hljs-comment">// which this business information was extracted.</span>
  <span class="hljs-built_in">string</span> __typename = <span class="hljs-number">1</span>;

  <span class="hljs-comment">// business network id of this business in ebook datastore, as inferred</span>
  <span class="hljs-comment">// by graph analysis. see graph schema documentation for details.</span>
  <span class="hljs-built_in">int64</span> network_id = <span class="hljs-number">2</span>;

  <span class="hljs-comment">// connected component id of this business in ebook datastore, as</span>
  <span class="hljs-comment">// inferred by graph analysis. all businesses with the same c_id must</span>
  <span class="hljs-comment">// also have the same network_id, though two businesses with the same</span>
  <span class="hljs-comment">// network_id may have different c_id&#x27;s. see graph documentation and</span>
  <span class="hljs-comment">// developer guide for details.</span>
  <span class="hljs-built_in">int64</span> c_id = <span class="hljs-number">3</span>;

  <span class="hljs-comment">// normalized name of the business in the ebook datastore (node type:</span>
  <span class="hljs-comment">// &quot;SOS_LP&quot; or &quot;SOS_Corp&quot;) from which this network information was extracted.</span>
  <span class="hljs-built_in">string</span> name_norm = <span class="hljs-number">4</span>;
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemaslegacyprotorestparcel.proto"><a href="#toc"><a name="server-schemas-legacy-proto-rest-parcel-proto">server/schemas/legacy/proto/rest/parcel.proto</a></a></h2>
<pre><code><span class="hljs-comment">// rest/parcel.proto</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// parcel-related messages as they appear in ebook api v1 responses.</span>
syntax = <span class="hljs-string">&quot;proto3&quot;</span>;

<span class="hljs-keyword">import</span> <span class="hljs-string">&quot;network_ids.proto&quot;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">&quot;util.proto&quot;</span>;

<span class="hljs-keyword">package</span> rest;

<span class="hljs-comment">// detailed info about a real-estate parcel from the sf assessor&#x27;s office.</span>
message ParcelDetails {
  <span class="hljs-comment">// year in which the buildings on this real-estate parcel were first constructed.</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> describe behavior for multi-building parcels.</span>
  <span class="hljs-type">int32</span> <span class="hljs-variable">yr_built</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

  <span class="hljs-comment">// string containing parcel&#x27;s street address, including street number, street</span>
  <span class="hljs-comment">// name and suffix, and unit number. parcel is assumed to be within sf</span>
  <span class="hljs-comment">// city/county limits.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// notes from schema definition sheet:</span>
  <span class="hljs-comment">// full address in the format of &quot;ST_START_NO-ST_END_NO ST_NAME ST_TYPE (Unit</span>
  <span class="hljs-comment">// UNIT)&quot; (w/o end no if no address range, w/o parentheses if no unit)</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">addr</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;

  <span class="hljs-comment">// &#x27;block_lot&#x27; identifier. unique key for a parcel in sf assessor records,</span>
  <span class="hljs-comment">// and unique key for A_Parcel nodes in the database.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">block_lot</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;

  <span class="hljs-comment">// latitude in degrees of a point within this parcel&#x27;s boundaries.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> specify bounds.</span>
  <span class="hljs-type">double</span> <span class="hljs-variable">lat</span> <span class="hljs-operator">=</span> <span class="hljs-number">4</span>;

  <span class="hljs-comment">// longitude in degrees of a point within this parcel&#x27;s boundaries.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> specify bounds.</span>
  <span class="hljs-type">double</span> <span class="hljs-variable">long</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;

  <span class="hljs-comment">// name of the neighborhood this parcel occupies. as of 2020/09/26, it&#x27;s</span>
  <span class="hljs-comment">// assumed that all parcels are within sf city and county, so these are san</span>
  <span class="hljs-comment">// francisco neighborhoods.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// neighborhoods assigned using sf polygons.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// names and polygon boundaries:</span>
  <span class="hljs-comment">// https://data.sfgov.org/Geographic-Locations-and-Boundaries/SF-Find-Neighborhoods/pty2-tcw4</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> deprecate this field in favor of a NeighborhoodInfo struct or</span>
  <span class="hljs-comment">// canonical neighborhood_id.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">neighborhood</span> <span class="hljs-operator">=</span> <span class="hljs-number">6</span>;

  <span class="hljs-comment">// rough assessment of this parcel&#x27;s rent-control status.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// 0 (default) if data unavailable to determine rent controlled status, </span>
  <span class="hljs-comment">// 1 if likely rent controlled,</span>
  <span class="hljs-comment">// 2 if doubtful that this is rent controlled</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> replace with an enum.</span>
  <span class="hljs-type">int32</span> <span class="hljs-variable">rent_controlled</span> <span class="hljs-operator">=</span> <span class="hljs-number">7</span>;

  <span class="hljs-comment">// property class code, via sf assessor&#x27;s office.</span>
  <span class="hljs-comment">// definitons:</span>
  <span class="hljs-comment">// https://data.sfgov.org/Housing-and-Buildings/Reference-Assessor-Recorder-Property-Class-Codes/pa56-ek2h/data</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> replace with an enum.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">prop_class_code</span> <span class="hljs-operator">=</span> <span class="hljs-number">8</span>;

  <span class="hljs-comment">// i.d. for the zoning district this parcel occupies.</span>
  <span class="hljs-comment">// sf zoning district definitions:</span>
  <span class="hljs-comment">// https://sfplanninggis.org/pim/map.html?layers=Zoning%20Districts</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> replace with an enum.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">zone</span> <span class="hljs-operator">=</span> <span class="hljs-number">9</span>;

  <span class="hljs-comment">// how tall is the building on this parcel, in stories.</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> behavior for multi-building parcels?</span>
  <span class="hljs-type">int32</span> <span class="hljs-variable">stories</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;

  <span class="hljs-comment">// number of physical units within this logical real-estate parcel.</span>
  <span class="hljs-type">int32</span> <span class="hljs-variable">units</span> <span class="hljs-operator">=</span> <span class="hljs-number">11</span>;

  <span class="hljs-comment">// number of total rooms within buildings on this parcel (for multi-unit</span>
  <span class="hljs-comment">// parcels, this is the sum of rooms among all units.)</span>
  <span class="hljs-type">int32</span> <span class="hljs-variable">rooms</span> <span class="hljs-operator">=</span> <span class="hljs-number">12</span>;

  <span class="hljs-comment">// number of total bedrooms on this parcel (for multi-unit parcels, this is</span>
  <span class="hljs-comment">// the sum of bedrooms among all units.)</span>
  <span class="hljs-type">int32</span> <span class="hljs-variable">beds</span> <span class="hljs-operator">=</span> <span class="hljs-number">13</span>;

  <span class="hljs-comment">// assessor valuation of the &#x27;land&#x27; base value, i.e. the parcel&#x27;s theoretical</span>
  <span class="hljs-comment">// value if it had no buildings on it.</span>
  <span class="hljs-type">int32</span> <span class="hljs-variable">assess_land_val</span> <span class="hljs-operator">=</span> <span class="hljs-number">14</span>;

  <span class="hljs-comment">// assessor valuation of the &#x27;improvement&#x27; done to the land via development,</span>
  <span class="hljs-comment">// as of most recent assessment. units in u.s. dollars.</span>
  <span class="hljs-type">int32</span> <span class="hljs-variable">assess_imp_val</span> <span class="hljs-operator">=</span> <span class="hljs-number">15</span>;

  <span class="hljs-comment">// date when the parcel&#x27;s value was last assessed.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// format: CCYYMMDD</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">assess_val_date</span> <span class="hljs-operator">=</span> <span class="hljs-number">16</span>;

  <span class="hljs-comment">// date on which this parcel&#x27;s address was last updated, via assessor</span>
  <span class="hljs-comment">// records.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// format: CCYYMMDD</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">update_date</span> <span class="hljs-operator">=</span> <span class="hljs-number">17</span>;

  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> document the provenance of this information, and when it is set.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// units in u.s. dollars.</span>
  <span class="hljs-type">int32</span> <span class="hljs-variable">curr_sales_price</span> <span class="hljs-operator">=</span> <span class="hljs-number">18</span>;

  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> document the provenance of this information, and when it is set.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// format: CCYYMMDD</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">curr_sales_date</span> <span class="hljs-operator">=</span> <span class="hljs-number">19</span>;

  <span class="hljs-comment">// if the logical parcel occupies more than one street number, then this field</span>
  <span class="hljs-comment">// contains the lowest street number in that range.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// if the logical parcel occupies only one street number, then this field</span>
  <span class="hljs-comment">// contains that number.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> why no parc_end_no field?</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> replace with a well-defined address message.</span>
  <span class="hljs-type">int32</span> <span class="hljs-variable">parc_start_no</span> <span class="hljs-operator">=</span> <span class="hljs-number">20</span>;

  <span class="hljs-comment">// main name part of the street/route name of the parcel&#x27;s address.</span>
  <span class="hljs-comment">// (ex: &quot;geary&quot;, &quot;first&quot;, &quot;taylor&quot;, etc.)</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> describe capitalization, stylization, etc.</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> replace with a well-defined address message.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">parc_street_name</span> <span class="hljs-operator">=</span> <span class="hljs-number">21</span>;

  <span class="hljs-comment">// street suffix (ex: &quot;st&quot;, &quot;ln&quot;) of the parcel&#x27;s address.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> describe capitalization, stylization, etc.</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> replace with a well-defined address message.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">parc_street_type</span> <span class="hljs-operator">=</span> <span class="hljs-number">22</span>;

  <span class="hljs-comment">// unit or subpremise identifier. just the number or letter. </span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> replace with a well-defined address message.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">parc_unit_no</span> <span class="hljs-operator">=</span> <span class="hljs-number">23</span>;

  <span class="hljs-comment">// five-digit u.s. postal code of the parcel&#x27;s address, as an integer.</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> replace with a well-defined address message.</span>
  <span class="hljs-type">int32</span> <span class="hljs-variable">parc_zip</span> <span class="hljs-operator">=</span> <span class="hljs-number">24</span>;
}

<span class="hljs-comment">// Summary of parcel info, with less information than ParcelDetails. Used in</span>
<span class="hljs-comment">// business lookup calls to describe parcels owned by that business.</span>
message ParcelBriefOwnershipInfo {
  <span class="hljs-comment">// &#x27;block_lot&#x27; identifier. unique key for a parcel in sf assessor records,</span>
  <span class="hljs-comment">// and unique key for A_Parcel nodes in the database.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">block_lot</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

  <span class="hljs-comment">// date listed on the documents recording ownership of the parcel.</span>
  <span class="hljs-comment">// todo: describe behavior for parcels with multiple owners.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// format: CCYYMMDD</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">record_date</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;

  <span class="hljs-comment">// ownership percentage, of the assigned owner, expressed as an integer</span>
  <span class="hljs-comment">// between 0 and 100, returned as a floating point number.</span>
  <span class="hljs-type">double</span> <span class="hljs-variable">perc_owner</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;

  <span class="hljs-comment">// a string representing the parcel&#x27;s street address, including street</span>
  <span class="hljs-comment">// number, street name and suffix, and unit number. the parcel is assumed to</span>
  <span class="hljs-comment">// be within sf city/county limits.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">addr</span> <span class="hljs-operator">=</span> <span class="hljs-number">4</span>;

  <span class="hljs-comment">// number of recorded evictions associated with this parcel in the ebook graph.</span>
  <span class="hljs-type">int32</span> <span class="hljs-variable">num_evictions</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;

  <span class="hljs-comment">// number of units that this parcel consists of, according to sf city and</span>
  <span class="hljs-comment">// county assessor records.</span>
  <span class="hljs-type">double</span> <span class="hljs-variable">units</span> <span class="hljs-operator">=</span> <span class="hljs-number">6</span>;

  <span class="hljs-comment">// latitude, in degrees, of a point within this parcel&#x27;s boundaries.</span>
  <span class="hljs-type">double</span> <span class="hljs-variable">lat</span> <span class="hljs-operator">=</span> <span class="hljs-number">7</span>;

  <span class="hljs-comment">// longitude, in degrees, of a point within this parcel&#x27;s boundaries.</span>
  <span class="hljs-type">double</span> <span class="hljs-variable">long</span> <span class="hljs-operator">=</span> <span class="hljs-number">8</span>;

  <span class="hljs-comment">// name of the neighborhood this parcel occupies. as of 2021/03/11, it&#x27;s</span>
  <span class="hljs-comment">// assumed that all parcels are within sf city and county, so these are sf</span>
  <span class="hljs-comment">// neighborhoods.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// values correspond to names of the neighborhood polygons described at:</span>
  <span class="hljs-comment">// https://data.sfgov.org/Geographic-Locations-and-Boundaries/SF-Find-Neighborhoods/pty2-tcw4</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">neighborhood</span> <span class="hljs-operator">=</span> <span class="hljs-number">9</span>;
}

<span class="hljs-comment">// info about an individual, business, trust, or other legal entity which owns</span>
<span class="hljs-comment">// a real-estate parcel, in full or in part.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// *NOT* to be confused with a property corporation.  this message contains</span>
<span class="hljs-comment">// only information that is accessible from assessor records for the relevant</span>
<span class="hljs-comment">// parcel.</span>
message ParcelOwner {
  <span class="hljs-comment">// physical mailing address where this owner can be reached, according to</span>
  <span class="hljs-comment">// assessor parcel records.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">mailing_address</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

  <span class="hljs-comment">// date on which this ownership was documented, according to assessor records.</span>
  <span class="hljs-comment">// format: CCYYMMDD</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">record_date</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;

  <span class="hljs-comment">// ownership percentage, as a number between 0 and 100, as it appears in</span>
  <span class="hljs-comment">// assessor records.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// a value of &#x27;100&#x27; indicates full ownership. a lesser value indicates</span>
  <span class="hljs-comment">// partial ownership. note that for some parcels, we may have information</span>
  <span class="hljs-comment">// about some but not all owners. do *NOT* rely on the ownership percentages</span>
  <span class="hljs-comment">// for recorded owners adding up to 100.</span>
  <span class="hljs-type">double</span> <span class="hljs-variable">perc_owner</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;

  <span class="hljs-comment">// name of owner listed on parcel records from assessor&#x27;s office.</span>
  <span class="hljs-comment">// todo: briefly describe how/whether this data was normalized.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">owner_name</span> <span class="hljs-operator">=</span> <span class="hljs-number">4</span>;

  <span class="hljs-comment">// optional.</span>
  <span class="hljs-comment">// this is populated if and only if we believe this owner is a business,</span>
  <span class="hljs-comment">// which we have identified with california sec. of state business records.</span>
  <span class="hljs-comment">// contains information about the owning business, and its inferred</span>
  <span class="hljs-comment">// real-estate business network connections.</span>
  <span class="hljs-type">BusinessNetworkIdentifier</span> <span class="hljs-variable">linked_be</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;
}

<span class="hljs-comment">// contextual info about a parcel, in relation to a particular real-estate</span>
<span class="hljs-comment">// business network. see NetworkSummary in rest/network.proto for usage.</span>
message NetworkedParcelSummary {
  <span class="hljs-comment">/////////////////////////////</span>
  <span class="hljs-comment">//  metadata about parcel:</span>
  <span class="hljs-comment">/////////////////////////////</span>

  <span class="hljs-comment">// block_lot of the parcel in assessor records. primary key in ebook api.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">block_lot</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

  <span class="hljs-comment">// address of the parcel, as derived from sf assessor records.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">addr</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;

  <span class="hljs-comment">// total amount of evictions believed to have occurred at the networked</span>
  <span class="hljs-comment">// property, which appear in ebook&#x27;s datastore. no bounds on eviction date.</span>
  <span class="hljs-type">int32</span> <span class="hljs-variable">num_evictions</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;

  <span class="hljs-comment">// number of units that the relevant parcel consists of, according to sf</span>
  <span class="hljs-comment">// city and county assessor records. for multi-building properties, this</span>
  <span class="hljs-comment">// is the sum of all units among buildings on the property.</span>
  <span class="hljs-type">int32</span> <span class="hljs-variable">units</span> <span class="hljs-operator">=</span> <span class="hljs-number">4</span>;

  <span class="hljs-comment">// latitude (in degrees) of a point within the networked property.</span>
  <span class="hljs-type">double</span> <span class="hljs-variable">lat</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;

  <span class="hljs-comment">// longitude (in degrees) of a point within the networked property.</span>
  <span class="hljs-type">double</span> <span class="hljs-variable">long</span> <span class="hljs-operator">=</span> <span class="hljs-number">6</span>;

  <span class="hljs-comment">// name of the neighborhood this parcel occupies.</span>
  <span class="hljs-comment">// see parcel.proto for description of valid neighborhood names.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">neighborhood</span> <span class="hljs-operator">=</span> <span class="hljs-number">7</span>;

  <span class="hljs-comment">// individuals, businesses, or other legal entities believed to own the</span>
  <span class="hljs-comment">// networked parcel in whole or in part.</span>
  message NetworkedParcelOwner {
    <span class="hljs-comment">// owner of the networked parcel, as it appears in that parcel&#x27;s assessor</span>
    <span class="hljs-comment">// records.</span>
    <span class="hljs-type">string</span> <span class="hljs-variable">owner_name</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

    <span class="hljs-comment">// optional.</span>
    <span class="hljs-comment">// this is populated if and only if we believe this owner is a business,</span>
    <span class="hljs-comment">// which we have identified with california sec. of state business records.</span>
    <span class="hljs-comment">// contains information about the owning business, and its inferred</span>
    <span class="hljs-comment">// real-estate business network connections.</span>
    <span class="hljs-type">BusinessNetworkIdentifier</span> <span class="hljs-variable">linked_be</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;

    <span class="hljs-comment">// set when mailing_address is believed to also be the cental mailing</span>
    <span class="hljs-comment">// address of a real-estate business network central business&#x27;s hq. in</span>
    <span class="hljs-comment">// that case, it&#x27;s the network id of the business network headquartered</span>
    <span class="hljs-comment">// at that address.</span>
    <span class="hljs-type">string</span> <span class="hljs-variable">ma_network_id</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;

    <span class="hljs-comment">// physical mailing address where the owner can be contacted, according</span>
    <span class="hljs-comment">// to assessor records.</span>
    <span class="hljs-type">string</span> <span class="hljs-variable">mailing_address</span> <span class="hljs-operator">=</span> <span class="hljs-number">4</span>; 
  }
  repeated <span class="hljs-type">NetworkedParcelOwner</span> <span class="hljs-variable">owners</span> <span class="hljs-operator">=</span> <span class="hljs-number">8</span>;

  <span class="hljs-comment">//////////////////////////////////////</span>
  <span class="hljs-comment">// fields about network connections:</span>
  <span class="hljs-comment">//////////////////////////////////////</span>

  <span class="hljs-comment">// contains metadata about networks which this parcel may belong to.</span>
  <span class="hljs-comment">// keys are network_id&#x27;s, as they appear in BusinessNetworkIdentifier msg&#x27;s.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// values are a list of strings representing mailing addresses which may</span>
  <span class="hljs-comment">// identify a business in this network.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// !!! This is *NOT* an exhaustive list of addresses within the network. !!!</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// COMPATIBILITY <span class="hljs-doctag">NOTE:</span> in api 1.0 json representation, possible_networks is a</span>
  <span class="hljs-comment">// json multimap. multimaps are not suported natively in proto, so we define</span>
  <span class="hljs-comment">// a StringVector message to use as a replacement.</span>
  <span class="hljs-comment">// </span>
  <span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> until clients are migrated away from json multimap, will support</span>
  <span class="hljs-comment">// configuration flags to return json with original multimaps. see config</span>
  <span class="hljs-comment">// flags in /server/rest/routes/dbRouteSetup.js.</span>
  map&lt;string, StringVector&gt; possible_networks = <span class="hljs-number">9</span>;

  <span class="hljs-comment">// optional. when present, describes the provenance of the information in</span>
  <span class="hljs-comment">// possible_networks.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// &quot;NETWORK_EXACT&quot;: possible_networks contains a single network, identified</span>
  <span class="hljs-comment">//     by mailing address info from the parcel&#x27;s recorded owner.</span>
  <span class="hljs-comment">// &quot;NETWORK_NONEXACT&quot;: possible_networks contains one or more networks,</span>
  <span class="hljs-comment">//     considered &#x27;possible&#x27; matches based on indirect connections.</span>
  <span class="hljs-comment">// &quot;NON_NETWORK&quot;: no network_id found, map contains placeholder network</span>
  <span class="hljs-comment">//     with key &quot;NON_NETWORK&quot; and single mailing address copied from parcel</span>
  <span class="hljs-comment">//     owner records.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> deprecate and replace with an enum.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">connection_type</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemaslegacyprotorestrest.proto"><a href="#toc"><a name="server-schemas-legacy-proto-rest-rest-proto">server/schemas/legacy/proto/rest/rest.proto</a></a></h2>
<pre><code><span class="hljs-comment">// rest.proto</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// top-level description of ebook rest api. describes the rest routes (rpc&#x27;s),</span>
<span class="hljs-comment">// and their request/response formats.</span>
syntax = <span class="hljs-string">&quot;proto3&quot;</span>;

<span class="hljs-keyword">import</span> <span class="hljs-string">&quot;business.proto&quot;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">&quot;graph_util.proto&quot;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">&quot;parcel.proto&quot;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">&quot;eviction.proto&quot;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">&quot;network.proto&quot;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">&quot;user_feedback_report.proto&quot;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">&quot;util.proto&quot;</span>;

<span class="hljs-keyword">package</span> rest;

<span class="hljs-comment">/////////////////////////////////////////</span>
<span class="hljs-comment">// Top-level REST service definition:</span>
<span class="hljs-comment">/////////////////////////////////////////</span>

service EvictorbookRestService {
  <span class="hljs-comment">// deprecated -- legacy endpoint, prefer more specific parcel calls below.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// rest api v1 route: &#x27;api/parcel/:block_lot&#x27;</span>
  rpc <span class="hljs-title function_">GetParcel</span><span class="hljs-params">(GetParcelRequest)</span> returns (GetParcelResponse);

  <span class="hljs-comment">// get details about a parcel from sf assessor records, keyed by block_lot.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// rest api v1 route: &#x27;api/parcel/:block_lot/details&#x27;</span>
  rpc <span class="hljs-title function_">GetParcelDetails</span><span class="hljs-params">(GetParcelDetailsRequest)</span> returns
    (GetParcelDetailsResponse);

  <span class="hljs-comment">// get details about evictions which occurred at a given parcel, keyed by</span>
  <span class="hljs-comment">// block_lot.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// rest api v1 route: &#x27;api/parcel/:block_lot/evictions&#x27;</span>
  rpc <span class="hljs-title function_">GetParcelEvictions</span><span class="hljs-params">(GetParcelEvictionsRequest)</span> returns
    (GetParcelEvictionsResponse);

  <span class="hljs-comment">// get info about real-estate business networks believed to have a stake in</span>
  <span class="hljs-comment">// this parcel, as well as other parcels which those networks may have a</span>
  <span class="hljs-comment">// vested interest in.</span>
  <span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> performance bottleneck, invoke with caution.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// rest api v1 route: &#x27;api/parcel/:block_lot/networks&#x27;</span>
  rpc <span class="hljs-title function_">GetParcelNetworks</span><span class="hljs-params">(GetParcelNetworksRequest)</span> returns
    (GetParcelNetworksResponse);

  <span class="hljs-comment">// get info about individuals, businesses, and/or trusts believed to own the</span>
  <span class="hljs-comment">// parcel in full or in part.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// rest api v1 route: &#x27;api/parcel/:block_lot/owners&#x27;</span>
  rpc <span class="hljs-title function_">GetParcelOwners</span><span class="hljs-params">(GetParcelOwnersRequest)</span> returns
    (GetParcelOwnersResponse);

  <span class="hljs-comment">// get info about a corporation, which may be part of a real-estate-owning</span>
  <span class="hljs-comment">// business network.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// rest api v1 route: &#x27;/api/corp/:name&#x27;</span>
  rpc <span class="hljs-title function_">GetCorp</span><span class="hljs-params">(GetCorpRequest)</span> returns (GetCorpResponse);

  <span class="hljs-comment">// get info about a limited partnership or llc, which may be part of a</span>
  <span class="hljs-comment">// real-estate-owning business network.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// rest api v1 route: &#x27;/api/lp/:name&#x27;</span>
  rpc <span class="hljs-title function_">GetLP</span><span class="hljs-params">(GetLPRequest)</span> returns (GetLPResponse);

  <span class="hljs-comment">// given a network_id and a parcel block_lot which is under that network&#x27;s</span>
  <span class="hljs-comment">// influence, return a view of the network centered around that parcel.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// rest api v1 route: &#x27;/api/network/parcel/:network_id/:search_string&#x27;</span>
  rpc <span class="hljs-title function_">GetNetworkParcel</span><span class="hljs-params">(GetNetworkParcelRequest)</span> returns
    (GetNetworkParcelResponse);

  <span class="hljs-comment">// given a business entity which belongs to a network, return a local view of</span>
  <span class="hljs-comment">// the network centered around that business.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// rest api v1 route: &#x27;/api/network/:input_type/:search_string&#x27;</span>
  rpc <span class="hljs-title function_">GetNetworkBusinessEntity</span><span class="hljs-params">(GetNetworkBusinessEntityRequest)</span> returns
    (GetNetworkBusinessEntityResponse);

  <span class="hljs-comment">// given the name of a neighborhood in san francisco, return eviction </span>
  <span class="hljs-comment">// records from the eb datastore which occurred in that neighborhood.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// rest api v1 route: &#x27;/api/neighborhood/:neighborhood&#x27;</span>
  <span class="hljs-comment">//                and &#x27;/api/neighborhood/:neighborhood/:page&#x27;</span>
  rpc <span class="hljs-title function_">GetEvictionsByNeighborhood</span><span class="hljs-params">(GetEvictionsByNeighborhoodRequest)</span> returns
    (GetEvictionsByNeighborhoodResponse);

  <span class="hljs-comment">// used for search feature on front page. performs prefix-based lookup on sf</span>
  <span class="hljs-comment">// assessor parcel records on lot-level address strings.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// rest api v1 route: &#x27;/api/parcel-search/:search&#x27;</span>
  rpc <span class="hljs-title function_">ParcelSearch</span><span class="hljs-params">(ParcelSearchRequest)</span> returns (ParcelSearchResponse);

  <span class="hljs-comment">// used for search feature on front page. performs prefix-based index lookup</span>
  <span class="hljs-comment">// on business entities (both &#x27;corp&#x27; and &#x27;lp&#x27;) by normalized name.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// rest api v1 route: &#x27;/api/be-search/:search&#x27;</span>
  rpc <span class="hljs-title function_">BusinessEntitySearch</span><span class="hljs-params">(BusinessEntitySearchRequest)</span> returns
   (BusinessEntitySearchResponse);
}

<span class="hljs-comment">//////////////////////////</span>
<span class="hljs-comment">//  Context messages</span>
<span class="hljs-comment">//////////////////////////</span>

<span class="hljs-comment">// placeholder for info about the incoming request (session id, request_id,</span>
<span class="hljs-comment">// permissions, etc.)</span>
message RequestContext {
  <span class="hljs-comment">// todo: populate with relevant fields.</span>
}

<span class="hljs-comment">//////////////////////////////////</span>
<span class="hljs-comment">//  Request/response messages</span>
<span class="hljs-comment">//////////////////////////////////</span>

<span class="hljs-comment">////////////////////////</span>
<span class="hljs-comment">//  GetCorp messages</span>
<span class="hljs-comment">////////////////////////</span>

message GetCorpRequest {
  <span class="hljs-comment">// request context, see above.</span>
  <span class="hljs-type">RequestContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

  <span class="hljs-comment">// name of a corporation to look up, as it appears in the California</span>
  <span class="hljs-comment">// Secretary of State business registry.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// todo: describe constraints on normalization, etc.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;
}

message GetCorpResponse {
  <span class="hljs-comment">// details about this business. </span>
  <span class="hljs-comment">//  </span>
  <span class="hljs-comment">// note: compared to equivalent query proto, several string fields are</span>
  <span class="hljs-comment">// remapped short keys to human-readable friendly labels: corporation_status,</span>
  <span class="hljs-comment">// corporation_type, corporation_tax_base, ftb_suspension_status,</span>
  <span class="hljs-comment">// corporation_classification.</span>
  <span class="hljs-type">CorporationDetails</span> <span class="hljs-variable">be_details</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; 

  <span class="hljs-comment">// brief descriptions of the parcels believed to be owned by this business,</span>
  <span class="hljs-comment">// in whole or in part.</span>
  repeated <span class="hljs-type">ParcelBriefOwnershipInfo</span> <span class="hljs-variable">parcels_owned</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;

  <span class="hljs-comment">// info about evictions we attribute to this business entity.</span>
  repeated <span class="hljs-type">EvictionMetadata</span> <span class="hljs-variable">evictions</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;

  <span class="hljs-comment">// despite the name, this is a list of *parcels*, which may be owned by the</span>
  <span class="hljs-comment">// network associated with this business.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// COMPATIBILITY <span class="hljs-doctag">NOTE:</span> contains a multimap field, which requires some</span>
  <span class="hljs-comment">// additional conversion to move from proto-compatibile to existing rest json</span>
  <span class="hljs-comment">// response. see NetworkParcelSummary.possible_networks for details.</span>
  repeated <span class="hljs-type">NetworkedParcelSummary</span> <span class="hljs-variable">networks</span> <span class="hljs-operator">=</span> <span class="hljs-number">4</span>;
}

<span class="hljs-comment">//////////////////////</span>
<span class="hljs-comment">//  GetLP messages</span>
<span class="hljs-comment">//////////////////////</span>

message GetLPRequest {
  <span class="hljs-comment">// request context, see above.</span>
  <span class="hljs-type">RequestContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

  <span class="hljs-comment">// name of a limited partnership or llc to look up, as it appears in the</span>
  <span class="hljs-comment">// California Secretary of State business registry.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// todo: describe constraints on normalization, etc.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;
}

message GetLPResponse {
  <span class="hljs-comment">// details about this business. </span>
  <span class="hljs-comment">//  </span>
  <span class="hljs-comment">// note: compared to equivalent query proto, several string fields are</span>
  <span class="hljs-comment">// remapped short keys to human-readable friendly labels: status, filing</span>
  <span class="hljs-comment">// type, llc_management_code.</span>
  <span class="hljs-type">LimitedBusinessDetails</span> <span class="hljs-variable">be_details</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

  <span class="hljs-comment">// brief descriptions of the parcels believed to be owned by this business,</span>
  <span class="hljs-comment">// in whole or in part.</span>
  repeated <span class="hljs-type">ParcelBriefOwnershipInfo</span> <span class="hljs-variable">parcels_owned</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;

  <span class="hljs-comment">// info about evictions we attribute to this business entity.</span>
  repeated <span class="hljs-type">EvictionMetadata</span> <span class="hljs-variable">evictions</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;

  <span class="hljs-comment">// despite the name, this is a list of *parcels*, which may be owned by the</span>
  <span class="hljs-comment">// network associated with this business.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// COMPATIBILITY <span class="hljs-doctag">NOTE:</span> contains a multimap field, which requires some</span>
  <span class="hljs-comment">// additional conversion to move from proto-compatibile to existing rest json</span>
  <span class="hljs-comment">// response. see NetworkParcelSummary.possible_networks for details.</span>
  repeated <span class="hljs-type">NetworkedParcelSummary</span> <span class="hljs-variable">networks</span> <span class="hljs-operator">=</span> <span class="hljs-number">4</span>;
}

<span class="hljs-comment">////////////////////////////////////////</span>
<span class="hljs-comment">//  GetNetworkBusinessEntity messages</span>
<span class="hljs-comment">////////////////////////////////////////</span>

message GetNetworkBusinessEntityRequest {
  <span class="hljs-comment">// request context, see above.</span>
  <span class="hljs-type">RequestContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

  <span class="hljs-comment">// &quot;corp&quot; or &quot;lp&quot;, depending on whether the business to query is a</span>
  <span class="hljs-comment">// corporation or a limited-partnership/llc.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">input_type</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;

  <span class="hljs-comment">// normalized name of a business, derived from the name found in california</span>
  <span class="hljs-comment">// sec. of state business records.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">search_string</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;
}

message GetNetworkBusinessEntityResponse {
  <span class="hljs-comment">// normalized name of the business, matching be_name parameter from input.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">name_norm</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

  <span class="hljs-comment">// list of graph relations (edges) which make up a connected subgraph of the</span>
  <span class="hljs-comment">// ebook graph, representing the business network and its elements.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// each item here contains full descriptions of the relation&#x27;s source and</span>
  <span class="hljs-comment">// destination node, so the caller can reconstruct the subgraph.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// COMPATIBILITY <span class="hljs-doctag">NOTE:</span> this proto message differs slightly from neo4j driver</span>
  <span class="hljs-comment">// object schemas, so some conversion is required. see comments on</span>
  <span class="hljs-comment">// GraphRelation definition.</span>
  repeated <span class="hljs-type">GraphRelation</span> <span class="hljs-variable">network_subgraph</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;
  
  <span class="hljs-comment">// total count of business entities which appear in this network (including</span>
  <span class="hljs-comment">// both corporations and limited-partnerships/llc&#x27;s).</span>
  <span class="hljs-type">int32</span> <span class="hljs-variable">total_bes</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;

  <span class="hljs-comment">// normalized names of most-connected business in the network.</span>
  <span class="hljs-comment">// (SOS_Corp or SOS_LP nodes with highest degree).</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// optional field __typename is set, so caller can disambiguate between</span>
  <span class="hljs-comment">// business types. returns 5 entries as of 2021/03/12.</span>
  repeated <span class="hljs-type">NormalizedName</span> <span class="hljs-variable">top_bes</span> <span class="hljs-operator">=</span> <span class="hljs-number">4</span>;

  <span class="hljs-comment">// normalized names of owners-of-businesses most connected in the graph.</span>
  <span class="hljs-comment">// (SOS_Owner nodes with matching network_id, with highest degree).</span>
  <span class="hljs-comment">// optional field __typename is NOT set.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// note: these owners can be individuals, or other businesses.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// returns 5 entries as of 2021/03/12.</span>
  <span class="hljs-comment">// see SOS_Owner node / CalSOSOwnerData in graph/nodes.proto.</span>
  repeated <span class="hljs-type">NormalizedName</span> <span class="hljs-variable">top_owners</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;

  <span class="hljs-comment">// readable addresses which are the most well-connected in the graph.</span>
  <span class="hljs-comment">// (Address_Unit nodes with matching network_id with highest degree).</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> describe what causes these addresses to be considered for inclusion.</span>
  <span class="hljs-comment">// clarify if they&#x27;re physical addresses of component businesses/owners of</span>
  <span class="hljs-comment">// the network, or real-estate properties held by the network.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// returns 5 entries as of 2021/03/12.</span>
  <span class="hljs-comment">// see Address_Unit node / AddressUnitData in graph/nodes.proto.</span>
  repeated <span class="hljs-type">ReadableAddress</span> <span class="hljs-variable">top_addrs</span> <span class="hljs-operator">=</span> <span class="hljs-number">6</span>;
}

<span class="hljs-comment">/////////////////////////////////</span>
<span class="hljs-comment">//  GetNetworkParcel messages</span>
<span class="hljs-comment">/////////////////////////////////</span>

message GetNetworkParcelRequest {
  <span class="hljs-comment">// request context, see above.</span>
  <span class="hljs-type">RequestContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

  <span class="hljs-comment">// the network_id of the business network we want to retreieve. See</span>
  <span class="hljs-comment">// BusinessNetworkIdentifier for semantics. required.</span>
  <span class="hljs-type">int64</span> <span class="hljs-variable">network_id</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;

  <span class="hljs-comment">// the block_lot (unique key) of a parcel which is associated with this</span>
  <span class="hljs-comment">// network.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">search_string</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;
}

message GetNetworkParcelResponse {
  <span class="hljs-comment">// string representing the parcel&#x27;s street address, including street number,</span>
  <span class="hljs-comment">// street name and suffix, and unit number. The parcel is assumed to be</span>
  <span class="hljs-comment">// within SF city/county limits.</span>
  <span class="hljs-comment">// </span>
  <span class="hljs-comment">// See &#x27;addr&#x27; in A_Parcel node as described by SFAssessorParcelData in</span>
  <span class="hljs-comment">// graph/nodes.proto.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">addr</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

  <span class="hljs-comment">// list of graph relations (edges) which make up a connected subgraph of the</span>
  <span class="hljs-comment">// ebook graph, representing the business network and its elements.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// each item here contains full descriptions of the relation&#x27;s source and</span>
  <span class="hljs-comment">// destination node, so the caller can reconstruct the subgraph.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// COMPATIBILITY <span class="hljs-doctag">NOTE:</span> this proto message differs slightly from neo4j driver</span>
  <span class="hljs-comment">// object schemas, so some conversion is required. see comments on</span>
  <span class="hljs-comment">// GraphRelation definition.</span>
  repeated <span class="hljs-type">GraphRelation</span> <span class="hljs-variable">network_subgraph</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;

  <span class="hljs-comment">// total count of business entities which appear in this network (including</span>
  <span class="hljs-comment">// both corporations and limited-partnerships/llc&#x27;s).</span>
  <span class="hljs-type">int32</span> <span class="hljs-variable">total_bes</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;

  <span class="hljs-comment">// see GetNetworkBusinessEntityResponse above.</span>
  repeated <span class="hljs-type">NormalizedName</span> <span class="hljs-variable">top_bes</span> <span class="hljs-operator">=</span> <span class="hljs-number">4</span>;

  <span class="hljs-comment">// see GetNetworkBusinessEntityResponse above.</span>
  repeated <span class="hljs-type">NormalizedName</span> <span class="hljs-variable">top_owners</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;

  <span class="hljs-comment">// see GetNetworkBusinessEntityResponse above.</span>
  repeated <span class="hljs-type">ReadableAddress</span> <span class="hljs-variable">top_addrs</span> <span class="hljs-operator">=</span> <span class="hljs-number">6</span>;
}

<span class="hljs-comment">/////////////////////////////////////////</span>
<span class="hljs-comment">//  GetEvictionsByNeighborhood messages</span>
<span class="hljs-comment">/////////////////////////////////////////</span>

message GetEvictionsByNeighborhoodRequest {
  <span class="hljs-comment">// request context, see above.</span>
  <span class="hljs-type">RequestContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

  <span class="hljs-comment">// name of a neighborhood in sf. geographical filter for eviction records.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// names should correspond to the neighborhood polygons described at:</span>
  <span class="hljs-comment">// https://data.sfgov.org/Geographic-Locations-and-Boundaries/SF-Find-Neighborhoods/pty2-tcw4</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">neighborhood</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;

  <span class="hljs-comment">// pagination.</span>
  <span class="hljs-comment">// if page is set &gt; 0, rpc returns the &lt;page&gt;th page of &lt;size&gt; results.</span>
  <span class="hljs-comment">// if page is unset or set &lt;= 0, rpc returns the first page.</span>
  <span class="hljs-type">int32</span> <span class="hljs-variable">page</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;

  <span class="hljs-comment">// pagination.</span>
  <span class="hljs-comment">// the number of results to store on a single page. defaults to 100. </span>
  <span class="hljs-comment">// if unset or set &lt;= 0, rpc uses the default page size.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// in production, size cannot be increased beyond the default. for</span>
  <span class="hljs-comment">// development, larger page sizes may be enabled with debug flags.</span>
  <span class="hljs-comment">// </span>
  <span class="hljs-comment">// todo: establish a continuation token or some other signal for the caller</span>
  <span class="hljs-comment">// to know if there are more results beyond the current page.</span>
  <span class="hljs-type">int32</span> <span class="hljs-variable">size</span> <span class="hljs-operator">=</span> <span class="hljs-number">4</span>;
}

message GetEvictionsByNeighborhoodResponse {
  <span class="hljs-comment">// info about evictions in the ebook datastore which occurred within the</span>
  <span class="hljs-comment">// requested neighborhood&#x27;s boundaries.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// NOTE FOR COMPATIBLITY: rest api v1 response json represents a list of</span>
  <span class="hljs-comment">// evicton objects directly, rather than an object with a list property. in</span>
  <span class="hljs-comment">// order to achieve compatibility with rest api v1 wire protocol, extract and</span>
  <span class="hljs-comment">// JSON.stringify this list. </span>
  repeated <span class="hljs-type">EvictionMetadata</span> <span class="hljs-variable">evictions</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
}

<span class="hljs-comment">//////////////////////////////////////////////////////////</span>
<span class="hljs-comment">//  GetParcel messages</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">//   deprecated, prefer limited-scope requests below.</span>
<span class="hljs-comment">//////////////////////////////////////////////////////////</span>

message GetParcelRequest {
  <span class="hljs-comment">// request context, see above.</span>
  <span class="hljs-type">RequestContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

  <span class="hljs-comment">// block lot identifier of a parcel, as is appears in sf assessor records.</span>
  <span class="hljs-comment">// exact string match only.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">block_lot</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;
}

message GetParcelResponse {
  <span class="hljs-comment">// detailed info about the parcel (location, physical properties, etc.).</span>
  <span class="hljs-type">ParcelDetails</span> <span class="hljs-variable">parcel_details</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

  <span class="hljs-comment">// individuals, businesses, trusts, etc., which are believed to own the</span>
  <span class="hljs-comment">// parcel in full or in part.</span>
  repeated <span class="hljs-type">ParcelOwner</span> <span class="hljs-variable">owners</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;

  <span class="hljs-comment">// info about evictions believed to have occurred on the propert(y/ies) on</span>
  <span class="hljs-comment">// this parcel.</span>
  repeated <span class="hljs-type">EvictionMetadata</span> <span class="hljs-variable">evictions</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;

  <span class="hljs-comment">// info about real-estate business networks which may have a financial</span>
  <span class="hljs-comment">// interest in this parcel.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// keys: network_id&#x27;s, as they appear in BusinessNetworkIdentifier messages.</span>
  map&lt;string, NetworkSummary&gt; networks = <span class="hljs-number">4</span>;
}

<span class="hljs-comment">/////////////////////////////////</span>
<span class="hljs-comment">//  GetParcelDetails messages</span>
<span class="hljs-comment">/////////////////////////////////</span>

message GetParcelDetailsRequest {
  <span class="hljs-comment">// request context, see above.</span>
  <span class="hljs-type">RequestContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

  <span class="hljs-comment">// block lot identifier of a parcel, as is appears in sf assessor records.</span>
  <span class="hljs-comment">// exact string match only.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">block_lot</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;
}

message GetParcelDetailsResponse {
  <span class="hljs-comment">// detailed info about the parcel with the requested block_lot (location,</span>
  <span class="hljs-comment">// physical properties, etc.).</span>
  <span class="hljs-type">ParcelDetails</span> <span class="hljs-variable">parcel_details</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
}

<span class="hljs-comment">////////////////////////////////////</span>
<span class="hljs-comment">//  GetParcelEvictions messages</span>
<span class="hljs-comment">////////////////////////////////////</span>

message GetParcelEvictionsRequest {
  <span class="hljs-comment">// request context, see above.</span>
  <span class="hljs-type">RequestContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

  <span class="hljs-comment">// block lot identifier of a parcel, as is appears in sf assessor records.</span>
  <span class="hljs-comment">// exact string match only.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">block_lot</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;
}

message GetParcelEvictionsResponse {
  <span class="hljs-comment">// info about evictions believed to have occurred on the propert(y/ies) on</span>
  <span class="hljs-comment">// the parcel with the requested block_lot.</span>
  repeated <span class="hljs-type">EvictionMetadata</span> <span class="hljs-variable">evictions</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
}

<span class="hljs-comment">//////////////////////////////////</span>
<span class="hljs-comment">//  GetParcelNetworks messages</span>
<span class="hljs-comment">//////////////////////////////////</span>

message GetParcelNetworksRequest {
  <span class="hljs-comment">// request context, see above.</span>
  <span class="hljs-type">RequestContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

  <span class="hljs-comment">// block lot identifier of a parcel, as is appears in sf assessor records.</span>
  <span class="hljs-comment">// exact string match only.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">block_lot</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;
}

message GetParcelNetworksResponse {
  <span class="hljs-comment">// info about real-estate business networks which may have a financial</span>
  <span class="hljs-comment">// interest in this parcel.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// keys: network_id&#x27;s, as they appear in BusinessNetworkIdentifier messages.</span>
  map&lt;string, NetworkSummary&gt; networks = <span class="hljs-number">1</span>;
}

<span class="hljs-comment">///////////////////////////////</span>
<span class="hljs-comment">// GetParcelOwners messages</span>
<span class="hljs-comment">///////////////////////////////</span>

message GetParcelOwnersRequest {
  <span class="hljs-comment">// request context, see above.</span>
  <span class="hljs-type">RequestContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

  <span class="hljs-comment">// block lot identifier of a parcel, as is appears in sf assessor records.</span>
  <span class="hljs-comment">// exact string match only.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">block_lot</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;
}

message GetParcelOwnersResponse {
  <span class="hljs-comment">// individuals, businesses, trusts, etc., which are believed to own the</span>
  <span class="hljs-comment">// requested parcel in full or in part.</span>
  repeated <span class="hljs-type">ParcelOwner</span> <span class="hljs-variable">owners</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

  <span class="hljs-comment">// intended to represent the total number of parcels beleived to be owned, by</span>
  <span class="hljs-comment">// all the full and part owners of the queried parcel.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// added in late 2020, not a part of the original may 2020 api.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Verify that this is useful, and that it means what we think it does.</span>
  <span class="hljs-type">int32</span> <span class="hljs-variable">parcels</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;
}

<span class="hljs-comment">/////////////////////////////</span>
<span class="hljs-comment">//  ParcelSearch messages</span>
<span class="hljs-comment">/////////////////////////////</span>

message ParcelSearchRequest {
  <span class="hljs-comment">// request context, see above.</span>
  <span class="hljs-type">RequestContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

  <span class="hljs-comment">// query string, to be interpreted as an address prefix.</span>
  <span class="hljs-comment">// todo: describe constraints, normalization, etc.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">search</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;
}

message ParcelSearchResponse {
  <span class="hljs-comment">// the block_lot of this parcel in sf assessor records. unique key in ebook</span>
  <span class="hljs-comment">// rest api.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">block_lot</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

  <span class="hljs-comment">// human-readable address of the real-estate parcel in sf assessor records.</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> describe normalization, etc.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">addr</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;
}

<span class="hljs-comment">////////////////////////////////////</span>
<span class="hljs-comment">//  BusinessEntitySearch messages</span>
<span class="hljs-comment">////////////////////////////////////</span>

message BusinessEntitySearchRequest {
  <span class="hljs-comment">// request context, see above.</span>
  <span class="hljs-type">RequestContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

  <span class="hljs-comment">// query string, to be interpreted as a business-entity name prefix.</span>
  <span class="hljs-comment">// todo: describe constraints, normalization, etc.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">search</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;
}

message BusinessEntitySearchResponse {
  <span class="hljs-comment">// represents the type of business entity, but only in an obscure way.</span>
  <span class="hljs-comment">// context: it&#x27;s the node-type of the business&#x27;s record in the eb database.</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> deprecate and replace with enum.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">//  values:</span>
  <span class="hljs-comment">//   &quot;SOS_Corp&quot; if the business is a corporation.</span>
  <span class="hljs-comment">//   &quot;SOS_LP&quot; if the business is a limited partnership or llc.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">__typename</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

  <span class="hljs-comment">// canonical name of the business entity, as it appears in the</span>
  <span class="hljs-comment">// california secretary of state business registry.</span>
  <span class="hljs-type">string</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;
}

</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemaslegacyprotorestuser_feedback_report.proto"><a href="#toc"><a name="server-schemas-legacy-proto-rest-user_feedback_report-proto">server/schemas/legacy/proto/rest/user_feedback_report.proto</a></a></h2>
<pre><code><span class="hljs-comment">// user_feedback_report.proto</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Describes the payload of the user feedback form which is accessible at the</span>
<span class="hljs-comment">// bottom of all pages on the ebook site.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// As of 2021/03/15, the form on the website is backed by a google form; this</span>
<span class="hljs-comment">// proto descibes both the user-submitted content (the actual feedback) and the</span>
<span class="hljs-comment">// relevant metadata (timestamp, author-supplied email, source page, etc.).</span>
syntax = <span class="hljs-string">&quot;proto3&quot;</span>;

<span class="hljs-keyword">package</span> rest;

<span class="hljs-comment">// Description from project proposal:</span>
<span class="hljs-comment">// At the bottom of each page of Evictorbook, a user will have an option to</span>
<span class="hljs-comment">// give feedback.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// First they can choose between the three buttons: &quot;I like this,&quot; &quot;I don&#x27;t</span>
<span class="hljs-comment">// like this,&quot; and, &quot;I want to report a bug.&quot;</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Once a button is pressed, a short comment form appears, where the user can</span>
<span class="hljs-comment">// optionally add a comment, optionally enter their email address, and</span>
<span class="hljs-comment">// optionally check a box that says, &quot;You may contact me about this feedback.&quot;</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">UserFeedbackReport</span> </span>{
  <span class="hljs-comment">// 64 bit integer key to be used as a unique primary key in a db.</span>
  <span class="hljs-built_in">int64</span> report_id = <span class="hljs-number">1</span>;

  <span class="hljs-comment">// the url the user is commenting from, auto-generated by React (the text is</span>
  <span class="hljs-comment">// pulled straight from the address bar of the page they&#x27;re filling out the</span>
  <span class="hljs-comment">// form on).</span>
  <span class="hljs-built_in">string</span> page_id = <span class="hljs-number">2</span>;

  <span class="hljs-comment">// Time and date when comment was submitted.</span>
  <span class="hljs-comment">// Generated by React client and sent to server</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> units. clarify: is this a unix-epoch timestamp?</span>
  <span class="hljs-built_in">int64</span> time_stamp = <span class="hljs-number">3</span>; 

  <span class="hljs-comment">// What type of message the author of the feedback intends to convey. The</span>
  <span class="hljs-comment">// feedback author will select from among these types, which can be expressed</span>
  <span class="hljs-comment">// in a UI element on the page (graphical buttons, drop-down menu, etc.). </span>
  <span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">FeedbackCategory</span> </span>{
    FEEDBACK_CATEGORY_UNSPECIFIED = <span class="hljs-number">0</span>;
    FEEDBACK_LIKE = <span class="hljs-number">1</span>;
    FEEDBACK_DISLIKE = <span class="hljs-number">2</span>;
    FEEDBACK_BUG_REPORT = <span class="hljs-number">3</span>;
  } 

  <span class="hljs-comment">// The feedback category which was selected by the submitter.</span>
  <span class="hljs-comment">// Must be set to a value other than UNSPECIFIED, otherwise this will be</span>
  <span class="hljs-comment">// rejected by the server.</span>
  FeedbackCategory feedback_category = <span class="hljs-number">4</span>;

  <span class="hljs-comment">// The actual feedback text, from a textarea on the website, as typed by the</span>
  <span class="hljs-comment">// user.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Specify whether any safety checking has been done to confirm that</span>
  <span class="hljs-comment">// there are no attempted injection attacks contained in the body of this</span>
  <span class="hljs-comment">// string.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Specify whether this string has been encoded with URL encoding or</span>
  <span class="hljs-comment">// other encoding mechanisms.</span>
  <span class="hljs-built_in">string</span> feedback_text = <span class="hljs-number">5</span>;

  <span class="hljs-comment">// The user&#x27;s email, as supplied by the user on the form </span>
  <span class="hljs-comment">// The browser checks that it contains an @ symbol; no other data validation</span>
  <span class="hljs-comment">// performed</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// !!! <span class="hljs-doctag">NOTE:</span> Personally identifiable information! Handle with care, and don&#x27;t</span>
  <span class="hljs-comment">// store the contents of this field without a clear data retenion plan. !!!</span>
  <span class="hljs-built_in">string</span> email = <span class="hljs-number">6</span>;

  <span class="hljs-comment">// Describes whether the feedback submitter gives their consent to be</span>
  <span class="hljs-comment">// contacted with future updates. </span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// This should be interpreted in the context of the field where it appears.</span>
  <span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">ContactPermission</span> </span>{
    CONTACT_PERMISSION_UNSPECIFIED = <span class="hljs-number">0</span>;
    PERMISSION_GRANTED = <span class="hljs-number">1</span>;
    PERMISSION_DENIED = <span class="hljs-number">2</span>;
  }

  <span class="hljs-comment">// Result of a yes/no checkbox, asking if user gives permission to be</span>
  <span class="hljs-comment">// contacted about their feedback.</span>
  ContactPermission contact_permission = <span class="hljs-number">7</span>;
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemaslegacyprotorestutil.proto"><a href="#toc"><a name="server-schemas-legacy-proto-rest-util-proto">server/schemas/legacy/proto/rest/util.proto</a></a></h2>
<pre><code><span class="hljs-comment">// rest/util.proto</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// reusable helper messages for ebook rest api.</span>

syntax = <span class="hljs-string">&quot;proto3&quot;</span>;

<span class="hljs-keyword">package</span> rest;

<span class="hljs-comment">// a simple wrapper around repeated strings.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// this is useful because doesn&#x27;t natively support multimaps (maps of lists).</span>
<span class="hljs-comment">// to accomodate, we instead create a map where values are StringVector</span>
<span class="hljs-comment">// messages.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// if you need a multimap of a different type, create another Vector message in this</span>
<span class="hljs-comment">// file.</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">StringVector</span> </span>{
  <span class="hljs-comment">// string values contained in this vector.</span>
  <span class="hljs-keyword">repeated</span> <span class="hljs-built_in">string</span> value = <span class="hljs-number">1</span>;
}

<span class="hljs-comment">// convience wrapper for normalized names.</span>
<span class="hljs-comment">// semantically neutral, used in a variety of contexts.</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">NormalizedName</span> </span>{
  <span class="hljs-comment">// a normalized name, as it appears in the graph.</span>
  <span class="hljs-built_in">string</span> name_norm = <span class="hljs-number">1</span>;

  <span class="hljs-comment">// optional. node type of the graph node where this name_norm was found.</span>
  <span class="hljs-comment">// typically set for names of business entities, where there is a need to</span>
  <span class="hljs-comment">// differentiate between SOS_Corp and SOS_LP.</span>
  <span class="hljs-built_in">string</span> __typename = <span class="hljs-number">2</span>;
}

<span class="hljs-comment">// convenience wrapper for human-readable addresses.</span>
<span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> describe normalization, etc.</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">ReadableAddress</span> </span>{
  <span class="hljs-comment">// readable/friendly representation of an address. normalization and internal</span>
  <span class="hljs-comment">// structure may vary based on where this; check the containing message for</span>
  <span class="hljs-comment">// details.</span>
  <span class="hljs-built_in">string</span> addr_readable = <span class="hljs-number">1</span>;
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemaslegacyprotosearchsearch.proto"><a href="#toc"><a name="server-schemas-legacy-proto-search-search-proto">server/schemas/legacy/proto/search/search.proto</a></a></h2>
<pre><code><span class="hljs-comment">// search.proto</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// descriptions of rest requests and responses used for unified search api.</span>
<span class="hljs-comment">// for legacy handlers (/api/parcel-search and /api/be-search), see</span>
<span class="hljs-comment">// ../rest/rest.proto .</span>
syntax = <span class="hljs-string">&quot;proto3&quot;</span>;

<span class="hljs-keyword">package</span> search;

<span class="hljs-comment">// Work-in-progress definition for Unified Search api, as first expressed in frontend</span>
<span class="hljs-comment">// meeting notes here:</span>
<span class="hljs-comment">// https://docs.google.com/document/d/1EC6UQh9QaZ91rJDzPD3dwK7Sx6njpGEeqk_xDpFxnjs/edit#bookmark=id.bz8kuxmzfftm</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Implementation can be found at server/serviceHandlers/ebookSearchService</span>

<span class="hljs-comment">////////////////////////</span>
<span class="hljs-comment">// Service definition</span>
<span class="hljs-comment">////////////////////////</span>

<span class="hljs-comment">// proto expression of rest interface.</span>
<span class="hljs-class"><span class="hljs-keyword">service</span> <span class="hljs-title">EbookSearchService</span> </span>{
  <span class="hljs-comment">// rest api route: GET &#x27;/api/search?q=&lt;query&gt;&#x27;</span>
  <span class="hljs-comment">//   where &lt;query&gt; is a url-safe search string.</span>
  <span class="hljs-function"><span class="hljs-keyword">rpc</span> Search(SearchRequest) <span class="hljs-keyword">returns</span> (SearchResponse)</span>;
}


<span class="hljs-comment">//////////////////////////////////////</span>
<span class="hljs-comment">// Search Request/Response protos:</span>
<span class="hljs-comment">//////////////////////////////////////</span>

<span class="hljs-comment">// since search is a GET request, there&#x27;s no request body.</span>

<span class="hljs-comment">// instead this represents the info in an incoming GET request, serving as a</span>
<span class="hljs-comment">// conceptual model and also an object schema to load params into.</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">SearchRequest</span> </span>{
  <span class="hljs-comment">// the text of the query string we want to run a general-purpose search for.</span>
  <span class="hljs-comment">//   populated from the queryparam &#x27;q&#x27;, as in &#x27;/api/search?q=URBAN%20ORANGE&#x27;</span>
  <span class="hljs-built_in">string</span> query_string = <span class="hljs-number">1</span>;

  <span class="hljs-comment">// determines which neo4j database server to use, if the server supports it.</span>
  <span class="hljs-comment">//  &quot;v1&quot; or &quot;v2&quot;. If unset/empty string, assume &quot;v1.&quot;</span>
  <span class="hljs-built_in">string</span> database_version = <span class="hljs-number">2</span>;

  <span class="hljs-comment">// todo: add some params for sidechannels such as headers, and request</span>
  <span class="hljs-comment">// metadata (source ip, session id, etc.)</span>
}

<span class="hljs-comment">// representation of /api/search response json.</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">SearchResponse</span> </span>{
  <span class="hljs-comment">// a list of search results.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// callers should assume the results are returned in relevance order.</span>
  <span class="hljs-keyword">repeated</span> SearchResult results = <span class="hljs-number">1</span>;
}

<span class="hljs-comment">// an individual search result item, and accompanying metadata.</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">SearchResult</span> </span>{
  <span class="hljs-comment">// main label for this search result. ex: name of company, address, etc.</span>
  <span class="hljs-comment">// obj with localizable strings, see below.</span>
  <span class="hljs-built_in">string</span> label = <span class="hljs-number">1</span>;

  <span class="hljs-comment">// optional. (may be unset or null in response json)</span>
  <span class="hljs-comment">// if populated, this contains a short description of the item, for optional</span>
  <span class="hljs-comment">// display if layout permits.</span>
  <span class="hljs-built_in">string</span> description = <span class="hljs-number">2</span>;

  <span class="hljs-comment">// url to link to. this is the public user-facing page (react route).</span>
  <span class="hljs-built_in">string</span> details_url = <span class="hljs-number">3</span>;

  <span class="hljs-comment">// url for rest api request, to retrieve structured data about this item.</span>
  <span class="hljs-built_in">string</span> api_url = <span class="hljs-number">4</span>;

  <span class="hljs-comment">// the type of entity this search result represents.</span>
  <span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">Category</span> </span>{
    CATEGORY_UNSPECIFIED = <span class="hljs-number">0</span>;
    PARCEL = <span class="hljs-number">1</span>;
    BUSINESS_ENTITY = <span class="hljs-number">2</span>;
    NEIGHBORHOOD_SUMMARY = <span class="hljs-number">3</span>;
  }
  <span class="hljs-comment">// Category category = 5;</span>

  <span class="hljs-comment">// <span class="hljs-doctag">HACK:</span> Use a string rather than enum value to work around int/string enum</span>
  <span class="hljs-comment">// weirdness in json representation. TODO Establish a cleaner way of doing</span>
  <span class="hljs-comment">// this.</span>
  <span class="hljs-comment">// Values: &quot;PARCEL&quot;, &quot;BUSINESS_ENTITY&quot;, &quot;NEIGHBORHOOD_SUMMARY&quot;. Required.  </span>
  <span class="hljs-built_in">string</span> category = <span class="hljs-number">5</span>;

  <span class="hljs-comment">// Human-readable display for category enum. Required.</span>
  <span class="hljs-comment">// ex: &quot;Address&quot;, &quot;Owner&quot;, &quot;Neighborhood&quot;.</span>
  <span class="hljs-built_in">string</span> category_label = <span class="hljs-number">10</span>;

  <span class="hljs-comment">// potential search payloads. type-safe/queryable from proto.</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> add more payload messages as we add new categories.</span>
  ParcelSearchPayload parcel_data = <span class="hljs-number">6</span>;
  BusinessSearchPayload business_data = <span class="hljs-number">7</span>;
  NeighborhoodSummaryPayload neighborhood_data = <span class="hljs-number">8</span>;

  <span class="hljs-comment">// Details about result scoring/ranking.</span>
  RankingInfo ranking_info = <span class="hljs-number">9</span>;
}

<span class="hljs-comment">// Details about result scoring/ranking.</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">RankingInfo</span> </span>{
  <span class="hljs-comment">// Raw score, as retrieved from the database index&#x27;s full text search.</span>
  <span class="hljs-built_in">double</span> raw_score = <span class="hljs-number">1</span>;
}

<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">ParcelSearchPayload</span> </span>{
  <span class="hljs-comment">// the block_lot of this parcel in sf assessor records. unique key in ebook</span>
  <span class="hljs-comment">// rest api.</span>
  <span class="hljs-built_in">string</span> block_lot = <span class="hljs-number">1</span>;

  <span class="hljs-comment">// value of block_lot, encoded to be uri-safe.</span>
  <span class="hljs-built_in">string</span> block_lot_safe = <span class="hljs-number">2</span>;

  <span class="hljs-comment">// the address of the parcel, exactly as it appears in ebook database.</span>
  <span class="hljs-comment">// (see node types: Address_Main and Address_Unit.)</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// IMPORTANT: this is not a human-readable address!</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// these strings may be missing critical information such as street suffix or</span>
  <span class="hljs-comment">// zip code, and they may have arbitrary leading and trailing spaces. they</span>
  <span class="hljs-comment">// are extracted directly from the database without cleanup.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// preserving the current behavior for now to avoid breaking existing code.</span>
  <span class="hljs-comment">// (changing undocumented behavior without warning is dangerous.)</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> migrate away from this.</span>
  <span class="hljs-built_in">string</span> addr = <span class="hljs-number">3</span>;

  <span class="hljs-comment">// value of addr, reformatted to be human-readable. title case, leading and</span>
  <span class="hljs-comment">// trailing spaces trimmed. all the warnings above about the content of the</span>
  <span class="hljs-comment">// address still apply (missing components, etc.)</span>
  <span class="hljs-built_in">string</span> display_addr = <span class="hljs-number">4</span>;

  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> expand. more metadata, etc.</span>
}

<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">BusinessSearchPayload</span> </span>{
  <span class="hljs-comment">// represents the type of business entity, but only in an obscure way.</span>
  <span class="hljs-comment">// context: it&#x27;s the node-type of the business&#x27;s record in the eb database.</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> deprecate and rely instead on enum.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">//  values:</span>
  <span class="hljs-comment">//   &quot;SOS_Corp&quot; if the business is a corporation.</span>
  <span class="hljs-comment">//   &quot;SOS_LP&quot; if the business is a limited partnership or llc.</span>
  <span class="hljs-built_in">string</span> db_node_type = <span class="hljs-number">1</span>;

  <span class="hljs-comment">// the business&#x27;s type, as represented in calif. sec of state business</span>
  <span class="hljs-comment">// registry.</span>
  <span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">BusinessType</span> </span>{
    BUSINESS_TYPE_UNSPECIFIED = <span class="hljs-number">0</span>;
    CALIF_SOS_CORP = <span class="hljs-number">1</span>;  <span class="hljs-comment">// corporation.</span>
    CALIF_SOS_LP = <span class="hljs-number">2</span>;    <span class="hljs-comment">// limited partnership or llc.</span>
  }
  <span class="hljs-comment">// BusinessType business_type = 2;</span>

  <span class="hljs-comment">// <span class="hljs-doctag">HACK:</span> Use a string rather than enum value to work around int/string enum</span>
  <span class="hljs-comment">// weirdness in json representation. TODO Establish a cleaner way of doing</span>
  <span class="hljs-comment">// this.</span>
  <span class="hljs-comment">// Values: &quot;CALIF_SOS_CORP&quot;, &quot;CALIF_SOS_LP&quot;. Required.</span>
  <span class="hljs-built_in">string</span> business_type = <span class="hljs-number">2</span>;

  <span class="hljs-comment">// literal value of the business entity&#x27;s canonical name in ebook db, where</span>
  <span class="hljs-comment">// it appears as &#x27;name_norm&#x27;.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// derived from the name as it appears in the california secretary of state</span>
  <span class="hljs-comment">// business registry.</span>
  <span class="hljs-built_in">string</span> canonical_name = <span class="hljs-number">3</span>;

  <span class="hljs-comment">// value of the business entity&#x27;s name in db, encoded as a url-safe string.</span>
  <span class="hljs-comment">// useful when generating uri&#x27;s for REST api calls.</span>
  <span class="hljs-built_in">string</span> canonical_name_safe = <span class="hljs-number">4</span>;

  <span class="hljs-comment">// human-friendly formatting of business&#x27;s name, as it appears in the</span>
  <span class="hljs-comment">// california secretary of state business registry.</span>
  <span class="hljs-built_in">string</span> display_name = <span class="hljs-number">5</span>;

  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> unique id. leaving this out for now because it&#x27;s not supported by</span>
  <span class="hljs-comment">// existing rest api.</span>
  <span class="hljs-comment">//   ex: string business_id = 6;</span>

  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> expand. more metadata, etc.</span>
}

<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">NeighborhoodSummaryPayload</span> </span>{
  <span class="hljs-comment">// non-url-safe version of canonical name, as expected in &#x27;/api/neighborhood&#x27;</span>
  <span class="hljs-comment">// requests. useful in server code, because express converts the url-safe</span>
  <span class="hljs-comment">// parameter back to an unsafe string.</span>
  <span class="hljs-built_in">string</span> canonical_name = <span class="hljs-number">1</span>;

  <span class="hljs-comment">// url-safe version of the neighborhood&#x27;s name expected in &#x27;/api/neighborhood&#x27;</span>
  <span class="hljs-comment">// requests. useful in client code for assembling REST uri&#x27;s.</span>
  <span class="hljs-built_in">string</span> canonical_name_safe = <span class="hljs-number">2</span>;

  <span class="hljs-comment">// human-friendly formatting of neighborhood name, suitable for display in a ui.</span>
  <span class="hljs-built_in">string</span> display_name = <span class="hljs-number">3</span>;

  <span class="hljs-comment">// integer id uniquely identifying neighborhood in ebook api.</span>
  <span class="hljs-built_in">int64</span> id = <span class="hljs-number">4</span>;
}

</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemassrcgraph_utilgraph_barbells.js"><a href="#toc"><a name="server-schemas-src-graph_util-graph_barbells-js">server/schemas/src/graph_util/graph_barbells.js</a></a></h2>
<pre><code>module.exports = {
  <span class="hljs-comment">&quot;$schema&quot;</span>: <span class="hljs-comment">&quot;http://json-schema.org/draft-07/schema#&quot;</span>,
  title: <span class="hljs-comment">&quot;graph_barbells&quot;</span>,
  description: <span class="hljs-comment">&quot;Representation of a subset of the evictorbook serving graph, so named because it consists of a list of &#x27;NODE--relation--NODE&#x27; triples. This is space-inefficient because nodes are represented multiple times (once for each connecting edge), but it&#x27;s convenient to retrieve via CYPHER query.&quot;</span>,
  type: <span class="hljs-comment">&quot;array&quot;</span>,
  items: require(<span class="hljs-comment">&quot;./graph_relation_barbell&quot;</span>)
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemassrcgraph_utilgraph_node.js"><a href="#toc"><a name="server-schemas-src-graph_util-graph_node-js">server/schemas/src/graph_util/graph_node.js</a></a></h2>
<pre><code><span class="hljs-keyword">module</span>.exports = {
  <span class="hljs-string">&quot;$schema&quot;</span>: <span class="hljs-string">&quot;http://json-schema.org/draft-07/schema#&quot;</span>,
  title: <span class="hljs-string">&quot;graph_node&quot;</span>,
  description: <span class="hljs-string">&quot;Description of a node in the ebook graph database. Directly modeled on the node representation returned by the neo4j-driver in graph queries.&quot;</span>,
  <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;object&quot;</span>,
  additionalProperties: <span class="hljs-literal">false</span>,
  properties: {
    <span class="hljs-comment">// The node&#x27;s internal id within the database. Subject to change between database dumps.</span>
    <span class="hljs-string">&quot;identity&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;integer&quot;</span> },

    <span class="hljs-comment">// Type labels assigned to this node in the ebook db, such as &quot;SOS_Corp&quot; or</span>
    <span class="hljs-comment">// &quot;A_Parcel&quot;. As of 05/2021, all nodes have a single type. See the graph</span>
    <span class="hljs-comment">// schema for details about node types.</span>
    <span class="hljs-string">&quot;labels&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;array&quot;</span>, items: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> } },

    <span class="hljs-comment">// Map of the key-value properties this node contains.</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> In addition to these primitives, neo4j also has support for</span>
    <span class="hljs-comment">// certain complex property types including the spatial type &#x27;Point&#x27; and</span>
    <span class="hljs-comment">// time/duration types such as &#x27;DateTime&#x27;. If we add those to the graph,</span>
    <span class="hljs-comment">// we&#x27;ll need to update the schema here to represent them.</span>
    <span class="hljs-string">&quot;properties&quot;</span>: { 
      <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;object&quot;</span>,
      additionalProperties: {
        anyOf: [
          { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;number&quot;</span> },
          { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;boolean&quot;</span> },
          { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> }
        ]
      }
    }
  }
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemassrcgraph_utilgraph_node_lite.js"><a href="#toc"><a name="server-schemas-src-graph_util-graph_node_lite-js">server/schemas/src/graph_util/graph_node_lite.js</a></a></h2>
<pre><code><span class="hljs-keyword">module</span>.exports = {
  <span class="hljs-string">&quot;$schema&quot;</span>: <span class="hljs-string">&quot;http://json-schema.org/draft-07/schema#&quot;</span>,
  title: <span class="hljs-string">&quot;graph_node_lite&quot;</span>,
  description: <span class="hljs-string">&quot;Alternate representation of a graph node. Does not contain the full property map, nor the internal graph id.&quot;</span>,
  <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;object&quot;</span>,
  additionalProperties: <span class="hljs-literal">false</span>,
  properties: {
    <span class="hljs-comment">// Identifying string retrieved from one of the node&#x27;s properties. For</span>
    <span class="hljs-comment">// business nodes, this is &#x27;name_norm&#x27;. For address nodes, it&#x27;s</span>
    <span class="hljs-comment">// &#x27;addr_readable&#x27;. <span class="hljs-doctag">TODO:</span> Document how and why these properties were</span>
    <span class="hljs-comment">// selected.</span>
    <span class="hljs-string">&quot;name&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// Number of other nodes this node is connected to in the ebook database.</span>
    <span class="hljs-comment">// This is the metric used to determine the &#x27;top&#x27; business entities,</span>
    <span class="hljs-comment">// owners, etc., in the graph.</span>
    <span class="hljs-string">&quot;degree&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;integer&quot;</span> },

    <span class="hljs-comment">// Type of node in the graph database. This is the value of the sole entry</span>
    <span class="hljs-comment">// in the &#x27;label&#x27; list from the canonical &#x27;graph_node&#x27; representation.</span>
    <span class="hljs-string">&quot;type&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> }
  }
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemassrcgraph_utilgraph_relation_barbell.js"><a href="#toc"><a name="server-schemas-src-graph_util-graph_relation_barbell-js">server/schemas/src/graph_util/graph_relation_barbell.js</a></a></h2>
<pre><code>module.<span class="hljs-attr">exports</span> <span class="hljs-operator">=</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-string">&quot;$schema&quot;</span>: <span class="hljs-string">&quot;http://json-schema.org/draft-07/schema#&quot;</span>,
<span class="hljs-symbol">  title:</span> <span class="hljs-string">&quot;graph_relation_barbell&quot;</span>,
<span class="hljs-symbol">  description:</span> <span class="hljs-string">&quot;Representation of a connecting edge in the ebook graph db, plus the full representation of the two nodes it connects. Ebook represents graph components on the wire as arrays of these &#x27;barbells&#x27; because it&#x27;s convenient to retrieve them from the graph db via CYPHER query. However, it&#x27;s inefficient, because nodes with multiple connecting edges are represented multiple times (once for each connecting edge.)&quot;</span>,
<span class="hljs-symbol">  type:</span> <span class="hljs-string">&quot;object&quot;</span>,
<span class="hljs-symbol">  additionalProperties:</span> false,
<span class="hljs-symbol">  properties:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-comment">// The name of this relation&#x27;s type in the ebook db, such as &#x27;LISTED_AT&#x27;.</span>
    <span class="hljs-comment">// See the graph schema for details about relation types.</span>
    <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-punctuation">{</span> type: <span class="hljs-string">&quot;string&quot;</span> <span class="hljs-punctuation">}</span>,

    <span class="hljs-comment">// Full description of the origin node.</span>
    <span class="hljs-string">&quot;start&quot;</span>: require(<span class="hljs-string">&quot;./graph_node&quot;</span>),
    
    <span class="hljs-comment">// Full description of the destination node.</span>
    <span class="hljs-string">&quot;end&quot;</span>: require(<span class="hljs-string">&quot;./graph_node&quot;</span>)
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemassrcpagesparcel_page.js"><a href="#toc"><a name="server-schemas-src-pages-parcel_page-js">server/schemas/src/pages/parcel_page.js</a></a></h2>
<pre><code><span class="hljs-comment">// Example schema to demonstrate how query responses can be aggregated into</span>
<span class="hljs-comment">// &#x27;page&#x27; data routes. These reflect &#x27;raw&#x27;/unprocessed results, in other words</span>
<span class="hljs-comment">// the strings and types haven&#x27;t been cleaned/reformatted to be more</span>
<span class="hljs-comment">// human-readable.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// To represent &#x27;processed&#x27; data, new schemas should be created to describe any</span>
<span class="hljs-comment">// changes to object layout, string formatting and enum values, etc.</span>
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-string">&quot;$schema&quot;</span>: <span class="hljs-string">&quot;http://json-schema.org/draft-07/schema#&quot;</span>,
  <span class="hljs-attr">title</span>: <span class="hljs-string">&quot;parcel_page&quot;</span>,
  <span class="hljs-attr">description</span>: <span class="hljs-string">&quot;Collected information to be rendered on ebook parcel page.&quot;</span>,
  <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;object&quot;</span>,
  <span class="hljs-attr">additionalProperties</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-attr">properties</span>: {
    <span class="hljs-comment">// Note that &#x27;details&#x27; is the oddity, because the query response itself, as</span>
    <span class="hljs-comment">// written, contains a &#x27;details&#x27; property. That would be redundant, so</span>
    <span class="hljs-comment">// instead we define our own property that has the same type. Future</span>
    <span class="hljs-comment">// maintainers can resolve this inconsitency if so desired.</span>
    <span class="hljs-string">&quot;details&quot;</span>: <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;../queryV2/parcel_details&quot;</span>),
    <span class="hljs-string">&quot;evictions&quot;</span>: <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;../queryV2/responses/parcel_evictions_response&quot;</span>),
    <span class="hljs-string">&quot;ownership_info&quot;</span>: <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;../queryV2/responses/parcel_owners_response&quot;</span>),
    <span class="hljs-string">&quot;portfolio&quot;</span>: <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;../queryV2/responses/common_portfolio_response&quot;</span>),
    <span class="hljs-string">&quot;related_networks&quot;</span>: <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;../queryV2/responses/common_related_network_response&quot;</span>)
  }
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemassrcqueryadditional_evictor_reference.js"><a href="#toc"><a name="server-schemas-src-query-additional_evictor_reference-js">server/schemas/src/query/additional_evictor_reference.js</a></a></h2>
<pre><code><span class="hljs-keyword">module</span>.exports = {
  <span class="hljs-string">&quot;$schema&quot;</span>: <span class="hljs-string">&quot;http://json-schema.org/draft-07/schema#&quot;</span>,
  title: <span class="hljs-string">&quot;additional_evictor_reference&quot;</span>,
  description: <span class="hljs-string">&quot;Brief description of an entity who may be responsible for instigating an eviction, but was not identified as the &#x27;primary&#x27; evictor.&quot;</span>,
  <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;object&quot;</span>,
  additionalProperties: <span class="hljs-literal">false</span>,
  properties: {
    <span class="hljs-comment">// The evictor&#x27;s name, as represented in the source document. All caps.</span>
    <span class="hljs-string">&quot;evictor_name&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// Type of document this information was sourced from.</span>
    <span class="hljs-comment">// As of 2021/05/29, all &#x27;additional&#x27; evictors are sourced from ellis act petitions.</span>
    <span class="hljs-comment">// Add enum values here as we introduce additional types of source documents.</span>
    <span class="hljs-string">&quot;source&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span>, <span class="hljs-built_in">enum</span>: [ <span class="hljs-string">&quot;ELLIS_PETITION&quot;</span> ]  }
  }
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemassrcquerybusiness_details_corp.js"><a href="#toc"><a name="server-schemas-src-query-business_details_corp-js">server/schemas/src/query/business_details_corp.js</a></a></h2>
<pre><code><span class="hljs-keyword">module</span>.exports = {
  <span class="hljs-string">&quot;$schema&quot;</span>: <span class="hljs-string">&quot;http://json-schema.org/draft-07/schema#&quot;</span>,
  title: <span class="hljs-string">&quot;business_details_corp&quot;</span>,
  description: <span class="hljs-string">&quot;Information about a corporation, directly lifted from the properties map of the corresponding node in the ebook db.&quot;</span>,
  <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;object&quot;</span>,
  additionalProperties: <span class="hljs-literal">false</span>,
  properties:  {
    <span class="hljs-comment">// Normalized name of the business, derived from the name in Calif. Sec. of</span>
    <span class="hljs-comment">// State business records.</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Describe or link specifics of the string normalization.</span>
    <span class="hljs-string">&quot;name_norm&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// Transaction date of the document which established this corporation,</span>
    <span class="hljs-comment">// according to the California Secretary of State business registry.</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// Date is represented as a string with format &#x27;CCYYMMDD&#x27;.</span>
    <span class="hljs-string">&quot;transaction_date&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// An 8 digit Corporate Identification Number, from the California Secretary</span>
    <span class="hljs-comment">// of State business registry.</span>
    <span class="hljs-string">&quot;corporation_number&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// Date on which this corporation was incorporated, according to the</span>
    <span class="hljs-comment">// California Secretary of State business registry.</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// Date is represented as a string with format &#x27;CCYYMMDD&#x27;.</span>
    <span class="hljs-string">&quot;incorporation_date&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// Status of the corporation, as a string containing a code from Calif. Sec.</span>
    <span class="hljs-comment">// of State business entity records. The values are described as follows in</span>
    <span class="hljs-comment">// the database schema documentation:</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// 1 = Active</span>
    <span class="hljs-comment">// 2 = Suspended</span>
    <span class="hljs-comment">// 3 = Canceled</span>
    <span class="hljs-comment">// 4 = Surrendered</span>
    <span class="hljs-comment">// 5 = Term expired</span>
    <span class="hljs-comment">// 6 = Dissolved</span>
    <span class="hljs-comment">// 7 = Forfeited</span>
    <span class="hljs-comment">// 8 = Deleted</span>
    <span class="hljs-comment">// 9 = Inactive</span>
    <span class="hljs-comment">// C = Merged Out</span>
    <span class="hljs-comment">// E = State to Federal Bank Conversion</span>
    <span class="hljs-comment">// F = Conditionally dissolved (No tax clearance)</span>
    <span class="hljs-comment">// Not sure about code = Converted Out</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// In the 05/2020 production database, the codes which appear are: &quot;0&quot;-&quot;9&quot;, &quot;C&quot;</span>
    <span class="hljs-string">&quot;corporation_status&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// Description of the legal process used to establish this corporation,</span>
    <span class="hljs-comment">// according to Calif. Sec. of state records. The allowed values and their</span>
    <span class="hljs-comment">// meanings are listed below.</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// ARTS = Articles of Incorporation</span>
    <span class="hljs-comment">// S&amp;DC = Statement &amp; Designation By Foreign Corporation</span>
    <span class="hljs-comment">// S&amp;DA = Statement &amp; Designation By Foreign Association</span>
    <span class="hljs-comment">// FNRE = Foreign Name Registration</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// present in 05/2020 production database: &quot;ARTS&quot;, &quot;S&amp;DC&quot;.</span>
    <span class="hljs-string">&quot;corporation_type&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// Description of the tax-base of the corporation, according to calif. sec.</span>
    <span class="hljs-comment">// of state records. this indicates whether a corporation is for-profit or</span>
    <span class="hljs-comment">// non-profit.</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// S = Stock</span>
    <span class="hljs-comment">// N = Non-Stock (Nonprofit)</span>
    <span class="hljs-string">&quot;corporation_tax_base&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// Additional corporate classifications which may convey special status, such</span>
    <span class="hljs-comment">// as &#x27;religious&#x27; or &#x27;agricultural cooperative&#x27; according to calif. sec. of</span>
    <span class="hljs-comment">// state business entity records.</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// AG = Agricultural Cooperative</span>
    <span class="hljs-comment">// CR = Credit Union</span>
    <span class="hljs-comment">// MU = Mutual Benefit</span>
    <span class="hljs-comment">// OC = Other Cooperative</span>
    <span class="hljs-comment">// PB = Public Benefit</span>
    <span class="hljs-comment">// RE = Religious</span>
    <span class="hljs-comment">// SL = Corporation Sole</span>
    <span class="hljs-comment">// UN = Unclassified</span>
    <span class="hljs-string">&quot;corporation_classification&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// Limited Term expiration date. Format = CCYYMMDD</span>
    <span class="hljs-string">&quot;term_expiration_date&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// Describes whether this corporation is in good standing with the california</span>
    <span class="hljs-comment">// franchise tax board (ftb).</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// &#x27;&#x27; = Not Suspended (In Good Standing) (empty string)</span>
    <span class="hljs-comment">// F = Forfeited</span>
    <span class="hljs-comment">// S = Suspended</span>
    <span class="hljs-string">&quot;ftb_suspension_status&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// If this corporation has been subject to action by the franchise tax board</span>
    <span class="hljs-comment">// as described in &#x27;ftb_suspension_status&quot;, then this field contains a string</span>
    <span class="hljs-comment">// representation of the date of that action.</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// Date is represented as a string with format &#x27;CCYYMMDD&#x27;.</span>
    <span class="hljs-string">&quot;ftb_suspension_date&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// Statement of information file number, per calif sec of state records.</span>
    <span class="hljs-string">&quot;so_file_number&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// Last complete statement (of information?) file date.</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// Date is represented as a string with format &#x27;CCYYMMDD&#x27;.</span>
    <span class="hljs-string">&quot;so_file_date&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// Name of corporation, directly from calif. sec. of state records without</span>
    <span class="hljs-comment">// normalization.</span>
    <span class="hljs-string">&quot;corporation_name&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// &#x27;Care of&#x27; Name, meaning the &#x27;c/o&#x27; addressee which should be included on</span>
    <span class="hljs-comment">// mail intended for the corporation.</span>
    <span class="hljs-string">&quot;co_name&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// Name and contact info of Agent for Service of Process</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// !!! CAUTION !!! Different naming conventions from SOS_LP fields with</span>
    <span class="hljs-comment">// similar info!</span>
    <span class="hljs-string">&quot;agent_name&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },
    <span class="hljs-string">&quot;agent_address_line_1&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },
    <span class="hljs-string">&quot;agent_address_line_2&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },
    <span class="hljs-string">&quot;agent_address_city&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// The state component of the agent-for-service addr.</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> These are not cleaned! Most corps have value &quot;CA&quot;, but some have</span>
    <span class="hljs-comment">// suffixes (intended to indicate county code?)</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// examples of odd entries in 05/2020 production db:</span>
    <span class="hljs-comment">//    &quot;CA 9&quot;, &quot;CA 5126&quot;, &quot;CAA&quot;, &quot;A&quot;.</span>
    <span class="hljs-string">&quot;agent_address_state_county&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// Sometimes these are 5-digit codes, sometimes these are 9-digit.</span>
    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> cleanup.</span>
    <span class="hljs-string">&quot;agent_address_zip_code&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Describe this field; there&#x27;s no description in the schema document.</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// As of 2020/09/09, working understanding is that if the corporation is not</span>
    <span class="hljs-comment">// &#x27;domestic&#x27; (internal to calif.), then this field describes a u.s. state</span>
    <span class="hljs-comment">// other than california, or a country outside the u.s., where this</span>
    <span class="hljs-comment">// corporation originated.</span>
    <span class="hljs-string">&quot;state_or_foreign_country&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// Parcel ownership network id, generated by the evictorbook data</span>
    <span class="hljs-comment">// pipeline via connected component analysis.</span>
    <span class="hljs-string">&quot;network_id&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;integer&quot;</span> },
  }
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemassrcquerybusiness_details_lp.js"><a href="#toc"><a name="server-schemas-src-query-business_details_lp-js">server/schemas/src/query/business_details_lp.js</a></a></h2>
<pre><code>module.exports = {
  <span class="hljs-string">&quot;$schema&quot;</span>: <span class="hljs-string">&quot;http://json-schema.org/draft-07/schema#&quot;</span>,
  title: <span class="hljs-string">&quot;business_details_lp&quot;</span>,
  description: <span class="hljs-string">&quot;Information about a limited partnership or llc, directly lifted from the properties map of the corresponding node in the ebook db.&quot;</span>,
  <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;object&quot;</span>,
  additionalProperties: <span class="hljs-literal">false</span>,
  properties:  {
    <span class="hljs-comment">// Normalized name of the partnership or llc, derived from the name used in</span>
    <span class="hljs-comment">// Calif Sec. of State business records.</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Describe or link specifics of the string normalization.</span>
    <span class="hljs-string">&quot;name_norm&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// LLC only: state or county for formation of foreign llc.</span>
    <span class="hljs-string">&quot;jurisdiction_llc&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },
   
    <span class="hljs-comment">// LLC only: management structure.</span>
    <span class="hljs-comment">// 1 = One Manager</span>
    <span class="hljs-comment">// M = More Than One Manager</span>
    <span class="hljs-comment">// A = All Members are Managers</span>
    <span class="hljs-comment">// LLC ONLY</span>
    <span class="hljs-string">&quot;llc_management_code&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// LLC only: type of business.</span>
    <span class="hljs-string">&quot;llc_type_of_business&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// Format is CCYYJJJN9999</span>
    <span class="hljs-comment">// CCYY = Century and Year.</span>
    <span class="hljs-comment">// JJJ = Julian day of year.</span>
    <span class="hljs-comment">// N = Record Type</span>
    <span class="hljs-comment">// 0 = LP Record</span>
    <span class="hljs-comment">// 1 = LLC Record</span>
    <span class="hljs-comment">// 9999 = Sequence Number </span>
    <span class="hljs-string">&quot;file_number&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// Date of initial filing, represented as CCYYMMDD</span>
    <span class="hljs-string">&quot;file_date&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">//  Identifies current status of LP/LLC</span>
    <span class="hljs-comment">//  A = Active</span>
    <span class="hljs-comment">//  B = Dishonored Check</span>
    <span class="hljs-comment">//  C = Canceled</span>
    <span class="hljs-comment">//  D = Dissolved</span>
    <span class="hljs-comment">//  P = Pending Cancellation</span>
    <span class="hljs-comment">//  F = Franchise Tax Board (FTB) Suspended/Forfeited</span>
    <span class="hljs-comment">//  M = Merged out</span>
    <span class="hljs-comment">//  O = Converted out</span>
    <span class="hljs-comment">//  S = Secretary of State (SOS) Suspended/Forfeited</span>
    <span class="hljs-comment">//  2 = SOS/FTB Suspended/Forfeited</span>
    <span class="hljs-string">&quot;status&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> }, 

    <span class="hljs-comment">// Filing type: foreign &quot;F&quot; or domestic &quot;D&quot;.</span>
    <span class="hljs-string">&quot;filing_type&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// California Limited Partnership or LLC Name, non-normalized.</span>
    <span class="hljs-string">&quot;name&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// State or country of formation for foreign limited partnerships.</span>
    <span class="hljs-string">&quot;jurisdiction&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// Agent of service contact info.</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// !! CAUTION !! These fields follow a different naming convention than their</span>
    <span class="hljs-comment">// conterparts in SOS_Corp.</span>
    <span class="hljs-string">&quot;agent_name&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },
    <span class="hljs-string">&quot;agent_address_1&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },
    <span class="hljs-string">&quot;agent_address_2&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },
    <span class="hljs-string">&quot;agent_city&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },
    <span class="hljs-string">&quot;agent_state&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },
    <span class="hljs-string">&quot;agent_zip&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// Date or cause of termination.</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// This is a free-form text field and can follow many formats, depending on</span>
    <span class="hljs-comment">// context. Examples of typical contents:</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">//  - date in &quot;MM/DD/YY&quot; format. some records allow &#x27;00&#x27; for month or date.</span>
    <span class="hljs-comment">//  - date in &quot;MM/DD/YY&quot; format with qualifying suffix.</span>
    <span class="hljs-comment">//       examples: &quot;01/01/15 OR EVENT&quot;, &quot;01/15/40 OR PER AGMT&quot;, &quot;02/15/33*&quot;</span>
    <span class="hljs-comment">//  - date in &quot;MMDDYY&quot; format</span>
    <span class="hljs-comment">//  - date in &quot;MM/DD/YYYY&quot; format (for some 90&#x27;s records).</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// In general, if you&#x27;re looking at this, expect it to be difficult to parse.</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> document exhaustively and/or apply cleanup in pipeline.</span>
    <span class="hljs-string">&quot;term&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// Network component id of the connected component this owner belongs to.</span>
    <span class="hljs-comment">// This uniquely specifies the ownership network this owner belongs to,</span>
    <span class="hljs-comment">// according to graph analysis in the evictorbook data pipeline.</span>
    <span class="hljs-string">&quot;network_id&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;integer&quot;</span> },
  }
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemassrcquerybusiness_network_identifier.js"><a href="#toc"><a name="server-schemas-src-query-business_network_identifier-js">server/schemas/src/query/business_network_identifier.js</a></a></h2>
<pre><code><span class="hljs-keyword">module</span>.exports = {
  <span class="hljs-string">&quot;$schema&quot;</span>: <span class="hljs-string">&quot;http://json-schema.org/draft-07/schema#&quot;</span>,
  title: <span class="hljs-string">&quot;business_entity_metadata&quot;</span>,
  <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;object&quot;</span>,
  additionalProperties: <span class="hljs-literal">false</span>,
  properties: {
    <span class="hljs-comment">// id of the network this business entity is associated with in the ebook db.</span>
    <span class="hljs-string">&quot;network_id&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;integer&quot;</span> },

    <span class="hljs-comment">// node which represents the business in the ebook db, used as</span>
    <span class="hljs-comment">// a proxy for the type of business entity (corporation, or</span>
    <span class="hljs-comment">// limited partnership/lcc).</span>
    <span class="hljs-string">&quot;__typename&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span>, <span class="hljs-built_in">enum</span>: [<span class="hljs-string">&quot;SOS_LP&quot;</span>, <span class="hljs-string">&quot;SOS_Corp&quot;</span>] }
  }
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemassrcquerydatabase_search_result.js"><a href="#toc"><a name="server-schemas-src-query-database_search_result-js">server/schemas/src/query/database_search_result.js</a></a></h2>
<pre><code><span class="hljs-keyword">module</span>.exports = {
  <span class="hljs-string">&quot;$schema&quot;</span>: <span class="hljs-string">&quot;http://json-schema.org/draft-07/schema#&quot;</span>,
  title: <span class="hljs-string">&quot;database_search_result&quot;</span>,
  description: <span class="hljs-string">&quot;Search result directly from the database&#x27;s full-text index search.&quot;</span>,
  <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;object&quot;</span>,
  additionalProperties: <span class="hljs-literal">false</span>,
  properties: {
    <span class="hljs-comment">// Monotomically increasing search score, as returned from the db&#x27;s Lucene</span>
    <span class="hljs-comment">// full text search. These can be used only for direct comparison within a</span>
    <span class="hljs-comment">// single index, meaning that comparing &#x27;address&#x27; result scores are *NOT*</span>
    <span class="hljs-comment">// directly comparable with &#x27;business&#x27; result scores, etc.</span>
    <span class="hljs-string">&quot;score&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;number&quot;</span> },

    <span class="hljs-comment">// Type of the node this search result represents in the ebook db (ex: &quot;SOS_LP&quot;).</span>
    <span class="hljs-string">&quot;result_type&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// A property of the node this search result represents, selected because</span>
    <span class="hljs-comment">// it allows for a quasi-human-readable label. For business nodes, this is</span>
    <span class="hljs-comment">// &#x27;name_norm&#x27;. For address nodes, it&#x27;s the &quot;readable&quot; addr string.</span>
    <span class="hljs-string">&quot;result_name&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// The unique key of the entity this search result represents. For business</span>
    <span class="hljs-comment">// nodes, it&#x27;s the &#x27;name_norm&#x27;. For address nodes, it&#x27;s the block_lot of</span>
    <span class="hljs-comment">// the corresponding parcel node.</span>
    <span class="hljs-string">&quot;result_id&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> }
  }
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemassrcqueryeviction_match_quality.js"><a href="#toc"><a name="server-schemas-src-query-eviction_match_quality-js">server/schemas/src/query/eviction_match_quality.js</a></a></h2>
<pre><code>module.exports = {
  <span class="hljs-string">&quot;$schema&quot;</span>: <span class="hljs-string">&quot;http://json-schema.org/draft-07/schema#&quot;</span>,
  title: <span class="hljs-string">&quot;eviction_match_quality&quot;</span>,
  type: <span class="hljs-string">&quot;object&quot;</span>,
  properties: {
    <span class="hljs-regexp">//</span> describes the method used to match the eviction to its associated parcel.
    <span class="hljs-string">&quot;addr_match_method&quot;</span>: {
      type: <span class="hljs-string">&quot;string&quot;</span>,
      <span class="hljs-regexp">//</span> TODO: List possible values.
      <span class="hljs-regexp">//</span> enum: [ <span class="hljs-string">&quot;GEO_INSIDE_MULTIPLE&quot;</span>, <span class="hljs-string">&quot;EXACT_ASSESSOR_ADDR_UNIT&quot;</span>, <span class="hljs-string">&quot;RANGE_ASSESSOR_ADDR_WO_UNIT&quot;</span>, ... ]
    },
    <span class="hljs-string">&quot;did_subdivision_occur&quot;</span>: {
      type: <span class="hljs-string">&quot;string&quot;</span>,
      <span class="hljs-regexp">//</span> TODO: List possible values.
      <span class="hljs-regexp">//</span> enum: [ <span class="hljs-string">&quot;SUBDIVISION_BEFORE_EVICTION&quot;</span>, <span class="hljs-string">&quot;NO_SUBDIVISION&quot;</span>, ... ]
    }
  }
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemassrcqueryeviction_record.js"><a href="#toc"><a name="server-schemas-src-query-eviction_record-js">server/schemas/src/query/eviction_record.js</a></a></h2>
<pre><code>module.exports = {
  <span class="hljs-string">&quot;$schema&quot;</span>: <span class="hljs-string">&quot;http://json-schema.org/draft-07/schema#&quot;</span>,
  title: <span class="hljs-string">&quot;eviction_record&quot;</span>,
  description: <span class="hljs-string">&quot;Representation of an eviction record, without location information. Used when nested in a description of a real-estate parcel, when the location info would be redundant.&quot;</span>,
  <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;object&quot;</span>,
  additionalProperties: <span class="hljs-literal">false</span>,
  properties: {
    <span class="hljs-comment">// unique identifier for the eviction.</span>
    <span class="hljs-string">&quot;evict_id&quot;</span>: { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// eviction date, in the format &quot;YYYYMMDD&quot;</span>
    <span class="hljs-string">&quot;evict_date&quot;</span>: { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// information about the primary attributed evictor.</span>
    <span class="hljs-string">&quot;primary_evictor&quot;</span>: {
      <span class="hljs-string">&quot;$schema&quot;</span>: <span class="hljs-string">&quot;http://json-schema.org/draft-07/schema#&quot;</span>,
      title: <span class="hljs-string">&quot;evictor_summary&quot;</span>,
      <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;object&quot;</span>,
      properties: {
        <span class="hljs-comment">// name of the evictor, as represented in the ebook db.</span>
        <span class="hljs-built_in">name</span>: { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;string&quot;</span> },
        <span class="hljs-comment">// if the evictor is believed to be a property-owning business entity,</span>
        <span class="hljs-comment">// then &#x27;linked_be&#x27; is set to a non-empty object describing the</span>
        <span class="hljs-comment">// business entity. otherwise, it&#x27;s set null or to an empty object.</span>
        linked_be: {
          anyOf: [
            { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;null&quot;</span> },
            require(<span class="hljs-string">&#x27;./business_network_identifier.js&#x27;</span>)
          ]
        }
      }
    }, 

    <span class="hljs-comment">// additional names associated with the eviction, taken from the eviction</span>
    <span class="hljs-comment">// petition itself.</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// !!! WARNING !!! In the neighborhood results, &#x27;extra_evictors&#x27; is a property</span>
    <span class="hljs-comment">// of the &#x27;evictor&#x27; object. Here, it&#x27;s a separate entity. TODO Resolve</span>
    <span class="hljs-comment">// this inconsistency.</span>
    <span class="hljs-string">&quot;extra_evictors&quot;</span>: { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;array&quot;</span>, <span class="hljs-built_in">items</span>: require(<span class="hljs-string">&quot;./additional_evictor_reference&quot;</span>) },

    <span class="hljs-comment">// address listed on the eviction petition.</span>
    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Describe normalization steps.</span>
    <span class="hljs-string">&quot;evict_addr_orig&quot;</span>: { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// total number of other properties matched with this eviction, not</span>
    <span class="hljs-comment">// including the primary property this eviction record is returned as a</span>
    <span class="hljs-comment">// sub-message of.</span>
    <span class="hljs-string">&quot;num_other_parc&quot;</span>: { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;integer&quot;</span>, minimum: <span class="hljs-number">0</span> },

    <span class="hljs-comment">// the type of the eviction.</span>
    <span class="hljs-string">&quot;type&quot;</span>: {
      <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;string&quot;</span>,
      <span class="hljs-comment">// TODO List possible values from the DB.</span>
      <span class="hljs-comment">// enum: [ &quot;Owner Move In&quot;, ... ]</span>
    },

    <span class="hljs-comment">// Summary of how this eviction record was matched to its associated</span>
    <span class="hljs-comment">// location in the ebook data pipeline.</span>
    <span class="hljs-string">&quot;match_quality&quot;</span>: require(<span class="hljs-string">&quot;./eviction_match_quality&quot;</span>),
  }
}

</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemassrcqueryeviction_record_ownerpage.js"><a href="#toc"><a name="server-schemas-src-query-eviction_record_ownerpage-js">server/schemas/src/query/eviction_record_ownerpage.js</a></a></h2>
<pre><code>module.exports = {
  <span class="hljs-string">&quot;$schema&quot;</span>: <span class="hljs-string">&quot;http://json-schema.org/draft-07/schema#&quot;</span>,
  title: <span class="hljs-string">&quot;eviction_record_ownerpage&quot;</span>,
  description: <span class="hljs-string">&quot;Yet another representation of an eviction record, this one tied to the &#x27;owner&#x27; page. It contains location information in a nested substructure (*NOT* the merged structure of &#x27;eviction_record_with_location&#x27;) and elides the primary evictor&#x27;s contact information, assuming the caller will have the primary evictor info from context.&quot;</span>,
  <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;object&quot;</span>,
  additionalProperties: <span class="hljs-literal">false</span>,
  properties: {
    <span class="hljs-comment">// unique identifier for the eviction.</span>
    <span class="hljs-string">&quot;evict_id&quot;</span>: { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// eviction date, in the format &quot;YYYYMMDD&quot;</span>
    <span class="hljs-string">&quot;evict_date&quot;</span>: { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// additional entities associated with the eviction, taken from the eviction</span>
    <span class="hljs-comment">// petition itself.</span>
    <span class="hljs-string">&quot;extra_evictors&quot;</span>: { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;array&quot;</span>, <span class="hljs-built_in">items</span>: require(<span class="hljs-string">&#x27;./additional_evictor_reference&#x27;</span>) },

    <span class="hljs-comment">// address listed on the eviction petition.</span>
    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Describe normalization steps.</span>
    <span class="hljs-string">&quot;evict_addr_orig&quot;</span>: { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// the type of the eviction.</span>
    <span class="hljs-string">&quot;type&quot;</span>: {
      <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;string&quot;</span>,
      <span class="hljs-comment">// TODO List possible values from the DB.</span>
      <span class="hljs-comment">// enum: [ &quot;Owner Move In&quot;, ... ]</span>
    },

    <span class="hljs-comment">// Summary of how this eviction record was matched to its associated</span>
    <span class="hljs-comment">// location in the ebook data pipeline.</span>
    <span class="hljs-string">&quot;match_quality&quot;</span>: require(<span class="hljs-string">&quot;./eviction_match_quality&quot;</span>),

    <span class="hljs-comment">// Collected fields describing the parcel this eviction was matched to.</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// !!! WARNING !!! According to notes in the annotated test data by dpsgit,</span>
    <span class="hljs-comment">// this location is randomly selected in the event that multiple locations</span>
    <span class="hljs-comment">// were matched.</span>
    <span class="hljs-string">&quot;location&quot;</span>: {
      <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;object&quot;</span>,
      additionalProperties: <span class="hljs-literal">false</span>,
      properties: {
        <span class="hljs-comment">// The parcel&#x27;s block_lot number, used as a unique identifier. Assumed to</span>
        <span class="hljs-comment">// be in san francisco. Suffix, without hyphens, of the parcel&#x27;s APN.</span>
        <span class="hljs-string">&quot;block_lot&quot;</span>: { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

        <span class="hljs-comment">// total number of other properties matched with this eviction, not</span>
        <span class="hljs-comment">// including the property described by this &#x27;location&#x27; sub-message.</span>
        <span class="hljs-string">&quot;num_other_parc&quot;</span>: { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;integer&quot;</span>, minimum: <span class="hljs-number">0</span> },

        <span class="hljs-comment">// Name of the neighborhood this parcel occupies. It&#x27;s assumed that all</span>
        <span class="hljs-comment">// parcels are within sf city and county, so these are san francisco</span>
        <span class="hljs-comment">// neighborhoods.</span>
        <span class="hljs-comment">//</span>
        <span class="hljs-comment">// See neighborhood config / search result data for the canonical</span>
        <span class="hljs-comment">// neighborhood names. These are upper case, such as &quot;EXCELSIOR&quot; and</span>
        <span class="hljs-comment">// &quot;MISSION&quot;.</span>
        <span class="hljs-comment">//</span>
        <span class="hljs-comment">// neighborhoods assigned using sf polygons.  polygon boundaries:</span>
        <span class="hljs-comment">// https://data.sfgov.org/Geographic-Locations-and-Boundaries/SF-Find-Neighborhoods/pty2-tcw4</span>
        <span class="hljs-string">&quot;neighborhood&quot;</span>: { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

        <span class="hljs-comment">// Number of units in the assigned parcel, if known.</span>
        <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> The fact that this is nullable is quite inconvenient for callers.</span>
        <span class="hljs-comment">// Assign a reasonable default.</span>
        <span class="hljs-string">&quot;units&quot;</span>: { anyOf: [ { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;null&quot;</span> }, { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;integer&quot;</span> } ] },

        <span class="hljs-comment">// The street address and unit components of the assigned parcel&#x27;s address,</span>
        <span class="hljs-comment">// assumed to be in San Francisco. See parcel_details for additional</span>
        <span class="hljs-comment">// caveats about formatting.</span>
        <span class="hljs-string">&quot;addr&quot;</span>: { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

        <span class="hljs-comment">// The assigned parcel&#x27;s lattitude.</span>
        <span class="hljs-string">&quot;lat&quot;</span>: { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;number&quot;</span> },

        <span class="hljs-comment">// The assigned parcel&#x27;s longitude.</span>
        <span class="hljs-string">&quot;long&quot;</span>: { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;number&quot;</span> }
      }
    }
  }
}

</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemassrcqueryeviction_record_with_location.js"><a href="#toc"><a name="server-schemas-src-query-eviction_record_with_location-js">server/schemas/src/query/eviction_record_with_location.js</a></a></h2>
<pre><code>module.exports = {
  <span class="hljs-string">&quot;$schema&quot;</span>: <span class="hljs-string">&quot;http://json-schema.org/draft-07/schema#&quot;</span>,
  title: <span class="hljs-string">&quot;eviction_record_with_location&quot;</span>,
  description: <span class="hljs-string">&quot;Representation of an eviction record, with the addition of location information. Used when evictions are returned outside the context of a particular parcel lookup (i.e. in neighborhood query results)&quot;</span>,
  <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;object&quot;</span>,
  additionalProperties: <span class="hljs-literal">false</span>,
  properties: {
    <span class="hljs-comment">// unique identifier for the eviction.</span>
    <span class="hljs-string">&quot;evict_id&quot;</span>: { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// eviction date, in the format &quot;YYYYMMDD&quot;</span>
    <span class="hljs-string">&quot;evict_date&quot;</span>: { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// information about the primary attributed evictor, plus data about additional evictors.</span>
    <span class="hljs-comment">// !!! WARNING !!! This representation differs from the &#x27;primary_evictor&#x27; item in eviction_record.js.</span>
    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Resolve this inconsistency.</span>
    <span class="hljs-string">&quot;evictor&quot;</span>: {
      <span class="hljs-string">&quot;$schema&quot;</span>: <span class="hljs-string">&quot;http://json-schema.org/draft-07/schema#&quot;</span>,
      title: <span class="hljs-string">&quot;evictor_summary_extended&quot;</span>,
      <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;object&quot;</span>,
      properties: {
        <span class="hljs-comment">// name of the evictor, as represented in the ebook db.</span>
        <span class="hljs-built_in">name</span>: { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;string&quot;</span> },
        <span class="hljs-comment">// if the evictor is believed to be a property-owning business entity,</span>
        <span class="hljs-comment">// then &#x27;linked_be&#x27; is set to a non-empty object describing the</span>
        <span class="hljs-comment">// business entity. otherwise, it&#x27;s set null or to an empty object.</span>
        linked_be: {
          anyOf: [
            { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;null&quot;</span> },
            require(<span class="hljs-string">&#x27;./business_network_identifier&#x27;</span>)
          ]
        },

        <span class="hljs-comment">// additional names associated with the eviction, taken from the eviction</span>
        <span class="hljs-comment">// petition itself.</span>
        <span class="hljs-comment">//</span>
        <span class="hljs-comment">// !!! WARNING !!! In &#x27;eviction_record&#x27;, the extra evictors list is a</span>
        <span class="hljs-comment">// property of the eviction. Here, it&#x27;s a sub-property of eviction</span>
        <span class="hljs-comment">// info. TODO Resolve this inconsistency.</span>
        <span class="hljs-string">&quot;extra_evictors&quot;</span>: { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;array&quot;</span>, <span class="hljs-built_in">items</span>: require(<span class="hljs-string">&#x27;./additional_evictor_reference&#x27;</span>) },
      }
    }, 

    <span class="hljs-comment">// address listed on the eviction petition.</span>
    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Describe normalization steps.</span>
    <span class="hljs-string">&quot;evict_addr_orig&quot;</span>: { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// total number of properties matched with this eviction, including the</span>
    <span class="hljs-comment">// primary property whose location is described here.</span>
    <span class="hljs-string">&quot;num_assoc_parc&quot;</span>: { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;integer&quot;</span>, minimum: <span class="hljs-number">1</span> },

    <span class="hljs-comment">// the type of the eviction.</span>
    <span class="hljs-string">&quot;type&quot;</span>: {
      <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;string&quot;</span>,
      <span class="hljs-comment">// TODO List possible values from the DB.</span>
      <span class="hljs-comment">// enum: [ &quot;Owner Move In&quot;, ... ]</span>
    },

    <span class="hljs-comment">// Summary of how this eviction record was matched to its associated</span>
    <span class="hljs-comment">// location in the ebook data pipeline.</span>
    <span class="hljs-string">&quot;match_quality&quot;</span>: require(<span class="hljs-string">&quot;./eviction_match_quality&quot;</span>),

    <span class="hljs-comment">// Fields describing the parcel this eviction record was matched to:</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Move these into a separate message to eliminate the need for a</span>
    <span class="hljs-comment">// separate &#x27;eviction_record_with_location&#x27; schema.</span>

    <span class="hljs-comment">// The parcel&#x27;s block_lot number, used as a unique identifier. Assumed to</span>
    <span class="hljs-comment">// be in san francisco. Suffix, without hyphens, of the parcel&#x27;s APN.</span>
    <span class="hljs-string">&quot;block_lot&quot;</span>: { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// Number of units in the assigned parcel, if known.</span>
    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> The fact that this is nullable is quite inconvenient for callers.</span>
    <span class="hljs-comment">// Assign a reasonable default.</span>
    <span class="hljs-string">&quot;units&quot;</span>: { anyOf: [ { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;null&quot;</span> }, { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;integer&quot;</span> } ] },

    <span class="hljs-comment">// The street address and unit components of the assigned parcel&#x27;s address,</span>
    <span class="hljs-comment">// assumed to be in San Francisco. See parcel_details for additional</span>
    <span class="hljs-comment">// caveats about formatting.</span>
    <span class="hljs-string">&quot;addr&quot;</span>: { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// The assigned parcel&#x27;s lattitude.</span>
    <span class="hljs-string">&quot;lat&quot;</span>: { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;number&quot;</span> },

    <span class="hljs-comment">// The assigned parcel&#x27;s longitude.</span>
    <span class="hljs-string">&quot;long&quot;</span>: { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;number&quot;</span> }
  }
}

</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemassrcquerynetwork_description.js"><a href="#toc"><a name="server-schemas-src-query-network_description-js">server/schemas/src/query/network_description.js</a></a></h2>
<pre><code><span class="hljs-keyword">module</span>.exports = {
  <span class="hljs-string">&quot;$schema&quot;</span>: <span class="hljs-string">&quot;http://json-schema.org/draft-07/schema#&quot;</span>,
  title: <span class="hljs-string">&quot;network_description&quot;</span>,
  description: <span class="hljs-string">&quot;Subfield of related_network_info, see context there.&quot;</span>,
  <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;object&quot;</span>,
  additionalProperties: <span class="hljs-literal">false</span>,
  properties: {
    <span class="hljs-comment">// Integer identifier for the ownership network in ebook db.</span>
    <span class="hljs-string">&quot;network_id&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;integer&quot;</span> },
    <span class="hljs-comment">// Name of the most prominent property/business owner within the network.</span>
    <span class="hljs-comment">// This can be an individual, corporation, or other legal person. All-caps.</span>
    <span class="hljs-string">&quot;top_owner&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },
    <span class="hljs-comment">// Most prominent contact address among entities in the business network.</span>
    <span class="hljs-comment">// These are derived from business and property records, and are not</span>
    <span class="hljs-comment">// necessarily within San Francisco limits.</span>
    <span class="hljs-comment">// All-caps. Does not include zip codes.</span>
    <span class="hljs-comment">// ex: &quot;3053 FILLMORE ST SAN FRANCISCO CA 228&quot;</span>
    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Clarify the meaning of the number suffix -- is this a unit number?</span>
    <span class="hljs-string">&quot;top_addr&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },
    <span class="hljs-comment">// Name of the most prominent business entity within the ownership network.</span>
    <span class="hljs-comment">// &#x27;name_norm&#x27; field from the business entity&#x27;s graph node. All caps.</span>
    <span class="hljs-string">&quot;top_be&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },
    <span class="hljs-comment">// Number of San Francisco real-estate parcels which this business network</span>
    <span class="hljs-comment">// owns through direct or indirect means, according to ebook&#x27;s data</span>
    <span class="hljs-comment">// analysis.</span>
    <span class="hljs-string">&quot;num_parcels&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;integer&quot;</span> },
    <span class="hljs-comment">// Total number of housing units among San Francisco real-estate parcels</span>
    <span class="hljs-comment">// which this business network owns through direct or indirect means,</span>
    <span class="hljs-comment">// according to ebook&#x27;s data analysis.</span>
    <span class="hljs-string">&quot;num_units&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;integer&quot;</span> }
  }
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemassrcquerynetwork_details.js"><a href="#toc"><a name="server-schemas-src-query-network_details-js">server/schemas/src/query/network_details.js</a></a></h2>
<pre><code>module.<span class="hljs-attr">exports</span> <span class="hljs-operator">=</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-string">&quot;$schema&quot;</span>: <span class="hljs-string">&quot;http://json-schema.org/draft-07/schema#&quot;</span>,
<span class="hljs-symbol">  title:</span> <span class="hljs-string">&quot;network_details&quot;</span>,
<span class="hljs-symbol">  description:</span> <span class="hljs-string">&quot;Stats about an ownership network in the ebook datastore. There is no identifying information about the network itself (network_id), so this must be presented within the context of a specific network object.&quot;</span>,
<span class="hljs-symbol">  type:</span> <span class="hljs-string">&quot;object&quot;</span>,
<span class="hljs-symbol">  additionalProperties:</span> false,
<span class="hljs-symbol">  properties:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-string">&quot;top_bes&quot;</span>: <span class="hljs-punctuation">{</span>
<span class="hljs-symbol">      type:</span> <span class="hljs-string">&quot;array&quot;</span>,
<span class="hljs-symbol">      items:</span> <span class="hljs-punctuation">{</span>
<span class="hljs-symbol">        type:</span> <span class="hljs-string">&quot;object&quot;</span>,
<span class="hljs-symbol">        properties:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-comment">// The type of the node that represents this business entity in the</span>
          <span class="hljs-comment">// ebook db: SOS_Corp for corporations, SOS_LP for limited</span>
          <span class="hljs-comment">// partnerships/llc&#x27;s.</span>
          <span class="hljs-string">&quot;__typename&quot;</span>: <span class="hljs-punctuation">{</span> type: <span class="hljs-string">&quot;string&quot;</span>, enum: [ <span class="hljs-string">&quot;SOS_Corp&quot;</span>, <span class="hljs-string">&quot;SOS_LP&quot;</span> ] <span class="hljs-punctuation">}</span>,

          <span class="hljs-comment">// Normalized name of the business entity, as derived from the calif</span>
          <span class="hljs-comment">// sec of state business index.</span>
          <span class="hljs-string">&quot;name_norm&quot;</span>: <span class="hljs-punctuation">{</span> type: <span class="hljs-string">&quot;string&quot;</span> <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>,

    <span class="hljs-comment">// These are the most-frequently-used contact addresses among entities in</span>
    <span class="hljs-comment">// the business network. *NOT* to be confused with real-estate parcels. </span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// Includes city and state, but not zip code. These may be outside of San</span>
    <span class="hljs-comment">// Francisco.</span>
    <span class="hljs-string">&quot;top_addrs&quot;</span>: <span class="hljs-punctuation">{</span>
<span class="hljs-symbol">      type:</span> <span class="hljs-string">&quot;array&quot;</span>,
<span class="hljs-symbol">      items:</span> <span class="hljs-punctuation">{</span>
<span class="hljs-symbol">        type:</span> <span class="hljs-string">&quot;object&quot;</span>,
<span class="hljs-symbol">        properties:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-comment">// Caution: all-caps.</span>
          <span class="hljs-string">&quot;addr_readable&quot;</span>: <span class="hljs-punctuation">{</span> type: <span class="hljs-string">&quot;string&quot;</span> <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>,

    <span class="hljs-comment">// The most highly-connected &quot;owners&quot; in the business network.</span>
    <span class="hljs-comment">// May be businesses, individuals, trusts, etc.</span>
    <span class="hljs-string">&quot;top_owners&quot;</span>: <span class="hljs-punctuation">{</span>
<span class="hljs-symbol">      type:</span> <span class="hljs-string">&quot;array&quot;</span>, items: <span class="hljs-punctuation">{</span>
<span class="hljs-symbol">        type:</span> <span class="hljs-string">&quot;object&quot;</span>,
<span class="hljs-symbol">        properties:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-comment">// Caution: all-caps.</span>
          <span class="hljs-string">&quot;name_norm&quot;</span>: <span class="hljs-punctuation">{</span> type: <span class="hljs-string">&quot;string&quot;</span> <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>,

    <span class="hljs-comment">// Total number of california business entities represented in the business network.</span>
    <span class="hljs-string">&quot;total_bes&quot;</span>: <span class="hljs-punctuation">{</span> type: <span class="hljs-string">&quot;integer&quot;</span> <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemassrcquerynetwork_match_explanation.js"><a href="#toc"><a name="server-schemas-src-query-network_match_explanation-js">server/schemas/src/query/network_match_explanation.js</a></a></h2>
<pre><code>module.<span class="hljs-attr">exports</span> <span class="hljs-operator">=</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-string">&quot;$schema&quot;</span>: <span class="hljs-string">&quot;http://json-schema.org/draft-07/schema#&quot;</span>,
<span class="hljs-symbol">  title:</span> <span class="hljs-string">&quot;network_match_explanation&quot;</span>,
<span class="hljs-symbol">  description:</span> <span class="hljs-string">&quot;Subfield of related_network_info, see context there.&quot;</span>,
<span class="hljs-symbol">  type:</span> <span class="hljs-string">&quot;object&quot;</span>,
<span class="hljs-symbol">  additionalProperties:</span> false,
<span class="hljs-symbol">  properties:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-comment">// if non-null, means that there is a business in one network</span>
    <span class="hljs-comment">// that is listed at an office address in the other network</span>
    <span class="hljs-string">&quot;businesses_listed_at_addrs&quot;</span>: <span class="hljs-punctuation">{</span>
<span class="hljs-symbol">      anyOf:</span> [
        <span class="hljs-punctuation">{</span> type: <span class="hljs-string">&quot;null&quot;</span> <span class="hljs-punctuation">}</span>,
        <span class="hljs-punctuation">{</span>
<span class="hljs-symbol">          type:</span> <span class="hljs-string">&quot;object&quot;</span>,
<span class="hljs-symbol">          properties:</span> <span class="hljs-punctuation">{</span>
            <span class="hljs-string">&quot;num_addrs&quot;</span>: <span class="hljs-punctuation">{</span> type: <span class="hljs-string">&quot;integer&quot;</span> <span class="hljs-punctuation">}</span>,
            <span class="hljs-string">&quot;num_businesses&quot;</span>: <span class="hljs-punctuation">{</span> type: <span class="hljs-string">&quot;integer&quot;</span> <span class="hljs-punctuation">}</span>
          <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">}</span>
      ]
    <span class="hljs-punctuation">}</span>,

    <span class="hljs-comment">// TODO(dpsgit): INCOMPLETE. Needs description of non-null data structure.</span>
    <span class="hljs-comment">// comment from v2_test_data:</span>
    <span class="hljs-comment">//   if non-null, means that there is a business or address we</span>
    <span class="hljs-comment">//   found to be &quot;suspicious&quot; and removed from our network </span>
    <span class="hljs-comment">//   connecting methodology, that connects the networks</span>
    <span class="hljs-string">&quot;related_to_excluded&quot;</span>: <span class="hljs-punctuation">{</span>
<span class="hljs-symbol">      anyOf:</span> [ <span class="hljs-punctuation">{</span> type: <span class="hljs-string">&quot;null&quot;</span> <span class="hljs-punctuation">}</span> ]  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Add other type here.</span>
    <span class="hljs-punctuation">}</span>,

    <span class="hljs-comment">// comment from v2_test_data:</span>
    <span class="hljs-comment">//   if non-null, means that there is another office in a building</span>
    <span class="hljs-comment">//   associated with 55 Dolores St LLC&#x27;s network that is part of </span>
    <span class="hljs-comment">//   this network </span>
    <span class="hljs-string">&quot;similar_addresses&quot;</span>: <span class="hljs-punctuation">{</span>
<span class="hljs-symbol">      anyOf:</span> [
        <span class="hljs-punctuation">{</span> type: <span class="hljs-string">&quot;null&quot;</span> <span class="hljs-punctuation">}</span>,
        <span class="hljs-punctuation">{</span>
<span class="hljs-symbol">          type:</span> <span class="hljs-string">&quot;object&quot;</span>,
<span class="hljs-symbol">          title:</span> <span class="hljs-string">&quot;similar_addresses_metadata&quot;</span>,
<span class="hljs-symbol">          properties:</span> <span class="hljs-punctuation">{</span>
            <span class="hljs-comment">// TODO(dpsgit): Describe the meaning of this metric and how it</span>
            <span class="hljs-comment">// applies to ebook&#x27;s graph analysis.</span>
            <span class="hljs-string">&quot;highest_similarity&quot;</span>: <span class="hljs-punctuation">{</span> type: <span class="hljs-string">&quot;number&quot;</span> <span class="hljs-punctuation">}</span>
          <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">}</span>
      ]  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Add other type here.</span>
    <span class="hljs-punctuation">}</span>,

    <span class="hljs-comment">// TODO(dpsgit): INCOMPLETE. Needs description of non-null data structure.</span>
    <span class="hljs-comment">// comment from v2_test_data:</span>
    <span class="hljs-comment">//   if non-null, means that there is a business in one network</span>
    <span class="hljs-comment">//   that is the property owner for a business in the other network</span>
    <span class="hljs-string">&quot;businesses_owning_parcels&quot;</span>: <span class="hljs-punctuation">{</span>
<span class="hljs-symbol">      anyOf:</span> [ <span class="hljs-punctuation">{</span> type: <span class="hljs-string">&quot;null&quot;</span> <span class="hljs-punctuation">}</span> ]  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Add other type here.</span>
    <span class="hljs-punctuation">}</span>,

    <span class="hljs-comment">// TODO(dpsgit): INCOMPLETE. Needs description of non-null data structure.</span>
    <span class="hljs-comment">// comment from v2_test_data:</span>
    <span class="hljs-comment">//   if non-null, means that there is a non-business property </span>
    <span class="hljs-comment">//   owner that owns property in both networks</span>
    <span class="hljs-string">&quot;parcels_owned_by_same_non_business_owner&quot;</span>: <span class="hljs-punctuation">{</span>
<span class="hljs-symbol">      anyOf:</span> [ <span class="hljs-punctuation">{</span> type: <span class="hljs-string">&quot;null&quot;</span> <span class="hljs-punctuation">}</span> ]  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Add other type here.</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemassrcqueryparcel_address_details.js"><a href="#toc"><a name="server-schemas-src-query-parcel_address_details-js">server/schemas/src/query/parcel_address_details.js</a></a></h2>
<pre><code>module.exports = {
  <span class="hljs-string">&quot;$schema&quot;</span>: <span class="hljs-string">&quot;http://json-schema.org/draft-07/schema#&quot;</span>,
  title: <span class="hljs-string">&quot;parcel_address_details&quot;</span>,
  <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;object&quot;</span>,
  additionalProperties: <span class="hljs-literal">false</span>,
  properties: {
    <span class="hljs-comment">// These addresses consist only of the &#x27;street address&#x27; component and</span>
    <span class="hljs-comment">// subpremise (unit number), NOT the city, state, or zip.</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// WARNING: The are NOT in a human-friendly format. These are in all</span>
    <span class="hljs-comment">// caps and may have extraneous spaces. The text is the output of the</span>
    <span class="hljs-comment">// ebook data pipeline&#x27;s address normalizer, which is idiosyncratic</span>
    <span class="hljs-comment">// and not widely understood among the team.</span>

    <span class="hljs-comment">// address derived from sf assessor&#x27;s parcel records</span>
    <span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> Missing from some A_Parcel nodes in 3/31/21 db, so marked &#x27;nullable&#x27;.</span>
    <span class="hljs-string">&quot;main_addr&quot;</span>: <span class="hljs-keyword">require</span>(<span class="hljs-string">&#x27;../type_util/nullable_types&#x27;</span>).<span class="hljs-built_in">string</span>,

    <span class="hljs-comment">// a list of address variations found from EAS data. if no variations</span>
    <span class="hljs-comment">// are recorded, will be an empty list.</span>
    <span class="hljs-string">&quot;addr_variations&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;array&quot;</span>, items: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> } },
    <span class="hljs-comment">// count of additional variations recorded in ebook datastore.</span>
    <span class="hljs-string">&quot;num_extra_addr_variations&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;integer&quot;</span> }
  }
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemassrcqueryparcel_details.js"><a href="#toc"><a name="server-schemas-src-query-parcel_details-js">server/schemas/src/query/parcel_details.js</a></a></h2>
<pre><code>module.exports = {
  <span class="hljs-string">&quot;$schema&quot;</span>: <span class="hljs-string">&quot;http://json-schema.org/draft-07/schema#&quot;</span>,
  title: <span class="hljs-string">&quot;parcel_details&quot;</span>,
  description: <span class="hljs-string">&quot;Information about a real-estate property cataloged in the ebook db.&quot;</span>,
  type: <span class="hljs-string">&quot;object&quot;</span>,
  additionalProperties: <span class="hljs-keyword">false</span>,
  properties: {
    <span class="hljs-comment">// &#x27;block_lot&#x27; identifier. unique key for a parcel in sf assessor records,</span>
    <span class="hljs-comment">// and unique key for A_Parcel nodes in the database.</span>
    <span class="hljs-comment">// Suffix of the parcel&#x27;s APN, without hyphens.</span>
    <span class="hljs-string">&quot;block_lot&quot;</span>: { type: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// year in which the buildings on this real-estate parcel were first constructed.</span>
    <span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> Missing from some A_Parcel nodes in 3/31/21 db, so marked &#x27;nullable&#x27;.</span>
    <span class="hljs-string">&quot;yr_built&quot;</span>: <span class="hljs-keyword">require</span>(<span class="hljs-string">&#x27;../type_util/nullable_types&#x27;</span>).<span class="hljs-keyword">integer</span>,

    <span class="hljs-comment">// Description of the parcel&#x27;s address, as it&#x27;s represented in SF assessor</span>
    <span class="hljs-comment">// records. See above.</span>
    <span class="hljs-string">&quot;addr_details&quot;</span>: <span class="hljs-keyword">require</span>(<span class="hljs-string">&quot;./parcel_address_details&quot;</span>),

    <span class="hljs-comment">// latitude in degrees of a point within this parcel&#x27;s boundaries.</span>
    <span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> Missing from some A_Parcel nodes in 3/31/21 db, so marked &#x27;nullable&#x27;.</span>
    <span class="hljs-string">&quot;lat&quot;</span>: <span class="hljs-keyword">require</span>(<span class="hljs-string">&#x27;../type_util/nullable_types&#x27;</span>).number,

    <span class="hljs-comment">// longitude in degrees of a point within this parcel&#x27;s boundaries.</span>
    <span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> Missing from some A_Parcel nodes in 3/31/21 db, so marked &#x27;nullable&#x27;.</span>
    <span class="hljs-string">&quot;long&quot;</span>: <span class="hljs-keyword">require</span>(<span class="hljs-string">&#x27;../type_util/nullable_types&#x27;</span>).number,

    <span class="hljs-comment">// Name of the neighborhood this parcel occupies. It&#x27;s assumed that all</span>
    <span class="hljs-comment">// parcels are within sf city and county, so these are san francisco</span>
    <span class="hljs-comment">// neighborhoods.</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// See neighborhood config / search result data for the canonical</span>
    <span class="hljs-comment">// neighborhood names. These are upper case, such as &quot;EXCELSIOR&quot; and</span>
    <span class="hljs-comment">// &quot;MISSION&quot;.</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// neighborhoods assigned using sf polygons.  polygon boundaries:</span>
    <span class="hljs-comment">// https://data.sfgov.org/Geographic-Locations-and-Boundaries/SF-Find-Neighborhoods/pty2-tcw4</span>
    <span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> Missing from some A_Parcel nodes in 3/31/21 db, so marked &#x27;nullable&#x27;.</span>
    <span class="hljs-string">&quot;neighborhood&quot;</span>: <span class="hljs-keyword">require</span>(<span class="hljs-string">&#x27;../type_util/nullable_types&#x27;</span>).<span class="hljs-keyword">string</span>,

    <span class="hljs-comment">// rough assessment of this parcel&#x27;s rent-control status.</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// 0 (default) if data unavailable to determine rent controlled status, </span>
    <span class="hljs-comment">// 1 if likely rent controlled,</span>
    <span class="hljs-comment">// 2 if doubtful that this is rent controlled</span>
    <span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> Missing from some A_Parcel nodes in 3/31/21 db, so marked &#x27;nullable&#x27;.</span>
    <span class="hljs-string">&quot;rent_controlled&quot;</span>: {
      anyOf: [
        { type: <span class="hljs-string">&quot;null&quot;</span> },
        { type: <span class="hljs-string">&quot;integer&quot;</span>, enum: [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>] }
      ]
    },

    <span class="hljs-comment">// property class code, via sf assessor&#x27;s office.</span>
    <span class="hljs-comment">// definitons:</span>
    <span class="hljs-comment">// https://data.sfgov.org/Housing-and-Buildings/Reference-Assessor-Recorder-Property-Class-Codes/pa56-ek2h/data</span>
    <span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> Missing from some A_Parcel nodes in 3/31/21 db, so marked &#x27;nullable&#x27;.</span>
    <span class="hljs-string">&quot;prop_class_code&quot;</span>: <span class="hljs-keyword">require</span>(<span class="hljs-string">&#x27;../type_util/nullable_types&#x27;</span>).<span class="hljs-keyword">string</span>,

    <span class="hljs-comment">// i.d. for the zoning district this parcel occupies.</span>
    <span class="hljs-comment">// sf zoning district definitions:</span>
    <span class="hljs-comment">// https://sfplanninggis.org/pim/map.html?layers=Zoning%20Districts</span>
    <span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> Missing from some A_Parcel nodes in 3/31/21 db, so marked &#x27;nullable&#x27;.</span>
    <span class="hljs-string">&quot;zone&quot;</span>: <span class="hljs-keyword">require</span>(<span class="hljs-string">&#x27;../type_util/nullable_types&#x27;</span>).<span class="hljs-keyword">string</span>,

    <span class="hljs-comment">// how tall is the building on this parcel, in stories.</span>
    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> behavior for multi-building parcels?</span>
    <span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> Missing from some A_Parcel nodes in 3/31/21 db, so marked &#x27;nullable&#x27;.</span>
    <span class="hljs-string">&quot;stories&quot;</span>: <span class="hljs-keyword">require</span>(<span class="hljs-string">&#x27;../type_util/nullable_types&#x27;</span>).<span class="hljs-keyword">integer</span>,

    <span class="hljs-comment">// number of physical units within this logical real-estate parcel.</span>
    <span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> Missing from some A_Parcel nodes in 3/31/21 db, so marked &#x27;nullable&#x27;.</span>
    <span class="hljs-string">&quot;units&quot;</span>: <span class="hljs-keyword">require</span>(<span class="hljs-string">&#x27;../type_util/nullable_types&#x27;</span>).<span class="hljs-keyword">integer</span>,

    <span class="hljs-comment">// number of total rooms within buildings on this parcel (for multi-unit</span>
    <span class="hljs-comment">// parcels, this is the sum of rooms among all units.)</span>
    <span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> Missing from some A_Parcel nodes in 3/31/21 db, so marked &#x27;nullable&#x27;.</span>
    <span class="hljs-string">&quot;rooms&quot;</span>: <span class="hljs-keyword">require</span>(<span class="hljs-string">&#x27;../type_util/nullable_types&#x27;</span>).<span class="hljs-keyword">integer</span>,

    <span class="hljs-comment">// number of total bedrooms on this parcel (for multi-unit parcels, this is</span>
    <span class="hljs-comment">// the sum of bedrooms among all units.)</span>
    <span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> Missing from some A_Parcel nodes in 3/31/21 db, so marked &#x27;nullable&#x27;.</span>
    <span class="hljs-string">&quot;beds&quot;</span>: <span class="hljs-keyword">require</span>(<span class="hljs-string">&#x27;../type_util/nullable_types&#x27;</span>).<span class="hljs-keyword">integer</span>,

    <span class="hljs-comment">// assessor valuation of the &#x27;land&#x27; base value, i.e. the parcel&#x27;s theoretical</span>
    <span class="hljs-comment">// value if it had no buildings on it.</span>
    <span class="hljs-string">&quot;assess_land_val&quot;</span>: { type: <span class="hljs-string">&quot;integer&quot;</span> },

    <span class="hljs-comment">// assessor valuation of the &#x27;improvement&#x27; done to the land via development,</span>
    <span class="hljs-comment">// as of most recent assessment. units in u.s. dollars.</span>
    <span class="hljs-string">&quot;assess_imp_val&quot;</span>: { type: <span class="hljs-string">&quot;integer&quot;</span> },

    <span class="hljs-comment">// date when the parcel&#x27;s value was last assessed. format: CCYYMMDD</span>
    <span class="hljs-string">&quot;assess_val_date&quot;</span>: { type: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// date on which this parcel&#x27;s address was last updated, via assessor</span>
    <span class="hljs-comment">// records. format: CCYYMMDD</span>
    <span class="hljs-string">&quot;update_date&quot;</span>: { type: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// units in u.s. dollars.  <span class="hljs-doctag">TODO:</span> document when and how this gets populated.</span>
    <span class="hljs-string">&quot;curr_sales_price&quot;</span>: { type: <span class="hljs-string">&quot;integer&quot;</span> },

    <span class="hljs-comment">// format: CCYYMMDD  <span class="hljs-doctag">TODO:</span> document when and how this gets populated.</span>
    <span class="hljs-string">&quot;curr_sales_date&quot;</span>: { type: <span class="hljs-string">&quot;string&quot;</span> }

  }
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemassrcqueryparcel_ownership_record.js"><a href="#toc"><a name="server-schemas-src-query-parcel_ownership_record-js">server/schemas/src/query/parcel_ownership_record.js</a></a></h2>
<pre><code>module.exports = {
  <span class="hljs-string">&quot;$schema&quot;</span>: <span class="hljs-string">&quot;http://json-schema.org/draft-07/schema#&quot;</span>,
  title: <span class="hljs-string">&quot;parcel_ownership_record&quot;</span>,
  description: <span class="hljs-string">&quot;Information about a real-estate property&#x27;s owner.&quot;</span>,
  <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;object&quot;</span>,
  additionalProperties: <span class="hljs-literal">false</span>,
  properties: {
    <span class="hljs-comment">// Registered owner&#x27;s mailing address, per SF assessor records.</span>
    <span class="hljs-comment">// Includes city and state, but not zip code.</span>
    <span class="hljs-comment">// ex: &quot;173 EVELYN WAY SAN FRANCISCO CA&quot;</span>
    <span class="hljs-string">&quot;mailing_address&quot;</span>: { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;string&quot;</span> },
    <span class="hljs-comment">// The owner&#x27;s name, in all caps, as it appears in SF assessor records.</span>
    <span class="hljs-comment">// This may the the name of an individual, a business, or another legal</span>
    <span class="hljs-comment">// entity such as a trust.</span>
    <span class="hljs-string">&quot;owner_name&quot;</span>: { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;string&quot;</span> },
    <span class="hljs-comment">// Date on which this ownership relation was documented. Format: YYYYMMDD</span>
    <span class="hljs-comment">// ex: &quot;20181227&quot;</span>
    <span class="hljs-string">&quot;record_date&quot;</span>: { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;string&quot;</span> },
    <span class="hljs-comment">// if the owner is believed to be a property-owning business entity,</span>
    <span class="hljs-comment">// then &#x27;linked_be&#x27; is set to an object containing information about that</span>
    <span class="hljs-comment">// business entity. otherwise, it&#x27;s set null.</span>
    <span class="hljs-string">&quot;linked_be&quot;</span>: {
      anyOf: [
        { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;null&quot;</span> },
        require(<span class="hljs-string">&#x27;./business_network_identifier.js&#x27;</span>)
      ]
    },
    <span class="hljs-comment">// ownership percentage, of the assigned owner, expressed as a number</span>
    <span class="hljs-comment">// between 0 and 100.</span>
    <span class="hljs-comment">// We may not have complete ownership information for a parcel, so don&#x27;t</span>
    <span class="hljs-comment">// make any assumptions about these numbers adding up to 100.</span>
    <span class="hljs-comment">// May have a fractional component, typically does not.</span>
    <span class="hljs-string">&quot;perc_owner&quot;</span>: { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;number&quot;</span> }
  }
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemassrcqueryproperty_portfolio_entry.js"><a href="#toc"><a name="server-schemas-src-query-property_portfolio_entry-js">server/schemas/src/query/property_portfolio_entry.js</a></a></h2>
<pre><code>module.exports = {
  <span class="hljs-string">&quot;$schema&quot;</span>: <span class="hljs-string">&quot;http://json-schema.org/draft-07/schema#&quot;</span>,
  title: <span class="hljs-string">&quot;property_portfolio_entry&quot;</span>,
  description: <span class="hljs-string">&quot;An element of a property ownership portfolio, containing brief info about a single parcel.&quot;</span>,
  <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;object&quot;</span>,
  additionalProperties: <span class="hljs-literal">false</span>,
  properties:  {
    <span class="hljs-comment">// &#x27;block_lot&#x27; identifier. unique key for a parcel in sf assessor records,</span>
    <span class="hljs-comment">// and unique key for A_Parcel nodes in the database.</span>
    <span class="hljs-comment">// Suffix of the parcel&#x27;s APN, without hyphens.</span>
    <span class="hljs-string">&quot;block_lot&quot;</span>: { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;string&quot;</span> },
    <span class="hljs-comment">// Number of evictions associated with this parcel in ebook datastore.</span>
    <span class="hljs-string">&quot;num_evictions&quot;</span>: { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;integer&quot;</span> },
    <span class="hljs-comment">// Registered owner&#x27;s mailing address, per SF assessor records.</span>
    <span class="hljs-comment">// Includes city and state, but not zip code.</span>
    <span class="hljs-comment">// ex: &quot;173 EVELYN WAY SAN FRANCISCO CA&quot;</span>
    <span class="hljs-string">&quot;owner_mailing_addr&quot;</span>: { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Questions for Dan -- Why is there only one &#x27;owner_mailing_addr&#x27;,</span>
    <span class="hljs-comment">// but multiple &#x27;owners&#x27;? Why not just put the mailing_addr into the &#x27;owner&#x27;</span>
    <span class="hljs-comment">// object in this array? This would give us consistency with</span>
    <span class="hljs-comment">// parcel_ownership_info.</span>
    <span class="hljs-string">&quot;owners&quot;</span>: {
      <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;array&quot;</span>,
      <span class="hljs-built_in">items</span>: {
        <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;object&quot;</span>,
        properties: {
          <span class="hljs-comment">// The owner&#x27;s name, in all caps, as it appears in SF assessor records.</span>
          <span class="hljs-comment">// This may the the name of an individual, a business, or another legal</span>
          <span class="hljs-comment">// entity such as a trust.</span>
          owner_name: { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;string&quot;</span> },
          <span class="hljs-comment">// if the owner is believed to be a property-owning business entity,</span>
          <span class="hljs-comment">// then &#x27;linked_be&#x27; is set to an object containing information about that</span>
          <span class="hljs-comment">// business entity. otherwise, it&#x27;s set null.</span>
          linked_be: {
            anyOf: [
              { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;null&quot;</span> },
              require(<span class="hljs-string">&#x27;./business_network_identifier.js&#x27;</span>)
            ]
          },
        }
      }
    },

    <span class="hljs-comment">// address derived from sf assessor&#x27;s parcel records</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// These addresses consist only of the &#x27;street address&#x27; component and</span>
    <span class="hljs-comment">// subpremise (unit number), NOT the city, state, or zip. Assumed to be in</span>
    <span class="hljs-comment">// San Francisco.</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// WARNING: These are NOT in a human-friendly format. These are in all caps</span>
    <span class="hljs-comment">// and may have extraneous spaces. The text is the output of the ebook data</span>
    <span class="hljs-comment">// pipeline&#x27;s address normalizer, which is idiosyncratic and not widely</span>
    <span class="hljs-comment">// understood among the team.</span>
    addr: { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// Fields borrowed from parcel_details:</span>
    <span class="hljs-comment">// see parcel_details for context on &#x27;neighborhood&#x27;.</span>
    neighborhood: { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;string&quot;</span> },
    <span class="hljs-comment">// number of physical units within this logical real-estate parcel.</span>
    <span class="hljs-built_in">units</span>: { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;integer&quot;</span> },
    <span class="hljs-comment">// latitude in degrees of a point within this parcel&#x27;s boundaries.</span>
    lat: { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;number&quot;</span> },
    <span class="hljs-comment">// longitude in degrees of a point within this parcel&#x27;s boundaries.</span>
    long: { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;number&quot;</span> }

  },
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemassrcqueryproperty_portfolio_entry_ownerpage.js"><a href="#toc"><a name="server-schemas-src-query-property_portfolio_entry_ownerpage-js">server/schemas/src/query/property_portfolio_entry_ownerpage.js</a></a></h2>
<pre><code>module.exports = {
  <span class="hljs-string">&quot;$schema&quot;</span>: <span class="hljs-string">&quot;http://json-schema.org/draft-07/schema#&quot;</span>,
  title: <span class="hljs-string">&quot;property_portfolio_entry&quot;</span>,
  description: <span class="hljs-string">&quot;An element of a property ownership portfolio, containing brief info about a single parcel. !!!! CAUTION!!!: This is a full duplicate of &#x27;property_portfolio_entry&#x27;, with the sole exception that the owner&#x27;s mailing address has a different property name. TODO: Resolve the inconsitency and delete this schema.&quot;</span>,
  <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;object&quot;</span>,
  additionalProperties: <span class="hljs-literal">false</span>,
  properties:  {
    <span class="hljs-comment">// &#x27;block_lot&#x27; identifier. unique key for a parcel in sf assessor records,</span>
    <span class="hljs-comment">// and unique key for A_Parcel nodes in the database.</span>
    <span class="hljs-comment">// Suffix of the parcel&#x27;s APN, without hyphens.</span>
    <span class="hljs-string">&quot;block_lot&quot;</span>: { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;string&quot;</span> },
    <span class="hljs-comment">// Number of evictions associated with this parcel in ebook datastore.</span>
    <span class="hljs-string">&quot;num_evictions&quot;</span>: { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;integer&quot;</span> },

    <span class="hljs-comment">// Registered owner&#x27;s mailing address, per SF assessor records.</span>
    <span class="hljs-comment">// Includes city and state, but not zip code.</span>
    <span class="hljs-comment">// ex: &quot;173 EVELYN WAY SAN FRANCISCO CA&quot;</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// !!!! CAUTION !!!: This field is the sole difference between this schema</span>
    <span class="hljs-comment">// and &#x27;property_portfolio_entry&#x27;. <span class="hljs-doctag">TODO:</span> Correct the inconsistency so a</span>
    <span class="hljs-comment">// single schema can be used in both places.</span>
    <span class="hljs-string">&quot;mailing_address&quot;</span>: { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Questions for Dan -- Why is there only one &#x27;owner_mailing_addr&#x27;,</span>
    <span class="hljs-comment">// but multiple &#x27;owners&#x27;? Why not just put the mailing_addr into the &#x27;owner&#x27;</span>
    <span class="hljs-comment">// object in this array? This would give us consistency with</span>
    <span class="hljs-comment">// parcel_ownership_info.</span>
    <span class="hljs-string">&quot;owners&quot;</span>: {
      <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;array&quot;</span>,
      <span class="hljs-built_in">items</span>: {
        <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;object&quot;</span>,
        properties: {
          <span class="hljs-comment">// The owner&#x27;s name, in all caps, as it appears in SF assessor records.</span>
          <span class="hljs-comment">// This may the the name of an individual, a business, or another legal</span>
          <span class="hljs-comment">// entity such as a trust.</span>
          owner_name: { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;string&quot;</span> },
          <span class="hljs-comment">// if the owner is believed to be a property-owning business entity,</span>
          <span class="hljs-comment">// then &#x27;linked_be&#x27; is set to an object containing information about that</span>
          <span class="hljs-comment">// business entity. otherwise, it&#x27;s set null.</span>
          linked_be: {
            anyOf: [
              { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;null&quot;</span> },
              require(<span class="hljs-string">&#x27;./business_network_identifier.js&#x27;</span>)
            ]
          },
        }
      }
    },

    <span class="hljs-comment">// address derived from sf assessor&#x27;s parcel records</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// These addresses consist only of the &#x27;street address&#x27; component and</span>
    <span class="hljs-comment">// subpremise (unit number), NOT the city, state, or zip. Assumed to be in</span>
    <span class="hljs-comment">// San Francisco.</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// WARNING: These are NOT in a human-friendly format. These are in all caps</span>
    <span class="hljs-comment">// and may have extraneous spaces. The text is the output of the ebook data</span>
    <span class="hljs-comment">// pipeline&#x27;s address normalizer, which is idiosyncratic and not widely</span>
    <span class="hljs-comment">// understood among the team.</span>
    addr: { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// Fields borrowed from parcel_details:</span>
    <span class="hljs-comment">// see parcel_details for context on &#x27;neighborhood&#x27;.</span>
    neighborhood: { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;string&quot;</span> },
    <span class="hljs-comment">// number of physical units within this logical real-estate parcel.</span>
    <span class="hljs-built_in">units</span>: { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;integer&quot;</span> },
    <span class="hljs-comment">// latitude in degrees of a point within this parcel&#x27;s boundaries.</span>
    lat: { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;number&quot;</span> },
    <span class="hljs-comment">// longitude in degrees of a point within this parcel&#x27;s boundaries.</span>
    long: { <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;number&quot;</span> }

  },
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemassrcqueryrelated_network_info.js"><a href="#toc"><a name="server-schemas-src-query-related_network_info-js">server/schemas/src/query/related_network_info.js</a></a></h2>
<pre><code>module.exports = {
  <span class="hljs-comment">&quot;$schema&quot;</span>: <span class="hljs-comment">&quot;http://json-schema.org/draft-07/schema#&quot;</span>,
  title: <span class="hljs-comment">&quot;related_network_info&quot;</span>,
  description: <span class="hljs-comment">&quot;Description of an ownership network which may be related to another referenced entity. Used in the context of a parcel page or a network page to describe possible connections.&quot;</span>,
  type: <span class="hljs-comment">&quot;object&quot;</span>,
  additionalProperties: <span class="hljs-keyword">false</span>,
  properties: {
    match_explanation: require(<span class="hljs-string">&#x27;./network_match_explanation&#x27;</span>),
    network_description: require(<span class="hljs-string">&#x27;./network_description&#x27;</span>)
  }
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemassrcqueryresponsescommon_portfolio_response.js"><a href="#toc"><a name="server-schemas-src-query-responses-common_portfolio_response-js">server/schemas/src/query/responses/common_portfolio_response.js</a></a></h2>
<pre><code>module.<span class="hljs-attr">exports</span> <span class="hljs-operator">=</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-string">&quot;$schema&quot;</span>: <span class="hljs-string">&quot;http://json-schema.org/draft-07/schema#&quot;</span>,
<span class="hljs-symbol">  title:</span> <span class="hljs-string">&quot;common_portfolio_response&quot;</span>,
<span class="hljs-symbol">  description:</span> <span class="hljs-string">&quot;List of property_portfolio_entry objects, to be returned as a query result.&quot;</span>,
<span class="hljs-symbol">  type:</span> <span class="hljs-string">&quot;array&quot;</span>,
<span class="hljs-symbol">  items:</span> require(<span class="hljs-string">&quot;../property_portfolio_entry&quot;</span>)
<span class="hljs-punctuation">}</span>
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemassrcqueryresponsescommon_related_network_response.js"><a href="#toc"><a name="server-schemas-src-query-responses-common_related_network_response-js">server/schemas/src/query/responses/common_related_network_response.js</a></a></h2>
<pre><code>module.<span class="hljs-attr">exports</span> <span class="hljs-operator">=</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-string">&quot;$schema&quot;</span>: <span class="hljs-string">&quot;http://json-schema.org/draft-07/schema#&quot;</span>,
<span class="hljs-symbol">  title:</span> <span class="hljs-string">&quot;common_related_network_response&quot;</span>,
<span class="hljs-symbol">  description:</span> <span class="hljs-string">&quot;List of related_network_info objects, returned as a query result.&quot;</span>,
<span class="hljs-symbol">  type:</span> <span class="hljs-string">&quot;array&quot;</span>,
<span class="hljs-symbol">  items:</span> require(<span class="hljs-string">&quot;../related_network_info&quot;</span>)
<span class="hljs-punctuation">}</span>
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemassrcqueryresponsesneighborhood_evictions_response.js"><a href="#toc"><a name="server-schemas-src-query-responses-neighborhood_evictions_response-js">server/schemas/src/query/responses/neighborhood_evictions_response.js</a></a></h2>
<pre><code>module.exports = {
  <span class="hljs-comment">&quot;$schema&quot;</span>: <span class="hljs-comment">&quot;http://json-schema.org/draft-07/schema#&quot;</span>,
  title: <span class="hljs-comment">&quot;neighborhood_evictions_response&quot;</span>,
  description: <span class="hljs-comment">&quot;Result of the &#x27;neighborhood&#x27; query. Confusingly, this does not actually return information about the neighborhood itself, but rather a list of evictions which occured in the neighborhood. Vestige of ebook 1.0 behavior.&quot;</span>,
  type: <span class="hljs-comment">&quot;array&quot;</span>,
  items: require(<span class="hljs-comment">&quot;../eviction_record_with_location&quot;</span>)
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemassrcqueryresponsesnetwork_details_response.js"><a href="#toc"><a name="server-schemas-src-query-responses-network_details_response-js">server/schemas/src/query/responses/network_details_response.js</a></a></h2>
<pre><code>// Straight pass-through <span class="hljs-keyword">of</span> <span class="hljs-string">&#x27;network_details&#x27;</span> data <span class="hljs-keyword">type</span> <span class="hljs-keyword">with</span> <span class="hljs-keyword">no</span> <span class="hljs-keyword">wrapper</span>.
module.exports = require(<span class="hljs-string">&#x27;../network_details&#x27;</span>)
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemassrcqueryresponsesnetwork_graph_response.js"><a href="#toc"><a name="server-schemas-src-query-responses-network_graph_response-js">server/schemas/src/query/responses/network_graph_response.js</a></a></h2>
<pre><code>module.<span class="hljs-attr">exports</span> <span class="hljs-operator">=</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-string">&quot;$schema&quot;</span>: <span class="hljs-string">&quot;http://json-schema.org/draft-07/schema#&quot;</span>,
<span class="hljs-symbol">  title:</span> <span class="hljs-string">&quot;network_graph_response&quot;</span>,
<span class="hljs-symbol">  description:</span> <span class="hljs-string">&quot;Describes the subset of nodes and relations in the ebook db that comprise a business network.&quot;</span>,
<span class="hljs-symbol">  type:</span> <span class="hljs-string">&quot;object&quot;</span>,
<span class="hljs-symbol">  additionalProperties:</span> false,
<span class="hljs-symbol">  properties:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-string">&quot;network_subgraph&quot;</span>: <span class="hljs-punctuation">{</span>
<span class="hljs-symbol">      type:</span> <span class="hljs-string">&quot;array&quot;</span>, items: require(<span class="hljs-string">&quot;../../graph_util/graph_relation_barbell&quot;</span>)
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemassrcqueryresponsesnetwork_nodes_response.js"><a href="#toc"><a name="server-schemas-src-query-responses-network_nodes_response-js">server/schemas/src/query/responses/network_nodes_response.js</a></a></h2>
<pre><code>module.<span class="hljs-attr">exports</span> <span class="hljs-operator">=</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-string">&quot;$schema&quot;</span>: <span class="hljs-string">&quot;http://json-schema.org/draft-07/schema#&quot;</span>,
<span class="hljs-symbol">  title:</span> <span class="hljs-string">&quot;network_nodes_response&quot;</span>,
<span class="hljs-symbol">  description:</span> <span class="hljs-string">&quot;List of graph nodes which belong to a given business network&#x27;s &#x27;subgraph&#x27;. This is an alternate &#x27;lite&#x27; representation which doesn&#x27;t contain the node&#x27;s properties or internal id&#x27;s, but does contain the degree of connectivity.&quot;</span>,
<span class="hljs-symbol">  type:</span> <span class="hljs-string">&quot;object&quot;</span>,
<span class="hljs-symbol">  additionalProperties:</span> false,
<span class="hljs-symbol">  properties:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-string">&quot;nodes&quot;</span>: <span class="hljs-punctuation">{</span>
<span class="hljs-symbol">      type:</span> <span class="hljs-string">&quot;array&quot;</span>, items: require(<span class="hljs-string">&quot;../../graph_util/graph_node_lite&quot;</span>)
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemassrcqueryresponsesowner_business_details_response.js"><a href="#toc"><a name="server-schemas-src-query-responses-owner_business_details_response-js">server/schemas/src/query/responses/owner_business_details_response.js</a></a></h2>
<pre><code>module.<span class="hljs-attr">exports</span> <span class="hljs-operator">=</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-string">&quot;$schema&quot;</span>: <span class="hljs-string">&quot;http://json-schema.org/draft-07/schema#&quot;</span>,
<span class="hljs-symbol">  title:</span> <span class="hljs-string">&quot;owner_business_details_response&quot;</span>,
<span class="hljs-symbol">  description:</span> <span class="hljs-string">&quot;Describes a business entity which owns real-estate. This may be a corporation or a limited-partnership/llc, and there&#x27;s a different set of information in either case.&quot;</span>,
<span class="hljs-symbol">  type:</span> <span class="hljs-string">&quot;object&quot;</span>,
<span class="hljs-symbol">  additionalProperties:</span> false,
<span class="hljs-symbol">  properties:</span>  <span class="hljs-punctuation">{</span>
    <span class="hljs-string">&quot;be_details&quot;</span>: <span class="hljs-punctuation">{</span>
<span class="hljs-symbol">      anyOf:</span> [
        require(<span class="hljs-string">&quot;../business_details_corp&quot;</span>),
        require(<span class="hljs-string">&quot;../business_details_lp&quot;</span>)
      ]
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemassrcqueryresponsesowner_evictions_response.js"><a href="#toc"><a name="server-schemas-src-query-responses-owner_evictions_response-js">server/schemas/src/query/responses/owner_evictions_response.js</a></a></h2>
<pre><code>module.<span class="hljs-attr">exports</span> <span class="hljs-operator">=</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-string">&quot;$schema&quot;</span>: <span class="hljs-string">&quot;http://json-schema.org/draft-07/schema#&quot;</span>,
<span class="hljs-symbol">  title:</span> <span class="hljs-string">&quot;owner_evictions_response&quot;</span>,
<span class="hljs-symbol">  description:</span> <span class="hljs-string">&quot;List of eviction_record_ownerpage objects, returned as a query result.&quot;</span>,
<span class="hljs-symbol">  type:</span> <span class="hljs-string">&quot;array&quot;</span>,
<span class="hljs-symbol">  items:</span> require(<span class="hljs-string">&quot;../eviction_record_ownerpage&quot;</span>)
<span class="hljs-punctuation">}</span>
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemassrcqueryresponsesowner_portfolio_response.js"><a href="#toc"><a name="server-schemas-src-query-responses-owner_portfolio_response-js">server/schemas/src/query/responses/owner_portfolio_response.js</a></a></h2>
<pre><code>module.<span class="hljs-attr">exports</span> <span class="hljs-operator">=</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-string">&quot;$schema&quot;</span>: <span class="hljs-string">&quot;http://json-schema.org/draft-07/schema#&quot;</span>,
<span class="hljs-symbol">  title:</span> <span class="hljs-string">&quot;owner_portfolio_response&quot;</span>,
<span class="hljs-symbol">  description:</span> <span class="hljs-string">&quot;List of property_portfolio_entry_ownerpage objects, to be returned as a query result.&quot;</span>,
<span class="hljs-symbol">  type:</span> <span class="hljs-string">&quot;array&quot;</span>,
<span class="hljs-symbol">  items:</span> require(<span class="hljs-string">&quot;../property_portfolio_entry_ownerpage&quot;</span>)
<span class="hljs-punctuation">}</span>
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemassrcqueryresponsesparcel_details_response.js"><a href="#toc"><a name="server-schemas-src-query-responses-parcel_details_response-js">server/schemas/src/query/responses/parcel_details_response.js</a></a></h2>
<pre><code><span class="hljs-built_in">module</span>.exports = {
  <span class="hljs-string">&quot;$schema&quot;</span>: <span class="hljs-string">&quot;http://json-schema.org/draft-07/schema#&quot;</span>,
  title: <span class="hljs-string">&quot;parcel_details_response&quot;</span>,
  description: <span class="hljs-string">&quot;Query struct returned for parcel details lookup.&quot;</span>,
  <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;object&quot;</span>,
  additionalProperties: <span class="hljs-literal">false</span>,
  properties: {
    <span class="hljs-string">&quot;parcel_details&quot;</span>: <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../parcel_details&#x27;</span>)
  }
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemassrcqueryresponsesparcel_evictions_response.js"><a href="#toc"><a name="server-schemas-src-query-responses-parcel_evictions_response-js">server/schemas/src/query/responses/parcel_evictions_response.js</a></a></h2>
<pre><code>module.<span class="hljs-attr">exports</span> <span class="hljs-operator">=</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-string">&quot;$schema&quot;</span>: <span class="hljs-string">&quot;http://json-schema.org/draft-07/schema#&quot;</span>,
<span class="hljs-symbol">  title:</span> <span class="hljs-string">&quot;parcel_evictions_response&quot;</span>,
<span class="hljs-symbol">  description:</span> <span class="hljs-string">&quot;List of eviction_record objects, returned as a query result.&quot;</span>,
<span class="hljs-symbol">  type:</span> <span class="hljs-string">&quot;array&quot;</span>,
<span class="hljs-symbol">  items:</span> require(<span class="hljs-string">&quot;../eviction_record&quot;</span>)
<span class="hljs-punctuation">}</span>
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemassrcqueryresponsesparcel_owners_response.js"><a href="#toc"><a name="server-schemas-src-query-responses-parcel_owners_response-js">server/schemas/src/query/responses/parcel_owners_response.js</a></a></h2>
<pre><code>module.exports = {
  <span class="hljs-string">&quot;$schema&quot;</span>: <span class="hljs-string">&quot;http://json-schema.org/draft-07/schema#&quot;</span>,
  title: <span class="hljs-string">&quot;parcel_owners_response&quot;</span>,
  description: <span class="hljs-string">&quot;Summary of information about the owner(s) of a real-estate parcel.&quot;</span>,
  <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;object&quot;</span>,
  additionalProperties: <span class="hljs-literal">false</span>,
  properties: {
    <span class="hljs-comment">// List of data about current owners. Typically, this will be only one item long.</span>
    <span class="hljs-string">&quot;owners&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;array&quot;</span>, items: <span class="hljs-keyword">require</span>(<span class="hljs-string">&#x27;../parcel_ownership_record.js&#x27;</span>) },

    <span class="hljs-comment">// The total number of parcels beleived to be owned, by all the full and</span>
    <span class="hljs-comment">// part owners of the queried parcel.</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// This field was added to the 1.0 API in late 2020 without much</span>
    <span class="hljs-comment">// discussion.  <span class="hljs-doctag">TODO:</span> Verify that this is still useful, and that it means</span>
    <span class="hljs-comment">// what we think it does.</span>
    <span class="hljs-string">&quot;parcels&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;integer&quot;</span> }
  }
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemassrcqueryresponsessearch_response.js"><a href="#toc"><a name="server-schemas-src-query-responses-search_response-js">server/schemas/src/query/responses/search_response.js</a></a></h2>
<pre><code>module.<span class="hljs-attr">exports</span> <span class="hljs-operator">=</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-string">&quot;$schema&quot;</span>: <span class="hljs-string">&quot;http://json-schema.org/draft-07/schema#&quot;</span>,
<span class="hljs-symbol">  title:</span> <span class="hljs-string">&quot;search_response&quot;</span>,
<span class="hljs-symbol">  description:</span> <span class="hljs-string">&quot;List of search results aggregated from the db&#x27;s full-text search.&quot;</span>,
<span class="hljs-symbol">  type:</span> <span class="hljs-string">&quot;array&quot;</span>,
<span class="hljs-symbol">  items:</span> require(<span class="hljs-string">&quot;../database_search_result&quot;</span>)
<span class="hljs-punctuation">}</span>
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemassrctype_utilnullable_types.js"><a href="#toc"><a name="server-schemas-src-type_util-nullable_types-js">server/schemas/src/type_util/nullable_types.js</a></a></h2>
<pre><code><span class="hljs-selector-tag">var</span> nullable = <span class="hljs-built_in">function</span>(label) {
  return { anyOf: <span class="hljs-selector-attr">[ { type: <span class="hljs-string">&quot;null&quot;</span> }, { type: label } ]</span> }
}

module<span class="hljs-selector-class">.exports</span> = {
  <span class="hljs-string">&quot;number&quot;</span>: <span class="hljs-built_in">nullable</span>(<span class="hljs-string">&quot;number&quot;</span>),
  <span class="hljs-string">&quot;string&quot;</span>: <span class="hljs-built_in">nullable</span>(<span class="hljs-string">&quot;string&quot;</span>),
  <span class="hljs-string">&quot;integer&quot;</span>: <span class="hljs-built_in">nullable</span>(<span class="hljs-string">&quot;integer&quot;</span>),
  <span class="hljs-string">&quot;boolean&quot;</span>: <span class="hljs-built_in">nullable</span>(<span class="hljs-string">&quot;boolean&quot;</span>)
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemassrcunifiedsearchdefinitionsbusiness_search_payload.js"><a href="#toc"><a name="server-schemas-src-unifiedsearch-definitions-business_search_payload-js">server/schemas/src/unifiedSearch/definitions/business_search_payload.js</a></a></h2>
<pre><code><span class="hljs-keyword">module</span>.exports = {
  <span class="hljs-string">&quot;$schema&quot;</span>: <span class="hljs-string">&quot;http://json-schema.org/draft-07/schema#&quot;</span>,
  <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;object&quot;</span>,
  additionalProperties: <span class="hljs-literal">false</span>,
  properties: {
    <span class="hljs-comment">// represents the type of business entity, but only in an obscure way.</span>
    <span class="hljs-comment">// context: it&#x27;s the node-type of the business&#x27;s record in the eb database.</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">//  values:</span>
    <span class="hljs-comment">//   &quot;SOS_Corp&quot; if the business is a corporation.</span>
    <span class="hljs-comment">//   &quot;SOS_LP&quot; if the business is a limited partnership or llc.</span>
    <span class="hljs-string">&quot;db_node_type&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span>, <span class="hljs-built_in">enum</span>: [<span class="hljs-string">&quot;SOS_Corp&quot;</span>, <span class="hljs-string">&quot;SOS_LP&quot;</span>] },

    <span class="hljs-comment">// the business&#x27;s type, as represented in calif. sec of state business</span>
    <span class="hljs-comment">// registry.</span>
    <span class="hljs-string">&quot;business_type&quot;</span>: require(<span class="hljs-string">&quot;./business_type&quot;</span>),

    <span class="hljs-comment">// literal value of the business entity&#x27;s canonical name in ebook db, where</span>
    <span class="hljs-comment">// it appears as &#x27;name_norm&#x27;.</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// derived from the name as it appears in the california secretary of state</span>
    <span class="hljs-comment">// business registry.</span>
    <span class="hljs-string">&quot;canonical_name&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// value of the business entity&#x27;s name in db, encoded as a url-safe string.</span>
    <span class="hljs-comment">// useful when generating uri&#x27;s for REST api calls.</span>
    <span class="hljs-string">&quot;canonical_name_safe&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// human-friendly formatting of business&#x27;s name, as it appears in the</span>
    <span class="hljs-comment">// california secretary of state business registry.</span>
    <span class="hljs-string">&quot;display_name&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> }
  }
}

</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemassrcunifiedsearchdefinitionsbusiness_type.js"><a href="#toc"><a name="server-schemas-src-unifiedsearch-definitions-business_type-js">server/schemas/src/unifiedSearch/definitions/business_type.js</a></a></h2>
<pre><code>module.<span class="hljs-attr">exports</span> <span class="hljs-operator">=</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-string">&quot;$schema&quot;</span>: <span class="hljs-string">&quot;http://json-schema.org/draft-07/schema#&quot;</span>,
<span class="hljs-symbol">  description:</span> <span class="hljs-string">&quot;a business&#x27;s type, as recorded in calif. sec of state business registry.&quot;</span>,
<span class="hljs-symbol">  type:</span> <span class="hljs-string">&quot;string&quot;</span>, 
<span class="hljs-symbol">  enum:</span> [
    <span class="hljs-string">&quot;BUSINESS_TYPE_UNSPECIFIED&quot;</span>,
    <span class="hljs-string">&quot;CALIF_SOS_CORP&quot;</span>,  <span class="hljs-comment">// corporation</span>
    <span class="hljs-string">&quot;CALIF_SOS_LP&quot;</span>  <span class="hljs-comment">// limited partnership or llc</span>
  ]
<span class="hljs-punctuation">}</span>
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemassrcunifiedsearchdefinitionscategory_enum.js"><a href="#toc"><a name="server-schemas-src-unifiedsearch-definitions-category_enum-js">server/schemas/src/unifiedSearch/definitions/category_enum.js</a></a></h2>
<pre><code>module.<span class="hljs-attr">exports</span> <span class="hljs-operator">=</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-string">&quot;$schema&quot;</span>: <span class="hljs-string">&quot;http://json-schema.org/draft-07/schema#&quot;</span>,
<span class="hljs-symbol">  title:</span> <span class="hljs-string">&quot;category_enum&quot;</span>,
<span class="hljs-symbol">  description:</span> <span class="hljs-string">&quot;the type of entity a given search result represents.&quot;</span>,
<span class="hljs-symbol">  type:</span> <span class="hljs-string">&quot;string&quot;</span>,
<span class="hljs-symbol">  enum:</span> [
    <span class="hljs-string">&quot;CATEGORY_UNSPECIFIED&quot;</span>,
    <span class="hljs-string">&quot;PARCEL&quot;</span>,
    <span class="hljs-string">&quot;BUSINESS_ENTITY&quot;</span>,
    <span class="hljs-string">&quot;NEIGHBORHOOD_SUMMARY&quot;</span>
  ]
<span class="hljs-punctuation">}</span>
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemassrcunifiedsearchdefinitionsneighborhood_summary_payload.js"><a href="#toc"><a name="server-schemas-src-unifiedsearch-definitions-neighborhood_summary_payload-js">server/schemas/src/unifiedSearch/definitions/neighborhood_summary_payload.js</a></a></h2>
<pre><code><span class="hljs-keyword">module</span>.exports = {
  <span class="hljs-string">&quot;$schema&quot;</span>: <span class="hljs-string">&quot;http://json-schema.org/draft-07/schema#&quot;</span>,
  additionalProperties: <span class="hljs-literal">false</span>,
  <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;object&quot;</span>,
  properties: {
    <span class="hljs-comment">// non-url-safe version of canonical name, as expected in &#x27;/api/neighborhood&#x27;</span>
    <span class="hljs-comment">// requests. useful in server code, because express converts the url-safe</span>
    <span class="hljs-comment">// parameter back to an unsafe string.</span>
    <span class="hljs-string">&quot;canonical_name&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// url-safe version of the neighborhood&#x27;s name expected in &#x27;/api/neighborhood&#x27;</span>
    <span class="hljs-comment">// requests. useful in client code for assembling REST uri&#x27;s.</span>
    <span class="hljs-string">&quot;canonical_name_safe&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// human-friendly formatting of neighborhood name, suitable for display in a ui.</span>
    <span class="hljs-string">&quot;display_name&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// integer id uniquely identifying neighborhood in ebook api.</span>
    <span class="hljs-string">&quot;id&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;integer&quot;</span> }
  }
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemassrcunifiedsearchdefinitionsparcel_search_payload.js"><a href="#toc"><a name="server-schemas-src-unifiedsearch-definitions-parcel_search_payload-js">server/schemas/src/unifiedSearch/definitions/parcel_search_payload.js</a></a></h2>
<pre><code><span class="hljs-keyword">module</span>.exports = {
  <span class="hljs-string">&quot;$schema&quot;</span>: <span class="hljs-string">&quot;http://json-schema.org/draft-07/schema#&quot;</span>,
  <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;object&quot;</span>,
  additionalProperties: <span class="hljs-literal">false</span>,
  properties: {
    <span class="hljs-comment">// the block_lot of this parcel in sf assessor records. unique key in</span>
    <span class="hljs-comment">// ebook rest api.</span>
    <span class="hljs-string">&quot;block_lot&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// value of block_lot, encoded to be uri-safe.</span>
    <span class="hljs-string">&quot;block_lot_safe&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// the address of the parcel, exactly as it appears in ebook database.</span>
    <span class="hljs-comment">// (see node types: Address_Main and Address_Unit.)</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// IMPORTANT: this is not a human-readable address!</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// these strings may be missing critical information such as street</span>
    <span class="hljs-comment">// suffix or zip code, and they may have arbitrary leading and trailing</span>
    <span class="hljs-comment">// spaces. they are extracted directly from the database without</span>
    <span class="hljs-comment">// cleanup.</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// preserving the current behavior for now to avoid breaking existing</span>
    <span class="hljs-comment">// code.  (changing undocumented behavior without warning is</span>
    <span class="hljs-comment">// dangerous.)</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> migrate away from this.</span>
    <span class="hljs-string">&quot;addr&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// value of addr, reformatted to be human-readable. title case, leading</span>
    <span class="hljs-comment">// and trailing spaces trimmed. all the warnings above about the</span>
    <span class="hljs-comment">// content of the address still apply (missing components, etc.)</span>
    <span class="hljs-string">&quot;display_addr&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> expand. more metadata, etc.</span>
  }
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemassrcunifiedsearchdefinitionsranking_info.js"><a href="#toc"><a name="server-schemas-src-unifiedsearch-definitions-ranking_info-js">server/schemas/src/unifiedSearch/definitions/ranking_info.js</a></a></h2>
<pre><code>module.<span class="hljs-attr">exports</span> <span class="hljs-operator">=</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-string">&quot;$schema&quot;</span>: <span class="hljs-string">&quot;http://json-schema.org/draft-07/schema#&quot;</span>,
<span class="hljs-symbol">  title:</span> <span class="hljs-string">&quot;ranking_info&quot;</span>,
<span class="hljs-symbol">  description:</span> <span class="hljs-string">&quot;Description of scoring for search result items&quot;</span>,
<span class="hljs-symbol">  type:</span> <span class="hljs-string">&quot;object&quot;</span>,
<span class="hljs-symbol">  additionalProperties:</span> false,
<span class="hljs-symbol">  properties:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-comment">// Raw score, as retrieved from the database index&#x27;s full text search.</span>
    <span class="hljs-string">&quot;raw_score&quot;</span>: <span class="hljs-punctuation">{</span> type: <span class="hljs-string">&quot;number&quot;</span> <span class="hljs-punctuation">}</span>,
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemassrcunifiedsearchdefinitionssearch_result.js"><a href="#toc"><a name="server-schemas-src-unifiedsearch-definitions-search_result-js">server/schemas/src/unifiedSearch/definitions/search_result.js</a></a></h2>
<pre><code>module.exports = {
  <span class="hljs-string">&quot;$schema&quot;</span>: <span class="hljs-string">&quot;http://json-schema.org/draft-07/schema#&quot;</span>,
  title: <span class="hljs-string">&quot;search_result&quot;</span>,
  description: <span class="hljs-string">&quot;An individual search result item, with accompanying metadata.&quot;</span>,
  <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;object&quot;</span>,
  additionalProperties: <span class="hljs-literal">false</span>,
  properties: {
    <span class="hljs-comment">// main label for this search result. ex: name of company, address, etc.</span>
    <span class="hljs-comment">// obj with localizable strings, see below.</span>
    <span class="hljs-string">&quot;label&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// may be unset in response json. if populated, this contains a short</span>
    <span class="hljs-comment">// description of the item, for optional display if layout permits.</span>
    <span class="hljs-string">&quot;description&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// url to link to. this is the public user-facing page (react route).</span>
    <span class="hljs-string">&quot;details_url&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// url for rest api request, to retrieve structured data about this item.</span>
    <span class="hljs-string">&quot;api_url&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// the type of entity this search result represents.</span>
    <span class="hljs-string">&quot;category&quot;</span>: <span class="hljs-keyword">require</span>(<span class="hljs-string">&quot;./category_enum&quot;</span>),

    <span class="hljs-comment">// Human-readable display for category enum.</span>
    <span class="hljs-comment">// ex: &quot;Address&quot;, &quot;Owner&quot;, &quot;Neighborhood&quot;.</span>
    <span class="hljs-string">&quot;category_label&quot;</span>: { <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;string&quot;</span> },

    <span class="hljs-comment">// potential search payloads. at most one will be set.</span>
    <span class="hljs-comment">// add more payload defnitions as we add new categories.</span>
    <span class="hljs-string">&quot;parcel_data&quot;</span>: <span class="hljs-keyword">require</span>(<span class="hljs-string">&quot;./parcel_search_payload&quot;</span>),
    <span class="hljs-string">&quot;business_data&quot;</span>: <span class="hljs-keyword">require</span>(<span class="hljs-string">&quot;./business_search_payload&quot;</span>),
    <span class="hljs-string">&quot;neighborhood_data&quot;</span>: <span class="hljs-keyword">require</span>(<span class="hljs-string">&quot;./neighborhood_summary_payload&quot;</span>),

    <span class="hljs-comment">// Details about result scoring/ranking.</span>
    <span class="hljs-string">&quot;ranking_info&quot;</span>: <span class="hljs-keyword">require</span>(<span class="hljs-string">&quot;./ranking_info&quot;</span>),
  }
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemassrcunifiedsearchsearch_request.js"><a href="#toc"><a name="server-schemas-src-unifiedsearch-search_request-js">server/schemas/src/unifiedSearch/search_request.js</a></a></h2>
<pre><code>module.exports = {
  &quot;$schema&quot;: &quot;http://json-schema.org/draft-07/schema#&quot;,
  title: &quot;unified_search_request&quot;,
  description: &quot;Parameters for REST unified search api call.&quot;,
  <span class="hljs-keyword">type</span>: &quot;object&quot;,
  additionalProperties: <span class="hljs-keyword">false</span>,
  properties: {
    // the <span class="hljs-type">text</span> <span class="hljs-keyword">of</span> the query string we want <span class="hljs-keyword">to</span> run a general-purpose <span class="hljs-keyword">search</span> <span class="hljs-keyword">for</span>.
    //   populated <span class="hljs-keyword">from</span> the queryparam <span class="hljs-string">&#x27;q&#x27;</span>, <span class="hljs-keyword">as</span> <span class="hljs-keyword">in</span> <span class="hljs-string">&#x27;/api/search?q=URBAN%20ORANGE&#x27;</span>
    &quot;query_string&quot;: { <span class="hljs-keyword">type</span>: &quot;string&quot; },

    // determines which neo4j <span class="hljs-keyword">database</span> <span class="hljs-keyword">server</span> <span class="hljs-keyword">to</span> use, <span class="hljs-keyword">if</span> the <span class="hljs-keyword">server</span> supports it.
    //  &quot;v1&quot; <span class="hljs-keyword">or</span> &quot;v2&quot;. <span class="hljs-keyword">If</span> unset/empty string, assume &quot;v1.&quot;
    //  populated <span class="hljs-keyword">from</span> the queryparam <span class="hljs-string">&#x27;db_version&#x27;</span>
    &quot;database_version&quot;: { <span class="hljs-keyword">type</span>: &quot;string&quot; }
  }
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverschemassrcunifiedsearchsearch_response.js"><a href="#toc"><a name="server-schemas-src-unifiedsearch-search_response-js">server/schemas/src/unifiedSearch/search_response.js</a></a></h2>
<pre><code>module.<span class="hljs-attr">exports</span> <span class="hljs-operator">=</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-string">&quot;$schema&quot;</span>: <span class="hljs-string">&quot;http://json-schema.org/draft-07/schema#&quot;</span>,
<span class="hljs-symbol">  title:</span> <span class="hljs-string">&quot;unified_search_response&quot;</span>,
<span class="hljs-symbol">  description:</span> <span class="hljs-string">&quot;REST response from unified search api call.&quot;</span>,
<span class="hljs-symbol">  type:</span> <span class="hljs-string">&quot;object&quot;</span>,
<span class="hljs-symbol">  additionalProperties:</span> false,
<span class="hljs-symbol">  properties:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-string">&quot;results&quot;</span>: <span class="hljs-punctuation">{</span> type: <span class="hljs-string">&quot;array&quot;</span>, items: require(<span class="hljs-string">&quot;./definitions/search_result&quot;</span>) <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="servertestapi_tester.py"><a href="#toc"><a name="server-test-api_tester-py">server/test/api_tester.py</a></a></h2>
<pre><code><span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">from</span> deepdiff <span class="hljs-keyword">import</span> DeepDiff
<span class="hljs-keyword">from</span> urllib.parse <span class="hljs-keyword">import</span> quote

<span class="hljs-keyword">def</span> <span class="hljs-title function_">clean_empty</span>(<span class="hljs-params">d</span>):
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">isinstance</span>(d, (<span class="hljs-built_in">dict</span>, <span class="hljs-built_in">list</span>)):
        <span class="hljs-keyword">return</span> d
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(d, <span class="hljs-built_in">list</span>):
        <span class="hljs-keyword">return</span> [v <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> (clean_empty(v) <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> d) <span class="hljs-keyword">if</span> v]
    <span class="hljs-keyword">return</span> {k: v <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> ((k, clean_empty(v)) <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> d.items()) <span class="hljs-keyword">if</span> v}

<span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>(<span class="hljs-params">a_base_url, b_base_url, a_query, b_query</span>):
    <span class="hljs-comment"># creating http request URL</span>
    a_URL = a_base_url + quote(a_query)
    b_URL = b_base_url + quote(b_query)

    <span class="hljs-comment"># sending get request and saving the response as response object</span>
    a_response = requests.get(url = a_URL)
    b_response = requests.get(url = b_URL)

    <span class="hljs-comment"># extracting data in json format</span>
    a_json = clean_empty(a_response.json())
    b_json = clean_empty(b_response.json())
    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;A Length: {}&quot;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">len</span>(a_json)))
    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;B Length: {}&quot;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">len</span>(b_json)))

    json_diff = DeepDiff(a_json, b_json, ignore_order=<span class="hljs-literal">True</span>)
    <span class="hljs-comment"># If you want to view the json diff in tree format, you can use the below line instead:</span>
    <span class="hljs-comment"># json_diff = DeepDiff(a_json, b_json, ignore_order=True, view=&#x27;tree&#x27;, verbose_level=2)</span>
    <span class="hljs-built_in">print</span>(json_diff)

<span class="hljs-comment"># This script outputs the difference in response between different REST APIs. Can be used when making changes to the EvictorBook database or server code. </span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># HOW TO RUN:</span>
<span class="hljs-comment"># python3 api_tester.py a_api b_api query</span>
<span class="hljs-comment"># e.g. python3 api_tester.py &quot;http://evictorbook.com/api/corp/&quot; &quot;http://evictorbook.com/api/corp/&quot; &quot;Happy Donuts&quot;</span>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:
    main(a_base_url=sys.argv[<span class="hljs-number">1</span>], b_base_url=sys.argv[<span class="hljs-number">2</span>], a_query=sys.argv[<span class="hljs-number">3</span>], b_query=sys.argv[<span class="hljs-number">3</span>])
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="servertestgetparceldetails.test.js"><a href="#toc"><a name="server-test-getparceldetails-test-js">server/test/getParcelDetails.test.js</a></a></h2>
<pre><code><span class="hljs-comment">// getParcelDetails.test.js</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// unit tests for getParcelDetails route handler. uses mockApp to inject mock</span>
<span class="hljs-comment">// queryHandler function, thereby testing the business logic without depending</span>
<span class="hljs-comment">// on a live database.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// treat this as a template for additional tests for other route handlers.</span>

<span class="hljs-comment">// external libraries:</span>
<span class="hljs-keyword">import</span> assert <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;assert&#x27;</span>;

<span class="hljs-comment">// libraries and utilities included from source:</span>
<span class="hljs-keyword">import</span> protoTestUtils <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../framework/protoTestUtils&#x27;</span>;
<span class="hljs-keyword">import</span> protoUtils <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../framework/protoUtils&#x27;</span>;
<span class="hljs-keyword">import</span> mockApp <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../framework/mockApp&#x27;</span>;

<span class="hljs-comment">// pbf-generated proto modules, for use with protoUtils/protoTestUtils:</span>
<span class="hljs-comment">// (see type_definitions/README.md)</span>
<span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> These are DEPRECATED, for new code rely on json-schemas as shown in dbRouteListenersV2.</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">QueryProto</span> = protoUtils.<span class="hljs-title function_">compileProto</span>(<span class="hljs-string">&#x27;schemas/legacy/proto/query/query.proto&#x27;</span>);
<span class="hljs-keyword">const</span> <span class="hljs-title class_">RestProto</span> = protoUtils.<span class="hljs-title function_">compileProto</span>(<span class="hljs-string">&#x27;schemas/legacy/proto/rest/rest.proto&#x27;</span>);

<span class="hljs-comment">// package under test:</span>
<span class="hljs-keyword">import</span> { getParcelDetails } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../rest/routes/dbRouteListeners&#x27;</span>;

<span class="hljs-comment">// test data.  <span class="hljs-doctag">TODO:</span> define in a separate file.</span>

<span class="hljs-comment">// obj representing the expected contents of the http response (i.e. what you</span>
<span class="hljs-comment">// would get when you parse the http response body&#x27;s as json).</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// conforms to RestProto.GetParcelDetailsResponse, see:</span>
<span class="hljs-comment">//   type_definitions/proto/rest/rest.proto.</span>
<span class="hljs-keyword">const</span> expected_response = {
  <span class="hljs-attr">parcel_details</span>: {
    <span class="hljs-attr">yr_built</span>: <span class="hljs-number">1901</span>,
    <span class="hljs-attr">addr</span>: <span class="hljs-string">&quot;4200 Boogie Down Lane 26&quot;</span>,
    <span class="hljs-attr">block_lot</span>: <span class="hljs-string">&quot;P4RTY&quot;</span>,
    <span class="hljs-attr">lat</span>: <span class="hljs-number">26.8</span>,
    <span class="hljs-attr">long</span>: <span class="hljs-number">29.1</span>,
    <span class="hljs-attr">neighborhood</span>: <span class="hljs-string">&quot;Rogers&quot;</span>,
    <span class="hljs-attr">rent_controlled</span>: <span class="hljs-number">2</span>,
    <span class="hljs-attr">prop_class_code</span>: <span class="hljs-string">&quot;ABC&quot;</span>,
    <span class="hljs-attr">zone</span>: <span class="hljs-string">&quot;ProZone&quot;</span>,
    <span class="hljs-attr">stories</span>: <span class="hljs-number">13</span>,
    <span class="hljs-attr">units</span>: <span class="hljs-number">20</span>,
    <span class="hljs-attr">rooms</span>: <span class="hljs-number">21</span>,
    <span class="hljs-attr">beds</span>: <span class="hljs-number">19</span>,
    <span class="hljs-attr">assess_land_val</span>: <span class="hljs-number">2349</span>,
    <span class="hljs-attr">assess_imp_val</span>: <span class="hljs-number">4821</span>,
    <span class="hljs-attr">assess_val_date</span>: <span class="hljs-string">&quot;123169&quot;</span>,
    <span class="hljs-attr">update_date</span>: <span class="hljs-string">&quot;010170&quot;</span>,
    <span class="hljs-attr">curr_sales_price</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">curr_sales_date</span>: <span class="hljs-string">&quot;010270&quot;</span>,
    <span class="hljs-attr">parc_start_no</span>: <span class="hljs-number">4200</span>,
    <span class="hljs-attr">parc_street_name</span>: <span class="hljs-string">&quot;Boogie Down&quot;</span>,
    <span class="hljs-attr">parc_street_type</span>: <span class="hljs-string">&quot;Lane&quot;</span>,
    <span class="hljs-attr">parc_unit_no</span>: <span class="hljs-string">&quot;26&quot;</span>,
    <span class="hljs-attr">parc_zip</span>: <span class="hljs-number">94110</span>
  }
};

<span class="hljs-comment">// obj representing the CYPHER query result to return in our mock unit test</span>
<span class="hljs-comment">// environment. to avoid running an entire neo4j database just to test</span>
<span class="hljs-comment">// getParcelDetails, we supply a mock queryHandler function to the code under</span>
<span class="hljs-comment">// test.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// this is the object the mock queryHandler will return.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// conforms to QueryProto.SFParcelDetailsQueryResult, see:</span>
<span class="hljs-comment">//   type_definitions/proto/query/query.proto.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span></span>
<span class="hljs-comment">// the resemblance to expected_response is coincidental. explanation:</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// as of 2021/03/22, the QueryProto and RestProto versions of the ParcelDetails</span>
<span class="hljs-comment">// response are equivalent. however, there&#x27;s no guarantee they will stay that</span>
<span class="hljs-comment">// way. for example, the RestProto may need to add new fields to meet evolving</span>
<span class="hljs-comment">// requirements for the UI, or the QueryProto may be revised to incorporate</span>
<span class="hljs-comment">// schema changes in the db.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// so, don&#x27;t write any code that assumes test_query_result will continue to</span>
<span class="hljs-comment">// resemble expected_response; rely on the schema checked into the codebase at</span>
<span class="hljs-comment">// type_definitions/proto.</span>
<span class="hljs-keyword">const</span> test_query_result = {
  <span class="hljs-attr">parcel_details</span>: {
    <span class="hljs-attr">yr_built</span>: <span class="hljs-number">1901</span>,
    <span class="hljs-attr">addr</span>: <span class="hljs-string">&quot;4200 Boogie Down Lane 26&quot;</span>,
    <span class="hljs-attr">block_lot</span>: <span class="hljs-string">&quot;P4RTY&quot;</span>,
    <span class="hljs-attr">lat</span>: <span class="hljs-number">26.8</span>,
    <span class="hljs-attr">long</span>: <span class="hljs-number">29.1</span>,
    <span class="hljs-attr">neighborhood</span>: <span class="hljs-string">&quot;Rogers&quot;</span>,
    <span class="hljs-attr">rent_controlled</span>: <span class="hljs-number">2</span>,
    <span class="hljs-attr">prop_class_code</span>: <span class="hljs-string">&quot;ABC&quot;</span>,
    <span class="hljs-attr">zone</span>: <span class="hljs-string">&quot;ProZone&quot;</span>,
    <span class="hljs-attr">stories</span>: <span class="hljs-number">13</span>,
    <span class="hljs-attr">units</span>: <span class="hljs-number">20</span>,
    <span class="hljs-attr">rooms</span>: <span class="hljs-number">21</span>,
    <span class="hljs-attr">beds</span>: <span class="hljs-number">19</span>,
    <span class="hljs-attr">assess_land_val</span>: <span class="hljs-number">2349</span>,
    <span class="hljs-attr">assess_imp_val</span>: <span class="hljs-number">4821</span>,
    <span class="hljs-attr">assess_val_date</span>: <span class="hljs-string">&quot;123169&quot;</span>,
    <span class="hljs-attr">update_date</span>: <span class="hljs-string">&quot;010170&quot;</span>,
    <span class="hljs-attr">curr_sales_price</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">curr_sales_date</span>: <span class="hljs-string">&quot;010270&quot;</span>,
    <span class="hljs-attr">parc_start_no</span>: <span class="hljs-number">4200</span>,
    <span class="hljs-attr">parc_street_name</span>: <span class="hljs-string">&quot;Boogie Down&quot;</span>,
    <span class="hljs-attr">parc_street_type</span>: <span class="hljs-string">&quot;Lane&quot;</span>,
    <span class="hljs-attr">parc_unit_no</span>: <span class="hljs-string">&quot;26&quot;</span>,
    <span class="hljs-attr">parc_zip</span>: <span class="hljs-number">94110</span>
  }
};


<span class="hljs-comment">// test the rest listener&#x27;s basic functionality.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> add tests for edge cases, ensure errors raised when appropriate, etc.</span>
<span class="hljs-title function_">describe</span>(<span class="hljs-string">&#x27;getParcelDetails tests&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) {
  <span class="hljs-title function_">it</span>(<span class="hljs-string">&#x27;pass through query result&#x27;</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) {
    <span class="hljs-comment">// set up mocks.</span>
    <span class="hljs-keyword">const</span> mocks = mockApp.<span class="hljs-title function_">expressMocks</span>();

    <span class="hljs-comment">// assemble a mock request. for this test, we&#x27;ll send a block_lot value</span>
    <span class="hljs-comment">// which matches the one in expected_response above.</span>
    mocks.<span class="hljs-property">req</span>.<span class="hljs-property">params</span>.<span class="hljs-property">block_lot</span> = <span class="hljs-string">&quot;P4RTY&quot;</span>;

    <span class="hljs-comment">// mock query handler callback.</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// note this is async in order to mimic the interface of the production</span>
    <span class="hljs-comment">// queryHandler fn as closely as possible. while it&#x27;s true that the test</span>
    <span class="hljs-comment">// would *run* without the async keyword, removing it would introduce</span>
    <span class="hljs-comment">// uncertainty into our test environment and would allow certain bugs to go</span>
    <span class="hljs-comment">// undetected.</span>
    mocks.<span class="hljs-property">req</span>.<span class="hljs-property">app</span>.<span class="hljs-property">locals</span>.<span class="hljs-property">queryHandlers</span>[<span class="hljs-string">&quot;parcelDetails&quot;</span>] =
      <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">app, search_string</span>) {
        <span class="hljs-comment">// confirm that the function under test properly passed &#x27;req.app&#x27;</span>
        <span class="hljs-comment">// through to the query handler.</span>
        assert.<span class="hljs-title function_">strictEqual</span>(app, mocks.<span class="hljs-property">req</span>.<span class="hljs-property">app</span>);

        <span class="hljs-comment">// we want to verify that the fn under test supplies the right</span>
        <span class="hljs-comment">// search_string value to the query handler.</span>
        mocks.<span class="hljs-property">actuals</span>.<span class="hljs-property">search_string</span> = search_string;  <span class="hljs-comment">// save for later assert.</span>
        <span class="hljs-keyword">return</span> test_query_result;
      };

    <span class="hljs-comment">// invoke code under test:</span>
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">getParcelDetails</span>(mocks.<span class="hljs-property">req</span>, mocks.<span class="hljs-property">resp</span>);

    <span class="hljs-comment">// verify results:</span>
    
    <span class="hljs-comment">// verify the desired http response code:</span>
    <span class="hljs-keyword">const</span> http_ok = <span class="hljs-number">200</span>;
    assert.<span class="hljs-title function_">strictEqual</span>(mocks.<span class="hljs-property">actuals</span>.<span class="hljs-property">response_code</span>, http_ok);

    <span class="hljs-comment">// confirm that the fn under test passed the right string to queryHandler:</span>
    <span class="hljs-keyword">const</span> expected_search_string = <span class="hljs-string">&quot;P4RTY&quot;</span>;
    assert.<span class="hljs-title function_">strictEqual</span>(mocks.<span class="hljs-property">actuals</span>.<span class="hljs-property">search_string</span>, expected_search_string);

    <span class="hljs-comment">// parse the actual response...</span>
    <span class="hljs-keyword">const</span> actual_response = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(mocks.<span class="hljs-property">actuals</span>.<span class="hljs-property">response_body</span>);

    <span class="hljs-comment">// ... and verify its schema (via proto definiton):</span>
    protoUtils.<span class="hljs-title function_">checkProto</span>(<span class="hljs-title class_">RestProto</span>.<span class="hljs-property">GetParcelDetailsResponse</span>, actual_response);

    <span class="hljs-comment">// finally, verify that the response obj contains the right data (meaning,</span>
    <span class="hljs-comment">// it represents the same encoded information as the expected resp. obj.)</span>
    protoTestUtils.<span class="hljs-title function_">assertProtoEquivalence</span>(
      <span class="hljs-title class_">RestProto</span>.<span class="hljs-property">GetParcelDetailsResponse</span>, expected_response, actual_response);
  });
});
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="servertestsample.test.js"><a href="#toc"><a name="server-test-sample-test-js">server/test/sample.test.js</a></a></h2>
<pre><code>var <span class="hljs-built_in">assert</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;assert&#x27;</span>);

describe(<span class="hljs-string">&#x27;Sample Test&#x27;</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
  it(<span class="hljs-string">&#x27;should test that true === true&#x27;</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
    <span class="hljs-built_in">assert</span>.equal(<span class="hljs-literal">true</span>, <span class="hljs-literal">true</span>);
  })
})
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="servertesttest_dataneighborhoodgetneighborhoodevictionstestdata.js"><a href="#toc"><a name="server-test-test_data-neighborhood-getneighborhoodevictionstestdata-js">server/test/test_data/neighborhood/getNeighborhoodEvictionsTestData.js</a></a></h2>
<pre><code><span class="hljs-comment">// Results using 3/31/21 V2.0 DB on &#x27;/v2/neighborhood/mission/evictions</span>

<span class="hljs-comment">// ** RESULTS TRUNCATED **</span>

<span class="hljs-keyword">const</span> query_results = [
  {
    <span class="hljs-string">&quot;evict_date&quot;</span>: <span class="hljs-string">&quot;20201028&quot;</span>,                                     <span class="hljs-comment">// = date of the eviction</span>
    <span class="hljs-string">&quot;evict_addr_orig&quot;</span>: <span class="hljs-string">&quot;1047 ALABAMA STREET (UNIT 610)&quot;</span>,          <span class="hljs-comment">// = original address listed on eviction petition</span>
    <span class="hljs-string">&quot;block_lot&quot;</span>: <span class="hljs-string">&quot;4149026&quot;</span>,                                       <span class="hljs-comment">// = block_lot of the parcel matched with eviction</span>
    <span class="hljs-string">&quot;match_quality&quot;</span>: {
      <span class="hljs-string">&quot;addr_match_method&quot;</span>: <span class="hljs-string">&quot;RANGE_ASSESSOR_ADDR_WO_UNIT&quot;</span>,         <span class="hljs-comment">// = the method used to match eviction to parcel (e.g. here</span>
                                                                  <span class="hljs-comment">//   we matched it to an address range (&quot;1045-1047&quot;) </span>
                                                                  <span class="hljs-comment">//   but did not match the unit</span>
      <span class="hljs-string">&quot;did_subdivision_occur&quot;</span>: <span class="hljs-string">&quot;NO_SUBDIVISION&quot;</span>                   <span class="hljs-comment">// = whether we determined that a subdivison occurred at this parcel</span>
    },
    <span class="hljs-string">&quot;evictor&quot;</span>: {
      <span class="hljs-string">&quot;extra_evictors&quot;</span>: [],                                       <span class="hljs-comment">// = any additional names found associated with the eviction,</span>
                                                                  <span class="hljs-comment">//   from the eviction petition itself</span>
      <span class="hljs-string">&quot;linked_be&quot;</span>: {},                                            <span class="hljs-comment">// = if the evictor is a business</span>
      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;QUAN,RAYMOND M TRUST&quot;</span>                              <span class="hljs-comment">// = name of the entity that owned the property at the time of the eviction</span>
    },
    <span class="hljs-string">&quot;units&quot;</span>: <span class="hljs-number">2</span>,                                                   <span class="hljs-comment">// = number of units at the parcel</span>
    <span class="hljs-string">&quot;addr&quot;</span>: <span class="hljs-string">&quot;1045-1047 ALABAMA ST&quot;</span>,                               <span class="hljs-comment">// = address of the property matched to eviction</span>
    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;Unapproved Subtenant&quot;</span>,                               <span class="hljs-comment">// = type of the eviction</span>
    <span class="hljs-string">&quot;evict_id&quot;</span>: <span class="hljs-string">&quot;M201540&quot;</span>,                                        <span class="hljs-comment">// = unique identifier for eviction</span>
    <span class="hljs-string">&quot;long&quot;</span>: <span class="hljs-number">-122.41092266872131</span>,                                  <span class="hljs-comment">// = longitude of the property&#x27;s center</span>
    <span class="hljs-string">&quot;num_other_parc&quot;</span>: <span class="hljs-number">1</span>,                                          <span class="hljs-comment">// = number of additional properties matched with the eviction</span>
    <span class="hljs-string">&quot;lat&quot;</span>: <span class="hljs-number">37.75513859125604</span>                                      <span class="hljs-comment">// = latitude of the property&#x27;s center</span>
  },
  {
    <span class="hljs-string">&quot;evict_date&quot;</span>: <span class="hljs-string">&quot;20201027&quot;</span>,
    <span class="hljs-string">&quot;evict_addr_orig&quot;</span>: <span class="hljs-string">&quot;270 Valencia Street, #205&quot;</span>,
    <span class="hljs-string">&quot;block_lot&quot;</span>: <span class="hljs-string">&quot;3533145&quot;</span>,
    <span class="hljs-string">&quot;match_quality&quot;</span>: {
      <span class="hljs-string">&quot;addr_match_method&quot;</span>: <span class="hljs-string">&quot;EXACT_ASSESSOR_ADDR_UNIT&quot;</span>,
      <span class="hljs-string">&quot;did_subdivision_occur&quot;</span>: <span class="hljs-string">&quot;SUBDIVISION_BEFORE_EVICTION&quot;</span>
    },
    <span class="hljs-string">&quot;evictor&quot;</span>: {
      <span class="hljs-string">&quot;extra_evictors&quot;</span>: [
        {
          <span class="hljs-string">&quot;evictor_name&quot;</span>: <span class="hljs-string">&quot;TIMOTHY SCHUMAN TRUSTEE OF THE BRUNO KOCHIS REVOCABLE TRUST OF 2018 DATED JANUARY 19 2018&quot;</span>,
          <span class="hljs-string">&quot;source&quot;</span>: <span class="hljs-string">&quot;ELLIS_PETITION&quot;</span>
        },
        {
          <span class="hljs-string">&quot;evictor_name&quot;</span>: <span class="hljs-string">&quot;BRUNO KOCHIS&quot;</span>,
          <span class="hljs-string">&quot;source&quot;</span>: <span class="hljs-string">&quot;ELLIS_PETITION&quot;</span>
        }
      ],
      <span class="hljs-string">&quot;linked_be&quot;</span>: {},
      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-literal">null</span>
    },
    <span class="hljs-string">&quot;units&quot;</span>: <span class="hljs-literal">null</span>,
    <span class="hljs-string">&quot;addr&quot;</span>: <span class="hljs-string">&quot;270 VALENCIA ST (UNIT 205)&quot;</span>,
    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;Buyout Agreement&quot;</span>,
    <span class="hljs-string">&quot;evict_id&quot;</span>: <span class="hljs-string">&quot;B200974A&quot;</span>,
    <span class="hljs-string">&quot;long&quot;</span>: <span class="hljs-number">-122.42259340493312</span>,
    <span class="hljs-string">&quot;num_other_parc&quot;</span>: <span class="hljs-number">1</span>,
    <span class="hljs-string">&quot;lat&quot;</span>: <span class="hljs-number">37.768520839210325</span>
  },
  {
    <span class="hljs-string">&quot;evict_date&quot;</span>: <span class="hljs-string">&quot;20201026&quot;</span>,
    <span class="hljs-string">&quot;evict_addr_orig&quot;</span>: <span class="hljs-string">&quot;66 BALMY STREET (UNIT 1010)&quot;</span>,
    <span class="hljs-string">&quot;block_lot&quot;</span>: <span class="hljs-string">&quot;6522027&quot;</span>,
    <span class="hljs-string">&quot;match_quality&quot;</span>: {
      <span class="hljs-string">&quot;addr_match_method&quot;</span>: <span class="hljs-string">&quot;GEO_INSIDE_UNIQUE&quot;</span>,
      <span class="hljs-string">&quot;did_subdivision_occur&quot;</span>: <span class="hljs-string">&quot;NO_SUBDIVISION&quot;</span>
    },
    <span class="hljs-string">&quot;evictor&quot;</span>: {
      <span class="hljs-string">&quot;extra_evictors&quot;</span>: [],
      <span class="hljs-string">&quot;linked_be&quot;</span>: {},
      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;AARTS OSCAR A&quot;</span>
    },
    <span class="hljs-string">&quot;units&quot;</span>: <span class="hljs-number">2</span>,
    <span class="hljs-string">&quot;addr&quot;</span>: <span class="hljs-string">&quot;1179 TREAT AVE&quot;</span>,
    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;Nuisance&quot;</span>,
    <span class="hljs-string">&quot;evict_id&quot;</span>: <span class="hljs-string">&quot;M201537&quot;</span>,
    <span class="hljs-string">&quot;long&quot;</span>: <span class="hljs-number">-122.41258374878501</span>,
    <span class="hljs-string">&quot;num_other_parc&quot;</span>: <span class="hljs-number">1</span>,
    <span class="hljs-string">&quot;lat&quot;</span>: <span class="hljs-number">37.751436512885725</span>
  },
  {
    <span class="hljs-string">&quot;evict_date&quot;</span>: <span class="hljs-string">&quot;20201019&quot;</span>,
    <span class="hljs-string">&quot;evict_addr_orig&quot;</span>: <span class="hljs-string">&quot;1417 VALENCIA STREET (UNIT UPSTAIRS)&quot;</span>,
    <span class="hljs-string">&quot;block_lot&quot;</span>: <span class="hljs-string">&quot;6530023&quot;</span>,
    <span class="hljs-string">&quot;match_quality&quot;</span>: {
      <span class="hljs-string">&quot;addr_match_method&quot;</span>: <span class="hljs-string">&quot;RANGE_ASSESSOR_ADDR_WO_UNIT&quot;</span>,
      <span class="hljs-string">&quot;did_subdivision_occur&quot;</span>: <span class="hljs-string">&quot;NO_SUBDIVISION&quot;</span>
    },
    <span class="hljs-string">&quot;evictor&quot;</span>: {
      <span class="hljs-string">&quot;extra_evictors&quot;</span>: [],
      <span class="hljs-string">&quot;linked_be&quot;</span>: {},
      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;MCAULIFFE,MICHAEL J&quot;</span>
    },
    <span class="hljs-string">&quot;units&quot;</span>: <span class="hljs-number">4</span>,
    <span class="hljs-string">&quot;addr&quot;</span>: <span class="hljs-string">&quot;1413-1419 VALENCIA ST&quot;</span>,
    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;Non-payment of Rent&quot;</span>,
    <span class="hljs-string">&quot;evict_id&quot;</span>: <span class="hljs-string">&quot;M201461&quot;</span>,
    <span class="hljs-string">&quot;long&quot;</span>: <span class="hljs-number">-122.42013083790363</span>,
    <span class="hljs-string">&quot;num_other_parc&quot;</span>: <span class="hljs-number">1</span>,
    <span class="hljs-string">&quot;lat&quot;</span>: <span class="hljs-number">37.750205777532884</span>
  },
  {
    <span class="hljs-string">&quot;evict_date&quot;</span>: <span class="hljs-string">&quot;20201019&quot;</span>,
    <span class="hljs-string">&quot;evict_addr_orig&quot;</span>: <span class="hljs-string">&quot;1413 VALENCIA STREET (UNIT UPSTAIRS)&quot;</span>,
    <span class="hljs-string">&quot;block_lot&quot;</span>: <span class="hljs-string">&quot;6530023&quot;</span>,
    <span class="hljs-string">&quot;match_quality&quot;</span>: {
      <span class="hljs-string">&quot;addr_match_method&quot;</span>: <span class="hljs-string">&quot;RANGE_ASSESSOR_ADDR_WO_UNIT&quot;</span>,
      <span class="hljs-string">&quot;did_subdivision_occur&quot;</span>: <span class="hljs-string">&quot;NO_SUBDIVISION&quot;</span>
    },
    <span class="hljs-string">&quot;evictor&quot;</span>: {
      <span class="hljs-string">&quot;extra_evictors&quot;</span>: [],
      <span class="hljs-string">&quot;linked_be&quot;</span>: {},
      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;MCAULIFFE,MICHAEL J&quot;</span>
    },
    <span class="hljs-string">&quot;units&quot;</span>: <span class="hljs-number">4</span>,
    <span class="hljs-string">&quot;addr&quot;</span>: <span class="hljs-string">&quot;1413-1419 VALENCIA ST&quot;</span>,
    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;Non-payment of Rent&quot;</span>,
    <span class="hljs-string">&quot;evict_id&quot;</span>: <span class="hljs-string">&quot;M201460&quot;</span>,
    <span class="hljs-string">&quot;long&quot;</span>: <span class="hljs-number">-122.42013083790363</span>,
    <span class="hljs-string">&quot;num_other_parc&quot;</span>: <span class="hljs-number">1</span>,
    <span class="hljs-string">&quot;lat&quot;</span>: <span class="hljs-number">37.750205777532884</span>
  },
  {
    <span class="hljs-string">&quot;evict_date&quot;</span>: <span class="hljs-string">&quot;20201019&quot;</span>,
    <span class="hljs-string">&quot;evict_addr_orig&quot;</span>: <span class="hljs-string">&quot;3661 19th Street&quot;</span>,
    <span class="hljs-string">&quot;block_lot&quot;</span>: <span class="hljs-string">&quot;3598075&quot;</span>,
    <span class="hljs-string">&quot;match_quality&quot;</span>: {
      <span class="hljs-string">&quot;addr_match_method&quot;</span>: <span class="hljs-string">&quot;EXACT_ASSESSOR_ADDR_WO_UNIT&quot;</span>,
      <span class="hljs-string">&quot;did_subdivision_occur&quot;</span>: <span class="hljs-string">&quot;NO_SUBDIVISION&quot;</span>
    },
    <span class="hljs-string">&quot;evictor&quot;</span>: {
      <span class="hljs-string">&quot;extra_evictors&quot;</span>: [
        {
          <span class="hljs-string">&quot;evictor_name&quot;</span>: <span class="hljs-string">&quot;JEFF POLLACK&quot;</span>,
          <span class="hljs-string">&quot;source&quot;</span>: <span class="hljs-string">&quot;ELLIS_PETITION&quot;</span>
        },
        {
          <span class="hljs-string">&quot;evictor_name&quot;</span>: <span class="hljs-string">&quot;JUSTIN A GOODMAN&quot;</span>,
          <span class="hljs-string">&quot;source&quot;</span>: <span class="hljs-string">&quot;ELLIS_PETITION&quot;</span>
        },
        {
          <span class="hljs-string">&quot;evictor_name&quot;</span>: <span class="hljs-string">&quot;RYAN C FONG&quot;</span>,
          <span class="hljs-string">&quot;source&quot;</span>: <span class="hljs-string">&quot;ELLIS_PETITION&quot;</span>
        },
        {
          <span class="hljs-string">&quot;evictor_name&quot;</span>: <span class="hljs-string">&quot;3661 19TH STREET LLC&quot;</span>,
          <span class="hljs-string">&quot;source&quot;</span>: <span class="hljs-string">&quot;ELLIS_PETITION&quot;</span>
        },
        {
          <span class="hljs-string">&quot;evictor_name&quot;</span>: <span class="hljs-string">&quot;VR INVESTMENTS LLC&quot;</span>,
          <span class="hljs-string">&quot;source&quot;</span>: <span class="hljs-string">&quot;ELLIS_PETITION&quot;</span>
        }
      ],
      <span class="hljs-string">&quot;linked_be&quot;</span>: {},
      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-literal">null</span>
    },
    <span class="hljs-string">&quot;units&quot;</span>: <span class="hljs-number">12</span>,
    <span class="hljs-string">&quot;addr&quot;</span>: <span class="hljs-string">&quot;3661 19TH ST&quot;</span>,
    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;Ellis Act Withdrawal&quot;</span>,
    <span class="hljs-string">&quot;evict_id&quot;</span>: <span class="hljs-string">&quot;L200981&quot;</span>,
    <span class="hljs-string">&quot;long&quot;</span>: <span class="hljs-number">-122.4248791909366</span>,
    <span class="hljs-string">&quot;num_other_parc&quot;</span>: <span class="hljs-number">1</span>,
    <span class="hljs-string">&quot;lat&quot;</span>: <span class="hljs-number">37.759647116404324</span>
  },
  {
    <span class="hljs-string">&quot;evict_date&quot;</span>: <span class="hljs-string">&quot;20201019&quot;</span>,
    <span class="hljs-string">&quot;evict_addr_orig&quot;</span>: <span class="hljs-string">&quot;1419 VALENCIA STREET (UNIT UPSTAIRS)&quot;</span>,
    <span class="hljs-string">&quot;block_lot&quot;</span>: <span class="hljs-string">&quot;6530023&quot;</span>,
    <span class="hljs-string">&quot;match_quality&quot;</span>: {
      <span class="hljs-string">&quot;addr_match_method&quot;</span>: <span class="hljs-string">&quot;RANGE_ASSESSOR_ADDR_WO_UNIT&quot;</span>,
      <span class="hljs-string">&quot;did_subdivision_occur&quot;</span>: <span class="hljs-string">&quot;NO_SUBDIVISION&quot;</span>
    },
    <span class="hljs-string">&quot;evictor&quot;</span>: {
      <span class="hljs-string">&quot;extra_evictors&quot;</span>: [],
      <span class="hljs-string">&quot;linked_be&quot;</span>: {},
      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;MCAULIFFE,MICHAEL J&quot;</span>
    },
    <span class="hljs-string">&quot;units&quot;</span>: <span class="hljs-number">4</span>,
    <span class="hljs-string">&quot;addr&quot;</span>: <span class="hljs-string">&quot;1413-1419 VALENCIA ST&quot;</span>,
    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;Non-payment of Rent&quot;</span>,
    <span class="hljs-string">&quot;evict_id&quot;</span>: <span class="hljs-string">&quot;M201462&quot;</span>,
    <span class="hljs-string">&quot;long&quot;</span>: <span class="hljs-number">-122.42013083790363</span>,
    <span class="hljs-string">&quot;num_other_parc&quot;</span>: <span class="hljs-number">1</span>,
    <span class="hljs-string">&quot;lat&quot;</span>: <span class="hljs-number">37.750205777532884</span>
  },
  {
    <span class="hljs-string">&quot;evict_date&quot;</span>: <span class="hljs-string">&quot;20201019&quot;</span>,
    <span class="hljs-string">&quot;evict_addr_orig&quot;</span>: <span class="hljs-string">&quot;1415 VALENCIA STREET (UNIT UPSTAIRS)&quot;</span>,
    <span class="hljs-string">&quot;block_lot&quot;</span>: <span class="hljs-string">&quot;6530023&quot;</span>,
    <span class="hljs-string">&quot;match_quality&quot;</span>: {
      <span class="hljs-string">&quot;addr_match_method&quot;</span>: <span class="hljs-string">&quot;RANGE_ASSESSOR_ADDR_WO_UNIT&quot;</span>,
      <span class="hljs-string">&quot;did_subdivision_occur&quot;</span>: <span class="hljs-string">&quot;NO_SUBDIVISION&quot;</span>
    },
    <span class="hljs-string">&quot;evictor&quot;</span>: {
      <span class="hljs-string">&quot;extra_evictors&quot;</span>: [],
      <span class="hljs-string">&quot;linked_be&quot;</span>: {},
      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;MCAULIFFE,MICHAEL J&quot;</span>
    },
    <span class="hljs-string">&quot;units&quot;</span>: <span class="hljs-number">4</span>,
    <span class="hljs-string">&quot;addr&quot;</span>: <span class="hljs-string">&quot;1413-1419 VALENCIA ST&quot;</span>,
    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;Non-payment of Rent&quot;</span>,
    <span class="hljs-string">&quot;evict_id&quot;</span>: <span class="hljs-string">&quot;M201463&quot;</span>,
    <span class="hljs-string">&quot;long&quot;</span>: <span class="hljs-number">-122.42013083790363</span>,
    <span class="hljs-string">&quot;num_other_parc&quot;</span>: <span class="hljs-number">1</span>,
    <span class="hljs-string">&quot;lat&quot;</span>: <span class="hljs-number">37.750205777532884</span>
  },
  {
    <span class="hljs-string">&quot;evict_date&quot;</span>: <span class="hljs-string">&quot;20201013&quot;</span>,
    <span class="hljs-string">&quot;evict_addr_orig&quot;</span>: <span class="hljs-string">&quot;1118 Shotwell Street&quot;</span>,
    <span class="hljs-string">&quot;block_lot&quot;</span>: <span class="hljs-string">&quot;6526002&quot;</span>,
    <span class="hljs-string">&quot;match_quality&quot;</span>: {
      <span class="hljs-string">&quot;addr_match_method&quot;</span>: <span class="hljs-string">&quot;RANGE_ASSESSOR_ADDR_WO_UNIT&quot;</span>,
      <span class="hljs-string">&quot;did_subdivision_occur&quot;</span>: <span class="hljs-string">&quot;NO_SUBDIVISION&quot;</span>
    },
    <span class="hljs-string">&quot;evictor&quot;</span>: {
      <span class="hljs-string">&quot;extra_evictors&quot;</span>: [],
      <span class="hljs-string">&quot;linked_be&quot;</span>: {
        <span class="hljs-string">&quot;network_id&quot;</span>: <span class="hljs-number">851561</span>,
        <span class="hljs-string">&quot;__typename&quot;</span>: <span class="hljs-string">&quot;SOS_LP&quot;</span>
      },
      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;1112 SHOTWELL LLC&quot;</span>
    },
    <span class="hljs-string">&quot;units&quot;</span>: <span class="hljs-number">5</span>,
    <span class="hljs-string">&quot;addr&quot;</span>: <span class="hljs-string">&quot;1112-1118 SHOTWELL ST&quot;</span>,
    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;Buyout Agreement&quot;</span>,
    <span class="hljs-string">&quot;evict_id&quot;</span>: <span class="hljs-string">&quot;B201024A&quot;</span>,
    <span class="hljs-string">&quot;long&quot;</span>: <span class="hljs-number">-122.41528348304611</span>,
    <span class="hljs-string">&quot;num_other_parc&quot;</span>: <span class="hljs-number">1</span>,
    <span class="hljs-string">&quot;lat&quot;</span>: <span class="hljs-number">37.75047097864885</span>
  },
  {
    <span class="hljs-string">&quot;evict_date&quot;</span>: <span class="hljs-string">&quot;20201009&quot;</span>,
    <span class="hljs-string">&quot;evict_addr_orig&quot;</span>: <span class="hljs-string">&quot;1732 Bryant Street&quot;</span>,
    <span class="hljs-string">&quot;block_lot&quot;</span>: <span class="hljs-string">&quot;3965006&quot;</span>,
    <span class="hljs-string">&quot;match_quality&quot;</span>: {
      <span class="hljs-string">&quot;addr_match_method&quot;</span>: <span class="hljs-string">&quot;RANGE_ASSESSOR_ADDR_WO_UNIT&quot;</span>,
      <span class="hljs-string">&quot;did_subdivision_occur&quot;</span>: <span class="hljs-string">&quot;NO_SUBDIVISION&quot;</span>
    },
    <span class="hljs-string">&quot;evictor&quot;</span>: {
      <span class="hljs-string">&quot;extra_evictors&quot;</span>: [],
      <span class="hljs-string">&quot;linked_be&quot;</span>: {
        <span class="hljs-string">&quot;network_id&quot;</span>: <span class="hljs-number">15506</span>,
        <span class="hljs-string">&quot;__typename&quot;</span>: <span class="hljs-string">&quot;SOS_LP&quot;</span>
      },
      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;GOLDEN PROPERTIES LLC&quot;</span>
    },
    <span class="hljs-string">&quot;units&quot;</span>: <span class="hljs-number">3</span>,
    <span class="hljs-string">&quot;addr&quot;</span>: <span class="hljs-string">&quot;1730-1734 BRYANT ST&quot;</span>,
    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;Buyout Agreement&quot;</span>,
    <span class="hljs-string">&quot;evict_id&quot;</span>: <span class="hljs-string">&quot;B201447A&quot;</span>,
    <span class="hljs-string">&quot;long&quot;</span>: <span class="hljs-number">-122.41073223513439</span>,
    <span class="hljs-string">&quot;num_other_parc&quot;</span>: <span class="hljs-number">1</span>,
    <span class="hljs-string">&quot;lat&quot;</span>: <span class="hljs-number">37.76489681364738</span>
  }
];</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="servertesttest_datanetworkgetnetworkdetailstestdata.js"><a href="#toc"><a name="server-test-test_data-network-getnetworkdetailstestdata-js">server/test/test_data/network/getNetworkDetailsTestData.js</a></a></h2>
<pre><code><span class="hljs-comment">// Results using 3/31/21 V2.0 DB on &#x27;/v2/network/115935/details</span>

<span class="hljs-keyword">const</span> query_results = {
  <span class="hljs-string">&quot;top_bes&quot;</span>: [                                                <span class="hljs-comment">// list of most connected businesses in the network</span>
    {
      <span class="hljs-string">&quot;__typename&quot;</span>: <span class="hljs-string">&quot;SOS_LP&quot;</span>,
      <span class="hljs-string">&quot;name_norm&quot;</span>: <span class="hljs-string">&quot;SF URBAN POOL I SUB GP LLC&quot;</span>
    },
    {
      <span class="hljs-string">&quot;__typename&quot;</span>: <span class="hljs-string">&quot;SOS_LP&quot;</span>,
      <span class="hljs-string">&quot;name_norm&quot;</span>: <span class="hljs-string">&quot;URBAN GREEN INVESTMENTS II LLC&quot;</span>
    },
    {
      <span class="hljs-string">&quot;__typename&quot;</span>: <span class="hljs-string">&quot;SOS_LP&quot;</span>,
      <span class="hljs-string">&quot;name_norm&quot;</span>: <span class="hljs-string">&quot;PACIFIC BRIDGE GROUP LLC&quot;</span>
    },
    {
      <span class="hljs-string">&quot;__typename&quot;</span>: <span class="hljs-string">&quot;SOS_LP&quot;</span>,
      <span class="hljs-string">&quot;name_norm&quot;</span>: <span class="hljs-string">&quot;URBAN GREEN INVESTMENTS LLC&quot;</span>
    },
    {
      <span class="hljs-string">&quot;__typename&quot;</span>: <span class="hljs-string">&quot;SOS_LP&quot;</span>,
      <span class="hljs-string">&quot;name_norm&quot;</span>: <span class="hljs-string">&quot;URBAN GREEN INVESTMENTS III LLC&quot;</span>
    }
  ],
  <span class="hljs-string">&quot;top_addrs&quot;</span>: [                                              <span class="hljs-comment">// list of most connected addresses in the network</span>
    {
      <span class="hljs-string">&quot;addr_readable&quot;</span>: <span class="hljs-string">&quot;1746 UNION ST SAN FRANCISCO CA&quot;</span>
    },
    {
      <span class="hljs-string">&quot;addr_readable&quot;</span>: <span class="hljs-string">&quot;1746 UNION ST SAN FRANCISCO&quot;</span>
    },
    {
      <span class="hljs-string">&quot;addr_readable&quot;</span>: <span class="hljs-string">&quot;3053 FILLMORE ST SAN FRANCISCO 248&quot;</span>
    },
    {
      <span class="hljs-string">&quot;addr_readable&quot;</span>: <span class="hljs-string">&quot;11001 W 120TH AVE BROOMFIELD CO STE 310&quot;</span>
    }
  ],
  <span class="hljs-string">&quot;total_bes&quot;</span>: <span class="hljs-number">122</span>,                                          <span class="hljs-comment">// total businesses in the network</span>
  <span class="hljs-string">&quot;top_owners&quot;</span>: [                                            <span class="hljs-comment">// list of most connected business owners in the network</span>
    {
      <span class="hljs-string">&quot;name_norm&quot;</span>: <span class="hljs-string">&quot;URBAN GREEN INVESTMENTS&quot;</span>
    },
    {
      <span class="hljs-string">&quot;name_norm&quot;</span>: <span class="hljs-string">&quot;DAVID MCCLOSKEY&quot;</span>
    },
    {
      <span class="hljs-string">&quot;name_norm&quot;</span>: <span class="hljs-string">&quot;URBAN GREEN INVESTMENTS II&quot;</span>
    },
    {
      <span class="hljs-string">&quot;name_norm&quot;</span>: <span class="hljs-string">&quot;DAVID P MCCLOSKEY&quot;</span>
    },
    {
      <span class="hljs-string">&quot;name_norm&quot;</span>: <span class="hljs-string">&quot;THOMAS MCCLOSKEY&quot;</span>
    }
  ]
};</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="servertesttest_datanetworkgetnetworkgraphtestdata.js"><a href="#toc"><a name="server-test-test_data-network-getnetworkgraphtestdata-js">server/test/test_data/network/getNetworkGraphTestData.js</a></a></h2>
<pre><code><span class="hljs-comment">// Results using 3/31/21 V2.0 DB on &#x27;/v2/network/115935/graph</span>

<span class="hljs-comment">// ** RESULTS TRUNCATED ** </span>

<span class="hljs-keyword">const</span> query_results = {
  <span class="hljs-string">&quot;network_subgraph&quot;</span>: [
    {
      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;LISTED_AT&quot;</span>,
      <span class="hljs-string">&quot;start&quot;</span>: {
        <span class="hljs-string">&quot;identity&quot;</span>: <span class="hljs-number">1473511</span>,
        <span class="hljs-string">&quot;labels&quot;</span>: [
          <span class="hljs-string">&quot;SOS_LP&quot;</span>
        ],
        <span class="hljs-string">&quot;properties&quot;</span>: {
          <span class="hljs-string">&quot;agent_name&quot;</span>: <span class="hljs-string">&quot;DAVID MCCLOSKEY&quot;</span>,
          <span class="hljs-string">&quot;agent_address_1&quot;</span>: <span class="hljs-string">&quot;1746 UNION STREET&quot;</span>,
          <span class="hljs-string">&quot;jurisdiction_llc&quot;</span>: <span class="hljs-string">&quot;CA&quot;</span>,
          <span class="hljs-string">&quot;agent_zip&quot;</span>: <span class="hljs-string">&quot;94123&quot;</span>,
          <span class="hljs-string">&quot;jurisdiction&quot;</span>: <span class="hljs-string">&quot;CA&quot;</span>,
          <span class="hljs-string">&quot;file_number&quot;</span>: <span class="hljs-string">&quot;201905710442&quot;</span>,
          <span class="hljs-string">&quot;file_date&quot;</span>: <span class="hljs-string">&quot;20190221&quot;</span>,
          <span class="hljs-string">&quot;network_id&quot;</span>: <span class="hljs-number">115935</span>,
          <span class="hljs-string">&quot;name_norm&quot;</span>: <span class="hljs-string">&quot;DUDLEY VINEYARDS LLC&quot;</span>,
          <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;DUDLEY VINEYARDS LLC&quot;</span>,
          <span class="hljs-string">&quot;agent_state&quot;</span>: <span class="hljs-string">&quot;CA&quot;</span>,
          <span class="hljs-string">&quot;agent_city&quot;</span>: <span class="hljs-string">&quot;SAN FRANCISCO&quot;</span>,
          <span class="hljs-string">&quot;llc_type_of_business&quot;</span>: <span class="hljs-string">&quot;WINERY&quot;</span>,
          <span class="hljs-string">&quot;filing_type&quot;</span>: <span class="hljs-string">&quot;D&quot;</span>,
          <span class="hljs-string">&quot;llc_management_code&quot;</span>: <span class="hljs-string">&quot;1&quot;</span>,
          <span class="hljs-string">&quot;status&quot;</span>: <span class="hljs-string">&quot;A&quot;</span>
        }
      },
      <span class="hljs-string">&quot;end&quot;</span>: {
        <span class="hljs-string">&quot;identity&quot;</span>: <span class="hljs-number">189787</span>,
        <span class="hljs-string">&quot;labels&quot;</span>: [
          <span class="hljs-string">&quot;Address_Unit&quot;</span>
        ],
        <span class="hljs-string">&quot;properties&quot;</span>: {
          <span class="hljs-string">&quot;rel_be_deg&quot;</span>: <span class="hljs-number">0.7592592592592593</span>,
          <span class="hljs-string">&quot;network_id&quot;</span>: <span class="hljs-number">115935</span>,
          <span class="hljs-string">&quot;addr&quot;</span>: <span class="hljs-string">&quot;|1746 UNION ST|SAN FRANCISCO|&quot;</span>,
          <span class="hljs-string">&quot;be_deg&quot;</span>: <span class="hljs-number">82</span>,
          <span class="hljs-string">&quot;addr_readable&quot;</span>: <span class="hljs-string">&quot;1746 UNION ST SAN FRANCISCO&quot;</span>
        }
      }
    },
    {
      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;LISTED_AT&quot;</span>,
      <span class="hljs-string">&quot;start&quot;</span>: {
        <span class="hljs-string">&quot;identity&quot;</span>: <span class="hljs-number">1476018</span>,
        <span class="hljs-string">&quot;labels&quot;</span>: [
          <span class="hljs-string">&quot;SOS_LP&quot;</span>
        ],
        <span class="hljs-string">&quot;properties&quot;</span>: {
          <span class="hljs-string">&quot;agent_name&quot;</span>: <span class="hljs-string">&quot;C T CORPORATION SYSTEM (C0168406)&quot;</span>,
          <span class="hljs-string">&quot;jurisdiction_llc&quot;</span>: <span class="hljs-string">&quot;CA&quot;</span>,
          <span class="hljs-string">&quot;jurisdiction&quot;</span>: <span class="hljs-string">&quot;CA&quot;</span>,
          <span class="hljs-string">&quot;file_number&quot;</span>: <span class="hljs-string">&quot;201903210301&quot;</span>,
          <span class="hljs-string">&quot;file_date&quot;</span>: <span class="hljs-string">&quot;20190129&quot;</span>,
          <span class="hljs-string">&quot;network_id&quot;</span>: <span class="hljs-number">115935</span>,
          <span class="hljs-string">&quot;name_norm&quot;</span>: <span class="hljs-string">&quot;UGI YL 23 LLC&quot;</span>,
          <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;UGI YL 23, LLC&quot;</span>,
          <span class="hljs-string">&quot;llc_type_of_business&quot;</span>: <span class="hljs-string">&quot;REAL ESTATE INVESTMENTS&quot;</span>,
          <span class="hljs-string">&quot;filing_type&quot;</span>: <span class="hljs-string">&quot;D&quot;</span>,
          <span class="hljs-string">&quot;llc_management_code&quot;</span>: <span class="hljs-string">&quot;1&quot;</span>,
          <span class="hljs-string">&quot;status&quot;</span>: <span class="hljs-string">&quot;C&quot;</span>
        }
      },
      <span class="hljs-string">&quot;end&quot;</span>: {
        <span class="hljs-string">&quot;identity&quot;</span>: <span class="hljs-number">189787</span>,
        <span class="hljs-string">&quot;labels&quot;</span>: [
          <span class="hljs-string">&quot;Address_Unit&quot;</span>
        ],
        <span class="hljs-string">&quot;properties&quot;</span>: {
          <span class="hljs-string">&quot;rel_be_deg&quot;</span>: <span class="hljs-number">0.7592592592592593</span>,
          <span class="hljs-string">&quot;network_id&quot;</span>: <span class="hljs-number">115935</span>,
          <span class="hljs-string">&quot;addr&quot;</span>: <span class="hljs-string">&quot;|1746 UNION ST|SAN FRANCISCO|&quot;</span>,
          <span class="hljs-string">&quot;be_deg&quot;</span>: <span class="hljs-number">82</span>,
          <span class="hljs-string">&quot;addr_readable&quot;</span>: <span class="hljs-string">&quot;1746 UNION ST SAN FRANCISCO&quot;</span>
        }
      }
    },
    {
      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;LISTED_AT&quot;</span>,
      <span class="hljs-string">&quot;start&quot;</span>: {
        <span class="hljs-string">&quot;identity&quot;</span>: <span class="hljs-number">1470917</span>,
        <span class="hljs-string">&quot;labels&quot;</span>: [
          <span class="hljs-string">&quot;SOS_LP&quot;</span>
        ],
        <span class="hljs-string">&quot;properties&quot;</span>: {
          <span class="hljs-string">&quot;agent_name&quot;</span>: <span class="hljs-string">&quot;JOHN A WARNER&quot;</span>,
          <span class="hljs-string">&quot;agent_address_1&quot;</span>: <span class="hljs-string">&quot;1746 UNION STREET&quot;</span>,
          <span class="hljs-string">&quot;jurisdiction_llc&quot;</span>: <span class="hljs-string">&quot;CA&quot;</span>,
          <span class="hljs-string">&quot;agent_zip&quot;</span>: <span class="hljs-string">&quot;94123&quot;</span>,
          <span class="hljs-string">&quot;jurisdiction&quot;</span>: <span class="hljs-string">&quot;CA&quot;</span>,
          <span class="hljs-string">&quot;file_number&quot;</span>: <span class="hljs-string">&quot;201828810386&quot;</span>,
          <span class="hljs-string">&quot;file_date&quot;</span>: <span class="hljs-string">&quot;20181010&quot;</span>,
          <span class="hljs-string">&quot;network_id&quot;</span>: <span class="hljs-number">115935</span>,
          <span class="hljs-string">&quot;name_norm&quot;</span>: <span class="hljs-string">&quot;UGI MADISON LLC&quot;</span>,
          <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;UGI MADISON, LLC&quot;</span>,
          <span class="hljs-string">&quot;agent_state&quot;</span>: <span class="hljs-string">&quot;CA&quot;</span>,
          <span class="hljs-string">&quot;agent_city&quot;</span>: <span class="hljs-string">&quot;SAN FRANCISCO&quot;</span>,
          <span class="hljs-string">&quot;llc_type_of_business&quot;</span>: <span class="hljs-string">&quot;REAL ESTATE INVESTMENTS&quot;</span>,
          <span class="hljs-string">&quot;filing_type&quot;</span>: <span class="hljs-string">&quot;D&quot;</span>,
          <span class="hljs-string">&quot;llc_management_code&quot;</span>: <span class="hljs-string">&quot;1&quot;</span>,
          <span class="hljs-string">&quot;status&quot;</span>: <span class="hljs-string">&quot;A&quot;</span>
        }
      },
      <span class="hljs-string">&quot;end&quot;</span>: {
        <span class="hljs-string">&quot;identity&quot;</span>: <span class="hljs-number">189787</span>,
        <span class="hljs-string">&quot;labels&quot;</span>: [
          <span class="hljs-string">&quot;Address_Unit&quot;</span>
        ],
        <span class="hljs-string">&quot;properties&quot;</span>: {
          <span class="hljs-string">&quot;rel_be_deg&quot;</span>: <span class="hljs-number">0.7592592592592593</span>,
          <span class="hljs-string">&quot;network_id&quot;</span>: <span class="hljs-number">115935</span>,
          <span class="hljs-string">&quot;addr&quot;</span>: <span class="hljs-string">&quot;|1746 UNION ST|SAN FRANCISCO|&quot;</span>,
          <span class="hljs-string">&quot;be_deg&quot;</span>: <span class="hljs-number">82</span>,
          <span class="hljs-string">&quot;addr_readable&quot;</span>: <span class="hljs-string">&quot;1746 UNION ST SAN FRANCISCO&quot;</span>
        }
      }
    }
  ]
};</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="servertesttest_datanetworkgetnetworknodestestdata.js"><a href="#toc"><a name="server-test-test_data-network-getnetworknodestestdata-js">server/test/test_data/network/getNetworkNodesTestData.js</a></a></h2>
<pre><code>// Results <span class="hljs-keyword">using</span> <span class="hljs-number">3</span>/<span class="hljs-number">31</span>/<span class="hljs-number">21</span> V2.<span class="hljs-number">0</span> DB <span class="hljs-keyword">on</span> &#x27;/v2/network/<span class="hljs-number">115935</span>/nodes/<span class="hljs-number">1</span>

<span class="hljs-keyword">const</span> query_results = {
  <span class="hljs-string">&quot;nodes&quot;</span>: [
    {
      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;1746 UNION ST SAN FRANCISCO CA&quot;</span>,
      <span class="hljs-string">&quot;degree&quot;</span>: <span class="hljs-number">111</span>,
      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;Address_Unit&quot;</span>
    },
    {
      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;1746 UNION ST SAN FRANCISCO&quot;</span>,
      <span class="hljs-string">&quot;degree&quot;</span>: <span class="hljs-number">83</span>,
      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;Address_Unit&quot;</span>
    },
    {
      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;URBAN GREEN INVESTMENTS&quot;</span>,
      <span class="hljs-string">&quot;degree&quot;</span>: <span class="hljs-number">42</span>,
      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;SOS_Owner&quot;</span>
    },
    {
      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;SF URBAN POOL I SUB GP LLC&quot;</span>,
      <span class="hljs-string">&quot;degree&quot;</span>: <span class="hljs-number">19</span>,
      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;SOS_LP&quot;</span>
    },
    {
      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;URBAN GREEN INVESTMENTS II LLC&quot;</span>,
      <span class="hljs-string">&quot;degree&quot;</span>: <span class="hljs-number">16</span>,
      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;SOS_LP&quot;</span>
    },
    {
      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;PACIFIC BRIDGE GROUP LLC&quot;</span>,
      <span class="hljs-string">&quot;degree&quot;</span>: <span class="hljs-number">15</span>,
      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;SOS_LP&quot;</span>
    },
    {
      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;3053 FILLMORE ST SAN FRANCISCO 248&quot;</span>,
      <span class="hljs-string">&quot;degree&quot;</span>: <span class="hljs-number">14</span>,
      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;Address_Unit&quot;</span>
    },
    {
      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;DAVID MCCLOSKEY&quot;</span>,
      <span class="hljs-string">&quot;degree&quot;</span>: <span class="hljs-number">12</span>,
      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;SOS_Owner&quot;</span>
    },
    {
      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;URBAN GREEN INVESTMENTS LLC&quot;</span>,
      <span class="hljs-string">&quot;degree&quot;</span>: <span class="hljs-number">11</span>,
      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;SOS_LP&quot;</span>
    },
    {
      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;URBAN GREEN INVESTMENTS III LLC&quot;</span>,
      <span class="hljs-string">&quot;degree&quot;</span>: <span class="hljs-number">10</span>,
      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;SOS_LP&quot;</span>
    }
  ]
};</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="servertesttest_datanetworkgetnetworkportfoliotestdata.js"><a href="#toc"><a name="server-test-test_data-network-getnetworkportfoliotestdata-js">server/test/test_data/network/getNetworkPortfolioTestData.js</a></a></h2>
<pre><code>// Results <span class="hljs-keyword">using</span> <span class="hljs-number">3</span>/<span class="hljs-number">31</span>/<span class="hljs-number">21</span> V2.<span class="hljs-number">0</span> DB <span class="hljs-keyword">on</span> &#x27;/v2/network/<span class="hljs-number">115935</span>/portfolio

<span class="hljs-keyword">const</span> query_results = [
  {
    <span class="hljs-string">&quot;num_evictions&quot;</span>: <span class="hljs-number">1</span>,
    <span class="hljs-string">&quot;owner_mailing_addr&quot;</span>: <span class="hljs-string">&quot;1746 UNION ST SAN FRANCISCO CA&quot;</span>,
    <span class="hljs-string">&quot;block_lot&quot;</span>: <span class="hljs-string">&quot;3502033&quot;</span>,
    <span class="hljs-string">&quot;owners&quot;</span>: [
      {
        <span class="hljs-string">&quot;owner_name&quot;</span>: <span class="hljs-string">&quot;49 GUERRERO STREET LLC&quot;</span>,
        <span class="hljs-string">&quot;linked_be&quot;</span>: {
          <span class="hljs-string">&quot;network_id&quot;</span>: <span class="hljs-number">115935</span>,
          <span class="hljs-string">&quot;__typename&quot;</span>: <span class="hljs-string">&quot;SOS_LP&quot;</span>
        }
      }
    ],
    <span class="hljs-string">&quot;neighborhood&quot;</span>: <span class="hljs-string">&quot;MISSION&quot;</span>,
    <span class="hljs-string">&quot;units&quot;</span>: <span class="hljs-number">3</span>,
    <span class="hljs-string">&quot;addr&quot;</span>: <span class="hljs-string">&quot;49-53 GUERRERO ST&quot;</span>,
    <span class="hljs-string">&quot;long&quot;</span>: -<span class="hljs-number">122.4243424695889</span>,
    <span class="hljs-string">&quot;lat&quot;</span>: <span class="hljs-number">37.770169030868104</span>
  },
  {
    <span class="hljs-string">&quot;num_evictions&quot;</span>: <span class="hljs-number">16</span>,
    <span class="hljs-string">&quot;owner_mailing_addr&quot;</span>: <span class="hljs-string">&quot;1746 UNION ST SAN FRANCISCO CA&quot;</span>,
    <span class="hljs-string">&quot;block_lot&quot;</span>: <span class="hljs-string">&quot;3552015&quot;</span>,
    <span class="hljs-string">&quot;owners&quot;</span>: [
      {
        <span class="hljs-string">&quot;owner_name&quot;</span>: <span class="hljs-string">&quot;2886 16TH STREET LLC&quot;</span>,
        <span class="hljs-string">&quot;linked_be&quot;</span>: {
          <span class="hljs-string">&quot;network_id&quot;</span>: <span class="hljs-number">115935</span>,
          <span class="hljs-string">&quot;__typename&quot;</span>: <span class="hljs-string">&quot;SOS_LP&quot;</span>
        }
      }
    ],
    <span class="hljs-string">&quot;neighborhood&quot;</span>: <span class="hljs-string">&quot;MISSION&quot;</span>,
    <span class="hljs-string">&quot;units&quot;</span>: <span class="hljs-number">14</span>,
    <span class="hljs-string">&quot;addr&quot;</span>: <span class="hljs-string">&quot;2886-2888 16TH ST&quot;</span>,
    <span class="hljs-string">&quot;long&quot;</span>: -<span class="hljs-number">122.41709006827266</span>,
    <span class="hljs-string">&quot;lat&quot;</span>: <span class="hljs-number">37.7654693184888</span>
  }
];</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="servertesttest_datanetworkgetnetworkrelatednetworkstestdata.js"><a href="#toc"><a name="server-test-test_data-network-getnetworkrelatednetworkstestdata-js">server/test/test_data/network/getNetworkRelatedNetworksTestData.js</a></a></h2>
<pre><code><span class="hljs-comment">// Results using 3/31/21 V2.0 DB on &#x27;/v2/network/115935/relatedNetworks</span>

<span class="hljs-keyword">const</span> query_results = [
  {                                                         <span class="hljs-comment">//   Each of these elements is a network that may be </span>
                                                            <span class="hljs-comment">//   related to 55 DOLORES STREET LLC&#x27;s network (Urban Green)</span>
    <span class="hljs-string">&quot;match_explanation&quot;</span>: {
      <span class="hljs-string">&quot;businesses_listed_at_addrs&quot;</span>: {                       <span class="hljs-comment">// = if non-null, means that there is a business in one network</span>
                                                            <span class="hljs-comment">//   that is listed at an office address in the other network</span>
        <span class="hljs-string">&quot;num_addrs&quot;</span>: <span class="hljs-number">3</span>,
        <span class="hljs-string">&quot;num_businesses&quot;</span>: <span class="hljs-number">4</span>
      },
      <span class="hljs-string">&quot;related_to_excluded&quot;</span>: <span class="hljs-literal">null</span>,                          <span class="hljs-comment">// = if non-null, means that there is a business or address we</span>
                                                            <span class="hljs-comment">//   found to be &quot;suspicious&quot; and removed from our network </span>
                                                            <span class="hljs-comment">//   connecting methodology, that connects the networks</span>

      <span class="hljs-string">&quot;similar_addresses&quot;</span>: <span class="hljs-literal">null</span>,                            <span class="hljs-comment">// = if non-null, means that there is another office in a building</span>
                                                            <span class="hljs-comment">//   associated with 55 Dolores St LLC&#x27;s network that is part of </span>
                                                            <span class="hljs-comment">//   this network </span>
      <span class="hljs-string">&quot;businesses_owning_parcels&quot;</span>: <span class="hljs-literal">null</span>,                    <span class="hljs-comment">// = if non-null, means that there is a business in one network</span>
                                                            <span class="hljs-comment">//   that is the property owner for a business in the other network</span>

      <span class="hljs-string">&quot;parcels_owned_by_same_non_business_owner&quot;</span>: <span class="hljs-literal">null</span>      <span class="hljs-comment">// = if non-null, means that there is a non-business property </span>
                                                            <span class="hljs-comment">//   owner that owns property in both networks</span>

    },
    <span class="hljs-string">&quot;network_description&quot;</span>: {
      <span class="hljs-string">&quot;network_id&quot;</span>: <span class="hljs-number">155047</span>,                                 <span class="hljs-comment">// = unique identifier for network</span>
      <span class="hljs-string">&quot;top_owner&quot;</span>: <span class="hljs-string">&quot;DONNA NOAH&quot;</span>,                            <span class="hljs-comment">// = most connected business owner in the network</span>
      <span class="hljs-string">&quot;top_addr&quot;</span>: <span class="hljs-string">&quot;141 ALPINE TER SAN FRANCISCO CA&quot;</span>,        <span class="hljs-comment">// = most connected address in the network</span>
      <span class="hljs-string">&quot;top_be&quot;</span>: <span class="hljs-string">&quot;GREENLINE VENTURES LLC&quot;</span>                    <span class="hljs-comment">// = most connected business in the network</span>
      <span class="hljs-string">&quot;num_parcels&quot;</span>: <span class="hljs-number">8</span>,                                     <span class="hljs-comment">// = total number of properties in the portfolio of this network</span>
      <span class="hljs-string">&quot;num_units&quot;</span>: <span class="hljs-number">50</span>                                       <span class="hljs-comment">// = total number of units in the portfolio of this network</span>
    }
  },
  {
    <span class="hljs-string">&quot;match_explanation&quot;</span>: {
      <span class="hljs-string">&quot;businesses_listed_at_addrs&quot;</span>: {
        <span class="hljs-string">&quot;num_addrs&quot;</span>: <span class="hljs-number">1</span>,
        <span class="hljs-string">&quot;num_businesses&quot;</span>: <span class="hljs-number">1</span>
      },
      <span class="hljs-string">&quot;related_to_excluded&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;similar_addresses&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;businesses_owning_parcels&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;parcels_owned_by_same_non_business_owner&quot;</span>: <span class="hljs-literal">null</span>
    },
    <span class="hljs-string">&quot;network_description&quot;</span>: {
      <span class="hljs-string">&quot;network_id&quot;</span>: <span class="hljs-number">1455665</span>,
      <span class="hljs-string">&quot;top_owner&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;top_addr&quot;</span>: <span class="hljs-string">&quot;3053 FILLMORE ST SAN FRANCISCO CA 228&quot;</span>,
      <span class="hljs-string">&quot;num_parcels&quot;</span>: <span class="hljs-number">2</span>,
      <span class="hljs-string">&quot;top_be&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;num_units&quot;</span>: <span class="hljs-number">8</span>
    }
  },
  {
    <span class="hljs-string">&quot;match_explanation&quot;</span>: {
      <span class="hljs-string">&quot;businesses_listed_at_addrs&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;related_to_excluded&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;similar_addresses&quot;</span>: {
        <span class="hljs-string">&quot;highest_similarity&quot;</span>: <span class="hljs-number">0</span>
      },
      <span class="hljs-string">&quot;businesses_owning_parcels&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;parcels_owned_by_same_non_business_owner&quot;</span>: <span class="hljs-literal">null</span>
    },
    <span class="hljs-string">&quot;network_description&quot;</span>: {
      <span class="hljs-string">&quot;network_id&quot;</span>: <span class="hljs-number">206769</span>,
      <span class="hljs-string">&quot;top_owner&quot;</span>: <span class="hljs-string">&quot;CHARLES LOUIS BATCHELDER&quot;</span>,
      <span class="hljs-string">&quot;top_addr&quot;</span>: <span class="hljs-string">&quot;3053 FILLMORE ST SAN FRANCISCO CA 121&quot;</span>,
      <span class="hljs-string">&quot;num_parcels&quot;</span>: <span class="hljs-number">2</span>,
      <span class="hljs-string">&quot;top_be&quot;</span>: <span class="hljs-string">&quot;AME SOEUR LLC&quot;</span>,
      <span class="hljs-string">&quot;num_units&quot;</span>: <span class="hljs-number">0</span>
    }
  },
  {
    <span class="hljs-string">&quot;match_explanation&quot;</span>: {
      <span class="hljs-string">&quot;businesses_listed_at_addrs&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;related_to_excluded&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;similar_addresses&quot;</span>: {
        <span class="hljs-string">&quot;highest_similarity&quot;</span>: <span class="hljs-number">0</span>
      },
      <span class="hljs-string">&quot;businesses_owning_parcels&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;parcels_owned_by_same_non_business_owner&quot;</span>: <span class="hljs-literal">null</span>
    },
    <span class="hljs-string">&quot;network_description&quot;</span>: {
      <span class="hljs-string">&quot;network_id&quot;</span>: <span class="hljs-number">89971</span>,
      <span class="hljs-string">&quot;top_owner&quot;</span>: <span class="hljs-string">&quot;NEAL MARGULIS&quot;</span>,
      <span class="hljs-string">&quot;top_addr&quot;</span>: <span class="hljs-string">&quot;660 MANZANITA WAY WOODSIDE CA&quot;</span>,
      <span class="hljs-string">&quot;num_parcels&quot;</span>: <span class="hljs-number">2</span>,
      <span class="hljs-string">&quot;top_be&quot;</span>: <span class="hljs-string">&quot;PIXONICS LLC&quot;</span>,
      <span class="hljs-string">&quot;num_units&quot;</span>: <span class="hljs-number">1</span>
    }
  },
  {
    <span class="hljs-string">&quot;match_explanation&quot;</span>: {
      <span class="hljs-string">&quot;businesses_listed_at_addrs&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;related_to_excluded&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;similar_addresses&quot;</span>: {
        <span class="hljs-string">&quot;highest_similarity&quot;</span>: <span class="hljs-number">0.2857142857142857</span>
      },
      <span class="hljs-string">&quot;businesses_owning_parcels&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;parcels_owned_by_same_non_business_owner&quot;</span>: <span class="hljs-literal">null</span>
    },
    <span class="hljs-string">&quot;network_description&quot;</span>: {
      <span class="hljs-string">&quot;network_id&quot;</span>: <span class="hljs-number">129508</span>,
      <span class="hljs-string">&quot;top_owner&quot;</span>: <span class="hljs-string">&quot;ADRIAN STANWAY&quot;</span>,
      <span class="hljs-string">&quot;top_addr&quot;</span>: <span class="hljs-string">&quot;3053 FILLMORE ST SAN FRANCISCO CA STE 240&quot;</span>,
      <span class="hljs-string">&quot;num_parcels&quot;</span>: <span class="hljs-number">1</span>,
      <span class="hljs-string">&quot;top_be&quot;</span>: <span class="hljs-string">&quot;PRESENT PARTNERSHIP MANAGER LLC&quot;</span>,
      <span class="hljs-string">&quot;num_units&quot;</span>: <span class="hljs-number">1</span>
    }
  },
  {
    <span class="hljs-string">&quot;match_explanation&quot;</span>: {
      <span class="hljs-string">&quot;businesses_listed_at_addrs&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;related_to_excluded&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;similar_addresses&quot;</span>: {
        <span class="hljs-string">&quot;highest_similarity&quot;</span>: <span class="hljs-number">0.6666666666666666</span>
      },
      <span class="hljs-string">&quot;businesses_owning_parcels&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;parcels_owned_by_same_non_business_owner&quot;</span>: <span class="hljs-literal">null</span>
    },
    <span class="hljs-string">&quot;network_description&quot;</span>: {
      <span class="hljs-string">&quot;network_id&quot;</span>: <span class="hljs-number">142253</span>,
      <span class="hljs-string">&quot;top_owner&quot;</span>: <span class="hljs-string">&quot;TIM LITTLEFIELD&quot;</span>,
      <span class="hljs-string">&quot;top_addr&quot;</span>: <span class="hljs-string">&quot;2165 BEACH ST SAN FRANCISCO CA STE 2&quot;</span>,
      <span class="hljs-string">&quot;num_parcels&quot;</span>: <span class="hljs-number">1</span>,
      <span class="hljs-string">&quot;top_be&quot;</span>: <span class="hljs-string">&quot;ASIA AWAITS LLC&quot;</span>,
      <span class="hljs-string">&quot;num_units&quot;</span>: <span class="hljs-number">1</span>
    }
  },
  {
    <span class="hljs-string">&quot;match_explanation&quot;</span>: {
      <span class="hljs-string">&quot;businesses_listed_at_addrs&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;related_to_excluded&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;similar_addresses&quot;</span>: {
        <span class="hljs-string">&quot;highest_similarity&quot;</span>: <span class="hljs-number">0.3333333333333333</span>
      },
      <span class="hljs-string">&quot;businesses_owning_parcels&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;parcels_owned_by_same_non_business_owner&quot;</span>: <span class="hljs-literal">null</span>
    },
    <span class="hljs-string">&quot;network_description&quot;</span>: {
      <span class="hljs-string">&quot;network_id&quot;</span>: <span class="hljs-number">23223</span>,
      <span class="hljs-string">&quot;top_owner&quot;</span>: <span class="hljs-string">&quot;DENNIS PIERCE&quot;</span>,
      <span class="hljs-string">&quot;top_addr&quot;</span>: <span class="hljs-string">&quot;3610 CINCINNATI AVE ROCKLIN CA&quot;</span>,
      <span class="hljs-string">&quot;num_parcels&quot;</span>: <span class="hljs-number">1</span>,
      <span class="hljs-string">&quot;top_be&quot;</span>: <span class="hljs-string">&quot;TEXMEX TALES LLC&quot;</span>,
      <span class="hljs-string">&quot;num_units&quot;</span>: <span class="hljs-number">0</span>
    }
  },
  {
    <span class="hljs-string">&quot;match_explanation&quot;</span>: {
      <span class="hljs-string">&quot;businesses_listed_at_addrs&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;related_to_excluded&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;similar_addresses&quot;</span>: {
        <span class="hljs-string">&quot;highest_similarity&quot;</span>: <span class="hljs-number">0</span>
      },
      <span class="hljs-string">&quot;businesses_owning_parcels&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;parcels_owned_by_same_non_business_owner&quot;</span>: <span class="hljs-literal">null</span>
    },
    <span class="hljs-string">&quot;network_description&quot;</span>: {
      <span class="hljs-string">&quot;network_id&quot;</span>: <span class="hljs-number">88360</span>,
      <span class="hljs-string">&quot;top_owner&quot;</span>: <span class="hljs-string">&quot;ROB TOOKOIAN&quot;</span>,
      <span class="hljs-string">&quot;top_addr&quot;</span>: <span class="hljs-string">&quot;2520 W MAGILL AVE FRESNO CA&quot;</span>,
      <span class="hljs-string">&quot;num_parcels&quot;</span>: <span class="hljs-number">1</span>,
      <span class="hljs-string">&quot;top_be&quot;</span>: <span class="hljs-string">&quot;1800 FILBERT LLC&quot;</span>,
      <span class="hljs-string">&quot;num_units&quot;</span>: <span class="hljs-number">1</span>
    }
  },
  {
    <span class="hljs-string">&quot;match_explanation&quot;</span>: {
      <span class="hljs-string">&quot;businesses_listed_at_addrs&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;related_to_excluded&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;similar_addresses&quot;</span>: {
        <span class="hljs-string">&quot;highest_similarity&quot;</span>: <span class="hljs-number">0.3333333333333333</span>
      },
      <span class="hljs-string">&quot;businesses_owning_parcels&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;parcels_owned_by_same_non_business_owner&quot;</span>: <span class="hljs-literal">null</span>
    },
    <span class="hljs-string">&quot;network_description&quot;</span>: {
      <span class="hljs-string">&quot;network_id&quot;</span>: <span class="hljs-number">219046</span>,
      <span class="hljs-string">&quot;top_owner&quot;</span>: <span class="hljs-string">&quot;FRANK DREHER&quot;</span>,
      <span class="hljs-string">&quot;top_addr&quot;</span>: <span class="hljs-string">&quot;3053 FILLMORE ST SAN FRANCISCO CA 285&quot;</span>,
      <span class="hljs-string">&quot;num_parcels&quot;</span>: <span class="hljs-number">1</span>,
      <span class="hljs-string">&quot;top_be&quot;</span>: <span class="hljs-string">&quot;TOPALIX LLC&quot;</span>,
      <span class="hljs-string">&quot;num_units&quot;</span>: <span class="hljs-number">1</span>
    }
  },
  {
    <span class="hljs-string">&quot;match_explanation&quot;</span>: {
      <span class="hljs-string">&quot;businesses_listed_at_addrs&quot;</span>: {
        <span class="hljs-string">&quot;num_addrs&quot;</span>: <span class="hljs-number">1</span>,
        <span class="hljs-string">&quot;num_businesses&quot;</span>: <span class="hljs-number">1</span>
      },
      <span class="hljs-string">&quot;related_to_excluded&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;similar_addresses&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;businesses_owning_parcels&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;parcels_owned_by_same_non_business_owner&quot;</span>: <span class="hljs-literal">null</span>
    },
    <span class="hljs-string">&quot;network_description&quot;</span>: {
      <span class="hljs-string">&quot;network_id&quot;</span>: <span class="hljs-number">843542</span>,
      <span class="hljs-string">&quot;top_owner&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;top_addr&quot;</span>: <span class="hljs-string">&quot;109 ALPINE TER SAN FRANCISCO CA&quot;</span>,
      <span class="hljs-string">&quot;num_parcels&quot;</span>: <span class="hljs-number">1</span>,
      <span class="hljs-string">&quot;top_be&quot;</span>: <span class="hljs-string">&quot;STR CONCIERGE LLC&quot;</span>,
      <span class="hljs-string">&quot;num_units&quot;</span>: <span class="hljs-number">1</span>
    }
  },
  {
    <span class="hljs-string">&quot;match_explanation&quot;</span>: {
      <span class="hljs-string">&quot;businesses_listed_at_addrs&quot;</span>: {
        <span class="hljs-string">&quot;num_addrs&quot;</span>: <span class="hljs-number">3</span>,
        <span class="hljs-string">&quot;num_businesses&quot;</span>: <span class="hljs-number">5</span>
      },
      <span class="hljs-string">&quot;related_to_excluded&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;similar_addresses&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;businesses_owning_parcels&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;parcels_owned_by_same_non_business_owner&quot;</span>: <span class="hljs-literal">null</span>
    },
    <span class="hljs-string">&quot;network_description&quot;</span>: {
      <span class="hljs-string">&quot;network_id&quot;</span>: <span class="hljs-number">28150</span>,
      <span class="hljs-string">&quot;top_owner&quot;</span>: <span class="hljs-string">&quot;MARK POTTER&quot;</span>,
      <span class="hljs-string">&quot;top_addr&quot;</span>: <span class="hljs-string">&quot;1 POST OFFICE SQ BOSTON MA STE 3150&quot;</span>,
      <span class="hljs-string">&quot;num_parcels&quot;</span>: <span class="hljs-number">0</span>,
      <span class="hljs-string">&quot;top_be&quot;</span>: <span class="hljs-string">&quot;LA MULTI-FAMILY VENTURE I LLC&quot;</span>,
      <span class="hljs-string">&quot;num_units&quot;</span>: <span class="hljs-number">0</span>
    }
  },
  {
    <span class="hljs-string">&quot;match_explanation&quot;</span>: {
      <span class="hljs-string">&quot;businesses_listed_at_addrs&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;related_to_excluded&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;similar_addresses&quot;</span>: {
        <span class="hljs-string">&quot;highest_similarity&quot;</span>: <span class="hljs-number">0.3333333333333333</span>
      },
      <span class="hljs-string">&quot;businesses_owning_parcels&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;parcels_owned_by_same_non_business_owner&quot;</span>: <span class="hljs-literal">null</span>
    },
    <span class="hljs-string">&quot;network_description&quot;</span>: {
      <span class="hljs-string">&quot;network_id&quot;</span>: <span class="hljs-number">181762</span>,
      <span class="hljs-string">&quot;top_owner&quot;</span>: <span class="hljs-string">&quot;P VO&quot;</span>,
      <span class="hljs-string">&quot;top_addr&quot;</span>: <span class="hljs-string">&quot;3053 FILLMORE ST SAN FRANCISCO CA 263&quot;</span>,
      <span class="hljs-string">&quot;num_parcels&quot;</span>: <span class="hljs-number">0</span>,
      <span class="hljs-string">&quot;top_be&quot;</span>: <span class="hljs-string">&quot;GREEN STREET APARTMENTS LLC&quot;</span>,
      <span class="hljs-string">&quot;num_units&quot;</span>: <span class="hljs-number">0</span>
    }
  },
  {
    <span class="hljs-string">&quot;match_explanation&quot;</span>: {
      <span class="hljs-string">&quot;businesses_listed_at_addrs&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;related_to_excluded&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;similar_addresses&quot;</span>: {
        <span class="hljs-string">&quot;highest_similarity&quot;</span>: <span class="hljs-number">0.14285714285714285</span>
      },
      <span class="hljs-string">&quot;businesses_owning_parcels&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;parcels_owned_by_same_non_business_owner&quot;</span>: <span class="hljs-literal">null</span>
    },
    <span class="hljs-string">&quot;network_description&quot;</span>: {
      <span class="hljs-string">&quot;network_id&quot;</span>: <span class="hljs-number">178529</span>,
      <span class="hljs-string">&quot;top_owner&quot;</span>: <span class="hljs-string">&quot;CYNTHIA RUTTER&quot;</span>,
      <span class="hljs-string">&quot;top_addr&quot;</span>: <span class="hljs-string">&quot;3465 N PINES WAY, STE 104 #243 WILSON WY&quot;</span>,
      <span class="hljs-string">&quot;num_parcels&quot;</span>: <span class="hljs-number">0</span>,
      <span class="hljs-string">&quot;top_be&quot;</span>: <span class="hljs-string">&quot;1649 BEACH STREET LLC&quot;</span>,
      <span class="hljs-string">&quot;num_units&quot;</span>: <span class="hljs-number">0</span>
    }
  }
];</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="servertesttest_dataownergetownerdetailstestdata.js"><a href="#toc"><a name="server-test-test_data-owner-getownerdetailstestdata-js">server/test/test_data/owner/getOwnerDetailsTestData.js</a></a></h2>
<pre><code><span class="hljs-comment">// Results using 3/31/21 V2.0 DB on &#x27;/v2/owner/lp/55 DOLORES STREET LLC/details</span>

<span class="hljs-keyword">const</span> query_results = {
  <span class="hljs-string">&quot;be_details&quot;</span>: {
    <span class="hljs-string">&quot;agent_address_1&quot;</span>: <span class="hljs-string">&quot;1746 UNION ST&quot;</span>,
    <span class="hljs-string">&quot;agent_name&quot;</span>: <span class="hljs-string">&quot;JOHN WARNER&quot;</span>,
    <span class="hljs-string">&quot;agent_address_2&quot;</span>: <span class="hljs-literal">null</span>,
    <span class="hljs-string">&quot;jurisdiction_llc&quot;</span>: <span class="hljs-string">&quot;CA&quot;</span>,
    <span class="hljs-string">&quot;agent_zip&quot;</span>: <span class="hljs-string">&quot;94123&quot;</span>,
    <span class="hljs-string">&quot;jurisdiction&quot;</span>: <span class="hljs-string">&quot;CA&quot;</span>,
    <span class="hljs-string">&quot;file_number&quot;</span>: <span class="hljs-string">&quot;201229710018&quot;</span>,
    <span class="hljs-string">&quot;network_id&quot;</span>: <span class="hljs-number">115935</span>,
    <span class="hljs-string">&quot;file_date&quot;</span>: <span class="hljs-string">&quot;20121022&quot;</span>,
    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;55 DOLORES STREET, LLC&quot;</span>,
    <span class="hljs-string">&quot;agent_state&quot;</span>: <span class="hljs-string">&quot;CA&quot;</span>,
    <span class="hljs-string">&quot;agent_city&quot;</span>: <span class="hljs-string">&quot;SAN FRANCISCO&quot;</span>,
    <span class="hljs-string">&quot;filing_type&quot;</span>: <span class="hljs-string">&quot;Domestic Filing&quot;</span>,
    <span class="hljs-string">&quot;llc_type_of_business&quot;</span>: <span class="hljs-string">&quot;REAL ESTATE INVESTMENTS&quot;</span>,
    <span class="hljs-string">&quot;term&quot;</span>: <span class="hljs-literal">null</span>,
    <span class="hljs-string">&quot;llc_management_code&quot;</span>: <span class="hljs-string">&quot;One Manager&quot;</span>,
    <span class="hljs-string">&quot;status&quot;</span>: <span class="hljs-string">&quot;Active&quot;</span>
  }
};</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="servertesttest_dataownergetownerevictionstestdata.js"><a href="#toc"><a name="server-test-test_data-owner-getownerevictionstestdata-js">server/test/test_data/owner/getOwnerEvictionsTestData.js</a></a></h2>
<pre><code><span class="hljs-comment">// Results using 3/31/21 V2.0 DB on &#x27;/v2/owner/lp/55 DOLORES STREET LLC/evictions</span>

<span class="hljs-keyword">const</span> query_results = [
  {
    <span class="hljs-string">&quot;evict_date&quot;</span>: <span class="hljs-string">&quot;20130408&quot;</span>,                                     <span class="hljs-comment">// = date of the eviction</span>
    <span class="hljs-string">&quot;extra_evictors&quot;</span>: [
      {
        <span class="hljs-string">&quot;evictor_name&quot;</span>: <span class="hljs-string">&quot;ANDREW M ZACKS&quot;</span>,                         <span class="hljs-comment">// = additional name found associated with the eviction,</span>
                                                                  <span class="hljs-comment">//   from the eviction petition itself</span>
        <span class="hljs-string">&quot;source&quot;</span>: <span class="hljs-string">&quot;ELLIS_PETITION&quot;</span>                                <span class="hljs-comment">// = where the additional name came from</span>
      }
    ],
    <span class="hljs-string">&quot;evict_addr_orig&quot;</span>: <span class="hljs-string">&quot;55 Dolores Street&quot;</span>,                       <span class="hljs-comment">// = original address listed on eviction petition</span>
    <span class="hljs-string">&quot;location&quot;</span>: {                                                 <span class="hljs-comment">// = represents the location matched to this eviction (random selected if multiple matches)</span>
      <span class="hljs-string">&quot;block_lot&quot;</span>: <span class="hljs-string">&quot;3534026A&quot;</span>,                                    <span class="hljs-comment">// = block_lot of the parcel matched with eviction</span>
      <span class="hljs-string">&quot;neighborhood&quot;</span>: <span class="hljs-string">&quot;MISSION&quot;</span>,                                  <span class="hljs-comment">// = neighborhood of the property matched to eviction</span>
      <span class="hljs-string">&quot;num_other_parc&quot;</span>: <span class="hljs-number">0</span>,                                        <span class="hljs-comment">// = total number of other properties matched with the eviction</span>
      <span class="hljs-string">&quot;units&quot;</span>: <span class="hljs-number">6</span>,                                                 <span class="hljs-comment">// = number of units at the parcel</span>
      <span class="hljs-string">&quot;addr&quot;</span>: <span class="hljs-string">&quot;55 DOLORES ST&quot;</span>,                                    <span class="hljs-comment">// = address of the property matched to eviction</span>
      <span class="hljs-string">&quot;long&quot;</span>: <span class="hljs-number">-122.42628444438564</span>,                                <span class="hljs-comment">// = longitude of the property&#x27;s center</span>
      <span class="hljs-string">&quot;lat&quot;</span>: <span class="hljs-number">37.76831228232485</span>                                    <span class="hljs-comment">// = latitude of the property&#x27;s center</span>
    },
    <span class="hljs-string">&quot;match_quality&quot;</span>: {
      <span class="hljs-string">&quot;addr_match_method&quot;</span>: <span class="hljs-string">&quot;EXACT_ASSESSOR_ADDR_WO_UNIT&quot;</span>,         <span class="hljs-comment">// = the method used to match eviction to parcel (e.g. here</span>
                                                                  <span class="hljs-comment">//   we matched it to a single assessor address (&quot;55 DOLORES ST&quot;),</span>
                                                                  <span class="hljs-comment">//   rather than a range (e.g. &quot;1045-1047&quot;) but we did not match the unit</span>
      <span class="hljs-string">&quot;did_subdivision_occur&quot;</span>: <span class="hljs-string">&quot;NO_SUBDIVISION&quot;</span>                   <span class="hljs-comment">// = whether we determined that a subdivison occurred at this parcel</span>
    },
    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;Ellis Act Withdrawal&quot;</span>,                               <span class="hljs-comment">// = type of the eviction</span>
    <span class="hljs-string">&quot;evict_id&quot;</span>: <span class="hljs-string">&quot;L130542&quot;</span>                                         <span class="hljs-comment">// = unique identifier for eviction</span>
  }
];</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="servertesttest_dataownergetownerportfoliotestdata.js"><a href="#toc"><a name="server-test-test_data-owner-getownerportfoliotestdata-js">server/test/test_data/owner/getOwnerPortfolioTestData.js</a></a></h2>
<pre><code>// Results <span class="hljs-keyword">using</span> <span class="hljs-number">3</span>/<span class="hljs-number">31</span>/<span class="hljs-number">21</span> V2.<span class="hljs-number">0</span> DB <span class="hljs-keyword">on</span> &#x27;/v2/owner/lp/<span class="hljs-number">55</span> DOLORES STREET LLC/portfolio

<span class="hljs-keyword">const</span> query_results = {
  <span class="hljs-string">&quot;property_portfolio&quot;</span>: [
    {
      <span class="hljs-string">&quot;mailing_address&quot;</span>: <span class="hljs-string">&quot;1746 UNION ST SAN FRANCISCO CA&quot;</span>,
      <span class="hljs-string">&quot;num_evictions&quot;</span>: <span class="hljs-number">1</span>,
      <span class="hljs-string">&quot;block_lot&quot;</span>: <span class="hljs-string">&quot;3502033&quot;</span>,
      <span class="hljs-string">&quot;owners&quot;</span>: [
        {
          <span class="hljs-string">&quot;owner_name&quot;</span>: <span class="hljs-string">&quot;49 GUERRERO STREET LLC&quot;</span>,
          <span class="hljs-string">&quot;linked_be&quot;</span>: {
            <span class="hljs-string">&quot;network_id&quot;</span>: <span class="hljs-number">115935</span>,
            <span class="hljs-string">&quot;__typename&quot;</span>: <span class="hljs-string">&quot;SOS_LP&quot;</span>
          }
        }
      ],
      <span class="hljs-string">&quot;neighborhood&quot;</span>: <span class="hljs-string">&quot;MISSION&quot;</span>,
      <span class="hljs-string">&quot;units&quot;</span>: <span class="hljs-number">3</span>,
      <span class="hljs-string">&quot;addr&quot;</span>: <span class="hljs-string">&quot;49-53 GUERRERO ST&quot;</span>,
      <span class="hljs-string">&quot;long&quot;</span>: -<span class="hljs-number">122.4243424695889</span>,
      <span class="hljs-string">&quot;lat&quot;</span>: <span class="hljs-number">37.770169030868104</span>
    },
    {
      <span class="hljs-string">&quot;mailing_address&quot;</span>: <span class="hljs-string">&quot;1746 UNION ST SAN FRANCISCO CA&quot;</span>,
      <span class="hljs-string">&quot;num_evictions&quot;</span>: <span class="hljs-number">16</span>,
      <span class="hljs-string">&quot;block_lot&quot;</span>: <span class="hljs-string">&quot;3552015&quot;</span>,
      <span class="hljs-string">&quot;owners&quot;</span>: [
        {
          <span class="hljs-string">&quot;owner_name&quot;</span>: <span class="hljs-string">&quot;2886 16TH STREET LLC&quot;</span>,
          <span class="hljs-string">&quot;linked_be&quot;</span>: {
            <span class="hljs-string">&quot;network_id&quot;</span>: <span class="hljs-number">115935</span>,
            <span class="hljs-string">&quot;__typename&quot;</span>: <span class="hljs-string">&quot;SOS_LP&quot;</span>
          }
        }
      ],
      <span class="hljs-string">&quot;neighborhood&quot;</span>: <span class="hljs-string">&quot;MISSION&quot;</span>,
      <span class="hljs-string">&quot;units&quot;</span>: <span class="hljs-number">14</span>,
      <span class="hljs-string">&quot;addr&quot;</span>: <span class="hljs-string">&quot;2886-2888 16TH ST&quot;</span>,
      <span class="hljs-string">&quot;long&quot;</span>: -<span class="hljs-number">122.41709006827266</span>,
      <span class="hljs-string">&quot;lat&quot;</span>: <span class="hljs-number">37.7654693184888</span>
    }
  ]
};</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="servertesttest_dataownergetownerrelatednetworkstestdata.js"><a href="#toc"><a name="server-test-test_data-owner-getownerrelatednetworkstestdata-js">server/test/test_data/owner/getOwnerRelatedNetworksTestData.js</a></a></h2>
<pre><code><span class="hljs-comment">// Results using 3/31/21 V2.0 DB on &#x27;/v2/owner/lp/55 DOLORES STREET LLC/relatedNetworks</span>

<span class="hljs-comment">// See getNetworkRelatedNetworksTestData.js for description of fields here</span>

<span class="hljs-keyword">const</span> query_results = [
  {
    <span class="hljs-string">&quot;match_explanation&quot;</span>: {
      <span class="hljs-string">&quot;businesses_listed_at_addrs&quot;</span>: {
        <span class="hljs-string">&quot;num_addrs&quot;</span>: <span class="hljs-number">3</span>,
        <span class="hljs-string">&quot;num_businesses&quot;</span>: <span class="hljs-number">4</span>
      },
      <span class="hljs-string">&quot;related_to_excluded&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;similar_addresses&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;businesses_owning_parcels&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;parcels_owned_by_same_non_business_owner&quot;</span>: <span class="hljs-literal">null</span>
    },
    <span class="hljs-string">&quot;network_description&quot;</span>: {
      <span class="hljs-string">&quot;network_id&quot;</span>: <span class="hljs-number">155047</span>,
      <span class="hljs-string">&quot;top_owner&quot;</span>: <span class="hljs-string">&quot;DONNA NOAH&quot;</span>,
      <span class="hljs-string">&quot;top_addr&quot;</span>: <span class="hljs-string">&quot;141 ALPINE TER SAN FRANCISCO CA&quot;</span>,
      <span class="hljs-string">&quot;num_parcels&quot;</span>: <span class="hljs-number">8</span>,
      <span class="hljs-string">&quot;top_be&quot;</span>: <span class="hljs-string">&quot;GREENLINE VENTURES LLC&quot;</span>,
      <span class="hljs-string">&quot;num_units&quot;</span>: <span class="hljs-number">50</span>
    }
  },
  {
    <span class="hljs-string">&quot;match_explanation&quot;</span>: {
      <span class="hljs-string">&quot;businesses_listed_at_addrs&quot;</span>: {
        <span class="hljs-string">&quot;num_addrs&quot;</span>: <span class="hljs-number">1</span>,
        <span class="hljs-string">&quot;num_businesses&quot;</span>: <span class="hljs-number">1</span>
      },
      <span class="hljs-string">&quot;related_to_excluded&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;similar_addresses&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;businesses_owning_parcels&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;parcels_owned_by_same_non_business_owner&quot;</span>: <span class="hljs-literal">null</span>
    },
    <span class="hljs-string">&quot;network_description&quot;</span>: {
      <span class="hljs-string">&quot;network_id&quot;</span>: <span class="hljs-number">1455665</span>,
      <span class="hljs-string">&quot;top_owner&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;top_addr&quot;</span>: <span class="hljs-string">&quot;3053 FILLMORE ST SAN FRANCISCO CA 228&quot;</span>,
      <span class="hljs-string">&quot;num_parcels&quot;</span>: <span class="hljs-number">2</span>,
      <span class="hljs-string">&quot;top_be&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;num_units&quot;</span>: <span class="hljs-number">8</span>
    }
  },
  {
    <span class="hljs-string">&quot;match_explanation&quot;</span>: {
      <span class="hljs-string">&quot;businesses_listed_at_addrs&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;related_to_excluded&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;similar_addresses&quot;</span>: {
        <span class="hljs-string">&quot;highest_similarity&quot;</span>: <span class="hljs-number">0</span>
      },
      <span class="hljs-string">&quot;businesses_owning_parcels&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;parcels_owned_by_same_non_business_owner&quot;</span>: <span class="hljs-literal">null</span>
    },
    <span class="hljs-string">&quot;network_description&quot;</span>: {
      <span class="hljs-string">&quot;network_id&quot;</span>: <span class="hljs-number">206769</span>,
      <span class="hljs-string">&quot;top_owner&quot;</span>: <span class="hljs-string">&quot;CHARLES LOUIS BATCHELDER&quot;</span>,
      <span class="hljs-string">&quot;top_addr&quot;</span>: <span class="hljs-string">&quot;3053 FILLMORE ST SAN FRANCISCO CA 121&quot;</span>,
      <span class="hljs-string">&quot;num_parcels&quot;</span>: <span class="hljs-number">2</span>,
      <span class="hljs-string">&quot;top_be&quot;</span>: <span class="hljs-string">&quot;AME SOEUR LLC&quot;</span>,
      <span class="hljs-string">&quot;num_units&quot;</span>: <span class="hljs-number">0</span>
    }
  },
  {
    <span class="hljs-string">&quot;match_explanation&quot;</span>: {
      <span class="hljs-string">&quot;businesses_listed_at_addrs&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;related_to_excluded&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;similar_addresses&quot;</span>: {
        <span class="hljs-string">&quot;highest_similarity&quot;</span>: <span class="hljs-number">0</span>
      },
      <span class="hljs-string">&quot;businesses_owning_parcels&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;parcels_owned_by_same_non_business_owner&quot;</span>: <span class="hljs-literal">null</span>
    },
    <span class="hljs-string">&quot;network_description&quot;</span>: {
      <span class="hljs-string">&quot;network_id&quot;</span>: <span class="hljs-number">89971</span>,
      <span class="hljs-string">&quot;top_owner&quot;</span>: <span class="hljs-string">&quot;NEAL MARGULIS&quot;</span>,
      <span class="hljs-string">&quot;top_addr&quot;</span>: <span class="hljs-string">&quot;660 MANZANITA WAY WOODSIDE CA&quot;</span>,
      <span class="hljs-string">&quot;num_parcels&quot;</span>: <span class="hljs-number">2</span>,
      <span class="hljs-string">&quot;top_be&quot;</span>: <span class="hljs-string">&quot;PIXONICS LLC&quot;</span>,
      <span class="hljs-string">&quot;num_units&quot;</span>: <span class="hljs-number">1</span>
    }
  },
  {
    <span class="hljs-string">&quot;match_explanation&quot;</span>: {
      <span class="hljs-string">&quot;businesses_listed_at_addrs&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;related_to_excluded&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;similar_addresses&quot;</span>: {
        <span class="hljs-string">&quot;highest_similarity&quot;</span>: <span class="hljs-number">0.2857142857142857</span>
      },
      <span class="hljs-string">&quot;businesses_owning_parcels&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;parcels_owned_by_same_non_business_owner&quot;</span>: <span class="hljs-literal">null</span>
    },
    <span class="hljs-string">&quot;network_description&quot;</span>: {
      <span class="hljs-string">&quot;network_id&quot;</span>: <span class="hljs-number">129508</span>,
      <span class="hljs-string">&quot;top_owner&quot;</span>: <span class="hljs-string">&quot;ADRIAN STANWAY&quot;</span>,
      <span class="hljs-string">&quot;top_addr&quot;</span>: <span class="hljs-string">&quot;3053 FILLMORE ST SAN FRANCISCO CA STE 240&quot;</span>,
      <span class="hljs-string">&quot;num_parcels&quot;</span>: <span class="hljs-number">1</span>,
      <span class="hljs-string">&quot;top_be&quot;</span>: <span class="hljs-string">&quot;PRESENT PARTNERSHIP MANAGER LLC&quot;</span>,
      <span class="hljs-string">&quot;num_units&quot;</span>: <span class="hljs-number">1</span>
    }
  },
  {
    <span class="hljs-string">&quot;match_explanation&quot;</span>: {
      <span class="hljs-string">&quot;businesses_listed_at_addrs&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;related_to_excluded&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;similar_addresses&quot;</span>: {
        <span class="hljs-string">&quot;highest_similarity&quot;</span>: <span class="hljs-number">0.6666666666666666</span>
      },
      <span class="hljs-string">&quot;businesses_owning_parcels&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;parcels_owned_by_same_non_business_owner&quot;</span>: <span class="hljs-literal">null</span>
    },
    <span class="hljs-string">&quot;network_description&quot;</span>: {
      <span class="hljs-string">&quot;network_id&quot;</span>: <span class="hljs-number">142253</span>,
      <span class="hljs-string">&quot;top_owner&quot;</span>: <span class="hljs-string">&quot;TIM LITTLEFIELD&quot;</span>,
      <span class="hljs-string">&quot;top_addr&quot;</span>: <span class="hljs-string">&quot;2165 BEACH ST SAN FRANCISCO CA STE 2&quot;</span>,
      <span class="hljs-string">&quot;num_parcels&quot;</span>: <span class="hljs-number">1</span>,
      <span class="hljs-string">&quot;top_be&quot;</span>: <span class="hljs-string">&quot;ASIA AWAITS LLC&quot;</span>,
      <span class="hljs-string">&quot;num_units&quot;</span>: <span class="hljs-number">1</span>
    }
  },
  {
    <span class="hljs-string">&quot;match_explanation&quot;</span>: {
      <span class="hljs-string">&quot;businesses_listed_at_addrs&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;related_to_excluded&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;similar_addresses&quot;</span>: {
        <span class="hljs-string">&quot;highest_similarity&quot;</span>: <span class="hljs-number">0.3333333333333333</span>
      },
      <span class="hljs-string">&quot;businesses_owning_parcels&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;parcels_owned_by_same_non_business_owner&quot;</span>: <span class="hljs-literal">null</span>
    },
    <span class="hljs-string">&quot;network_description&quot;</span>: {
      <span class="hljs-string">&quot;network_id&quot;</span>: <span class="hljs-number">23223</span>,
      <span class="hljs-string">&quot;top_owner&quot;</span>: <span class="hljs-string">&quot;DENNIS PIERCE&quot;</span>,
      <span class="hljs-string">&quot;top_addr&quot;</span>: <span class="hljs-string">&quot;3610 CINCINNATI AVE ROCKLIN CA&quot;</span>,
      <span class="hljs-string">&quot;num_parcels&quot;</span>: <span class="hljs-number">1</span>,
      <span class="hljs-string">&quot;top_be&quot;</span>: <span class="hljs-string">&quot;TEXMEX TALES LLC&quot;</span>,
      <span class="hljs-string">&quot;num_units&quot;</span>: <span class="hljs-number">0</span>
    }
  },
  {
    <span class="hljs-string">&quot;match_explanation&quot;</span>: {
      <span class="hljs-string">&quot;businesses_listed_at_addrs&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;related_to_excluded&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;similar_addresses&quot;</span>: {
        <span class="hljs-string">&quot;highest_similarity&quot;</span>: <span class="hljs-number">0</span>
      },
      <span class="hljs-string">&quot;businesses_owning_parcels&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;parcels_owned_by_same_non_business_owner&quot;</span>: <span class="hljs-literal">null</span>
    },
    <span class="hljs-string">&quot;network_description&quot;</span>: {
      <span class="hljs-string">&quot;network_id&quot;</span>: <span class="hljs-number">88360</span>,
      <span class="hljs-string">&quot;top_owner&quot;</span>: <span class="hljs-string">&quot;ROB TOOKOIAN&quot;</span>,
      <span class="hljs-string">&quot;top_addr&quot;</span>: <span class="hljs-string">&quot;2520 W MAGILL AVE FRESNO CA&quot;</span>,
      <span class="hljs-string">&quot;num_parcels&quot;</span>: <span class="hljs-number">1</span>,
      <span class="hljs-string">&quot;top_be&quot;</span>: <span class="hljs-string">&quot;1800 FILBERT LLC&quot;</span>,
      <span class="hljs-string">&quot;num_units&quot;</span>: <span class="hljs-number">1</span>
    }
  },
  {
    <span class="hljs-string">&quot;match_explanation&quot;</span>: {
      <span class="hljs-string">&quot;businesses_listed_at_addrs&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;related_to_excluded&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;similar_addresses&quot;</span>: {
        <span class="hljs-string">&quot;highest_similarity&quot;</span>: <span class="hljs-number">0.3333333333333333</span>
      },
      <span class="hljs-string">&quot;businesses_owning_parcels&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;parcels_owned_by_same_non_business_owner&quot;</span>: <span class="hljs-literal">null</span>
    },
    <span class="hljs-string">&quot;network_description&quot;</span>: {
      <span class="hljs-string">&quot;network_id&quot;</span>: <span class="hljs-number">219046</span>,
      <span class="hljs-string">&quot;top_owner&quot;</span>: <span class="hljs-string">&quot;FRANK DREHER&quot;</span>,
      <span class="hljs-string">&quot;top_addr&quot;</span>: <span class="hljs-string">&quot;3053 FILLMORE ST SAN FRANCISCO CA 285&quot;</span>,
      <span class="hljs-string">&quot;num_parcels&quot;</span>: <span class="hljs-number">1</span>,
      <span class="hljs-string">&quot;top_be&quot;</span>: <span class="hljs-string">&quot;TOPALIX LLC&quot;</span>,
      <span class="hljs-string">&quot;num_units&quot;</span>: <span class="hljs-number">1</span>
    }
  },
  {
    <span class="hljs-string">&quot;match_explanation&quot;</span>: {
      <span class="hljs-string">&quot;businesses_listed_at_addrs&quot;</span>: {
        <span class="hljs-string">&quot;num_addrs&quot;</span>: <span class="hljs-number">1</span>,
        <span class="hljs-string">&quot;num_businesses&quot;</span>: <span class="hljs-number">1</span>
      },
      <span class="hljs-string">&quot;related_to_excluded&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;similar_addresses&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;businesses_owning_parcels&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;parcels_owned_by_same_non_business_owner&quot;</span>: <span class="hljs-literal">null</span>
    },
    <span class="hljs-string">&quot;network_description&quot;</span>: {
      <span class="hljs-string">&quot;network_id&quot;</span>: <span class="hljs-number">843542</span>,
      <span class="hljs-string">&quot;top_owner&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;top_addr&quot;</span>: <span class="hljs-string">&quot;109 ALPINE TER SAN FRANCISCO CA&quot;</span>,
      <span class="hljs-string">&quot;num_parcels&quot;</span>: <span class="hljs-number">1</span>,
      <span class="hljs-string">&quot;top_be&quot;</span>: <span class="hljs-string">&quot;STR CONCIERGE LLC&quot;</span>,
      <span class="hljs-string">&quot;num_units&quot;</span>: <span class="hljs-number">1</span>
    }
  },
  {
    <span class="hljs-string">&quot;match_explanation&quot;</span>: {
      <span class="hljs-string">&quot;businesses_listed_at_addrs&quot;</span>: {
        <span class="hljs-string">&quot;num_addrs&quot;</span>: <span class="hljs-number">3</span>,
        <span class="hljs-string">&quot;num_businesses&quot;</span>: <span class="hljs-number">5</span>
      },
      <span class="hljs-string">&quot;related_to_excluded&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;similar_addresses&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;businesses_owning_parcels&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;parcels_owned_by_same_non_business_owner&quot;</span>: <span class="hljs-literal">null</span>
    },
    <span class="hljs-string">&quot;network_description&quot;</span>: {
      <span class="hljs-string">&quot;network_id&quot;</span>: <span class="hljs-number">28150</span>,
      <span class="hljs-string">&quot;top_owner&quot;</span>: <span class="hljs-string">&quot;MARK POTTER&quot;</span>,
      <span class="hljs-string">&quot;top_addr&quot;</span>: <span class="hljs-string">&quot;1 POST OFFICE SQ BOSTON MA STE 3150&quot;</span>,
      <span class="hljs-string">&quot;num_parcels&quot;</span>: <span class="hljs-number">0</span>,
      <span class="hljs-string">&quot;top_be&quot;</span>: <span class="hljs-string">&quot;LA MULTI-FAMILY VENTURE I LLC&quot;</span>,
      <span class="hljs-string">&quot;num_units&quot;</span>: <span class="hljs-number">0</span>
    }
  },
  {
    <span class="hljs-string">&quot;match_explanation&quot;</span>: {
      <span class="hljs-string">&quot;businesses_listed_at_addrs&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;related_to_excluded&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;similar_addresses&quot;</span>: {
        <span class="hljs-string">&quot;highest_similarity&quot;</span>: <span class="hljs-number">0.3333333333333333</span>
      },
      <span class="hljs-string">&quot;businesses_owning_parcels&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;parcels_owned_by_same_non_business_owner&quot;</span>: <span class="hljs-literal">null</span>
    },
    <span class="hljs-string">&quot;network_description&quot;</span>: {
      <span class="hljs-string">&quot;network_id&quot;</span>: <span class="hljs-number">181762</span>,
      <span class="hljs-string">&quot;top_owner&quot;</span>: <span class="hljs-string">&quot;P VO&quot;</span>,
      <span class="hljs-string">&quot;top_addr&quot;</span>: <span class="hljs-string">&quot;3053 FILLMORE ST SAN FRANCISCO CA 263&quot;</span>,
      <span class="hljs-string">&quot;num_parcels&quot;</span>: <span class="hljs-number">0</span>,
      <span class="hljs-string">&quot;top_be&quot;</span>: <span class="hljs-string">&quot;GREEN STREET APARTMENTS LLC&quot;</span>,
      <span class="hljs-string">&quot;num_units&quot;</span>: <span class="hljs-number">0</span>
    }
  },
  {
    <span class="hljs-string">&quot;match_explanation&quot;</span>: {
      <span class="hljs-string">&quot;businesses_listed_at_addrs&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;related_to_excluded&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;similar_addresses&quot;</span>: {
        <span class="hljs-string">&quot;highest_similarity&quot;</span>: <span class="hljs-number">0.14285714285714285</span>
      },
      <span class="hljs-string">&quot;businesses_owning_parcels&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;parcels_owned_by_same_non_business_owner&quot;</span>: <span class="hljs-literal">null</span>
    },
    <span class="hljs-string">&quot;network_description&quot;</span>: {
      <span class="hljs-string">&quot;network_id&quot;</span>: <span class="hljs-number">178529</span>,
      <span class="hljs-string">&quot;top_owner&quot;</span>: <span class="hljs-string">&quot;CYNTHIA RUTTER&quot;</span>,
      <span class="hljs-string">&quot;top_addr&quot;</span>: <span class="hljs-string">&quot;3465 N PINES WAY, STE 104 #243 WILSON WY&quot;</span>,
      <span class="hljs-string">&quot;num_parcels&quot;</span>: <span class="hljs-number">0</span>,
      <span class="hljs-string">&quot;top_be&quot;</span>: <span class="hljs-string">&quot;1649 BEACH STREET LLC&quot;</span>,
      <span class="hljs-string">&quot;num_units&quot;</span>: <span class="hljs-number">0</span>
    }
  }
];</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="servertesttest_dataparcelgetparceldetailstestdata.js"><a href="#toc"><a name="server-test-test_data-parcel-getparceldetailstestdata-js">server/test/test_data/parcel/getParcelDetailsTestData.js</a></a></h2>
<pre><code><span class="hljs-comment">// Results using 3/31/21 V2.0 DB on &#x27;/v2/parcel/7517280/details</span>

<span class="hljs-keyword">const</span> query_results = {
  <span class="hljs-string">&quot;parcel_details&quot;</span>: {
    <span class="hljs-string">&quot;rooms&quot;</span>: <span class="hljs-number">2</span>,
    <span class="hljs-string">&quot;prop_class_code&quot;</span>: <span class="hljs-string">&quot;Z&quot;</span>,
    <span class="hljs-string">&quot;stories&quot;</span>: <span class="hljs-number">1</span>,
    <span class="hljs-string">&quot;addr_details&quot;</span>: {
      <span class="hljs-string">&quot;main_addr&quot;</span>: <span class="hljs-string">&quot;175 RED ROCK WAY (UNIT 204)&quot;</span>,           <span class="hljs-comment">// = address to use as the title address for the parcel page</span>
      <span class="hljs-string">&quot;addr_variations&quot;</span>: [
        <span class="hljs-string">&quot;175 RED ROCK WAY (UNIT 204 K)&quot;</span>                     <span class="hljs-comment">// = a list of address variations found from the EAS data</span>
      ],
      <span class="hljs-string">&quot;num_extra_addr_variations&quot;</span>: <span class="hljs-number">0</span>                        <span class="hljs-comment">// = beyond the variations listed, how many additional variations there are</span>
    },
    <span class="hljs-string">&quot;rent_controlled&quot;</span>: <span class="hljs-number">1</span>,
    <span class="hljs-string">&quot;units&quot;</span>: <span class="hljs-number">1</span>,
    <span class="hljs-string">&quot;assess_imp_val&quot;</span>: <span class="hljs-number">243576</span>,
    <span class="hljs-string">&quot;curr_sales_price&quot;</span>: <span class="hljs-number">597000</span>,
    <span class="hljs-string">&quot;update_date&quot;</span>: <span class="hljs-string">&quot;20190109&quot;</span>,
    <span class="hljs-string">&quot;long&quot;</span>: <span class="hljs-number">-122.44187274137725</span>,
    <span class="hljs-string">&quot;yr_built&quot;</span>: <span class="hljs-number">1972</span>,
    <span class="hljs-string">&quot;assess_val_date&quot;</span>: <span class="hljs-string">&quot;20200612&quot;</span>,
    <span class="hljs-string">&quot;zone&quot;</span>: <span class="hljs-string">&quot;RM1&quot;</span>,
    <span class="hljs-string">&quot;block_lot&quot;</span>: <span class="hljs-string">&quot;7517280&quot;</span>,
    <span class="hljs-string">&quot;neighborhood&quot;</span>: <span class="hljs-string">&quot;DIAMOND HEIGHTS&quot;</span>,
    <span class="hljs-string">&quot;assess_land_val&quot;</span>: <span class="hljs-number">365364</span>,
    <span class="hljs-string">&quot;beds&quot;</span>: <span class="hljs-number">1</span>,
    <span class="hljs-string">&quot;lat&quot;</span>: <span class="hljs-number">37.74582232012925</span>,
    <span class="hljs-string">&quot;curr_sales_date&quot;</span>: <span class="hljs-string">&quot;20181227&quot;</span>
  }
};</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="servertesttest_dataparcelgetparcelevictionstestdata.js"><a href="#toc"><a name="server-test-test_data-parcel-getparcelevictionstestdata-js">server/test/test_data/parcel/getParcelEvictionsTestData.js</a></a></h2>
<pre><code><span class="hljs-comment">// Results using 3/31/21 V2.0 DB on &#x27;/v2/parcel/7517280/evictions&#x27;</span>

<span class="hljs-keyword">const</span> query_results = [
  {
    <span class="hljs-string">&quot;evict_date&quot;</span>: <span class="hljs-string">&quot;20001207&quot;</span>,                                     <span class="hljs-comment">// = date of the eviction</span>
    <span class="hljs-string">&quot;primary_evictor&quot;</span>: {
      <span class="hljs-string">&quot;linked_be&quot;</span>: <span class="hljs-literal">null</span>,                                          <span class="hljs-comment">// = whether the evictor is a business</span>
      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-literal">null</span>                                                <span class="hljs-comment">// = name of the evictor (from sales transfer records)</span>
    },
    <span class="hljs-string">&quot;extra_evictors&quot;</span>: [],                                         <span class="hljs-comment">// = additional names associated with eviction</span>
                                                                  <span class="hljs-comment">//   from eviction petition itself</span>
    <span class="hljs-string">&quot;evict_addr_orig&quot;</span>: <span class="hljs-string">&quot;175 REDROCK WAY (UNIT K102)&quot;</span>,             <span class="hljs-comment">// = original address listed on eviction petition</span>
    <span class="hljs-string">&quot;num_other_parc&quot;</span>: <span class="hljs-number">35</span>,                                         <span class="hljs-comment">// = total number of other properties matched with this eviction</span>
    <span class="hljs-string">&quot;match_quality&quot;</span>: {
      <span class="hljs-string">&quot;addr_match_method&quot;</span>: <span class="hljs-string">&quot;GEO_INSIDE_MULTIPLE&quot;</span>,                 <span class="hljs-comment">// = the method used to match eviction to parcel (e.g. here</span>
                                                                  <span class="hljs-comment">//   we had to geocode the eviction, and it matched to </span>
                                                                  <span class="hljs-comment">//   multiple properties</span>
      <span class="hljs-string">&quot;did_subdivision_occur&quot;</span>: <span class="hljs-string">&quot;SUBDIVISION_BEFORE_EVICTION&quot;</span>      <span class="hljs-comment">// = whether we determined that a subdivison occurred at this parcel</span>
    },
    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;Owner Move In&quot;</span>,                                      <span class="hljs-comment">// = type of the eviction</span>
    <span class="hljs-string">&quot;evict_id&quot;</span>: <span class="hljs-string">&quot;M2K2457&quot;</span>                                         <span class="hljs-comment">// = unique identifier for eviction</span>
  },
  {
    <span class="hljs-string">&quot;evict_date&quot;</span>: <span class="hljs-string">&quot;20001127&quot;</span>,
    <span class="hljs-string">&quot;primary_evictor&quot;</span>: {
      <span class="hljs-string">&quot;linked_be&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-literal">null</span>
    },
    <span class="hljs-string">&quot;extra_evictors&quot;</span>: [],
    <span class="hljs-string">&quot;evict_addr_orig&quot;</span>: <span class="hljs-string">&quot;175 REDROCK WAY (UNIT K102)&quot;</span>,
    <span class="hljs-string">&quot;num_other_parc&quot;</span>: <span class="hljs-number">35</span>,
    <span class="hljs-string">&quot;match_quality&quot;</span>: {
      <span class="hljs-string">&quot;addr_match_method&quot;</span>: <span class="hljs-string">&quot;GEO_INSIDE_MULTIPLE&quot;</span>,
      <span class="hljs-string">&quot;did_subdivision_occur&quot;</span>: <span class="hljs-string">&quot;SUBDIVISION_BEFORE_EVICTION&quot;</span>
    },
    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;Owner Move In&quot;</span>,
    <span class="hljs-string">&quot;evict_id&quot;</span>: <span class="hljs-string">&quot;M2K2379&quot;</span>
  },
  {
    <span class="hljs-string">&quot;evict_date&quot;</span>: <span class="hljs-string">&quot;20000707&quot;</span>,
    <span class="hljs-string">&quot;primary_evictor&quot;</span>: {
      <span class="hljs-string">&quot;linked_be&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-literal">null</span>
    },
    <span class="hljs-string">&quot;extra_evictors&quot;</span>: [],
    <span class="hljs-string">&quot;evict_addr_orig&quot;</span>: <span class="hljs-string">&quot;175 RED ROCK WAY (UNIT K103)&quot;</span>,
    <span class="hljs-string">&quot;num_other_parc&quot;</span>: <span class="hljs-number">35</span>,
    <span class="hljs-string">&quot;match_quality&quot;</span>: {
      <span class="hljs-string">&quot;addr_match_method&quot;</span>: <span class="hljs-string">&quot;EXACT_ASSESSOR_ADDR_UNMATCHED_UNIT&quot;</span>,
      <span class="hljs-string">&quot;did_subdivision_occur&quot;</span>: <span class="hljs-string">&quot;SUBDIVISION_BEFORE_EVICTION&quot;</span>
    },
    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;Owner Move In&quot;</span>,
    <span class="hljs-string">&quot;evict_id&quot;</span>: <span class="hljs-string">&quot;M2K1341&quot;</span>
  },
  {
    <span class="hljs-string">&quot;evict_date&quot;</span>: <span class="hljs-string">&quot;20170920&quot;</span>,
    <span class="hljs-string">&quot;primary_evictor&quot;</span>: {
      <span class="hljs-string">&quot;linked_be&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-literal">null</span>
    },
    <span class="hljs-string">&quot;extra_evictors&quot;</span>: [],
    <span class="hljs-string">&quot;evict_addr_orig&quot;</span>: <span class="hljs-string">&quot;175 RED ROCK WAY (UNIT K303)&quot;</span>,
    <span class="hljs-string">&quot;num_other_parc&quot;</span>: <span class="hljs-number">35</span>,
    <span class="hljs-string">&quot;match_quality&quot;</span>: {
      <span class="hljs-string">&quot;addr_match_method&quot;</span>: <span class="hljs-string">&quot;EXACT_ASSESSOR_ADDR_UNMATCHED_UNIT&quot;</span>,
      <span class="hljs-string">&quot;did_subdivision_occur&quot;</span>: <span class="hljs-string">&quot;SUBDIVISION_BEFORE_EVICTION&quot;</span>
    },
    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;Owner Move In&quot;</span>,
    <span class="hljs-string">&quot;evict_id&quot;</span>: <span class="hljs-string">&quot;M172343&quot;</span>
  },
  {
    <span class="hljs-string">&quot;evict_date&quot;</span>: <span class="hljs-string">&quot;20060523&quot;</span>,
    <span class="hljs-string">&quot;primary_evictor&quot;</span>: {
      <span class="hljs-string">&quot;linked_be&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-literal">null</span>
    },
    <span class="hljs-string">&quot;extra_evictors&quot;</span>: [],
    <span class="hljs-string">&quot;evict_addr_orig&quot;</span>: <span class="hljs-string">&quot;175 RED ROCK WAY (UNIT K302)&quot;</span>,
    <span class="hljs-string">&quot;num_other_parc&quot;</span>: <span class="hljs-number">35</span>,
    <span class="hljs-string">&quot;match_quality&quot;</span>: {
      <span class="hljs-string">&quot;addr_match_method&quot;</span>: <span class="hljs-string">&quot;EXACT_ASSESSOR_ADDR_UNMATCHED_UNIT&quot;</span>,
      <span class="hljs-string">&quot;did_subdivision_occur&quot;</span>: <span class="hljs-string">&quot;SUBDIVISION_BEFORE_EVICTION&quot;</span>
    },
    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;Owner Move In&quot;</span>,
    <span class="hljs-string">&quot;evict_id&quot;</span>: <span class="hljs-string">&quot;M060817&quot;</span>
  },
  {
    <span class="hljs-string">&quot;evict_date&quot;</span>: <span class="hljs-string">&quot;20000612&quot;</span>,
    <span class="hljs-string">&quot;primary_evictor&quot;</span>: {
      <span class="hljs-string">&quot;linked_be&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-literal">null</span>
    },
    <span class="hljs-string">&quot;extra_evictors&quot;</span>: [],
    <span class="hljs-string">&quot;evict_addr_orig&quot;</span>: <span class="hljs-string">&quot;175 RED ROCK WAY (UNIT K103)&quot;</span>,
    <span class="hljs-string">&quot;num_other_parc&quot;</span>: <span class="hljs-number">35</span>,
    <span class="hljs-string">&quot;match_quality&quot;</span>: {
      <span class="hljs-string">&quot;addr_match_method&quot;</span>: <span class="hljs-string">&quot;EXACT_ASSESSOR_ADDR_UNMATCHED_UNIT&quot;</span>,
      <span class="hljs-string">&quot;did_subdivision_occur&quot;</span>: <span class="hljs-string">&quot;SUBDIVISION_BEFORE_EVICTION&quot;</span>
    },
    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;Nuisance&quot;</span>,
    <span class="hljs-string">&quot;evict_id&quot;</span>: <span class="hljs-string">&quot;M032953&quot;</span>
  },
  {
    <span class="hljs-string">&quot;evict_date&quot;</span>: <span class="hljs-string">&quot;19990713&quot;</span>,
    <span class="hljs-string">&quot;primary_evictor&quot;</span>: {
      <span class="hljs-string">&quot;linked_be&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-literal">null</span>
    },
    <span class="hljs-string">&quot;extra_evictors&quot;</span>: [],
    <span class="hljs-string">&quot;evict_addr_orig&quot;</span>: <span class="hljs-string">&quot;175 RED ROCK WAY (UNIT K306)&quot;</span>,
    <span class="hljs-string">&quot;num_other_parc&quot;</span>: <span class="hljs-number">35</span>,
    <span class="hljs-string">&quot;match_quality&quot;</span>: {
      <span class="hljs-string">&quot;addr_match_method&quot;</span>: <span class="hljs-string">&quot;EXACT_ASSESSOR_ADDR_UNMATCHED_UNIT&quot;</span>,
      <span class="hljs-string">&quot;did_subdivision_occur&quot;</span>: <span class="hljs-string">&quot;SUBDIVISION_BEFORE_EVICTION&quot;</span>
    },
    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;Owner Move In&quot;</span>,
    <span class="hljs-string">&quot;evict_id&quot;</span>: <span class="hljs-string">&quot;E991328&quot;</span>
  },
  {
    <span class="hljs-string">&quot;evict_date&quot;</span>: <span class="hljs-string">&quot;19990129&quot;</span>,
    <span class="hljs-string">&quot;primary_evictor&quot;</span>: {
      <span class="hljs-string">&quot;linked_be&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-literal">null</span>
    },
    <span class="hljs-string">&quot;extra_evictors&quot;</span>: [],
    <span class="hljs-string">&quot;evict_addr_orig&quot;</span>: <span class="hljs-string">&quot;175 RED ROCK WAY (UNIT K207)&quot;</span>,
    <span class="hljs-string">&quot;num_other_parc&quot;</span>: <span class="hljs-number">35</span>,
    <span class="hljs-string">&quot;match_quality&quot;</span>: {
      <span class="hljs-string">&quot;addr_match_method&quot;</span>: <span class="hljs-string">&quot;EXACT_ASSESSOR_ADDR_UNMATCHED_UNIT&quot;</span>,
      <span class="hljs-string">&quot;did_subdivision_occur&quot;</span>: <span class="hljs-string">&quot;SUBDIVISION_BEFORE_EVICTION&quot;</span>
    },
    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;Breach of Lease Agreement Nuisance&quot;</span>,
    <span class="hljs-string">&quot;evict_id&quot;</span>: <span class="hljs-string">&quot;E990176&quot;</span>
  },
  {
    <span class="hljs-string">&quot;evict_date&quot;</span>: <span class="hljs-string">&quot;19990430&quot;</span>,
    <span class="hljs-string">&quot;primary_evictor&quot;</span>: {
      <span class="hljs-string">&quot;linked_be&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-literal">null</span>
    },
    <span class="hljs-string">&quot;extra_evictors&quot;</span>: [],
    <span class="hljs-string">&quot;evict_addr_orig&quot;</span>: <span class="hljs-string">&quot;175 RED ROCK WAY (UNIT K207)&quot;</span>,
    <span class="hljs-string">&quot;num_other_parc&quot;</span>: <span class="hljs-number">35</span>,
    <span class="hljs-string">&quot;match_quality&quot;</span>: {
      <span class="hljs-string">&quot;addr_match_method&quot;</span>: <span class="hljs-string">&quot;EXACT_ASSESSOR_ADDR_UNMATCHED_UNIT&quot;</span>,
      <span class="hljs-string">&quot;did_subdivision_occur&quot;</span>: <span class="hljs-string">&quot;SUBDIVISION_BEFORE_EVICTION&quot;</span>
    },
    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;Nuisance&quot;</span>,
    <span class="hljs-string">&quot;evict_id&quot;</span>: <span class="hljs-string">&quot;E990785&quot;</span>
  },
  {
    <span class="hljs-string">&quot;evict_date&quot;</span>: <span class="hljs-string">&quot;20180816&quot;</span>,
    <span class="hljs-string">&quot;primary_evictor&quot;</span>: {
      <span class="hljs-string">&quot;linked_be&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-literal">null</span>
    },
    <span class="hljs-string">&quot;extra_evictors&quot;</span>: [],
    <span class="hljs-string">&quot;evict_addr_orig&quot;</span>: <span class="hljs-string">&quot;175 RED ROCK WAY (UNIT 204K)&quot;</span>,
    <span class="hljs-string">&quot;num_other_parc&quot;</span>: <span class="hljs-number">35</span>,
    <span class="hljs-string">&quot;match_quality&quot;</span>: {
      <span class="hljs-string">&quot;addr_match_method&quot;</span>: <span class="hljs-string">&quot;EXACT_ASSESSOR_ADDR_UNMATCHED_UNIT&quot;</span>,
      <span class="hljs-string">&quot;did_subdivision_occur&quot;</span>: <span class="hljs-string">&quot;SUBDIVISION_BEFORE_EVICTION&quot;</span>
    },
    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;Buyout Declaration&quot;</span>,
    <span class="hljs-string">&quot;evict_id&quot;</span>: <span class="hljs-string">&quot;B182419D&quot;</span>
  },
  {
    <span class="hljs-string">&quot;evict_date&quot;</span>: <span class="hljs-string">&quot;20181108&quot;</span>,
    <span class="hljs-string">&quot;primary_evictor&quot;</span>: {
      <span class="hljs-string">&quot;linked_be&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-literal">null</span>
    },
    <span class="hljs-string">&quot;extra_evictors&quot;</span>: [],
    <span class="hljs-string">&quot;evict_addr_orig&quot;</span>: <span class="hljs-string">&quot;175 RED ROCK WAY (UNIT 204K)&quot;</span>,
    <span class="hljs-string">&quot;num_other_parc&quot;</span>: <span class="hljs-number">35</span>,
    <span class="hljs-string">&quot;match_quality&quot;</span>: {
      <span class="hljs-string">&quot;addr_match_method&quot;</span>: <span class="hljs-string">&quot;EXACT_ASSESSOR_ADDR_UNMATCHED_UNIT&quot;</span>,
      <span class="hljs-string">&quot;did_subdivision_occur&quot;</span>: <span class="hljs-string">&quot;SUBDIVISION_BEFORE_EVICTION&quot;</span>
    },
    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;Buyout Agreement&quot;</span>,
    <span class="hljs-string">&quot;evict_id&quot;</span>: <span class="hljs-string">&quot;B182419A&quot;</span>
  }
];</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="servertesttest_dataparcelgetparcelownerstestdata.js"><a href="#toc"><a name="server-test-test_data-parcel-getparcelownerstestdata-js">server/test/test_data/parcel/getParcelOwnersTestData.js</a></a></h2>
<pre><code><span class="hljs-comment">// Results using 3/31/21 V2.0 DB on &#x27;/v2/parcel/7517280/owners</span>

<span class="hljs-keyword">const</span> query_results = {
  <span class="hljs-string">&quot;owners&quot;</span>: [
    {
      <span class="hljs-string">&quot;mailing_address&quot;</span>: <span class="hljs-string">&quot;173 EVELYN WAY SAN FRANCISCO CA&quot;</span>,
      <span class="hljs-string">&quot;owner_name&quot;</span>: <span class="hljs-string">&quot;CATHERINE E MULHALL REVOC TR&quot;</span>,
      <span class="hljs-string">&quot;record_date&quot;</span>: <span class="hljs-string">&quot;20181227&quot;</span>,
      <span class="hljs-string">&quot;linked_be&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;perc_owner&quot;</span>: <span class="hljs-number">100</span>
    }
  ],
  <span class="hljs-string">&quot;parcels&quot;</span>: <span class="hljs-number">1</span>
};</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="servertesttest_dataparcelgetparcelportfoliotestdata.js"><a href="#toc"><a name="server-test-test_data-parcel-getparcelportfoliotestdata-js">server/test/test_data/parcel/getParcelPortfolioTestData.js</a></a></h2>
<pre><code><span class="hljs-comment">// Results using 3/31/21 V2.0 DB on &#x27;/v2/parcel/7517280/portfolio</span>

<span class="hljs-keyword">const</span> query_results = [
  {
    <span class="hljs-string">&quot;num_evictions&quot;</span>: <span class="hljs-number">0</span>,
    <span class="hljs-string">&quot;owner_mailing_addr&quot;</span>: <span class="hljs-string">&quot;173 EVELYN WAY SAN FRANCISCO CA&quot;</span>,
    <span class="hljs-string">&quot;block_lot&quot;</span>: <span class="hljs-string">&quot;2901E016&quot;</span>,
    <span class="hljs-string">&quot;owners&quot;</span>: [
      {
        <span class="hljs-string">&quot;owner_name&quot;</span>: <span class="hljs-string">&quot;CATHERINE E MULHALL REVOC TR&quot;</span>,
        <span class="hljs-string">&quot;linked_be&quot;</span>: <span class="hljs-literal">null</span>
      }
    ],
    <span class="hljs-string">&quot;neighborhood&quot;</span>: <span class="hljs-string">&quot;WEST OF TWIN PEAKS&quot;</span>,
    <span class="hljs-string">&quot;units&quot;</span>: <span class="hljs-number">1</span>,
    <span class="hljs-string">&quot;addr&quot;</span>: <span class="hljs-string">&quot;173 EVELYN WAY&quot;</span>,
    <span class="hljs-string">&quot;long&quot;</span>: <span class="hljs-number">-122.4518660207234</span>,
    <span class="hljs-string">&quot;lat&quot;</span>: <span class="hljs-number">37.74300743184913</span>
  },
  {
    <span class="hljs-string">&quot;num_evictions&quot;</span>: <span class="hljs-number">1</span>,
    <span class="hljs-string">&quot;owner_mailing_addr&quot;</span>: <span class="hljs-string">&quot;300 SANCHEZ ST SAN FRANCISCO CA&quot;</span>,
    <span class="hljs-string">&quot;block_lot&quot;</span>: <span class="hljs-string">&quot;3564143&quot;</span>,
    <span class="hljs-string">&quot;owners&quot;</span>: [
      {
        <span class="hljs-string">&quot;owner_name&quot;</span>: <span class="hljs-string">&quot;TOM LAWRENCE&quot;</span>,
        <span class="hljs-string">&quot;linked_be&quot;</span>: <span class="hljs-literal">null</span>
      }
    ],
    <span class="hljs-string">&quot;neighborhood&quot;</span>: <span class="hljs-string">&quot;CASTRO/UPPER MARKET&quot;</span>,
    <span class="hljs-string">&quot;units&quot;</span>: <span class="hljs-literal">null</span>,
    <span class="hljs-string">&quot;addr&quot;</span>: <span class="hljs-string">&quot;300 SANCHEZ ST&quot;</span>,
    <span class="hljs-string">&quot;long&quot;</span>: <span class="hljs-number">-122.43113960003411</span>,
    <span class="hljs-string">&quot;lat&quot;</span>: <span class="hljs-number">37.76420866374664</span>
  }
];</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="servertesttest_dataparcelgetparcelrelatednetworkstestdata.js"><a href="#toc"><a name="server-test-test_data-parcel-getparcelrelatednetworkstestdata-js">server/test/test_data/parcel/getParcelRelatedNetworksTestData.js</a></a></h2>
<pre><code><span class="hljs-comment">// Results using 3/31/21 V2.0 DB on &#x27;/v2/parcel/7517280/relatedNetworks&#x27;</span>

<span class="hljs-comment">// See getNetworkRelatedNetworksTestData.js for description of fields here</span>

<span class="hljs-keyword">const</span> query_results = [
  {
    <span class="hljs-string">&quot;match_explanation&quot;</span>: {
      <span class="hljs-string">&quot;businesses_listed_at_addrs&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;related_to_excluded&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;similar_addresses&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;businesses_owning_parcels&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;parcels_owned_by_same_non_business_owner&quot;</span>: {
        <span class="hljs-string">&quot;num_parcels&quot;</span>: <span class="hljs-number">2</span>
      }
    },
    <span class="hljs-string">&quot;network_description&quot;</span>: {
      <span class="hljs-string">&quot;network_id&quot;</span>: <span class="hljs-number">2186712</span>,
      <span class="hljs-string">&quot;top_owner&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;top_addr&quot;</span>: <span class="hljs-string">&quot;2230 29TH AVE SAN FRANCISCO CA&quot;</span>,
      <span class="hljs-string">&quot;num_parcels&quot;</span>: <span class="hljs-number">1</span>,
      <span class="hljs-string">&quot;top_be&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;num_units&quot;</span>: <span class="hljs-number">1</span>
    }
  }
];</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="servertesttest_datasearchgetsearchtestdata.js"><a href="#toc"><a name="server-test-test_data-search-getsearchtestdata-js">server/test/test_data/search/getSearchTestData.js</a></a></h2>
<pre><code><span class="hljs-regexp">//</span> Results using <span class="hljs-number">3</span><span class="hljs-regexp">/31/</span><span class="hljs-number">21</span> V2.<span class="hljs-number">0</span> DB on <span class="hljs-string">&#x27;/v2/search/1350 Stockton&#x27;</span>

const query_results = [
  {
    <span class="hljs-string">&quot;score&quot;</span>: <span class="hljs-number">6.422639846801758</span>,        <span class="hljs-regexp">//</span> = Lucene full text match score
    <span class="hljs-string">&quot;result_type&quot;</span>: <span class="hljs-string">&quot;Parcel_Address&quot;</span>,   <span class="hljs-regexp">//</span> = <span class="hljs-string">&quot;Parcel_Address&quot;</span> <span class="hljs-regexp">/ &quot;SOS_LP&quot; /</span> <span class="hljs-string">&quot;SOS_Corp&quot;</span>
    <span class="hljs-string">&quot;result_name&quot;</span>: <span class="hljs-string">&quot;1350 STOCKTON ST&quot;</span>, <span class="hljs-regexp">//</span> = main address to list on the search results page
    <span class="hljs-string">&quot;result_id&quot;</span>: <span class="hljs-string">&quot;0146016&quot;</span>             <span class="hljs-regexp">//</span> = ID <span class="hljs-keyword">for</span> the parcel / owner page
  },
  {
    <span class="hljs-string">&quot;score&quot;</span>: <span class="hljs-number">4.724703311920166</span>,
    <span class="hljs-string">&quot;result_type&quot;</span>: <span class="hljs-string">&quot;SOS_LP&quot;</span>,
    <span class="hljs-string">&quot;result_name&quot;</span>: <span class="hljs-string">&quot;GRAND 1350 LLC&quot;</span>,
    <span class="hljs-string">&quot;result_id&quot;</span>: <span class="hljs-string">&quot;GRAND 1350 LLC&quot;</span>
  },
  {
    <span class="hljs-string">&quot;score&quot;</span>: <span class="hljs-number">4.231600284576416</span>,
    <span class="hljs-string">&quot;result_type&quot;</span>: <span class="hljs-string">&quot;SOS_LP&quot;</span>,
    <span class="hljs-string">&quot;result_name&quot;</span>: <span class="hljs-string">&quot;1350 TUSTIN PARTNERS LLC&quot;</span>,
    <span class="hljs-string">&quot;result_id&quot;</span>: <span class="hljs-string">&quot;1350 TUSTIN PARTNERS LLC&quot;</span>
  },
  {
    <span class="hljs-string">&quot;score&quot;</span>: <span class="hljs-number">4.231600284576416</span>,
    <span class="hljs-string">&quot;result_type&quot;</span>: <span class="hljs-string">&quot;SOS_LP&quot;</span>,
    <span class="hljs-string">&quot;result_name&quot;</span>: <span class="hljs-string">&quot;1350 HAYES INVESTORS LLC&quot;</span>,
    <span class="hljs-string">&quot;result_id&quot;</span>: <span class="hljs-string">&quot;1350 HAYES INVESTORS LLC&quot;</span>
  },
  {
    <span class="hljs-string">&quot;score&quot;</span>: <span class="hljs-number">4.231600284576416</span>,
    <span class="hljs-string">&quot;result_type&quot;</span>: <span class="hljs-string">&quot;SOS_LP&quot;</span>,
    <span class="hljs-string">&quot;result_name&quot;</span>: <span class="hljs-string">&quot;1350 6TH AVENUE LLC&quot;</span>,
    <span class="hljs-string">&quot;result_id&quot;</span>: <span class="hljs-string">&quot;1350 6TH AVENUE LLC&quot;</span>
  },
  {
    <span class="hljs-string">&quot;score&quot;</span>: <span class="hljs-number">4.231600284576416</span>,
    <span class="hljs-string">&quot;result_type&quot;</span>: <span class="hljs-string">&quot;SOS_LP&quot;</span>,
    <span class="hljs-string">&quot;result_name&quot;</span>: <span class="hljs-string">&quot;BROOKFIELD PV 1350 LLC&quot;</span>,
    <span class="hljs-string">&quot;result_id&quot;</span>: <span class="hljs-string">&quot;BROOKFIELD PV 1350 LLC&quot;</span>
  },
  {
    <span class="hljs-string">&quot;score&quot;</span>: <span class="hljs-number">4.231600284576416</span>,
    <span class="hljs-string">&quot;result_type&quot;</span>: <span class="hljs-string">&quot;SOS_LP&quot;</span>,
    <span class="hljs-string">&quot;result_name&quot;</span>: <span class="hljs-string">&quot;1350 CHARLESTON PARTNERS LLC&quot;</span>,
    <span class="hljs-string">&quot;result_id&quot;</span>: <span class="hljs-string">&quot;1350 CHARLESTON PARTNERS LLC&quot;</span>
  },
  {
    <span class="hljs-string">&quot;score&quot;</span>: <span class="hljs-number">4.231600284576416</span>,
    <span class="hljs-string">&quot;result_type&quot;</span>: <span class="hljs-string">&quot;SOS_LP&quot;</span>,
    <span class="hljs-string">&quot;result_name&quot;</span>: <span class="hljs-string">&quot;1350 NATOMA STREET LLC&quot;</span>,
    <span class="hljs-string">&quot;result_id&quot;</span>: <span class="hljs-string">&quot;1350 NATOMA STREET LLC&quot;</span>
  },
  {
    <span class="hljs-string">&quot;score&quot;</span>: <span class="hljs-number">4.231600284576416</span>,
    <span class="hljs-string">&quot;result_type&quot;</span>: <span class="hljs-string">&quot;SOS_LP&quot;</span>,
    <span class="hljs-string">&quot;result_name&quot;</span>: <span class="hljs-string">&quot;1350 MARIN STREET LLC&quot;</span>,
    <span class="hljs-string">&quot;result_id&quot;</span>: <span class="hljs-string">&quot;1350 MARIN STREET LLC&quot;</span>
  },
  {
    <span class="hljs-string">&quot;score&quot;</span>: <span class="hljs-number">4.231600284576416</span>,
    <span class="hljs-string">&quot;result_type&quot;</span>: <span class="hljs-string">&quot;SOS_LP&quot;</span>,
    <span class="hljs-string">&quot;result_name&quot;</span>: <span class="hljs-string">&quot;1350 JONES STREET LLC&quot;</span>,
    <span class="hljs-string">&quot;result_id&quot;</span>: <span class="hljs-string">&quot;1350 JONES STREET LLC&quot;</span>
  },
  {
    <span class="hljs-string">&quot;score&quot;</span>: <span class="hljs-number">4.019526481628418</span>,
    <span class="hljs-string">&quot;result_type&quot;</span>: <span class="hljs-string">&quot;SOS_Corp&quot;</span>,
    <span class="hljs-string">&quot;result_name&quot;</span>: <span class="hljs-string">&quot;RECOLOGY STOCKTON&quot;</span>,
    <span class="hljs-string">&quot;result_id&quot;</span>: <span class="hljs-string">&quot;RECOLOGY STOCKTON&quot;</span>
  },
  {
    <span class="hljs-string">&quot;score&quot;</span>: <span class="hljs-number">4.019526481628418</span>,
    <span class="hljs-string">&quot;result_type&quot;</span>: <span class="hljs-string">&quot;SOS_LP&quot;</span>,
    <span class="hljs-string">&quot;result_name&quot;</span>: <span class="hljs-string">&quot;STOCKTON SQUARE&quot;</span>,
    <span class="hljs-string">&quot;result_id&quot;</span>: <span class="hljs-string">&quot;STOCKTON SQUARE&quot;</span>
  },
  {
    <span class="hljs-string">&quot;score&quot;</span>: <span class="hljs-number">3.9841480255126953</span>,
    <span class="hljs-string">&quot;result_type&quot;</span>: <span class="hljs-string">&quot;Parcel_Address&quot;</span>,
    <span class="hljs-string">&quot;result_name&quot;</span>: <span class="hljs-string">&quot;1350  BROADWAY&quot;</span>,
    <span class="hljs-string">&quot;result_id&quot;</span>: <span class="hljs-string">&quot;0153017A&quot;</span>
  },
  {
    <span class="hljs-string">&quot;score&quot;</span>: <span class="hljs-number">3.831697463989258</span>,
    <span class="hljs-string">&quot;result_type&quot;</span>: <span class="hljs-string">&quot;SOS_LP&quot;</span>,
    <span class="hljs-string">&quot;result_name&quot;</span>: <span class="hljs-string">&quot;ZIC 1350 W MIDDLEFIELD LLC&quot;</span>,
    <span class="hljs-string">&quot;result_id&quot;</span>: <span class="hljs-string">&quot;ZIC 1350 W MIDDLEFIELD LLC&quot;</span>
  },
  {
    <span class="hljs-string">&quot;score&quot;</span>: <span class="hljs-number">3.5511350631713867</span>,
    <span class="hljs-string">&quot;result_type&quot;</span>: <span class="hljs-string">&quot;SOS_LP&quot;</span>,
    <span class="hljs-string">&quot;result_name&quot;</span>: <span class="hljs-string">&quot;BROOKFIELD STOCKTON LLC&quot;</span>,
    <span class="hljs-string">&quot;result_id&quot;</span>: <span class="hljs-string">&quot;BROOKFIELD STOCKTON LLC&quot;</span>
  },
  {
    <span class="hljs-string">&quot;score&quot;</span>: <span class="hljs-number">3.5511350631713867</span>,
    <span class="hljs-string">&quot;result_type&quot;</span>: <span class="hljs-string">&quot;SOS_Corp&quot;</span>,
    <span class="hljs-string">&quot;result_name&quot;</span>: <span class="hljs-string">&quot;STOCKTON CONGREGATIONAL HOMES&quot;</span>,
    <span class="hljs-string">&quot;result_id&quot;</span>: <span class="hljs-string">&quot;STOCKTON CONGREGATIONAL HOMES&quot;</span>
  },
  {
    <span class="hljs-string">&quot;score&quot;</span>: <span class="hljs-number">3.5511350631713867</span>,
    <span class="hljs-string">&quot;result_type&quot;</span>: <span class="hljs-string">&quot;SOS_LP&quot;</span>,
    <span class="hljs-string">&quot;result_name&quot;</span>: <span class="hljs-string">&quot;TAM STOCKTON LLC&quot;</span>,
    <span class="hljs-string">&quot;result_id&quot;</span>: <span class="hljs-string">&quot;TAM STOCKTON LLC&quot;</span>
  },
  {
    <span class="hljs-string">&quot;score&quot;</span>: <span class="hljs-number">3.5511350631713867</span>,
    <span class="hljs-string">&quot;result_type&quot;</span>: <span class="hljs-string">&quot;SOS_LP&quot;</span>,
    <span class="hljs-string">&quot;result_name&quot;</span>: <span class="hljs-string">&quot;STOCKTON PHOENIX LLC&quot;</span>,
    <span class="hljs-string">&quot;result_id&quot;</span>: <span class="hljs-string">&quot;STOCKTON PHOENIX LLC&quot;</span>
  },
  {
    <span class="hljs-string">&quot;score&quot;</span>: <span class="hljs-number">3.5511350631713867</span>,
    <span class="hljs-string">&quot;result_type&quot;</span>: <span class="hljs-string">&quot;SOS_LP&quot;</span>,
    <span class="hljs-string">&quot;result_name&quot;</span>: <span class="hljs-string">&quot;GE STOCKTON LP&quot;</span>,
    <span class="hljs-string">&quot;result_id&quot;</span>: <span class="hljs-string">&quot;GE STOCKTON LP&quot;</span>
  },
  {
    <span class="hljs-string">&quot;score&quot;</span>: <span class="hljs-number">3.5511350631713867</span>,
    <span class="hljs-string">&quot;result_type&quot;</span>: <span class="hljs-string">&quot;SOS_LP&quot;</span>,
    <span class="hljs-string">&quot;result_name&quot;</span>: <span class="hljs-string">&quot;BC STOCKTON LLC&quot;</span>,
    <span class="hljs-string">&quot;result_id&quot;</span>: <span class="hljs-string">&quot;BC STOCKTON LLC&quot;</span>
  }
];</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverutilsgnarlyreadme.md"><a href="#toc"><a name="server-utils-gnarly-readme-md">server/utils/gnarly/README.md</a></a></h2>
<pre><code>server/utils/gnarly

<span class="hljs-comment">&#x27;gnarly&#x27; is a code-word for &quot;code that&#x27;s more obscure or complicated than the rest of the codebase.&quot; these are utility functions written in a more gnarly/grungy style than the rest of the app. the intent is to optimize for performance in critical-path code. it&#x27;s not intended as application-level code for a general audience. that said: contributions, suggestions, questions, and design reviews are helpful and encouraged.</span>

okay, you<span class="hljs-comment">&#x27;ve been warned. if you&#x27;re interested, read on. :)</span>

-ubuvoid

</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="serverutilsgnarlystringutils.js"><a href="#toc"><a name="server-utils-gnarly-stringutils-js">server/utils/gnarly/stringUtils.js</a></a></h2>
<pre><code><span class="hljs-comment">// stringUtils.js</span>

<span class="hljs-comment">// NOTE on code style:</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// this library contains nuts-and-bolts utility functions, intended to be</span>
<span class="hljs-comment">// called many times per request. since these are short, self-contained, and</span>
<span class="hljs-comment">// general purpose functions where efficiency is highly prized, we break from</span>
<span class="hljs-comment">// the normal code style guide.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// most js implementations of title-case and similar string utilities rely on</span>
<span class="hljs-comment">// some sort of string.split()/map() maneuvering. this has stylistic charm, but</span>
<span class="hljs-comment">// unfortunately tends to produce inefficient implementations (excess copies,</span>
<span class="hljs-comment">// excessive function call overhead, etc.)</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// in this file, we break from the typical functional style to offer an</span>
<span class="hljs-comment">// iterative implementation that&#x27;s reminiscent of straight-up c.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// avoiding string.split() also makes it easier to implement correct behavior</span>
<span class="hljs-comment">// when multiple separators are involved (for example, words with hyphens or</span>
<span class="hljs-comment">// slashes).</span>

<span class="hljs-comment">// capsToTitleCase(str)</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// given a string that&#x27;s all-caps, return a title-case-ish string suitable for</span>
<span class="hljs-comment">// display in a ui. this is used to clean up addresses, business names, and</span>
<span class="hljs-comment">// individual names that come directly from the database.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// we need to selectively keep some tokens such as &quot;LLC&quot; all-caps. the</span>
<span class="hljs-comment">// off-the-shelf title case implementations avoid those edge cases by leaving</span>
<span class="hljs-comment">// capitalized strings alone, so we have to handle this ourselves.</span>
export function capsToTitleCase(<span class="hljs-built_in">str</span>) {
  <span class="hljs-keyword">if</span> (typeof <span class="hljs-built_in">str</span> !== <span class="hljs-string">&quot;string&quot;</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-string">&quot;capsToTitleCase expected string, found: &quot;</span> + typeof <span class="hljs-built_in">str</span>;
  }

  <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">str</span>) { <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>; }

  <span class="hljs-comment">// helper fn, returns true if we should consider the single-character string</span>
  <span class="hljs-comment">// &#x27;c&#x27; to be a word separator, as far as adjusting case goes.</span>
  <span class="hljs-comment">// use of switch statement is intentional.</span>
  <span class="hljs-built_in">var</span> isSeparator = function(c) {
    <span class="hljs-built_in">var</span> ret = <span class="hljs-literal">false</span>;  <span class="hljs-comment">// note: defined within helper fn!</span>
    <span class="hljs-keyword">switch</span> (c) {
      <span class="hljs-keyword">case</span> <span class="hljs-string">&quot; &quot;</span>:
      <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;/&quot;</span>:
      <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;-&quot;</span>:
      <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;.&quot;</span>:
        ret = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-literal">default</span>:
        <span class="hljs-keyword">break</span>;
    }
    <span class="hljs-keyword">return</span> ret;
  };

  <span class="hljs-comment">// helper fn, returns true if the string represents a word which should</span>
  <span class="hljs-comment">// remain all-caps. use of switch statement is intentional.</span>
  <span class="hljs-built_in">var</span> shouldBeAllCaps = function(<span class="hljs-built_in">str</span>) {
    <span class="hljs-built_in">var</span> ret = <span class="hljs-literal">false</span>;  <span class="hljs-comment">// note: defined within helper fn!</span>
    <span class="hljs-keyword">if</span> (typeof <span class="hljs-built_in">str</span> !== <span class="hljs-string">&quot;string&quot;</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-string">&quot;bad type in capsToTitleCase helper, this should never happen!&quot;</span>;
    }
    <span class="hljs-keyword">switch</span> (<span class="hljs-built_in">str</span>.toUpperCase()) {
      <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;LLC&quot;</span>:   <span class="hljs-comment">// business designation, occurs commonly.</span>
      <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;LP&quot;</span>:    <span class="hljs-comment">// same as above.</span>
      <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;CA&quot;</span>:    <span class="hljs-comment">// state of CA. <span class="hljs-doctag">TODO:</span> other geographies to special-case?</span>
      <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;PO&quot;</span>:    <span class="hljs-comment">// p.o. box? <span class="hljs-doctag">TODO:</span> clarify.</span>
      <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;II&quot;</span>:    <span class="hljs-comment">// roman numerals, as in &quot;URBAN ORANGE INVESTMENTS II LLC&quot;</span>
      <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;III&quot;</span>:   <span class="hljs-comment">// &quot;I&quot;, &quot;V&quot;, and &quot;X&quot; are only one char, no need to specify.</span>
      <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;IV&quot;</span>:    <span class="hljs-comment">// &quot;XI&quot; is ambiguous because it&#x27;s also a common name, so</span>
      <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;VI&quot;</span>:    <span class="hljs-comment">//  we won&#x27;t bother going past &quot;IX&quot;.</span>
      <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;VII&quot;</span>:
      <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;VIII&quot;</span>:
      <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;IX&quot;</span>:
        ret = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-literal">default</span>:
        <span class="hljs-keyword">break</span>;
    }
    <span class="hljs-keyword">return</span> ret;
  }

  <span class="hljs-built_in">var</span> str_array = Array.<span class="hljs-keyword">from</span>(<span class="hljs-built_in">str</span>);  <span class="hljs-comment">// mutable, initialized to characters of str</span>
  <span class="hljs-built_in">var</span> array_index = <span class="hljs-number">0</span>;
  <span class="hljs-built_in">var</span> token_start, after_token;
  <span class="hljs-keyword">while</span> (array_index &lt; str_array.length) {
    <span class="hljs-keyword">if</span> (isSeparator(str_array[array_index])) {
      array_index++;
      <span class="hljs-keyword">continue</span>;
    }

    <span class="hljs-comment">// if we&#x27;re here, str_array[array_ind] is a non-separator character.</span>
    <span class="hljs-comment">// look ahead to find the next token to be formatted.</span>
    token_start = array_index;      <span class="hljs-comment">// index the token begins with.</span>
    after_token = array_index + <span class="hljs-number">1</span>;  <span class="hljs-comment">// index after token ends.</span>
    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
      <span class="hljs-keyword">if</span> (after_token === str_array.length) { <span class="hljs-keyword">break</span>; }
      <span class="hljs-keyword">if</span> (isSeparator(str_array[after_token])) { <span class="hljs-keyword">break</span>; }

      <span class="hljs-keyword">if</span> (after_token &gt; str_array.length) {
        <span class="hljs-keyword">throw</span> <span class="hljs-string">&quot;after_token past array length, this should never happen!!&quot;</span>;
      }

      after_token++;
    }

    <span class="hljs-comment">// if we&#x27;re here, str_array.slice(token_start, after_token) represents the</span>
    <span class="hljs-comment">// characters of the next &quot;word&quot; we&#x27;ll be evaluating. </span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// slice(i,j).join(&#x27;&#x27;) yields a string, composed of characters in the</span>
    <span class="hljs-comment">// specified index range.</span>
    <span class="hljs-built_in">var</span> is_all_caps = shouldBeAllCaps(
        str_array.slice(token_start, after_token).<span class="hljs-keyword">join</span>(<span class="hljs-string">&#x27;&#x27;</span>));

    <span class="hljs-built_in">var</span> inner_i;
    <span class="hljs-keyword">for</span> (inner_i = token_start; inner_i &lt; after_token; inner_i++) {
      <span class="hljs-keyword">if</span> (is_all_caps || (inner_i === token_start)) {
        <span class="hljs-comment">// write upper case for ALL CAPS words, or for the first character.</span>
        str_array[inner_i] = str_array[inner_i].toUpperCase();
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// otherwise, write lower case character.</span>
        str_array[inner_i] = str_array[inner_i].toLowerCase();
      }
    }

    <span class="hljs-comment">// close of main loop iteration -- advance main index past this token.</span>
    array_index = after_token;
  }

  <span class="hljs-keyword">return</span> str_array.<span class="hljs-keyword">join</span>(<span class="hljs-string">&#x27;&#x27;</span>);  <span class="hljs-comment">// reassemble into a new string.</span>
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="startup_scriptsneo4j-init.sh"><a href="#toc"><a name="startup_scripts-neo4j-init-sh">startup_scripts/neo4j-init.sh</a></a></h2>
<pre><code><span class="hljs-meta">#!/bin/bash</span>

<span class="hljs-comment"># https://stackoverflow.com/questions/45166636/create-neo4j-databse-from-backup-inside-neo4j-docker</span>
<span class="hljs-comment"># do not run init script at each container start but only at the first start</span>
<span class="hljs-keyword">if</span> [ ! -f /load_data/neo4j-import-done.flag ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">mkdir</span> -p /load_data

    apt-get update &amp;&amp; apt-get upgrade -y
    apt-get -y install awscli <span class="hljs-comment"># install AWS CLI to access S3 bucket</span>

    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Downloading Database Dump (as of 9/14/21)&quot;</span>
    aws s3 <span class="hljs-built_in">cp</span> s3://aemp-evictorbook/data_upload/09_14_2021_02_17_01/neo4j.dump /load_data/graph_db.dump
 
    <span class="hljs-comment"># Needed to initialize: https://github.com/neo4j/neo4j/issues/12238</span>
    <span class="hljs-built_in">mkdir</span> -p /data/databases/neo4j
    <span class="hljs-built_in">mkdir</span> -p /data/transactions

    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Loading into DB&quot;</span>
    neo4j-admin load --from=/load_data/graph_db.dump --database=neo4j --force

    <span class="hljs-comment"># Weiiird permissions issue (container uses neo4j as username, loading makes db inaccessible): https://github.com/neo4j/docker-neo4j/issues/130</span>
    <span class="hljs-built_in">chmod</span> -R 777 /data
    <span class="hljs-built_in">touch</span> /load_data/neo4j-import-done.flag
    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Import complete&quot;</span>
<span class="hljs-keyword">else</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;There is no neo4j-init.dump file or the neo4j import has already run.&quot;</span>
    neo4j start
<span class="hljs-keyword">fi</span>
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="startup_scriptswait-for-it.sh"><a href="#toc"><a name="startup_scripts-wait-for-it-sh">startup_scripts/wait-for-it.sh</a></a></h2>
<pre><code><span class="hljs-meta">#!/usr/bin/env bash</span>

<span class="hljs-comment"># Use this script to test if a given TCP host/port are available</span>
WAITFORIT_cmdname=<span class="hljs-variable">${0##*/}</span>

<span class="hljs-function"><span class="hljs-title">echoerr</span></span>() { <span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$WAITFORIT_QUIET</span> -ne 1 ]]; <span class="hljs-keyword">then</span> <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$@</span>&quot;</span> 1&gt;&amp;2; <span class="hljs-keyword">fi</span> }

<span class="hljs-function"><span class="hljs-title">usage</span></span>()
{
    <span class="hljs-built_in">cat</span> &lt;&lt; <span class="hljs-string">USAGE &gt;&amp;2
Usage:
    $WAITFORIT_cmdname host:port [-s] [-t timeout] [-- command args]
    -h HOST | --host=HOST       Host or IP under test
    -p PORT | --port=PORT       TCP port under test
                                Alternatively, you specify the host and port as host:port
    -s | --strict               Only execute subcommand if the test succeeds
    -q | --quiet                Don&#x27;t output any status messages
    -t TIMEOUT | --timeout=TIMEOUT
                                Timeout in seconds, zero for no timeout
    -- COMMAND ARGS             Execute command with args after the test finishes
USAGE</span>
    <span class="hljs-built_in">exit</span> 1
}

<span class="hljs-function"><span class="hljs-title">wait_for</span></span>()
{
    <span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$WAITFORIT_TIMEOUT</span> -gt 0 ]]; <span class="hljs-keyword">then</span>
        echoerr <span class="hljs-string">&quot;<span class="hljs-variable">$WAITFORIT_cmdname</span>: waiting <span class="hljs-variable">$WAITFORIT_TIMEOUT</span> seconds for <span class="hljs-variable">$WAITFORIT_HOST</span>:<span class="hljs-variable">$WAITFORIT_PORT</span>&quot;</span>
    <span class="hljs-keyword">else</span>
        echoerr <span class="hljs-string">&quot;<span class="hljs-variable">$WAITFORIT_cmdname</span>: waiting for <span class="hljs-variable">$WAITFORIT_HOST</span>:<span class="hljs-variable">$WAITFORIT_PORT</span> without a timeout&quot;</span>
    <span class="hljs-keyword">fi</span>
    WAITFORIT_start_ts=$(<span class="hljs-built_in">date</span> +%s)
    <span class="hljs-keyword">while</span> :
    <span class="hljs-keyword">do</span>
        <span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$WAITFORIT_ISBUSY</span> -eq 1 ]]; <span class="hljs-keyword">then</span>
            nc -z <span class="hljs-variable">$WAITFORIT_HOST</span> <span class="hljs-variable">$WAITFORIT_PORT</span>
            WAITFORIT_result=$?
        <span class="hljs-keyword">else</span>
            (<span class="hljs-built_in">echo</span> &gt; /dev/tcp/<span class="hljs-variable">$WAITFORIT_HOST</span>/<span class="hljs-variable">$WAITFORIT_PORT</span>) &gt;/dev/null 2&gt;&amp;1
            WAITFORIT_result=$?
        <span class="hljs-keyword">fi</span>
        <span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$WAITFORIT_result</span> -eq 0 ]]; <span class="hljs-keyword">then</span>
            WAITFORIT_end_ts=$(<span class="hljs-built_in">date</span> +%s)
            echoerr <span class="hljs-string">&quot;<span class="hljs-variable">$WAITFORIT_cmdname</span>: <span class="hljs-variable">$WAITFORIT_HOST</span>:<span class="hljs-variable">$WAITFORIT_PORT</span> is available after <span class="hljs-subst">$((WAITFORIT_end_ts - WAITFORIT_start_ts)</span>) seconds&quot;</span>
            <span class="hljs-built_in">break</span>
        <span class="hljs-keyword">fi</span>
        <span class="hljs-built_in">sleep</span> 1
    <span class="hljs-keyword">done</span>
    <span class="hljs-built_in">return</span> <span class="hljs-variable">$WAITFORIT_result</span>
}

<span class="hljs-function"><span class="hljs-title">wait_for_wrapper</span></span>()
{
    <span class="hljs-comment"># In order to support SIGINT during timeout: http://unix.stackexchange.com/a/57692</span>
    <span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$WAITFORIT_QUIET</span> -eq 1 ]]; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">timeout</span> <span class="hljs-variable">$WAITFORIT_BUSYTIMEFLAG</span> <span class="hljs-variable">$WAITFORIT_TIMEOUT</span> <span class="hljs-variable">$0</span> --quiet --child --host=<span class="hljs-variable">$WAITFORIT_HOST</span> --port=<span class="hljs-variable">$WAITFORIT_PORT</span> --<span class="hljs-built_in">timeout</span>=<span class="hljs-variable">$WAITFORIT_TIMEOUT</span> &amp;
    <span class="hljs-keyword">else</span>
        <span class="hljs-built_in">timeout</span> <span class="hljs-variable">$WAITFORIT_BUSYTIMEFLAG</span> <span class="hljs-variable">$WAITFORIT_TIMEOUT</span> <span class="hljs-variable">$0</span> --child --host=<span class="hljs-variable">$WAITFORIT_HOST</span> --port=<span class="hljs-variable">$WAITFORIT_PORT</span> --<span class="hljs-built_in">timeout</span>=<span class="hljs-variable">$WAITFORIT_TIMEOUT</span> &amp;
    <span class="hljs-keyword">fi</span>
    WAITFORIT_PID=$!
    <span class="hljs-built_in">trap</span> <span class="hljs-string">&quot;kill -INT -<span class="hljs-variable">$WAITFORIT_PID</span>&quot;</span> INT
    <span class="hljs-built_in">wait</span> <span class="hljs-variable">$WAITFORIT_PID</span>
    WAITFORIT_RESULT=$?
    <span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$WAITFORIT_RESULT</span> -ne 0 ]]; <span class="hljs-keyword">then</span>
        echoerr <span class="hljs-string">&quot;<span class="hljs-variable">$WAITFORIT_cmdname</span>: timeout occurred after waiting <span class="hljs-variable">$WAITFORIT_TIMEOUT</span> seconds for <span class="hljs-variable">$WAITFORIT_HOST</span>:<span class="hljs-variable">$WAITFORIT_PORT</span>&quot;</span>
    <span class="hljs-keyword">fi</span>
    <span class="hljs-built_in">return</span> <span class="hljs-variable">$WAITFORIT_RESULT</span>
}

<span class="hljs-comment"># process arguments</span>
<span class="hljs-keyword">while</span> [[ <span class="hljs-variable">$#</span> -gt 0 ]]
<span class="hljs-keyword">do</span>
    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span> <span class="hljs-keyword">in</span>
        *:* )
        WAITFORIT_hostport=(<span class="hljs-variable">${1//:/ }</span>)
        WAITFORIT_HOST=<span class="hljs-variable">${WAITFORIT_hostport[0]}</span>
        WAITFORIT_PORT=<span class="hljs-variable">${WAITFORIT_hostport[1]}</span>
        <span class="hljs-built_in">shift</span> 1
        ;;
        --child)
        WAITFORIT_CHILD=1
        <span class="hljs-built_in">shift</span> 1
        ;;
        -q | --quiet)
        WAITFORIT_QUIET=1
        <span class="hljs-built_in">shift</span> 1
        ;;
        -s | --strict)
        WAITFORIT_STRICT=1
        <span class="hljs-built_in">shift</span> 1
        ;;
        -h)
        WAITFORIT_HOST=<span class="hljs-string">&quot;<span class="hljs-variable">$2</span>&quot;</span>
        <span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$WAITFORIT_HOST</span> == <span class="hljs-string">&quot;&quot;</span> ]]; <span class="hljs-keyword">then</span> <span class="hljs-built_in">break</span>; <span class="hljs-keyword">fi</span>
        <span class="hljs-built_in">shift</span> 2
        ;;
        --host=*)
        WAITFORIT_HOST=<span class="hljs-string">&quot;<span class="hljs-variable">${1#*=}</span>&quot;</span>
        <span class="hljs-built_in">shift</span> 1
        ;;
        -p)
        WAITFORIT_PORT=<span class="hljs-string">&quot;<span class="hljs-variable">$2</span>&quot;</span>
        <span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$WAITFORIT_PORT</span> == <span class="hljs-string">&quot;&quot;</span> ]]; <span class="hljs-keyword">then</span> <span class="hljs-built_in">break</span>; <span class="hljs-keyword">fi</span>
        <span class="hljs-built_in">shift</span> 2
        ;;
        --port=*)
        WAITFORIT_PORT=<span class="hljs-string">&quot;<span class="hljs-variable">${1#*=}</span>&quot;</span>
        <span class="hljs-built_in">shift</span> 1
        ;;
        -t)
        WAITFORIT_TIMEOUT=<span class="hljs-string">&quot;<span class="hljs-variable">$2</span>&quot;</span>
        <span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$WAITFORIT_TIMEOUT</span> == <span class="hljs-string">&quot;&quot;</span> ]]; <span class="hljs-keyword">then</span> <span class="hljs-built_in">break</span>; <span class="hljs-keyword">fi</span>
        <span class="hljs-built_in">shift</span> 2
        ;;
        --<span class="hljs-built_in">timeout</span>=*)
        WAITFORIT_TIMEOUT=<span class="hljs-string">&quot;<span class="hljs-variable">${1#*=}</span>&quot;</span>
        <span class="hljs-built_in">shift</span> 1
        ;;
        --)
        <span class="hljs-built_in">shift</span>
        WAITFORIT_CLI=(<span class="hljs-string">&quot;<span class="hljs-variable">$@</span>&quot;</span>)
        <span class="hljs-built_in">break</span>
        ;;
        --<span class="hljs-built_in">help</span>)
        usage
        ;;
        *)
        echoerr <span class="hljs-string">&quot;Unknown argument: <span class="hljs-variable">$1</span>&quot;</span>
        usage
        ;;
    <span class="hljs-keyword">esac</span>
<span class="hljs-keyword">done</span>

<span class="hljs-keyword">if</span> [[ <span class="hljs-string">&quot;<span class="hljs-variable">$WAITFORIT_HOST</span>&quot;</span> == <span class="hljs-string">&quot;&quot;</span> || <span class="hljs-string">&quot;<span class="hljs-variable">$WAITFORIT_PORT</span>&quot;</span> == <span class="hljs-string">&quot;&quot;</span> ]]; <span class="hljs-keyword">then</span>
    echoerr <span class="hljs-string">&quot;Error: you need to provide a host and port to test.&quot;</span>
    usage
<span class="hljs-keyword">fi</span>

WAITFORIT_TIMEOUT=<span class="hljs-variable">${WAITFORIT_TIMEOUT:-15}</span>
WAITFORIT_STRICT=<span class="hljs-variable">${WAITFORIT_STRICT:-0}</span>
WAITFORIT_CHILD=<span class="hljs-variable">${WAITFORIT_CHILD:-0}</span>
WAITFORIT_QUIET=<span class="hljs-variable">${WAITFORIT_QUIET:-0}</span>

<span class="hljs-comment"># Check to see if timeout is from busybox?</span>
WAITFORIT_TIMEOUT_PATH=$(<span class="hljs-built_in">type</span> -p <span class="hljs-built_in">timeout</span>)
WAITFORIT_TIMEOUT_PATH=$(<span class="hljs-built_in">realpath</span> <span class="hljs-variable">$WAITFORIT_TIMEOUT_PATH</span> 2&gt;/dev/null || <span class="hljs-built_in">readlink</span> -f <span class="hljs-variable">$WAITFORIT_TIMEOUT_PATH</span>)

WAITFORIT_BUSYTIMEFLAG=<span class="hljs-string">&quot;&quot;</span>
<span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$WAITFORIT_TIMEOUT_PATH</span> =~ <span class="hljs-string">&quot;busybox&quot;</span> ]]; <span class="hljs-keyword">then</span>
    WAITFORIT_ISBUSY=1
    <span class="hljs-comment"># Check if busybox timeout uses -t flag</span>
    <span class="hljs-comment"># (recent Alpine versions don&#x27;t support -t anymore)</span>
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">timeout</span> &amp;&gt;/dev/stdout | grep -q -e <span class="hljs-string">&#x27;-t &#x27;</span>; <span class="hljs-keyword">then</span>
        WAITFORIT_BUSYTIMEFLAG=<span class="hljs-string">&quot;-t&quot;</span>
    <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">else</span>
    WAITFORIT_ISBUSY=0
<span class="hljs-keyword">fi</span>

<span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$WAITFORIT_CHILD</span> -gt 0 ]]; <span class="hljs-keyword">then</span>
    wait_for
    WAITFORIT_RESULT=$?
    <span class="hljs-built_in">exit</span> <span class="hljs-variable">$WAITFORIT_RESULT</span>
<span class="hljs-keyword">else</span>
    <span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$WAITFORIT_TIMEOUT</span> -gt 0 ]]; <span class="hljs-keyword">then</span>
        wait_for_wrapper
        WAITFORIT_RESULT=$?
    <span class="hljs-keyword">else</span>
        wait_for
        WAITFORIT_RESULT=$?
    <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$WAITFORIT_CLI</span> != <span class="hljs-string">&quot;&quot;</span> ]]; <span class="hljs-keyword">then</span>
    <span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$WAITFORIT_RESULT</span> -ne 0 &amp;&amp; <span class="hljs-variable">$WAITFORIT_STRICT</span> -eq 1 ]]; <span class="hljs-keyword">then</span>
        echoerr <span class="hljs-string">&quot;<span class="hljs-variable">$WAITFORIT_cmdname</span>: strict mode, refusing to execute subprocess&quot;</span>
        <span class="hljs-built_in">exit</span> <span class="hljs-variable">$WAITFORIT_RESULT</span>
    <span class="hljs-keyword">fi</span>
    <span class="hljs-built_in">exec</span> <span class="hljs-string">&quot;<span class="hljs-variable">${WAITFORIT_CLI[@]}</span>&quot;</span>
<span class="hljs-keyword">else</span>
    <span class="hljs-built_in">exit</span> <span class="hljs-variable">$WAITFORIT_RESULT</span>
<span class="hljs-keyword">fi</span></pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="type_definitionsreadme.md"><a href="#toc"><a name="type_definitions-readme-md">type_definitions/README.md</a></a></h2>
<pre><code>Evictorbook <span class="hljs-keyword">schema</span> definitions have moved <span class="hljs-keyword">to</span> <span class="hljs-keyword">server</span>/<span class="hljs-keyword">schemas</span>.

type_definitions/ previously contained <span class="hljs-keyword">schema</span> defintions <span class="hljs-keyword">for</span> ebook v1 graph, rest api, <span class="hljs-keyword">and</span> query abstraction layers, <span class="hljs-keyword">using</span> the <span class="hljs-string">&#x27;protocol buffer&#x27;</span> definition <span class="hljs-keyword">language</span>. Those definitions, <span class="hljs-keyword">and</span> the accompanying documentation, are now at <span class="hljs-keyword">server</span>/<span class="hljs-keyword">schemas</span>/legacy.
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uidockerfile"><a href="#toc"><a name="ui-dockerfile">ui/Dockerfile</a></a></h2>
<pre><code># BUILD PHASE
<span class="hljs-keyword">FROM</span> node:<span class="hljs-number">14</span> as builder
RUN mkdir -p <span class="hljs-regexp">/home/</span>node<span class="hljs-regexp">/app/</span>node_modules &amp;&amp; chown -R $user:$user <span class="hljs-regexp">/home/</span>node/app
WORKDIR <span class="hljs-regexp">/home/</span>node/app
# A wildcard is used to ensure both <span class="hljs-keyword">package</span>.json AND <span class="hljs-keyword">package</span>-lock.json are copied
<span class="hljs-keyword">COPY</span> <span class="hljs-keyword">package</span>*.json ./
USER $user
## install only the packages defined in the <span class="hljs-keyword">package</span>-lock.json (faster than the normal npm install)
RUN npm install
<span class="hljs-keyword">COPY</span> . . 
RUN npm run build
# RUN PASE
# the production build will come <span class="hljs-keyword">from</span> <span class="hljs-regexp">/home/</span>node<span class="hljs-regexp">/app/</span>build in the <span class="hljs-keyword">previous</span> phase
<span class="hljs-keyword">FROM</span> nginx
EXPOSE <span class="hljs-number">3000</span>
<span class="hljs-keyword">COPY</span> .<span class="hljs-regexp">/nginx/</span><span class="hljs-keyword">default</span>.conf <span class="hljs-regexp">/etc/</span>nginx<span class="hljs-regexp">/conf.d/</span><span class="hljs-keyword">default</span>.conf
<span class="hljs-keyword">COPY</span> --<span class="hljs-keyword">from</span>=builder <span class="hljs-regexp">/home/</span>node<span class="hljs-regexp">/app/</span>build <span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/nginx/</span>html</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uidockerfile.dev"><a href="#toc"><a name="ui-dockerfile-dev">ui/Dockerfile.dev</a></a></h2>
<pre><code>FROM <span class="hljs-keyword">node</span><span class="hljs-title">:12</span>.<span class="hljs-number">1.0</span>

RUN mkdir -p /home/<span class="hljs-keyword">node</span><span class="hljs-title">/app</span>/node_modules &amp;&amp; chown -R <span class="hljs-keyword">node</span><span class="hljs-title">:node</span> /home/<span class="hljs-keyword">node</span><span class="hljs-title">/app</span>

WORKDIR /home/<span class="hljs-keyword">node</span><span class="hljs-title">/app</span>

<span class="hljs-comment"># A wildcard is used to ensure both package.json AND package-lock.json are copied</span>
COPY package*.json ./

<span class="hljs-keyword">USER</span> <span class="hljs-title">node</span>

ARG <span class="hljs-attr">CACHE_BUST=</span><span class="hljs-number">0</span>:<span class="hljs-number">0</span>
<span class="hljs-comment">## install only the packages defined in the package-lock.json (faster than the normal npm install)</span>
RUN echo <span class="hljs-string">&quot;busting UI build cache, cache busting hash = $CACHE_BUST&quot;</span> &amp;&amp; npm install
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uii18next-parser.config.js"><a href="#toc"><a name="ui-i18next-parser-config-js">ui/i18next-parser.config.js</a></a></h2>
<pre><code><span class="hljs-string">module.exports</span> <span class="hljs-string">=</span> {
  <span class="hljs-attr">createOldCatalogs:</span> <span class="hljs-literal">true</span>,
  <span class="hljs-attr">keepRemoved:</span> <span class="hljs-literal">false</span>,
  <span class="hljs-attr">indentation:</span> <span class="hljs-number">2</span>,
  <span class="hljs-attr">lexers:</span> {
    <span class="hljs-attr">js:</span> [<span class="hljs-string">&#x27;JsxLexer&#x27;</span>],
    <span class="hljs-attr">default:</span> [<span class="hljs-string">&#x27;JavascriptLexer&#x27;</span>]
  },
  <span class="hljs-attr">keySeparator:</span> <span class="hljs-literal">false</span>,
  <span class="hljs-attr">namespaceSeparator:</span> <span class="hljs-literal">false</span>,
  <span class="hljs-attr">locales:</span> [<span class="hljs-string">&#x27;en&#x27;</span>],
  <span class="hljs-attr">output:</span> <span class="hljs-string">&#x27;public/locales/$LOCALE/$NAMESPACE.json&#x27;</span>,
  <span class="hljs-attr">input:</span> [<span class="hljs-string">&#x27;src/**/*.{js,jsx}&#x27;</span>],
  <span class="hljs-attr">useKeysAsDefaultValue:</span> <span class="hljs-literal">true</span>,
  <span class="hljs-attr">returnEmptyString:</span> <span class="hljs-literal">false</span>,
  <span class="hljs-attr">verbose:</span> <span class="hljs-literal">true</span>
}</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uinginxdefault.conf"><a href="#toc"><a name="ui-nginx-default-conf">ui/nginx/default.conf</a></a></h2>
<pre><code>server {
    listen <span class="hljs-number">3000</span>;

    location / {
        root <span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/nginx/</span>html;
        index index.html index.htm;
        try_files <span class="hljs-variable">$uri</span> <span class="hljs-variable">$uri</span><span class="hljs-regexp">/ /i</span>ndex.html;
    }
}</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uipackage.json"><a href="#toc"><a name="ui-package-json">ui/package.json</a></a></h2>
<pre><code>{
  <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;evictorbook_ui&quot;</span>,
  <span class="hljs-string">&quot;version&quot;</span>: <span class="hljs-string">&quot;2.0.0&quot;</span>,
  <span class="hljs-string">&quot;private&quot;</span>: true,
  <span class="hljs-string">&quot;proxy&quot;</span>: <span class="hljs-string">&quot;http://api:4000&quot;</span>,
  <span class="hljs-string">&quot;dependencies&quot;</span>: {
    <span class="hljs-string">&quot;@fontsource/roboto&quot;</span>: <span class="hljs-string">&quot;^4.4.5&quot;</span>,
    <span class="hljs-string">&quot;@fortawesome/fontawesome-svg-core&quot;</span>: <span class="hljs-string">&quot;^1.2.35&quot;</span>,
    <span class="hljs-string">&quot;@fortawesome/free-regular-svg-icons&quot;</span>: <span class="hljs-string">&quot;^5.15.3&quot;</span>,
    <span class="hljs-string">&quot;@fortawesome/free-solid-svg-icons&quot;</span>: <span class="hljs-string">&quot;^5.15.3&quot;</span>,
    <span class="hljs-string">&quot;@fortawesome/react-fontawesome&quot;</span>: <span class="hljs-string">&quot;^0.1.14&quot;</span>,
    <span class="hljs-string">&quot;@material-ui/core&quot;</span>: <span class="hljs-string">&quot;^4.11.4&quot;</span>,
    <span class="hljs-string">&quot;@material-ui/data-grid&quot;</span>: <span class="hljs-string">&quot;^4.0.0-alpha.25&quot;</span>,
    <span class="hljs-string">&quot;@material-ui/icons&quot;</span>: <span class="hljs-string">&quot;^4.11.2&quot;</span>,
    <span class="hljs-string">&quot;@material-ui/styles&quot;</span>: <span class="hljs-string">&quot;^4.11.3&quot;</span>,
    <span class="hljs-string">&quot;@reduxjs/toolkit&quot;</span>: <span class="hljs-string">&quot;^1.6.0&quot;</span>,
    <span class="hljs-string">&quot;d3&quot;</span>: <span class="hljs-string">&quot;^7.0.0&quot;</span>,
    <span class="hljs-string">&quot;i18next&quot;</span>: <span class="hljs-string">&quot;^20.3.2&quot;</span>,
    <span class="hljs-string">&quot;i18next-browser-languagedetector&quot;</span>: <span class="hljs-string">&quot;^6.1.2&quot;</span>,
    <span class="hljs-string">&quot;i18next-http-backend&quot;</span>: <span class="hljs-string">&quot;^1.2.6&quot;</span>,
    <span class="hljs-string">&quot;immutable&quot;</span>: <span class="hljs-string">&quot;^4.0.0-rc.12&quot;</span>,
    <span class="hljs-string">&quot;install&quot;</span>: <span class="hljs-string">&quot;^0.13.0&quot;</span>,
    <span class="hljs-string">&quot;leaflet&quot;</span>: <span class="hljs-string">&quot;^1.7.1&quot;</span>,
    <span class="hljs-string">&quot;leaflet.markercluster&quot;</span>: <span class="hljs-string">&quot;^1.5.0&quot;</span>,
    <span class="hljs-string">&quot;mapbox-gl&quot;</span>: <span class="hljs-string">&quot;^1.13.1&quot;</span>,
    <span class="hljs-string">&quot;mapbox-gl-leaflet&quot;</span>: <span class="hljs-string">&quot;0.0.11&quot;</span>,
    <span class="hljs-string">&quot;npm&quot;</span>: <span class="hljs-string">&quot;^7.18.1&quot;</span>,
    <span class="hljs-string">&quot;p-debounce&quot;</span>: <span class="hljs-string">&quot;^4.0.0&quot;</span>,
    <span class="hljs-string">&quot;prop-types&quot;</span>: <span class="hljs-string">&quot;^15.7.2&quot;</span>,
    <span class="hljs-string">&quot;query-string&quot;</span>: <span class="hljs-string">&quot;^7.0.0&quot;</span>,
    <span class="hljs-string">&quot;react&quot;</span>: <span class="hljs-string">&quot;^17.0.2&quot;</span>,
    <span class="hljs-string">&quot;react-csv&quot;</span>: <span class="hljs-string">&quot;^2.0.3&quot;</span>,
    <span class="hljs-string">&quot;react-dom&quot;</span>: <span class="hljs-string">&quot;^17.0.2&quot;</span>,
    <span class="hljs-string">&quot;react-error-boundary&quot;</span>: <span class="hljs-string">&quot;^3.1.3&quot;</span>,
    <span class="hljs-string">&quot;react-force-graph-2d&quot;</span>: <span class="hljs-string">&quot;^1.23.6&quot;</span>,
    <span class="hljs-string">&quot;react-i18next&quot;</span>: <span class="hljs-string">&quot;^11.11.0&quot;</span>,
    <span class="hljs-string">&quot;react-leaflet&quot;</span>: <span class="hljs-string">&quot;^2.7.0&quot;</span>,
    <span class="hljs-string">&quot;react-leaflet-control&quot;</span>: <span class="hljs-string">&quot;^2.1.2&quot;</span>,
    <span class="hljs-string">&quot;react-leaflet-markercluster&quot;</span>: <span class="hljs-string">&quot;^2.0.0&quot;</span>,
    <span class="hljs-string">&quot;react-redux&quot;</span>: <span class="hljs-string">&quot;^7.2.4&quot;</span>,
    <span class="hljs-string">&quot;react-responsive&quot;</span>: <span class="hljs-string">&quot;^8.2.0&quot;</span>,
    <span class="hljs-string">&quot;react-router-dom&quot;</span>: <span class="hljs-string">&quot;^5.2.0&quot;</span>,
    <span class="hljs-string">&quot;react-transition-group&quot;</span>: <span class="hljs-string">&quot;^4.4.2&quot;</span>,
    <span class="hljs-string">&quot;redux-logger&quot;</span>: <span class="hljs-string">&quot;^3.0.6&quot;</span>
  },
  <span class="hljs-string">&quot;scripts&quot;</span>: {
    <span class="hljs-string">&quot;start&quot;</span>: <span class="hljs-string">&quot;react-scripts start&quot;</span>,
    <span class="hljs-string">&quot;build&quot;</span>: <span class="hljs-string">&quot;react-scripts build&quot;</span>,
    <span class="hljs-string">&quot;test&quot;</span>: <span class="hljs-string">&quot;react-scripts test&quot;</span>,
    <span class="hljs-string">&quot;lint&quot;</span>: <span class="hljs-string">&quot;eslint &#x27;src/**/**/*.js&#x27;&quot;</span>,
    <span class="hljs-string">&quot;lint:fix&quot;</span>: <span class="hljs-string">&quot;eslint src/**/**/*.js --fix&quot;</span>,
    <span class="hljs-string">&quot;posttest&quot;</span>: <span class="hljs-string">&quot;npm run lint&quot;</span>,
    <span class="hljs-string">&quot;extract&quot;</span>: <span class="hljs-string">&quot;npx i18next&quot;</span>
  },
  <span class="hljs-string">&quot;browserslist&quot;</span>: {
    <span class="hljs-string">&quot;production&quot;</span>: [
      <span class="hljs-string">&quot;&gt;0.2%&quot;,
      &quot;</span><span class="hljs-keyword">not</span> dead<span class="hljs-string">&quot;,
      &quot;</span><span class="hljs-keyword">not</span> op_mini all<span class="hljs-string">&quot;
    ],
    &quot;</span>development<span class="hljs-string">&quot;: [
      &quot;</span><span class="hljs-keyword">last</span> <span class="hljs-number">1</span> chrome version<span class="hljs-string">&quot;,
      &quot;</span><span class="hljs-keyword">last</span> <span class="hljs-number">1</span> firefox version<span class="hljs-string">&quot;,
      &quot;</span><span class="hljs-keyword">last</span> <span class="hljs-number">1</span> safari version<span class="hljs-string">&quot;
    ]
  },
  &quot;</span>devDependencies<span class="hljs-string">&quot;: {
    &quot;</span>@axe-core/react<span class="hljs-string">&quot;: &quot;</span>^<span class="hljs-number">4.2</span>.<span class="hljs-number">1</span><span class="hljs-string">&quot;,
    &quot;</span>@testing-library/react<span class="hljs-string">&quot;: &quot;</span>^<span class="hljs-number">11.2</span>.<span class="hljs-number">7</span><span class="hljs-string">&quot;,
    &quot;</span>eslint-plugin-import<span class="hljs-string">&quot;: &quot;</span>^<span class="hljs-number">2.23</span>.<span class="hljs-number">4</span><span class="hljs-string">&quot;,
    &quot;</span>husky<span class="hljs-string">&quot;: &quot;</span>^<span class="hljs-number">6.0</span>.<span class="hljs-number">0</span><span class="hljs-string">&quot;,
    &quot;</span>i18next-parser<span class="hljs-string">&quot;: &quot;</span>^<span class="hljs-number">4.2</span>.<span class="hljs-number">0</span><span class="hljs-string">&quot;,
    &quot;</span>react-scripts<span class="hljs-string">&quot;: &quot;</span>^<span class="hljs-number">4.0</span>.<span class="hljs-number">3</span><span class="hljs-string">&quot;
  }
}
</span></pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uipublicindex.html"><a href="#toc"><a name="ui-public-index-html">ui/public/index.html</a></a></h2>
<pre><code><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;utf-8&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;shortcut icon&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;%PUBLIC_URL%/favicon.png&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;minimum-scale=1, initial-scale=1, width=device-width&quot;</span> /&gt;</span> <span class="hljs-comment">&lt;!-- For responsiveness  --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;theme-color&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;#000000&quot;</span> /&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;manifest&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;%PUBLIC_URL%/manifest.json&quot;</span> /&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;preconnect&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;https://fonts.gstatic.com&quot;</span> <span class="hljs-attr">crossorigin</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span>
        <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;preload&quot;</span>
        <span class="hljs-attr">as</span>=<span class="hljs-string">&quot;style&quot;</span>
        <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;https://fonts.googleapis.com/css2?family=Work+Sans:wght@300;400;500;600;700&amp;family=Oswald:wght@300;400;500;700&amp;Source+Sans+Pro,wght@400;500;700;300&amp;display=swap&quot;</span>
    &gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span>
        <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span>
        <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;https://fonts.googleapis.com/css2?family=Work+Sans:wght@300;400;500;600;700&amp;family=Oswald:wght@300;400;500;700&amp;Source+Sans+Pro,wght@400;500;700;300&amp;display=swap&quot;</span>
        <span class="hljs-attr">media</span>=<span class="hljs-string">&quot;print&quot;</span> <span class="hljs-attr">onload</span>=<span class="hljs-string">&quot;this.media=&#x27;all&#x27;&quot;</span>
    &gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;preconnect&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;https://fonts.gstatic.com&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>EvictorBook<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uipubliclocalesendisclaimer.json"><a href="#toc"><a name="ui-public-locales-en-disclaimer-json">ui/public/locales/en/Disclaimer.json</a></a></h2>
<pre><code>{
  <span class="hljs-comment">&quot;Disclaimer&quot;</span>: <span class="hljs-comment">&quot;Disclaimer&quot;</span>,
  <span class="hljs-comment">&quot;The information on this website is sourced from publicly available data that is provided by, created by, and maintained by third-party sites. We are making that data available here. &quot;</span>: <span class="hljs-comment">&quot;The information on this website is sourced from publicly available data that is provided by, created by, and maintained by third-party sites. We are making that data available here. &quot;</span>,
  <span class="hljs-comment">&quot;Our methodology page&quot;</span>: <span class="hljs-comment">&quot;Our methodology page&quot;</span>,
  <span class="hljs-comment">&quot; lists the sources we use, as well as the dates on which we last retrieved data from each source. We do not collect data on the users of this website.&quot;</span>: <span class="hljs-comment">&quot; lists the sources we use, as well as the dates on which we last retrieved data from each source. We do not collect data on the users of this website.&quot;</span>,
  <span class="hljs-comment">&quot;An evictor is defined here as an entity or corporation taking legal action to remove someone from occupying a building. Evictions themselves are not defamatory. Moreover, the appearance of a person, entity, or corporation on this website does not necessarily mean that they have evicted someone or taken advantage of eviction laws.&quot;</span>: <span class="hljs-comment">&quot;An evictor is defined here as an entity or corporation taking legal action to remove someone from occupying a building. Evictions themselves are not defamatory. Moreover, the appearance of a person, entity, or corporation on this website does not necessarily mean that they have evicted someone or taken advantage of eviction laws.&quot;</span>,
  <span class="hljs-comment">&quot;The information on this website is provided “as is,” “as available,” and “with all faults.” Your access to, any reliance upon, and/or use of the information is at your sole risk. To the fullest extent permissible by law, Mapping Action Collective and Anti-Eviction Mapping Project hereby disclaim all express or implied warranties of any kind including but not limited to accuracy and non-infringement, and make no representations, warranties, endorsements, or promises, express or implied, in connection with, or otherwise directly or indirectly related to, the information provided on this website. Under no circumstances shall Mapping Action Collective or Anti-Eviction Mapping Project or its members, employees, volunteers, and affiliates be liable for any indirect, incidental, punitive, special, or consequential damages (including but not limited to damages from personal injury and/or death, lost revenues or profits, loss of business or loss of data) that are directly or indirectly related to the use of the website.&quot;</span>: <span class="hljs-comment">&quot;The information on this website is provided “as is,” “as available,” and “with all faults.” Your access to, any reliance upon, and/or use of the information is at your sole risk. To the fullest extent permissible by law, Mapping Action Collective and Anti-Eviction Mapping Project hereby disclaim all express or implied warranties of any kind including but not limited to accuracy and non-infringement, and make no representations, warranties, endorsements, or promises, express or implied, in connection with, or otherwise directly or indirectly related to, the information provided on this website. Under no circumstances shall Mapping Action Collective or Anti-Eviction Mapping Project or its members, employees, volunteers, and affiliates be liable for any indirect, incidental, punitive, special, or consequential damages (including but not limited to damages from personal injury and/or death, lost revenues or profits, loss of business or loss of data) that are directly or indirectly related to the use of the website.&quot;</span>,
  <span class="hljs-comment">&quot;The information on this website does not constitute legal advice and must not be used as a substitute for the advice of a lawyer qualified to give advice on legal issues pertaining to housing. We can help direct you to free legal services if necessary.&quot;</span>: <span class="hljs-comment">&quot;The information on this website does not constitute legal advice and must not be used as a substitute for the advice of a lawyer qualified to give advice on legal issues pertaining to housing. We can help direct you to free legal services if necessary.&quot;</span>,
  <span class="hljs-comment">&quot;We at the Mapping Action Collective and Anti-Eviction Mapping Project do not condone any violent, harassing, threatening, or destructive behavior directed at landlords, their families, their associates, or their property, or at anyone else. Rather, we encourage our website users to conduct themselves peacefully and responsibly at all times.&quot;</span>: <span class="hljs-comment">&quot;We at the Mapping Action Collective and Anti-Eviction Mapping Project do not condone any violent, harassing, threatening, or destructive behavior directed at landlords, their families, their associates, or their property, or at anyone else. Rather, we encourage our website users to conduct themselves peacefully and responsibly at all times.&quot;</span>
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uipubliclocalesenevictions.json"><a href="#toc"><a name="ui-public-locales-en-evictions-json">ui/public/locales/en/Evictions.json</a></a></h2>
<pre><code>{
  <span class="hljs-comment">&quot;(and&quot;</span>: <span class="hljs-comment">&quot;(and&quot;</span>,
  <span class="hljs-comment">&quot;more)&quot;</span>: <span class="hljs-comment">&quot;more)&quot;</span>,
  <span class="hljs-comment">&quot;This eviction matches with {{count}} other parcels.&quot;</span>: <span class="hljs-comment">&quot;This eviction matches with {{count}} other parcel.&quot;</span>,
  <span class="hljs-comment">&quot;This eviction matches with {{count}} other parcels._plural&quot;</span>: <span class="hljs-comment">&quot;This eviction matches with {{count}} other parcels.&quot;</span>,
  <span class="hljs-comment">&quot;Address&quot;</span>: <span class="hljs-comment">&quot;Address&quot;</span>,
  <span class="hljs-comment">&quot;Type&quot;</span>: <span class="hljs-comment">&quot;Type&quot;</span>,
  <span class="hljs-comment">&quot;Date Filed&quot;</span>: <span class="hljs-comment">&quot;Date Filed&quot;</span>,
  <span class="hljs-comment">&quot; (affecting &quot;</span>: <span class="hljs-comment">&quot; (affecting &quot;</span>,
  <span class="hljs-comment">&quot; units)&quot;</span>: <span class="hljs-comment">&quot; units)&quot;</span>,
  <span class="hljs-comment">&quot;Legend&quot;</span>: <span class="hljs-comment">&quot;Legend&quot;</span>,
  <span class="hljs-comment">&quot;Eviction&quot;</span>: <span class="hljs-comment">&quot;Eviction&quot;</span>,
  <span class="hljs-comment">&quot;Click an eviction on the map for details&quot;</span>: <span class="hljs-comment">&quot;Click an eviction on the map for details&quot;</span>,
  <span class="hljs-comment">&quot;Evictions for the {{search}} Neighborhood&quot;</span>: <span class="hljs-comment">&quot;Evictions for the {{search}} Neighborhood&quot;</span>,
  <span class="hljs-comment">&quot;Eviction Summary&quot;</span>: <span class="hljs-comment">&quot;Eviction Summary&quot;</span>,
  <span class="hljs-comment">&quot;Map and table show {{numEvictions}} evictions between {{oldest}} and {{newest}}{{searchTermApplied}}.&quot;</span>: <span class="hljs-comment">&quot;Map and table show {{numEvictions}} evictions between {{oldest}} and {{newest}}{{searchTermApplied}}.&quot;</span>,
  <span class="hljs-comment">&quot;No evictions recorded for this area.&quot;</span>: <span class="hljs-comment">&quot;No evictions recorded for this area.&quot;</span>,
  <span class="hljs-comment">&quot;Eviction records generally only include the address of the eviction. &quot;</span>: <span class="hljs-comment">&quot;Eviction records generally only include the address of the eviction. &quot;</span>,
  <span class="hljs-comment">&quot;Evictions were matched to parcel records and property ownership records. &quot;</span>: <span class="hljs-comment">&quot;Evictions were matched to parcel records and property ownership records. &quot;</span>,
  <span class="hljs-comment">&quot;As a result, some evictions were matched to multiple or no properties, if an exact &quot;</span>: <span class="hljs-comment">&quot;As a result, some evictions were matched to multiple or no properties, if an exact &quot;</span>,
  <span class="hljs-comment">&quot;match could not be found. Some evictions also include names on the filing, &quot;</span>: <span class="hljs-comment">&quot;match could not be found. Some evictions also include names on the filing, &quot;</span>,
  <span class="hljs-comment">&quot;which may be either property owners or lawyers involved in the case. For these, &quot;</span>: <span class="hljs-comment">&quot;which may be either property owners or lawyers involved in the case. For these, &quot;</span>,
  <span class="hljs-comment">&quot;we have shown the name identified through property records, and the additional &quot;</span>: <span class="hljs-comment">&quot;we have shown the name identified through property records, and the additional &quot;</span>,
  <span class="hljs-comment">&quot;names are those found on the eviction filing itself.&quot;</span>: <span class="hljs-comment">&quot;names are those found on the eviction filing itself.&quot;</span>,
  <span class="hljs-comment">&quot;Map Updated&quot;</span>: <span class="hljs-comment">&quot;Map Updated&quot;</span>
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uipubliclocalesenfooter.json"><a href="#toc"><a name="ui-public-locales-en-footer-json">ui/public/locales/en/Footer.json</a></a></h2>
<pre><code>{
  <span class="hljs-comment">&quot;Take action&quot;</span>: <span class="hljs-comment">&quot;Take action&quot;</span>,
  <span class="hljs-comment">&quot;Glossary&quot;</span>: <span class="hljs-comment">&quot;Glossary&quot;</span>,
  <span class="hljs-comment">&quot;Methodology&quot;</span>: <span class="hljs-comment">&quot;Methodology&quot;</span>,
  <span class="hljs-comment">&quot;Feedback&quot;</span>: <span class="hljs-comment">&quot;Feedback&quot;</span>,
  <span class="hljs-comment">&quot;Disclaimer&quot;</span>: <span class="hljs-comment">&quot;Disclaimer&quot;</span>,
  <span class="hljs-comment">&quot;EvictorBook combines data on property ownership, eviction records, and corporate business filings to identify connections between residential property and their owners in California.&quot;</span>: <span class="hljs-comment">&quot;EvictorBook combines data on property ownership, eviction records, and corporate business filings to identify connections between residential property and their owners in California.&quot;</span>,
  <span class="hljs-comment">&quot;Click here to learn more and take action with the San Francisco Anti-Displacement Coalition.&quot;</span>: <span class="hljs-comment">&quot;Click here to learn more and take action with the San Francisco Anti-Displacement Coalition.&quot;</span>
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uipubliclocalesenglossary.json"><a href="#toc"><a name="ui-public-locales-en-glossary-json">ui/public/locales/en/Glossary.json</a></a></h2>
<pre><code>{
  <span class="hljs-comment">&quot;What causes for eviction are considered just cause - no-fault?&quot;</span>: <span class="hljs-comment">&quot;What causes for eviction are considered just cause - no-fault?&quot;</span>,
  <span class="hljs-comment">&quot;Owner/relative move-in&quot;</span>: <span class="hljs-comment">&quot;Owner/relative move-in&quot;</span>,
  <span class="hljs-comment">&quot;Condo conversion&quot;</span>: <span class="hljs-comment">&quot;Condo conversion&quot;</span>,
  <span class="hljs-comment">&quot;Demolition / removal from rental market&quot;</span>: <span class="hljs-comment">&quot;Demolition / removal from rental market&quot;</span>,
  <span class="hljs-comment">&quot;Temporary removal from rental market for capital improvements or rehabilitation work&quot;</span>: <span class="hljs-comment">&quot;Temporary removal from rental market for capital improvements or rehabilitation work&quot;</span>,
  <span class="hljs-comment">&quot;Substantial rehabilitationLead remediation or abatement work&quot;</span>: <span class="hljs-comment">&quot;Substantial rehabilitationLead remediation or abatement work&quot;</span>,
  <span class="hljs-comment">&quot;Demolition / removal from rental market in accordance with development agreement entered into by the City&quot;</span>: <span class="hljs-comment">&quot;Demolition / removal from rental market in accordance with development agreement entered into by the City&quot;</span>,
  <span class="hljs-comment">&quot;Tenants Together / Urban Displacement Project&quot;</span>: <span class="hljs-comment">&quot;Tenants Together / Urban Displacement Project&quot;</span>,
  <span class="hljs-comment">&quot;What is Considered Just Cause - tenant at-fault?&quot;</span>: <span class="hljs-comment">&quot;What is Considered Just Cause - tenant at-fault?&quot;</span>,
  <span class="hljs-comment">&quot;Failure to pay rent&quot;</span>: <span class="hljs-comment">&quot;Failure to pay rent&quot;</span>,
  <span class="hljs-comment">&quot;Violation of the rental agreement or lease&quot;</span>: <span class="hljs-comment">&quot;Violation of the rental agreement or lease&quot;</span>,
  <span class="hljs-comment">&quot;Unreasonable interference with the comfort, safety or enjoyment of other tenants, or damaging the rental unit or the property&quot;</span>: <span class="hljs-comment">&quot;Unreasonable interference with the comfort, safety or enjoyment of other tenants, or damaging the rental unit or the property&quot;</span>,
  <span class="hljs-comment">&quot;Using your rental unit or the common areas of the property for an illegal purpose&quot;</span>: <span class="hljs-comment">&quot;Using your rental unit or the common areas of the property for an illegal purpose&quot;</span>,
  <span class="hljs-comment">&quot;Refusal to renew a lease or rental agreement of like terms and conditions&quot;</span>: <span class="hljs-comment">&quot;Refusal to renew a lease or rental agreement of like terms and conditions&quot;</span>,
  <span class="hljs-comment">&quot;Refusing the landlord reasonable access to the rental unit for repairs and inspections to name a couple of examples&quot;</span>: <span class="hljs-comment">&quot;Refusing the landlord reasonable access to the rental unit for repairs and inspections to name a couple of examples&quot;</span>,
  <span class="hljs-comment">&quot;At the end of a lease term, the landlord discovers the tenant is not the person who initially rented the unit and the landlord didn’t approve this person’s tenancy&quot;</span>: <span class="hljs-comment">&quot;At the end of a lease term, the landlord discovers the tenant is not the person who initially rented the unit and the landlord didn’t approve this person’s tenancy&quot;</span>,
  <span class="hljs-comment">&quot;What triggers the obligation to pay relocation assistance?&quot;</span>: <span class="hljs-comment">&quot;What triggers the obligation to pay relocation assistance?&quot;</span>,
  <span class="hljs-comment">&quot;Owner/relative move-in (unless tenant is elderly or disabled, then not justified)&quot;</span>: <span class="hljs-comment">&quot;Owner/relative move-in (unless tenant is elderly or disabled, then not justified)&quot;</span>,
  <span class="hljs-comment">&quot;Temporary removal from rental market for capital improvements&quot;</span>: <span class="hljs-comment">&quot;Temporary removal from rental market for capital improvements&quot;</span>,
  <span class="hljs-comment">&quot;Substantial rehabilitation&quot;</span>: <span class="hljs-comment">&quot;Substantial rehabilitation&quot;</span>,
  <span class="hljs-comment">&quot;APN&quot;</span>: <span class="hljs-comment">&quot;APN&quot;</span>,
  <span class="hljs-comment">&quot;APN is the assessor&#x27;s parcel number - \n        a number assigned to property parcels by \n        the tax assessor of a particular jurisdiction \n        for identification and record-keeping. The \n        assigned number is unique within the \n        particular jurisdiction.&quot;</span>: <span class="hljs-comment">&quot;APN is the assessor&#x27;s parcel number - \n        a number assigned to property parcels by \n        the tax assessor of a particular jurisdiction \n        for identification and record-keeping. The \n        assigned number is unique within the \n        particular jurisdiction.&quot;</span>,
  <span class="hljs-comment">&quot;Wikipedia&quot;</span>: <span class="hljs-comment">&quot;Wikipedia&quot;</span>,
  <span class="hljs-comment">&quot;Assessors Office&quot;</span>: <span class="hljs-comment">&quot;Assessors Office&quot;</span>,
  <span class="hljs-comment">&quot;Tax assessment, or assessment, is the job of \n        determining the value, and sometimes determining the \n        use, of property, usually to calculate a property tax. \n        This is usually done by an office called the assessor \n        or tax assessor.&quot;</span>: <span class="hljs-comment">&quot;Tax assessment, or assessment, is the job of \n        determining the value, and sometimes determining the \n        use, of property, usually to calculate a property tax. \n        This is usually done by an office called the assessor \n        or tax assessor.&quot;</span>,
  <span class="hljs-comment">&quot;Buyouts&quot;</span>: <span class="hljs-comment">&quot;Buyouts&quot;</span>,
  <span class="hljs-comment">&quot;Buyouts are often offered to tenants as \n        ways to leave, recieve some funding, and not formally \n        be evicted. However, most tenants don’t understand their \n        rights to stay and when the buyout is coupled with threats \n        to evict, tenants are often intimidated into taking the buyout. \n        Lately buyouts have been on the rise as a means of \n        informally evicting tenants.&quot;</span>: <span class="hljs-comment">&quot;Buyouts are often offered to tenants as \n        ways to leave, recieve some funding, and not formally \n        be evicted. However, most tenants don’t understand their \n        rights to stay and when the buyout is coupled with threats \n        to evict, tenants are often intimidated into taking the buyout. \n        Lately buyouts have been on the rise as a means of \n        informally evicting tenants.&quot;</span>,
  <span class="hljs-comment">&quot;SF Tenants Union&quot;</span>: <span class="hljs-comment">&quot;SF Tenants Union&quot;</span>,
  <span class="hljs-comment">&quot;Capital Improvement and Passthroughs&quot;</span>: <span class="hljs-comment">&quot;Capital Improvement and Passthroughs&quot;</span>,
  <span class="hljs-comment">&quot;For certain types of rent increases, landlords must file \n        a petition at the Rent Board before serving the tenants with a notice of \n        the increase. The tenants are not required to pay the increase until the \n        Rent Board approves it, but if approved, the rent increase will be retroactive \n        to the effective date specified in a valid notice of increase.There are six \n        types of rent increases that require the filing of a landlord petition. These are: \n        Capital Improvement Passthrough; Operating and Maintenance Expense Increase; Special \n        Circumstances Increase Based on Rents for Comparable Units;\n        Rent Increase Based on the Past Rent History of a Proposition I Affected Unit; \n        Utility Passthrough (requires the filing of either a petition or a worksheet); \n        and Rules and Regulations Section 1.21 Increase where there is no Tenant in Occupancy&quot;</span>: <span class="hljs-comment">&quot;For certain types of rent increases, landlords must file \n        a petition at the Rent Board before serving the tenants with a notice of \n        the increase. The tenants are not required to pay the increase until the \n        Rent Board approves it, but if approved, the rent increase will be retroactive \n        to the effective date specified in a valid notice of increase.There are six \n        types of rent increases that require the filing of a landlord petition. These are: \n        Capital Improvement Passthrough; Operating and Maintenance Expense Increase; Special \n        Circumstances Increase Based on Rents for Comparable Units;\n        Rent Increase Based on the Past Rent History of a Proposition I Affected Unit; \n        Utility Passthrough (requires the filing of either a petition or a worksheet); \n        and Rules and Regulations Section 1.21 Increase where there is no Tenant in Occupancy&quot;</span>,
  <span class="hljs-comment">&quot;SF Rent Board&quot;</span>: <span class="hljs-comment">&quot;SF Rent Board&quot;</span>,
  <span class="hljs-comment">&quot;Condos and TIC Conversions&quot;</span>: <span class="hljs-comment">&quot;Condos and TIC Conversions&quot;</span>,
  <span class="hljs-comment">&quot;TICs (Tenancies In Common) are usually the first step for removing housing \n        from rent control to create owner-occupied housing for the profit of real estate investors. \n        TICs are joint ownership of a building where each owner has a side agreement to only\n        occupy a single unit although the owners have joint liability and usually a shared mortgage.&quot;</span>: <span class="hljs-comment">&quot;TICs (Tenancies In Common) are usually the first step for removing housing \n        from rent control to create owner-occupied housing for the profit of real estate investors. \n        TICs are joint ownership of a building where each owner has a side agreement to only\n        occupy a single unit although the owners have joint liability and usually a shared mortgage.&quot;</span>,
  <span class="hljs-comment">&quot;Eligible Units&quot;</span>: <span class="hljs-comment">&quot;Eligible Units&quot;</span>,
  <span class="hljs-comment">&quot;Housing Choice Voucher Program\n        Over-FMR Tenancy program \n        Section 8\n        Federal LIHTC (when a tenant’s occupancy of unit began before LIHTC regulatory agreement was recorded, \n        and rent is not controlled by City agencies)\n        Any unit where a qualifying tenant has been in possession of the unit since 1/19/2007ADUs (accessory dwelling unit)&quot;</span>: <span class="hljs-comment">&quot;Housing Choice Voucher Program\n        Over-FMR Tenancy program \n        Section 8\n        Federal LIHTC (when a tenant’s occupancy of unit began before LIHTC regulatory agreement was recorded, \n        and rent is not controlled by City agencies)\n        Any unit where a qualifying tenant has been in possession of the unit since 1/19/2007ADUs (accessory dwelling unit)&quot;</span>,
  <span class="hljs-comment">&quot;Ellis Act Evictions&quot;</span>: <span class="hljs-comment">&quot;Ellis Act Evictions&quot;</span>,
  <span class="hljs-comment">&quot;The “Ellis Act” is a state law which says that landlords have the unconditional \n        right to evict tenants to “go out of business.” For an Ellis eviction, the landlord must remove \n        all of the units in the building from the rental market, i.e., the landlord must evict all \n        the tenants and cannot single out one tenant (for example, with low rent) and/or remove just \n        one unit out of several from the rental market. The Ellis Act is included in the just causes \n        for eviction under the Rent Ordinance as Section 37.9(a)13).&quot;</span>: <span class="hljs-comment">&quot;The “Ellis Act” is a state law which says that landlords have the unconditional \n        right to evict tenants to “go out of business.” For an Ellis eviction, the landlord must remove \n        all of the units in the building from the rental market, i.e., the landlord must evict all \n        the tenants and cannot single out one tenant (for example, with low rent) and/or remove just \n        one unit out of several from the rental market. The Ellis Act is included in the just causes \n        for eviction under the Rent Ordinance as Section 37.9(a)13).&quot;</span>,
  <span class="hljs-comment">&quot;Estoppel Agreement&quot;</span>: <span class="hljs-comment">&quot;Estoppel Agreement&quot;</span>,
  <span class="hljs-comment">&quot;When a building is for sale, the realtor often gives tenants an “estoppel agreement” or \n      “rental questionnaire” to sign. The landlord is seeking information in this form to tie your down \n        to what you understand your rental agreement means. You do not have to fill out or sign this form \n        unless your rental agreement requires that you fill out any estoppel agreements or similar requests; \n        it is for the landlord’s convenience. Any statements you agree to (explicitly or through omission) may \n        come back to haunt you later.&quot;</span>: <span class="hljs-comment">&quot;When a building is for sale, the realtor often gives tenants an “estoppel agreement” or \n      “rental questionnaire” to sign. The landlord is seeking information in this form to tie your down \n        to what you understand your rental agreement means. You do not have to fill out or sign this form \n        unless your rental agreement requires that you fill out any estoppel agreements or similar requests; \n        it is for the landlord’s convenience. Any statements you agree to (explicitly or through omission) may \n        come back to haunt you later.&quot;</span>,
  <span class="hljs-comment">&quot;Evictor&quot;</span>: <span class="hljs-comment">&quot;Evictor&quot;</span>,
  <span class="hljs-comment">&quot;An entity or corporation taking legal action to remove someone from occupying a building and/or their home. We recognize that evictions also take place through unofficial and nonlegal means, also by evictors. In this tool, however, we are only looking at formal evictions.&quot;</span>: <span class="hljs-comment">&quot;An entity or corporation taking legal action to remove someone from occupying a building and/or their home. We recognize that evictions also take place through unofficial and nonlegal means, also by evictors. In this tool, however, we are only looking at formal evictions.&quot;</span>,
  <span class="hljs-comment">&quot;Anti-Eviction Mapping Project&quot;</span>: <span class="hljs-comment">&quot;Anti-Eviction Mapping Project&quot;</span>,
  <span class="hljs-comment">&quot;Exemptions from Eligibility&quot;</span>: <span class="hljs-comment">&quot;Exemptions from Eligibility&quot;</span>,
  <span class="hljs-comment">&quot;Rental units located in a structure for which a certificate of occupancy was first issued \n        after the effective date of this ordinance (6/13/1979)\n        Unit where substantial rehabilitation was undertaken after effective date of this ordinance\n        Units exempted from rent stabilization by Costa-Hawkins: single family homes&quot;</span>: <span class="hljs-comment">&quot;Rental units located in a structure for which a certificate of occupancy was first issued \n        after the effective date of this ordinance (6/13/1979)\n        Unit where substantial rehabilitation was undertaken after effective date of this ordinance\n        Units exempted from rent stabilization by Costa-Hawkins: single family homes&quot;</span>,
  <span class="hljs-comment">&quot;Habitability and Repairs&quot;</span>: <span class="hljs-comment">&quot;Habitability and Repairs&quot;</span>,
  <span class="hljs-comment">&quot;Tenants have the right to safe and habitable homes in exchange for the rents we are paying. \n        If your landlord is not making repairs, he or she is violating your “Warranty of Habitability” and you \n        have the right to have repairs made. Tenants have the right to report landlords to city agencies and \n        rights to withhold rent or “repair and deduct.” And the landlord cannot retaliate against you; any \n        eviction or rent increase attempt within six months of such a complaint will be examined by the judge \n        for retaliation.&quot;</span>: <span class="hljs-comment">&quot;Tenants have the right to safe and habitable homes in exchange for the rents we are paying. \n        If your landlord is not making repairs, he or she is violating your “Warranty of Habitability” and you \n        have the right to have repairs made. Tenants have the right to report landlords to city agencies and \n        rights to withhold rent or “repair and deduct.” And the landlord cannot retaliate against you; any \n        eviction or rent increase attempt within six months of such a complaint will be examined by the judge \n        for retaliation.&quot;</span>,
  <span class="hljs-comment">&quot;Harassment&quot;</span>: <span class="hljs-comment">&quot;Harassment&quot;</span>,
  <span class="hljs-comment">&quot;Your landlord, or anyone acting for your landlord, cannot harass you out of your home. \n        Landlords cannot evict you by just locking you out, shutting off your utilities, forcibly entering \n        your home without notice, or removing your belongings.&quot;</span>: <span class="hljs-comment">&quot;Your landlord, or anyone acting for your landlord, cannot harass you out of your home. \n        Landlords cannot evict you by just locking you out, shutting off your utilities, forcibly entering \n        your home without notice, or removing your belongings.&quot;</span>,
  <span class="hljs-comment">&quot;Just Cause / Fault Eviction&quot;</span>: <span class="hljs-comment">&quot;Just Cause / Fault Eviction&quot;</span>,
  <span class="hljs-comment">&quot;For rent-controlled units, the landlord must have honest intent, without ulterior motive \n        (e.g., a motive of raising the rent) to evict the tenant with “just cause.” Below are the just causes \n        summarized; for the legal wording get the rent control ordinance and see Section 37.9(a). \n        If done properly, the landlord may evict for these just causes. (The landlord may also evict without \n        a just cause under rent control if the landlord shares the rental unit with the tenant.) However, \n        many of these eviction attempts are done improperly and may be successfully defended. Talk to a \n        counselor and/or get our handbook to find out your defenses.&quot;</span>: <span class="hljs-comment">&quot;For rent-controlled units, the landlord must have honest intent, without ulterior motive \n        (e.g., a motive of raising the rent) to evict the tenant with “just cause.” Below are the just causes \n        summarized; for the legal wording get the rent control ordinance and see Section 37.9(a). \n        If done properly, the landlord may evict for these just causes. (The landlord may also evict without \n        a just cause under rent control if the landlord shares the rental unit with the tenant.) However, \n        many of these eviction attempts are done improperly and may be successfully defended. Talk to a \n        counselor and/or get our handbook to find out your defenses.&quot;</span>,
  <span class="hljs-comment">&quot;LLC&quot;</span>: <span class="hljs-comment">&quot;LLC&quot;</span>,
  <span class="hljs-comment">&quot;A limited liability company (LLC) is the US-specific form of a private limited company. \n        It is a business structure that can combine the pass-through taxation of a partnership or sole \n        proprietorship with the limited liability of a corporation. An LLC is not a corporation under state law; \n        it is a legal form of a company that provides limited liability to its owners in many jurisdictions. \n        LLCs are well known for the flexibility that they provide to business owners; depending on the situation, \n        an LLC may elect to use corporate tax rules instead of being treated as a partnership and, under certain \n        circumstances, LLCs may be organized as not-for-profit. Many landlords and speculators use LLCs as shell \n        companies to buy properties and evict tenants. This provides them anonymity and protection.&quot;</span>: <span class="hljs-comment">&quot;A limited liability company (LLC) is the US-specific form of a private limited company. \n        It is a business structure that can combine the pass-through taxation of a partnership or sole \n        proprietorship with the limited liability of a corporation. An LLC is not a corporation under state law; \n        it is a legal form of a company that provides limited liability to its owners in many jurisdictions. \n        LLCs are well known for the flexibility that they provide to business owners; depending on the situation, \n        an LLC may elect to use corporate tax rules instead of being treated as a partnership and, under certain \n        circumstances, LLCs may be organized as not-for-profit. Many landlords and speculators use LLCs as shell \n        companies to buy properties and evict tenants. This provides them anonymity and protection.&quot;</span>,
  <span class="hljs-comment">&quot;Mergers and Demolitions&quot;</span>: <span class="hljs-comment">&quot;Mergers and Demolitions&quot;</span>,
  <span class="hljs-comment">&quot;Mergers and demolition evictions should be done under eviction just cause 37.9(a)(10) if the rental \n        unit is covered under the San Francisco Rent Ordinance and is a single unit. Developments may be able to demolish \n        multiple units under just cause 37.9(a)(15). Just cause 37.9(a)(15) has been used to evict many tenants in developments \n        such as Trinity Properties and Park Merced. Other evictions are anticipated using this just cause unless the law is changed. \n        It is particularly important in these cases of demolition of multiple units to organize as tenants.&quot;</span>: <span class="hljs-comment">&quot;Mergers and demolition evictions should be done under eviction just cause 37.9(a)(10) if the rental \n        unit is covered under the San Francisco Rent Ordinance and is a single unit. Developments may be able to demolish \n        multiple units under just cause 37.9(a)(15). Just cause 37.9(a)(15) has been used to evict many tenants in developments \n        such as Trinity Properties and Park Merced. Other evictions are anticipated using this just cause unless the law is changed. \n        It is particularly important in these cases of demolition of multiple units to organize as tenants.&quot;</span>,
  <span class="hljs-comment">&quot;Owner Move In (OMI) Evictions&quot;</span>: <span class="hljs-comment">&quot;Owner Move In (OMI) Evictions&quot;</span>,
  <span class="hljs-comment">&quot;For rent-controlled units, one of the most common evictions in San Francisco is for owner or relative move-in \n        (San Francisco Administrative Code Section 37.9(a)(8)). Subject to certain restrictions,a landlord can evict a tenant if \n        the landlord is going to move into the unit to live, or (only if the landlord is also going to be living in the building) \n        for a close relative to move in and live there. These evictions are highly abused and landlords who want to evict a tenant \n        in order to raise the rent on a new tenant typically use owner move-in evictions (OMIs/landlord move-in evictions/LMIs) that \n        are only allowed if done properly.&quot;</span>: <span class="hljs-comment">&quot;For rent-controlled units, one of the most common evictions in San Francisco is for owner or relative move-in \n        (San Francisco Administrative Code Section 37.9(a)(8)). Subject to certain restrictions,a landlord can evict a tenant if \n        the landlord is going to move into the unit to live, or (only if the landlord is also going to be living in the building) \n        for a close relative to move in and live there. These evictions are highly abused and landlords who want to evict a tenant \n        in order to raise the rent on a new tenant typically use owner move-in evictions (OMIs/landlord move-in evictions/LMIs) that \n        are only allowed if done properly.&quot;</span>,
  <span class="hljs-comment">&quot;Rent Control&quot;</span>: <span class="hljs-comment">&quot;Rent Control&quot;</span>,
  <span class="hljs-comment">&quot;In San Francisco, most residential tenants are covered by rent control. This means rents can only be raised by certain \n        amounts per year and the tenant can only be evicted for “just causes.” In addition, some rental units have restrictions on how much \n        the landlord can charge the new tenant due to previous evictions. Tenants who do not have rent control can have their rent increased \n        by any amount at any time with a proper written notice.&quot;</span>: <span class="hljs-comment">&quot;In San Francisco, most residential tenants are covered by rent control. This means rents can only be raised by certain \n        amounts per year and the tenant can only be evicted for “just causes.” In addition, some rental units have restrictions on how much \n        the landlord can charge the new tenant due to previous evictions. Tenants who do not have rent control can have their rent increased \n        by any amount at any time with a proper written notice.&quot;</span>,
  <span class="hljs-comment">&quot;Sale of Building&quot;</span>: <span class="hljs-comment">&quot;Sale of Building&quot;</span>,
  <span class="hljs-comment">&quot;All agreements (such as written and oral month-to-month or lease agreements) you made with the old landlord are binding on the new \n        landlord. Similarly, the new landlord is bound to any legal orders or judgments: if the Department of Building Inspection ordered the old \n        landlord to make repairs, the new landlord must make those repairs; if the Rent Board has ordered rents reduced, the new landlord must follow \n        this order. The seller and buyer of a multi-unit building covered under the San Francisco Rent Ordinance must disclose to tenants (in writing) \n        that they cannot be evicted, have their rent increased, or have the terms of their tenancy changed just because the building is being sold or has sold. \n        Beware, though, many landlords try to use the sale or foreclosure of a building to intimidate tenants.&quot;</span>: <span class="hljs-comment">&quot;All agreements (such as written and oral month-to-month or lease agreements) you made with the old landlord are binding on the new \n        landlord. Similarly, the new landlord is bound to any legal orders or judgments: if the Department of Building Inspection ordered the old \n        landlord to make repairs, the new landlord must make those repairs; if the Rent Board has ordered rents reduced, the new landlord must follow \n        this order. The seller and buyer of a multi-unit building covered under the San Francisco Rent Ordinance must disclose to tenants (in writing) \n        that they cannot be evicted, have their rent increased, or have the terms of their tenancy changed just because the building is being sold or has sold. \n        Beware, though, many landlords try to use the sale or foreclosure of a building to intimidate tenants.&quot;</span>,
  <span class="hljs-comment">&quot;Short Term Rentals&quot;</span>: <span class="hljs-comment">&quot;Short Term Rentals&quot;</span>,
  <span class="hljs-comment">&quot;Short term vacation rentals replace long term housing stock in San Francisco and in cities across the world. In San Franicsco, \n        Airbnb has reduced vacant rental housing stock by as much as 43 percent, making homes even less affordable. At times, tenants are illegally \n        evicted and their rooms become Airbnb units.&quot;</span>: <span class="hljs-comment">&quot;Short term vacation rentals replace long term housing stock in San Francisco and in cities across the world. In San Franicsco, \n        Airbnb has reduced vacant rental housing stock by as much as 43 percent, making homes even less affordable. At times, tenants are illegally \n        evicted and their rooms become Airbnb units.&quot;</span>,
  <span class="hljs-comment">&quot;Glossary&quot;</span>: <span class="hljs-comment">&quot;Glossary&quot;</span>,
  <span class="hljs-comment">&quot;Source:&quot;</span>: <span class="hljs-comment">&quot;Source:&quot;</span>
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uipubliclocalesenhome.json"><a href="#toc"><a name="ui-public-locales-en-home-json">ui/public/locales/en/Home.json</a></a></h2>
<pre><code>{
  <span class="hljs-comment">&quot;Should I rent from this landlord?&quot;</span>: <span class="hljs-comment">&quot;Should I rent from this landlord?&quot;</span>,
  <span class="hljs-comment">&quot;Find out about a building and an owner&#x27;s history&quot;</span>: <span class="hljs-comment">&quot;Find out about a building and an owner&#x27;s history&quot;</span>,
  <span class="hljs-comment">&quot;Who really owns my building?&quot;</span>: <span class="hljs-comment">&quot;Who really owns my building?&quot;</span>,
  <span class="hljs-comment">&quot;Is it the person you give your check to every month, or a large network of corporations?&quot;</span>: <span class="hljs-comment">&quot;Is it the person you give your check to every month, or a large network of corporations?&quot;</span>,
  <span class="hljs-comment">&quot;What are my rights as a tenant?&quot;</span>: <span class="hljs-comment">&quot;What are my rights as a tenant?&quot;</span>,
  <span class="hljs-comment">&quot;Learn about San Francisco law and how it protects you, your family, and your roommates&quot;</span>: <span class="hljs-comment">&quot;Learn about San Francisco law and how it protects you, your family, and your roommates&quot;</span>,
  <span class="hljs-comment">&quot;Enter an address, business, landlord, or neighborhood view to see the connections we&#x27;ve found&quot;</span>: <span class="hljs-comment">&quot;Enter an address, business, landlord, or neighborhood view to see the connections we&#x27;ve found&quot;</span>
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uipubliclocalesenhome_old.json"><a href="#toc"><a name="ui-public-locales-en-home_old-json">ui/public/locales/en/Home_old.json</a></a></h2>
<pre><code>{
  <span class="hljs-comment">&quot;Learn about California law and how it protects you, your family, and your roommates&quot;</span>: <span class="hljs-comment">&quot;Learn about California law and how it protects you, your family, and your roommates&quot;</span>
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uipubliclocalesenlist.json"><a href="#toc"><a name="ui-public-locales-en-list-json">ui/public/locales/en/List.json</a></a></h2>
<pre><code>{
  &quot;APN (Block/Lot)&quot;: <span class="hljs-string">&quot;APN (Block/Lot)&quot;</span>,
  <span class="hljs-string">&quot;Year Built&quot;</span>: <span class="hljs-string">&quot;Year Built&quot;</span>,
  <span class="hljs-string">&quot;Zipcode&quot;</span>: <span class="hljs-string">&quot;Zipcode&quot;</span>,
  <span class="hljs-string">&quot;Property Class Code&quot;</span>: <span class="hljs-string">&quot;Property Class Code&quot;</span>,
  <span class="hljs-string">&quot;Type&quot;</span>: <span class="hljs-string">&quot;Type&quot;</span>,
  <span class="hljs-string">&quot;Date Filed&quot;</span>: <span class="hljs-string">&quot;Date Filed&quot;</span>,
  <span class="hljs-string">&quot;Rooms&quot;</span>: <span class="hljs-string">&quot;Rooms&quot;</span>,
  <span class="hljs-string">&quot;Stories&quot;</span>: <span class="hljs-string">&quot;Stories&quot;</span>,
  <span class="hljs-string">&quot;Land Value&quot;</span>: <span class="hljs-string">&quot;Land Value&quot;</span>,
  <span class="hljs-string">&quot;Improvement Value&quot;</span>: <span class="hljs-string">&quot;Improvement Value&quot;</span>,
  <span class="hljs-string">&quot;Last Sales Price&quot;</span>: <span class="hljs-string">&quot;Last Sales Price&quot;</span>,
  <span class="hljs-string">&quot;Date Updated&quot;</span>: <span class="hljs-string">&quot;Date Updated&quot;</span>,
  <span class="hljs-string">&quot;Office Address&quot;</span>: <span class="hljs-string">&quot;Office Address&quot;</span>,
  <span class="hljs-string">&quot;Date Registered&quot;</span>: <span class="hljs-string">&quot;Date Registered&quot;</span>,
  <span class="hljs-string">&quot;Corporation Number&quot;</span>: <span class="hljs-string">&quot;Corporation Number&quot;</span>,
  <span class="hljs-string">&quot;Corporation Type&quot;</span>: <span class="hljs-string">&quot;Corporation Type&quot;</span>,
  <span class="hljs-string">&quot;Status&quot;</span>: <span class="hljs-string">&quot;Status&quot;</span>,
  <span class="hljs-string">&quot;Tax Base&quot;</span>: <span class="hljs-string">&quot;Tax Base&quot;</span>,
  <span class="hljs-string">&quot;search the table&quot;</span>: <span class="hljs-string">&quot;search the table&quot;</span>,
  <span class="hljs-string">&quot;Search Table&quot;</span>: <span class="hljs-string">&quot;Search Table&quot;</span>,
  <span class="hljs-string">&quot;ABOUT THIS DATA&quot;</span>: <span class="hljs-string">&quot;ABOUT THIS DATA&quot;</span>,
  <span class="hljs-string">&quot;Source:&quot;</span>: <span class="hljs-string">&quot;Source:&quot;</span>,
  <span class="hljs-string">&quot;Notes:&quot;</span>: <span class="hljs-string">&quot;Notes:&quot;</span>,
  <span class="hljs-string">&quot;Ownership network containing&quot;</span>: <span class="hljs-string">&quot;Ownership network containing&quot;</span>,
  <span class="hljs-string">&quot;Related Ownership Networks&quot;</span>: <span class="hljs-string">&quot;Related Ownership Networks&quot;</span>,
  <span class="hljs-string">&quot;properties&quot;</span>: <span class="hljs-string">&quot;properties&quot;</span>,
  <span class="hljs-string">&quot;units&quot;</span>: <span class="hljs-string">&quot;units&quot;</span>,
  <span class="hljs-string">&quot;Owner Name&quot;</span>: <span class="hljs-string">&quot;Owner Name&quot;</span>,
  <span class="hljs-string">&quot;Owner Mailing Address&quot;</span>: <span class="hljs-string">&quot;Owner Mailing Address&quot;</span>,
  <span class="hljs-string">&quot;# of Units&quot;</span>: <span class="hljs-string">&quot;# of Units&quot;</span>,
  <span class="hljs-string">&quot;Evictions Filed&quot;</span>: <span class="hljs-string">&quot;Evictions Filed&quot;</span>
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uipubliclocalesenmap.json"><a href="#toc"><a name="ui-public-locales-en-map-json">ui/public/locales/en/Map.json</a></a></h2>
<pre><code><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">&quot;Evictions&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Evictions&quot;</span>
<span class="hljs-punctuation">}</span>
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uipubliclocalesenmethodology.json"><a href="#toc"><a name="ui-public-locales-en-methodology-json">ui/public/locales/en/Methodology.json</a></a></h2>
<pre><code>{
  <span class="hljs-comment">&quot;A list of parcels, addresses, and current parcel owners&quot;</span>: <span class="hljs-comment">&quot;A list of parcels, addresses, and current parcel owners&quot;</span>,
  <span class="hljs-comment">&quot;A list of all registered LLC and LP’s and corporations in California, along with their officers, owners, and mailing addresses&quot;</span>: <span class="hljs-comment">&quot;A list of all registered LLC and LP’s and corporations in California, along with their officers, owners, and mailing addresses&quot;</span>,
  <span class="hljs-comment">&quot;Ellis Act eviction data, buyout data, and all eviction notices&quot;</span>: <span class="hljs-comment">&quot;Ellis Act eviction data, buyout data, and all eviction notices&quot;</span>,
  <span class="hljs-comment">&quot;Our search feature may not list a property you are interested in.&quot;</span>: <span class="hljs-comment">&quot;Our search feature may not list a property you are interested in.&quot;</span>,
  <span class="hljs-comment">&quot;Sometimes the data we use for property information lists a range of addresses for a single property. E.g. if you are looking for 102 Main St and the property in our database is recorded as “100-104 Main St, it may not show up when you search. If you don’t find your property, try searching adjacent properties.&quot;</span>: <span class="hljs-comment">&quot;Sometimes the data we use for property information lists a range of addresses for a single property. E.g. if you are looking for 102 Main St and the property in our database is recorded as “100-104 Main St, it may not show up when you search. If you don’t find your property, try searching adjacent properties.&quot;</span>,
  <span class="hljs-comment">&quot;Sometimes properties located on corner lots will have units that are listed on several different cross streets. Because the property is only recorded in our database using one of the cross streets, it may be difficult to find on the EvictorBook.&quot;</span>: <span class="hljs-comment">&quot;Sometimes properties located on corner lots will have units that are listed on several different cross streets. Because the property is only recorded in our database using one of the cross streets, it may be difficult to find on the EvictorBook.&quot;</span>,
  <span class="hljs-comment">&quot;Our database contains all properties that are either currently residential properties or ones that have had an eviction recorded at them in the past.&quot;</span>: <span class="hljs-comment">&quot;Our database contains all properties that are either currently residential properties or ones that have had an eviction recorded at them in the past.&quot;</span>,
  <span class="hljs-comment">&quot;Our search feature may not list a business you are interested in.&quot;</span>: <span class="hljs-comment">&quot;Our search feature may not list a business you are interested in.&quot;</span>,
  <span class="hljs-comment">&quot;Our database contains businesses that are highly linked to the properties that they own. Often, to avoid creating connections between unrelated businesses, we have to remove businesses from the corporate networks that are not tightly connected to the network. For example, any company that is a property owner, or an evictor, or listed at the same address as the mailing address for a property, will all be in the database. However, businesses more distantly related might not be in the database. We recommend searching a property to find businesses in the network that are on the EvictorBook.&quot;</span>: <span class="hljs-comment">&quot;Our database contains businesses that are highly linked to the properties that they own. Often, to avoid creating connections between unrelated businesses, we have to remove businesses from the corporate networks that are not tightly connected to the network. For example, any company that is a property owner, or an evictor, or listed at the same address as the mailing address for a property, will all be in the database. However, businesses more distantly related might not be in the database. We recommend searching a property to find businesses in the network that are on the EvictorBook.&quot;</span>,
  <span class="hljs-comment">&quot;Looking up the name of a person associated with an eviction and not their business entity.&quot;</span>: <span class="hljs-comment">&quot;Looking up the name of a person associated with an eviction and not their business entity.&quot;</span>,
  <span class="hljs-comment">&quot;For now, you can only look up their business entity. For instance, you might know that Yat-Pang Au is the CEO and person associated with Veritas (San Francisco’s biggest landlord), but currently you have to search for Veritas or one of Vertitas’s LLCs and not Yat-Pang Au himself.&quot;</span>: <span class="hljs-comment">&quot;For now, you can only look up their business entity. For instance, you might know that Yat-Pang Au is the CEO and person associated with Veritas (San Francisco’s biggest landlord), but currently you have to search for Veritas or one of Vertitas’s LLCs and not Yat-Pang Au himself.&quot;</span>,
  <span class="hljs-comment">&quot;The owner percentages on the property pages may not add up to 100%.&quot;</span>: <span class="hljs-comment">&quot;The owner percentages on the property pages may not add up to 100%.&quot;</span>,
  <span class="hljs-comment">&quot;Our source data currently only lists one owner for each property, even when it is likely that multiple owners exist.&quot;</span>: <span class="hljs-comment">&quot;Our source data currently only lists one owner for each property, even when it is likely that multiple owners exist.&quot;</span>,
  <span class="hljs-comment">&quot;Some identical evictions are listed on multiple different properties, and some have either no or multiple evictors.&quot;</span>: <span class="hljs-comment">&quot;Some identical evictions are listed on multiple different properties, and some have either no or multiple evictors.&quot;</span>,
  <span class="hljs-comment">&quot;Sometimes there are multiple possible properties that correspond to the address listed on the eviction, and sometimes we find multiple evictors for an eviction record, or none at all. Overall we are able to find evictors for more than 90% of the eviction records.&quot;</span>: <span class="hljs-comment">&quot;Sometimes there are multiple possible properties that correspond to the address listed on the eviction, and sometimes we find multiple evictors for an eviction record, or none at all. Overall we are able to find evictors for more than 90% of the eviction records.&quot;</span>,
  <span class="hljs-comment">&quot;A business you are looking for may have different information than you were expecting.&quot;</span>: <span class="hljs-comment">&quot;A business you are looking for may have different information than you were expecting.&quot;</span>,
  <span class="hljs-comment">&quot;Sometimes businesses have multiple records attached to them, if they are filed, cancelled, and then later refiled. We use the information from either the active record, or if there are none, the most recently filed inactive record.&quot;</span>: <span class="hljs-comment">&quot;Sometimes businesses have multiple records attached to them, if they are filed, cancelled, and then later refiled. We use the information from either the active record, or if there are none, the most recently filed inactive record.&quot;</span>,
  <span class="hljs-comment">&quot;Some evictors and property owners appear to be businesses, but are not linked to a business page, or addresses that are listed separately but look like the same. &quot;</span>: <span class="hljs-comment">&quot;Some evictors and property owners appear to be businesses, but are not linked to a business page, or addresses that are listed separately but look like the same. &quot;</span>,
  <span class="hljs-comment">&quot;All of the records we use are quite messy, often with spelling errors from when the records were manually entered. We attempt to clean up these errors, but sometimes the errors are so strange that we cannot connect the records together.&quot;</span>: <span class="hljs-comment">&quot;All of the records we use are quite messy, often with spelling errors from when the records were manually entered. We attempt to clean up these errors, but sometimes the errors are so strange that we cannot connect the records together.&quot;</span>,
  <span class="hljs-comment">&quot;The evictor assigned to an eviction may be different than you expected.&quot;</span>: <span class="hljs-comment">&quot;The evictor assigned to an eviction may be different than you expected.&quot;</span>,
  <span class="hljs-comment">&quot;We determine the evictor for each eviction by searching the property owner at the time of the eviction from sales transfer records. Often this results in the correct owner, but because there are sometimes multiple transactions (e.g. between different trusts) that don’t represent transfers between different people, the evictor might look a bit strange.&quot;</span>: <span class="hljs-comment">&quot;We determine the evictor for each eviction by searching the property owner at the time of the eviction from sales transfer records. Often this results in the correct owner, but because there are sometimes multiple transactions (e.g. between different trusts) that don’t represent transfers between different people, the evictor might look a bit strange.&quot;</span>,
  <span class="hljs-comment">&quot;A property may be part of multiple possible ownership networks.&quot;</span>: <span class="hljs-comment">&quot;A property may be part of multiple possible ownership networks.&quot;</span>,
  <span class="hljs-comment">&quot;Our method to connect properties into ownership networks relies on owner mailing address lookups. Sometimes office buildings will have offices with different real estate companies. While we are able to distinguish between these companies, when we look up properties using a mailing address at those buildings, because of recording differences between our source data, we have to assume that the properties could be part of any of those companies.&quot;</span>: <span class="hljs-comment">&quot;Our method to connect properties into ownership networks relies on owner mailing address lookups. Sometimes office buildings will have offices with different real estate companies. While we are able to distinguish between these companies, when we look up properties using a mailing address at those buildings, because of recording differences between our source data, we have to assume that the properties could be part of any of those companies.&quot;</span>,
  <span class="hljs-comment">&quot;The related parcels list may be smaller or longer than you expected.&quot;</span>: <span class="hljs-comment">&quot;The related parcels list may be smaller or longer than you expected.&quot;</span>,
  <span class="hljs-comment">&quot;We are constantly learning more about these corporate ownership networks and improving our connection methods. We attempted to tune our method to be able to reproduce many large, widely known, corporate owner networks. However, because of the way that shell companies, investors, management companies, and even insurance companies, operate, unexpected connections sometimes appear. If you see something unexpected or simply wrong, please let us know!&quot;</span>: <span class="hljs-comment">&quot;We are constantly learning more about these corporate ownership networks and improving our connection methods. We attempted to tune our method to be able to reproduce many large, widely known, corporate owner networks. However, because of the way that shell companies, investors, management companies, and even insurance companies, operate, unexpected connections sometimes appear. If you see something unexpected or simply wrong, please let us know!&quot;</span>,
  <span class="hljs-comment">&quot;Connecting Properties and Business Entities&quot;</span>: <span class="hljs-comment">&quot;Connecting Properties and Business Entities&quot;</span>,
  <span class="hljs-comment">&quot;Properties are connected to business entities in one of two ways:&quot;</span>: <span class="hljs-comment">&quot;Properties are connected to business entities in one of two ways:&quot;</span>,
  <span class="hljs-comment">&quot;The property owner (as obtained from either the County Assessor officer, for current ownership, or sales transfer records, for past ownership) shares the same name as a business entity that is registered with the state, or&quot;</span>: <span class="hljs-comment">&quot;The property owner (as obtained from either the County Assessor officer, for current ownership, or sales transfer records, for past ownership) shares the same name as a business entity that is registered with the state, or&quot;</span>,
  <span class="hljs-comment">&quot;The property owner’s mailing address is listed at the same or similar address unit as a business entity is.&quot;</span>: <span class="hljs-comment">&quot;The property owner’s mailing address is listed at the same or similar address unit as a business entity is.&quot;</span>,
  <span class="hljs-comment">&quot;Connecting Properties, Evictions and Evictors&quot;</span>: <span class="hljs-comment">&quot;Connecting Properties, Evictions and Evictors&quot;</span>,
  <span class="hljs-comment">&quot;We connect each eviction to the propertie(s) on which they occurred by matching on the address provided in the eviction record. For evictions that cannot be merged using the address exactly (e.g. for corner lots that use different street names, or for currently non-existent addresses), we grab the longitude and latitude of the address and match it to the closest existing parcel.&quot;</span>: <span class="hljs-comment">&quot;We connect each eviction to the propertie(s) on which they occurred by matching on the address provided in the eviction record. For evictions that cannot be merged using the address exactly (e.g. for corner lots that use different street names, or for currently non-existent addresses), we grab the longitude and latitude of the address and match it to the closest existing parcel.&quot;</span>,
  <span class="hljs-comment">&quot;Since the eviction records do not list the evictor, we then match the eviction to the property owner at the time of eviction from sales transfer records. We consider that property owner the likely evictor.&quot;</span>: <span class="hljs-comment">&quot;Since the eviction records do not list the evictor, we then match the eviction to the property owner at the time of eviction from sales transfer records. We consider that property owner the likely evictor.&quot;</span>,
  <span class="hljs-comment">&quot;Because we sometimes find multiple address matches or multiple sales matches, we may be unable to connect each eviction to a single property and single evictor with 100% confidence. In these cases, we notify the user that these are not confident links.&quot;</span>: <span class="hljs-comment">&quot;Because we sometimes find multiple address matches or multiple sales matches, we may be unable to connect each eviction to a single property and single evictor with 100% confidence. In these cases, we notify the user that these are not confident links.&quot;</span>,
  <span class="hljs-comment">&quot;Determining Connections between Business Entities&quot;</span>: <span class="hljs-comment">&quot;Determining Connections between Business Entities&quot;</span>,
  <span class="hljs-comment">&quot;When businesses file with the Secretary of State, they list both addresses, “officers” (partners for LP’s or CEOs for corporations), and owners. These “officers” and owners can either be individuals or other business entities. Thus, we create connections between businesses when:&quot;</span>: <span class="hljs-comment">&quot;When businesses file with the Secretary of State, they list both addresses, “officers” (partners for LP’s or CEOs for corporations), and owners. These “officers” and owners can either be individuals or other business entities. Thus, we create connections between businesses when:&quot;</span>,
  <span class="hljs-comment">&quot;businesses share the same officer or owner, or&quot;</span>: <span class="hljs-comment">&quot;businesses share the same officer or owner, or&quot;</span>,
  <span class="hljs-comment">&quot;businesses list one another as an officer or owner.&quot;</span>: <span class="hljs-comment">&quot;businesses list one another as an officer or owner.&quot;</span>,
  <span class="hljs-comment">&quot;These connections allow us to create “property owner networks.” Each property owner network is a group of interconnected properties, property owners, corporate entities, corporate owners, and evictors. Property owners and evictors could be business entities themselves. Each network is formed by entities that are connected by relationships as defined in the image above.&quot;</span>: <span class="hljs-comment">&quot;These connections allow us to create “property owner networks.” Each property owner network is a group of interconnected properties, property owners, corporate entities, corporate owners, and evictors. Property owners and evictors could be business entities themselves. Each network is formed by entities that are connected by relationships as defined in the image above.&quot;</span>,
  <span class="hljs-comment">&quot;Methodology&quot;</span>: <span class="hljs-comment">&quot;Methodology&quot;</span>,
  <span class="hljs-comment">&quot;Data Sources&quot;</span>: <span class="hljs-comment">&quot;Data Sources&quot;</span>,
  <span class="hljs-comment">&quot;If you believe any information provided is inaccurate, please contact us through the feedback form and specifically explain the basis of your request for correction or deletion.&quot;</span>: <span class="hljs-comment">&quot;If you believe any information provided is inaccurate, please contact us through the feedback form and specifically explain the basis of your request for correction or deletion.&quot;</span>,
  <span class="hljs-comment">&quot;Connections&quot;</span>: <span class="hljs-comment">&quot;Connections&quot;</span>,
  <span class="hljs-comment">&quot;We connect the data from the sources above into a graph network that reveals the connections between properties, property owners, evictors, and business entities.&quot;</span>: <span class="hljs-comment">&quot;We connect the data from the sources above into a graph network that reveals the connections between properties, property owners, evictors, and business entities.&quot;</span>,
  <span class="hljs-comment">&quot;Graph Diagram&quot;</span>: <span class="hljs-comment">&quot;Graph Diagram&quot;</span>,
  <span class="hljs-comment">&quot;Common Issues &amp; Quirks&quot;</span>: <span class="hljs-comment">&quot;Common Issues &amp; Quirks&quot;</span>,
  <span class="hljs-comment">&quot;While we do our best to ensure that the data and connections shown on this site are as accurate as possible, and we will continue to improve our methods, there are limitations that you should be aware of. We encourage you, where possible, to verify findings on this site using other data sources as well.&quot;</span>: <span class="hljs-comment">&quot;While we do our best to ensure that the data and connections shown on this site are as accurate as possible, and we will continue to improve our methods, there are limitations that you should be aware of. We encourage you, where possible, to verify findings on this site using other data sources as well.&quot;</span>
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uipubliclocalesennetwork.json"><a href="#toc"><a name="ui-public-locales-en-network-json">ui/public/locales/en/Network.json</a></a></h2>
<pre><code>{
  <span class="hljs-comment">&quot;Business Entity (e.g. LLC)&quot;</span>: <span class="hljs-comment">&quot;Business Entity (e.g. LLC)&quot;</span>,
  <span class="hljs-comment">&quot;Business Owner&quot;</span>: <span class="hljs-comment">&quot;Business Owner&quot;</span>,
  <span class="hljs-comment">&quot;Business Address&quot;</span>: <span class="hljs-comment">&quot;Business Address&quot;</span>,
  <span class="hljs-comment">&quot;Property&quot;</span>: <span class="hljs-comment">&quot;Property&quot;</span>,
  <span class="hljs-comment">&quot;Property Owner&quot;</span>: <span class="hljs-comment">&quot;Property Owner&quot;</span>,
  <span class="hljs-comment">&quot;Evictor&quot;</span>: <span class="hljs-comment">&quot;Evictor&quot;</span>,
  <span class="hljs-comment">&quot;All&quot;</span>: <span class="hljs-comment">&quot;All&quot;</span>,
  <span class="hljs-comment">&quot;Businesses&quot;</span>: <span class="hljs-comment">&quot;Businesses&quot;</span>,
  <span class="hljs-comment">&quot;Properties&quot;</span>: <span class="hljs-comment">&quot;Properties&quot;</span>,
  <span class="hljs-comment">&quot;Businesses, People, and Addresses in this Ownership Network&quot;</span>: <span class="hljs-comment">&quot;Businesses, People, and Addresses in this Ownership Network&quot;</span>,
  <span class="hljs-comment">&quot;In total, there are {{numBusinesses}} businesses, {{numOwners}} business owners and {{numAddresses}} business or property owner addresses in this ownership network.&quot;</span>: <span class="hljs-comment">&quot;In total, there are {{numBusinesses}} businesses, {{numOwners}} business owners and {{numAddresses}} business or property owner addresses in this ownership network.&quot;</span>,
  <span class="hljs-comment">&quot;Ownership Network&quot;</span>: <span class="hljs-comment">&quot;Ownership Network&quot;</span>,
  <span class="hljs-comment">&quot;Due to inexact name matches, some businesses may be listed as business owners&quot;</span>: <span class="hljs-comment">&quot;Due to inexact name matches, some businesses may be listed as business owners&quot;</span>,
  <span class="hljs-comment">&quot;Ownership network data not found&quot;</span>: <span class="hljs-comment">&quot;Ownership network data not found&quot;</span>,
  <span class="hljs-comment">&quot;Businesses, People, and Addresses in this Ownership Network with ID {{networkId}}&quot;</span>: <span class="hljs-comment">&quot;Businesses, People, and Addresses in this Ownership Network with ID {{networkId}}&quot;</span>,
  <span class="hljs-comment">&quot;Property Portfolio&quot;</span>: <span class="hljs-comment">&quot;Property Portfolio&quot;</span>,
  <span class="hljs-comment">&quot;We have determined that the following buildings may be owned by this ownership network.&quot;</span>: <span class="hljs-comment">&quot;We have determined that the following buildings may be owned by this ownership network.&quot;</span>,
  <span class="hljs-comment">&quot;No portfolio properties found for this parcel.&quot;</span>: <span class="hljs-comment">&quot;No portfolio properties found for this parcel.&quot;</span>,
  <span class="hljs-comment">&quot;Property portfolios are created by identifying properties with the&quot;</span>: <span class="hljs-comment">&quot;Property portfolios are created by identifying properties with the&quot;</span>,
  <span class="hljs-comment">&quot;same mailing address(es). We associate properties with business ownership &quot;</span>: <span class="hljs-comment">&quot;same mailing address(es). We associate properties with business ownership &quot;</span>,
  <span class="hljs-comment">&quot;networks through either the name listed as the property owner (if it is a &quot;</span>: <span class="hljs-comment">&quot;networks through either the name listed as the property owner (if it is a &quot;</span>,
  <span class="hljs-comment">&quot;business) and through the property mailing addresses that are also business &quot;</span>: <span class="hljs-comment">&quot;business) and through the property mailing addresses that are also business &quot;</span>,
  <span class="hljs-comment">&quot;office addresses. Some business networks have multiple addresses. In counting &quot;</span>: <span class="hljs-comment">&quot;office addresses. Some business networks have multiple addresses. In counting &quot;</span>,
  <span class="hljs-comment">&quot;the number of evictions for a property, Ellis Act evictions are counted as &quot;</span>: <span class="hljs-comment">&quot;the number of evictions for a property, Ellis Act evictions are counted as &quot;</span>,
  <span class="hljs-comment">&quot;separate evictions for each unit.&quot;</span>: <span class="hljs-comment">&quot;separate evictions for each unit.&quot;</span>,
  <span class="hljs-comment">&quot;Properties for Ownership Network with ID {{networkId}}&quot;</span>: <span class="hljs-comment">&quot;Properties for Ownership Network with ID {{networkId}}&quot;</span>,
  <span class="hljs-comment">&quot;Containing&quot;</span>: <span class="hljs-comment">&quot;Containing&quot;</span>,
  <span class="hljs-comment">&quot;Network Connections&quot;</span>: <span class="hljs-comment">&quot;Network Connections&quot;</span>,
  <span class="hljs-comment">&quot;Below is the full set of network connections within this ownership network.&quot;</span>: <span class="hljs-comment">&quot;Below is the full set of network connections within this ownership network.&quot;</span>,
  <span class="hljs-comment">&quot;Large ownership networks are currently unable to be shown.&quot;</span>: <span class="hljs-comment">&quot;Large ownership networks are currently unable to be shown.&quot;</span>,
  <span class="hljs-comment">&quot;No related networks found.&quot;</span>: <span class="hljs-comment">&quot;No related networks found.&quot;</span>
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uipubliclocalesennetwork_old.json"><a href="#toc"><a name="ui-public-locales-en-network_old-json">ui/public/locales/en/Network_old.json</a></a></h2>
<pre><code>{
  <span class="hljs-comment">&quot;Large ownership networks are cuurrently unable to be shown.&quot;</span>: <span class="hljs-comment">&quot;Large ownership networks are cuurrently unable to be shown.&quot;</span>
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uipubliclocalesenowner.json"><a href="#toc"><a name="ui-public-locales-en-owner-json">ui/public/locales/en/Owner.json</a></a></h2>
<pre><code>{
  <span class="hljs-comment">&quot;Legend&quot;</span>: <span class="hljs-comment">&quot;Legend&quot;</span>,
  <span class="hljs-comment">&quot;Eviction&quot;</span>: <span class="hljs-comment">&quot;Eviction&quot;</span>,
  <span class="hljs-comment">&quot;Property&quot;</span>: <span class="hljs-comment">&quot;Property&quot;</span>,
  <span class="hljs-comment">&quot;Click an eviction or property on the map for details&quot;</span>: <span class="hljs-comment">&quot;Click an eviction or property on the map for details&quot;</span>,
  <span class="hljs-comment">&quot;About the Business&quot;</span>: <span class="hljs-comment">&quot;About the Business&quot;</span>,
  <span class="hljs-comment">&quot; is {{article}} {{status}} Limited Partnership, first registered {{date}} in {{jurisdiction}}, located at {{addresses}}.&quot;</span>: <span class="hljs-comment">&quot; is {{article}} {{status}} Limited Partnership, first registered {{date}} in {{jurisdiction}}, located at {{addresses}}.&quot;</span>,
  <span class="hljs-comment">&quot; is {{article}} {{status}} corporation first registered {{date}}, located at {{addresses}}.&quot;</span>: <span class="hljs-comment">&quot; is {{article}} {{status}} corporation first registered {{date}}, located at {{addresses}}.&quot;</span>,
  <span class="hljs-comment">&quot;Property Portfolio&quot;</span>: <span class="hljs-comment">&quot;Property Portfolio&quot;</span>,
  <span class="hljs-comment">&quot;The following buildings may be part of the same ownership network as &quot;</span>: <span class="hljs-comment">&quot;The following buildings may be part of the same ownership network as &quot;</span>,
  <span class="hljs-comment">&quot;No portfolio properties found for this parcel.&quot;</span>: <span class="hljs-comment">&quot;No portfolio properties found for this parcel.&quot;</span>,
  <span class="hljs-comment">&quot;Property portfolios are created by identifying properties with the&quot;</span>: <span class="hljs-comment">&quot;Property portfolios are created by identifying properties with the&quot;</span>,
  <span class="hljs-comment">&quot;same mailing address(es). We associate properties with business ownership &quot;</span>: <span class="hljs-comment">&quot;same mailing address(es). We associate properties with business ownership &quot;</span>,
  <span class="hljs-comment">&quot;networks through either the name listed as the property owner (if it is a &quot;</span>: <span class="hljs-comment">&quot;networks through either the name listed as the property owner (if it is a &quot;</span>,
  <span class="hljs-comment">&quot;business) and through the property mailing addresses that are also business &quot;</span>: <span class="hljs-comment">&quot;business) and through the property mailing addresses that are also business &quot;</span>,
  <span class="hljs-comment">&quot;office addresses. Some business networks have multiple addresses. In counting &quot;</span>: <span class="hljs-comment">&quot;office addresses. Some business networks have multiple addresses. In counting &quot;</span>,
  <span class="hljs-comment">&quot;the number of evictions for a property, Ellis Act evictions are counted as &quot;</span>: <span class="hljs-comment">&quot;the number of evictions for a property, Ellis Act evictions are counted as &quot;</span>,
  <span class="hljs-comment">&quot;separate evictions for each unit.&quot;</span>: <span class="hljs-comment">&quot;separate evictions for each unit.&quot;</span>,
  <span class="hljs-comment">&quot;Properties in the portfolio of Owner {{owner}}&quot;</span>: <span class="hljs-comment">&quot;Properties in the portfolio of Owner {{owner}}&quot;</span>,
  <span class="hljs-comment">&quot;Owner Details for &quot;</span>: <span class="hljs-comment">&quot;Owner Details for &quot;</span>,
  <span class="hljs-comment">&quot;Eviction History for this Ownership Network&quot;</span>: <span class="hljs-comment">&quot;Eviction History for this Ownership Network&quot;</span>,
  <span class="hljs-comment">&quot;The following evictions were conducted by businesses in the ownership network. &quot;</span>: <span class="hljs-comment">&quot;The following evictions were conducted by businesses in the ownership network. &quot;</span>,
  <span class="hljs-comment">&quot;Namely, a business in the network was the property owner at the time of the eviction. &quot;</span>: <span class="hljs-comment">&quot;Namely, a business in the network was the property owner at the time of the eviction. &quot;</span>,
  <span class="hljs-comment">&quot;This may include properties that are no longer owned by this network.&quot;</span>: <span class="hljs-comment">&quot;This may include properties that are no longer owned by this network.&quot;</span>,
  <span class="hljs-comment">&quot;No evictions recorded for this business.&quot;</span>: <span class="hljs-comment">&quot;No evictions recorded for this business.&quot;</span>,
  <span class="hljs-comment">&quot;Eviction records generally only include the address of the eviction. &quot;</span>: <span class="hljs-comment">&quot;Eviction records generally only include the address of the eviction. &quot;</span>,
  <span class="hljs-comment">&quot;Evictions were matched to parcel records and property ownership records. &quot;</span>: <span class="hljs-comment">&quot;Evictions were matched to parcel records and property ownership records. &quot;</span>,
  <span class="hljs-comment">&quot;As a result, some evictions were matched to multiple or no properties, if an exact &quot;</span>: <span class="hljs-comment">&quot;As a result, some evictions were matched to multiple or no properties, if an exact &quot;</span>,
  <span class="hljs-comment">&quot;match could not be found. Some evictions also include names on the filing, &quot;</span>: <span class="hljs-comment">&quot;match could not be found. Some evictions also include names on the filing, &quot;</span>,
  <span class="hljs-comment">&quot;which may be either property owners or lawyers involved in the case. For these, &quot;</span>: <span class="hljs-comment">&quot;which may be either property owners or lawyers involved in the case. For these, &quot;</span>,
  <span class="hljs-comment">&quot;we have shown the name identified through property records, and the additional &quot;</span>: <span class="hljs-comment">&quot;we have shown the name identified through property records, and the additional &quot;</span>,
  <span class="hljs-comment">&quot;names are those found on the eviction filing itself.&quot;</span>: <span class="hljs-comment">&quot;names are those found on the eviction filing itself.&quot;</span>,
  <span class="hljs-comment">&quot;Known evictions for Owner {{owner}}&quot;</span>: <span class="hljs-comment">&quot;Known evictions for Owner {{owner}}&quot;</span>,
  <span class="hljs-comment">&quot;No related networks found.&quot;</span>: <span class="hljs-comment">&quot;No related networks found.&quot;</span>
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uipubliclocalesenowner_old.json"><a href="#toc"><a name="ui-public-locales-en-owner_old-json">ui/public/locales/en/Owner_old.json</a></a></h2>
<pre><code><span class="language-xml">{
  &quot;Eviction History for this Business&quot;: &quot;Eviction History for this Business&quot;,
  &quot;Ownership Network&quot;: &quot;Ownership Network&quot;,
  &quot;This business does not appear to be part of a larger ownership network.&quot;: &quot;This business does not appear to be part of a larger ownership network.&quot;,
  &quot;</span><span class="hljs-template-variable">{{<span class="hljs-name">total_businesses</span>}}</span><span class="language-xml"> </span><span class="hljs-template-variable">{{<span class="hljs-name">business_text</span>}}</span><span class="language-xml">&quot;: &quot;</span><span class="hljs-template-variable">{{<span class="hljs-name">total_businesses</span>}}</span><span class="language-xml"> </span><span class="hljs-template-variable">{{<span class="hljs-name">business_text</span>}}</span><span class="language-xml">&quot;,
  &quot;,&quot;: &quot;,&quot;,
  &quot; </span><span class="hljs-template-variable">{{<span class="hljs-name">total_addrs</span>}}</span><span class="language-xml"> </span><span class="hljs-template-variable">{{<span class="hljs-name">addr_type</span>}}</span><span class="language-xml"> </span><span class="hljs-template-variable">{{<span class="hljs-name">addr_text</span>}}</span><span class="hljs-template-variable">{{<span class="hljs-name">addr_example</span>}}</span><span class="language-xml">&quot;: &quot; </span><span class="hljs-template-variable">{{<span class="hljs-name">total_addrs</span>}}</span><span class="language-xml"> </span><span class="hljs-template-variable">{{<span class="hljs-name">addr_type</span>}}</span><span class="language-xml"> </span><span class="hljs-template-variable">{{<span class="hljs-name">addr_text</span>}}</span><span class="hljs-template-variable">{{<span class="hljs-name">addr_example</span>}}</span><span class="language-xml">&quot;,
  &quot;, and&quot;: &quot;, and&quot;,
  &quot; </span><span class="hljs-template-variable">{{<span class="hljs-name">total_owners</span>}}</span><span class="language-xml"> </span><span class="hljs-template-variable">{{<span class="hljs-name">owner_text</span>}}</span><span class="hljs-template-variable">{{<span class="hljs-name">owner_example</span>}}</span><span class="language-xml">&quot;: &quot; </span><span class="hljs-template-variable">{{<span class="hljs-name">total_owners</span>}}</span><span class="language-xml"> </span><span class="hljs-template-variable">{{<span class="hljs-name">owner_text</span>}}</span><span class="hljs-template-variable">{{<span class="hljs-name">owner_example</span>}}</span><span class="language-xml">&quot;,
  &quot; is part of &quot;: &quot; is part of &quot;,
  &quot; with &quot;: &quot; with &quot;,
  &quot;.&quot;: &quot;.&quot;
}
</span></pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uipubliclocalesenparcel.json"><a href="#toc"><a name="ui-public-locales-en-parcel-json">ui/public/locales/en/Parcel.json</a></a></h2>
<pre><code>{
  <span class="hljs-comment">&quot;Ownership Network&quot;</span>: <span class="hljs-comment">&quot;Ownership Network&quot;</span>,
  <span class="hljs-comment">&quot;This property does not appear to be part of a larger ownership network.&quot;</span>: <span class="hljs-comment">&quot;This property does not appear to be part of a larger ownership network.&quot;</span>,
  <span class="hljs-comment">&quot;{{total_businesses}} {{business_text}}&quot;</span>: <span class="hljs-comment">&quot;{{total_businesses}} {{business_text}}&quot;</span>,
  <span class="hljs-comment">&quot;,&quot;</span>: <span class="hljs-comment">&quot;,&quot;</span>,
  <span class="hljs-comment">&quot; {{total_addrs}} {{addr_type}} {{addr_text}}{{addr_example}}&quot;</span>: <span class="hljs-comment">&quot; {{total_addrs}} {{addr_type}} {{addr_text}}{{addr_example}}&quot;</span>,
  <span class="hljs-comment">&quot;, and&quot;</span>: <span class="hljs-comment">&quot;, and&quot;</span>,
  <span class="hljs-comment">&quot; {{total_owners}} {{owner_text}}{{owner_example}}&quot;</span>: <span class="hljs-comment">&quot; {{total_owners}} {{owner_text}}{{owner_example}}&quot;</span>,
  <span class="hljs-comment">&quot; is part of an ownership network with &quot;</span>: <span class="hljs-comment">&quot; is part of an ownership network with &quot;</span>,
  <span class="hljs-comment">&quot;.&quot;</span>: <span class="hljs-comment">&quot;.&quot;</span>,
  <span class="hljs-comment">&quot;Legend&quot;</span>: <span class="hljs-comment">&quot;Legend&quot;</span>,
  <span class="hljs-comment">&quot;This Property&quot;</span>: <span class="hljs-comment">&quot;This Property&quot;</span>,
  <span class="hljs-comment">&quot;Related Properties&quot;</span>: <span class="hljs-comment">&quot;Related Properties&quot;</span>,
  <span class="hljs-comment">&quot;Click a property on the map for details&quot;</span>: <span class="hljs-comment">&quot;Click a property on the map for details&quot;</span>,
  <span class="hljs-comment">&quot;About the property&quot;</span>: <span class="hljs-comment">&quot;About the property&quot;</span>,
  <span class="hljs-comment">&quot; is a {{propertyType}} built in {{year}}. &quot;</span>: <span class="hljs-comment">&quot; is a {{propertyType}} built in {{year}}. &quot;</span>,
  <span class="hljs-comment">&quot;It has {{count}} units. &quot;</span>: <span class="hljs-comment">&quot;It has {{count}} unit. &quot;</span>,
  <span class="hljs-comment">&quot;It has {{count}} units. _plural&quot;</span>: <span class="hljs-comment">&quot;It has {{count}} units. &quot;</span>,
  <span class="hljs-comment">&quot;It is currently owned by &quot;</span>: <span class="hljs-comment">&quot;It is currently owned by &quot;</span>,
  <span class="hljs-comment">&quot;Since it was built before 1979, it is likely rent controlled.&quot;</span>: <span class="hljs-comment">&quot;Since it was built before 1979, it is likely rent controlled.&quot;</span>,
  <span class="hljs-comment">&quot;It is not likely rent controlled.&quot;</span>: <span class="hljs-comment">&quot;It is not likely rent controlled.&quot;</span>,
  <span class="hljs-comment">&quot;No rent control data is available.&quot;</span>: <span class="hljs-comment">&quot;No rent control data is available.&quot;</span>,
  <span class="hljs-comment">&quot;This property is also listed under {{addrText}}.&quot;</span>: <span class="hljs-comment">&quot;This property is also listed under {{addrText}}.&quot;</span>,
  <span class="hljs-comment">&quot;Eviction History at this Property&quot;</span>: <span class="hljs-comment">&quot;Eviction History at this Property&quot;</span>,
  <span class="hljs-comment">&quot; has {{count}} units and we have records of &quot;</span>: <span class="hljs-comment">&quot; has {{count}} unit and we have records of &quot;</span>,
  <span class="hljs-comment">&quot; has {{count}} units and we have records of _plural&quot;</span>: <span class="hljs-comment">&quot; has {{count}} units and we have records of &quot;</span>,
  <span class="hljs-comment">&quot;{{count}} Ellis Act {{evictionText}}{{endLink}}&quot;</span>: <span class="hljs-comment">&quot;{{count}} Ellis Act {{evictionText}}{{endLink}}&quot;</span>,
  <span class="hljs-comment">&quot;{{count}} Ellis Act {{evictionText}}{{endLink}}_plural&quot;</span>: <span class="hljs-comment">&quot;{{count}} Ellis Act {{evictionText}}{{endLink}}&quot;</span>,
  <span class="hljs-comment">&quot;{{startLink}} affecting the {{units}} units{{endLink}}&quot;</span>: <span class="hljs-comment">&quot;{{startLink}} affecting the {{units}} units{{endLink}}&quot;</span>,
  <span class="hljs-comment">&quot;{{startLink}}{{count}} {{otherText}}{{evictionText}}&quot;</span>: <span class="hljs-comment">&quot;{{startLink}}{{count}} {{otherText}}{{evictionText}}&quot;</span>,
  <span class="hljs-comment">&quot;{{startLink}}{{count}} {{otherText}}{{evictionText}}_plural&quot;</span>: <span class="hljs-comment">&quot;{{startLink}}{{count}} {{otherText}}{{evictionText}}&quot;</span>,
  <span class="hljs-comment">&quot;It was built in {{yearBuilt}}.&quot;</span>: <span class="hljs-comment">&quot;It was built in {{yearBuilt}}.&quot;</span>,
  <span class="hljs-comment">&quot;No evictions recorded for this address.&quot;</span>: <span class="hljs-comment">&quot;No evictions recorded for this address.&quot;</span>,
  <span class="hljs-comment">&quot;Eviction records generally only include the address of the eviction. &quot;</span>: <span class="hljs-comment">&quot;Eviction records generally only include the address of the eviction. &quot;</span>,
  <span class="hljs-comment">&quot;Evictions were matched to parcel records and property ownership records. &quot;</span>: <span class="hljs-comment">&quot;Evictions were matched to parcel records and property ownership records. &quot;</span>,
  <span class="hljs-comment">&quot;As a result, some evictions were matched to multiple or no properties, if an exact &quot;</span>: <span class="hljs-comment">&quot;As a result, some evictions were matched to multiple or no properties, if an exact &quot;</span>,
  <span class="hljs-comment">&quot;match could not be found. Some evictions also include names on the filing, &quot;</span>: <span class="hljs-comment">&quot;match could not be found. Some evictions also include names on the filing, &quot;</span>,
  <span class="hljs-comment">&quot;which may be either property owners or lawyers involved in the case. For these, &quot;</span>: <span class="hljs-comment">&quot;which may be either property owners or lawyers involved in the case. For these, &quot;</span>,
  <span class="hljs-comment">&quot;we have shown the name identified through property records, and the additional &quot;</span>: <span class="hljs-comment">&quot;we have shown the name identified through property records, and the additional &quot;</span>,
  <span class="hljs-comment">&quot;names are those found on the eviction filing itself.&quot;</span>: <span class="hljs-comment">&quot;names are those found on the eviction filing itself.&quot;</span>,
  <span class="hljs-comment">&quot;Eviction history for address {{address}}&quot;</span>: <span class="hljs-comment">&quot;Eviction history for address {{address}}&quot;</span>,
  <span class="hljs-comment">&quot;Owner&quot;</span>: <span class="hljs-comment">&quot;Owner&quot;</span>,
  <span class="hljs-comment">&quot;is a registered owner located at&quot;</span>: <span class="hljs-comment">&quot;is a registered owner located at&quot;</span>,
  <span class="hljs-comment">&quot;Records suggest that this property resulted from a subdivision, meaning that a parcel was split up into multiple parcels. There may be other parcels at the same location. &quot;</span>: <span class="hljs-comment">&quot;Records suggest that this property resulted from a subdivision, meaning that a parcel was split up into multiple parcels. There may be other parcels at the same location. &quot;</span>,
  <span class="hljs-comment">&quot;There appear to be additional owners for this property. &quot;</span>: <span class="hljs-comment">&quot;There appear to be additional owners for this property. &quot;</span>,
  <span class="hljs-comment">&quot;There may be additional owners for this property. &quot;</span>: <span class="hljs-comment">&quot;There may be additional owners for this property. &quot;</span>,
  <span class="hljs-comment">&quot;To verify, please check out the &quot;</span>: <span class="hljs-comment">&quot;To verify, please check out the &quot;</span>,
  <span class="hljs-comment">&quot;SF Recorder&#x27;s Office&quot;</span>: <span class="hljs-comment">&quot;SF Recorder&#x27;s Office&quot;</span>,
  <span class="hljs-comment">&quot;, where you can search this address to see the full list of owners.&quot;</span>: <span class="hljs-comment">&quot;, where you can search this address to see the full list of owners.&quot;</span>,
  <span class="hljs-comment">&quot;Property Portfolio&quot;</span>: <span class="hljs-comment">&quot;Property Portfolio&quot;</span>,
  <span class="hljs-comment">&quot;The following buildings may be part of the same ownership network as &quot;</span>: <span class="hljs-comment">&quot;The following buildings may be part of the same ownership network as &quot;</span>,
  <span class="hljs-comment">&quot;No portfolio properties found for this parcel.&quot;</span>: <span class="hljs-comment">&quot;No portfolio properties found for this parcel.&quot;</span>,
  <span class="hljs-comment">&quot;Property portfolios are created by identifying properties with the&quot;</span>: <span class="hljs-comment">&quot;Property portfolios are created by identifying properties with the&quot;</span>,
  <span class="hljs-comment">&quot;same mailing address(es). We associate properties with business ownership &quot;</span>: <span class="hljs-comment">&quot;same mailing address(es). We associate properties with business ownership &quot;</span>,
  <span class="hljs-comment">&quot;networks through either the name listed as the property owner (if it is a &quot;</span>: <span class="hljs-comment">&quot;networks through either the name listed as the property owner (if it is a &quot;</span>,
  <span class="hljs-comment">&quot;business) and through the property mailing addresses that are also business &quot;</span>: <span class="hljs-comment">&quot;business) and through the property mailing addresses that are also business &quot;</span>,
  <span class="hljs-comment">&quot;office addresses. Some business networks have multiple addresses. In counting &quot;</span>: <span class="hljs-comment">&quot;office addresses. Some business networks have multiple addresses. In counting &quot;</span>,
  <span class="hljs-comment">&quot;the number of evictions for a property, Ellis Act evictions are counted as &quot;</span>: <span class="hljs-comment">&quot;the number of evictions for a property, Ellis Act evictions are counted as &quot;</span>,
  <span class="hljs-comment">&quot;separate evictions for each unit.&quot;</span>: <span class="hljs-comment">&quot;separate evictions for each unit.&quot;</span>,
  <span class="hljs-comment">&quot;Properties in the same ownership network as {{property}}&quot;</span>: <span class="hljs-comment">&quot;Properties in the same ownership network as {{property}}&quot;</span>,
  <span class="hljs-comment">&quot;Parcel Details for &quot;</span>: <span class="hljs-comment">&quot;Parcel Details for &quot;</span>,
  <span class="hljs-comment">&quot;No related networks found.&quot;</span>: <span class="hljs-comment">&quot;No related networks found.&quot;</span>,
  <span class="hljs-comment">&quot;It has {{count}} units. _zero&quot;</span>: <span class="hljs-comment">&quot;It has no known units. &quot;</span>,
  <span class="hljs-comment">&quot; has {{count}} units and we have records of _zero&quot;</span>: <span class="hljs-comment">&quot; has no known units and we have records of &quot;</span>
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uipubliclocalesenparcel_old.json"><a href="#toc"><a name="ui-public-locales-en-parcel_old-json">ui/public/locales/en/Parcel_old.json</a></a></h2>
<pre><code>{
  <span class="hljs-comment">&quot;is the registered owner located at&quot;</span>: <span class="hljs-comment">&quot;is the registered owner located at&quot;</span>,
  <span class="hljs-comment">&quot;There may be additional owners for this property. To verify, please check out the &quot;</span>: <span class="hljs-comment">&quot;There may be additional owners for this property. To verify, please check out the &quot;</span>,
  <span class="hljs-comment">&quot;SF Recorders Office&quot;</span>: <span class="hljs-comment">&quot;SF Recorders Office&quot;</span>,
  <span class="hljs-comment">&quot; is part of &quot;</span>: <span class="hljs-comment">&quot; is part of &quot;</span>,
  <span class="hljs-comment">&quot; with &quot;</span>: <span class="hljs-comment">&quot; with &quot;</span>
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uipubliclocalesensearch.json"><a href="#toc"><a name="ui-public-locales-en-search-json">ui/public/locales/en/Search.json</a></a></h2>
<pre><code><span class="language-xml">{
  &quot;Search for an address, owner, or neighborhood in San Francisco&quot;: &quot;Search for an address, owner, or neighborhood in San Francisco&quot;,
  &quot;</span><span class="hljs-template-variable">{{<span class="hljs-name">state</span>}}</span><span class="language-xml"> results for </span><span class="hljs-template-variable">{{<span class="hljs-name">search</span>}}</span><span class="language-xml">&quot;: &quot;</span><span class="hljs-template-variable">{{<span class="hljs-name">state</span>}}</span><span class="language-xml"> results for </span><span class="hljs-template-variable">{{<span class="hljs-name">search</span>}}</span><span class="language-xml">&quot;,
  &quot;Search results for </span><span class="hljs-template-variable">{{<span class="hljs-name">search</span>}}</span><span class="language-xml">&quot;: &quot;Search results for </span><span class="hljs-template-variable">{{<span class="hljs-name">search</span>}}</span><span class="language-xml">&quot;
}
</span></pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uipubliclocalesensearch_old.json"><a href="#toc"><a name="ui-public-locales-en-search_old-json">ui/public/locales/en/Search_old.json</a></a></h2>
<pre><code><span class="language-xml">{
  &quot;Showing </span><span class="hljs-template-variable">{{<span class="hljs-name">count</span>}}</span><span class="language-xml"> results for </span><span class="hljs-template-variable">{{<span class="hljs-name">search</span>}}</span><span class="language-xml">&quot;: &quot;Showing </span><span class="hljs-template-variable">{{<span class="hljs-name">count</span>}}</span><span class="language-xml"> result for </span><span class="hljs-template-variable">{{<span class="hljs-name">search</span>}}</span><span class="language-xml">&quot;,
  &quot;Showing </span><span class="hljs-template-variable">{{<span class="hljs-name">count</span>}}</span><span class="language-xml"> results for </span><span class="hljs-template-variable">{{<span class="hljs-name">search</span>}}</span><span class="language-xml">_plural&quot;: &quot;Showing </span><span class="hljs-template-variable">{{<span class="hljs-name">count</span>}}</span><span class="language-xml"> results for </span><span class="hljs-template-variable">{{<span class="hljs-name">search</span>}}</span><span class="language-xml">&quot;
}
</span></pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uipubliclocalesenstatus.json"><a href="#toc"><a name="ui-public-locales-en-status-json">ui/public/locales/en/Status.json</a></a></h2>
<pre><code>{
  &quot;Loading <span class="hljs-selector-tag">Table</span>&quot;: <span class="hljs-string">&quot;Loading Table&quot;</span>,
  <span class="hljs-string">&quot;Page not found&quot;</span>: <span class="hljs-string">&quot;Page not found&quot;</span>,
  <span class="hljs-string">&quot;Data not available&quot;</span>: <span class="hljs-string">&quot;Data not available&quot;</span>,
  <span class="hljs-string">&quot;Error loading &quot;</span>: <span class="hljs-string">&quot;Error loading &quot;</span>
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uipublicmanifest.json"><a href="#toc"><a name="ui-public-manifest-json">ui/public/manifest.json</a></a></h2>
<pre><code>{
  &quot;short_name&quot;: <span class="hljs-string">&quot;Evictorbook&quot;</span>,
  <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;Evictorbook: Anti-Eviction Mapping Project&quot;</span>,
  <span class="hljs-string">&quot;icons&quot;</span>: [
    {
      &quot;<span class="hljs-attribute">src</span>&quot;: <span class="hljs-string">&quot;favicon.ico&quot;</span>,
      <span class="hljs-string">&quot;sizes&quot;</span>: <span class="hljs-string">&quot;64x64 32x32 24x24 16x16&quot;</span>,
      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;image/x-icon&quot;</span>
    }
  ],
  &quot;start_url&quot;: <span class="hljs-string">&quot;.&quot;</span>,
  <span class="hljs-string">&quot;display&quot;</span>: <span class="hljs-string">&quot;standalone&quot;</span>,
  <span class="hljs-string">&quot;theme_color&quot;</span>: <span class="hljs-string">&quot;#000000&quot;</span>,
  <span class="hljs-string">&quot;background_color&quot;</span>: <span class="hljs-string">&quot;#ffffff&quot;</span>
}</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uipublicmethodology_graph.jpg"><a href="#toc"><a name="ui-public-methodology_graph-jpg">ui/public/methodology_graph.jpg</a></a></h2>
<pre><code>���� JFIF      �� C       
 <span class="hljs-variable">$</span>.<span class="hljs-string">&#x27; &quot;,#(7),01444&#x27;</span><span class="hljs-number">9</span>=<span class="hljs-number">82</span>&lt;.<span class="hljs-number">342</span>�� C         <span class="hljs-number">2</span>!!<span class="hljs-number">22222222222222222222222222222222222222222222222222</span>�� X <span class="hljs-string">&quot; ��              
�� �   } !1AQa&quot;</span>q<span class="hljs-number">2</span>���<span class="hljs-comment">#B��R��$3br� </span>
%&amp;<span class="hljs-string">&#x27;()*456789:CDEFGHIJSTUVWXYZcdefghijstuvwxyz���������������������������������������������������������������������������            
�� �  w !1AQaq&quot;2�B����  #3R�br�
$4�%�&amp;&#x27;</span>()*<span class="hljs-number">56789</span>:CDEFGHIJSTUVWXYZcdefghijstuvwxyz��������������������������������������������������������������������������   ? ��(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
)���&amp;�<span class="hljs-comment">#E������5�sO%M��q�6˿����F�®MEy~����M?��3� �F�r�� �i2 ������ ��+�8:�����y��f����\�v�{��$�� �Ƹ�n�s�2Y_��L�[,�]d&gt;S��.m�ϙ&lt;I��8Y��-R�S�gQ�k�ӭ]�1�S�4Ӭ]��A� �Yz�`�&gt;�� ��E� �Ɵ� �)�4��������}.� Z�,������&quot;���� �Q� |����`�&gt;�[�7��p7�@�L���+Ps_�b�ue?U����-�6)�\���^_�_�r�^Q_,[x� \�Ǘx��n[�Jڴ����F���zI8?�3P���r�F�^1��m��ykk7���?�EuVt+�&lt;�n`&#x27;� $Q���Ұ��z</span>
��<span class="hljs-built_in">h</span>��;�Z&gt;��e���Ǣo�� �<span class="hljs-string">&#x27;��:�ŧf ��) QE QE QE QE QE QE QE QE QE QE QE QE QE QE QE QT�u};M�����$
O�u5�_|O�Ŏ�䜏���`UƜ����^Yw�J�?f�y=�P��Ƹ��?��ӭ��ۛ���`�&gt;��=���Y&gt;8���m�S� ��j�]����������W�9Y��i��Y_�kj�X�� *�?o�~�O�#��e� ٍ&#x27;</span>����+�-~:X�ƘT�������a�w�<span class="hljs-number">7</span>�,�=��e?��O�Y�<span class="hljs-literal">-e</span>�B��<span class="hljs-built_in">h</span>��/hZ��U�v=�k��ֽb��B
(��Q<span class="hljs-selector-tag">@</span>Q<span class="hljs-selector-tag">@</span>Q<span class="hljs-selector-tag">@</span>Q<span class="hljs-selector-tag">@</span>Q<span class="hljs-selector-tag">@</span>Q<span class="hljs-selector-tag">@</span>Q<span class="hljs-selector-tag">@</span>Q<span class="hljs-selector-tag">@</span>Q<span class="hljs-selector-tag">@</span>Q<span class="hljs-selector-tag">@</span>Q<span class="hljs-selector-tag">@</span>Q<span class="hljs-selector-tag">@</span>Q<span class="hljs-selector-tag">@</span>Q<span class="hljs-selector-tag">@</span>Q<span class="hljs-selector-tag">@</span>Q<span class="hljs-selector-tag">@</span>ɦ���i<span class="hljs-number">8</span>�K;��P;�^C�?���tg0��������~��*<span class="hljs-number">3</span>���s�<span class="hljs-number">5</span>��C����<span class="hljs-string">&quot;�i���p+�&lt;A����M�;E��Ē�#��%���dvi9&lt;�������Ӈū)D�u_jZ��e���ݚg-���+[ۙ���G�8��(����(��`QE QE QE QE QE ��*�O�8���/C�]�G�7�ن^��h5�,��Lc�Y���ǧ&lt;�¸*e�ZJ�}�|X����1���lg|y�ֻ�.!��f��%��U�`����b�H_|nU�Eu��棠܆�,1���� ���W\^�����xW�6&#x27;��dCx�� &#x27;&lt;z��+��6P���ET�QE QE QE QE QE QE QE QE QE QE QE S%�8&quot;</span>ie�c�Y���MT��kMM���M�F:�{�k�o|F�|Ir�F�+E?<span class="hljs-variable">$H</span>~Q����?�tP�ʫ�W=W��m<span class="hljs-comment">#tV#�����;��1�^Y��W��Y��?������Mp���Y�$�$�W�O</span>N<span class="hljs-string">&quot;�s�W�ZK����⪒X�O���� ��)�QE QE QE,W3���WQ��t�7��V��_,9_���~��QR⤬��῍6�% ֭��&lt;y��~j��+�4�R�V�Q�Eܡ�}�־9��x�S���\Z\:���=�=�q��BZ�F&#x27;�Z+��g�m&lt;[����;���b������}5ys����QREPEPEPEPEPEPEPEPEPEPEPEPEPEOW�k=��&gt;�6�H�P�� Ji]���㆞�M.�C�Xc ��:�����x����<span class="hljs-variable">$b</span>�z�Wu�ZME�v��ߟ�Y��Ӧ��EQZ QEn�C�rx�Ķ�JJ!Y2�I��@2p;�O�L�����Tg��-����ZJ��C��|�h��b��L�qs)�K��W�����4��&#x27;�W�.R�C�H�5��E���Nx=1��VӚJ˧w���z߀�P��o�h&gt;\:n� ����d���ר8⵼m��I��^hַ�]Z\����7��7�?�1�@&lt;c��!t���&amp;���D�_�YYYi����o�&amp;�Iw|&#x27;�a�q��rG��M&amp;k�k�Z�ǡ�w<span class="hljs-variable">$</span>i�k��@l/;x�ׯ��T�� +�aEz� �ƿ���&amp;��oaq�����  �ߜ����� �&gt;Ѵ���5�ݡ���Gtk�<span class="hljs-variable">$</span> ��� ����]�s˨�^?t���L�&gt;&amp;Kz BA��
&gt;�H#&#x27;�b�xC�&amp;�e&#x27;۬5#uej�_�,�aLu�R���R��,䵰�yU���x/�~��a��t��[���w/!h�Op9��G�~�4�2��~6�[{�&gt;�hwn������}O_���ӿa��j+�m����h&quot;</span>\o��C��Q���\��j���+A��|m}�������<span class="hljs-number">1</span>~VC��� xe�s�z���t�?��<span class="hljs-number">4</span>QEnEPƁ�\�<span class="hljs-number">7</span>���<span class="hljs-comment">#e$�?��+��</span>
��?�q^�<span class="hljs-number">2</span>��t��=�}k����Ҽ�v�ģ۬�{�m��\x�jT���I�EW�@QE QE QE QE QE QE QE QE QE QE QE�?����m��F�z�g?��<span class="hljs-number">5</span>��&lt;?<span class="hljs-number">4</span>�m�����ن<span class="hljs-built_in">H</span>��� �k������+-��(��
�|�<span class="hljs-number">7</span>��O�+dC-Ī<span class="hljs-number">9</span>Uq��?�U�W��<span class="hljs-number">3</span>��W�&lt;{uj�M���*�y� �\~�-ϩ���JJ���� &lt;+��?iڗ� ���f��<span class="hljs-variable">$</span>ɍ��=̇�~<span class="hljs-number">8</span>�a�|<span class="hljs-number">5</span>f�lf�uX.���M|<span class="hljs-variable">$</span>�YrL|��ߊ�%��c?�}@C�M;Q��-�mb���,s�<span class="hljs-string">&#x27;�΢ռK�M&quot;�J�-Zm[S��!���2V(�U���s��޹!*�\�{�1jrZw��_�ڄ:ͽ��zҤVW_ ����W��8=sT|9�]CY���A����?�` �  ��}��du�O�mnyn�a�{���wK#�!� ��=k_�_�?�F� Xx���M@�b2cX�Q���z����V�N������_|5�&lt;kc��jP����,���&#x27;</span>ul�<span class="hljs-comment">#�j���D��4���vw�ڕ��8 �H s�s�zWYc�[��=wY񦗨���Ea&quot;��l�}���R3ϵ`��Q��`ӣ����]Gt�&gt;�f&quot;HA8i)�ׯ�ޥT��� ��b�­F����^#�+����֏��8y}qL��Y�xj�&#x27;�_�%�$b�mm�&gt;�϶C�}kK�����\��Q�x�r��m9�I����]oW��o�L�*��=��ƅ�Cm����y�ք�j��� ���5&lt;�R���R�����V�!O�����&quot;��Ew!�QL�ᦳ6���=�DrH�x*�)�y��_O��|?&gt;��i�&quot;�v</span>
�Ԁ?�^��}�շ&amp;AEW   !EPEPEPEPEPEPEPEPEPEPEPEPEPQ][�ݤ��}ɣ<span class="hljs-type">h</span>��<span class="hljs-type">b</span>���&gt;<span class="hljs-type">M</span>�^�<span class="hljs-type">q</span>���<span class="hljs-type">E2</span>�<span class="hljs-number">9</span>���:�+���� ��Ė�����<span class="hljs-type">J</span>�;{<span class="hljs-number">0</span>����<span class="hljs-type">T</span>Ѯ<span class="hljs-type">t</span>ˉ<span class="hljs-type">H</span>�<span class="hljs-type">v1</span>��<span class="hljs-type">d</span>&gt;�<span class="hljs-type">W</span>�<span class="hljs-type">B</span>���<span class="hljs-number">4</span><span class="hljs-type">N</span>�<span class="hljs-type">m</span><span class="hljs-type">Q</span>[�<span class="hljs-type">V</span>�����<span class="hljs-type">k</span>������<span class="hljs-number">9</span><span class="hljs-type">F</span>��<span class="hljs-type">A</span>��<span class="hljs-type">M</span>�<span class="hljs-type">MY</span>���~+�<span class="hljs-type">i</span><span class="hljs-type">m4</span>��<span class="hljs-type">B</span>�;�<span class="hljs-number">8</span>�<span class="hljs-selector-tag">@</span>���<span class="hljs-type">q</span>�������<span class="hljs-type">gG</span>��%���<span class="hljs-type">ip</span>�<span class="hljs-type">K</span>���<span class="hljs-number">98</span>�޼Ί��<span class="hljs-type">G</span>���Ǫ<span class="hljs-type">Z</span>�<span class="hljs-type">U</span>�<span class="hljs-type">mu</span>�<span class="hljs-type">.</span>`����<span class="hljs-type">a5</span>��(��<span class="hljs-type">v</span>*<span class="hljs-type">As</span>�&amp;;��<span class="hljs-type">y</span>�<span class="hljs-number">3</span>\��<span class="hljs-type">R</span><span class="hljs-comment">#�o��,�;vI�&amp;�`G������.����;���x��������j�ic�2 �Pq��\��x���֍�&#x27;�t�VK�6�m��݀�� ���\O���S��KK�U���ck��}��Cm��-&gt;��0 9���t���Mq�?�:���u?�ս��d[ ������&lt;�+ӥy%?V��@��?Ʃ�կf�m������%[�Wbz�G�z�4����I���?���$r}�.�4�+�g$瞦�**�-�o�,uZ_��l���9~�{&lt;R���+)`���������^נ����/U���� �8���0�� ���tQ*1n�c�W�G&amp;�qm����Y�k��o)P��&#x27;���� {�_��%���;�i�-��&#x27;�|T�I&#x27;�;g��zzs��RXzi� �</span>
(�� ��<span class="hljs-type">tq</span>��<span class="hljs-number">5</span>,Ǡ <span class="hljs-string">&quot;4���,� W�?�G�Ӯu+�YxX�3�������[��;e?������o���������+[h�pġG`+���J&gt;�n)2j(����(��(��(��(��(��(��(��(��(��(��(�
��Vڕ��wq,�J�]z�?�,����Nqe��� x�^�J��ލyRzl4�|c,2B�<span class="hljs-variable">$B</span>��i��G�m±Y&#x27;� �M��-�ϫ���MqZ��]b�L���;���l~�קON{��&lt;����|/��R��쥍�J���YRC,_�#u��WJi�1�QE0
(��
(��
(�*3�&quot;</span>�&gt;�<span class="hljs-type">f</span>�<span class="hljs-type">E</span>]��<span class="hljs-type">o</span>�]R+g,��.����    �C��im��<span class="hljs-number">3</span>�S~����*%<span class="hljs-number">8</span>�Y;� X�<span class="hljs-variable">$</span>���
xT�-���?&lt;�¯�� A�w:�|<span class="hljs-number">3</span>�c�<span class="hljs-variable">$K</span>���<span class="hljs-number">0</span>���<span class="hljs-number">1</span>�&lt;t�<span class="hljs-built_in">oH</span>��nm<span class="hljs-number">4</span>��ZG (� tt�*��)�<span class="hljs-string">&#x27;&quot;��|3c�}1m-s�e#�����(�2RrwdQH�(��(��(��(��(��(��(��(��(��(��(��(��(��(��&lt;E�/đ�t�&gt;{Q��+~�����,�&lt;O�S���&gt;|�:�r1��u�޸�6��$ǹ����^!�^����d�.�[�r������A����w�ZG�Q �n�x%���=k��=�4R���W�k?c�������+�����W�|,�l ?`�e�� L?��G�]��R�̫����n|?}l�0��X?��Oauށ� ��Z�^�VVS�R&gt;���Q@Q@Q@T���&quot;v�)�諱�W��=�Վ+WO�v����M?�p����I��������ј���=&#x27;</span>�ޭq��b��}n<span class="hljs-variable">$</span>�� �W?�w�G�)��K����<span class="hljs-number">9</span>�k�x�P�A]�xOQծV`�I���w��޽{¿�<span class="hljs-number">6</span>�T�f������ν<span class="hljs-number">2</span>���O�Agm���ҬW\l�t���<span class="hljs-number">6</span>�<span class="hljs-variable">$</span>�<span class="hljs-variable">$QF6</span>� ��T�Q\D�Q<span class="hljs-selector-tag">@</span>Q<span class="hljs-selector-tag">@</span>Q<span class="hljs-selector-tag">@</span>Q<span class="hljs-selector-tag">@</span>Q<span class="hljs-selector-tag">@</span>Q<span class="hljs-selector-tag">@</span>Q<span class="hljs-selector-tag">@</span>Q<span class="hljs-selector-tag">@</span>Q<span class="hljs-selector-tag">@</span>Q<span class="hljs-selector-tag">@</span>Q<span class="hljs-selector-tag">@</span>Q<span class="hljs-selector-tag">@</span>`�������G�y &gt;L�{�E�\���<span class="hljs-number">5</span>q��&lt;za�..dQu&lt;��<span class="hljs-built_in">h</span>��=� y~�-߈�ic%봲Op����<span class="hljs-built_in">H</span>� ׼�)m�{};�:D���[<span class="hljs-comment">#ݎ�&gt;��c��W@</span><span class="hljs-type">x</span>�<span class="hljs-type">T</span>)<span class="hljs-string">&quot;+��dż�w�����6���%��渭�*�)Gg`8K��~��#��� ���%5�s�?I���P�?�����W�QZ�MU��vx��    ��5e�a#� f5 ���S��uj��*��[�]�2����(q��[��]��e�3��� ҽn�O[�]�sk�k�Аf��B?��5�g���Xۦ��+�~���]E�U������e`�,� �_H����V-�qύ�8&lt;A�7������=���y&amp;��]���F���s�l�%��s����۵}T���kx!@�c&lt;��7 �{s�� ���[���ue��_[�6�23!�  
?S[���������!�B �����x�L�/�l�.U�-ث���u#�g���c�~)В�tt��H�&amp;� U��\Il3����r;����o��&lt;Ou�����7gk�r S�9�rG#ֻ�P�U�*F=y����/L��[�ók�[���H��Xl���G³�眞1� ��om�/m<span class="hljs-variable">$</span>�-�#D�Hܤdy=xe��%��5E�j��x�M����d���l    ?6:
��x�B񵟝�\�tPe��,U�9�2(���( ��( ��( ��( ��( ��( ��( ��( ��( ��( ��( ����A�y^��6:D�4M2I<span class="hljs-variable">$</span>�A#��J���I�� � |A��^!Ӵ��{�ĳL�52�Cj�μ�ؚ�b�)��2���l`v��:�^w�k�:��-&#x27;V��}Z���S]R͚&lt;�u�<span class="hljs-variable">$</span>���c���{O��;�x_J]7J�� b�Y�4�z�1��@���E�ͤ̚D�CxG��.�}����X:��m��r�H�  .��XH��Jz���?PԠ���&amp;�RYV�vd�NX�\��׮|4Ӿ��U�e����{�(�D�5���oO���y%Q��ӇOǸ��4���k8���`�3@(�� �{x.Sd��*vE?Zļ�G��rdҠB{Ø� �+���3�~`8���z`v=�^�(#��n&gt;�g��륺��&quot;</span>�<span class="hljs-number">6</span>��<span class="hljs-type">bj</span>��;����%�<span class="hljs-type">v_</span>ڑ�  <span class="hljs-type">_</span>�<span class="hljs-type">j</span>�����<span class="hljs-comment">#�.+�(���n��Ϟ��2xz&amp;�6�,��E#���{����� y�M����Z�&gt;!C-̺1���*��8�u�ڏ������   �� �K��oo�\��`�]F�ݵ���W��C�V���o�\Dy����d���Z�� �5&lt;�&#x27;���b?�WaEC��h.̛OhVX6�M���� �?�Z�    ���rov ��) QE QE QE QE QE QE QE QE QE QE QE QX�&quot;�V��;Xn��崆i&lt;�أ6[��8zV���7v�\�ʲ�2  #�UԌ��%Q@Q@���o�i��7m�8��z��5gM�:��ox`�9�r}��r��}�,7��E��8&gt;Y���#����</span>
(��
(��
(��
(��
(��
(��
(��
(��
�|<span class="hljs-type">K</span>���<span class="hljs-number">9</span>���<span class="hljs-type">K</span>�-^<span class="hljs-number">3</span>�<span class="hljs-type">eC</span>�!� <span class="hljs-type">k</span>�� &lt;�<span class="hljs-type">UE</span> <span class="hljs-type">c</span>�<span class="hljs-type">j</span>�<span class="hljs-type">W</span>�ҁ֭<span class="hljs-type">V</span>�<span class="hljs-type">r</span>���<span class="hljs-type">L</span>��<span class="hljs-type">kb</span>��<span class="hljs-type">n</span>�]y�x�[]v�E�L��Qe��z����P��<span class="hljs-number">7</span>�W����<span class="hljs-number">5</span>x,�vp^�a�xRI ������Zߋ���=~�B�ӭ���{u��!Z7Ϝ��&gt;�b���X�%��<span class="hljs-built_in">H</span>�nWS�G�<span class="hljs-number">5</span>����/��<span class="hljs-number">5</span>X��j�Ky���x���g�� ��<span class="hljs-number">7</span>��.!����P�y��<span class="hljs-number">1</span>�U�rJ�܅l6�k��F��B�{oy����ԍu��%�p�&amp;⑮gc�y���;�<span class="hljs-built_in">R</span>���Z�V;����i���!Abz� ��*+i����WU��ȥX<span class="hljs-number">3</span>� �T� QE QE QE QE QE QE QE QE QEG&lt;�[[�<span class="hljs-type">q</span>&lt;�<span class="hljs-number">1</span>!<span class="hljs-type">wv8</span>
�<span class="hljs-type">d</span>�}<span class="hljs-number">1</span><span class="hljs-selector-tag">@</span><span class="hljs-type">W</span>��<span class="hljs-type">F</span>�<span class="hljs-type">Y_</span>�ڧ��<span class="hljs-number">5</span><span class="hljs-type">Xg</span>�<span class="hljs-type">I</span>���)<span class="hljs-type">Q</span><span class="hljs-type">o</span>{�ƪ<span class="hljs-type">c</span> �\�<span class="hljs-string">&#x27;�ׁ[ڟ�ۻ?��Vp������f�fax��a!�6�^;��z����e�&lt;Mk
\2#���*��3����G����Ѷ�����دsv���E�`�0�8��uU-WT�Ѵٯ��lQ�������I�����l-��ҡ1DN7�۽s����&amp;���&amp;�y�9~���?__˵ohښk:M��p�
̹    ��=^��(��(��(��(��(���|C&lt;��&#x27;</span>���<span class="hljs-type">WT</span>*]�<span class="hljs-type">X</span>�ܞ��+���(��(��(��(��(��(��(��(��(��(��(��(��(��(��+�~)<span class="hljs-type">x</span>��<span class="hljs-type">E</span>ў�<span class="hljs-type">L</span>ʓ<span class="hljs-type">mK</span>�<span class="hljs-type">o9K</span>�[<span class="hljs-type">y</span>  <span class="hljs-type">Q</span>:�����<span class="hljs-type">x</span>��<span class="hljs-type">rx</span>���<span class="hljs-number">6</span><span class="hljs-type">z</span>���֙<span class="hljs-type">v</span>�<span class="hljs-type">i</span>��̊<span class="hljs-number">5</span>�<span class="hljs-variable">$</span>,��<span class="hljs-number">4</span>� �<span class="hljs-variable">$</span>�^���<span class="hljs-type">F</span>��<span class="hljs-number">4</span>/<span class="hljs-number">5</span>�<span class="hljs-type">BGy</span>� �<span class="hljs-number">9</span><span class="hljs-type">ch</span>ⲍ
�[�����<span class="hljs-type">c</span>��<span class="hljs-number">5</span>��<span class="hljs-type">a</span>�[��㽴בŪ�<span class="hljs-number">0</span>��{�墕<span class="hljs-type">N8W</span>ܥ�+���<span class="hljs-type">r</span>�<span class="hljs-number">5</span>�-��<span class="hljs-type">W</span>�՝<span class="hljs-type">b</span>�{�<span class="hljs-comment">#p���&amp;�0u� ���]A�Kb�&#x27;����]�8�ځ9 �6G~��N��p�i�yo��[��M�X_5����m�?1D9)��I���=&gt;��l��t-&gt;�i&lt;�m����?x��O�@���Ņ���5�%��Z8�q�s���5-B</span>+<span class="hljs-type">M</span>���)���<span class="hljs-selector-tag">@</span>=���<span class="hljs-type">C</span>�:<span class="hljs-type">u</span>Ʃ}<span class="hljs-type">q</span>�<span class="hljs-type">M</span><span class="hljs-type">rJ</span>�!� �<span class="hljs-type">i</span>�<span class="hljs-comment">#��{gր;�(��</span>
(��
(��
(��
(��
(��
(��
(��
(��
(��
����<span class="hljs-type">oi</span>{
��<span class="hljs-type">U</span>���&gt;�<span class="hljs-type">f</span>� �����圶��<span class="hljs-type">O</span>&lt;<span class="hljs-type">O</span>!<span class="hljs-type">t</span>��= ���\<span class="hljs-number">0</span><span class="hljs-variable">$</span>�<span class="hljs-type">FGQ</span>�<span class="hljs-type">K</span>\<span class="hljs-type">F</span>��<span class="hljs-type">k</span>^�/��?&lt;���<span class="hljs-number">76</span>�<span class="hljs-type">K</span>   �Ƿ<span class="hljs-type">Q</span>�Ҁ:��&gt;�<span class="hljs-type">PH</span>�����<span class="hljs-type">cq</span><span class="hljs-string">&quot;,ч
ã�=küi����2[�wj/��}�4A�ɒ���8�*�&#x27; Ez���Km�K&amp;�x����p�{�m���W�
������+MGMH`�6�2���M�71����ֽ:���(/-dYm�e�ף+����x*�z���Z���l�cwa��A�
)R��rrry�ß5�#G��t�4��:X�.�a4�ïʥ�����;� }EW����2�[�&#x27;0��Q��8ꭎ��Պ (�� (�� (�� (�� (�� (�� (�� +;#j7^!���������/nd?rH�d��3��G�ox�����:&amp;�/�jBC�؎�4\������5��!�g�ou}SB{+;�a-�5i^B&amp;Ҧ�2H&gt;�p9S�?Z ���e�ě�2�U����D�C�y E3�}�!)��\��cEDP��U z
�����]�Z�CQ�&#x27;b�ǫ &#x27;�}j� ������Z�jV�[�{eP���&gt;�s�:�]��,5-j�K�.�ڌ��r������UQ*�� `KE QE QE QE QE QE���z[�i�瞂XLf&quot;</span>�<span class="hljs-type">H</span>~<span class="hljs-type">s</span>� �<span class="hljs-type">t</span>�����<span class="hljs-type">h</span>�<span class="hljs-type">_</span>���<span class="hljs-number">0</span>�����+<span class="hljs-type">J</span>�
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��)�ڝ���]<span class="hljs-type">jw</span>~<span class="hljs-type">g</span>٭<span class="hljs-type">c2</span>�<span class="hljs-type">cB</span>�<span class="hljs-type">rN</span>�<span class="hljs-type">x7</span>�<span class="hljs-type">uY</span>|<span class="hljs-type">S</span>�شˍ:<span class="hljs-type">k</span>���<span class="hljs-number">8</span>��<span class="hljs-type">R</span>]<span class="hljs-number">2</span>�<span class="hljs-type">A</span>�<span class="hljs-number">8</span><span class="hljs-type">dm</span>���<span class="hljs-type">zc</span>�}<span class="hljs-type">WP</span>�<span class="hljs-type">u</span>���!^<span class="hljs-type">Y</span>��<span class="hljs-type">.</span>�����<span class="hljs-type">_</span>�<span class="hljs-type">f</span>�<span class="hljs-type">h</span>��<span class="hljs-type">T</span>�<span class="hljs-type">g</span>|��<span class="hljs-type">nzWM</span>�������<span class="hljs-number">4</span>����,!<span class="hljs-number">0</span><span class="hljs-type">YH</span>�<span class="hljs-type">Y</span>�<span class="hljs-type">s</span><span class="hljs-string">&#x27;����$=h�����=�L�W�m�X�� ��` N 漃�g�!�   ���i#�r���#�4.�D��W#,NF@�y�P��-|=qee�;��F��mm-P�h��B��k��?���2�����N�u(��Z e�&gt;�L��˔W�s���� z?��h|]z�^�β�$$���*&lt;�C�ّ�`cw�����T�5��  � s�3� ��Ķ�t|�u^H=���Ƞ��+�YX$�0*���A��4�$�4T� UU �V&#x27;</span>�<span class="hljs-type">t</span>&amp;�<span class="hljs-number">4</span>��<span class="hljs-type">b</span>�<span class="hljs-number">2</span><span class="hljs-number">6</span><span class="hljs-type">rN</span>@<span class="hljs-type">s</span>�}:<span class="hljs-type">V</span>� <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">G</span>�<span class="hljs-type">d1D</span>�<span class="hljs-type">dm</span>�<span class="hljs-type">U</span><span class="hljs-selector-tag">@</span>�ާ��<span class="hljs-type">Y</span>?����%���<span class="hljs-type">P</span>�<span class="hljs-type">L</span>��\��קֶ��^����<span class="hljs-type">r</span>�<span class="hljs-string">&#x27;A���2�=�j���Ԟ;�� _�Y]�\%���\�)u�B��6l�z3]�-��(n,���h�`���H���:�ֺ* ��=/�sk�[H�!��V{�9��.-��,�&gt;�D�x9�;[=�^��O/�5�&quot;� L�K�-�I���Ĉ���Q� ��s�^�u��}&#x27;</span><span class="hljs-type">K</span>�<span class="hljs-type">U</span>�<span class="hljs-type">oswh</span>��`&gt;]���<span class="hljs-number">5</span>��מ<span class="hljs-string">&quot;�eƷ�m:�f��|�&quot;</span>�<span class="hljs-selector-tag">@</span>�<span class="hljs-number">0</span>+�<span class="hljs-type">e</span>ܣ<span class="hljs-type">aU</span>�<span class="hljs-type">s</span>�}�=<span class="hljs-type">b</span>���<span class="hljs-type">Y</span>ͧ�<span class="hljs-number">6</span>�<span class="hljs-type">w</span>���<span class="hljs-type">K</span>���� <span class="hljs-type">cq</span>�<span class="hljs-number">5</span><span class="hljs-type">r</span>�
(��
(��
(��
(��
(��
�&gt;�<span class="hljs-type">k</span>ڑ<span class="hljs-type">eI</span>�<span class="hljs-type">m</span>�<span class="hljs-number">2</span>�<span class="hljs-type">m</span>�<span class="hljs-type">.2</span>&gt;<span class="hljs-type">A</span>�=�<span class="hljs-type">j</span>�<span class="hljs-type">x7</span>�<span class="hljs-type">t</span>�?�<span class="hljs-type">X</span>&gt;�<span class="hljs-type">.</span>�<span class="hljs-type">K</span>�<span class="hljs-number">6</span>�<span class="hljs-type">K</span>������)��<span class="hljs-type">x</span>�
����<span class="hljs-type">.</span>|<span class="hljs-type">g</span>,<span class="hljs-type">z</span>��:�ί��<span class="hljs-type">H</span>��<span class="hljs-type">L6</span>�<span class="hljs-type">L</span>�<span class="hljs-type">mc</span>�����?�<span class="hljs-type">e</span>����]\]ZYA�!i<span class="hljs-comment">#@� @B�=� �|/���F�5[��7:�0�]A ���%�=r��@G�]� ����U��-&quot;�W��+�A�C�؟^�֖��</span>;B�?ۥ*nb*���q�?�jP<span class="hljs-number">7</span>�|=o��)mb���<span class="hljs-number">4</span>��o��f�( ��( ��( ��( ��( ����^�}�xn�QӢ����<span class="hljs-string">&quot;���W]�r����3��Ecxg��_�th�=*q<span class="hljs-variable">$M</span>á��~���q�l��~���&#x27;h�G�� �빪��V��_Em]L1<span class="hljs-variable">$</span>�r���T QE QE QE QE QE QE QE QE QE QE QE QE QE W7�����X%y� �ti@h���q� �=9���G9B�HPI� �^��r��.��5�F�qc���/����+a�8�����=w@��&gt;��y�u�4�[裃U�H����m˃������4�#�6\�Z�q�/ R�G�Pz�c�3A���Ʈ����Ar�01��^k��I:�����i��qD�˓�7b�<span class="hljs-variable">$P</span>w�umg[�!�5��ln��c��N��2C�y��+�� ��g�
���𭮗ur�WH�I&lt;�0<span class="hljs-variable">$w</span>����z�O��K&quot;</span>��QGs5�[�:<span class="hljs-type">v</span>�<span class="hljs-number">2</span>�<span class="hljs-variable">$</span>�<span class="hljs-type">D</span>���}ι�<span class="hljs-variable">$W</span>��<span class="hljs-type">Y</span>�<span class="hljs-type">Z</span>�<span class="hljs-type">y</span>�<span class="hljs-type">Z</span>����<span class="hljs-type">ul1</span>,<span class="hljs-type">v</span>��<span class="hljs-number">8</span>�<span class="hljs-number">5</span>�<span class="hljs-type">x</span>�[���-���<span class="hljs-number">9</span>�<span class="hljs-type">S</span>��<span class="hljs-type">n</span>�<span class="hljs-type">Q</span>���<span class="hljs-type">H</span>��<span class="hljs-type">A</span>Ӯ<span class="hljs-type">h</span> ��( ��( ��( ��( ��( ��( ��( ��( ��( ��( ��( ��( ��( ��( �<span class="hljs-type">C</span>�<span class="hljs-type">z</span>���]<span class="hljs-type">o</span>^�<span class="hljs-type">nt</span><span class="hljs-string">&quot;�F&gt;x�v&#x27;��������##�da�Vz ���vz��]�β���P}�j�b����+���&quot;</span>�<span class="hljs-type">f</span>-� <span class="hljs-string">&quot;c��Nկ�D&amp;����pݏ\zP袊 (����������,��  \   ��i�bC������ �k&gt;_�^���r����@��h�ٝu�7�O/H��� V����?�/���_�*����,����⏇��_�?�j�?�1)��x� ߁� �4�
�찳:�+x~�^�g���\V�\��&amp;�U��l~�2[��&#x27;�O��V�g���=Ű
U  2���� ���Һ�*@ ���P��}��k�*I|�/�ƹf���&gt;ic��WT��3 Rj���YkV&quot;</span>��<span class="hljs-type">_2</span>�<span class="hljs-type">rA</span>؃<span class="hljs-selector-tag">@</span>�����<span class="hljs-type">Vo</span><span class="hljs-type">kI</span>�<span class="hljs-type">O</span>��<span class="hljs-type">tE</span>ݽ�}+��� (�� (�� (�� (�� (�� +�~<span class="hljs-number">0</span><span class="hljs-type">x</span>��<span class="hljs-type">F</span>��<span class="hljs-number">4</span>�<span class="hljs-type">i</span>ڎ�<span class="hljs-variable">$R</span>]�A|��Ԍ�U3�` <span class="hljs-number">9</span>���V�o���|_y�\j����`�� <span class="hljs-number">2</span>� �p&lt;P���J���o�&amp;�;��{k�߹��~�<span class="hljs-number">1</span>��Ǩ�<span class="hljs-variable">$</span>�qϰW   ῅�o��\u�:���-���c3X<span class="hljs-number">0</span>c���^=I�wt��W\���mz�F���˃j����߀+��G��]��ė��\]M�ļ����PEPEPEPEPEPEPEPEPEPEPEPEPE�x��w~�����w�<span class="hljs-built_in">H</span>��e8�;�P\�aF}G�<span class="hljs-selector-tag">@</span>�Y5�Z�,l��N�qks{����<span class="hljs-number">0</span>G<span class="hljs-variable">$</span>���u�I�ծ�Y�hwz��)��m�j�r2�<span class="hljs-number">5</span>�����&lt;`e�<span class="hljs-variable">$</span>���K�&gt;��ů�V�M&amp;�-�-�Z�]��<span class="hljs-number">8</span>��as�<span class="hljs-number">8</span>��:���K�����;{<span class="hljs-built_in">h</span>�   jW<span class="hljs-string">&#x27;&#x27;</span> p9&amp;�<span class="hljs-number">2</span>&lt;o�<span class="hljs-number">7</span>���ȭ��K`�bf������f�x�I���闁-<span class="hljs-comment">#��lY&gt;^s�2����Z�α��R]Ke�4��&gt;�L�%��y;n 0�#ֽC���t��mW�[ɭj�I͹%4]��$s��΀:m&gt;�7M��� ��!�3;T 2OS�֧`J�8&gt;�3R�@ d�ڹ�x�o�z���F�n�!��Ϧ;�&gt;�� � �`h/yq=���n�,��+���O� Z�(��(��(��(��(��(��(��(��(��(��(��(��(��(��(��(��_xR]J�5m*��uh�ێ����^���/����9i\~����޼;��a�)����x����/�tQ�N��!�sҬ&gt;&amp;�[���o*_�v2����w�~x��sX��8ܖ6���.L����n�������^V�B��~-JQ;]K�V��dIv��_�_�k��\���eA=N2O�Y�WTb��i�+��;��������X�TU �#������4�P����?z�οviэEE ZMJ�:N����巈o�d�q�HJ��+&amp;�@w�o�Mz� ���Q� �s]ދ�)���h���͵����׃�X�J{��&gt;��|A�     ޥk��34R~��Y&gt;V`9�|zw&gt;�5�v�e�6v����v���}��;mR�ՁY r�Cڽ3�o��;{�k�9[��������*����.&#x27;��Y�&gt;�c�ح݄�D&lt;2��ƴ+����!ER ��( ��( ��( ��( �7�.��Y�v9�]�Wk0H�8��y[�]�T���}q]�y��a�H�;�aq��;ǊF�������p���H �᾽wq����]TRkC�����Q���k���#��2@&#x27;���k��_�~�����[�pn���B�0$F �y�MԤ򴻹:l���S@C&lt;7��J��q�0��I\�H�x&gt;6���7��]� QE QE QE QE QE QE QE QE QE QE QE QE �9��-ǎt��{;�i�k�o1\�̊CD� ��8oA����oD�4� jz�����=�x3B�(��l�$�zd�7�-#���i�7WZ��+h�֥���)   �&#x27;&#x27;p��c ��X�.�}�</span>
[<span class="hljs-type">h</span>ײ���<span class="hljs-type">Ft</span>�<span class="hljs-type">HT</span>����<span class="hljs-number">8</span>|<span class="hljs-type">q</span>߹�<span class="hljs-type">V5Y4</span>�<span class="hljs-type">K</span>­~�<span class="hljs-type">_</span><span class="hljs-type">Q</span><span class="hljs-variable">$</span>��%<span class="hljs-type">bB</span>ȧ�<span class="hljs-number">0</span>���<span class="hljs-type">Z</span>:��<span class="hljs-type">a</span>����<span class="hljs-number">7</span>�<span class="hljs-type">ZD</span>�,<span class="hljs-type">J</span>��<span class="hljs-type">n</span>�<span class="hljs-string">&#x27;�x�|Ku�ǲ�����6&quot;TӮ\�R��NW�&lt;��͏Q�z����q�x�j^&#x27;</span>�<span class="hljs-type">W</span>������<span class="hljs-type">Z</span>,�<span class="hljs-type">j</span> �\<span class="hljs-type">G</span>!� �<span class="hljs-type">pH</span>�<span class="hljs-number">8</span>�<span class="hljs-type">z</span>�<span class="hljs-type">c</span>�<span class="hljs-type">W</span><span class="hljs-selector-tag">@</span>����!;��&gt;<span class="hljs-type">s</span>�<span class="hljs-type">Hyw</span><span class="hljs-variable">$</span>��<span class="hljs-string">&#x27;�Z��m��_�1D:�{�h3�V���l��՞��s1|��� ��f�t]&amp;I���|�����ۻ���/bԬ ��8�d��i���4 QE QE QE QE QE QE QE QE QE QE QE QE QE QE QEc�~(�4i�Z�Đ1�Z�B��!p
 ج��P�,���qA����z��5�� �� �� �y���~&#x27;</span>���<span class="hljs-type">X</span>�-<span class="hljs-type">J</span>�<span class="hljs-type">i</span>���<span class="hljs-type">y</span>��~�&lt;�ք�(���/�<span class="hljs-number">7</span>��<span class="hljs-number">5</span>�<span class="hljs-type">Jyf</span>���߼��<span class="hljs-type">z</span>ҹ�(�<span class="hljs-type">y</span><span class="hljs-variable">$</span>��<span class="hljs-type">aE</span><span class="hljs-type">S</span> ��( ���<span class="hljs-type">.o</span>���<span class="hljs-type">i</span>�<span class="hljs-type">h</span>]�<span class="hljs-built_in">H</span>[<span class="hljs-type">j</span>��<span class="hljs-type">t</span>�}�����|-�/<span class="hljs-type">x</span>�<span class="hljs-type">P</span>̿<span class="hljs-type">g</span>��܎��<span class="hljs-type">v_</span>�沫&gt;<span class="hljs-type">H</span>�<span class="hljs-type">n</span>�<span class="hljs-type">Z</span>�������<span class="hljs-type">M</span>����&lt;�+�<span class="hljs-type">O</span> ��֯<span class="hljs-type">x</span>{<span class="hljs-type">I</span>��<span class="hljs-variable">$</span>����<span class="hljs-type">S</span>���<span class="hljs-type">s</span>�?���+��˫�<span class="hljs-type">u</span>�}�(�Ҡ^��<span class="hljs-type">G</span>����<span class="hljs-type">i</span>� &lt;ޥ����<span class="hljs-type">Fg</span>�<span class="hljs-type">X</span>���<span class="hljs-number">7</span>�]��<span class="hljs-number">3</span>�{ת�_J�σ|!i���/�o   <span class="hljs-number">6</span>v�C�� ��N1�^K��&gt;��������ܱ�<span class="hljs-comment">#�nq�����</span>
Q��+Ei�.rTQElEPGJ(���^<span class="hljs-number">0</span>�еX�G,z:ĩ�O�����o`�l`��m�́���_��<span class="hljs-number">9</span>�ת�<span class="hljs-string">&quot;���_&lt;��&lt;#���&gt;�7�c^~:��S�L���E�QE QE QE QE �?������V��<span class="hljs-variable">$f</span>{�!�F1�����y��x=�W�|V�6�E��^��!t�l�hm�:��F�?BC���qc��nb�=�ћ�I#kY����Q��v����e����f*�Fі^���μ��R��&#x27;�I�ܵ���0S�IGx��� ���^���K��:��dXq@pO8����Š�i���<span class="hljs-variable">$e</span>�w&#x27;<span class="hljs-variable">$</span>��ZҪzU��4�k�Ƴ�!9#5r�
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��&lt;��~.M��J&quot;</span>�O���I�<span class="hljs-built_in">h</span>�.�y�磝���   �n�<span class="hljs-number">4</span>[<span class="hljs-type">i0</span>�<span class="hljs-type">zlM</span>�%��˖��<span class="hljs-type">c</span><span class="hljs-string">&#x27;�d�T�i�w�׳Z�%ծ�&quot;f@^-����3���|?��F������[��4���\��:���� �|U�i|e��%���Ǩ�7�=�G�Gz�1�d�q@H�_n���_  a�j�/࿷�T��QE�:���lTz�}k����OC����;�J�Q]b�W�!�H��r����UU*(U � -p:�7/�i��Zi\n|�� ��ۍv�^��w���ĪZ8ـf�O�s@���TP0  R�E QE QE QE QE QE QE QE QE QE W?�/�o�okz�6�K�#!���ڠ�=�OV���X\���CS{�ke��*s0ޭ�0W`-���(���( ��( ��( ���s�:V�;Z/�wz�o��} ��d�Q��GĚ������&#x27;</span>�&lt;<span class="hljs-type">I</span>�=��<span class="hljs-type">z</span>����&gt;�<span class="hljs-type">W</span>���<span class="hljs-type">T</span><span class="hljs-string">&quot;,���޸���x�3o���[���{�}��ֻ����U[�c�U���C GC�z��&lt;R��o������1o���RI,�������&gt;�O���n�&amp;UA�u�&gt;��
�ll-��U���<span class="hljs-variable">$</span>`�}Y�ROrj�\&amp;�%%���-Z���~�U&gt;��׿����m��fbZKQ��vO���+�/�]^6!+��Ў��R���4N�}QZ�QE W��[�N��x2-Yп�V�Vx��1�X���<span class="hljs-variable">$</span>�=��(��S�Ei�c�v���jV~����bZKy@/#+.(�͜�Oz���R��&lt;~����ie���F&#x27;��F?�y5V��6=F���[�6��xj�Pң�䳉�g�Vbv��8��0&lt;a��:�弚�4��B<span class="hljs-variable">$</span>�����c�ϵstUF�c.d
(�� ��( ��  8&amp;�4���Q�23��Ƌ�oõ-���XI{{Df� �n�W��ю���Kǜ��}�?�O¹��=������^����+�{��� ����qx�S܎Ȗ(�&quot;</span><span class="hljs-type">B</span>�(��(��(��(����<span class="hljs-type">O</span>�<span class="hljs-type">D</span>�~� ��:^��<span class="hljs-type">D</span>��[�� �<span class="hljs-number">0</span>�<span class="hljs-comment"># �=y��k�+#�~��U�6��[�����k��+A�|!�k��o&lt;�^�_Mgv��k,�G�B�2A\�����y~�=[�_�E����!��5�eIgk�e��|�H�� ���q�$R���z�����iI�ZE���Z��    )h ��( ��( ��( ��( ��( ��( ��( ��( ��( ��( ��( ��( �Ms�$3&quot;�R)WF}��</span>��<span class="hljs-type">SG</span>]+<span class="hljs-type">Mi</span>͚<span class="hljs-type">H</span>�<span class="hljs-type">M</span>&amp;� ,<span class="hljs-number">1</span>�<span class="hljs-type">U</span>?��=<span class="hljs-type">ry</span>�<span class="hljs-type">Z7</span>�<span class="hljs-type">pXY</span>�<span class="hljs-type">wr</span>�!�<span class="hljs-type">K</span>�<span class="hljs-type">AS</span>�<span class="hljs-number">7</span><span class="hljs-type">v</span>��ֲ[]<span class="hljs-type">B</span>�<span class="hljs-type">C</span> �<span class="hljs-comment">#��@G�l���q��ARLvQ�EQ��RMw���6��[[�#�%�: *Z (�� (�� (�� (�� (�� (�� (�� (�� (�����ē�C�ƌ��2�G|N+�|C�[�&gt;�t�%�E��i�e�c0@�9R6�Gր=sU����ϩ�Ak�e�}�X�^�p    ��]Ś������WMD ��=  V ���GH�k�z�ۥ]b�k��&gt;w�in#����   *X��y����,`���O&quot;�I4���{d9�&amp;&gt;��&#x27;b=qҀ&lt;��6�c�x� S��\���k�\��,���f`���&gt;��&#x27;8�Z��mW���F���gwm���$��S9b��3��&#x27;�  �a��]H�ZMbm2�MJ4�Oi���y�@U</span><span class="hljs-type">OZ</span>�<span class="hljs-type">th</span>|�<span class="hljs-type">B</span>�(
�,�<span class="hljs-type">E</span>� �<span class="hljs-type">Q</span>�\<span class="hljs-type">Ci</span>�<span class="hljs-type">q</span>*<span class="hljs-type">E</span>
��  �&amp;�<span class="hljs-type">M7</span>Ƴ��<span class="hljs-number">0</span><span class="hljs-type">izE</span>Ė�<span class="hljs-number">5</span>Ԝ<span class="hljs-type">m</span>�;<span class="hljs-type">u</span>�|�<span class="hljs-type">u</span>��<span class="hljs-type">_</span>��<span class="hljs-type">is</span>�    <span class="hljs-type">T</span>���(������<span class="hljs-selector-tag">@</span>��<span class="hljs-type">S</span>�&lt;�<span class="hljs-type">B</span><span class="hljs-type">S</span>�<span class="hljs-type">z</span>�<span class="hljs-type">t</span>�<span class="hljs-type">o</span>����Ԡ<span class="hljs-type">X</span>/
��<span class="hljs-number">49</span> �<span class="hljs-type">ri</span>�:<span class="hljs-type">u</span>�� ���(<span class="hljs-comment">#��k��}O֬�X��(���KXEԸ�6���c��U�(��(��(��u�</span>
���گ��    ��<span class="hljs-type">d</span>��<span class="hljs-number">5</span>�<span class="hljs-type">E8</span>���<span class="hljs-number">0</span>&lt;<span class="hljs-type">O</span>����<span class="hljs-type">M5</span>��<span class="hljs-type">N</span>�<span class="hljs-comment">#���O�?�y֩�</span><span class="hljs-type">OJ</span>����݄�<span class="hljs-type">S</span>?<span class="hljs-type">C</span>���<span class="hljs-number">4</span>ɡ��&amp;�<span class="hljs-type">h</span>�<span class="hljs-type">H</span>۪:��<span class="hljs-type">k</span>��<span class="hljs-variable">$</span>�<span class="hljs-type">W1</span>�̖<span class="hljs-type">W0</span>��\<span class="hljs-type">P2</span>?<span class="hljs-type">J</span>�Ҿ���/��<span class="hljs-type">_L</span>�&amp;?�<span class="hljs-number">1</span>��~���|�<span class="hljs-type">n</span>    <span class="hljs-number">6</span>����<span class="hljs-number">4</span><span class="hljs-type">k</span>(ʺ<span class="hljs-type">c</span>����|��Ҋ�ۯ�<span class="hljs-type">.s</span>�^�?���� ,�<span class="hljs-type">L</span>��<span class="hljs-type">tb</span>-�<span class="hljs-type">z</span>��� م<span class="hljs-type">l</span>�<span class="hljs-number">4</span>����<span class="hljs-type">W</span>�?��<span class="hljs-type">tt</span>�-���֨<span class="hljs-type">X</span>|<span class="hljs-number">2</span>�<span class="hljs-number">54</span>��<span class="hljs-type">d</span>�!���`8�<span class="hljs-type">G</span><span class="hljs-string">&#x27;����W���������2?���cu�_��c�����[Vs��K�� ��Iפ���ɩB�8PI��������8� ܉��x���Z=�h����0�����r��]Et|��w/݁��n?�ni&gt;
��goo&lt;���(HV&lt;
�2��&gt;��b��v�6d?��kyc@��Tp ��=}�.c�-�`�m.���2q$����{?���z��h����A$P|�w4�Էq�V���4M���2��#Њ��n��4Ś�Nk���hb!J�:��;WJ�*|LW4��Z^�e��-݌�H��S�GcWkQ@Q@Q@Q@Q@Q@ru+�7@����H&amp;{�MѶ6���u����A�׭�&quot;�1��,��t���F��-PEPEPEPEPEPEPEPEPEPEPEPEPEP�|@��^u �K��t��Ǡ���x?L��4�P��[�I�ČO����}ɩ5Zjz���s$�փ䄐P����&lt;��� ��( ��( ��( ��( ��( ��( �����C��r�nu{�cv��Y��Td�� ���j_Y�a7�4{H���᷿��[��M����U#$ ��z���j�/���r�}{F��N�V(�n�Dq��ٗ&gt;�{� ���6�.�{��v�XY�L��8��w�=z���T��h�5��V�u�ڝd�6�G���!F �}�V8�+�G��  M� 6�f��w��{�$�k?�?��ޮ�5�ޭ��b(��y� �X���q�ۡ� y��x�ĺu�i6�o6�ݻ���qs$�R��������o���9�S��A�Vi�+�4�8 �J�?���@Acim&lt;��kSNۦ�8´�Ո�~�=#�ƅ݂�$� +�Ծ h�s�����ܖ۲�n��4����Cܷ7BI�����ǰ�H������F?J��|���y�Z   &amp;�D���~��: �Ú�����R��Y����00Á�Rj&gt;�uk�oo�ya]����g&lt;����֭ ��HcX�EDQ�U {
uPEPEPEPEPEPEPEPE�7��DTI����ހ8��^,�ʴ:U����x�y��?���W���?����U�?hm���T�5IT����pu�#�OZ&lt;�ˢ����6KC�8��؄�b�:�(��
(��
(��
+W�t��j�卭�0��x���T�7�t4����w����G�E ]�Ӭ��..-���[�VA��z�f�i!��f��d���$��a����V�P�Ѭo�mog��&amp;ٷG*��=�G� _��n��V:�F�[�����wt���5�@Q@Q@Q@Q@Q@S��lln�mnn9��l(A������x���&lt;3�X�����;�(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
�I�;�u�D���W1uܨ����������m;q�g�k��n4���KS�.5+�dN�3��� ���4QE QE QE QE QE Q\��/����jиK���c8��U8�$:j���,&lt;9ờn�A%�)�d+WԒ@���ɼM��C��%��դ�/,��̗sI*+I� 
���O mx^�W���_�]���ɩMa|�AmlΛbEy9qe��I8����� eԼ%�K�k�b��+$�u�~xGM���g�85Ƌ��:ѿ��T������q-Ē�#��WbB+����&amp;�s�� �[mSZ�k�mo�Q�X&gt;H�׏aP���c  #&#x27;</span>һ� �<span class="hljs-type">M</span>�<span class="hljs-type">o</span>�,�<span class="hljs-type">U</span>���/<span class="hljs-type">C</span>�<span class="hljs-type">O</span>}<span class="hljs-number">4</span>�<span class="hljs-type">vQ</span>ܰ�ܾՑ��<span class="hljs-number">9</span>���+�<span class="hljs-type">t</span>��<span class="hljs-type">J</span>[����<span class="hljs-type">K</span>����<span class="hljs-type">K</span><span class="hljs-type">G</span>�<span class="hljs-type">b</span><span class="hljs-string">&#x27;#8ɫ�PEf�� ��H�_�Gc&quot;&lt;��裚�M�m�m:�RL3.��0Gb�4 ���]&gt;=��PD?�F VN���3^�粰2�����L+s�3�犧y�[O\�QԮnn��1۳��1��\g��tv�V�--�!�#P��(x����&quot;����Y��$|��n�� ��Ҵ/D�e��q`�2��c�iQ@Q@Q@Q@Q@Q@Q@Q@Q@Q@Q@Gq&lt;v���L�b��z 2jJ�}e�c5�ʖ�e��1RG�P�$�n�?ܮ%���Y��{t��  � ��U��}/O���J�
�PNO��՚ (�� (�� (�� �mC�z� �|S�k���5�]Nf���R�Vh݉$G!ےx&#x27;</span> <span class="hljs-type">v</span>=<span class="hljs-type">k</span>�����<span class="hljs-number">5</span>/��  <span class="hljs-type">w</span>�]�;<span class="hljs-type">jw</span>�<span class="hljs-type">Y</span>���<span class="hljs-type">H</span>��<span class="hljs-type">h</span>�
<span class="hljs-number">9</span>=�{�<span class="hljs-type">yw</span>�~� �;�<span class="hljs-type">O</span>�,�&amp;��<span class="hljs-type">I</span>?��*<span class="hljs-type">s</span>�<span class="hljs-type">HC</span>�<span class="hljs-type">I</span>��(ҭ/<span class="hljs-type">mu</span><span class="hljs-type">e</span>������<span class="hljs-type">Ya</span>�:��<span class="hljs-type">S</span>�ζ^<span class="hljs-number">1</span>��<span class="hljs-number">5</span>�}&gt;����<span class="hljs-type">m</span>�<span class="hljs-type">Z</span>���<span class="hljs-type">PJ</span>���@<span class="hljs-type">I</span>;��<span class="hljs-string">&#x27;ֽ��&gt;)�|Se$�}���0�WEa|vr猎(GR�,�k&#x27;</span>���<span class="hljs-type">e</span>��������
־���<span class="hljs-type">Wr</span>����<span class="hljs-number">3</span><span class="hljs-type">LK</span>�  ��=<span class="hljs-type">qZT</span>�<span class="hljs-type">D</span>�<span class="hljs-variable">$Uda</span>�<span class="hljs-type">V</span><span class="hljs-type">z</span> <span class="hljs-type">Hf</span>���<span class="hljs-type">H</span>�<span class="hljs-type">nWC</span>���}<span class="hljs-type">c</span>�&gt;�<span class="hljs-type">E</span>��<span class="hljs-type">k</span>;�<span class="hljs-type">V</span>�<span class="hljs-type">Q</span>�<span class="hljs-type">fyH</span>�&lt;����� �ƍ��ٔ[��<span class="hljs-string">&#x27;1���è&gt;��&#x27;</span>��( ��( ��( ��( �����<span class="hljs-type">W</span>��%��ݲ�Ð �<span class="hljs-type">N</span>�<span class="hljs-type">Mu</span>���,�<span class="hljs-type">f</span>����}<span class="hljs-type">p</span>�<span class="hljs-type">X</span>���<span class="hljs-type">C</span>�-��<span class="hljs-string">&#x27;;���Ҁ:**[�o#i`}�(tb=Fr?
��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
)�K)�Ywc�Yw&gt;)�m3�j�`��e!�ME���W.� &lt;,����  ?���|U�&#x27;</span><span class="hljs-type">L</span>�ѥ��<span class="hljs-string">&#x27;�B�6&#x27;</span><span class="hljs-type">r3</span>߷�<span class="hljs-type">W</span>�<span class="hljs-type">j</span>+��<span class="hljs-type">fu</span>�<span class="hljs-string">&#x27;���u]B���ͽ� ]
���8���[����g�4-�/�ҿ�����&lt;/�=�������8�W��c� Ѐ�Ѩ�����ߢ�[jW�6����e*��5f��n ��) QE QE QE V&#x27;</span>�&lt;:�,𦡢&lt;��<span class="hljs-type">F</span><span class="hljs-type">e</span>)�<span class="hljs-type">c</span><span class="hljs-number">8</span>㸭�(�<span class="hljs-type">e</span>�<span class="hljs-type">i6</span>�<span class="hljs-type">t</span>��<span class="hljs-number">0</span><span class="hljs-type">G</span><span class="hljs-type">bT</span>�<span class="hljs-number">0</span><span class="hljs-type">H</span>&lt;<span class="hljs-type">g</span> <span class="hljs-type">cWh</span>�<span class="hljs-type">K</span>,<span class="hljs-type">p</span>��<span class="hljs-type">J</span>�<span class="hljs-type">j2</span>�� <span class="hljs-type">s</span><span class="hljs-selector-tag">@</span>��<span class="hljs-type">i</span>������ܥ�<span class="hljs-type">q</span>���@<span class="hljs-type">a</span>�?<span class="hljs-type">QX</span>�<span class="hljs-variable">$</span>����]�<span class="hljs-type">Z</span>Ė�<span class="hljs-type">v</span>�<span class="hljs-type">M</span><span class="hljs-type">c</span>�<span class="hljs-type">l</span>�<span class="hljs-type">c</span> �<span class="hljs-type">S</span>ۥ <span class="hljs-type">h7</span>�<span class="hljs-number">4</span>��<span class="hljs-type">a</span>��<span class="hljs-type">Ow</span>+�݃����&gt;Ƭꖳ��<span class="hljs-type">w</span>��<span class="hljs-type">Ok</span>&lt;���:����:<span class="hljs-number">6</span>���<span class="hljs-type">mC</span>�?��<span class="hljs-number">3</span>���ܠ<span class="hljs-type">OI</span>�}���������<span class="hljs-number">9</span><span class="hljs-type">i.9</span>\� ��<span class="hljs-number">9</span>��<span class="hljs-type">UQB</span>��<span class="hljs-type">P0</span> �� (�� (�� (�� (�� (�� (�� (�� (�� (�� (�� (��&lt;[�š<span class="hljs-type">xf</span>���ౘ�<span class="hljs-type">c</span>��<span class="hljs-type">q</span>�<span class="hljs-type">Y</span>����:�<span class="hljs-selector-tag">@</span><span class="hljs-type">tW</span>=�<span class="hljs-type">E</span>�����<span class="hljs-number">2</span>�<span class="hljs-type">d</span>�%¯�<span class="hljs-type">L</span>�<span class="hljs-number">8</span>���<span class="hljs-type">WC</span><span class="hljs-selector-tag">@</span><span class="hljs-type">r</span>��}���<span class="hljs-type">U</span>�<span class="hljs-comment">#ҭ1��1~�C�?�o�k�˺ �w6�psY&gt;���|= ��V2�2�� ~���E QE QE QE QE�x���,��}���6���jY���Ќ��=�J��m{</span><span class="hljs-type">g</span>�<span class="hljs-type">G</span>�ڶ��<span class="hljs-type">j</span>�
�<span class="hljs-type">A</span>�<span class="hljs-type">n</span>^<span class="hljs-type">e</span>��<span class="hljs-type">h</span><span class="hljs-comment">#�%��R���r~���s���aX��.��&#x27;�i�O�Xr?@������X�vmi�i�s�`w�F��v�  �</span><span class="hljs-type">uU</span>ʸ��-<span class="hljs-type">k</span>�<span class="hljs-type">e</span>���<span class="hljs-type">oy</span><span class="hljs-variable">$</span>�<span class="hljs-type">g</span>�񀠱<span class="hljs-type">fc</span>����<span class="hljs-comment">#�&gt;4k:W��ĚS�7���^�d��&quot;   ��t�/��L� ��5</span>�����\���!<span class="hljs-type">s</span>�<span class="hljs-type">C</span>�<span class="hljs-type">s</span>�� ��}��<span class="hljs-type">m</span>��<span class="hljs-type">G</span><span class="hljs-variable">$kq</span>
<span class="hljs-type">J</span><span class="hljs-type">A</span>�<span class="hljs-type">P</span>�،՚ <span class="hljs-type">i</span>���;<span class="hljs-type">gj</span>���\<span class="hljs-type">S</span>�+[�<span class="hljs-type">m</span>��<span class="hljs-type">c.</span>��<span class="hljs-type">u</span>��<span class="hljs-type">G</span>{{{<span class="hljs-type">T</span>�<span class="hljs-type">B</span>�<span class="hljs-type">Q</span>��<span class="hljs-number">5</span><span class="hljs-type">i</span> �����<span class="hljs-type">tb</span>;<span class="hljs-selector-tag">@</span>袊 (�� (����<span class="hljs-type">f</span>�<span class="hljs-number">8</span>� �`(Ɩ�[ŏ<span class="hljs-string">&quot;h\DW�d�|d~5�v����k�&quot;</span>�����ѥ<span class="hljs-type">Q</span>���<span class="hljs-type">O</span>����<span class="hljs-type">k</span>�<span class="hljs-type">Z</span>��<span class="hljs-type">JK</span>�؀<span class="hljs-type">x</span>!��ּ���^��<span class="hljs-type">MJ</span>��<span class="hljs-type">P</span>�   <span class="hljs-type">l</span>��<span class="hljs-type">i</span>������<span class="hljs-type">p3</span>�<span class="hljs-type">j</span>�<span class="hljs-type">e</span>�<span class="hljs-type">L</span>���<span class="hljs-type">O</span>�����<span class="hljs-selector-tag">@</span>�=���<span class="hljs-type">jV</span>}��<span class="hljs-type">f</span>�<span class="hljs-type">J</span>��Ր<span class="hljs-type">C</span> <span class="hljs-type">A</span>�<span class="hljs-type">Ri</span>��(�<span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">Q</span>\��<span class="hljs-type">gn</span>��̐,������<span class="hljs-type">ca</span>�<span class="hljs-type">K</span>�<span class="hljs-number">2</span>�<span class="hljs-type">v</span>˘���ރ�����<span class="hljs-type">M</span>�<span class="hljs-type">_</span>ķ�<span class="hljs-type">.</span><span class="hljs-type">D</span>ȋ¯�<span class="hljs-type">v</span>�����<span class="hljs-type">YU</span>�膕�<span class="hljs-type">e</span>��/<span class="hljs-type">h</span>�<span class="hljs-type">Xh</span>앯% ��<span class="hljs-type">O</span>��כ<span class="hljs-type">j</span>�|<span class="hljs-type">C</span>|<span class="hljs-type">Ym</span>�ўШ<span class="hljs-type">_</span>ד�ם<span class="hljs-type">I</span>�<span class="hljs-number">94</span><span class="hljs-type">W</span>�<span class="hljs-type">O</span><span class="hljs-type">J</span>/�<span class="hljs-type">U</span>��{�<span class="hljs-type">SP</span>��<span class="hljs-type">sw</span><span class="hljs-variable">$</span>������<span class="hljs-type">MQ</span>{����<span class="hljs-type">H</span>~�<span class="hljs-type">j</span>*+<span class="hljs-type">q</span>�<span class="hljs-type">s</span>֊(�<span class="hljs-type">OYdO</span>�<span class="hljs-comment">#/��E Z�R������� :�t��^$���2�v�?&amp;������QRѠ=�A�ܮV-b�H� �����&#x27;��/�4}}�_x�&amp;2bo����Q�|�V�u+�:e��g���`���=+��</span>
���<span class="hljs-type">O</span>����<span class="hljs-number">7</span>ų<span class="hljs-type">s</span><span class="hljs-string">&quot;Xk�0x[�&gt;e� {�{��ֽ�dEt`��*�r��2�Rv�-XZ(��QEF����� -a�A�H�   *�����j�w1@�p�G��=k;�i��ez�G;ɶG�}���g����;���8�ׯf��<span class="hljs-variable">$</span>;�����ڀ;F� ���\*�#T֮&lt;� kL�����
?L�~5�  8�K@��&amp;�G��&gt;�l�G����ԓ��j�PEPEPEPEPEPEPEPEPEPEPEPEP_=_��\���5��м�[����.�B���ۂ  ߹��c��-rz� �&lt;?����m�n~�n��TI���%q�霜���/�H-�tf�=�Q��ڲ��J�@ �h٣2G���FF;W�V7�&lt;=�&lt;-��v�#��i��obK3c&#x27;bN3�kN��+;I��m�B��� 2h�k6k2i+87��v�i�u�Ӹ���p� ���}K�wK����Ǟ�8����� (�� (�� (�� (�� (�� (�� ���-7�zT�f�h�V���l���&gt;��o�~�����pm���/���b�O͂z�u�T��&lt;� ��W��u��^�H���k�L�Kt��&lt;d8��
(��j�,�2�iIP��&amp;�؂1�� 늻Q�&lt;V�&lt;�ȑăs;����^j�&amp;����ַ���B�5������rt���W�C��M-RK蠂A�F������j�&lt;]�i`m�r&gt;��o����Ҽz�_����Ac��rƻ�`�-g�J&#x27;�j� t�&lt;�����<span class="hljs-variable">$</span>�&quot;</span><span class="hljs-type">_</span>é?�<span class="hljs-type">p</span>���<span class="hljs-type">M</span>^<span class="hljs-type">r</span>�    �}-����?�<span class="hljs-type">yk</span>��۝�<span class="hljs-number">7</span>�<span class="hljs-number">9</span>��<span class="hljs-type">t0</span>���<span class="hljs-type">vGU</span>{��<span class="hljs-type">b</span>�<span class="hljs-string">&quot;k������qYk�n��=�I�u�En�[�u���j?�&quot;</span>��^��<span class="hljs-type">z</span>���<span class="hljs-type">U</span>)��<span class="hljs-number">5</span>��������<span class="hljs-type">P</span>�<span class="hljs-type">l</span>�<span class="hljs-comment">#F}bvC�Ģ�Շ�</span><span class="hljs-type">z</span>����<span class="hljs-type">i</span><span class="hljs-type">J</span>?���<span class="hljs-number">4</span>��<span class="hljs-type">S</span>��{<span class="hljs-type">mk8</span>�<span class="hljs-type">V17</span>�^+<span class="hljs-type">Ee</span>*�<span class="hljs-type">B</span>���<span class="hljs-type">H</span>���<span class="hljs-type">j</span>�<span class="hljs-type">U</span>����<span class="hljs-type">.</span>&gt;<span class="hljs-type">P</span>~����<span class="hljs-type">uh</span>�<span class="hljs-string">&quot;F�dr|k����R0�G�]��&gt;!jZ�E&gt;����|�M����*`�d��M�\��&lt;s���\[ށ�<span class="hljs-variable">$</span>�C�T=��k��:p�,�!ET�QE QE QE V~����h�:��)�/����kB���5Ԑ�&gt;8S?��,G�S��´�z�,h�k�:��=�ĥ̎[�� ��jɢ��Ҷ����|Q�eH�U.�r� gր.����:f�uv#�����U.mn,�^��  �3��T*�}��WӶ���曧i�ݮ�ko���&#x27;�X�O&lt;e���zW�i�O�w�m+L����`H�
�&lt;w�`W1|ͻi�~b��4W�x����x�B&gt;���J�b�|��؜��ۃ����&lt;M�� E�|{�{�9���eS{)��s��玄�&gt;�&lt;���^�����7�j�ܱ�6r��א?~��_���-k�S�h���r,�ܔ@��`�3���7��\��.x���N���%�u-G�vVf�f�=�R��<span class="hljs-variable">$</span>�����z���\�v*�A9
;{U§;j��(�@UfF���+�&gt;����Ey&amp;�`&#x27;�XrW�FO�Z����u�ŏ��f�B�#�&quot;</span>�`�����<span class="hljs-number">5</span>�<span class="hljs-type">M</span>��˥<span class="hljs-string">&quot;���V�dr���x������7?d��G���j�4�t�:r�(Wj�l�}k�39}Z��Ʃqgos��+ag���.?&lt;� �&quot;</span>��;����<span class="hljs-type">Ow</span>*�<span class="hljs-type">i</span>��<span class="hljs-type">zt</span>�;���<span class="hljs-type">AE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">p_</span>�<span class="hljs-type">T</span>���<span class="hljs-selector-tag">@</span>:���<span class="hljs-type">XiV</span>[�}�<span class="hljs-type">D1</span>�]���  <span class="hljs-type">H</span><span class="hljs-string">&#x27;�Y�/,|m�[� d��X�ao�=O�nK&quot;�1G��&amp;�MgNӾ$x� ĶwrK�6zӻ�����, ��t�ԾxQ�t[��&lt;�����\%��q��U_`����sA�/�8�#�CqRW�j��ߍuY��q��
�9Wn����@e��V��[D�C�&quot;���� (�� (�� (�� (�� (�� (�� (�� (�� +�&gt;%��������j(&lt;Lë�oO�Z������#8+`&gt;��\� ���3M.O
v���p4���QEyey�2HŘ�4�(�L������zΧo�X�e������} �I�j��E{���o�PK�{�K��@�ߜ��r&gt;Lc?�#�⼿D�U��,ҭ��г��9q����&lt;�sX�   _�.sV�����4K�jg��?�f9�q�pq���&#x27;</span>�+�&lt;<span class="hljs-type">C</span>�<span class="hljs-type">i</span>��<span class="hljs-type">B</span><span class="hljs-comment">#��I���$a��3�F9���5N�#��mEw:w�[�WL�. �m����]�ϑ�S&#x27;p#9�t�q�;_�.��YK�%��j�����ܶ��</span>
�<span class="hljs-type">p</span>~���<span class="hljs-type">B</span>���<span class="hljs-type">s</span>���
�<span class="hljs-type">w</span>����<span class="hljs-type">k</span>�<span class="hljs-type">X</span>�<span class="hljs-type">w.</span>��<span class="hljs-type">u</span>��<span class="hljs-type">N</span><span class="hljs-type">s</span>�==�מ�<span class="hljs-type">B</span>�<span class="hljs-type">g</span>�
(��<span class="hljs-number">3</span><span class="hljs-type">U</span>�<span class="hljs-type">M</span>�<span class="hljs-type">G</span>�<span class="hljs-type">GP</span>�<span class="hljs-number">8</span>*}<span class="hljs-type">A</span>�<span class="hljs-type">k</span>� <span class="hljs-type">x</span>��<span class="hljs-type">M8</span>�<span class="hljs-type">t</span>��[�,Ï<span class="hljs-number">5</span><span class="hljs-type">F</span>��������&gt;<span class="hljs-type">jRZx</span>��<span class="hljs-number">8</span><span class="hljs-type">i</span>����<span class="hljs-type">c</span>���<span class="hljs-type">lM</span>%<span class="hljs-type">R</span>�<span class="hljs-type">G</span>�<span class="hljs-number">4</span><span class="hljs-type">QEx</span>�<span class="hljs-type">Q</span><span class="hljs-selector-tag">@</span><span class="hljs-type">Q</span><span class="hljs-selector-tag">@</span><span class="hljs-type">Q</span><span class="hljs-selector-tag">@</span><span class="hljs-type">r</span>�<span class="hljs-type">t</span><span class="hljs-number">5</span>� 
<span class="hljs-type">O</span>+�<span class="hljs-type">xO</span>��:������<span class="hljs-type">U</span>   <span class="hljs-number">8</span><span class="hljs-type">IIt</span>�)�{<span class="hljs-type">y</span>�<span class="hljs-string">&#x27;2�Σ�n�����f�t�$�Ш�;�u�����C$�
��z��U�H�D�;�ӢeIQ���%OB=)�U��x� ���=z+��Z������$�?��*}��^���x���^}�[�CoL`.�&gt;��{�EG��*��Ac�� �n�-߇������2K�iB��2   g##��è|@����w��C��1����r{eI }y����T}^��+�E���֓�&gt;#��^j��s�G� �Ӏ=jM?��O���#X���f���GrQ$��c&#x27;</span>����<span class="hljs-number">6</span>���������<span class="hljs-type">ZW</span>�<span class="hljs-type">m</span>��<span class="hljs-type">X</span>��ª�<span class="hljs-type">e</span>�<span class="hljs-string">&quot;ZC7P�Ĩ&lt;{�k��F���k��5�<span class="hljs-variable">$d</span>�h�.<span class="hljs-variable">$</span>�]�=k���h�/�~l,QEj^��Ò�~&amp;�����L��r���X�f��k��`�vnG���=��?�v��:JXڌ��HF����Ɋ���f�Q^1EPEPEPEPEPEPEPEPEPEPEPEPEPEPEPU5Qe<span class="hljs-variable">$</span>?hX%�Z(X��\��S�ߏJ�^E�_[�u�,�֡{HfS}m�8�@\F��6��I�&lt;dPo
�z&amp;��xWS��PԮ����9I�����a�� �sߡ�UP�g `d�/xv�Gk��h����!SU��d�q���}�� �]@k��eN��!
�pk/�Z�r2=�;I3�Fc�`*T���&amp;}   V�H��u ����#�?:נ�(��(��(��(��(��(��(��(��(�o��x[Q��fG�rݔ��&quot;</span>�<span class="hljs-type">T</span>�`h<span class="hljs-type">o</span>ܑ��<span class="hljs-type">_</span>־į�����<span class="hljs-type">I</span>�<span class="hljs-type">K</span>ɴ��<span class="hljs-variable">$U</span><span class="hljs-number">0</span>��<span class="hljs-type">q</span>���~<span class="hljs-type">U</span>�`k(�Ԩ�Ũ�<span class="hljs-type">n</span>-䶔�<span class="hljs-string">&quot;���5z�w_    ��/B�sϪJ�<span class="hljs-variable">$</span>��S��crT��pϽp�TN
qq}@�[]3�^�G�u��|���D���HL�s�@���*�l&lt;O�vt���t&lt;4��O��IS�2~c��z+�Oy;�ǾC���0%��kH�    ��ٱ �6���܎p;pMS�~#��z6���խ����埞�Xӕ��q���)}R]��w��_�&amp;񵝥��Z6����7-�/9��rq�#�?7�S�5�k��k6үŭ�o���E�f�1��H�P��;�&gt;��&lt;Ci��+�ox�I�d�4Wb�?*Y�er<span class="hljs-variable">$</span>=T�Lpz�����W ��#�%�*J��V
(�� �F�Q��w�k96����㢯Oͱ���h���Q���
���s�+�O�Q&lt;3�(S}&gt;̽�=���+�YS�]X�:�(��B�(��(��(��(����8��F�&quot;</span><span class="hljs-type">F</span>��<span class="hljs-type">g</span>�<span class="hljs-number">1</span>�<span class="hljs-type">c</span>��� <span class="hljs-type">Q</span>���ʊ�<span class="hljs-type">NPw</span>��|)״<span class="hljs-type">m</span>�<span class="hljs-type">G</span>��?<span class="hljs-number">8</span>����<span class="hljs-type">G</span>�\<span class="hljs-type">L</span>�<span class="hljs-type">w0</span>�<span class="hljs-type">B</span>�����<span class="hljs-type">U</span>��<span class="hljs-type">xsF</span>�<span class="hljs-number">2</span><span class="hljs-type">ot</span>�<span class="hljs-type">yX</span>�}�<span class="hljs-type">o</span>��<span class="hljs-type">s</span>��<span class="hljs-type">u</span>&lt;{�<span class="hljs-type">h</span>�<span class="hljs-type">c</span>�+�<span class="hljs-type">G</span>�� �<span class="hljs-type">o</span>�&amp;{<span class="hljs-type">v</span>=�~�?�<span class="hljs-type">s</span>�����<span class="hljs-type">jh</span>}���<span class="hljs-type">O</span>��(����<span class="hljs-number">4</span><span class="hljs-type">W</span>�<span class="hljs-type">I</span>�<span class="hljs-number">7</span><span class="hljs-type">W_</span>�<span class="hljs-type">yh</span>�<span class="hljs-type">I</span>[�����<span class="hljs-type">O</span>^���%�<span class="hljs-type">Z</span>}<span class="hljs-type">b</span>��!�<span class="hljs-type">aEz</span>�<span class="hljs-type">u</span>�?<span class="hljs-number">4</span>�/�<span class="hljs-type">o</span>�<span class="hljs-type">SZ</span>������[(� <span class="hljs-type">e</span>���<span class="hljs-type">QI</span>�<span class="hljs-type">i</span>/�<span class="hljs-type">G</span>�Ӓ)%<span class="hljs-number">8</span>����׿<span class="hljs-type">X</span>��!����<span class="hljs-type">_Q</span><span class="hljs-type">a</span><span class="hljs-type">V</span>-]<span class="hljs-type">V</span>��� �<span class="hljs-type">Zn</span>Қ<span class="hljs-type">rL</span>ü��;�<span class="hljs-type">J</span>�<span class="hljs-type">X</span>�<span class="hljs-type">KmE</span>̏����Ի-,�~<span class="hljs-type">y</span>ڹ�װ�<span class="hljs-type">H</span>����Ɨ<span class="hljs-type">WMg</span>ۏ��<span class="hljs-type">Y</span>�����<span class="hljs-type">M</span>{�<span class="hljs-type">QG</span><span class="hljs-type">b8</span>�<span class="hljs-type">H</span>�<span class="hljs-type">z</span>*�<span class="hljs-type">S</span>뒮<span class="hljs-number">6</span><span class="hljs-type">r</span>�: ��|<span class="hljs-number">9</span>��<span class="hljs-number">6</span>�<span class="hljs-type">K</span>}<span class="hljs-type">M</span>�<span class="hljs-type">I</span>��<span class="hljs-string">&quot;�#%K2O��A��uLx����5b�*Xgi��ۘ��h��ʕѕ<span class="hljs-variable">$</span>�v88��m�Y<span class="hljs-variable">$</span>�W��z�h5�U��c�9� ����5i��7�W����^�w�8�;RR�3�;�@W�|R�Ě%�~ҝS\�aa�r��n���F ����d���&#x27;�&#x27;��5���o_i����-6}B+��  *���N�R ������H�ήt�5)����6hZf`����&lt;d    <span class="hljs-variable">$b</span>�:�(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��1&lt;c-��䱊YnŌ��K1r���/��xB�B׼3퍽ݖ�g�b�[��wQ����}\m��M
A����m潺0�(]�B�������J�`���]6��`��E�˶���=jk˨쬧���.�FǠ���#�夷1�����j��8���]�5cP��Tt
0)� QE QE QE QE QE QE QE QE QE RJ�=�h�4�g]DIq���,m��&#x27;���?N�J�}c��t�M�ȿ��Q���{��u^���P��ym��ֻh�g%�)H��H���Ȍ�ЌS+�-c�&gt;�����    �_5?&quot;</span><span class="hljs-type">r</span>?:�<span class="hljs-type">u_</span>�:���!�^�<span class="hljs-type">D</span>�[�<span class="hljs-type">n</span>?*�*���<span class="hljs-type">wG</span>��]<span class="hljs-type">e</span>���<span class="hljs-type">n</span>�&amp;<span class="hljs-type">K</span>��[��Ɽ���<span class="hljs-type">b</span>�<span class="hljs-type">fGl</span>�<span class="hljs-type">Q</span>[�<span class="hljs-string">&#x27;���*��/���i7���� �T**������Y�����mA��F���=��� 5��Ӯ�{Ȃ!� �Wg���!��-�Ǣ+~����^�w�]7��������v��o��n�$��3�6�&gt;���k�&gt;�IW�)������/OҺ�  �:\u1�jh�#��ǃt�ź��a�s�Q�&quot;�*(�&gt;S����
(���(��(��(��(��(��(��(��(��(��(��(��(��(�o�^�ܼ��N���$��~P2OA��}j���t�N���[]B��9�Ⱦ��:쨠K*C�+��1� �k&quot;�H�ߋ�Q�l��V%GtY6�Ѻ�µn-⻶��t�Q�� ��]|8��cs�jZl���e�u�4 �W�o��K/L6�m�X\5�ؠm�30��z�G5�����M�j�DPl�����$_/������^��Z�v�bë^-��c��{�&lt;:�P�N��jia}v!��8,�n   #�:t�@`�&#x27;</span>��|<span class="hljs-number">4</span>|<span class="hljs-type">Fc</span>��<span class="hljs-type">Hl</span>�����<span class="hljs-number">8</span>�<span class="hljs-type">T</span>�<span class="hljs-number">9</span>���<span class="hljs-type">G</span>���/� �<span class="hljs-type">b</span>}���<span class="hljs-type">P</span>�<span class="hljs-type">z</span>���}&amp;{<span class="hljs-type">dq</span>�<span class="hljs-type">H</span>�<span class="hljs-type">R</span>��<span class="hljs-string">&#x27;8�z��N�Cou8�7\+��z��|�k���kk�N�l廍�e�N� &#x27;</span>��<span class="hljs-selector-tag">@</span>⧅�]���<span class="hljs-type">g</span>�<span class="hljs-type">..</span>�<span class="hljs-type">V</span>�<span class="hljs-type">d</span>���<span class="hljs-type">J</span>���<span class="hljs-type">R</span><span class="hljs-type">S</span>��+�<span class="hljs-type">V</span>�<span class="hljs-type">v</span>��<span class="hljs-type">x</span>�� ��<span class="hljs-number">7</span>��@<span class="hljs-type">b</span>:��<span class="hljs-type">y</span>��<span class="hljs-number">0</span>���(<span class="hljs-number">4</span>�<span class="hljs-type">i</span>�<span class="hljs-type">k</span>;�<span class="hljs-number">4</span>���<span class="hljs-type">c</span>��<span class="hljs-type">k</span>?)�<span class="hljs-number">1</span><span class="hljs-type">Rs</span>�<span class="hljs-type">Y</span>�<span class="hljs-type">P0H</span><span class="hljs-type">z</span>{�?�<span class="hljs-type">Qq</span>�<span class="hljs-type">V</span>�]<span class="hljs-number">2</span>���<span class="hljs-type">l</span>�������<span class="hljs-type">J</span><span class="hljs-type">w</span> <span class="hljs-type">r</span>��~&lt;<span class="hljs-type">b</span>�=ڊ�<span class="hljs-type">_</span>,�&amp;[<span class="hljs-type">K</span>�<span class="hljs-type">w</span>��ʬ�&amp;�<span class="hljs-number">7</span>�<span class="hljs-type">n</span>�<span class="hljs-type">zu</span>�<span class="hljs-type">q</span>�<span class="hljs-type">o</span>|<span class="hljs-type">H</span>�<span class="hljs-type">n</span>��<span class="hljs-type">k</span>^ �����[��<span class="hljs-type">m</span>�ƠҀ<span class="hljs-number">0</span>�<span class="hljs-type">Y</span>�忺~��<span class="hljs-type">W</span>)�ω�<span class="hljs-type">U</span>�<span class="hljs-type">vzV</span>��<span class="hljs-type">E</span>,��<span class="hljs-type">D</span>���<span class="hljs-type">p</span> �    �<span class="hljs-number">5</span>��<span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span>\/���<span class="hljs-type">_</span>�槫,��<span class="hljs-number">5</span>�<span class="hljs-number">4</span><span class="hljs-type">AX</span>�~��<span class="hljs-type">x</span>� ��<span class="hljs-type">v</span>�<span class="hljs-type">P</span>��<span class="hljs-type">I</span>�<span class="hljs-type">Y</span><span class="hljs-comment">#&quot;/U��G�f�oA�ÚB��&#x27;�w���v�&#x27;���P�Q@Q@Q@Q@Q@Q@Q@Q@Q@Q@Q@Q@Q@E-�� ��9?�P�KE P}I���vM����Q�7��M� �T� </span>
Ԣ��]�������<span class="hljs-type">M</span>�<span class="hljs-type">O</span>�`Q�*⢢�<span class="hljs-type">E</span>
�����<span class="hljs-type">m</span>�<span class="hljs-type">E</span><span class="hljs-type">R</span> ��( ��( ��( ��( ��( ��( ��( ��( ��( ��( ��( ��( ��( ��( ��( ��( ��( ��( �:���<span class="hljs-type">j</span>�쿲�<span class="hljs-type">q</span>�����?
�<span class="hljs-type">E</span> <span class="hljs-type">r</span>�&gt;�ҵ�<span class="hljs-type">u</span>&gt;��<span class="hljs-type">F</span>�ۉ<span class="hljs-number">2</span>����\<span class="hljs-type">g</span>�<span class="hljs-number">5</span>�<span class="hljs-type">j</span><span class="hljs-type">F</span>�<span class="hljs-type">N</span>��<span class="hljs-type">Xd</span>�����<span class="hljs-number">0</span><span class="hljs-type">K9</span>�*���<span class="hljs-number">4</span>;��<span class="hljs-variable">$</span>��~�<span class="hljs-type">.</span>?�?&lt;<span class="hljs-type">WQ</span>�\<span class="hljs-type">D</span>��*<span class="hljs-type">K</span><span class="hljs-type">tt</span>`��<span class="hljs-string">&quot;��Z���/�a����ч#��ZU�������    ��sր ����qk�B���&gt;��g�EY��۱����7�;}&#x27;L���#A���&amp;��&amp;��*��d�����V����6���t��2FN���p:u�?E�Ώ��%�m,np!�9&#x27;�Ƞ�--�a�-�(dH� E�0aSQE QE QE QE QE QE QE QE QE QQ�J`��QHQA�l�{�&quot;</span>����<span class="hljs-type">h</span>[<span class="hljs-type">y</span>�&gt;<span class="hljs-type">d</span>Ӈǖ<span class="hljs-type">q</span>�<span class="hljs-type">c</span>�<span class="hljs-type">Q</span>�<span class="hljs-number">5</span>�\<span class="hljs-type">g</span>�<span class="hljs-number">4</span>땆� <span class="hljs-type">Y</span>�<span class="hljs-string">&quot;d����WR
�&#x27;���!]� QE QE QE QE QE QE QE QE QE QE QE QE QE QE QE QE QE QE QE QE QE QE QE QE QE QE QE QE QE QE QE QE QE QE QE QE QE QE Y��&amp;�K�k    �L�`�21ׯJ�E T�㼛L��O�!�d&quot;</span>)��^����<span class="hljs-type">H</span>|<span class="hljs-type">_</span>��<span class="hljs-type">h</span>�����<span class="hljs-type">S</span>���
�<span class="hljs-type">h</span>�
:&gt;���è<span class="hljs-type">A</span>��<span class="hljs-type">.v</span>������<span class="hljs-type">U</span>� �<span class="hljs-type">r</span>��<span class="hljs-type">u</span>��<span class="hljs-type">M</span>�-]��<span class="hljs-type">R</span>�<span class="hljs-type">E</span>������=<span class="hljs-type">h</span>�<span class="hljs-type">y</span>&lt;<span class="hljs-type">o</span>`�!<span class="hljs-type">FN2OAN</span>�*�<span class="hljs-type">_</span><span class="hljs-type">_H</span>�<span class="hljs-string">&#x27;�t�ͬ��-���Fs�t���]2��va&lt;q9�oP��&gt;l}����@�E2)���H�e]A��=C[�4�����]���M4�v@_��MK�׆�r�4�-ت�����Z�㢂E���2;?�������J+�럍���R�݈Rk:O��(��_�$c�%j�5{���*+�S�[�����OO�~*N��~����?�T�^�����&#x27;</span><span class="hljs-type">F</span><span class="hljs-type">I</span>�<span class="hljs-type">A</span>��<span class="hljs-type">G</span>�<span class="hljs-type">V</span>���=<span class="hljs-type">Ip.lm</span>�<span class="hljs-type">z</span>�`�/�<span class="hljs-type">R</span>�<span class="hljs-number">5</span><span class="hljs-type">W</span>`�<span class="hljs-type">g</span>��^<span class="hljs-type">U</span>��<span class="hljs-type">p</span>�� ^�<span class="hljs-type">I</span>�<span class="hljs-type">E</span>&amp;<span class="hljs-type">F</span>��<span class="hljs-type">Y</span>�|<span class="hljs-type">D</span>�ƣ�&amp;���<span class="hljs-type">v</span>�<span class="hljs-type">J</span>���������<span class="hljs-type">c</span>�<span class="hljs-type">Efu5</span>��\<span class="hljs-type">s4bb</span>��<span class="hljs-type">e</span>��=<span class="hljs-type">q</span>��<span class="hljs-type">M</span>�,�Ȓ<span class="hljs-type">F</span>܆<span class="hljs-type">F</span>�<span class="hljs-type">W</span>    �����<span class="hljs-type">w</span>�<span class="hljs-type">k</span>��<span class="hljs-type">Z</span>�� �ڞޙ�<span class="hljs-type">O</span>���<span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span> <span class="hljs-type">QE</span>���<span class="hljs-type">m5</span>�<span class="hljs-type">c</span>����=`�<span class="hljs-type">DT</span>?<span class="hljs-type">_</span>�<span class="hljs-string">&#x27;�&amp;����?��2�چ�=�� ���?���ڵ&gt;&amp;|D:���I��1,�yL�����=��&lt;��k�L�9bN~�߇��i�RGR�&lt;�l-���.�a�v��3�Ѐ��3q�]�34���rpq��W�F
�V((���
(��
(��
(��
r;#nF*}A�6� ��|S��E��{2+0W+�{��^��O�v:=�鷶[!.[͌��&gt;����w� ���F&gt;$&gt;��5K-b�n�.h[��P}�֮W������V�H�#�� &quot;���׈m|M��m���s��=�pk��a�-V���lQE� ��( ��( ��( ��( ��( ��( ��( ��( ��( ��( ��( ��( ��( ��( ��( ��( ��( ��( ��( ��( ��( ��( ��( ��( ��( ��( ��( ��( ��( ��( ��( ��( ��( ��( ��( ��( ��( ��( ��( ��e�-e��ж&gt;�5-#*�20ʰ���&gt;@�o&amp;��.&#x27;</span>��<span class="hljs-type">H</span>�<span class="hljs-type">I</span><span class="hljs-string">&#x27;�&lt;���Y��x��w����ݔl}���������I���(����6���^]��דC&quot;��� -������9���{�ڎ�u}#���[隕�;���ȫ�(#$.Ӄ�h�=k�4�ox�;�Q1��l�4gp�Rs��bx�]��=���n��m�=�Ą�����{�$�Y����qu7 �s��Z��}� �MKr�`�{�eT`�{�{�=Oᤒj��4����O[��5�!�&gt;������~&amp;x�?�Y���b�� ��A�Ҟ���֕� ĭ9�}.�73i��h���N�N��ӽR��R�o���R���|;�b�N��/���E��xڋ�0�ӓ�ջ�&gt;���f���m��)n�.Ǔ��ۅ㯸�;ī�o��I�}���]ث�}��֏���\��!�������5�B�)�|�y�J��~`k���lC�m�+��5�̂�I����&#x27;</span>�<span class="hljs-type">S</span>��խ<span class="hljs-number">7</span>�}
�Ú������<span class="hljs-type">t</span>�<span class="hljs-type">k0</span>�!<span class="hljs-number">0</span>�% �<span class="hljs-type">x</span>=�&lt;<span class="hljs-type">c</span>���<span class="hljs-string">&#x27;�&lt;=���{kM1mgP��! \��@�S��U�?_ˬh��ڶ�&amp;��&gt;�Vl�$�uϡ��[%�����?��m��&gt;��I�&lt;�#cdS���#�&#x27;</span>���<span class="hljs-type">Xxj</span>(<span class="hljs-type">_</span>�]<span class="hljs-type">X</span>-��<span class="hljs-number">9</span>�<span class="hljs-type">U</span>�<span class="hljs-type">B</span>=<span class="hljs-number">9</span>�<span class="hljs-number">1</span>�+�����<span class="hljs-type">Z</span>�<span class="hljs-type">.</span>�&amp;��<span class="hljs-type">KKS</span>� ����@<span class="hljs-type">N</span>�<span class="hljs-string">&#x27;���������O��F(6�������$��֔���yh�S���+�a^��;Q�u[���$$��H#� Boμ�H d��W���ԶV��W�SY��,��&gt;)�I�Oc�h����
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��0�O�M?�Vg�]�(&gt;T�2S�G�|��� j��`�-��%^U����&lt;�k�:d�G&lt;MѬ���#��=����R�t4�|d�U�� ���W�^ �K�k����S�F�����{W��_5�&lt;��*��;�w˃�^�&lt;U)��WG��Z���t�)sg,m��T�G��  c��:�T���GES ��( ��P   8 ��@   EO�̿r&gt;�`~����^Պ���gS�J��ϧ�I��`s�5���O��s���[�&gt;�HVMV�8���!��k���~֖��^�K�0�v��SNj��&lt;���   ��x���h`0�����=�&gt;����A�   �qF�Q`(�IEy��ʫ��n�EV&quot;
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��
(��$Q̅%Et=U�A�k�xv�.�j    �c_/� A�nQUJ;08������-%�?ܔ��5�&#x27;</span>���ݚ�~�<span class="hljs-type">_</span>�<span class="hljs-type">Q</span>^�<span class="hljs-type">Eh</span>�<span class="hljs-type">W</span>���-�<span class="hljs-type">OC</span>��<span class="hljs-type">y8</span>���<span class="hljs-type">T</span>�)��]�<span class="hljs-type">G</span>�<span class="hljs-type">k</span>^�<span class="hljs-type">EW</span>֫<span class="hljs-number">0</span>]�}��<span class="hljs-type">FAf</span>�<span class="hljs-type">s</span>�<span class="hljs-selector-tag">@</span>?�ն�<span class="hljs-type">m</span>�{<span class="hljs-type">l</span>�<span class="hljs-number">4</span>��<span class="hljs-type">I</span>[�<span class="hljs-type">u</span>�<span class="hljs-type">T</span>�<span class="hljs-type">EW</span>��]�����<span class="hljs-number">0</span><span class="hljs-type">mt</span>�<span class="hljs-type">H</span>��<span class="hljs-type">n</span>��֕<span class="hljs-type">VM</span>����(�<span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span><span class="hljs-type">E</span><span class="hljs-type">P</span>��</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrc.eslintrc"><a href="#toc"><a name="ui-src--eslintrc">ui/src/.eslintrc</a></a></h2>
<pre><code>{
  <span class="hljs-string">&quot;extends&quot;</span>: <span class="hljs-string">&quot;react-app&quot;</span>,
  <span class="hljs-string">&quot;plugins&quot;</span>: [<span class="hljs-string">&quot;react&quot;</span>, <span class="hljs-string">&quot;react-hooks&quot;</span>],
  <span class="hljs-string">&quot;rules&quot;</span>: {
    <span class="hljs-string">&quot;react-hooks/exhaustive-deps&quot;</span>: <span class="hljs-string">&quot;warn&quot;</span>,
    <span class="hljs-string">&quot;indent&quot;</span>: [<span class="hljs-string">&quot;warn&quot;</span>, <span class="hljs-number">2</span>, { <span class="hljs-string">&quot;SwitchCase&quot;</span>: <span class="hljs-number">1</span> }],
    <span class="hljs-string">&quot;no-trailing-spaces&quot;</span>: [<span class="hljs-string">&quot;off&quot;</span>],
    <span class="hljs-string">&quot;semi&quot;</span>: [<span class="hljs-string">&quot;warn&quot;</span>, <span class="hljs-string">&quot;never&quot;</span>],
    <span class="hljs-string">&quot;object-curly-spacing&quot;</span>: [<span class="hljs-string">&quot;off&quot;</span>, <span class="hljs-string">&quot;always&quot;</span>],
    <span class="hljs-string">&quot;array-bracket-spacing&quot;</span>: [<span class="hljs-string">&quot;off&quot;</span>, <span class="hljs-string">&quot;always&quot;</span>],
    <span class="hljs-string">&quot;quotes&quot;</span>: [<span class="hljs-string">&quot;warn&quot;</span>, <span class="hljs-string">&quot;single&quot;</span>,{<span class="hljs-string">&quot;avoidEscape&quot;</span>: true}],
    <span class="hljs-string">&quot;space-before-function-paren&quot;</span>: [<span class="hljs-string">&quot;off&quot;</span>,{
      <span class="hljs-string">&quot;anonymous&quot;</span>: <span class="hljs-string">&quot;always&quot;</span>, <span class="hljs-string">&quot;named&quot;</span>: <span class="hljs-string">&quot;never&quot;</span>, <span class="hljs-string">&quot;asyncArrow&quot;</span>: <span class="hljs-string">&quot;always&quot;</span>
    }],
    <span class="hljs-string">&quot;space-infix-ops&quot;</span>: [<span class="hljs-string">&quot;warn&quot;</span>,{<span class="hljs-string">&quot;int32Hint&quot;</span>: false}]
  }
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrc.prettierrc"><a href="#toc"><a name="ui-src--prettierrc">ui/src/.prettierrc</a></a></h2>
<pre><code><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">&quot;trailingComma&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;es5&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;tabWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;semi&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">false</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;singleQuote&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;quoteProps&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;as-needed&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;jsxSingleQuote&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;jsxBracketSameLine&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;printWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;bracketSpacing&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;arrowParens&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;avoid&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;htmlWhitespaceSensitivity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;strict&quot;</span>
<span class="hljs-punctuation">}</span></pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrccomponentsapp.js"><a href="#toc"><a name="ui-src-components-app-js">ui/src/components/App.js</a></a></h2>
<pre><code><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, {  memo } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">BrowserRouter</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">Router</span>, <span class="hljs-title class_">Switch</span>, <span class="hljs-title class_">Route</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-router-dom&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;../utils/iconsInit&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Footer</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./Footer&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Header</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./Header&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Home</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../pages/Home&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Glossary</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../pages/Glossary&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Disclaimer</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../pages/Disclaimer&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Methodology</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../pages/Methodology&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">EvictionsPage</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../pages/EvictionPage&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">OwnerPage</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../pages/OwnerPage&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ParcelPage</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../pages/ParcelPage&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">NetworkPage</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../pages/NetworkPage&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">SearchResultsPage</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../pages/SearchResultsPage&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">NoPage</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./NotAvailable&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ThemeProvider</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/styles&#x27;</span>
<span class="hljs-keyword">import</span> { useTheme } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/styles&#x27;</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">App</span> = (<span class="hljs-params"></span>) =&gt; {

  <span class="hljs-keyword">const</span> theme = <span class="hljs-title function_">useTheme</span>()

  <span class="hljs-keyword">return</span> (
    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ThemeProvider</span> <span class="hljs-attr">theme</span>=<span class="hljs-string">{theme}</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Router</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Header</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Switch</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Route</span>
            <span class="hljs-attr">exact</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/&quot;</span>
            <span class="hljs-attr">component</span>=<span class="hljs-string">{Home}</span>
          /&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Route</span>
            <span class="hljs-attr">exact</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/glossary&quot;</span>
            <span class="hljs-attr">component</span>=<span class="hljs-string">{Glossary}</span>
          /&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Route</span>
            <span class="hljs-attr">exact</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/disclaimer&quot;</span>
            <span class="hljs-attr">component</span>=<span class="hljs-string">{Disclaimer}</span>
          /&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Route</span>
            <span class="hljs-attr">exact</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/methodology&quot;</span>
            <span class="hljs-attr">component</span>=<span class="hljs-string">{Methodology}</span>
          /&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Route</span>
            <span class="hljs-attr">exact</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/neighborhood&quot;</span>
            <span class="hljs-attr">component</span>=<span class="hljs-string">{EvictionsPage}</span>
          /&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Route</span>
            <span class="hljs-attr">exact</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/owner&quot;</span>
            <span class="hljs-attr">component</span>=<span class="hljs-string">{OwnerPage}</span>
          /&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Route</span>
            <span class="hljs-attr">exact</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/parcel&quot;</span>
            <span class="hljs-attr">component</span>=<span class="hljs-string">{ParcelPage}</span>
          /&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Route</span>
            <span class="hljs-attr">exact</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/graph&quot;</span>
            <span class="hljs-attr">component</span>=<span class="hljs-string">{NetworkPage}</span>
          /&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Route</span>
            <span class="hljs-attr">exact</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/searchresults&quot;</span>
            <span class="hljs-attr">component</span>=<span class="hljs-string">{SearchResultsPage}</span>
          /&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Route</span>
            <span class="hljs-attr">exact</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/feedback&quot;</span>
            <span class="hljs-attr">component</span>=<span class="hljs-string">{()</span> =&gt;</span> {
              window.location =
                &#x27;https://docs.google.com/forms/d/e/1FAIpQLSfm5EOxtftVfabB3mBln9pja61xyiHgfpskcjhs_hlejEnLuA/viewform?embedded=true&#x27;
            }}
          /&gt;
          <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">component</span>=<span class="hljs-string">{NoPage}</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Switch</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Footer</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Router</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">ThemeProvider</span>&gt;</span></span>
  )
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">memo</span>(<span class="hljs-title class_">App</span>)</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrccomponentsdatadata.js"><a href="#toc"><a name="ui-src-components-data-data-js">ui/src/components/Data/Data.js</a></a></h2>
<pre><code><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { forwardRef } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">PropTypes</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;prop-types&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">DataInner</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./DataInner&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ErrorBoundary</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-error-boundary&#x27;</span>
<span class="hljs-keyword">import</span> { isNull, getChildren } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./DataUtils&#x27;</span>
<span class="hljs-keyword">export</span> { isEmpty, isNull, sliceJson, selectMarkerData, selectCoordsData, urlParam, selected, renderChildren } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./DataUtils&#x27;</span>

<span class="hljs-comment">/*
  Data: a component to add data fetching and conditional rendering to other components without manually-written Redux or fetch code
  Props:
    fetch[]: an object specifying data that needs to be fetched (optional)
    isDebugEnabled: a boolean that when true enables debug info in the UI and the console 
  notes:
    Wraps the following functionality into a composable component:
      Redux - manages storing state in Redux based on &#x27;slice&#x27; names
      Pending - tracks the pending state and display content such as a loading indicator
      Fulfilled - tracks the fulfillment state and displays child content (typically a page&#x27;s, map&#x27;s, or table&#x27;s contents)
      Rejected - tracks the rejection state and display constent such as an error indicator
      NoData - tracks requests that are fulfilled but lacked data and shows content such as a no-data indicator
      Timeout - tracks time in seconds and shows content such as a page-not-found indicator
*/</span>

<span class="hljs-keyword">const</span> <span class="hljs-title class_">Data</span> = <span class="hljs-title function_">forwardRef</span>(<span class="hljs-function">(<span class="hljs-params">props, ref</span>) =&gt;</span> {

  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isNull</span>(props)) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>

  <span class="hljs-keyword">const</span> children = props.<span class="hljs-property">children</span>

  <span class="hljs-keyword">const</span> subComponentChildren = ({
    <span class="hljs-attr">pending</span>: <span class="hljs-title function_">getChildren</span>(children, <span class="hljs-string">&#x27;Pending&#x27;</span>),
    <span class="hljs-attr">fulfilled</span>: <span class="hljs-title function_">getChildren</span>(children, <span class="hljs-string">&#x27;Fulfilled&#x27;</span>),
    <span class="hljs-attr">rejected</span>: <span class="hljs-title function_">getChildren</span>(children, <span class="hljs-string">&#x27;Rejected&#x27;</span>),
    <span class="hljs-attr">timeout</span>: <span class="hljs-title function_">getChildren</span>(children, <span class="hljs-string">&#x27;Timeout&#x27;</span>),
    <span class="hljs-attr">nodata</span>: <span class="hljs-title function_">getChildren</span>(children, <span class="hljs-string">&#x27;NoData&#x27;</span>)
  })

  <span class="hljs-keyword">return</span> (
    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ErrorBoundary</span> <span class="hljs-attr">FallbackComponent</span>=<span class="hljs-string">{subComponentChildren.rejected}</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">DataInner</span>
        {<span class="hljs-attr">...props</span>}
        <span class="hljs-attr">subComponentChildren</span>=<span class="hljs-string">{subComponentChildren}</span>
        <span class="hljs-attr">ref</span>=<span class="hljs-string">{ref}</span>
      /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">ErrorBoundary</span>&gt;</span></span>
  )

})

<span class="hljs-comment">/* Define sub-components types */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">Pending</span> = props =&gt; <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span>{props.children}<span class="hljs-tag">&lt;/&gt;</span></span>
<span class="hljs-title class_">Pending</span>.<span class="hljs-property">displayName</span> = <span class="hljs-string">&#x27;Pending&#x27;</span>
<span class="hljs-title class_">Data</span>.<span class="hljs-property">Pending</span> = <span class="hljs-title class_">Pending</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">Fulfilled</span> = props =&gt; <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span>{props.children}<span class="hljs-tag">&lt;/&gt;</span></span>
<span class="hljs-title class_">Fulfilled</span>.<span class="hljs-property">displayName</span> = <span class="hljs-string">&#x27;Fulfilled&#x27;</span>
<span class="hljs-title class_">Data</span>.<span class="hljs-property">Fulfilled</span> = <span class="hljs-title class_">Fulfilled</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">Rejected</span> = props =&gt; <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span>{props.children}<span class="hljs-tag">&lt;/&gt;</span></span>
<span class="hljs-title class_">Rejected</span>.<span class="hljs-property">displayName</span> = <span class="hljs-string">&#x27;Rejected&#x27;</span>
<span class="hljs-title class_">Data</span>.<span class="hljs-property">Rejected</span> = <span class="hljs-title class_">Rejected</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">Timeout</span> = props =&gt; <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span>{props.children}<span class="hljs-tag">&lt;/&gt;</span></span>
<span class="hljs-title class_">Timeout</span>.<span class="hljs-property">displayName</span> = <span class="hljs-string">&#x27;Timeout&#x27;</span>
<span class="hljs-title class_">Data</span>.<span class="hljs-property">Timeout</span> = <span class="hljs-title class_">Timeout</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">NoData</span> = props =&gt; <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span>{props.children}<span class="hljs-tag">&lt;/&gt;</span></span>
<span class="hljs-title class_">NoData</span>.<span class="hljs-property">displayName</span> = <span class="hljs-string">&#x27;NoData&#x27;</span>
<span class="hljs-title class_">Data</span>.<span class="hljs-property">NoData</span> = <span class="hljs-title class_">NoData</span>

<span class="hljs-title class_">Data</span>.<span class="hljs-property">propTypes</span> = {
  <span class="hljs-attr">fetch</span>: <span class="hljs-title class_">PropTypes</span>.<span class="hljs-title function_">arrayOf</span>(<span class="hljs-title class_">PropTypes</span>.<span class="hljs-title function_">shape</span>({
    <span class="hljs-attr">slice</span>: <span class="hljs-title class_">PropTypes</span>.<span class="hljs-property">string</span>.<span class="hljs-property">isRequired</span>,
    <span class="hljs-attr">url</span>: <span class="hljs-title class_">PropTypes</span>.<span class="hljs-property">string</span>.<span class="hljs-property">isRequired</span>,
    <span class="hljs-attr">select</span>: <span class="hljs-title class_">PropTypes</span>.<span class="hljs-property">func</span>
  })),
  <span class="hljs-attr">children</span>: <span class="hljs-title class_">PropTypes</span>.<span class="hljs-title function_">arrayOf</span>(<span class="hljs-title class_">PropTypes</span>.<span class="hljs-property">node</span>),
  <span class="hljs-attr">isDebugEnabled</span>: <span class="hljs-title class_">PropTypes</span>.<span class="hljs-property">bool</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">Data</span></pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrccomponentsdatadatadebug.js"><a href="#toc"><a name="ui-src-components-data-datadebug-js">ui/src/components/Data/DataDebug.js</a></a></h2>
<pre><code><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { forwardRef } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">PropTypes</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;prop-types&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Card</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/Card&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">CardContent</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/CardContent&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Typography</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/Typography&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Paper</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/Paper&#x27;</span>
<span class="hljs-keyword">import</span> { useTheme } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/styles&#x27;</span>
<span class="hljs-keyword">import</span> { isNull, isEmpty, <span class="hljs-title class_">Children</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./DataUtils&#x27;</span>
<span class="hljs-keyword">import</span> { makeStyles } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/styles&#x27;</span>

<span class="hljs-comment">/* 
  DataDebug: a component to render debug information in the UI
  props:
    childrenToRender[] - child elements that should be rendered (optional)
*/</span>

<span class="hljs-keyword">const</span> <span class="hljs-title class_">DebugInfo</span> = <span class="hljs-title function_">forwardRef</span>(<span class="hljs-function">(<span class="hljs-params">props, ref</span>) =&gt;</span> {

  <span class="hljs-keyword">const</span> useStyles = <span class="hljs-title function_">makeStyles</span>(<span class="hljs-function"><span class="hljs-params">theme</span> =&gt;</span>
    ({
      <span class="hljs-attr">root</span>: { <span class="hljs-attr">fontSize</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">marginBottom</span>: <span class="hljs-number">2</span> },
      <span class="hljs-attr">title</span>: { <span class="hljs-attr">fontSize</span>: <span class="hljs-number">12</span> },
      <span class="hljs-attr">body</span>: { <span class="hljs-attr">fontSize</span>: <span class="hljs-number">10</span> },
      <span class="hljs-attr">cardcontent</span>: { <span class="hljs-attr">padding</span>: <span class="hljs-number">4</span>, <span class="hljs-string">&#x27;&amp;:last-child&#x27;</span>: { <span class="hljs-attr">paddingBottom</span>: <span class="hljs-number">4</span> } },
      <span class="hljs-attr">paper</span>: { <span class="hljs-attr">paddingLeft</span>: <span class="hljs-number">5</span>, <span class="hljs-attr">paddingRight</span>: <span class="hljs-number">5</span>},
      <span class="hljs-attr">td</span>: { <span class="hljs-attr">paddingRight</span>: <span class="hljs-number">20</span> }
    })
  )
  <span class="hljs-keyword">const</span> theme = <span class="hljs-title function_">useTheme</span>()
  <span class="hljs-keyword">const</span> classes = <span class="hljs-title function_">useStyles</span>(theme) ?? {}

  <span class="hljs-comment">/* Short-circuits */</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isNull</span>(props)) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
  <span class="hljs-keyword">if</span> (props.<span class="hljs-property">isDebugEnabled</span> === <span class="hljs-literal">false</span> || <span class="hljs-title function_">isEmpty</span>(props.<span class="hljs-property">debugInfo</span>)) <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Children</span> {<span class="hljs-attr">...props</span>} <span class="hljs-attr">childrenToRender</span>=<span class="hljs-string">{props.childrenToRender}</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{ref}</span> /&gt;</span></span>

  <span class="hljs-comment">/* Helper components to render repetitive content to enhance readability */</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">TH</span> = p =&gt; <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{classes.td}</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">Paper</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{classes.paper}</span>&gt;</span>{p.children}<span class="hljs-tag">&lt;/<span class="hljs-name">Paper</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span></span> <span class="hljs-comment">/* Header */</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">TD</span> = p =&gt; <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{classes.td}</span>&gt;</span>{p.children}<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span></span> <span class="hljs-comment">/* Columns */</span>

  <span class="hljs-keyword">const</span> resources = props.<span class="hljs-property">debugInfo</span>?.<span class="hljs-property">resources</span>

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">Info</span> = props =&gt;
    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Card</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{classes.root}</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">CardContent</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{classes.cardcontent}</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Typography</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{classes.title}</span> <span class="hljs-attr">color</span>=<span class="hljs-string">&quot;textSecondary&quot;</span> <span class="hljs-attr">gutterBottom</span>&gt;</span>
          [Debug Mode] Network Statistics
        <span class="hljs-tag">&lt;/<span class="hljs-name">Typography</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{classes.body}</span> <span class="hljs-attr">variant</span>=<span class="hljs-string">&quot;body2&quot;</span> <span class="hljs-attr">component</span>=<span class="hljs-string">&quot;p&quot;</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">tbody</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">TH</span>&gt;</span>Name<span class="hljs-tag">&lt;/<span class="hljs-name">TH</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">TH</span>&gt;</span>Url<span class="hljs-tag">&lt;/<span class="hljs-name">TH</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">TH</span>&gt;</span>Status<span class="hljs-tag">&lt;/<span class="hljs-name">TH</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">TH</span>&gt;</span>Size<span class="hljs-tag">&lt;/<span class="hljs-name">TH</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">TH</span>&gt;</span>Roundtrip<span class="hljs-tag">&lt;/<span class="hljs-name">TH</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">TH</span>&gt;</span>Encoding<span class="hljs-tag">&lt;/<span class="hljs-name">TH</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">TH</span>&gt;</span>Cache<span class="hljs-tag">&lt;/<span class="hljs-name">TH</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
              {Array.isArray(props?.resources) &amp;&amp;
                resources.map(resource =&gt; 
                  <span class="hljs-tag">&lt;<span class="hljs-name">tr</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{resource.slice}</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">TD</span>&gt;</span>{resource.slice}<span class="hljs-tag">&lt;/<span class="hljs-name">TD</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">TD</span>&gt;</span>{resource.url}<span class="hljs-tag">&lt;/<span class="hljs-name">TD</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">TD</span>&gt;</span>{resource.response.status}<span class="hljs-tag">&lt;/<span class="hljs-name">TD</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">TD</span>&gt;</span>{JSON.stringify(resource.json)?.length}b<span class="hljs-tag">&lt;/<span class="hljs-name">TD</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">TD</span>&gt;</span>{(resource.response.timeReceived - resource.response.timeSent) / 1000}s<span class="hljs-tag">&lt;/<span class="hljs-name">TD</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">TD</span>&gt;</span>{resource.response.contentEncoding}<span class="hljs-tag">&lt;/<span class="hljs-name">TD</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">TD</span>&gt;</span>{resource.response.cacheControl}<span class="hljs-tag">&lt;/<span class="hljs-name">TD</span>&gt;</span>
                  <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
                )
              }
            <span class="hljs-tag">&lt;/<span class="hljs-name">tbody</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">CardContent</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Card</span>&gt;</span></span>

  <span class="hljs-keyword">return</span> (
    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span>
      {props.isDebugEnabled === true &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">Info</span> <span class="hljs-attr">resources</span>=<span class="hljs-string">{props.debugInfo?.resources}</span> /&gt;</span>}
      <span class="hljs-tag">&lt;<span class="hljs-name">Children</span> {<span class="hljs-attr">...props</span>} <span class="hljs-attr">childrenToRender</span>=<span class="hljs-string">{props.childrenToRender}</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{ref}</span> /&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span></span>
  )
})

<span class="hljs-title class_">DebugInfo</span>.<span class="hljs-property">propTypes</span> = {
  <span class="hljs-attr">childrenToRender</span>: <span class="hljs-title class_">PropTypes</span>.<span class="hljs-title function_">oneOfType</span>([
    <span class="hljs-title class_">PropTypes</span>.<span class="hljs-property">array</span>,
    <span class="hljs-title class_">PropTypes</span>.<span class="hljs-property">object</span>
  ]),
  <span class="hljs-attr">debugInfo</span>: <span class="hljs-title class_">PropTypes</span>.<span class="hljs-title function_">shape</span>({
    <span class="hljs-attr">resources</span>: <span class="hljs-title class_">PropTypes</span>.<span class="hljs-title function_">arrayOf</span>(<span class="hljs-title class_">PropTypes</span>.<span class="hljs-property">object</span>)
  }),
  <span class="hljs-attr">isDebugEnabled</span>: <span class="hljs-title class_">PropTypes</span>.<span class="hljs-property">bool</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">DebugInfo</span></pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrccomponentsdatadatainner.js"><a href="#toc"><a name="ui-src-components-data-datainner-js">ui/src/components/Data/DataInner.js</a></a></h2>
<pre><code><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useState, useMemo, useEffect, useRef, forwardRef } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">PropTypes</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;prop-types&#x27;</span>
<span class="hljs-keyword">import</span> { useDispatch, useSelector } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-redux&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">DebugInfo</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./DataDebug&#x27;</span>
<span class="hljs-keyword">import</span> { isNull, isEmpty, getChildProps, useTimeout } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./DataUtils&#x27;</span>
<span class="hljs-keyword">import</span> { fetchData } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./DataState&#x27;</span>

<span class="hljs-comment">/* 
  DataInner: this component is part of the Data component and is not meant to work standalone
  props:
    fetch[]: an array of objects specifying data that needs to be fetched (required)
    isDebugEnabled: a boolean value specifying whether to enable debug mode (reveals a network statistics bar) (optional)
    subComponentChildren[]: an array specifying children to render for various stages of the fetch lifecycle (optional)
  Notes:
    Encapsulates the lifecycle of fetching data and conditional rendering of sub-components for various data states
*/</span>

<span class="hljs-comment">/* Help ensure fetches are performed only when needed */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">validateFetchParams</span> = (<span class="hljs-params">fetchValue, refValue</span>) =&gt; {
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isEmpty</span>(fetchValue)) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isEmpty</span>(refValue)) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span> <span class="hljs-comment">/* First run */</span>
  <span class="hljs-keyword">const</span> isValidUrls = fetchValue.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x &amp;&amp; <span class="hljs-keyword">typeof</span> x.<span class="hljs-property">url</span> === <span class="hljs-string">&#x27;string&#x27;</span> &amp;&amp; x.<span class="hljs-property">url</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>)?.<span class="hljs-property">length</span> === fetchValue.<span class="hljs-property">length</span> ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>
  <span class="hljs-keyword">if</span> (!isValidUrls) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span> <span class="hljs-comment">/* For edification */</span>
  <span class="hljs-keyword">const</span> isChanged = fetchValue.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">x, i</span>) =&gt;</span> x &amp;&amp; refValue[i] &amp;&amp; (x.<span class="hljs-property">url</span> !== refValue[i].<span class="hljs-property">url</span> || x.<span class="hljs-property">slice</span> !== refValue[i].<span class="hljs-property">slice</span>)).<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>
  <span class="hljs-keyword">if</span> (isChanged) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span> <span class="hljs-comment">/* Deep equality comparison */</span>
  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
}
<span class="hljs-keyword">const</span> <span class="hljs-title class_">DataInner</span> = <span class="hljs-title function_">forwardRef</span>(<span class="hljs-function">(<span class="hljs-params">props, ref</span>) =&gt;</span> {

  <span class="hljs-keyword">const</span> isDebugEnabled = props.<span class="hljs-property">isDebugEnabled</span> ?? <span class="hljs-literal">false</span>
  <span class="hljs-keyword">const</span> subComponentChildren = props.<span class="hljs-property">subComponentChildren</span> ?? {}
  <span class="hljs-keyword">const</span> fetchArray = props.<span class="hljs-property">fetch</span>
  <span class="hljs-keyword">const</span> previousFetchArray = <span class="hljs-title function_">useRef</span>([])
  <span class="hljs-keyword">let</span> debugInfo = { <span class="hljs-attr">resources</span>: [] }
  <span class="hljs-keyword">const</span> dispatch = <span class="hljs-title function_">useDispatch</span>()
  <span class="hljs-keyword">const</span> [childrenToRender, setChildrenToRender] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>) <span class="hljs-comment">/* triggers renders when updated */</span>
  <span class="hljs-keyword">const</span> isFetchInProgress = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">false</span>) <span class="hljs-comment">/* does NOT trigger renders when updated */</span>
  <span class="hljs-keyword">const</span> isResolved = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">false</span>)
  <span class="hljs-keyword">const</span> secondsToWait = <span class="hljs-title function_">useMemo</span>( <span class="hljs-comment">/* returns a cached value that changes with its dependency */</span>
    <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">getChildProps</span>(subComponentChildren.<span class="hljs-property">timeout</span>)?.<span class="hljs-property">secondsToWait</span> ?? <span class="hljs-number">0</span>,
    [subComponentChildren.<span class="hljs-property">timeout</span>]
  )
  <span class="hljs-keyword">const</span> isTimeout = <span class="hljs-title function_">useTimeout</span>(secondsToWait, isResolved.<span class="hljs-property">current</span>)

  <span class="hljs-comment">/* Get all state slices from Redux */</span>
  <span class="hljs-keyword">const</span> slices = <span class="hljs-title function_">useSelector</span>(<span class="hljs-function"><span class="hljs-params">state</span> =&gt;</span> state?.<span class="hljs-property">_fetch</span>)

  <span class="hljs-comment">/* Dispatch a redux action to fetch data when the value of fetch changes */</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">validateFetchParams</span>(fetchArray, previousFetchArray.<span class="hljs-property">current</span>)) {
      <span class="hljs-title function_">dispatch</span>(<span class="hljs-title function_">fetchData</span>(fetchArray))
        .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`%c Error occurred during Redux dispatch(). Details: <span class="hljs-subst">${e}</span>`</span>, <span class="hljs-string">&#x27;color: red&#x27;</span>))
      isFetchInProgress.<span class="hljs-property">current</span> = <span class="hljs-literal">true</span>
      isResolved.<span class="hljs-property">current</span> = <span class="hljs-literal">false</span>
      previousFetchArray.<span class="hljs-property">current</span> = fetchArray
    }
  }, [dispatch, fetchArray])
  
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isNull</span>(props)) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>

  <span class="hljs-comment">/* Pass-Through Mode: if fetch is not valid then display &lt;Data.Fulfilled&gt; */</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isEmpty</span>(fetchArray)) {
    <span class="hljs-keyword">return</span> (
      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">DebugInfo</span>
        {<span class="hljs-attr">...props</span>}
        <span class="hljs-attr">debugInfo</span>=<span class="hljs-string">{debugInfo}</span>
        <span class="hljs-attr">isDebugEnabled</span>=<span class="hljs-string">{isDebugEnabled}</span>
        <span class="hljs-attr">childrenToRender</span>=<span class="hljs-string">{subComponentChildren.fulfilled}</span>
        <span class="hljs-attr">ref</span>=<span class="hljs-string">{ref}</span>
      /&gt;</span></span>
    )
  }

  <span class="hljs-comment">/* Get statistics for all fetch requests to use for conditional rendering */</span>
  <span class="hljs-keyword">let</span> [numRequests, numPending, numFulfilled, numNoData, numRejected] = [<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>]
  <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">isEmpty</span>(slices)) {
    fetchArray.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">request</span> =&gt;</span> {
      <span class="hljs-keyword">const</span> slice = request.<span class="hljs-property">slice</span>
      <span class="hljs-keyword">const</span> resource = slices?.[slice]
      <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">isEmpty</span>(resource)) {
        <span class="hljs-keyword">if</span> (resource.<span class="hljs-property">isDataRequired</span> === <span class="hljs-literal">false</span>) {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`%c Data for slice &#x27;<span class="hljs-subst">${slice}</span>&#x27; is marked as not required`</span>)
        }
        <span class="hljs-keyword">if</span> (resource.<span class="hljs-property">pending</span>) numPending++
        <span class="hljs-keyword">if</span> (resource.<span class="hljs-property">fulfilled</span>) {
          <span class="hljs-keyword">if</span> (resource.<span class="hljs-property">response</span>?.<span class="hljs-property">ok</span> === <span class="hljs-literal">false</span>) {
            numNoData++ <span class="hljs-comment">/* Includes 404 errors returned from the API */</span>
          }
          <span class="hljs-keyword">else</span> {
            numFulfilled++
            <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isEmpty</span>(resource.<span class="hljs-property">json</span>) &amp;&amp; resource.<span class="hljs-property">isDataRequired</span>) numNoData++
            <span class="hljs-keyword">if</span> (isDebugEnabled) debugInfo.<span class="hljs-property">resources</span>.<span class="hljs-title function_">push</span>({ ...resource, slice })
          }
        }
        <span class="hljs-keyword">if</span> (resource.<span class="hljs-property">rejected</span>) numRejected++
        numRequests++
      }
    })
  }

  <span class="hljs-comment">/* Conditionally render sub-components */</span>
  <span class="hljs-keyword">if</span> (isTimeout === <span class="hljs-literal">true</span>) {
    <span class="hljs-keyword">const</span> timeoutChildren = subComponentChildren.<span class="hljs-property">timeout</span> <span class="hljs-comment">/* &lt;Data.Timeout&gt; */</span>
    <span class="hljs-keyword">if</span> (childrenToRender !== timeoutChildren) <span class="hljs-title function_">setChildrenToRender</span>(timeoutChildren)
  }
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (numRequests &gt; <span class="hljs-number">0</span> &amp;&amp; numRequests === numFulfilled + numRejected) {

    <span class="hljs-comment">/* Update operational state */</span>
    isResolved.<span class="hljs-property">current</span> = <span class="hljs-literal">true</span> <span class="hljs-comment">/* Stop the timer */</span>
    isFetchInProgress.<span class="hljs-property">current</span> = <span class="hljs-literal">false</span>

    <span class="hljs-comment">/* Conditionally render sub-components */</span>
    <span class="hljs-keyword">if</span> (numRejected &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">const</span> rejectedChildren = subComponentChildren.<span class="hljs-property">rejected</span> <span class="hljs-comment">/* &lt;Data.Rejected&gt; */</span>
      <span class="hljs-keyword">if</span> (childrenToRender !== rejectedChildren) <span class="hljs-title function_">setChildrenToRender</span>(rejectedChildren)
    }
    <span class="hljs-keyword">if</span> (numRequests === numFulfilled) {
      <span class="hljs-keyword">if</span> (numNoData &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">const</span> noDataChildren = subComponentChildren.<span class="hljs-property">nodata</span> <span class="hljs-comment">/* &lt;Data.NoData&gt; */</span>
        <span class="hljs-keyword">if</span> (childrenToRender !== noDataChildren) <span class="hljs-title function_">setChildrenToRender</span>(noDataChildren)
      }
      <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">const</span> fulfilledChildren = subComponentChildren.<span class="hljs-property">fulfilled</span> <span class="hljs-comment">/* &lt;Data.Fulfilled&gt; */</span>
        <span class="hljs-keyword">if</span> (childrenToRender !== fulfilledChildren) <span class="hljs-title function_">setChildrenToRender</span>(fulfilledChildren)
      }
    }
  }
  <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">if</span> (numPending &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">const</span> pendingChildren = subComponentChildren.<span class="hljs-property">pending</span> <span class="hljs-comment">/* &lt;Data.Pending&gt; */</span>
      <span class="hljs-keyword">if</span> (childrenToRender !== pendingChildren) <span class="hljs-title function_">setChildrenToRender</span>(pendingChildren)
    }
  }

  <span class="hljs-keyword">return</span> (
    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">DebugInfo</span>
      {<span class="hljs-attr">...props</span>}
      <span class="hljs-attr">debugInfo</span>=<span class="hljs-string">{debugInfo}</span>
      <span class="hljs-attr">isDebugEnabled</span>=<span class="hljs-string">{isDebugEnabled}</span>
      <span class="hljs-attr">childrenToRender</span>=<span class="hljs-string">{childrenToRender}</span>
      <span class="hljs-attr">ref</span>=<span class="hljs-string">{ref}</span>
    /&gt;</span></span>
  )

})

<span class="hljs-title class_">DataInner</span>.<span class="hljs-property">propTypes</span> = {
  <span class="hljs-attr">fetch</span>: <span class="hljs-title class_">PropTypes</span>.<span class="hljs-title function_">arrayOf</span>(<span class="hljs-title class_">PropTypes</span>.<span class="hljs-title function_">shape</span>({
    <span class="hljs-attr">slice</span>: <span class="hljs-title class_">PropTypes</span>.<span class="hljs-property">string</span>.<span class="hljs-property">isRequired</span>,
    <span class="hljs-attr">url</span>: <span class="hljs-title class_">PropTypes</span>.<span class="hljs-property">string</span>.<span class="hljs-property">isRequired</span>,
    <span class="hljs-attr">select</span>: <span class="hljs-title class_">PropTypes</span>.<span class="hljs-property">func</span>
  })),
  <span class="hljs-attr">subComponentChildren</span>: <span class="hljs-title class_">PropTypes</span>.<span class="hljs-property">object</span>,
  <span class="hljs-attr">isDebugEnabled</span>: <span class="hljs-title class_">PropTypes</span>.<span class="hljs-property">bool</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">DataInner</span></pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrccomponentsdatadatastate.js"><a href="#toc"><a name="ui-src-components-data-datastate-js">ui/src/components/Data/DataState.js</a></a></h2>
<pre><code><span class="hljs-keyword">import</span> { createSlice, createAsyncThunk } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@reduxjs/toolkit&#x27;</span>
<span class="hljs-keyword">import</span> { isEmpty, isNull } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./DataUtils&#x27;</span>

<span class="hljs-comment">/* 
  DataState: fetch() and Redux functionality for data-enabled components
  props:
    fetch[]: an object specifying data that needs to be fetched (required)
  notes:
    This file, at its core, contains a Redux thunk
    The thunk performs a fetch for each item in the fetch array
    The fetch checks if the slice is in memory and uses that in lieu of a fetch when possible
    Otherwise it performs the fetch, gathers some statistics, gets the JSON, and then returns the entire ensemble
    Finally, reducers modify the state during the fetch lifecycle (pending, fulfilled, rejected)
    Once completed, this process results in the fetched data being available in the Redux store
*/</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">getCachedSlice</span> = (<span class="hljs-params">slice, url, slices</span>) =&gt; {
  <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">isNull</span>(slices)) {
    <span class="hljs-keyword">const</span> cachedSlice = slices[slice]
    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">isNull</span>(url) &amp;&amp; url === cachedSlice?.<span class="hljs-property">url</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`%c Using cached slice &#x27;<span class="hljs-subst">${slice}</span>&#x27;`</span>, <span class="hljs-string">&#x27;color: cornflowerblue&#x27;</span>)
      <span class="hljs-keyword">return</span> cachedSlice
    }
  }
  <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
}

<span class="hljs-comment">/* Perform a fetch for or retrieve from cache the given state slice */</span>
<span class="hljs-keyword">const</span> awaitJson = <span class="hljs-keyword">async</span> (request, slices, rejectWithValue) =&gt; {

  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isNull</span>(request)) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
  
  <span class="hljs-keyword">const</span> { slice, url, select } = request

  <span class="hljs-keyword">const</span> cachedSlice = <span class="hljs-title function_">getCachedSlice</span>(slice, url, slices)
  <span class="hljs-keyword">if</span> (cachedSlice) <span class="hljs-keyword">return</span> cachedSlice

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`%c Fetching &#x27;<span class="hljs-subst">${slice}</span>&#x27;`</span>, <span class="hljs-string">&#x27;color: cornflowerblue&#x27;</span>)

  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> timeSent = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(url, request)
    <span class="hljs-keyword">const</span> timeReceived = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()
    <span class="hljs-keyword">const</span> { headers, ok = <span class="hljs-string">&#x27;&#x27;</span>, status = <span class="hljs-number">0</span>, statusText = <span class="hljs-string">&#x27;&#x27;</span> } = response
    <span class="hljs-keyword">const</span> contentEncoding = headers?.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;content-encoding&#x27;</span>) ?? <span class="hljs-string">&#x27;&#x27;</span>
    <span class="hljs-keyword">const</span> cacheControl = headers?.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;cache-control&#x27;</span>) ?? <span class="hljs-string">&#x27;&#x27;</span>
    <span class="hljs-keyword">const</span> jsonRoot = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>()
    <span class="hljs-keyword">const</span> json = <span class="hljs-keyword">typeof</span> select === <span class="hljs-string">&#x27;function&#x27;</span> ? <span class="hljs-title function_">select</span>(jsonRoot) : jsonRoot
   
    <span class="hljs-keyword">return</span> ({ slice, url, json, <span class="hljs-attr">response</span>: 
      { ok, status, statusText, timeSent, timeReceived, contentEncoding, cacheControl }
    })
  }
  <span class="hljs-keyword">catch</span> (e) {
    <span class="hljs-comment">/* Throw errors so they become promise rejections */</span>
    <span class="hljs-keyword">throw</span> (<span class="hljs-title function_">rejectWithValue</span>({ slice, url, <span class="hljs-attr">response</span>: <span class="hljs-literal">null</span>, <span class="hljs-attr">json</span>: <span class="hljs-literal">null</span>, <span class="hljs-attr">error</span>: <span class="hljs-title class_">String</span>(e.<span class="hljs-property">message</span>) }))
  }
}

<span class="hljs-comment">/* Thunks map asyncronous tasks to state */</span>
<span class="hljs-comment">/* The async payload creator function here feeds into the extraReducers section within createSlice() */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> fetchData = <span class="hljs-title function_">createAsyncThunk</span>(<span class="hljs-string">&#x27;fetch&#x27;</span>, <span class="hljs-keyword">async</span> (requests,
  { getState, rejectWithValue }) =&gt; {

  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isEmpty</span>(requests)) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
  <span class="hljs-keyword">const</span> slices = <span class="hljs-title function_">getState</span>().<span class="hljs-property">_fetch</span>

  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(
    requests.<span class="hljs-title function_">map</span>(<span class="hljs-keyword">async</span> request =&gt; <span class="hljs-keyword">await</span> <span class="hljs-title function_">awaitJson</span>(request, slices, rejectWithValue))
  )

})

<span class="hljs-comment">/* createSlice() automatically creates actions that incorporate the reducer logic below */</span>
<span class="hljs-comment">/* Reducers are the functions that modify the state slice */</span>
<span class="hljs-keyword">const</span> fetchSlice = <span class="hljs-title function_">createSlice</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;fetch&#x27;</span>,
  <span class="hljs-attr">initialState</span>: {},
  <span class="hljs-attr">reducers</span>: {},
  <span class="hljs-attr">extraReducers</span>: {
    [fetchData.<span class="hljs-property">pending</span>]: <span class="hljs-function">(<span class="hljs-params">state, action</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> slice = action.<span class="hljs-property">meta</span>.<span class="hljs-property">arg</span>.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">x</span>=&gt;</span>x !== <span class="hljs-literal">undefined</span>)?.<span class="hljs-property">slice</span>
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(state,
        { [slice]: {...state[slice], <span class="hljs-attr">pending</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">fulfilled</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">rejected</span>: <span class="hljs-literal">false</span> }
        })
    },
    [fetchData.<span class="hljs-property">fulfilled</span>]: <span class="hljs-function">(<span class="hljs-params">state, action</span>) =&gt;</span> {
      <span class="hljs-keyword">return</span> { ...state, ...<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">fromEntries</span>(action.<span class="hljs-property">payload</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> 
        ([ [x.<span class="hljs-property">slice</span>], { ...x, <span class="hljs-attr">pending</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">fulfilled</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">rejected</span>: <span class="hljs-literal">false</span> } ])
      ))}
    },
    [fetchData.<span class="hljs-property">rejected</span>]: <span class="hljs-function">(<span class="hljs-params">state, action</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> slice = action.<span class="hljs-property">meta</span>.<span class="hljs-property">arg</span>.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">x</span>=&gt;</span>x !== <span class="hljs-literal">undefined</span>)?.<span class="hljs-property">slice</span>
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(state,
        { [slice]: {...state[slice], <span class="hljs-attr">error</span>: <span class="hljs-title class_">String</span>(action.<span class="hljs-property">error</span>.<span class="hljs-property">message</span>), <span class="hljs-attr">pending</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">fulfilled</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">rejected</span>: <span class="hljs-literal">true</span> }
        })
    }
  }
})

<span class="hljs-comment">/* Export the above reducers in a way that can be passed directly to combineReducers() */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> fetchSlice.<span class="hljs-property">reducer</span></pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrccomponentsdatadatautils.js"><a href="#toc"><a name="ui-src-components-data-datautils-js">ui/src/components/Data/DataUtils.js</a></a></h2>
<pre><code><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { createElement, forwardRef, useState, useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>

<span class="hljs-comment">/* Functions to improve readability with data validation */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">isNull</span> = x =&gt; x === <span class="hljs-literal">undefined</span> || x === <span class="hljs-literal">null</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">isNotString</span> = x =&gt; <span class="hljs-title function_">isNull</span>(x) || <span class="hljs-keyword">typeof</span> x !== <span class="hljs-string">&#x27;string&#x27;</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">isNotArray</span> = x =&gt; <span class="hljs-title function_">isNull</span>(x) || !<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(x)
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">isNotObject</span> = x =&gt; <span class="hljs-title function_">isNull</span>(x) || <span class="hljs-keyword">typeof</span> x !== <span class="hljs-string">&#x27;object&#x27;</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">isEmpty</span> = x =&gt; {
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isNull</span>(x)) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
  <span class="hljs-keyword">const</span> isArray = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(x)
  <span class="hljs-keyword">if</span> (isArray &amp;&amp; x.<span class="hljs-property">length</span> &lt;= <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
  <span class="hljs-keyword">const</span> isObject = <span class="hljs-keyword">typeof</span> x === <span class="hljs-string">&#x27;object&#x27;</span>
  <span class="hljs-keyword">if</span> (isObject &amp;&amp; <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(x).<span class="hljs-property">length</span> &lt;= <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
}

<span class="hljs-comment">/* Helper functions to support children and props in sub-components */</span>
<span class="hljs-comment">/* React children objects are opaque (inconsistent) data structures and require caution */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">getChildren</span> = (<span class="hljs-params">children, typeName</span>) =&gt; {
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isNull</span>(children)) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">React</span>.<span class="hljs-property">Children</span>.<span class="hljs-title function_">map</span>(children, <span class="hljs-function"><span class="hljs-params">child</span> =&gt;</span> child.<span class="hljs-property">type</span>.<span class="hljs-property">displayName</span> === typeName ? child : <span class="hljs-literal">null</span>)
}

<span class="hljs-comment">/* Get the props of the first child object */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">getChildProps</span> = children =&gt; {
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isNull</span>(children)) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(children) &amp;&amp; <span class="hljs-title class_">React</span>.<span class="hljs-property">Children</span>.<span class="hljs-title function_">count</span>(children) &gt;= <span class="hljs-number">1</span>) {
    <span class="hljs-keyword">return</span> children[<span class="hljs-number">0</span>]?.<span class="hljs-property">props</span>
  }
  <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span> children.<span class="hljs-property">props</span>
  }
}

<span class="hljs-comment">/* Render children, optionally injecting props and ref */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">renderChildren</span> = (<span class="hljs-params">children, props, ref</span>) =&gt; {
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isNull</span>(children)) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>

  <span class="hljs-comment">/* Component, i.e. &lt;Data.Pending component={}&gt; */</span>
  <span class="hljs-keyword">const</span> component = <span class="hljs-title function_">getChildProps</span>(children)?.<span class="hljs-property">component</span>
  <span class="hljs-keyword">if</span> (component) <span class="hljs-keyword">return</span> <span class="hljs-title function_">createElement</span>(component, { ...props, ref })

  <span class="hljs-comment">/* Elements */</span>
  <span class="hljs-keyword">return</span> children
}

<span class="hljs-comment">/* Selector to return the Redux state for a given resource name */</span>
<span class="hljs-comment">/* Contains an optional select parameter to change the selected root from the default */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">sliceJson</span> = (<span class="hljs-params">name, select</span>) =&gt; <span class="hljs-function"><span class="hljs-params">store</span> =&gt;</span> {
  <span class="hljs-keyword">const</span> slice = store?.<span class="hljs-property">_fetch</span>?.[name]
  <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">isEmpty</span>(slice) &amp;&amp; slice.<span class="hljs-property">fulfilled</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> select === <span class="hljs-string">&#x27;function&#x27;</span>
      ? <span class="hljs-title function_">select</span>(slice.<span class="hljs-property">json</span>)
      : slice.<span class="hljs-property">json</span>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> {}
}

<span class="hljs-comment">/* A general-purpose selector where the second argument is a function that selects from data in the first argument */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">selected</span> = (<span class="hljs-params">data, select</span>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> select === <span class="hljs-string">&#x27;function&#x27;</span> ? <span class="hljs-title function_">select</span>(data) : data
}

<span class="hljs-comment">/* A selector specifically for map marker data - DEPRECATED */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">selectMarkerData</span> = (<span class="hljs-params">json, select</span>) =&gt; {
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> select?.<span class="hljs-property">marker</span> === <span class="hljs-string">&#x27;function&#x27;</span>) {
    <span class="hljs-keyword">return</span> select.<span class="hljs-title function_">marker</span>(json)
  }
  <span class="hljs-keyword">return</span> json
}

<span class="hljs-comment">/* A selector specifically for map coords data - DEPRECATED */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">selectCoordsData</span> = (<span class="hljs-params">json, select</span>) =&gt; {
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> select?.<span class="hljs-property">coords</span> === <span class="hljs-string">&#x27;function&#x27;</span>) {
    <span class="hljs-keyword">return</span> select.<span class="hljs-title function_">coords</span>(json)
  }
  <span class="hljs-keyword">return</span> json
}

<span class="hljs-comment">/* This will unfreeze Redux data for use in components that mutate data */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">unfreezeObject</span> = <span class="hljs-built_in">object</span> =&gt; {
  <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(<span class="hljs-built_in">object</span>)) {
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">object</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> ({ ...x }))
  }
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">object</span> === <span class="hljs-string">&#x27;object&#x27;</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>({}, <span class="hljs-built_in">object</span>)
  }
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">object</span>
}

<span class="hljs-comment">/* Helper function to get a URL parameter */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">urlParam</span> = name =&gt; {
  <span class="hljs-keyword">const</span> queryString = <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">search</span>
  <span class="hljs-keyword">const</span> urlParams = <span class="hljs-keyword">new</span> <span class="hljs-title class_">URLSearchParams</span>(queryString)
  <span class="hljs-keyword">return</span> urlParams.<span class="hljs-title function_">get</span>(name) ?? <span class="hljs-string">&#x27;&#x27;</span>
}

<span class="hljs-comment">/* Helper component to render children while optionally passing props and a ref */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">Children</span> = <span class="hljs-title function_">forwardRef</span>(<span class="hljs-function">(<span class="hljs-params">p, r</span>) =&gt;</span> <span class="hljs-title function_">renderChildren</span>(p.<span class="hljs-property">childrenToRender</span>, p, r))

<span class="hljs-comment">/* Custom hook for timeout logic */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">useTimeout</span> = (<span class="hljs-params">secondsToWait, isResolved</span>) =&gt; {
  <span class="hljs-keyword">const</span> [secondsElapsed, setSecondsElapsed] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>)
  <span class="hljs-keyword">const</span> [isTimeout, setIsTimeout] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>)

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (isResolved === <span class="hljs-literal">true</span>) {
      <span class="hljs-title function_">setIsTimeout</span>(<span class="hljs-literal">false</span>)
      <span class="hljs-title function_">setSecondsElapsed</span>(<span class="hljs-number">0</span>) <span class="hljs-comment">/* Reset */</span>
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (secondsElapsed &gt;= secondsToWait) <span class="hljs-title function_">setIsTimeout</span>(<span class="hljs-literal">true</span>)
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (secondsElapsed &lt; secondsToWait) {
      <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">setSecondsElapsed</span>(secondsElapsed + <span class="hljs-number">1</span>), <span class="hljs-number">1000</span>)
      <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearTimeout</span>(timer)
    }
  }, [secondsToWait, secondsElapsed, isResolved])

  <span class="hljs-keyword">return</span> isTimeout
}</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrccomponentsdatamapdatamap.js"><a href="#toc"><a name="ui-src-components-datamap-datamap-js">ui/src/components/DataMap/DataMap.js</a></a></h2>
<pre><code><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useRef, useEffect, useMemo } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">PropTypes</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;prop-types&#x27;</span>
<span class="hljs-keyword">import</span> { useSelector } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-redux&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">MediaQuery</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-responsive&#x27;</span>
<span class="hljs-keyword">import</span> { getCenterCoords } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./MapUtils&#x27;</span>
<span class="hljs-keyword">import</span> { renderToStaticMarkup } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-dom/server&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">AttributionControl</span>, <span class="hljs-title class_">Map</span>, <span class="hljs-title class_">ZoomControl</span>, <span class="hljs-title class_">Marker</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-leaflet&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">MarkerClusterGroup</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-leaflet-markercluster&#x27;</span>
<span class="hljs-keyword">import</span> { latLngBounds } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;leaflet&#x27;</span>
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> config <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../config/config.json&#x27;</span>
<span class="hljs-keyword">import</span> {
  searchedForMarker,
  relatedParcelMarker,
  directlyEvictedMarker,
} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./Map/map_icons/mapIcons&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">MapBox</span>GLLayer <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./Overlays/MapboxGLLayer&#x27;</span>
<span class="hljs-keyword">import</span> mapStyle <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./MapStyle&#x27;</span>
<span class="hljs-keyword">import</span> { useTranslation } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-i18next&#x27;</span>
<span class="hljs-keyword">import</span> i18n <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../i18n&#x27;</span>
<span class="hljs-keyword">import</span> { selectCoordsData, selectMarkerData, isNull, isEmpty, sliceJson } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../Data/Data&#x27;</span>
<span class="hljs-keyword">export</span> { sliceJson, isNull, isEmpty, selectMarkerData, selectCoordsData } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../Data/DataUtils&#x27;</span>

<span class="hljs-comment">/* 
  DataMap: an optionally data-enabled version of the Leaflet map
  props:
    markers{}: an object specifying column configuration (optional)
    fetch[]: an object specifying data that needs to be fetched (optional)
    note: either the markers or the fetch prop must be provided
*/</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">DataMap</span> = props =&gt; {
  <span class="hljs-comment">/* refs usually aren&#x27;t best react practice usually but I don&#x27;t know if there&#x27;s another way to use fitBounds below */</span>
  <span class="hljs-keyword">const</span> mapRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>)

  <span class="hljs-keyword">const</span> firstFetchItem = props.<span class="hljs-property">fetch</span>?.[<span class="hljs-number">0</span>] ?? { <span class="hljs-attr">slice</span>: <span class="hljs-literal">null</span>, <span class="hljs-attr">url</span>: <span class="hljs-literal">null</span>, <span class="hljs-attr">select</span>: <span class="hljs-literal">null</span> }
  <span class="hljs-keyword">const</span> { slice, url } = firstFetchItem
  <span class="hljs-keyword">const</span> json = <span class="hljs-title function_">useSelector</span>(<span class="hljs-title function_">sliceJson</span>(slice))
  <span class="hljs-keyword">const</span> overlays = props.<span class="hljs-property">overlays</span> ?? []
  <span class="hljs-keyword">const</span> onSelect = props.<span class="hljs-property">onSelect</span>
  <span class="hljs-keyword">const</span> renderMarkerHover = props.<span class="hljs-property">renderMarkerHover</span>
  <span class="hljs-keyword">const</span> { t, <span class="hljs-attr">ready</span>: translationReady } = <span class="hljs-title function_">useTranslation</span>(
    <span class="hljs-string">&#x27;Map&#x27;</span> <span class="hljs-comment">/* i18next-parser needs string here */</span>,
    { <span class="hljs-attr">useSuspense</span>: <span class="hljs-literal">false</span>, i18n }
  )

  <span class="hljs-keyword">const</span> markers = props.<span class="hljs-property">markers</span> ?? []
  <span class="hljs-keyword">const</span> isDebugEnabled = props.<span class="hljs-property">isDebugEnabled</span> ?? <span class="hljs-literal">false</span>

  <span class="hljs-comment">/* Establish a set of variables to pass down to the StyledTable */</span>
  <span class="hljs-keyword">let</span> passDownMarkers = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> [], []) <span class="hljs-comment">/* Don&#x27;t change every render */</span>
  <span class="hljs-keyword">let</span> passDownCoords = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> [], []) <span class="hljs-comment">/* Don&#x27;t change every render */</span>

  <span class="hljs-comment">/* Previously, this map component had two options for how it could be run: */</span>
  <span class="hljs-comment">/* Option 1: this component accepts marker props and passes them to map components */</span>
  <span class="hljs-comment">/* Option 2: this component accepts a fetch prop and passes fetch to Data (data is fetched and processed) */</span>
  <span class="hljs-comment">/* At time of writing (7/7/21) the map only accepts marker props from the parent component, which is either Owner or Parcel */</span>
  <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">isEmpty</span>(markers)) {
    <span class="hljs-keyword">if</span> (isDebugEnabled)
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">&#x27;%c DataMap: populating the map with marker props&#x27;</span>, <span class="hljs-string">&#x27;color: green&#x27;</span>)

    <span class="hljs-comment">/* Eviction API data has info the map needs under a location property */</span>
    passDownMarkers = markers.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">marker</span> =&gt;</span> ({ ...marker, ...marker.<span class="hljs-property">location</span> }))
    passDownCoords = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">values</span>(<span class="hljs-title function_">getCenterCoords</span>(passDownMarkers))
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">/* NOTE that this code may need some upkeep if it is ever used */</span>
    <span class="hljs-comment">/* It was basically ABANDONED after the decision to go with DataPage */</span>

    <span class="hljs-comment">/* Eviction API data has info the map needs under a location property */</span>
    passDownMarkers = markers.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">marker</span> =&gt;</span> ({ ...marker, ...marker.<span class="hljs-property">location</span> }))

    <span class="hljs-keyword">const</span> isPreFetch = <span class="hljs-title function_">isEmpty</span>(json)
    <span class="hljs-comment">/* <span class="hljs-doctag">TODO:</span> find a way to render the map before fetched data comes in, or reserve space at least */</span>
    <span class="hljs-keyword">if</span> (isPreFetch) {
      <span class="hljs-keyword">if</span> (isDebugEnabled)
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`DataMap: fetching slice &#x27;<span class="hljs-subst">${slice}</span>&#x27; from &#x27;<span class="hljs-subst">${url}</span>&#x27;`</span>, <span class="hljs-string">&#x27;color: green&#x27;</span>)
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">if</span> (isDebugEnabled)
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">&#x27;%c DataMap: populating the map with fetched data&#x27;</span>, <span class="hljs-string">&#x27;color: green&#x27;</span>)

      <span class="hljs-comment">/* calculate the center coordinates of the map boundary */</span>
      <span class="hljs-keyword">const</span> coordsDataJson = <span class="hljs-title function_">selectCoordsData</span>(json)
      <span class="hljs-keyword">if</span> (coordsDataJson) {
        passDownCoords = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">values</span>(<span class="hljs-title function_">getCenterCoords</span>(coordsDataJson))
      }

      <span class="hljs-keyword">const</span> markerDataJson = <span class="hljs-title function_">selectMarkerData</span>(json)
      passDownMarkers = markerDataJson
    }
  }

  <span class="hljs-comment">/* this calculates the zoom depending on the markers given. */</span>
  <span class="hljs-comment">/* It chooses zoom: 14 or the zoom extent covering all markers, whichever is smaller (more can be seen). */</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (mapRef.<span class="hljs-property">current</span>) {
      <span class="hljs-keyword">const</span> map = mapRef.<span class="hljs-property">current</span>.<span class="hljs-property">leafletElement</span>
      <span class="hljs-keyword">const</span> bounds = <span class="hljs-title function_">latLngBounds</span>()
      passDownMarkers.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">marker</span> =&gt;</span> bounds.<span class="hljs-title function_">extend</span>([marker.<span class="hljs-property">lat</span>, marker.<span class="hljs-property">long</span>]))
      <span class="hljs-keyword">if</span> (map.<span class="hljs-title function_">getBoundsZoom</span>(bounds) &lt; <span class="hljs-number">14</span>) map.<span class="hljs-title function_">fitBounds</span>(bounds)
    }
  }, [mapRef, passDownMarkers])

  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isNull</span>(props)) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>

  <span class="hljs-keyword">const</span> mapProps = {
    <span class="hljs-attr">center</span>: passDownCoords,
    <span class="hljs-attr">zoom</span>: <span class="hljs-number">14</span>,
    <span class="hljs-attr">maxZoom</span>: <span class="hljs-number">18</span>,
    <span class="hljs-attr">minZoom</span>: <span class="hljs-number">10</span>,
    <span class="hljs-attr">touch</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">touchZoom</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">scrollWheelZoom</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">tap</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">dragging</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">preferCanvas</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">zoomControl</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">attributionControl</span>: <span class="hljs-literal">false</span>,
  }

  <span class="hljs-keyword">const</span> largeMapProps = mapProps
  <span class="hljs-keyword">const</span> smallMapProps = { ...mapProps, <span class="hljs-attr">onContextMenu</span>: <span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> e.<span class="hljs-property">originalEvent</span>.<span class="hljs-title function_">preventDefault</span>() }

  <span class="hljs-comment">/*
    Determine the appropriate icon for the type of record being displayed:
      It could be an eviction with evict_date and evict_id fields:
        &lt;directlyEvictedMarker/&gt;
      It could be a property that would have an addr and block_lot properties
        It could be the searched for or a related property
          &lt;searchedForMarker/&gt;, &lt;relatedParcelMarker/&gt;
  */</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">getIcon</span> = record =&gt; {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> record.<span class="hljs-property">evict_date</span> === <span class="hljs-string">&#x27;string&#x27;</span> &amp;&amp; <span class="hljs-keyword">typeof</span> record.<span class="hljs-property">evict_id</span> === <span class="hljs-string">&#x27;string&#x27;</span>) {
      <span class="hljs-keyword">return</span> directlyEvictedMarker
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> record.<span class="hljs-property">addr</span> === <span class="hljs-string">&#x27;string&#x27;</span> &amp;&amp; <span class="hljs-keyword">typeof</span> record.<span class="hljs-property">block_lot</span> === <span class="hljs-string">&#x27;string&#x27;</span>) {
      <span class="hljs-keyword">return</span> record.<span class="hljs-property">evict_location_accuracy</span> === <span class="hljs-string">&#x27;Likely&#x27;</span> || record.<span class="hljs-property">type</span> === <span class="hljs-string">&#x27;Parcel&#x27;</span>
        ? searchedForMarker
        : relatedParcelMarker
    }
  }

  <span class="hljs-keyword">if</span> (!translationReady) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>

  <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">isEmpty</span>(passDownCoords)) {
    <span class="hljs-comment">/* Maps don&#x27;t currently tolerate empty coords */</span>
    <span class="hljs-comment">//Note that the media state need to be added to the store to force rerender</span>
    <span class="hljs-comment">/* <span class="hljs-doctag">TODO:</span> data-enable this component, just the markers part so the map can load on its own */</span>
    <span class="hljs-keyword">return</span> (
      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">contain:</span> &#x27;<span class="hljs-attr">content</span>&#x27; }} <span class="hljs-attr">tag</span>=<span class="hljs-string">&#x27;prevent map content from rendering outside the map&#x27;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
          <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">position:</span> &#x27;<span class="hljs-attr">relative</span>&#x27; }}
          <span class="hljs-attr">tag</span>=<span class="hljs-string">&#x27;this gives absolutely positioned child elements (map overlays) a reference point&#x27;</span>&gt;</span>
          {/* <span class="hljs-tag">&lt;<span class="hljs-name">Data</span> <span class="hljs-attr">fetch</span>=<span class="hljs-string">{passDownFetch}</span> <span class="hljs-attr">isDebugEnabled</span>=<span class="hljs-string">{isDebugEnabled}</span> /&gt;</span> */}
          <span class="hljs-tag">&lt;<span class="hljs-name">MediaQuery</span> <span class="hljs-attr">query</span>=<span class="hljs-string">&#x27;(max-width: 800px)&#x27;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Map</span> {<span class="hljs-attr">...smallMapProps</span>} <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">height:</span> &#x27;<span class="hljs-attr">400px</span>&#x27;, <span class="hljs-attr">width:</span> &#x27;<span class="hljs-attr">100</span>%&#x27; }} <span class="hljs-attr">ref</span>=<span class="hljs-string">{mapRef}</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">MarkerClusterGroup</span>
                <span class="hljs-attr">removeOutsideVisibleBounds</span>
                <span class="hljs-attr">chunkedLoading</span>=<span class="hljs-string">{true}</span>
                <span class="hljs-attr">maxClusterRadius</span>=<span class="hljs-string">{20}</span>
                <span class="hljs-attr">onMouseOver</span>=<span class="hljs-string">{e</span> =&gt;</span> {
                  e?.layer?._childCount &amp;&amp;
                    e.propagatedFrom
                      .bindTooltip(`${e.layer._childCount} ${t(&#x27;Evictions&#x27;)}`)
                      .openTooltip()
                }}
                onMouseOut={e =&gt; e.propagatedFrom.unbindTooltip()}&gt;
                {Array.isArray(passDownMarkers) &amp;&amp;
                  passDownMarkers.map((record, index) =&gt; {
                    const toolTip = renderToStaticMarkup(renderMarkerHover(record))
                    return (
                      <span class="hljs-tag">&lt;<span class="hljs-name">Marker</span>
                        <span class="hljs-attr">key</span>=<span class="hljs-string">{</span>`${<span class="hljs-attr">record.lat</span>}<span class="hljs-attr">-</span>${<span class="hljs-attr">record.long</span>}<span class="hljs-attr">-</span>${<span class="hljs-attr">index</span>}`}
                        <span class="hljs-attr">keyboard</span>=<span class="hljs-string">{false}</span>
                        <span class="hljs-attr">position</span>=<span class="hljs-string">{[record.lat,</span> <span class="hljs-attr">record.long</span>]}
                        <span class="hljs-attr">icon</span>=<span class="hljs-string">{getIcon(record)}</span>
                        <span class="hljs-attr">onMouseOver</span>=<span class="hljs-string">{e</span> =&gt;</span> e.target.bindTooltip(toolTip).openTooltip()}
                        onMouseOut={e =&gt; e.target.unbindTooltip()}
                        onClick={() =&gt; onSelect(record)}&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">Marker</span>&gt;</span>
                    )
                  })}
              <span class="hljs-tag">&lt;/<span class="hljs-name">MarkerClusterGroup</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">MapBoxGLLayer</span> <span class="hljs-attr">accessToken</span>=<span class="hljs-string">{config.map.MAPBOX_TOKEN}</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{mapStyle}</span> /&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">AttributionControl</span> <span class="hljs-attr">prefix</span>=<span class="hljs-string">{config.map.attribution}</span> /&gt;</span>
              {Array.isArray(overlays) &amp;&amp;
                overlays.map((overlay, i) =&gt; <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{</span>`<span class="hljs-attr">overlay-</span>${<span class="hljs-attr">i</span>}`}&gt;</span>{overlay}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>)}
              <span class="hljs-tag">&lt;<span class="hljs-name">ZoomControl</span> <span class="hljs-attr">position</span>=<span class="hljs-string">&#x27;topright&#x27;</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">Map</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">MediaQuery</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">MediaQuery</span> <span class="hljs-attr">query</span>=<span class="hljs-string">&#x27;(min-width: 801px)&#x27;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Map</span> {<span class="hljs-attr">...largeMapProps</span>} <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">height:</span> &#x27;<span class="hljs-attr">400px</span>&#x27;, <span class="hljs-attr">width:</span> &#x27;<span class="hljs-attr">100</span>%&#x27; }} <span class="hljs-attr">ref</span>=<span class="hljs-string">{mapRef}</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">MarkerClusterGroup</span>
                <span class="hljs-attr">removeOutsideVisibleBounds</span>
                <span class="hljs-attr">chunkedLoading</span>=<span class="hljs-string">{true}</span>
                <span class="hljs-attr">maxClusterRadius</span>=<span class="hljs-string">{20}</span>
                <span class="hljs-attr">onMouseOver</span>=<span class="hljs-string">{e</span> =&gt;</span> {
                  e?.layer?._childCount &amp;&amp;
                    e.propagatedFrom
                      .bindTooltip(`${e.layer._childCount} ${t(&#x27;Evictions&#x27;)}`)
                      .openTooltip()
                }}
                onMouseOut={e =&gt; e.propagatedFrom.unbindTooltip()}&gt;
                {Array.isArray(passDownMarkers) &amp;&amp;
                  passDownMarkers.map((record, index) =&gt; {
                    const toolTip = renderToStaticMarkup(renderMarkerHover(record))
                    return (
                      <span class="hljs-tag">&lt;<span class="hljs-name">Marker</span>
                        <span class="hljs-attr">key</span>=<span class="hljs-string">{</span>`${<span class="hljs-attr">record.lat</span>}<span class="hljs-attr">-</span>${<span class="hljs-attr">record.long</span>}<span class="hljs-attr">-</span>${<span class="hljs-attr">index</span>}`}
                        <span class="hljs-attr">keyboard</span>=<span class="hljs-string">{false}</span>
                        <span class="hljs-attr">position</span>=<span class="hljs-string">{[record.lat,</span> <span class="hljs-attr">record.long</span>]}
                        <span class="hljs-attr">icon</span>=<span class="hljs-string">{getIcon(record)}</span>
                        <span class="hljs-attr">onMouseOver</span>=<span class="hljs-string">{e</span> =&gt;</span> e.target.bindTooltip(toolTip).openTooltip()}
                        onMouseOut={e =&gt; e.target.unbindTooltip()}
                        onClick={() =&gt; onSelect(record)}&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">Marker</span>&gt;</span>
                    )
                  })}
              <span class="hljs-tag">&lt;/<span class="hljs-name">MarkerClusterGroup</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">MapBoxGLLayer</span> <span class="hljs-attr">accessToken</span>=<span class="hljs-string">{config.map.MAPBOX_TOKEN}</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{mapStyle}</span> /&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">AttributionControl</span> <span class="hljs-attr">prefix</span>=<span class="hljs-string">{config.map.attribution}</span> /&gt;</span>
              {Array.isArray(overlays) &amp;&amp;
                overlays.map((overlay, i) =&gt; <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{</span>`<span class="hljs-attr">overlay-</span>${<span class="hljs-attr">i</span>}`}&gt;</span>{overlay}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>)}
              <span class="hljs-tag">&lt;<span class="hljs-name">ZoomControl</span> <span class="hljs-attr">position</span>=<span class="hljs-string">&#x27;topright&#x27;</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">Map</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">MediaQuery</span>&gt;</span>
          {/*TODO: DATA ENABLE THIS COMPONENT */}
          {/* {
            <span class="hljs-tag">&lt;<span class="hljs-name">DataBox</span> {<span class="hljs-attr">...props</span>} <span class="hljs-attr">ns</span>=<span class="hljs-string">{ns}</span> <span class="hljs-attr">title</span>=<span class="hljs-string">{renderParcelLink(evictMapSelection.block_lot,</span> <span class="hljs-attr">evictMapSelection.addr</span>)} <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;235px&quot;</span>&gt;</span> 
          } */}
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    )
  } else return null
}

DataMap.propTypes = {
  fetch: PropTypes.arrayOf(
    PropTypes.shape({
      slice: PropTypes.string.isRequired,
      url: PropTypes.string.isRequired,
      select: PropTypes.func,
    })
  ),
  markers: PropTypes.arrayOf(PropTypes.object),
  isDebugEnabled: PropTypes.bool,
  renderMarkerHover: PropTypes.func,
  overlays: PropTypes.array,
}

export default DataMap
</span></pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrccomponentsdatamapmapmap_iconsmapicons.js"><a href="#toc"><a name="ui-src-components-datamap-map-map_icons-mapicons-js">ui/src/components/DataMap/Map/map_icons/mapIcons.js</a></a></h2>
<pre><code><span class="hljs-keyword">import</span> L <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;leaflet&#x27;</span>
<span class="hljs-keyword">import</span> multipleResultsSVG <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./multiple-results-icon.svg&#x27;</span>
<span class="hljs-keyword">import</span> searchedForSVG <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./searched-for-icon.svg&#x27;</span>
<span class="hljs-keyword">import</span> relatedParcelSVG <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./related-parcel-icon.svg&#x27;</span>
<span class="hljs-keyword">import</span> directlyEvictedSVG <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./directly-evicted-icon.svg&#x27;</span>
<span class="hljs-keyword">import</span> lightGreenMarker <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./light-green-circle-marker-owner-22.png&#x27;</span>
<span class="hljs-keyword">import</span> darkGreenMarker <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./dark-green-circle-marker-owner-22.png&#x27;</span>
<span class="hljs-keyword">import</span> lightOrangeMarker <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./light-orange-circle-marker-owner-22.png&#x27;</span>
<span class="hljs-keyword">import</span> darkOrangeMarker <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./dark-orange-circle-marker-owner-22.png&#x27;</span>

<span class="hljs-keyword">const</span> iconAnchor = [ <span class="hljs-number">11</span>, <span class="hljs-number">10</span> ]

<span class="hljs-comment">//icons for parcel and neighborhood views</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> multipleResultsMarker = L.<span class="hljs-title function_">icon</span>({
  <span class="hljs-attr">iconUrl</span>: multipleResultsSVG,
  iconAnchor
})

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> searchedForMarker = L.<span class="hljs-title function_">icon</span>({
  <span class="hljs-attr">iconUrl</span>: searchedForSVG,
  iconAnchor
})

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> relatedParcelMarker = L.<span class="hljs-title function_">icon</span>({
  <span class="hljs-attr">iconUrl</span>: relatedParcelSVG,
  iconAnchor
})

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> directlyEvictedMarker = L.<span class="hljs-title function_">icon</span>({
  <span class="hljs-attr">iconUrl</span>: directlyEvictedSVG,
  iconAnchor
})

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> createClusterMarker = <span class="hljs-keyword">function</span> (<span class="hljs-params">cluster, className = <span class="hljs-string">&#x27;default-map-cluster&#x27;</span></span>) {
  <span class="hljs-keyword">return</span> L.<span class="hljs-title function_">icon</span>({
    <span class="hljs-attr">iconUrl</span>: multipleResultsSVG,
    iconAnchor
  })
}

<span class="hljs-comment">//icons for owner view</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> lightGreenLMarker = L.<span class="hljs-title function_">icon</span>({
  <span class="hljs-attr">iconUrl</span>: lightGreenMarker,
  iconAnchor
})

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> darkGreenLMarker = L.<span class="hljs-title function_">icon</span>({
  <span class="hljs-attr">iconUrl</span>: darkGreenMarker,
  iconAnchor
})

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> lightOrangeLMarker = L.<span class="hljs-title function_">icon</span>({
  <span class="hljs-attr">iconUrl</span>: lightOrangeMarker,
  iconAnchor
})

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> darkOrangeLMarker = L.<span class="hljs-title function_">icon</span>({
  <span class="hljs-attr">iconUrl</span>: darkOrangeMarker,
  iconAnchor
})</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrccomponentsdatamapmapstyle.js"><a href="#toc"><a name="ui-src-components-datamap-mapstyle-js">ui/src/components/DataMap/MapStyle.js</a></a></h2>
<pre><code>const mapStyle = {
  version: <span class="hljs-number">8</span>,
  name: <span class="hljs-string">&#x27;Basic&#x27;</span>,
  metadata: {
    <span class="hljs-string">&#x27;mapbox:autocomposite&#x27;</span>: true
  },
  sources: {
    mapbox: {
      url: <span class="hljs-string">&#x27;mapbox://mapbox.mapbox-streets-v7&#x27;</span>,
      type: <span class="hljs-string">&#x27;vector&#x27;</span>
    }
  },
  sprite: <span class="hljs-string">&#x27;mapbox://sprites/mapbox/basic-v8&#x27;</span>,
  glyphs: <span class="hljs-string">&#x27;mapbox://fonts/mapbox/{fontstack}/{range}.pbf&#x27;</span>,
  layers: [
    {
      id: <span class="hljs-string">&#x27;background&#x27;</span>,
      type: <span class="hljs-string">&#x27;background&#x27;</span>,
      paint: {
        <span class="hljs-string">&#x27;background-color&#x27;</span>: <span class="hljs-string">&#x27;#dedede&#x27;</span>
      },
      interactive: true
    },
    {
      id: <span class="hljs-string">&#x27;landuse_overlay_national_park&#x27;</span>,
      type: <span class="hljs-string">&#x27;fill&#x27;</span>,
      source: <span class="hljs-string">&#x27;mapbox&#x27;</span>,
      <span class="hljs-string">&#x27;source-layer&#x27;</span>: <span class="hljs-string">&#x27;landuse_overlay&#x27;</span>,
      filter: [ <span class="hljs-string">&#x27;==&#x27;</span>, <span class="hljs-string">&#x27;class&#x27;</span>, <span class="hljs-string">&#x27;national_park&#x27;</span> ],
      paint: {
        <span class="hljs-string">&#x27;fill-color&#x27;</span>: <span class="hljs-string">&#x27;#d2edae&#x27;</span>,
        <span class="hljs-string">&#x27;fill-opacity&#x27;</span>: <span class="hljs-number">0.75</span>
      },
      interactive: true
    },
    {
      id: <span class="hljs-string">&#x27;landuse_park&#x27;</span>,
      type: <span class="hljs-string">&#x27;fill&#x27;</span>,
      source: <span class="hljs-string">&#x27;mapbox&#x27;</span>,
      <span class="hljs-string">&#x27;source-layer&#x27;</span>: <span class="hljs-string">&#x27;landuse&#x27;</span>,
      filter: [ <span class="hljs-string">&#x27;==&#x27;</span>, <span class="hljs-string">&#x27;class&#x27;</span>, <span class="hljs-string">&#x27;park&#x27;</span> ],
      paint: {
        <span class="hljs-string">&#x27;fill-color&#x27;</span>: <span class="hljs-string">&#x27;#d2edae&#x27;</span>
      },
      interactive: true
    },
    {
      id: <span class="hljs-string">&#x27;waterway&#x27;</span>,
      type: <span class="hljs-string">&#x27;line&#x27;</span>,
      source: <span class="hljs-string">&#x27;mapbox&#x27;</span>,
      <span class="hljs-string">&#x27;source-layer&#x27;</span>: <span class="hljs-string">&#x27;waterway&#x27;</span>,
      filter: [
        <span class="hljs-string">&#x27;all&#x27;</span>,
        [ <span class="hljs-string">&#x27;==&#x27;</span>, <span class="hljs-string">&#x27;$type&#x27;</span>, <span class="hljs-string">&#x27;LineString&#x27;</span> ],
        [ <span class="hljs-string">&#x27;in&#x27;</span>, <span class="hljs-string">&#x27;class&#x27;</span>, <span class="hljs-string">&#x27;river&#x27;</span>, <span class="hljs-string">&#x27;canal&#x27;</span> ]
      ],
      paint: {
        <span class="hljs-string">&#x27;line-color&#x27;</span>: <span class="hljs-string">&#x27;#3d5467&#x27;</span>,
        <span class="hljs-string">&#x27;line-width&#x27;</span>: {
          base: <span class="hljs-number">1.4</span>,
          stops: [ [ <span class="hljs-number">8</span>, <span class="hljs-number">0.5</span> ], [ <span class="hljs-number">20</span>, <span class="hljs-number">15</span> ] ]
        }
      },
      interactive: true
    },
    {
      id: <span class="hljs-string">&#x27;water&#x27;</span>,
      type: <span class="hljs-string">&#x27;fill&#x27;</span>,
      source: <span class="hljs-string">&#x27;mapbox&#x27;</span>,
      <span class="hljs-string">&#x27;source-layer&#x27;</span>: <span class="hljs-string">&#x27;water&#x27;</span>,
      paint: {
        <span class="hljs-string">&#x27;fill-color&#x27;</span>: <span class="hljs-string">&#x27;#3d5467&#x27;</span>
      },
      interactive: true
    },
    {
      id: <span class="hljs-string">&#x27;building&#x27;</span>,
      type: <span class="hljs-string">&#x27;fill&#x27;</span>,
      source: <span class="hljs-string">&#x27;mapbox&#x27;</span>,
      <span class="hljs-string">&#x27;source-layer&#x27;</span>: <span class="hljs-string">&#x27;building&#x27;</span>,
      paint: {
        <span class="hljs-string">&#x27;fill-color&#x27;</span>: <span class="hljs-string">&#x27;#d6d6d6&#x27;</span>
      },
      interactive: true
    },
    {
      interactive: true,
      layout: {
        <span class="hljs-string">&#x27;line-cap&#x27;</span>: <span class="hljs-string">&#x27;butt&#x27;</span>,
        <span class="hljs-string">&#x27;line-join&#x27;</span>: <span class="hljs-string">&#x27;miter&#x27;</span>
      },
      filter: [
        <span class="hljs-string">&#x27;all&#x27;</span>,
        [ <span class="hljs-string">&#x27;==&#x27;</span>, <span class="hljs-string">&#x27;$type&#x27;</span>, <span class="hljs-string">&#x27;LineString&#x27;</span> ],
        [
          <span class="hljs-string">&#x27;all&#x27;</span>,
          [
            <span class="hljs-string">&#x27;in&#x27;</span>,
            <span class="hljs-string">&#x27;class&#x27;</span>,
            <span class="hljs-string">&#x27;motorway_link&#x27;</span>,
            <span class="hljs-string">&#x27;street&#x27;</span>,
            <span class="hljs-string">&#x27;street_limited&#x27;</span>,
            <span class="hljs-string">&#x27;service&#x27;</span>,
            <span class="hljs-string">&#x27;track&#x27;</span>,
            <span class="hljs-string">&#x27;pedestrian&#x27;</span>,
            <span class="hljs-string">&#x27;path&#x27;</span>,
            <span class="hljs-string">&#x27;link&#x27;</span>
          ],
          [ <span class="hljs-string">&#x27;==&#x27;</span>, <span class="hljs-string">&#x27;structure&#x27;</span>, <span class="hljs-string">&#x27;tunnel&#x27;</span> ]
        ]
      ],
      type: <span class="hljs-string">&#x27;line&#x27;</span>,
      source: <span class="hljs-string">&#x27;mapbox&#x27;</span>,
      id: <span class="hljs-string">&#x27;tunnel_minor&#x27;</span>,
      paint: {
        <span class="hljs-string">&#x27;line-color&#x27;</span>: <span class="hljs-string">&#x27;#efefef&#x27;</span>,
        <span class="hljs-string">&#x27;line-width&#x27;</span>: {
          base: <span class="hljs-number">1.55</span>,
          stops: [ [ <span class="hljs-number">4</span>, <span class="hljs-number">0.25</span> ], [ <span class="hljs-number">20</span>, <span class="hljs-number">30</span> ] ]
        },
        <span class="hljs-string">&#x27;line-dasharray&#x27;</span>: [ <span class="hljs-number">0.36</span>, <span class="hljs-number">0.18</span> ]
      },
      <span class="hljs-string">&#x27;source-layer&#x27;</span>: <span class="hljs-string">&#x27;road&#x27;</span>
    },
    {
      interactive: true,
      layout: {
        <span class="hljs-string">&#x27;line-cap&#x27;</span>: <span class="hljs-string">&#x27;butt&#x27;</span>,
        <span class="hljs-string">&#x27;line-join&#x27;</span>: <span class="hljs-string">&#x27;miter&#x27;</span>
      },
      filter: [
        <span class="hljs-string">&#x27;all&#x27;</span>,
        [ <span class="hljs-string">&#x27;==&#x27;</span>, <span class="hljs-string">&#x27;$type&#x27;</span>, <span class="hljs-string">&#x27;LineString&#x27;</span> ],
        [
          <span class="hljs-string">&#x27;all&#x27;</span>,
          [
            <span class="hljs-string">&#x27;in&#x27;</span>,
            <span class="hljs-string">&#x27;class&#x27;</span>,
            <span class="hljs-string">&#x27;motorway&#x27;</span>,
            <span class="hljs-string">&#x27;primary&#x27;</span>,
            <span class="hljs-string">&#x27;secondary&#x27;</span>,
            <span class="hljs-string">&#x27;tertiary&#x27;</span>,
            <span class="hljs-string">&#x27;trunk&#x27;</span>
          ],
          [ <span class="hljs-string">&#x27;==&#x27;</span>, <span class="hljs-string">&#x27;structure&#x27;</span>, <span class="hljs-string">&#x27;tunnel&#x27;</span> ]
        ]
      ],
      type: <span class="hljs-string">&#x27;line&#x27;</span>,
      source: <span class="hljs-string">&#x27;mapbox&#x27;</span>,
      id: <span class="hljs-string">&#x27;tunnel_major&#x27;</span>,
      paint: {
        <span class="hljs-string">&#x27;line-color&#x27;</span>: <span class="hljs-string">&#x27;#fff&#x27;</span>,
        <span class="hljs-string">&#x27;line-width&#x27;</span>: {
          base: <span class="hljs-number">1.4</span>,
          stops: [ [ <span class="hljs-number">6</span>, <span class="hljs-number">0.5</span> ], [ <span class="hljs-number">20</span>, <span class="hljs-number">30</span> ] ]
        },
        <span class="hljs-string">&#x27;line-dasharray&#x27;</span>: [ <span class="hljs-number">0.28</span>, <span class="hljs-number">0.14</span> ]
      },
      <span class="hljs-string">&#x27;source-layer&#x27;</span>: <span class="hljs-string">&#x27;road&#x27;</span>
    },
    {
      interactive: true,
      layout: {
        <span class="hljs-string">&#x27;line-cap&#x27;</span>: <span class="hljs-string">&#x27;round&#x27;</span>,
        <span class="hljs-string">&#x27;line-join&#x27;</span>: <span class="hljs-string">&#x27;round&#x27;</span>
      },
      filter: [
        <span class="hljs-string">&#x27;all&#x27;</span>,
        [ <span class="hljs-string">&#x27;==&#x27;</span>, <span class="hljs-string">&#x27;$type&#x27;</span>, <span class="hljs-string">&#x27;LineString&#x27;</span> ],
        [
          <span class="hljs-string">&#x27;all&#x27;</span>,
          [
            <span class="hljs-string">&#x27;in&#x27;</span>,
            <span class="hljs-string">&#x27;class&#x27;</span>,
            <span class="hljs-string">&#x27;motorway_link&#x27;</span>,
            <span class="hljs-string">&#x27;street&#x27;</span>,
            <span class="hljs-string">&#x27;street_limited&#x27;</span>,
            <span class="hljs-string">&#x27;service&#x27;</span>,
            <span class="hljs-string">&#x27;track&#x27;</span>,
            <span class="hljs-string">&#x27;pedestrian&#x27;</span>,
            <span class="hljs-string">&#x27;path&#x27;</span>,
            <span class="hljs-string">&#x27;link&#x27;</span>
          ],
          [ <span class="hljs-string">&#x27;in&#x27;</span>, <span class="hljs-string">&#x27;structure&#x27;</span>, <span class="hljs-string">&#x27;none&#x27;</span>, <span class="hljs-string">&#x27;ford&#x27;</span> ]
        ]
      ],
      type: <span class="hljs-string">&#x27;line&#x27;</span>,
      source: <span class="hljs-string">&#x27;mapbox&#x27;</span>,
      id: <span class="hljs-string">&#x27;road_minor&#x27;</span>,
      paint: {
        <span class="hljs-string">&#x27;line-color&#x27;</span>: <span class="hljs-string">&#x27;#efefef&#x27;</span>,
        <span class="hljs-string">&#x27;line-width&#x27;</span>: {
          base: <span class="hljs-number">1.55</span>,
          stops: [ [ <span class="hljs-number">4</span>, <span class="hljs-number">0.25</span> ], [ <span class="hljs-number">20</span>, <span class="hljs-number">30</span> ] ]
        }
      },
      <span class="hljs-string">&#x27;source-layer&#x27;</span>: <span class="hljs-string">&#x27;road&#x27;</span>
    },
    {
      interactive: true,
      layout: {
        <span class="hljs-string">&#x27;line-cap&#x27;</span>: <span class="hljs-string">&#x27;round&#x27;</span>,
        <span class="hljs-string">&#x27;line-join&#x27;</span>: <span class="hljs-string">&#x27;round&#x27;</span>
      },
      filter: [
        <span class="hljs-string">&#x27;all&#x27;</span>,
        [ <span class="hljs-string">&#x27;==&#x27;</span>, <span class="hljs-string">&#x27;$type&#x27;</span>, <span class="hljs-string">&#x27;LineString&#x27;</span> ],
        [
          <span class="hljs-string">&#x27;all&#x27;</span>,
          [
            <span class="hljs-string">&#x27;in&#x27;</span>,
            <span class="hljs-string">&#x27;class&#x27;</span>,
            <span class="hljs-string">&#x27;motorway&#x27;</span>,
            <span class="hljs-string">&#x27;primary&#x27;</span>,
            <span class="hljs-string">&#x27;secondary&#x27;</span>,
            <span class="hljs-string">&#x27;tertiary&#x27;</span>,
            <span class="hljs-string">&#x27;trunk&#x27;</span>
          ],
          [ <span class="hljs-string">&#x27;in&#x27;</span>, <span class="hljs-string">&#x27;structure&#x27;</span>, <span class="hljs-string">&#x27;none&#x27;</span>, <span class="hljs-string">&#x27;ford&#x27;</span> ]
        ]
      ],
      type: <span class="hljs-string">&#x27;line&#x27;</span>,
      source: <span class="hljs-string">&#x27;mapbox&#x27;</span>,
      id: <span class="hljs-string">&#x27;road_major&#x27;</span>,
      paint: {
        <span class="hljs-string">&#x27;line-color&#x27;</span>: <span class="hljs-string">&#x27;#fff&#x27;</span>,
        <span class="hljs-string">&#x27;line-width&#x27;</span>: {
          base: <span class="hljs-number">1.4</span>,
          stops: [ [ <span class="hljs-number">6</span>, <span class="hljs-number">0.5</span> ], [ <span class="hljs-number">20</span>, <span class="hljs-number">30</span> ] ]
        }
      },
      <span class="hljs-string">&#x27;source-layer&#x27;</span>: <span class="hljs-string">&#x27;road&#x27;</span>
    },
    {
      interactive: true,
      layout: {
        <span class="hljs-string">&#x27;line-cap&#x27;</span>: <span class="hljs-string">&#x27;butt&#x27;</span>,
        <span class="hljs-string">&#x27;line-join&#x27;</span>: <span class="hljs-string">&#x27;miter&#x27;</span>
      },
      filter: [
        <span class="hljs-string">&#x27;all&#x27;</span>,
        [ <span class="hljs-string">&#x27;==&#x27;</span>, <span class="hljs-string">&#x27;$type&#x27;</span>, <span class="hljs-string">&#x27;LineString&#x27;</span> ],
        [
          <span class="hljs-string">&#x27;all&#x27;</span>,
          [
            <span class="hljs-string">&#x27;in&#x27;</span>,
            <span class="hljs-string">&#x27;class&#x27;</span>,
            <span class="hljs-string">&#x27;motorway_link&#x27;</span>,
            <span class="hljs-string">&#x27;street&#x27;</span>,
            <span class="hljs-string">&#x27;street_limited&#x27;</span>,
            <span class="hljs-string">&#x27;service&#x27;</span>,
            <span class="hljs-string">&#x27;track&#x27;</span>,
            <span class="hljs-string">&#x27;pedestrian&#x27;</span>,
            <span class="hljs-string">&#x27;path&#x27;</span>,
            <span class="hljs-string">&#x27;link&#x27;</span>
          ],
          [ <span class="hljs-string">&#x27;==&#x27;</span>, <span class="hljs-string">&#x27;structure&#x27;</span>, <span class="hljs-string">&#x27;bridge&#x27;</span> ]
        ]
      ],
      type: <span class="hljs-string">&#x27;line&#x27;</span>,
      source: <span class="hljs-string">&#x27;mapbox&#x27;</span>,
      id: <span class="hljs-string">&#x27;bridge_minor case&#x27;</span>,
      paint: {
        <span class="hljs-string">&#x27;line-color&#x27;</span>: <span class="hljs-string">&#x27;#dedede&#x27;</span>,
        <span class="hljs-string">&#x27;line-width&#x27;</span>: {
          base: <span class="hljs-number">1.6</span>,
          stops: [ [ <span class="hljs-number">12</span>, <span class="hljs-number">0.5</span> ], [ <span class="hljs-number">20</span>, <span class="hljs-number">10</span> ] ]
        },
        <span class="hljs-string">&#x27;line-gap-width&#x27;</span>: {
          base: <span class="hljs-number">1.55</span>,
          stops: [ [ <span class="hljs-number">4</span>, <span class="hljs-number">0.25</span> ], [ <span class="hljs-number">20</span>, <span class="hljs-number">30</span> ] ]
        }
      },
      <span class="hljs-string">&#x27;source-layer&#x27;</span>: <span class="hljs-string">&#x27;road&#x27;</span>
    },
    {
      interactive: true,
      layout: {
        <span class="hljs-string">&#x27;line-cap&#x27;</span>: <span class="hljs-string">&#x27;butt&#x27;</span>,
        <span class="hljs-string">&#x27;line-join&#x27;</span>: <span class="hljs-string">&#x27;miter&#x27;</span>
      },
      filter: [
        <span class="hljs-string">&#x27;all&#x27;</span>,
        [ <span class="hljs-string">&#x27;==&#x27;</span>, <span class="hljs-string">&#x27;$type&#x27;</span>, <span class="hljs-string">&#x27;LineString&#x27;</span> ],
        [
          <span class="hljs-string">&#x27;all&#x27;</span>,
          [
            <span class="hljs-string">&#x27;in&#x27;</span>,
            <span class="hljs-string">&#x27;class&#x27;</span>,
            <span class="hljs-string">&#x27;motorway&#x27;</span>,
            <span class="hljs-string">&#x27;primary&#x27;</span>,
            <span class="hljs-string">&#x27;secondary&#x27;</span>,
            <span class="hljs-string">&#x27;tertiary&#x27;</span>,
            <span class="hljs-string">&#x27;trunk&#x27;</span>
          ],
          [ <span class="hljs-string">&#x27;==&#x27;</span>, <span class="hljs-string">&#x27;structure&#x27;</span>, <span class="hljs-string">&#x27;bridge&#x27;</span> ]
        ]
      ],
      type: <span class="hljs-string">&#x27;line&#x27;</span>,
      source: <span class="hljs-string">&#x27;mapbox&#x27;</span>,
      id: <span class="hljs-string">&#x27;bridge_major case&#x27;</span>,
      paint: {
        <span class="hljs-string">&#x27;line-color&#x27;</span>: <span class="hljs-string">&#x27;#dedede&#x27;</span>,
        <span class="hljs-string">&#x27;line-width&#x27;</span>: {
          base: <span class="hljs-number">1.6</span>,
          stops: [ [ <span class="hljs-number">12</span>, <span class="hljs-number">0.5</span> ], [ <span class="hljs-number">20</span>, <span class="hljs-number">10</span> ] ]
        },
        <span class="hljs-string">&#x27;line-gap-width&#x27;</span>: {
          base: <span class="hljs-number">1.55</span>,
          stops: [ [ <span class="hljs-number">4</span>, <span class="hljs-number">0.25</span> ], [ <span class="hljs-number">20</span>, <span class="hljs-number">30</span> ] ]
        }
      },
      <span class="hljs-string">&#x27;source-layer&#x27;</span>: <span class="hljs-string">&#x27;road&#x27;</span>
    },
    {
      interactive: true,
      layout: {
        <span class="hljs-string">&#x27;line-cap&#x27;</span>: <span class="hljs-string">&#x27;round&#x27;</span>,
        <span class="hljs-string">&#x27;line-join&#x27;</span>: <span class="hljs-string">&#x27;round&#x27;</span>
      },
      filter: [
        <span class="hljs-string">&#x27;all&#x27;</span>,
        [ <span class="hljs-string">&#x27;==&#x27;</span>, <span class="hljs-string">&#x27;$type&#x27;</span>, <span class="hljs-string">&#x27;LineString&#x27;</span> ],
        [
          <span class="hljs-string">&#x27;all&#x27;</span>,
          [
            <span class="hljs-string">&#x27;in&#x27;</span>,
            <span class="hljs-string">&#x27;class&#x27;</span>,
            <span class="hljs-string">&#x27;motorway_link&#x27;</span>,
            <span class="hljs-string">&#x27;street&#x27;</span>,
            <span class="hljs-string">&#x27;street_limited&#x27;</span>,
            <span class="hljs-string">&#x27;service&#x27;</span>,
            <span class="hljs-string">&#x27;track&#x27;</span>,
            <span class="hljs-string">&#x27;pedestrian&#x27;</span>,
            <span class="hljs-string">&#x27;path&#x27;</span>,
            <span class="hljs-string">&#x27;link&#x27;</span>
          ],
          [ <span class="hljs-string">&#x27;==&#x27;</span>, <span class="hljs-string">&#x27;structure&#x27;</span>, <span class="hljs-string">&#x27;bridge&#x27;</span> ]
        ]
      ],
      type: <span class="hljs-string">&#x27;line&#x27;</span>,
      source: <span class="hljs-string">&#x27;mapbox&#x27;</span>,
      id: <span class="hljs-string">&#x27;bridge_minor&#x27;</span>,
      paint: {
        <span class="hljs-string">&#x27;line-color&#x27;</span>: <span class="hljs-string">&#x27;#efefef&#x27;</span>,
        <span class="hljs-string">&#x27;line-width&#x27;</span>: {
          base: <span class="hljs-number">1.55</span>,
          stops: [ [ <span class="hljs-number">4</span>, <span class="hljs-number">0.25</span> ], [ <span class="hljs-number">20</span>, <span class="hljs-number">30</span> ] ]
        }
      },
      <span class="hljs-string">&#x27;source-layer&#x27;</span>: <span class="hljs-string">&#x27;road&#x27;</span>
    },
    {
      interactive: true,
      layout: {
        <span class="hljs-string">&#x27;line-cap&#x27;</span>: <span class="hljs-string">&#x27;round&#x27;</span>,
        <span class="hljs-string">&#x27;line-join&#x27;</span>: <span class="hljs-string">&#x27;round&#x27;</span>
      },
      filter: [
        <span class="hljs-string">&#x27;all&#x27;</span>,
        [ <span class="hljs-string">&#x27;==&#x27;</span>, <span class="hljs-string">&#x27;$type&#x27;</span>, <span class="hljs-string">&#x27;LineString&#x27;</span> ],
        [
          <span class="hljs-string">&#x27;all&#x27;</span>,
          [
            <span class="hljs-string">&#x27;in&#x27;</span>,
            <span class="hljs-string">&#x27;class&#x27;</span>,
            <span class="hljs-string">&#x27;motorway&#x27;</span>,
            <span class="hljs-string">&#x27;primary&#x27;</span>,
            <span class="hljs-string">&#x27;secondary&#x27;</span>,
            <span class="hljs-string">&#x27;tertiary&#x27;</span>,
            <span class="hljs-string">&#x27;trunk&#x27;</span>
          ],
          [ <span class="hljs-string">&#x27;==&#x27;</span>, <span class="hljs-string">&#x27;structure&#x27;</span>, <span class="hljs-string">&#x27;bridge&#x27;</span> ]
        ]
      ],
      type: <span class="hljs-string">&#x27;line&#x27;</span>,
      source: <span class="hljs-string">&#x27;mapbox&#x27;</span>,
      id: <span class="hljs-string">&#x27;bridge_major&#x27;</span>,
      paint: {
        <span class="hljs-string">&#x27;line-color&#x27;</span>: <span class="hljs-string">&#x27;#fff&#x27;</span>,
        <span class="hljs-string">&#x27;line-width&#x27;</span>: {
          base: <span class="hljs-number">1.4</span>,
          stops: [ [ <span class="hljs-number">6</span>, <span class="hljs-number">0.5</span> ], [ <span class="hljs-number">20</span>, <span class="hljs-number">30</span> ] ]
        }
      },
      <span class="hljs-string">&#x27;source-layer&#x27;</span>: <span class="hljs-string">&#x27;road&#x27;</span>
    },
    {
      interactive: true,
      layout: {
        <span class="hljs-string">&#x27;line-cap&#x27;</span>: <span class="hljs-string">&#x27;round&#x27;</span>,
        <span class="hljs-string">&#x27;line-join&#x27;</span>: <span class="hljs-string">&#x27;round&#x27;</span>
      },
      filter: [
        <span class="hljs-string">&#x27;all&#x27;</span>,
        [ <span class="hljs-string">&#x27;==&#x27;</span>, <span class="hljs-string">&#x27;$type&#x27;</span>, <span class="hljs-string">&#x27;LineString&#x27;</span> ],
        [ <span class="hljs-string">&#x27;all&#x27;</span>, [ <span class="hljs-string">&#x27;&lt;=&#x27;</span>, <span class="hljs-string">&#x27;admin_level&#x27;</span>, <span class="hljs-number">2</span> ], [ <span class="hljs-string">&#x27;==&#x27;</span>, <span class="hljs-string">&#x27;maritime&#x27;</span>, <span class="hljs-number">0</span> ] ]
      ],
      type: <span class="hljs-string">&#x27;line&#x27;</span>,
      source: <span class="hljs-string">&#x27;mapbox&#x27;</span>,
      id: <span class="hljs-string">&#x27;admin_country&#x27;</span>,
      paint: {
        <span class="hljs-string">&#x27;line-color&#x27;</span>: <span class="hljs-string">&#x27;#8b8a8a&#x27;</span>,
        <span class="hljs-string">&#x27;line-width&#x27;</span>: {
          base: <span class="hljs-number">1.3</span>,
          stops: [ [ <span class="hljs-number">3</span>, <span class="hljs-number">0.5</span> ], [ <span class="hljs-number">22</span>, <span class="hljs-number">15</span> ] ]
        }
      },
      <span class="hljs-string">&#x27;source-layer&#x27;</span>: <span class="hljs-string">&#x27;admin&#x27;</span>
    },
    {
      interactive: true,
      minzoom: <span class="hljs-number">5</span>,
      layout: {
        <span class="hljs-string">&#x27;icon-image&#x27;</span>: <span class="hljs-string">&#x27;{maki}-11&#x27;</span>,
        <span class="hljs-string">&#x27;text-offset&#x27;</span>: [ <span class="hljs-number">0</span>, <span class="hljs-number">0.5</span> ],
        <span class="hljs-string">&#x27;text-field&#x27;</span>: <span class="hljs-string">&#x27;{name_en}&#x27;</span>,
        <span class="hljs-string">&#x27;text-font&#x27;</span>: [ <span class="hljs-string">&#x27;Open Sans Semibold&#x27;</span>, <span class="hljs-string">&#x27;Arial Unicode MS Bold&#x27;</span> ],
        <span class="hljs-string">&#x27;text-max-width&#x27;</span>: <span class="hljs-number">8</span>,
        <span class="hljs-string">&#x27;text-anchor&#x27;</span>: <span class="hljs-string">&#x27;top&#x27;</span>,
        <span class="hljs-string">&#x27;text-size&#x27;</span>: <span class="hljs-number">11</span>,
        <span class="hljs-string">&#x27;icon-size&#x27;</span>: <span class="hljs-number">1</span>
      },
      filter: [
        <span class="hljs-string">&#x27;all&#x27;</span>,
        [ <span class="hljs-string">&#x27;==&#x27;</span>, <span class="hljs-string">&#x27;$type&#x27;</span>, <span class="hljs-string">&#x27;Point&#x27;</span> ],
        [ <span class="hljs-string">&#x27;all&#x27;</span>, [ <span class="hljs-string">&#x27;==&#x27;</span>, <span class="hljs-string">&#x27;scalerank&#x27;</span>, <span class="hljs-number">1</span> ], [ <span class="hljs-string">&#x27;==&#x27;</span>, <span class="hljs-string">&#x27;localrank&#x27;</span>, <span class="hljs-number">1</span> ] ]
      ],
      type: <span class="hljs-string">&#x27;symbol&#x27;</span>,
      source: <span class="hljs-string">&#x27;mapbox&#x27;</span>,
      id: <span class="hljs-string">&#x27;poi_label&#x27;</span>,
      paint: {
        <span class="hljs-string">&#x27;text-color&#x27;</span>: <span class="hljs-string">&#x27;#666&#x27;</span>,
        <span class="hljs-string">&#x27;text-halo-width&#x27;</span>: <span class="hljs-number">1</span>,
        <span class="hljs-string">&#x27;text-halo-color&#x27;</span>: <span class="hljs-string">&#x27;rgba(255,255,255,0.75)&#x27;</span>,
        <span class="hljs-string">&#x27;text-halo-blur&#x27;</span>: <span class="hljs-number">1</span>
      },
      <span class="hljs-string">&#x27;source-layer&#x27;</span>: <span class="hljs-string">&#x27;poi_label&#x27;</span>
    },
    {
      interactive: true,
      layout: {
        <span class="hljs-string">&#x27;symbol-placement&#x27;</span>: <span class="hljs-string">&#x27;line&#x27;</span>,
        <span class="hljs-string">&#x27;text-field&#x27;</span>: <span class="hljs-string">&#x27;{name_en}&#x27;</span>,
        <span class="hljs-string">&#x27;text-font&#x27;</span>: [ <span class="hljs-string">&#x27;Open Sans Semibold&#x27;</span>, <span class="hljs-string">&#x27;Arial Unicode MS Bold&#x27;</span> ],
        <span class="hljs-string">&#x27;text-transform&#x27;</span>: <span class="hljs-string">&#x27;uppercase&#x27;</span>,
        <span class="hljs-string">&#x27;text-letter-spacing&#x27;</span>: <span class="hljs-number">0.1</span>,
        <span class="hljs-string">&#x27;text-size&#x27;</span>: {
          base: <span class="hljs-number">1.4</span>,
          stops: [ [ <span class="hljs-number">10</span>, <span class="hljs-number">8</span> ], [ <span class="hljs-number">20</span>, <span class="hljs-number">14</span> ] ]
        }
      },
      filter: [
        <span class="hljs-string">&#x27;all&#x27;</span>,
        [ <span class="hljs-string">&#x27;==&#x27;</span>, <span class="hljs-string">&#x27;$type&#x27;</span>, <span class="hljs-string">&#x27;LineString&#x27;</span> ],
        [ <span class="hljs-string">&#x27;in&#x27;</span>, <span class="hljs-string">&#x27;class&#x27;</span>, <span class="hljs-string">&#x27;motorway&#x27;</span>, <span class="hljs-string">&#x27;primary&#x27;</span>, <span class="hljs-string">&#x27;secondary&#x27;</span>, <span class="hljs-string">&#x27;tertiary&#x27;</span>, <span class="hljs-string">&#x27;trunk&#x27;</span> ]
      ],
      type: <span class="hljs-string">&#x27;symbol&#x27;</span>,
      source: <span class="hljs-string">&#x27;mapbox&#x27;</span>,
      id: <span class="hljs-string">&#x27;road_major_label&#x27;</span>,
      paint: {
        <span class="hljs-string">&#x27;text-color&#x27;</span>: <span class="hljs-string">&#x27;#666&#x27;</span>,
        <span class="hljs-string">&#x27;text-halo-color&#x27;</span>: <span class="hljs-string">&#x27;rgba(255,255,255,0.75)&#x27;</span>,
        <span class="hljs-string">&#x27;text-halo-width&#x27;</span>: <span class="hljs-number">2</span>
      },
      <span class="hljs-string">&#x27;source-layer&#x27;</span>: <span class="hljs-string">&#x27;road_label&#x27;</span>
    },
    {
      interactive: true,
      minzoom: <span class="hljs-number">8</span>,
      layout: {
        <span class="hljs-string">&#x27;text-field&#x27;</span>: <span class="hljs-string">&#x27;{name_en}&#x27;</span>,
        <span class="hljs-string">&#x27;text-font&#x27;</span>: [ <span class="hljs-string">&#x27;Open Sans Semibold&#x27;</span>, <span class="hljs-string">&#x27;Arial Unicode MS Bold&#x27;</span> ],
        <span class="hljs-string">&#x27;text-max-width&#x27;</span>: <span class="hljs-number">6</span>,
        <span class="hljs-string">&#x27;text-size&#x27;</span>: {
          stops: [ [ <span class="hljs-number">6</span>, <span class="hljs-number">12</span> ], [ <span class="hljs-number">12</span>, <span class="hljs-number">16</span> ] ]
        }
      },
      filter: [
        <span class="hljs-string">&#x27;all&#x27;</span>,
        [ <span class="hljs-string">&#x27;==&#x27;</span>, <span class="hljs-string">&#x27;$type&#x27;</span>, <span class="hljs-string">&#x27;Point&#x27;</span> ],
        [
          <span class="hljs-string">&#x27;in&#x27;</span>,
          <span class="hljs-string">&#x27;type&#x27;</span>,
          <span class="hljs-string">&#x27;town&#x27;</span>,
          <span class="hljs-string">&#x27;village&#x27;</span>,
          <span class="hljs-string">&#x27;hamlet&#x27;</span>,
          <span class="hljs-string">&#x27;suburb&#x27;</span>,
          <span class="hljs-string">&#x27;neighbourhood&#x27;</span>,
          <span class="hljs-string">&#x27;island&#x27;</span>
        ]
      ],
      type: <span class="hljs-string">&#x27;symbol&#x27;</span>,
      source: <span class="hljs-string">&#x27;mapbox&#x27;</span>,
      id: <span class="hljs-string">&#x27;place_label_other&#x27;</span>,
      paint: {
        <span class="hljs-string">&#x27;text-color&#x27;</span>: <span class="hljs-string">&#x27;#666&#x27;</span>,
        <span class="hljs-string">&#x27;text-halo-color&#x27;</span>: <span class="hljs-string">&#x27;rgba(255,255,255,0.75)&#x27;</span>,
        <span class="hljs-string">&#x27;text-halo-width&#x27;</span>: <span class="hljs-number">1</span>,
        <span class="hljs-string">&#x27;text-halo-blur&#x27;</span>: <span class="hljs-number">1</span>
      },
      <span class="hljs-string">&#x27;source-layer&#x27;</span>: <span class="hljs-string">&#x27;place_label&#x27;</span>
    },
    {
      interactive: true,
      layout: {
        <span class="hljs-string">&#x27;text-field&#x27;</span>: <span class="hljs-string">&#x27;{name_en}&#x27;</span>,
        <span class="hljs-string">&#x27;text-font&#x27;</span>: [ <span class="hljs-string">&#x27;Open Sans Bold&#x27;</span>, <span class="hljs-string">&#x27;Arial Unicode MS Bold&#x27;</span> ],
        <span class="hljs-string">&#x27;text-max-width&#x27;</span>: <span class="hljs-number">10</span>,
        <span class="hljs-string">&#x27;text-size&#x27;</span>: {
          stops: [ [ <span class="hljs-number">3</span>, <span class="hljs-number">12</span> ], [ <span class="hljs-number">8</span>, <span class="hljs-number">16</span> ] ]
        }
      },
      maxzoom: <span class="hljs-number">16</span>,
      filter: [ <span class="hljs-string">&#x27;all&#x27;</span>, [ <span class="hljs-string">&#x27;==&#x27;</span>, <span class="hljs-string">&#x27;$type&#x27;</span>, <span class="hljs-string">&#x27;Point&#x27;</span> ], [ <span class="hljs-string">&#x27;==&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>, <span class="hljs-string">&#x27;city&#x27;</span> ] ],
      type: <span class="hljs-string">&#x27;symbol&#x27;</span>,
      source: <span class="hljs-string">&#x27;mapbox&#x27;</span>,
      id: <span class="hljs-string">&#x27;place_label_city&#x27;</span>,
      paint: {
        <span class="hljs-string">&#x27;text-color&#x27;</span>: <span class="hljs-string">&#x27;#666&#x27;</span>,
        <span class="hljs-string">&#x27;text-halo-color&#x27;</span>: <span class="hljs-string">&#x27;rgba(255,255,255,0.75)&#x27;</span>,
        <span class="hljs-string">&#x27;text-halo-width&#x27;</span>: <span class="hljs-number">1</span>,
        <span class="hljs-string">&#x27;text-halo-blur&#x27;</span>: <span class="hljs-number">1</span>
      },
      <span class="hljs-string">&#x27;source-layer&#x27;</span>: <span class="hljs-string">&#x27;place_label&#x27;</span>
    },
    {
      interactive: true,
      layout: {
        <span class="hljs-string">&#x27;text-field&#x27;</span>: <span class="hljs-string">&#x27;{name_en}&#x27;</span>,
        <span class="hljs-string">&#x27;text-font&#x27;</span>: [ <span class="hljs-string">&#x27;Open Sans Regular&#x27;</span>, <span class="hljs-string">&#x27;Arial Unicode MS Regular&#x27;</span> ],
        <span class="hljs-string">&#x27;text-max-width&#x27;</span>: <span class="hljs-number">10</span>,
        <span class="hljs-string">&#x27;text-size&#x27;</span>: {
          stops: [ [ <span class="hljs-number">3</span>, <span class="hljs-number">14</span> ], [ <span class="hljs-number">8</span>, <span class="hljs-number">22</span> ] ]
        }
      },
      maxzoom: <span class="hljs-number">12</span>,
      filter: [ <span class="hljs-string">&#x27;==&#x27;</span>, <span class="hljs-string">&#x27;$type&#x27;</span>, <span class="hljs-string">&#x27;Point&#x27;</span> ],
      type: <span class="hljs-string">&#x27;symbol&#x27;</span>,
      source: <span class="hljs-string">&#x27;mapbox&#x27;</span>,
      id: <span class="hljs-string">&#x27;country_label&#x27;</span>,
      paint: {
        <span class="hljs-string">&#x27;text-color&#x27;</span>: <span class="hljs-string">&#x27;#666&#x27;</span>,
        <span class="hljs-string">&#x27;text-halo-color&#x27;</span>: <span class="hljs-string">&#x27;rgba(255,255,255,0.75)&#x27;</span>,
        <span class="hljs-string">&#x27;text-halo-width&#x27;</span>: <span class="hljs-number">1</span>,
        <span class="hljs-string">&#x27;text-halo-blur&#x27;</span>: <span class="hljs-number">1</span>
      },
      <span class="hljs-string">&#x27;source-layer&#x27;</span>: <span class="hljs-string">&#x27;country_label&#x27;</span>
    }
  ]
}

export default mapStyle
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrccomponentsdatamapmaputils.js"><a href="#toc"><a name="ui-src-components-datamap-maputils-js">ui/src/components/DataMap/MapUtils.js</a></a></h2>
<pre><code><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> getCenterCoords(records) {
  <span class="hljs-keyword">const</span> lats = records.<span class="hljs-keyword">map</span>(record =&gt; record.lat).filter(lat =&gt; lat)
  <span class="hljs-keyword">const</span> longs = records.<span class="hljs-keyword">map</span>(record =&gt; record.long).filter(long =&gt; long)
  <span class="hljs-keyword">const</span> latCenter = (<span class="hljs-built_in">Math</span>.min(...lats) + <span class="hljs-built_in">Math</span>.max(...lats)) / <span class="hljs-number">2</span>
  <span class="hljs-keyword">const</span> longCenter = (<span class="hljs-built_in">Math</span>.min(...longs) + <span class="hljs-built_in">Math</span>.max(...longs)) / <span class="hljs-number">2</span>
  <span class="hljs-keyword">return</span> { latCenter, longCenter }
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrccomponentsdatamapoverlaysinfobox.js"><a href="#toc"><a name="ui-src-components-datamap-overlays-infobox-js">ui/src/components/DataMap/Overlays/InfoBox.js</a></a></h2>
<pre><code><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { memo } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Typography</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Card</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/Card&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Row</span>, <span class="hljs-title class_">Col</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../Grid&#x27;</span>
<span class="hljs-keyword">import</span> { titleCase, reformatDate } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../utils/stringUtils&#x27;</span>
<span class="hljs-keyword">import</span> { renderParcelLink } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../utils/tableUtils&#x27;</span>
<span class="hljs-keyword">import</span> { useTheme } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/styles&#x27;</span>
<span class="hljs-keyword">import</span> { isNull } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../Data/DataUtils&#x27;</span>
<span class="hljs-keyword">import</span> useStyles <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../theme/OverlayStyles&#x27;</span>
<span class="hljs-keyword">import</span> { useTranslation } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-i18next&#x27;</span>
<span class="hljs-keyword">import</span> i18n <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../i18n&#x27;</span>

<span class="hljs-comment">/*
  InfoBox: render an information box map overlay
  props:
    items: an array with sets of icons and labels
    title: the header text
    directions: the first text to be displayed
*/</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">InfoBox</span> = <span class="hljs-title function_">memo</span>(<span class="hljs-function"><span class="hljs-params">props</span> =&gt;</span> {

  <span class="hljs-keyword">const</span> theme = <span class="hljs-title function_">useTheme</span>()
  <span class="hljs-keyword">const</span> classes = <span class="hljs-title function_">useStyles</span>(theme)
  <span class="hljs-keyword">const</span> marker = props.<span class="hljs-property">selectedMarker</span>
  <span class="hljs-keyword">const</span> directions = props.<span class="hljs-property">directions</span>
  <span class="hljs-keyword">const</span> { t, <span class="hljs-attr">ready</span>: translationReady } = <span class="hljs-title function_">useTranslation</span>(
    <span class="hljs-string">&#x27;List&#x27;</span>, <span class="hljs-comment">/* i18next-parser needs string here */</span>
    { <span class="hljs-attr">useSuspense</span>: <span class="hljs-literal">false</span>, i18n }
  )
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isNull</span>(marker)) {
    <span class="hljs-keyword">return</span> (
      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Card</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{classes.infoBox}</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&#x27;Eviction Details&#x27;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Typography</span> <span class="hljs-attr">variant</span>=<span class="hljs-string">&#x27;body1&#x27;</span>&gt;</span>{directions}<span class="hljs-tag">&lt;/<span class="hljs-name">Typography</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Card</span>&gt;</span></span>
    )
  }

  <span class="hljs-keyword">const</span> corp_details = marker.<span class="hljs-property">be_specific_details</span> 

  <span class="hljs-comment">/* backend used to return formatted currency */</span> 
  <span class="hljs-comment">/* until it does again maybe we can use this tiny function */</span> 
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">reformatDollar</span> = (<span class="hljs-params">d</span>) =&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;$&#x27;</span> + d.<span class="hljs-title function_">toLocaleString</span>()
  }

  <span class="hljs-keyword">if</span> (!translationReady) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>

  <span class="hljs-comment">/*formatters are stored in seaprate fields so that Array.filter() can throw out undefineds/nulls */</span>
  <span class="hljs-keyword">const</span> content = [
    <span class="hljs-comment">/* fields for property info */</span>
    {<span class="hljs-attr">name</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">&#x27;APN (Block/Lot)&#x27;</span>), <span class="hljs-attr">value</span>: marker.<span class="hljs-property">block_lot</span>},
    {<span class="hljs-attr">name</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">&#x27;Year Built&#x27;</span>), <span class="hljs-attr">value</span>: marker.<span class="hljs-property">yr_built</span>},
    {<span class="hljs-attr">name</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">&#x27;Zipcode&#x27;</span>), <span class="hljs-attr">value</span>: marker.<span class="hljs-property">parc_zip</span>},
    {<span class="hljs-attr">name</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">&#x27;Property Class Code&#x27;</span>), <span class="hljs-attr">value</span>: marker.<span class="hljs-property">prop_class_code</span>},
    {<span class="hljs-attr">name</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">&#x27;Type&#x27;</span>), <span class="hljs-attr">value</span>: marker.<span class="hljs-property">type</span>},
    {<span class="hljs-attr">name</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">&#x27;Date Filed&#x27;</span>), <span class="hljs-attr">value</span>: marker.<span class="hljs-property">evict_date</span>, <span class="hljs-attr">formatter</span>: reformatDate},
    {<span class="hljs-attr">name</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">&#x27;Rooms&#x27;</span>), <span class="hljs-attr">value</span>: marker.<span class="hljs-property">rooms</span>},
    {<span class="hljs-attr">name</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">&#x27;Stories&#x27;</span>), <span class="hljs-attr">value</span>: marker.<span class="hljs-property">stories</span>},
    {<span class="hljs-attr">name</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">&#x27;Land Value&#x27;</span>), <span class="hljs-attr">value</span>: marker.<span class="hljs-property">assess_land_val</span>, <span class="hljs-attr">formatter</span>: reformatDollar},
    {<span class="hljs-attr">name</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">&#x27;Improvement Value&#x27;</span>), <span class="hljs-attr">value</span>: marker.<span class="hljs-property">assess_imp_val</span>, <span class="hljs-attr">formatter</span>: reformatDollar},
    {<span class="hljs-attr">name</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">&#x27;Last Sales Price&#x27;</span>), <span class="hljs-attr">value</span>: marker.<span class="hljs-property">curr_sales_price</span>, <span class="hljs-attr">formatter</span>: reformatDollar},
    {<span class="hljs-attr">name</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">&#x27;Date Updated&#x27;</span>), <span class="hljs-attr">value</span>: marker.<span class="hljs-property">update_date</span>, <span class="hljs-attr">formatter</span>: reformatDate},
    <span class="hljs-comment">/* fields for owner info */</span> 
    {<span class="hljs-attr">name</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">&#x27;Office Address&#x27;</span>), <span class="hljs-attr">value</span>: marker.<span class="hljs-property">office_addresses</span>?.[<span class="hljs-number">0</span>]},
    {<span class="hljs-attr">name</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">&#x27;Date Registered&#x27;</span>), <span class="hljs-attr">value</span>: marker.<span class="hljs-property">creation_date</span>, <span class="hljs-attr">formatter</span>: reformatDate},
    {<span class="hljs-attr">name</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">&#x27;Corporation Number&#x27;</span>), <span class="hljs-attr">value</span>: corp_details?.<span class="hljs-property">corporation_number</span>},
    {<span class="hljs-attr">name</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">&#x27;Corporation Type&#x27;</span>), <span class="hljs-attr">value</span>: corp_details?.<span class="hljs-property">corporation_type</span>},
    {<span class="hljs-attr">name</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">&#x27;Status&#x27;</span>), <span class="hljs-attr">value</span>: corp_details?.<span class="hljs-property">status</span>},
    {<span class="hljs-attr">name</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">&#x27;Tax Base&#x27;</span>), <span class="hljs-attr">value</span>: corp_details?.<span class="hljs-property">corporation_tax_base</span>},
  ].<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">d</span> =&gt;</span> d.<span class="hljs-property">value</span>) <span class="hljs-comment">/* only keep the elements where the value exists */</span> 

  <span class="hljs-keyword">return</span> (
    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Card</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{classes.infoBox}</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&#x27;Title&#x27;</span>&gt;</span>
      { marker.block_lot
        ? <span class="hljs-tag">&lt;<span class="hljs-name">Row</span> <span class="hljs-attr">direction</span>=<span class="hljs-string">&#x27;row&#x27;</span> <span class="hljs-attr">justify</span>=<span class="hljs-string">&#x27;space-between&#x27;</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Typography</span> <span class="hljs-attr">variant</span>=<span class="hljs-string">&#x27;subtitle1&#x27;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{classes.lightColorLink}</span>&gt;</span>
            {renderParcelLink(marker.block_lot, marker.addr)}
          <span class="hljs-tag">&lt;/<span class="hljs-name">Typography</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Row</span>&gt;</span>
        : <span class="hljs-tag">&lt;<span class="hljs-name">Row</span> <span class="hljs-attr">direction</span>=<span class="hljs-string">&#x27;row&#x27;</span> <span class="hljs-attr">justify</span>=<span class="hljs-string">&#x27;space-between&#x27;</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Typography</span> <span class="hljs-attr">variant</span>=<span class="hljs-string">&#x27;subtitle1&#x27;</span>&gt;</span>{titleCase(marker.name)}<span class="hljs-tag">&lt;/<span class="hljs-name">Typography</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Row</span>&gt;</span>
      }
      { /*the content array above is iterated through here */
        content.map((d,i) =&gt; {
          return (
            <span class="hljs-tag">&lt;<span class="hljs-name">Row</span> <span class="hljs-attr">direction</span>=<span class="hljs-string">&#x27;row&#x27;</span> <span class="hljs-attr">justify</span>=<span class="hljs-string">&#x27;space-between&#x27;</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{i}</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">Col</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{marginRight:</span> <span class="hljs-attr">20</span>}}&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">Typography</span> <span class="hljs-attr">variant</span>=<span class="hljs-string">&#x27;body1&#x27;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{fontWeight:</span> <span class="hljs-attr">700</span>}}&gt;</span>{d.name}<span class="hljs-tag">&lt;/<span class="hljs-name">Typography</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">Col</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">Col</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{marginLeft:</span> <span class="hljs-attr">20</span>}}&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">Typography</span> <span class="hljs-attr">variant</span>=<span class="hljs-string">&#x27;body1&#x27;</span>&gt;</span>
                {typeof d.formatter === &#x27;function&#x27; ? d.formatter(d.value) : d.value}
              <span class="hljs-tag">&lt;/<span class="hljs-name">Typography</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">Col</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">Row</span>&gt;</span>
          )
        })
      }
    <span class="hljs-tag">&lt;/<span class="hljs-name">Card</span>&gt;</span></span>
  )
})</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrccomponentsdatamapoverlayslegend.js"><a href="#toc"><a name="ui-src-components-datamap-overlays-legend-js">ui/src/components/DataMap/Overlays/Legend.js</a></a></h2>
<pre><code><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { memo } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Typography</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Card</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/Card&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Row</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../Grid&#x27;</span>
<span class="hljs-keyword">import</span> { useTheme } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/styles&#x27;</span>
<span class="hljs-keyword">import</span> useStyles <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../theme/OverlayStyles&#x27;</span>

<span class="hljs-comment">/*
  Legend: render a legend map overlay
  props:
    items: an array with sets of icons and labels
    title: the header text
*/</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">Legend</span> = props =&gt; {

  <span class="hljs-keyword">const</span> theme = <span class="hljs-title function_">useTheme</span>()
  <span class="hljs-keyword">const</span> classes = <span class="hljs-title function_">useStyles</span>(theme)
  <span class="hljs-keyword">const</span> items = props.<span class="hljs-property">items</span>
  <span class="hljs-keyword">const</span> title = props.<span class="hljs-property">title</span>

  <span class="hljs-keyword">return</span> (
    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Card</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{classes.legend}</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Typography</span> <span class="hljs-attr">variant</span>=<span class="hljs-string">&#x27;subtitle1&#x27;</span>&gt;</span>{title}<span class="hljs-tag">&lt;/<span class="hljs-name">Typography</span>&gt;</span>
      {
        items.map((item, index) =&gt; 
          <span class="hljs-tag">&lt;<span class="hljs-name">Row</span>
            <span class="hljs-attr">direction</span>=<span class="hljs-string">&#x27;row&#x27;</span>
            <span class="hljs-attr">alignItems</span>=<span class="hljs-string">&#x27;center&#x27;</span>
            <span class="hljs-attr">style</span>=<span class="hljs-string">{{marginBottom:</span> <span class="hljs-attr">10</span>}}
            <span class="hljs-attr">key</span>=<span class="hljs-string">{item.label</span> + <span class="hljs-attr">index</span>}&gt;</span>
            {item.icon}<span class="hljs-symbol">&amp;nbsp;</span><span class="hljs-symbol">&amp;nbsp;</span><span class="hljs-tag">&lt;<span class="hljs-name">Typography</span> <span class="hljs-attr">variant</span>=<span class="hljs-string">&#x27;body1&#x27;</span>&gt;</span>{item.label}<span class="hljs-tag">&lt;/<span class="hljs-name">Typography</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">Row</span>&gt;</span>
        )
      }
    <span class="hljs-tag">&lt;/<span class="hljs-name">Card</span>&gt;</span></span>
  )
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">memo</span>(<span class="hljs-title class_">Legend</span>)</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrccomponentsdatamapoverlaysmapboxgllayer.js"><a href="#toc"><a name="ui-src-components-datamap-overlays-mapboxgllayer-js">ui/src/components/DataMap/Overlays/MapboxGLLayer.js</a></a></h2>
<pre><code><span class="hljs-keyword">import</span> { memo } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>
<span class="hljs-keyword">import</span> L <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;leaflet&#x27;</span>
<span class="hljs-keyword">import</span> {} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;mapbox-gl-leaflet&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">PropTypes</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;prop-types&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">GridLayer</span>, withLeaflet } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-leaflet&#x27;</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MapBoxGLLayer</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">GridLayer</span> {
  <span class="hljs-title function_">createLeafletElement</span>(<span class="hljs-params">props</span>) {
    <span class="hljs-keyword">return</span> L.<span class="hljs-title function_">mapboxGL</span>(props)
  }
}

<span class="hljs-comment">/*
 * Props are the options supported by Mapbox Map object
 * Find options here:https://www.mapbox.com/mapbox-gl-js/api/#new-mapboxgl-map-options-
 */</span>
<span class="hljs-title class_">MapBox</span>GLLayer.<span class="hljs-property">propTypes</span> = {
  <span class="hljs-attr">accessToken</span>: <span class="hljs-title class_">PropTypes</span>.<span class="hljs-property">string</span>.<span class="hljs-property">isRequired</span>,
  <span class="hljs-attr">style</span>: <span class="hljs-title class_">PropTypes</span>.<span class="hljs-title function_">oneOfType</span>([ <span class="hljs-title class_">PropTypes</span>.<span class="hljs-property">string</span>, <span class="hljs-title class_">PropTypes</span>.<span class="hljs-property">object</span> ])
}

<span class="hljs-title class_">MapBox</span>GLLayer.<span class="hljs-property">defaultProps</span> = {
  <span class="hljs-attr">style</span>: <span class="hljs-string">&#x27;mapbox://styles/mapbox/streets-v9&#x27;</span>,
  <span class="hljs-attr">refreshExpiredTiles</span>: <span class="hljs-literal">false</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">memo</span>(<span class="hljs-title function_">withLeaflet</span>(<span class="hljs-title class_">MapBox</span>GLLayer))
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrccomponentsdatamapoverlaysoverlay.js"><a href="#toc"><a name="ui-src-components-datamap-overlays-overlay-js">ui/src/components/DataMap/Overlays/Overlay.js</a></a></h2>
<pre><code><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Control</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-leaflet-control&#x27;</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">Overlay</span> = props =&gt; 
  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Control</span> <span class="hljs-attr">position</span>=<span class="hljs-string">{props.position}</span>&gt;</span>
    <span class="hljs-tag">&lt;&gt;</span>{props.children}<span class="hljs-tag">&lt;/&gt;</span></span>
  &lt;/<span class="hljs-title class_">Control</span>&gt;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">Overlay</span></pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrccomponentsdatapagedatapage.js"><a href="#toc"><a name="ui-src-components-datapage-datapage-js">ui/src/components/DataPage/DataPage.js</a></a></h2>
<pre><code><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { forwardRef } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">PropTypes</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;prop-types&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Loading</span>, <span class="hljs-title class_">Error</span>, <span class="hljs-title class_">NoPage</span>, <span class="hljs-title class_">NoData</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../NotAvailable&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Data</span>, { isNull } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../Data/Data&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Children</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../Data/DataUtils&#x27;</span>
<span class="hljs-keyword">export</span> { sliceJson, isNull, isEmpty, urlParam } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../Data/DataUtils&#x27;</span>

<span class="hljs-comment">/* 
  DataPage: a minimalist wrapper of the Data component suitable for conditionally rendering all content on a page
  Note: this component should not compose map or table components (that need extra time to load) as it defers loading of content
    and slows overall page load (which is pretty slow on mobile)
  props:
    fetch[]: an array of objects specifying data that needs to be fetched (required)
*/</span>

<span class="hljs-keyword">const</span> <span class="hljs-title class_">DataPage</span> = <span class="hljs-title function_">forwardRef</span>(<span class="hljs-function">(<span class="hljs-params">props, ref</span>) =&gt;</span> {

  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isNull</span>(props)) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>

  <span class="hljs-keyword">const</span> isDebugEnabled = props.<span class="hljs-property">isDebugEnabled</span> ?? <span class="hljs-literal">false</span>

  <span class="hljs-keyword">return</span> (
    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Data</span> <span class="hljs-attr">fetch</span>=<span class="hljs-string">{props.fetch}</span> <span class="hljs-attr">isDebugEnabled</span>=<span class="hljs-string">{isDebugEnabled}</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Data.Pending</span> <span class="hljs-attr">component</span>=<span class="hljs-string">{Loading}</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Data.Rejected</span> <span class="hljs-attr">component</span>=<span class="hljs-string">{Error}</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Data.NoData</span> <span class="hljs-attr">component</span>=<span class="hljs-string">{NoData}</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Data.Timeout</span> <span class="hljs-attr">component</span>=<span class="hljs-string">{NoPage}</span> <span class="hljs-attr">secondsToWait</span>=<span class="hljs-string">{20}</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Data.Fulfilled</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Children</span> <span class="hljs-attr">childrenToRender</span>=<span class="hljs-string">{props.children}</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{ref}/</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Data.Fulfilled</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Data</span>&gt;</span></span>
  )

})

<span class="hljs-title class_">DataPage</span>.<span class="hljs-property">propTypes</span> = {
  <span class="hljs-attr">fetch</span>: <span class="hljs-title class_">PropTypes</span>.<span class="hljs-title function_">arrayOf</span>(<span class="hljs-title class_">PropTypes</span>.<span class="hljs-title function_">shape</span>({
    <span class="hljs-attr">slice</span>: <span class="hljs-title class_">PropTypes</span>.<span class="hljs-property">string</span>.<span class="hljs-property">isRequired</span>,
    <span class="hljs-attr">url</span>: <span class="hljs-title class_">PropTypes</span>.<span class="hljs-property">string</span>.<span class="hljs-property">isRequired</span>,
    <span class="hljs-attr">select</span>: <span class="hljs-title class_">PropTypes</span>.<span class="hljs-property">func</span>
  })).<span class="hljs-property">isRequired</span>,
  <span class="hljs-attr">isDebugEnabled</span>: <span class="hljs-title class_">PropTypes</span>.<span class="hljs-property">bool</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">DataPage</span></pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrccomponentsdatasearchbarsearchbar.js"><a href="#toc"><a name="ui-src-components-datasearchbar-searchbar-js">ui/src/components/DataSearchBar/SearchBar.js</a></a></h2>
<pre><code><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useEffect, useCallback, useState, memo } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">PropTypes</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;prop-types&#x27;</span>
<span class="hljs-keyword">import</span> { useDispatch, useSelector } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-redux&#x27;</span>
<span class="hljs-keyword">import</span> { useHistory } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-router-dom&#x27;</span>
<span class="hljs-keyword">import</span> { useTranslation } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-i18next&#x27;</span>
<span class="hljs-keyword">import</span> { setSearchTerm } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../state/slices/searchStateSlice&#x27;</span>
<span class="hljs-keyword">import</span> { useTheme } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/styles&#x27;</span>
<span class="hljs-keyword">import</span> useStyles <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../theme/SearchBarStyles&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">CustomSearchInput</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./SearchBarInputUtils&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">CustomDropdownList</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./SearchBarDropdownUtils&#x27;</span>
<span class="hljs-keyword">import</span> i18n <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../i18n&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Data</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../Data/Data&#x27;</span>
<span class="hljs-keyword">import</span> { searchSelector } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../state/slices/searchStateSlice&#x27;</span>

<span class="hljs-comment">/* 
  SearchBar: a search input with a formatted drop-down list
  props:
    location: a string specifiying whether this component is in the header or search results page (required)
*/</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">SearchBar</span> = props =&gt; {

  <span class="hljs-keyword">const</span> location = props?.<span class="hljs-property">location</span> || <span class="hljs-string">&#x27;&#x27;</span>
  <span class="hljs-keyword">const</span> theme = <span class="hljs-title function_">useTheme</span>()
  <span class="hljs-keyword">const</span> classes = <span class="hljs-title function_">useStyles</span>(theme)

  <span class="hljs-comment">/* Set up hooks */</span>
  <span class="hljs-keyword">const</span> dispatch = <span class="hljs-title function_">useDispatch</span>()
  <span class="hljs-keyword">const</span> history = <span class="hljs-title function_">useHistory</span>()
  <span class="hljs-keyword">const</span> [isInitialLoad, setIsInitialLoad] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">true</span>)
  <span class="hljs-keyword">const</span> [rawSearchTerm, setRawSearchTerm] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>) 
  <span class="hljs-keyword">const</span> { t, <span class="hljs-attr">ready</span>: translationReady } = <span class="hljs-title function_">useTranslation</span>(
    <span class="hljs-string">&#x27;Search&#x27;</span>, <span class="hljs-comment">/* i18next-parser needs string here */</span>
    { <span class="hljs-attr">useSuspense</span>: <span class="hljs-literal">false</span>, i18n }
  )

  <span class="hljs-comment">/* Read state from the Redux store */</span>
  <span class="hljs-keyword">const</span> searchTerm = <span class="hljs-title function_">useSelector</span>(<span class="hljs-function"><span class="hljs-params">state</span> =&gt;</span> state.<span class="hljs-property">search</span>.<span class="hljs-property">searchTerm</span>)
  <span class="hljs-keyword">const</span> resultJson = <span class="hljs-title function_">useSelector</span>(searchSelector)
  <span class="hljs-keyword">const</span> results = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>([], resultJson) <span class="hljs-comment">/* adds missing Array __proto__ */</span>

  <span class="hljs-comment">/* get raw user input as state */</span> 
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleSearchTextChange</span> = e =&gt; {
    <span class="hljs-keyword">const</span> {value} = e.<span class="hljs-property">target</span>
    <span class="hljs-title function_">setRawSearchTerm</span>(value)
  }

  <span class="hljs-comment">/* Feed debounced user input into Redux store */</span> 
  <span class="hljs-comment">/* updating state and updating store need to be separated i think because setState() is asynchronous */</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">/* only update searchterm if there is actually something in the search bar */</span>
      <span class="hljs-comment">/* without this, when the app navigates to the search results page, an empty list shows */</span> 
      <span class="hljs-keyword">if</span>(rawSearchTerm.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) <span class="hljs-title function_">dispatch</span>(<span class="hljs-title function_">setSearchTerm</span>(rawSearchTerm))
      <span class="hljs-keyword">if</span> (isInitialLoad) <span class="hljs-title function_">setIsInitialLoad</span>(<span class="hljs-literal">false</span>)
    }, <span class="hljs-number">250</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearTimeout</span>(timer)
  }, [rawSearchTerm, dispatch, isInitialLoad])
  

  <span class="hljs-comment">/* Navigate to the Search Results page on Submit */</span>
  <span class="hljs-keyword">const</span> handleSearchSubmit = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {
    <span class="hljs-keyword">if</span>(rawSearchTerm.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span> <span class="hljs-comment">/* if the user hasn&#x27;t typed anything don&#x27;t navigate to the search results page */</span> 
    <span class="hljs-title function_">dispatch</span>(<span class="hljs-title function_">setSearchTerm</span>(rawSearchTerm)) <span class="hljs-comment">/* update what the searchterm should be, bypassing the debounce. Without this the results pages shows an outdated result */</span> 
    history.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;/searchresults&#x27;</span>) <span class="hljs-comment">/* Redirect to searchresults page */</span>
    <span class="hljs-comment">// eslint-disable-next-line</span>
  }, [rawSearchTerm] )

  <span class="hljs-comment">/* This is a hack to prevent the drop-down bar from staying open after an item is clicked */</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleResultClick</span> = (<span class="hljs-params"></span>) =&gt; {
    <span class="hljs-title function_">setRawSearchTerm</span>(<span class="hljs-string">&#x27;&#x27;</span>)
  }

  <span class="hljs-comment">/* Define when dropdown list can render */</span>
  <span class="hljs-keyword">const</span> resultsReady =
    !isInitialLoad &amp;&amp;
    <span class="hljs-keyword">typeof</span> searchTerm === <span class="hljs-string">&#x27;string&#x27;</span> &amp;&amp;
    rawSearchTerm.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span> &amp;&amp;
    results.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span> &amp;&amp;
    history.<span class="hljs-property">location</span>.<span class="hljs-property">pathname</span> !== <span class="hljs-string">&#x27;/searchresults&#x27;</span>

  <span class="hljs-comment">/* Return appropriate content for error conditions  */</span>
  <span class="hljs-keyword">if</span> (!translationReady) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>

  <span class="hljs-comment">/* Render the search bar */</span>
  <span class="hljs-keyword">return</span> (
    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{classes.root}</span>&gt;</span>
      {typeof searchTerm === &#x27;string&#x27; &amp;&amp; searchTerm.length &gt; 0 &amp;&amp;
        <span class="hljs-tag">&lt;<span class="hljs-name">Data</span> <span class="hljs-attr">fetch</span>=<span class="hljs-string">{[{</span>
          <span class="hljs-attr">slice:</span> &#x27;<span class="hljs-attr">search</span>&#x27;, <span class="hljs-attr">url:</span> `<span class="hljs-attr">api</span>/<span class="hljs-attr">search</span>?<span class="hljs-attr">q</span>=<span class="hljs-string">${encodeURIComponent(searchTerm)}</span>`,
          <span class="hljs-attr">select:</span> <span class="hljs-attr">j</span> =&gt;</span> j.results}]} isDebugEnabled={false}&gt;
        <span class="hljs-tag">&lt;/<span class="hljs-name">Data</span>&gt;</span>
      }
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;wrapper-div&#x27;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{location</span> === <span class="hljs-string">&#x27;/&#x27;</span> ? &#x27;<span class="hljs-attr">search-bar</span>&#x27; <span class="hljs-attr">:</span> &#x27;<span class="hljs-attr">search-bar-header</span>&#x27;}&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;search-form&quot;</span>&gt;</span> 
            <span class="hljs-tag">&lt;<span class="hljs-name">CustomSearchInput</span>
              <span class="hljs-attr">value</span>=<span class="hljs-string">{rawSearchTerm}</span>
              <span class="hljs-attr">placeholderText</span>=<span class="hljs-string">{t(</span>&#x27;<span class="hljs-attr">Search</span> <span class="hljs-attr">for</span> <span class="hljs-attr">an</span> <span class="hljs-attr">address</span>, <span class="hljs-attr">owner</span>, <span class="hljs-attr">or</span> <span class="hljs-attr">neighborhood</span> <span class="hljs-attr">in</span> <span class="hljs-attr">San</span> <span class="hljs-attr">Francisco</span>&#x27;)}
              <span class="hljs-attr">handleChange</span>=<span class="hljs-string">{handleSearchTextChange}</span>
              <span class="hljs-attr">handleSearchSubmit</span>=<span class="hljs-string">{handleSearchSubmit}</span>
              <span class="hljs-attr">handleResultClick</span>=<span class="hljs-string">{handleResultClick}</span>
            /&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        {
          resultsReady &amp;&amp; 
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{classes.searchResults}</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">CustomDropdownList</span>
                <span class="hljs-attr">data</span>=<span class="hljs-string">{results}</span>
                <span class="hljs-attr">handleResultClick</span>=<span class="hljs-string">{handleResultClick}</span>
              /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        }
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}

<span class="hljs-title class_">SearchBar</span>.<span class="hljs-property">propTypes</span> = {
  <span class="hljs-attr">location</span>: <span class="hljs-title class_">PropTypes</span>.<span class="hljs-property">string</span>.<span class="hljs-property">isRequired</span>
}

<span class="hljs-title class_">SearchBar</span>.<span class="hljs-property">defaultProps</span> = {
  <span class="hljs-attr">location</span>: <span class="hljs-string">&#x27;&#x27;</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">memo</span>(<span class="hljs-title class_">SearchBar</span>)</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrccomponentsdatasearchbarsearchbardropdownutils.js"><a href="#toc"><a name="ui-src-components-datasearchbar-searchbardropdownutils-js">ui/src/components/DataSearchBar/SearchBarDropdownUtils.js</a></a></h2>
<pre><code><span class="language-xml">import React from &#x27;react&#x27;
import { Link as RouterLink } from &#x27;react-router-dom&#x27;
import { List, ListItem, ListItemText, ListItemIcon } from &#x27;@material-ui/core&#x27;
import { titleCase } from &#x27;../../utils/stringUtils&#x27;
import HomeOutlinedIcon from &#x27;@material-ui/icons/HomeOutlined&#x27;
import RoomOutlinedIcon from &#x27;@material-ui/icons/RoomOutlined&#x27;
import BusinessIcon from &#x27;@material-ui/icons/Business&#x27;
import useMediaQuery from &#x27;@material-ui/core/useMediaQuery&#x27;
import Typography from &#x27;@material-ui/core/Typography&#x27;
import { isNull } from &#x27;../Data/DataUtils&#x27;

const MAX_DROPDOWN_SEARCH_RESULTS = 5

/* ------------- SEARCH BAR DROPDOWN RESULT LIST HELPERS ------------------- */

const CustomListIcon = props =&gt; (
  <span class="hljs-tag">&lt;<span class="hljs-name">ListItemIcon</span> <span class="hljs-attr">color</span>=<span class="hljs-string">&quot;secondary&quot;</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;result-icon&#x27;</span>&gt;</span>
    {props.category === &#x27;PARCEL&#x27; ? <span class="hljs-tag">&lt;<span class="hljs-name">HomeOutlinedIcon</span>/&gt;</span> 
      : props.category === &#x27;NEIGHBORHOOD_SUMMARY&#x27; ? <span class="hljs-tag">&lt;<span class="hljs-name">RoomOutlinedIcon</span>/&gt;</span> 
        : props.category === &#x27;BUSINESS_ENTITY&#x27; ? <span class="hljs-tag">&lt;<span class="hljs-name">BusinessIcon</span>/&gt;</span>
          : null}
  <span class="hljs-tag">&lt;/<span class="hljs-name">ListItemIcon</span>&gt;</span>
)

export const CustomDropdownList = (props) =&gt; {

  const { data, handleResultClick } = props
  const isMediumDisplay = useMediaQuery(&#x27;(min-width: 800px&#x27;)

  const trimmed_data = data.slice(0, MAX_DROPDOWN_SEARCH_RESULTS)

  if (isNull(trimmed_data)) return null

  return (
    <span class="hljs-tag">&lt;<span class="hljs-name">List</span> <span class="hljs-attr">style</span>=</span></span><span class="hljs-template-variable">{{<span class="hljs-name">margin:</span> <span class="hljs-number">0</span>, padding: <span class="hljs-number">0</span>, display: <span class="hljs-string">&#x27;inline&#x27;</span> }}</span><span class="language-xml"><span class="hljs-tag">&gt;</span>
      {trimmed_data.map((item, index) =&gt; (
        <span class="hljs-tag">&lt;<span class="hljs-name">ListItem</span>
          <span class="hljs-attr">key</span>=<span class="hljs-string">{index}</span>
          <span class="hljs-attr">component</span>=<span class="hljs-string">{RouterLink}</span>
          <span class="hljs-attr">to</span>=<span class="hljs-string">{item.details_url}</span>
          <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleResultClick}</span>
          <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;search-results-item&#x27;</span>
          <span class="hljs-attr">style</span>=</span></span><span class="hljs-template-variable">{{
            <span class="hljs-name">display:</span> <span class="hljs-string">&#x27;flex&#x27;</span>,
            justifyContent: <span class="hljs-string">&#x27;space-between&#x27;</span>,
            textDecoration: <span class="hljs-string">&#x27;none!important&#x27;</span>,
            <span class="hljs-string">&#x27;&amp;::hover&#x27;</span>: { textDecoration: <span class="hljs-string">&#x27;underline&#x27;</span> }
          }}</span><span class="language-xml"><span class="hljs-tag">&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=</span></span><span class="hljs-template-variable">{{
            <span class="hljs-name">display:</span> <span class="hljs-string">&#x27;flex&#x27;</span>,
            alignItems: <span class="hljs-string">&#x27;flex-start&#x27;</span>,
            flexDirection: <span class="hljs-string">&#x27;row&#x27;</span>
          }}</span><span class="language-xml"><span class="hljs-tag">&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">CustomListIcon</span> <span class="hljs-attr">category</span>=<span class="hljs-string">{item.category}</span> /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">ListItemText</span> <span class="hljs-attr">inset</span>
              <span class="hljs-attr">disableTypography</span>
              <span class="hljs-attr">style</span>=</span></span><span class="hljs-template-variable">{{ <span class="hljs-name">padding:</span> <span class="hljs-number">0</span>, margin: <span class="hljs-number">0</span>, color: <span class="hljs-string">&#x27;black&#x27;</span>}}</span><span class="language-xml"><span class="hljs-tag">
              <span class="hljs-attr">primary</span>=<span class="hljs-string">{</span>
                &lt;<span class="hljs-attr">Typography</span> <span class="hljs-attr">variant</span>=<span class="hljs-string">&#x27;body2&#x27;</span>&gt;</span>
                  {titleCase(item.label)}
                <span class="hljs-tag">&lt;/<span class="hljs-name">Typography</span>&gt;</span>
              }
            /&gt;
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          {isMediumDisplay &amp;&amp;
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=</span></span><span class="hljs-template-variable">{{ <span class="hljs-name">alignItems:</span> <span class="hljs-string">&#x27;flex-end&#x27;</span> }}</span><span class="language-xml"><span class="hljs-tag">&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">ListItemText</span> <span class="hljs-attr">inset</span> <span class="hljs-attr">primary</span>=<span class="hljs-string">{</span>
                &lt;<span class="hljs-attr">Typography</span> <span class="hljs-attr">variant</span>=<span class="hljs-string">&#x27;body2&#x27;</span> <span class="hljs-attr">className</span> = <span class="hljs-string">&#x27;searchTypeText&#x27;</span> <span class="hljs-attr">style</span>=</span></span><span class="hljs-template-variable">{{
                  <span class="hljs-name">textDecoration:</span> <span class="hljs-string">&#x27;none!important&#x27;</span>,
                  <span class="hljs-string">&#x27;&amp;::hover&#x27;</span>: { textDecoration: <span class="hljs-string">&#x27;underline&#x27;</span> }
                }}</span><span class="language-xml"><span class="hljs-tag">&gt;</span>
                  {item.category_label.toUpperCase()}
                <span class="hljs-tag">&lt;/<span class="hljs-name">Typography</span>&gt;</span>
              }
              /&gt;
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          }
        <span class="hljs-tag">&lt;/<span class="hljs-name">ListItem</span>&gt;</span>
      ))}
    <span class="hljs-tag">&lt;/<span class="hljs-name">List</span>&gt;</span>
  )
}</span></pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrccomponentsdatasearchbarsearchbarinpututils.js"><a href="#toc"><a name="ui-src-components-datasearchbar-searchbarinpututils-js">ui/src/components/DataSearchBar/SearchBarInputUtils.js</a></a></h2>
<pre><code><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">TextField</span>, <span class="hljs-title class_">InputAdornment</span>, <span class="hljs-title class_">Typography</span>, <span class="hljs-title class_">IconButton</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core&#x27;</span>
<span class="hljs-keyword">import</span> { useSelector } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-redux&#x27;</span>
<span class="hljs-comment">/* Mui icons for search bar */</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">CloseIcon</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/icons/Close&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">SearchIcon</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/icons/Search&#x27;</span>

<span class="hljs-comment">/* ------------- SEARCH BAR TEXT INPUT HELPERS ------------------- */</span>

<span class="hljs-comment">/* icons in the far right of search bar: they render as an &quot;x&quot; and a magnifying glass */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">CustomSearchIcons</span> = (<span class="hljs-params">{handleResultClick, handleSearchSubmit}</span>) =&gt; {
  
  <span class="hljs-keyword">const</span> value = <span class="hljs-title function_">useSelector</span>(<span class="hljs-function"><span class="hljs-params">state</span> =&gt;</span> state.<span class="hljs-property">search</span>.<span class="hljs-property">searchTerm</span> )
  
  <span class="hljs-keyword">return</span> (
    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span>

      {/* conditionally render the &quot;X&quot; that closes the dropdown */}
      {value.length &gt; 0 &amp;&amp; 
        <span class="hljs-tag">&lt;&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">IconButton</span> <span class="hljs-attr">aria-label</span>=<span class="hljs-string">&quot;cancel search&quot;</span> <span class="hljs-attr">disableRipple</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleResultClick}</span> <span class="hljs-attr">tabIndex</span>=<span class="hljs-string">{-1}</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">CloseIcon</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{color:</span> &#x27;<span class="hljs-attr">lightgrey</span>&#x27;}} /&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">IconButton</span>&gt;</span>

          <span class="hljs-tag">&lt;<span class="hljs-name">Typography</span>  
            <span class="hljs-attr">tabIndex</span>=<span class="hljs-string">{-1}</span>
            <span class="hljs-attr">style</span>=<span class="hljs-string">{{color:</span> &#x27;<span class="hljs-attr">lightgrey</span>&#x27;, <span class="hljs-attr">fontSize:</span> &#x27;<span class="hljs-attr">1.5em</span>&#x27;, <span class="hljs-attr">fontWeight:</span> &#x27;<span class="hljs-attr">300</span>&#x27;}}&gt;</span>|
          <span class="hljs-tag">&lt;/<span class="hljs-name">Typography</span>&gt;</span>
        <span class="hljs-tag">&lt;/&gt;</span></span>
      }

      &lt;<span class="hljs-title class_">IconButton</span> 
        tabIndex={<span class="hljs-number">0</span>}
        className=<span class="hljs-string">&#x27;focus-dark&#x27;</span>
        aria-label=<span class="hljs-string">&quot;search&quot;</span> disableRipple onClick={handleSearchSubmit}&gt;
        <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">SearchIcon</span> /&gt;</span></span>
      &lt;/<span class="hljs-title class_">IconButton</span>&gt;

    &lt;/&gt;
  )
}

<span class="hljs-comment">/* helper function for search bar icons */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">CustomSearchAdornment</span> = (<span class="hljs-params">{ handleResultClick, handleSearchSubmit }</span>) =&gt; (
  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">InputAdornment</span> <span class="hljs-attr">position</span>=<span class="hljs-string">&quot;end&quot;</span> <span class="hljs-attr">tabIndex</span>=<span class="hljs-string">{-1}</span>&gt;</span> 
    <span class="hljs-tag">&lt;<span class="hljs-name">CustomSearchIcons</span> 
      <span class="hljs-attr">handleResultClick</span>=<span class="hljs-string">{handleResultClick}</span> 
      <span class="hljs-attr">handleSearchSubmit</span>=<span class="hljs-string">{handleSearchSubmit}/</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">InputAdornment</span>&gt;</span></span>
)

<span class="hljs-comment">/* primary site search bar */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">CustomSearchInput</span> = (<span class="hljs-params">{ value, handleChange, placeholderText, handleResultClick, handleSearchSubmit }</span>) =&gt; {

  <span class="hljs-keyword">return</span> (
    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">TextField</span>
      <span class="hljs-attr">variant</span>=<span class="hljs-string">&quot;outlined&quot;</span>
      <span class="hljs-attr">aria-label</span>=<span class="hljs-string">&quot;Search for an address, owner, or neighborhood in San Francisco&quot;</span>
      <span class="hljs-attr">placeholder</span>=<span class="hljs-string">{placeholderText}</span>
      <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;search-item&quot;</span> // <span class="hljs-attr">keep</span> <span class="hljs-attr">this.</span> <span class="hljs-attr">important</span> <span class="hljs-attr">for</span> <span class="hljs-attr">styles.</span> <span class="hljs-attr">find</span> <span class="hljs-attr">out</span> <span class="hljs-attr">why</span>
      <span class="hljs-attr">fullWidth</span>
      <span class="hljs-attr">autoFocus</span>
      <span class="hljs-attr">autoComplete</span>=<span class="hljs-string">&quot;off&quot;</span>
      <span class="hljs-attr">value</span>=<span class="hljs-string">{value}</span>
      <span class="hljs-attr">onChange</span>=<span class="hljs-string">{handleChange}</span>
      <span class="hljs-attr">onKeyPress</span>=<span class="hljs-string">{e</span> =&gt;</span> {
        if(e.key === &#x27;Enter&#x27;){
          e.preventDefault() 
          handleSearchSubmit()
        }
      }
      }      
      InputProps={{
        endAdornment: 
          <span class="hljs-tag">&lt;<span class="hljs-name">CustomSearchAdornment</span> 
            <span class="hljs-attr">handleResultClick</span>=<span class="hljs-string">{handleResultClick}</span> 
            <span class="hljs-attr">handleSearchSubmit</span>=<span class="hljs-string">{handleSearchSubmit}</span>
          /&gt;</span>,
        className: &#x27;input&#x27;
      }}
    /&gt;</span>)
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrccomponentsdatatableadornedtableadornedtable.js"><a href="#toc"><a name="ui-src-components-datatable-adornedtable-adornedtable-js">ui/src/components/DataTable/AdornedTable/AdornedTable.js</a></a></h2>
<pre><code><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useState, forwardRef, useMemo, useEffect, memo } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Link</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">RouterLink</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-router-dom&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">PropTypes</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;prop-types&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">SearchIcon</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/icons/Search&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Notes</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/icons/Notes&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ArrowRight</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/icons/ArrowRight&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ArrowDropDown</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/icons/ArrowDropDown&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">GetAppOutlinedIcon</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/icons/GetAppOutlined&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">TextField</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/TextField&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Button</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/Button&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Card</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/Card&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Typography</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/Typography&#x27;</span>
<span class="hljs-keyword">import</span> { useTheme } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/styles&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Box</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/Box&#x27;</span>
<span class="hljs-keyword">import</span> { isNull, isEmpty } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../Data/DataUtils&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Row</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../Grid&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Link</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/Link&#x27;</span>
<span class="hljs-keyword">import</span> useStyles <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../theme/ListStyles&#x27;</span>
<span class="hljs-keyword">import</span> { useTranslation } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-i18next&#x27;</span>
<span class="hljs-keyword">import</span> i18n <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../i18n&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">BaseTable</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./BaseTable/BaseTable&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">CSVLink</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-csv&#x27;</span>
<span class="hljs-keyword">import</span> { toUnderscore } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../utils/stringUtils&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">InputAdornment</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/InputAdornment&#x27;</span>
<span class="hljs-keyword">import</span> { stableSort, useMemoCompare } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../utils/dataUtils&#x27;</span>
<span class="hljs-comment">/* 
  AdornedTable: a version of the BaseTable component with header and footer components
  props:
    rows[]: an array providing row data for the underlying grid component (required)
    onSearchFilter: called when the table search field changes returning a filtered list
*/</span>

<span class="hljs-keyword">const</span> <span class="hljs-title class_">StyledTable</span> = <span class="hljs-title function_">forwardRef</span>(<span class="hljs-function">(<span class="hljs-params">props, ref</span>) =&gt;</span> {

  <span class="hljs-keyword">const</span> theme = <span class="hljs-title function_">useTheme</span>()
  <span class="hljs-keyword">const</span> classes = <span class="hljs-title function_">useStyles</span>(theme)
  <span class="hljs-keyword">const</span> [searchTerm, setSearchTerm] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>)
  <span class="hljs-keyword">const</span> [debouncedSearchTerm, setDebouncedSearchTerm] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>)
  <span class="hljs-keyword">const</span> onSearchFilter = props.<span class="hljs-property">onSearchFilter</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title class_">SearchHint</span> = props.<span class="hljs-property">searchHint</span>
  <span class="hljs-keyword">const</span> aboutData = props.<span class="hljs-property">aboutData</span>
  <span class="hljs-keyword">const</span> csvFileName = props.<span class="hljs-property">csvFileName</span> ||
    <span class="hljs-string">&#x27;please_add_csvFileName_property_to_DataTable&#x27;</span>
  <span class="hljs-keyword">const</span> sortModel = props.<span class="hljs-property">sortModel</span> <span class="hljs-comment">// sortModel={[{ field: &#x27;evict_date&#x27;, sort: &#x27;desc&#x27; }]}</span>
  
  <span class="hljs-comment">/* only update rows if the literal values have changed */</span> 
  <span class="hljs-comment">/* with an exception for the randomly-generated keyField */</span> 
  <span class="hljs-keyword">const</span> rows = <span class="hljs-title function_">useMemoCompare</span>(props.<span class="hljs-property">rows</span>, <span class="hljs-function">(<span class="hljs-params">prev, next</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span>(!prev) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
    <span class="hljs-keyword">const</span> prevBase = prev.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">d</span> =&gt;</span> <span class="hljs-keyword">delete</span> d.<span class="hljs-property">keyField</span>)
    <span class="hljs-keyword">const</span> nextBase = next.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">d</span> =&gt;</span> <span class="hljs-keyword">delete</span> d.<span class="hljs-property">keyField</span>)
    <span class="hljs-keyword">return</span> (<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(prevBase) === <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(nextBase))
  })

  <span class="hljs-keyword">const</span> { t, <span class="hljs-attr">ready</span>: translationReady } = <span class="hljs-title function_">useTranslation</span>(
    <span class="hljs-string">&#x27;List&#x27;</span>, <span class="hljs-comment">/* i18next-parser needs string here */</span>
    { <span class="hljs-attr">useSuspense</span>: <span class="hljs-literal">false</span>, i18n }
  )

  <span class="hljs-comment">/* Set final state for TextField input changes post-debounce */</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">setDebouncedSearchTerm</span>(searchTerm), <span class="hljs-number">1000</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearTimeout</span>(timer)
  }, [searchTerm])

  <span class="hljs-comment">/* Initial sort of the data per the sortModel, if provided */</span>
  <span class="hljs-keyword">const</span> sortedRows = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">let</span> _rows = rows
    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">isEmpty</span>(sortModel)) {
      sortModel.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">s</span> =&gt;</span> {
        <span class="hljs-keyword">const</span> field = s.<span class="hljs-property">field</span>
        <span class="hljs-keyword">const</span> compare = s.<span class="hljs-property">sort</span> === <span class="hljs-string">&#x27;asc&#x27;</span>
          ? <span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> {
            <span class="hljs-keyword">if</span> (a[field] &lt; b[field]) <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>
            <span class="hljs-keyword">if</span> (a[field] &gt; b[field]) <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>
            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>
          }
          : <span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> {
            <span class="hljs-keyword">if</span> (a[field] &gt; b[field]) <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>
            <span class="hljs-keyword">if</span> (a[field] &lt; b[field]) <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>
            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>
          }
        <span class="hljs-comment">// eslint-disable-next-line</span>
        _rows = <span class="hljs-title function_">stableSort</span>(_rows, compare)
      })
    }
    <span class="hljs-keyword">else</span> {
      _rows = rows
    }
    <span class="hljs-keyword">return</span> _rows
    <span class="hljs-comment">// eslint-disable-next-line</span>
  }, [rows])

  <span class="hljs-comment">/* Basic implementation of filtering table rows with a search term */</span>
  <span class="hljs-keyword">const</span> filteredRows = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> ({
    <span class="hljs-attr">rows</span>: debouncedSearchTerm
      ? sortedRows.<span class="hljs-title function_">filter</span>(
        <span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">values</span>(x).<span class="hljs-title function_">filter</span>(
          <span class="hljs-function"><span class="hljs-params">y</span> =&gt;</span> {
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> y === <span class="hljs-string">&#x27;string&#x27;</span>)
              <span class="hljs-keyword">return</span> y.<span class="hljs-title function_">toLowerCase</span>().<span class="hljs-title function_">indexOf</span>(debouncedSearchTerm.<span class="hljs-title function_">toLowerCase</span>()) &gt;= <span class="hljs-number">0</span>
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> y === <span class="hljs-string">&#x27;number&#x27;</span>)
              <span class="hljs-keyword">return</span> y.<span class="hljs-title function_">toString</span>() === debouncedSearchTerm
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
          }
        ).<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>
      )
      : rows
      <span class="hljs-comment">// eslint-disable-next-line</span>
  }), [debouncedSearchTerm, sortedRows])
  
  <span class="hljs-comment">/* Call the onSearchFilter event handler if present */</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> onSearchFilter === <span class="hljs-string">&#x27;function&#x27;</span>) {
      <span class="hljs-title function_">onSearchFilter</span>(filteredRows.<span class="hljs-property">rows</span>)
    }
    <span class="hljs-comment">// eslint-disable-next-line</span>
  }, [filteredRows])

  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isNull</span>(props)) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
  <span class="hljs-keyword">if</span> (!translationReady) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>

  <span class="hljs-comment">/* Component to define the content of the toolbar at the top of the table */</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title class_">Toolbar</span> = <span class="hljs-title function_">memo</span>(<span class="hljs-function">() =&gt;</span> {

    <span class="hljs-comment">/* Set intermediate state for TextField input changes pre-debounce */</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleTextFieldChange</span> = e =&gt; {
      <span class="hljs-keyword">const</span> newTerm = <span class="hljs-keyword">typeof</span> e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span> === <span class="hljs-string">&#x27;string&#x27;</span> ? e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span> : <span class="hljs-string">&#x27;&#x27;</span>
      <span class="hljs-title function_">setSearchTerm</span>(newTerm)
    }

    <span class="hljs-comment">/* Flatten and reformat non-string object data for proper display in CSV */</span>
    <span class="hljs-keyword">const</span> csvRows = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">return</span> filteredRows.<span class="hljs-property">rows</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">row</span> =&gt;</span> {
        <span class="hljs-keyword">return</span> ({...row,
          <span class="hljs-attr">primary_evictor</span>: row.<span class="hljs-property">primary_evictor</span>?.<span class="hljs-property">name</span>,
          <span class="hljs-attr">match_quality</span>: <span class="hljs-string">`Method: <span class="hljs-subst">${row.match_quality?.addr_match_method}</span>, Subdivision: <span class="hljs-subst">${row.match_quality?.did_subdivision_occur}</span>`</span>
        })
      })
      <span class="hljs-comment">// eslint-disable-next-line</span>
    },[filteredRows.<span class="hljs-property">rows</span>])

    <span class="hljs-keyword">return</span> (
      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Row</span> <span class="hljs-attr">direction</span>=<span class="hljs-string">&#x27;row&#x27;</span> <span class="hljs-attr">justify</span>=<span class="hljs-string">&#x27;space-between&#x27;</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;header&#x27;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span>
          <span class="hljs-attr">display:</span> &#x27;<span class="hljs-attr">flex</span>&#x27;,
          <span class="hljs-attr">flexDirection:</span> &#x27;<span class="hljs-attr">row</span>&#x27;,
          <span class="hljs-attr">alignItems:</span> &#x27;<span class="hljs-attr">flex-end</span>&#x27;,
          <span class="hljs-attr">marginBottom:</span> <span class="hljs-attr">3</span>
        }}&gt;</span>
          {(
            (!isEmpty(csvRows) &amp;&amp; Array.isArray(csvRows)) &amp;&amp;
            (typeof csvFileName === &#x27;string&#x27; &amp;&amp; csvFileName.length &gt; 0)
          ) &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">CSVLink</span>
            <span class="hljs-attr">data</span>=<span class="hljs-string">{csvRows}</span>
            <span class="hljs-attr">filename</span>=<span class="hljs-string">{toUnderscore(csvFileName)</span> + &#x27;<span class="hljs-attr">.csv</span>&#x27;}&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Row</span> <span class="hljs-attr">direction</span>=<span class="hljs-string">&#x27;row&#x27;</span> <span class="hljs-attr">wrap</span>=<span class="hljs-string">&#x27;nowrap&#x27;</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">GetAppOutlinedIcon</span> <span class="hljs-attr">htmlColor</span>=<span class="hljs-string">{theme.palette.common.OFFWHITE}/</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">Typography</span> <span class="hljs-attr">variant</span>=<span class="hljs-string">&#x27;body1&#x27;</span>&gt;</span>Download as CSV<span class="hljs-tag">&lt;/<span class="hljs-name">Typography</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">Row</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">CSVLink</span>&gt;</span>}
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{marginRight:</span> <span class="hljs-attr">20</span>, <span class="hljs-attr">fontWeight:</span> <span class="hljs-attr">100</span>}}&gt;</span>
            { searchTerm !== &#x27;&#x27; &amp;&amp; SearchHint &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">SearchHint</span>/&gt;</span> }
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">TextField</span>
            <span class="hljs-attr">inputRef</span>=<span class="hljs-string">{input</span> =&gt;</span>
              input?.value &amp;&amp; /* If input and its value property exist */
              searchTerm !== debouncedSearchTerm &amp;&amp; /* If a debounce is in progress */
              input.focus() /* Steal focus */
            }
            autoComplete=&#x27;off&#x27;
            aria-label={t(&#x27;search the table&#x27;)}
            placeholder={t(&#x27;Search Table&#x27;)}
            size=&#x27;small&#x27;
            margin=&#x27;dense&#x27;
            variant=&quot;standard&quot;
            onChange={handleTextFieldChange}
            value={searchTerm}
            ref={ref}
            InputProps={{
              startAdornment: (
                <span class="hljs-tag">&lt;<span class="hljs-name">InputAdornment</span>&gt;</span>
                  <span class="hljs-tag">&lt;<span class="hljs-name">SearchIcon</span> <span class="hljs-attr">htmlColor</span>=<span class="hljs-string">{theme.palette.common.OFFWHITE}</span> /&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">InputAdornment</span>&gt;</span>
              )}}
          /&gt;
          <span class="hljs-tag">&lt;<span class="hljs-name">SearchIcon</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Row</span>&gt;</span></span>
    )
  })

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">About</span>(<span class="hljs-params"></span>) {

    <span class="hljs-keyword">const</span> [showAbout, setShowAbout] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>)
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleClick</span> = e =&gt; <span class="hljs-title function_">setShowAbout</span>(!showAbout)

    <span class="hljs-keyword">return</span> (
      !<span class="hljs-title function_">isNull</span>(aboutData) &amp;&amp;
      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{display:</span> &#x27;<span class="hljs-attr">flex</span>&#x27;, <span class="hljs-attr">flexDirection:</span> &#x27;<span class="hljs-attr">column</span>&#x27;, <span class="hljs-attr">marginTop:</span> <span class="hljs-attr">10</span>}}&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Button</span>
          <span class="hljs-attr">className</span>=<span class="hljs-string">{classes.aboutButton}</span>
          <span class="hljs-attr">color</span>=<span class="hljs-string">&quot;primary&quot;</span>
          <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;small&quot;</span>
          <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleClick}</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Row</span> <span class="hljs-attr">direction</span>=<span class="hljs-string">&#x27;row&#x27;</span> <span class="hljs-attr">alignItems</span>=<span class="hljs-string">&#x27;center&#x27;</span> <span class="hljs-attr">wrap</span>=<span class="hljs-string">&#x27;nowrap&#x27;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Notes</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Typography</span> <span class="hljs-attr">variant</span>=<span class="hljs-string">&#x27;body1&#x27;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span>
              <span class="hljs-attr">flexWrap:</span> &#x27;<span class="hljs-attr">nowrap</span>&#x27;,
              <span class="hljs-attr">whiteSpace:</span> &#x27;<span class="hljs-attr">nowrap</span>&#x27;
            }}&gt;</span>
              <span class="hljs-symbol">&amp;nbsp;</span>{t(&#x27;ABOUT THIS DATA&#x27;)}<span class="hljs-symbol">&amp;nbsp;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">Typography</span>&gt;</span>
            { showAbout ? <span class="hljs-tag">&lt;<span class="hljs-name">ArrowDropDown</span>/&gt;</span> : <span class="hljs-tag">&lt;<span class="hljs-name">ArrowRight</span>/&gt;</span> }
          <span class="hljs-tag">&lt;/<span class="hljs-name">Row</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Box</span> <span class="hljs-attr">display</span>=<span class="hljs-string">{showAbout</span> ? &#x27;<span class="hljs-attr">block</span>&#x27; <span class="hljs-attr">:</span> &#x27;<span class="hljs-attr">none</span>&#x27;}&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Card</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{classes.aboutCard}</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Row</span> <span class="hljs-attr">direction</span>=<span class="hljs-string">&#x27;row&#x27;</span> <span class="hljs-attr">alignItems</span>=<span class="hljs-string">&#x27;center&#x27;</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">Typography</span> <span class="hljs-attr">variant</span>=<span class="hljs-string">&#x27;body1&#x27;</span>&gt;</span>{t(&#x27;Source:&#x27;)}<span class="hljs-symbol">&amp;nbsp;</span><span class="hljs-tag">&lt;/<span class="hljs-name">Typography</span>&gt;</span>
              { !isNull(aboutData.href)
                ? <span class="hljs-tag">&lt;<span class="hljs-name">Typography</span> <span class="hljs-attr">variant</span>=<span class="hljs-string">&#x27;body1&#x27;</span>&gt;</span>
                  <span class="hljs-tag">&lt;<span class="hljs-name">Link</span>
                    <span class="hljs-attr">component</span>=<span class="hljs-string">{RouterLink}</span>
                    <span class="hljs-attr">underline</span>=<span class="hljs-string">&#x27;always&#x27;</span>
                    <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span>
                      <span class="hljs-attr">color:</span> <span class="hljs-attr">theme.palette.common.OFFWHITE</span>,
                      <span class="hljs-attr">backgroundColor:</span> &#x27;#<span class="hljs-attr">302742</span>&#x27;,
                      &#x27;&amp; <span class="hljs-attr">a::hover</span>&#x27;<span class="hljs-attr">:</span> { <span class="hljs-attr">textDecoration:</span> &#x27;<span class="hljs-attr">underline</span>&#x27; }
                    }}
                    <span class="hljs-attr">to</span>=<span class="hljs-string">{{pathname:</span> <span class="hljs-attr">aboutData.href</span>}}&gt;</span>
                    {aboutData.source}
                  <span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">Typography</span>&gt;</span>
                : <span class="hljs-tag">&lt;<span class="hljs-name">Typography</span> <span class="hljs-attr">variant</span>=<span class="hljs-string">&#x27;body1&#x27;</span>&gt;</span>
                  {aboutData.source}
                <span class="hljs-tag">&lt;/<span class="hljs-name">Typography</span>&gt;</span>
              }
            <span class="hljs-tag">&lt;/<span class="hljs-name">Row</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Row</span> <span class="hljs-attr">direction</span>=<span class="hljs-string">&#x27;row&#x27;</span> <span class="hljs-attr">alignItems</span>=<span class="hljs-string">&#x27;flex-start&#x27;</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">Typography</span> <span class="hljs-attr">variant</span>=<span class="hljs-string">&#x27;body1&#x27;</span>&gt;</span>{t(&#x27;Notes:&#x27;)}<span class="hljs-symbol">&amp;nbsp;</span><span class="hljs-tag">&lt;/<span class="hljs-name">Typography</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">Typography</span> <span class="hljs-attr">variant</span>=<span class="hljs-string">&#x27;body1&#x27;</span>&gt;</span>{aboutData.notes}<span class="hljs-tag">&lt;/<span class="hljs-name">Typography</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">Row</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">Card</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Box</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    )
  }
  <span class="hljs-keyword">return</span> (
    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>
      <span class="hljs-attr">className</span>=<span class="hljs-string">{props.className}</span>
      <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">contain:</span> &#x27;<span class="hljs-attr">layout</span>&#x27; }}
      <span class="hljs-attr">tag</span>=<span class="hljs-string">&#x27;allow the browser to optimize rendering performance&#x27;</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
        <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">width:</span> &#x27;<span class="hljs-attr">100</span>%&#x27; }}
        <span class="hljs-attr">tag</span>=<span class="hljs-string">&#x27;DataGrid is a flex container, so it needs a parent with a set width&#x27;</span>&gt;</span>
        {/* Replace DataGrid with a Table to gain needed flexibility */}
        <span class="hljs-tag">&lt;<span class="hljs-name">Toolbar</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">BaseTable</span>
          <span class="hljs-attr">classes</span>=<span class="hljs-string">{classes}</span>
          { <span class="hljs-attr">...props</span> }
          { <span class="hljs-attr">...filteredRows</span> }
          <span class="hljs-attr">about</span>=<span class="hljs-string">{About}</span>
        /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )

})

<span class="hljs-title class_">StyledTable</span>.<span class="hljs-property">propTypes</span> = {
  <span class="hljs-attr">rows</span>: <span class="hljs-title class_">PropTypes</span>.<span class="hljs-property">array</span>.<span class="hljs-property">isRequired</span>,
  <span class="hljs-attr">columns</span>: <span class="hljs-title class_">PropTypes</span>.<span class="hljs-property">array</span>.<span class="hljs-property">isRequired</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">memo</span>(<span class="hljs-title class_">StyledTable</span>)</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrccomponentsdatatableadornedtablebasetablebasetable.js"><a href="#toc"><a name="ui-src-components-datatable-adornedtable-basetable-basetable-js">ui/src/components/DataTable/AdornedTable/BaseTable/BaseTable.js</a></a></h2>
<pre><code><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useMemo } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">PropTypes</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;prop-types&#x27;</span>
<span class="hljs-keyword">import</span> { withStyles } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/styles&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Table</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/Table&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">TableBody</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/TableBody&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">TableCell</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/TableCell&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">TableContainer</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/TableContainer&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">TableHead</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/TableHead&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">TablePagination</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/TablePagination&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">TableRow</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/TableRow&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">TableSortLabel</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/TableSortLabel&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Paper</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/Paper&#x27;</span>
<span class="hljs-keyword">import</span> { useTheme } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/styles&#x27;</span>
<span class="hljs-keyword">import</span> useStyles <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../../theme/ListStyles&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Row</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../Grid&#x27;</span>
<span class="hljs-keyword">import</span> { isEmpty, isNull } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../Data/DataUtils&#x27;</span>
<span class="hljs-keyword">import</span> useMediaQuery <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/useMediaQuery&#x27;</span>
<span class="hljs-keyword">import</span> { stableSort } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../../utils/dataUtils&#x27;</span>

<span class="hljs-comment">/* 
  BaseTable: a version of Material UI&#x27;s Table component opinionated for style and functionality
  props:
    rows[]: an array providing row data for the underlying grid component (required)
*/</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">TableHeader</span>(<span class="hljs-params">props</span>) {
  <span class="hljs-keyword">const</span> theme = <span class="hljs-title function_">useTheme</span>()
  <span class="hljs-keyword">const</span> classes = <span class="hljs-title function_">useStyles</span>(theme)
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isNull</span>(props)) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
  <span class="hljs-keyword">const</span> columns = props.<span class="hljs-property">columns</span>
  <span class="hljs-keyword">const</span> { order, orderBy, onRequestSort } = props
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">createSortHandler</span> = property =&gt; <span class="hljs-function"><span class="hljs-params">event</span> =&gt;</span> {
    <span class="hljs-title function_">onRequestSort</span>(event, property)
  }

  <span class="hljs-keyword">const</span> <span class="hljs-title class_">StyledTableHeaderCell</span> = <span class="hljs-title function_">withStyles</span>(<span class="hljs-function">() =&gt;</span> ({
    <span class="hljs-attr">body</span>: { <span class="hljs-attr">fontSize</span>: <span class="hljs-number">16</span>, <span class="hljs-attr">padding</span>: <span class="hljs-number">8</span> },
  }))(<span class="hljs-title class_">TableCell</span>)

  <span class="hljs-keyword">return</span> (
    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">TableHead</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">TableRow</span>&gt;</span>
        {columns?.map(headCell =&gt; (
          <span class="hljs-tag">&lt;<span class="hljs-name">StyledTableHeaderCell</span>
            <span class="hljs-attr">style</span>=<span class="hljs-string">{props.headerStyles}</span>
            <span class="hljs-attr">className</span>=<span class="hljs-string">{classes.headerCell}</span>
            <span class="hljs-attr">variant</span>=<span class="hljs-string">&#x27;head&#x27;</span>
            <span class="hljs-attr">key</span>=<span class="hljs-string">{headCell.field}</span>
            <span class="hljs-attr">align</span>=<span class="hljs-string">{headCell.numeric</span> ? &#x27;<span class="hljs-attr">right</span>&#x27; <span class="hljs-attr">:</span> &#x27;<span class="hljs-attr">left</span>&#x27;}
            <span class="hljs-attr">padding</span>=<span class="hljs-string">{headCell.disablePadding</span> ? &#x27;<span class="hljs-attr">none</span>&#x27; <span class="hljs-attr">:</span> &#x27;<span class="hljs-attr">default</span>&#x27;}
            <span class="hljs-attr">sortDirection</span>=<span class="hljs-string">{orderBy</span> === <span class="hljs-string">headCell.field</span> ? <span class="hljs-attr">order</span> <span class="hljs-attr">:</span> <span class="hljs-attr">false</span>}&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">TableSortLabel</span>
              <span class="hljs-attr">active</span>=<span class="hljs-string">{orderBy</span> === <span class="hljs-string">headCell.field}</span>
              <span class="hljs-attr">direction</span>=<span class="hljs-string">{orderBy</span> === <span class="hljs-string">headCell.field</span> ? <span class="hljs-attr">order</span> <span class="hljs-attr">:</span> &#x27;<span class="hljs-attr">asc</span>&#x27;}
              <span class="hljs-attr">onClick</span>=<span class="hljs-string">{createSortHandler(headCell.field)}</span>&gt;</span>
              {headCell.headerName}
            <span class="hljs-tag">&lt;/<span class="hljs-name">TableSortLabel</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">StyledTableHeaderCell</span>&gt;</span>
        ))}
      <span class="hljs-tag">&lt;/<span class="hljs-name">TableRow</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">TableHead</span>&gt;</span></span>
  )
}

<span class="hljs-title class_">TableHeader</span>.<span class="hljs-property">propTypes</span> = {
  <span class="hljs-attr">classes</span>: <span class="hljs-title class_">PropTypes</span>.<span class="hljs-property">object</span>.<span class="hljs-property">isRequired</span>,
  <span class="hljs-attr">columns</span>: <span class="hljs-title class_">PropTypes</span>.<span class="hljs-property">array</span>.<span class="hljs-property">isRequired</span>,
  <span class="hljs-attr">onRequestSort</span>: <span class="hljs-title class_">PropTypes</span>.<span class="hljs-property">func</span>.<span class="hljs-property">isRequired</span>,
  <span class="hljs-attr">order</span>: <span class="hljs-title class_">PropTypes</span>.<span class="hljs-title function_">oneOf</span>([<span class="hljs-string">&#x27;asc&#x27;</span>, <span class="hljs-string">&#x27;desc&#x27;</span>]).<span class="hljs-property">isRequired</span>,
  <span class="hljs-attr">orderBy</span>: <span class="hljs-title class_">PropTypes</span>.<span class="hljs-property">string</span>.<span class="hljs-property">isRequired</span>,
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">BaseTable</span>(<span class="hljs-params">props</span>) {
  <span class="hljs-keyword">const</span> theme = <span class="hljs-title function_">useTheme</span>()
  <span class="hljs-keyword">const</span> classes = <span class="hljs-title function_">useStyles</span>(theme)
  <span class="hljs-keyword">const</span> rows = props?.<span class="hljs-property">rows</span>
  <span class="hljs-keyword">const</span> columns = props?.<span class="hljs-property">columns</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title class_">About</span> = props?.<span class="hljs-property">about</span>
  <span class="hljs-keyword">const</span> paginationPageSize = props?.<span class="hljs-property">paginationPageSize</span>
  <span class="hljs-keyword">const</span> sortModel = props?.<span class="hljs-property">sortModel</span> <span class="hljs-comment">//[{ field: &#x27;evict_date&#x27;, sort: &#x27;desc&#x27; }]</span>
  <span class="hljs-comment">//const sortingOrder = props?.sortingOrder //[&#x27;desc&#x27;, &#x27;asc&#x27;, null]</span>
  <span class="hljs-keyword">const</span> [order, setOrder] = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">useState</span>(sortModel?.[<span class="hljs-number">0</span>]?.<span class="hljs-property">sort</span> || <span class="hljs-string">&#x27;asc&#x27;</span>)
  <span class="hljs-keyword">const</span> [orderBy, setOrderBy] = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">useState</span>(sortModel?.[<span class="hljs-number">0</span>]?.<span class="hljs-property">field</span> || <span class="hljs-string">&#x27;&#x27;</span>)
  <span class="hljs-keyword">const</span> [selected, setSelected] = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">useState</span>([])
  <span class="hljs-keyword">const</span> [page, setPage] = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>)
  <span class="hljs-keyword">const</span> [rowsPerPage, setRowsPerPage] = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">useState</span>(paginationPageSize || <span class="hljs-number">10</span>)
  <span class="hljs-keyword">const</span> breakpointMd = <span class="hljs-title function_">useMediaQuery</span>(theme.<span class="hljs-property">breakpoints</span>.<span class="hljs-title function_">up</span>(<span class="hljs-string">&#x27;md&#x27;</span>))
  <span class="hljs-keyword">const</span> rowsPerPageLabel = breakpointMd ? <span class="hljs-string">&#x27;Rows per page:&#x27;</span> : <span class="hljs-string">&#x27;Rows:&#x27;</span>

  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isEmpty</span>(rows)) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">descendingComparator</span>(<span class="hljs-params">a, b, orderBy</span>) {
    <span class="hljs-keyword">const</span> column = columns.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">d</span> =&gt;</span> d.<span class="hljs-property">field</span> === orderBy)[<span class="hljs-number">0</span>]
    <span class="hljs-keyword">if</span> (!a[orderBy] || !column?.<span class="hljs-property">dataSelector</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>
    <span class="hljs-keyword">const</span> aVal = a[orderBy] ? a[orderBy] : column?.<span class="hljs-title function_">dataSelector</span>(a)
    <span class="hljs-keyword">const</span> bVal = b[orderBy] ? b[orderBy] : column?.<span class="hljs-title function_">dataSelector</span>(b)

    <span class="hljs-keyword">if</span> (bVal &lt; aVal) <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>
    <span class="hljs-keyword">if</span> (bVal &gt; aVal) <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>
  }
  
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">getComparator</span>(<span class="hljs-params">order, orderBy</span>) {
    <span class="hljs-keyword">return</span> order === <span class="hljs-string">&#x27;desc&#x27;</span>
      ? <span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> <span class="hljs-title function_">descendingComparator</span>(a, b, orderBy)
      : <span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> -<span class="hljs-title function_">descendingComparator</span>(a, b, orderBy)
  }

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleRequestSort</span> = (<span class="hljs-params">event, property</span>) =&gt; {
    <span class="hljs-keyword">const</span> isAsc = orderBy === property &amp;&amp; order === <span class="hljs-string">&#x27;asc&#x27;</span>
    <span class="hljs-title function_">setOrder</span>(isAsc ? <span class="hljs-string">&#x27;desc&#x27;</span> : <span class="hljs-string">&#x27;asc&#x27;</span>)
    <span class="hljs-title function_">setOrderBy</span>(property)
  }

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleSelectAllClick</span> = event =&gt; {
    <span class="hljs-keyword">if</span> (event.<span class="hljs-property">target</span>.<span class="hljs-property">checked</span>) {
      <span class="hljs-keyword">const</span> newSelecteds = rows.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">n</span> =&gt;</span> n.<span class="hljs-property">name</span>)
      <span class="hljs-title function_">setSelected</span>(newSelecteds)
      <span class="hljs-keyword">return</span>
    }
    <span class="hljs-title function_">setSelected</span>([])
  }

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleChangePage</span> = (<span class="hljs-params">event, newPage</span>) =&gt; {
    <span class="hljs-title function_">setPage</span>(newPage)
  }

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleChangeRowsPerPage</span> = event =&gt; {
    <span class="hljs-title function_">setRowsPerPage</span>(<span class="hljs-built_in">parseInt</span>(event.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>, <span class="hljs-number">10</span>))
    <span class="hljs-title function_">setPage</span>(<span class="hljs-number">0</span>)
  }

  <span class="hljs-keyword">const</span> emptyRows = <span class="hljs-number">0</span>

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">MemoizedRow</span> = props =&gt; {
    <span class="hljs-keyword">const</span> cellStyles = props?.<span class="hljs-property">cellStyles</span>
    <span class="hljs-keyword">const</span> row = props?.<span class="hljs-property">row</span>
    <span class="hljs-keyword">const</span> columns = props?.<span class="hljs-property">columns</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title class_">MemoizedColumns</span> = <span class="hljs-title function_">useMemo</span>(
      <span class="hljs-function">() =&gt;</span> <span class="hljs-function"><span class="hljs-params">props</span> =&gt;</span>
        columns?.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">column</span> =&gt;</span> {
          <span class="hljs-keyword">let</span> displayValue = <span class="hljs-string">&#x27;&#x27;</span>
          <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> column.<span class="hljs-property">valueFormatter</span> === <span class="hljs-string">&#x27;function&#x27;</span>) {
            displayValue = column.<span class="hljs-title function_">valueFormatter</span>({ <span class="hljs-attr">value</span>: row[column.<span class="hljs-property">field</span>] })
          } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> column.<span class="hljs-property">renderCell</span> === <span class="hljs-string">&#x27;function&#x27;</span>) {
            displayValue = column.<span class="hljs-title function_">renderCell</span>({ row })
          } <span class="hljs-keyword">else</span> {
            displayValue = row[column.<span class="hljs-property">field</span>]
          }
          <span class="hljs-keyword">return</span> (
            <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">TableCell</span>
              <span class="hljs-attr">style</span>=<span class="hljs-string">{cellStyles}</span>
              <span class="hljs-attr">className</span>=<span class="hljs-string">{classes.tableCell}</span>
              <span class="hljs-attr">variant</span>=<span class="hljs-string">&#x27;body&#x27;</span>
              <span class="hljs-attr">component</span>=<span class="hljs-string">&#x27;th&#x27;</span>
              <span class="hljs-attr">scope</span>=<span class="hljs-string">&#x27;row&#x27;</span>
              <span class="hljs-attr">padding</span>=<span class="hljs-string">&#x27;none&#x27;</span>
              <span class="hljs-attr">key</span>=<span class="hljs-string">{column.field}</span>&gt;</span>
              {displayValue}
            <span class="hljs-tag">&lt;/<span class="hljs-name">TableCell</span>&gt;</span></span>
          )
        }),
      [columns, row, cellStyles]
    )

    <span class="hljs-keyword">return</span> (
      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">TableRow</span> <span class="hljs-attr">hover</span> <span class="hljs-attr">role</span>=<span class="hljs-string">&#x27;checkbox&#x27;</span> <span class="hljs-attr">tabIndex</span>=<span class="hljs-string">{-1}</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{row?.name}</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">MemoizedColumns</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">TableRow</span>&gt;</span></span>
    )
  }

  <span class="hljs-keyword">return</span> (
    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{classes.root}</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Paper</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{classes.paper}</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">TableContainer</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Table</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{classes.table}</span> <span class="hljs-attr">aria-labelledby</span>=<span class="hljs-string">&#x27;tableTitle&#x27;</span> <span class="hljs-attr">aria-label</span>=<span class="hljs-string">&#x27;enhanced table&#x27;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">TableHeader</span>
              <span class="hljs-attr">classes</span>=<span class="hljs-string">{classes}</span>
              <span class="hljs-attr">numSelected</span>=<span class="hljs-string">{selected.length}</span>
              <span class="hljs-attr">order</span>=<span class="hljs-string">{order}</span>
              <span class="hljs-attr">orderBy</span>=<span class="hljs-string">{orderBy}</span>
              <span class="hljs-attr">onSelectAllClick</span>=<span class="hljs-string">{handleSelectAllClick}</span>
              <span class="hljs-attr">onRequestSort</span>=<span class="hljs-string">{handleRequestSort}</span>
              <span class="hljs-attr">rowCount</span>=<span class="hljs-string">{rows.length</span> || <span class="hljs-attr">0</span>}
              <span class="hljs-attr">columns</span>=<span class="hljs-string">{props?.columns}</span>
            /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">TableBody</span>&gt;</span>
              {stableSort(rows, getComparator(order, orderBy))
                .slice(page * rowsPerPage, page * rowsPerPage + rowsPerPage)
                .map((row, index) =&gt; (
                  <span class="hljs-tag">&lt;<span class="hljs-name">MemoizedRow</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{index}</span> 
                    <span class="hljs-attr">row</span>=<span class="hljs-string">{row}</span> <span class="hljs-attr">columns</span>=<span class="hljs-string">{columns}</span> 
                    <span class="hljs-attr">cellStyles</span>=<span class="hljs-string">{props.cellStyles}/</span>&gt;</span>
                ))}
              {emptyRows &gt; 0 &amp;&amp; (
                <span class="hljs-tag">&lt;<span class="hljs-name">TableRow</span>&gt;</span>
                  <span class="hljs-tag">&lt;<span class="hljs-name">TableCell</span> /&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">TableRow</span>&gt;</span>
              )}
            <span class="hljs-tag">&lt;/<span class="hljs-name">TableBody</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">Table</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">TableContainer</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Paper</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Row</span> <span class="hljs-attr">justify</span>=<span class="hljs-string">&#x27;space-between&#x27;</span> <span class="hljs-attr">wrap</span>=<span class="hljs-string">&#x27;nowrap&#x27;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">About</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">TablePagination</span>
          <span class="hljs-attr">className</span>=<span class="hljs-string">{classes.tablePagination}</span>
          <span class="hljs-attr">classes</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">menuItem:</span> <span class="hljs-attr">classes.paginationOption</span> }}
          <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span>
            <span class="hljs-attr">backgroundColor:</span> <span class="hljs-attr">theme.palette.common.EGGPLANT</span>,
            <span class="hljs-attr">color:</span> <span class="hljs-attr">theme.palette.common.OFFWHITE</span>,
            &#x27;&amp; <span class="hljs-attr">svg</span>&#x27;<span class="hljs-attr">:</span> { <span class="hljs-attr">color:</span> <span class="hljs-attr">theme.palette.common.OFFWHITE</span> },
          }}
          <span class="hljs-attr">rowsPerPageOptions</span>=<span class="hljs-string">{[5,</span> <span class="hljs-attr">10</span>, <span class="hljs-attr">25</span>, <span class="hljs-attr">50</span>, <span class="hljs-attr">100</span>]}
          <span class="hljs-attr">labelRowsPerPage</span>=<span class="hljs-string">{rowsPerPageLabel}</span>
          <span class="hljs-attr">component</span>=<span class="hljs-string">&#x27;div&#x27;</span>
          <span class="hljs-attr">count</span>=<span class="hljs-string">{rows.length}</span>
          <span class="hljs-attr">rowsPerPage</span>=<span class="hljs-string">{rowsPerPage}</span>
          <span class="hljs-attr">page</span>=<span class="hljs-string">{page}</span>
          <span class="hljs-attr">onChangePage</span>=<span class="hljs-string">{handleChangePage}</span>
          <span class="hljs-attr">onChangeRowsPerPage</span>=<span class="hljs-string">{handleChangeRowsPerPage}</span>
        /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Row</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrccomponentsdatatabledatatable.js"><a href="#toc"><a name="ui-src-components-datatable-datatable-js">ui/src/components/DataTable/DataTable.js</a></a></h2>
<pre><code><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { forwardRef } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>
<span class="hljs-keyword">import</span> { v4 } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;uuid&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">PropTypes</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;prop-types&#x27;</span>
<span class="hljs-keyword">import</span> { useSelector } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-redux&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">AdornedTable</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./AdornedTable/AdornedTable&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">TableLoading</span>, <span class="hljs-title class_">Error</span>, <span class="hljs-title class_">TableNoData</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../NotAvailable&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Data</span>, { isNull, isEmpty, sliceJson, selected } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../Data/Data&#x27;</span>
<span class="hljs-keyword">export</span> { sliceJson, isNull, isEmpty, urlParam } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../Data/DataUtils&#x27;</span>

<span class="hljs-comment">/* 
  DataTable: an optionally data-enabled version of the StyledTable component
  props:
    columns[]: an object specifying column configuration (required at this time)
    select[]: an object with functions that select the location of row and column data with JSON data (optional in theory)
    rows[]: an array providing row data for the underlying grid component (optional)
    fetch[]: an object specifying data that needs to be fetched (optional)
    Note: either the fetch or rows prop must be provided
*/</span>

<span class="hljs-keyword">const</span> <span class="hljs-title class_">DataTable</span> = <span class="hljs-title function_">forwardRef</span>(<span class="hljs-function">(<span class="hljs-params">props, ref</span>) =&gt;</span> {

  <span class="hljs-keyword">const</span> firstFetchItem = props.<span class="hljs-property">fetch</span>?.[<span class="hljs-number">0</span>] ?? { <span class="hljs-attr">slice</span>: <span class="hljs-literal">null</span>, <span class="hljs-attr">url</span>: <span class="hljs-literal">null</span>, <span class="hljs-attr">select</span>: <span class="hljs-literal">null</span> }
  <span class="hljs-keyword">const</span> { slice, url } = firstFetchItem 
  <span class="hljs-keyword">const</span> json = <span class="hljs-title function_">useSelector</span>(<span class="hljs-title function_">sliceJson</span>(slice))
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isNull</span>(props)) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
  <span class="hljs-keyword">const</span> rows = props.<span class="hljs-property">rows</span> ?? []
  <span class="hljs-keyword">const</span> columns = props.<span class="hljs-property">columns</span> ?? []
  <span class="hljs-keyword">const</span> isDebugEnabled = props.<span class="hljs-property">isDebugEnabled</span> ?? <span class="hljs-literal">false</span>
  <span class="hljs-keyword">const</span> rowSelect = props.<span class="hljs-property">select</span>?.<span class="hljs-property">row</span>
  <span class="hljs-keyword">const</span> columnSelect = props.<span class="hljs-property">select</span>?.<span class="hljs-property">column</span>
  <span class="hljs-keyword">const</span> keyField = props.<span class="hljs-property">keyField</span> ?? <span class="hljs-literal">null</span>
  <span class="hljs-keyword">let</span> passDownRows = []
  <span class="hljs-keyword">let</span> passDownColumns = []
  <span class="hljs-keyword">let</span> passDownFetch = <span class="hljs-literal">null</span>  

  <span class="hljs-comment">/* Option 1: this component accepts rows and columns props and passes them to StyledTable */</span>
  <span class="hljs-comment">/* Option 2: this component accepts a fetch prop and passes fetch to Data and then the data to StyledTable when available */</span>
  <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">isEmpty</span>(rows) &amp;&amp; !<span class="hljs-title function_">isEmpty</span>(columns)) {

    <span class="hljs-keyword">if</span> (isDebugEnabled) <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">&#x27;%c DataTable: populating the table with data and columns props&#x27;</span>, <span class="hljs-string">&#x27;color: green&#x27;</span>)
    passDownRows = rows
    passDownColumns = columns
    passDownFetch = <span class="hljs-literal">null</span>
  }
  <span class="hljs-keyword">else</span> {
    
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isNull</span>(slice) || <span class="hljs-title function_">isNull</span>(url)) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;%c DataTable: either the rows property or fetch property must be valid&#x27;</span>)
    }

    <span class="hljs-keyword">const</span> isPreFetch = <span class="hljs-title function_">isEmpty</span>(json)
    <span class="hljs-keyword">if</span> (isPreFetch) {
      <span class="hljs-keyword">if</span> (isDebugEnabled) <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`%c Fetching slice &#x27;<span class="hljs-subst">${slice}</span>&#x27; from &#x27;<span class="hljs-subst">${url}</span>&#x27;`</span>, <span class="hljs-string">&#x27;color: green&#x27;</span>)
    }
    <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">if</span> (isDebugEnabled) <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">&#x27;%c Populating the table with fetched data&#x27;</span>, <span class="hljs-string">&#x27;color: green&#x27;</span>)

      <span class="hljs-comment">/* The data can be either an object or array in JSON */</span>
      <span class="hljs-keyword">let</span> rowDataJSON = <span class="hljs-title function_">selected</span>(json, rowSelect)

      <span class="hljs-comment">/* Determine row data to pass down to the grid component */</span>
      <span class="hljs-keyword">const</span> rowDataAsArray = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>([], rowDataJSON)
      passDownRows = rowDataAsArray
      
      <span class="hljs-comment">/* Determine column data to pass down to the grid component */</span>
      <span class="hljs-comment">/* <span class="hljs-doctag">TODO:</span> data-driven/auto-generated columns needs a bit more work and isn&#x27;t used at this time */</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isEmpty</span>(columns)) {
        <span class="hljs-comment">/* Data-Driven Columns */</span>
        <span class="hljs-keyword">const</span> columnDataJSON = <span class="hljs-title function_">selected</span>(json, columnSelect)
        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">isEmpty</span>(columnDataJSON)) {
          <span class="hljs-keyword">if</span> (isDebugEnabled) <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">&#x27;%c DataTable: using data-driven column definitions from JSON column data&#x27;</span>, <span class="hljs-string">&#x27;color: green&#x27;</span>)
          passDownColumns = columnDataJSON
        }
        <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">if</span> (isDebugEnabled) <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">&#x27;%c DataTable: using auto-generated column definitions extracted from JSON row data&#x27;</span>, <span class="hljs-string">&#x27;color: green&#x27;</span>)
          <span class="hljs-keyword">const</span> columns = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(rowDataAsArray[<span class="hljs-number">0</span>]).<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> ({ <span class="hljs-attr">field</span>: x, <span class="hljs-attr">headerName</span>: x}) )
          <span class="hljs-keyword">const</span> filteredColumns = !<span class="hljs-title function_">isEmpty</span>(columns) ? columns.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> columns.<span class="hljs-title function_">includes</span>(x.<span class="hljs-property">field</span>)) : columns
          passDownColumns = filteredColumns
        }

      }
      <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">/* Manually-Defined Columns */</span>
        <span class="hljs-keyword">if</span> (isDebugEnabled) <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">&#x27;%c DataTable: using manually-defined column definitions from props&#x27;</span>, <span class="hljs-string">&#x27;color: green&#x27;</span>)
        passDownColumns = columns
      }
    }

    passDownFetch = [firstFetchItem]
  }

  <span class="hljs-comment">/* Add an ID field as required by @material-ui/data-grid */</span>
  <span class="hljs-comment">/* Revisit if the API ends up returning an ID field */</span>
  <span class="hljs-comment">/* Add a key either based on the keyField prop or a randomly generated one (keyField prop is far preferred) */</span>
  passDownRows = passDownRows &amp;&amp; passDownRows.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">x,i</span>) =&gt;</span> ({ ...x, <span class="hljs-attr">id</span>: i, <span class="hljs-attr">key</span>: keyField ? x[keyField] : <span class="hljs-title function_">v4</span>()}))

  <span class="hljs-keyword">return</span> (
    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Data</span> {<span class="hljs-attr">...props</span>} <span class="hljs-attr">fetch</span>=<span class="hljs-string">{passDownFetch}</span> <span class="hljs-attr">isDebugEnabled</span>=<span class="hljs-string">{isDebugEnabled}</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Data.Pending</span> <span class="hljs-attr">component</span>=<span class="hljs-string">{TableLoading}</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Data.Rejected</span> <span class="hljs-attr">component</span>=<span class="hljs-string">{Error}</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Data.NoData</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">TableNoData</span> {<span class="hljs-attr">...props</span>} /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">Data.NoData</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Data.Timeout</span> <span class="hljs-attr">component</span>=<span class="hljs-string">{TableNoData}</span> <span class="hljs-attr">secondsToWait</span>=<span class="hljs-string">{10}</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Data.Fulfilled</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">AdornedTable</span>
          {<span class="hljs-attr">...props</span>}
          <span class="hljs-attr">className</span>=<span class="hljs-string">{props.className}</span>
          <span class="hljs-attr">columns</span>=<span class="hljs-string">{passDownColumns}</span>
          <span class="hljs-attr">rows</span>=<span class="hljs-string">{passDownRows}</span>
          <span class="hljs-attr">title</span>=<span class="hljs-string">{props.title}</span>
          <span class="hljs-attr">ref</span>=<span class="hljs-string">{ref}</span>
        /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Data.Fulfilled</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Data</span>&gt;</span></span>
  )

})

<span class="hljs-title class_">DataTable</span>.<span class="hljs-property">propTypes</span> = {
  <span class="hljs-attr">fetch</span>: <span class="hljs-title class_">PropTypes</span>.<span class="hljs-title function_">arrayOf</span>(<span class="hljs-title class_">PropTypes</span>.<span class="hljs-title function_">shape</span>({
    <span class="hljs-attr">slice</span>: <span class="hljs-title class_">PropTypes</span>.<span class="hljs-property">string</span>.<span class="hljs-property">isRequired</span>,
    <span class="hljs-attr">url</span>: <span class="hljs-title class_">PropTypes</span>.<span class="hljs-property">string</span>.<span class="hljs-property">isRequired</span>,
    <span class="hljs-attr">select</span>: <span class="hljs-title class_">PropTypes</span>.<span class="hljs-property">func</span>
  })),
  <span class="hljs-attr">rows</span>: <span class="hljs-title class_">PropTypes</span>.<span class="hljs-title function_">arrayOf</span>(<span class="hljs-title class_">PropTypes</span>.<span class="hljs-property">object</span>),
  <span class="hljs-attr">columns</span>: <span class="hljs-title class_">PropTypes</span>.<span class="hljs-property">array</span>,
  <span class="hljs-attr">select</span>: <span class="hljs-title class_">PropTypes</span>.<span class="hljs-title function_">objectOf</span>(<span class="hljs-title class_">PropTypes</span>.<span class="hljs-property">func</span>),
  <span class="hljs-attr">isDebugEnabled</span>: <span class="hljs-title class_">PropTypes</span>.<span class="hljs-property">bool</span>,
  <span class="hljs-attr">noDataMessage</span>: <span class="hljs-title class_">PropTypes</span>.<span class="hljs-property">string</span>,
  <span class="hljs-attr">aboutData</span>: <span class="hljs-title class_">PropTypes</span>.<span class="hljs-property">object</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">DataTable</span></pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrccomponentsevictionlist.js"><a href="#toc"><a name="ui-src-components-evictionlist-js">ui/src/components/EvictionList.js</a></a></h2>
<pre><code><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { memo } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>
<span class="hljs-keyword">import</span> { useSelector } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-redux&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Typography</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core&#x27;</span>
<span class="hljs-keyword">import</span> { isEmpty, isNull, sliceJson } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./Data/DataUtils&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">DataTable</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./DataTable/DataTable&#x27;</span>
<span class="hljs-keyword">import</span> { reformatDate, titleCase } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../utils/stringUtils&#x27;</span>
<span class="hljs-keyword">import</span> { renderParcelLink, renderOwnerLink } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../utils/tableUtils&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ExpandMoreIcon</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/icons/ExpandMore&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Accordion</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/Accordion&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">AccordionSummary</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/AccordionSummary&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">AccordionDetails</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/AccordionDetails&#x27;</span>
<span class="hljs-keyword">import</span> { useTranslation } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-i18next&#x27;</span>
<span class="hljs-keyword">import</span> i18n <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../i18n&#x27;</span>
<span class="hljs-keyword">import</span> { useTheme } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/styles&#x27;</span>
<span class="hljs-keyword">import</span> useStyles <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../theme/ListStyles&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Row</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../components/Grid&#x27;</span>

<span class="hljs-comment">/*
  EvictionList: render a table with a list of evictions
  props:
    title: 
    subTitle: 
    noDataMessage: 
    evictions: slice with the FULL LIST of evictions
*/</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">Evictionlist</span> = props =&gt; {

  <span class="hljs-comment">/* Data should contain owner and address URL links */</span>
  <span class="hljs-keyword">const</span> evictions = <span class="hljs-title function_">useSelector</span>(<span class="hljs-title function_">sliceJson</span>(props.<span class="hljs-property">evictionSlice</span>))
  <span class="hljs-keyword">const</span> title = props.<span class="hljs-property">title</span>
  <span class="hljs-keyword">const</span> subTitle = props.<span class="hljs-property">subTitle</span>
  <span class="hljs-keyword">const</span> noDataMessage = props.<span class="hljs-property">noDataMessage</span>
  <span class="hljs-keyword">const</span> theme = <span class="hljs-title function_">useTheme</span>()
  <span class="hljs-keyword">const</span> classes = <span class="hljs-title function_">useStyles</span>(theme)

  <span class="hljs-keyword">const</span> { t, <span class="hljs-attr">ready</span>: translationReady } = <span class="hljs-title function_">useTranslation</span>(
    <span class="hljs-string">&#x27;Evictions&#x27;</span>, <span class="hljs-comment">/* i18next-parser needs string here */</span>
    { <span class="hljs-attr">useSuspense</span>: <span class="hljs-literal">false</span>, i18n }
  )

  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isEmpty</span>(evictions)) {
    <span class="hljs-keyword">return</span> (
      <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Typography</span> <span class="hljs-attr">variant</span>=<span class="hljs-string">&#x27;h2&#x27;</span>&gt;</span>
          {typeof title === &#x27;string&#x27; &amp;&amp; title.length &gt; 0 &amp;&amp; title}
        <span class="hljs-tag">&lt;/<span class="hljs-name">Typography</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Typography</span> <span class="hljs-attr">variant</span>=<span class="hljs-string">&#x27;body1&#x27;</span>&gt;</span>{noDataMessage}<span class="hljs-tag">&lt;/<span class="hljs-name">Typography</span>&gt;</span>
      <span class="hljs-tag">&lt;/&gt;</span></span>
    )
  }

  <span class="hljs-keyword">if</span> (!translationReady) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">AttributedEvictor</span> = props =&gt; {

    <span class="hljs-keyword">const</span> primaryEvictorName = props?.<span class="hljs-property">primaryEvictorName</span>
    <span class="hljs-keyword">const</span> primaryEvictorType = props?.<span class="hljs-property">primaryEvictorType</span>
    <span class="hljs-keyword">const</span> secondaryEvictors = props?.<span class="hljs-property">secondaryEvictors</span>

    <span class="hljs-keyword">return</span> (
      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Accordion</span>
        <span class="hljs-attr">className</span>=<span class="hljs-string">{classes.accordionInTable}</span>
        <span class="hljs-attr">elevation</span>=<span class="hljs-string">{0}</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">AccordionSummary</span>
          <span class="hljs-attr">className</span>=<span class="hljs-string">{classes.accordionSummary}</span>
          <span class="hljs-attr">expandIcon</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">ExpandMoreIcon</span> /&gt;</span>}
          aria-controls=&quot;panel1a-content&quot;
          id=&quot;panel1a-header&quot;
        &gt;
          <span class="hljs-tag">&lt;<span class="hljs-name">Typography</span> <span class="hljs-attr">variant</span>=<span class="hljs-string">&#x27;body2&#x27;</span>&gt;</span>
            {renderOwnerLink(primaryEvictorName, primaryEvictorType)}
            {!isNull(primaryEvictorName) &amp;&amp; secondaryEvictors.length &gt; 0 &amp;&amp;
            <span class="hljs-tag">&lt;&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>
              {t(&#x27;(and&#x27;)}<span class="hljs-symbol">&amp;nbsp;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>{secondaryEvictors.length}<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span>
              <span class="hljs-symbol">&amp;nbsp;</span>{t(&#x27;more)&#x27;)}
            <span class="hljs-tag">&lt;/&gt;</span>
            }
          <span class="hljs-tag">&lt;/<span class="hljs-name">Typography</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">AccordionSummary</span>&gt;</span></span>
        <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">AccordionDetails</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span>
          <span class="hljs-attr">display:</span> &#x27;<span class="hljs-attr">flex</span>&#x27;,
          <span class="hljs-attr">flexDirection:</span> &#x27;<span class="hljs-attr">column</span>&#x27;,
          <span class="hljs-attr">flexWrap:</span> &#x27;<span class="hljs-attr">wrap</span>&#x27;,
          <span class="hljs-attr">whiteSpace:</span> &#x27;<span class="hljs-attr">normal</span>&#x27;
        }}&gt;</span>
          {secondaryEvictors?.map(evictor =&gt;
            <span class="hljs-tag">&lt;<span class="hljs-name">Row</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{evictor}</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">Typography</span> <span class="hljs-attr">variant</span>=<span class="hljs-string">&#x27;body2&#x27;</span>&gt;</span>{titleCase(evictor)}<span class="hljs-tag">&lt;/<span class="hljs-name">Typography</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">Row</span>&gt;</span>
          )}
        <span class="hljs-tag">&lt;/<span class="hljs-name">AccordionDetails</span>&gt;</span></span>
      &lt;/<span class="hljs-title class_">Accordion</span>&gt;
    )
  }

  <span class="hljs-comment">/* Count occurences of the data for each column */</span>
  <span class="hljs-keyword">const</span> countAddr = evictions.<span class="hljs-title function_">filter</span>(
    <span class="hljs-function"><span class="hljs-params">row</span> =&gt;</span> <span class="hljs-keyword">typeof</span> row.<span class="hljs-property">addr</span> !== <span class="hljs-string">&#x27;undefined&#x27;</span> ||
    <span class="hljs-keyword">typeof</span> row.<span class="hljs-property">location</span>?.<span class="hljs-property">addr</span> !== <span class="hljs-string">&#x27;undefined&#x27;</span> ||
    <span class="hljs-keyword">typeof</span> row.<span class="hljs-property">evict_addr_orig</span> !== <span class="hljs-string">&#x27;undefined&#x27;</span>
  ).<span class="hljs-property">length</span>
  <span class="hljs-keyword">const</span> primaryEvictors = evictions.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">row</span> =&gt;</span>
    <span class="hljs-keyword">typeof</span> row.<span class="hljs-property">primary_evictor</span>?.<span class="hljs-property">name</span> === <span class="hljs-string">&#x27;string&#x27;</span>)
  <span class="hljs-keyword">const</span> countEvictors = primaryEvictors.<span class="hljs-property">length</span>
  <span class="hljs-keyword">const</span> countType = evictions.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">row</span> =&gt;</span> <span class="hljs-keyword">typeof</span> row.<span class="hljs-property">type</span> === <span class="hljs-string">&#x27;string&#x27;</span>).<span class="hljs-property">length</span>
  <span class="hljs-keyword">const</span> countNumOtherParc =
    evictions.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">row</span> =&gt;</span> (<span class="hljs-keyword">typeof</span> row.<span class="hljs-property">num_other_parc</span> === <span class="hljs-string">&#x27;number&#x27;</span> &amp;&amp;
      row.<span class="hljs-property">num_other_parc</span> &gt; <span class="hljs-number">0</span>) ||
      (<span class="hljs-keyword">typeof</span> row.<span class="hljs-property">location</span>?.<span class="hljs-property">num_other_parc</span> === <span class="hljs-string">&#x27;number&#x27;</span> &amp;&amp;
      row.<span class="hljs-property">location</span>?.<span class="hljs-property">num_other_parc</span> &gt; <span class="hljs-number">0</span>)).<span class="hljs-property">length</span>

  <span class="hljs-comment">/* Display columns with at least one data item */</span>
  <span class="hljs-keyword">const</span> columns = []

  columns.<span class="hljs-title function_">push</span>({
    <span class="hljs-attr">field</span>: <span class="hljs-string">&#x27;evict_date&#x27;</span>,
    <span class="hljs-attr">headerName</span>: <span class="hljs-string">&#x27;Date&#x27;</span>,
    <span class="hljs-attr">flex</span>: <span class="hljs-number">1.5</span>,
    <span class="hljs-attr">valueFormatter</span>: <span class="hljs-function"><span class="hljs-params">p</span> =&gt;</span> <span class="hljs-title function_">reformatDate</span>(p.<span class="hljs-property">value</span>, <span class="hljs-literal">true</span>)
  })

  countAddr &gt; <span class="hljs-number">0</span> &amp;&amp; columns.<span class="hljs-title function_">push</span>({
    <span class="hljs-attr">field</span>: <span class="hljs-string">&#x27;addr&#x27;</span>,
    <span class="hljs-attr">headerName</span>: <span class="hljs-string">&#x27;Address&#x27;</span>,
    <span class="hljs-attr">flex</span>: <span class="hljs-number">2</span>,
    <span class="hljs-attr">renderCell</span>: <span class="hljs-function"><span class="hljs-params">p</span> =&gt;</span> <span class="hljs-title function_">renderParcelLink</span>(
      p.<span class="hljs-property">row</span>.<span class="hljs-property">block_lot</span> || p.<span class="hljs-property">row</span>.<span class="hljs-property">location</span>?.<span class="hljs-property">block_lot</span>,
      <span class="hljs-title function_">titleCase</span>(p.<span class="hljs-property">row</span>.<span class="hljs-property">addr</span> || p.<span class="hljs-property">row</span>.<span class="hljs-property">location</span>?.<span class="hljs-property">addr</span> || p.<span class="hljs-property">row</span>.<span class="hljs-property">evict_addr_orig</span>)
    ),
    <span class="hljs-attr">dataSelector</span>: <span class="hljs-function"><span class="hljs-params">d</span> =&gt;</span> d.<span class="hljs-property">addr</span> || d.<span class="hljs-property">location</span>?.<span class="hljs-property">addr</span> || d.<span class="hljs-property">evict_addr_orig</span>
  })

  countEvictors &gt; <span class="hljs-number">0</span> &amp;&amp; columns.<span class="hljs-title function_">push</span>({
    <span class="hljs-attr">field</span>: <span class="hljs-string">&#x27;evictor_name&#x27;</span>,
    <span class="hljs-attr">headerName</span>: <span class="hljs-string">&#x27;Attributed Evictor(s)&#x27;</span>,
    <span class="hljs-attr">flex</span>: <span class="hljs-number">3</span>,
    <span class="hljs-attr">renderCell</span>: <span class="hljs-function"><span class="hljs-params">p</span> =&gt;</span> {
      <span class="hljs-keyword">const</span> primaryEvictorName = p.<span class="hljs-property">row</span>.<span class="hljs-property">primary_evictor</span>?.<span class="hljs-property">name</span>
      <span class="hljs-keyword">const</span> primaryEvictorType = p.<span class="hljs-property">row</span>.<span class="hljs-property">primary_evictor</span>?.<span class="hljs-property">linked_be</span>?.<span class="hljs-property">__typename</span>
      <span class="hljs-keyword">const</span> secondaryEvictors = <span class="hljs-title function_">isEmpty</span>(p.<span class="hljs-property">row</span>.<span class="hljs-property">extra_evictors</span>)
        ? []
        : p.<span class="hljs-property">row</span>.<span class="hljs-property">extra_evictors</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> <span class="hljs-title function_">renderOwnerLink</span>(e.<span class="hljs-property">evictor_name</span>, e.<span class="hljs-property">evictor_type</span>))

      <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isNull</span>(primaryEvictorName)) <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Unknown&#x27;</span>

      <span class="hljs-keyword">return</span> (
        <span class="hljs-title function_">isEmpty</span>(secondaryEvictors)
          ? <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Typography</span> <span class="hljs-attr">variant</span>=<span class="hljs-string">&#x27;body2&#x27;</span>&gt;</span>
            {renderOwnerLink(primaryEvictorName, primaryEvictorType)}
          <span class="hljs-tag">&lt;/<span class="hljs-name">Typography</span>&gt;</span></span>
          : <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">AttributedEvictor</span>
            <span class="hljs-attr">primaryEvictorName</span>=<span class="hljs-string">{primaryEvictorName}</span>
            <span class="hljs-attr">primaryEvictorType</span>=<span class="hljs-string">{primaryEvictorType}</span>
            <span class="hljs-attr">secondaryEvictors</span>=<span class="hljs-string">{secondaryEvictors}</span>
          /&gt;</span></span>
      )
    },
    <span class="hljs-attr">dataSelector</span>: <span class="hljs-function"><span class="hljs-params">d</span> =&gt;</span> d.<span class="hljs-property">primary_evictor</span>?.<span class="hljs-property">name</span>       
  })

  countType &gt; <span class="hljs-number">0</span> &amp;&amp;
    columns.<span class="hljs-title function_">push</span>({
      <span class="hljs-attr">field</span>: <span class="hljs-string">&#x27;type&#x27;</span>,
      <span class="hljs-attr">headerName</span>: <span class="hljs-string">&#x27;Eviction Type&#x27;</span>,
      <span class="hljs-attr">flex</span>: <span class="hljs-number">1.5</span>,
      <span class="hljs-attr">valueFormatter</span>: <span class="hljs-function"><span class="hljs-params">p</span> =&gt;</span> (p.<span class="hljs-property">value</span> ? p.<span class="hljs-property">value</span> : <span class="hljs-string">&#x27;Unknown&#x27;</span>),
      <span class="hljs-attr">dataSelector</span>: <span class="hljs-function"><span class="hljs-params">d</span> =&gt;</span> d.<span class="hljs-property">type</span>,
    })

  countNumOtherParc &gt; <span class="hljs-number">0</span> &amp;&amp;
    columns.<span class="hljs-title function_">push</span>({
      <span class="hljs-attr">field</span>: <span class="hljs-string">&#x27;notes&#x27;</span>,
      <span class="hljs-attr">headerName</span>: <span class="hljs-string">&#x27;Notes&#x27;</span>,
      <span class="hljs-attr">flex</span>: <span class="hljs-number">2</span>,
      <span class="hljs-attr">renderCell</span>: <span class="hljs-function"><span class="hljs-params">p</span> =&gt;</span> {
        <span class="hljs-keyword">const</span> numAdditionalParc =
          (p.<span class="hljs-property">row</span>.<span class="hljs-property">num_other_parc</span> || <span class="hljs-number">0</span>) + (p.<span class="hljs-property">row</span>.<span class="hljs-property">location</span>?.<span class="hljs-property">num_other_parc</span> || <span class="hljs-number">0</span>)
        <span class="hljs-keyword">if</span> (numAdditionalParc &lt;= <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>
        <span class="hljs-keyword">return</span> (
          <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Typography</span> <span class="hljs-attr">variant</span>=<span class="hljs-string">&#x27;body2&#x27;</span>&gt;</span>
            {t(&#x27;This eviction matches with {{count}} other parcels.&#x27;, {
              count: numAdditionalParc,
            })}
          <span class="hljs-tag">&lt;/<span class="hljs-name">Typography</span>&gt;</span></span>
        )
      },
    })

  <span class="hljs-keyword">return</span> (
    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Typography</span> <span class="hljs-attr">variant</span>=<span class="hljs-string">&#x27;h2&#x27;</span>&gt;</span>
        {typeof title === &#x27;string&#x27; &amp;&amp; title.length &gt; 0 &amp;&amp; title}
      <span class="hljs-tag">&lt;/<span class="hljs-name">Typography</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Typography</span> <span class="hljs-attr">variant</span>=<span class="hljs-string">&#x27;body1&#x27;</span>&gt;</span>
        {subTitle !== null &amp;&amp; subTitle}
      <span class="hljs-tag">&lt;/<span class="hljs-name">Typography</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">DataTable</span>
        <span class="hljs-attr">sortModel</span>=<span class="hljs-string">{[{</span> <span class="hljs-attr">field:</span> &#x27;<span class="hljs-attr">evict_date</span>&#x27;, <span class="hljs-attr">sort:</span> &#x27;<span class="hljs-attr">desc</span>&#x27; }]}
        <span class="hljs-attr">sortingOrder</span>=<span class="hljs-string">{[</span>&#x27;<span class="hljs-attr">desc</span>&#x27;, &#x27;<span class="hljs-attr">asc</span>&#x27;, <span class="hljs-attr">null</span>]}
        <span class="hljs-attr">name</span>=<span class="hljs-string">&#x27;evictions&#x27;</span>
        {<span class="hljs-attr">...props</span>}
        <span class="hljs-attr">rows</span>=<span class="hljs-string">{evictions}</span>
        <span class="hljs-attr">columns</span>=<span class="hljs-string">{columns}</span>
      /&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span></span>
  )

}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">memo</span>(<span class="hljs-title class_">Evictionlist</span>)</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrccomponentsfeedbackiframe.js"><a href="#toc"><a name="ui-src-components-feedbackiframe-js">ui/src/components/FeedbackIFrame.js</a></a></h2>
<pre><code><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Row</span>, <span class="hljs-title class_">Col</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./Grid&#x27;</span>
<span class="hljs-keyword">import</span> { makeStyles } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/styles&#x27;</span>
<span class="hljs-keyword">import</span> { useMediaQuery } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-responsive&#x27;</span>

<span class="hljs-keyword">const</span> iframeURL = <span class="hljs-string">&#x27;https://docs.google.com/forms/d/e/1FAIpQLSfm5EOxtftVfabB3mBln9pja61xyiHgfpskcjhs_hlejEnLuA/viewform?embedded=true&#x27;</span>

<span class="hljs-keyword">const</span> useStyles = <span class="hljs-title function_">makeStyles</span>(<span class="hljs-function"><span class="hljs-params">theme</span> =&gt;</span> ({
  <span class="hljs-attr">linkStyle</span>: {
    <span class="hljs-attr">color</span>: <span class="hljs-string">&#x27;#ff7f50&#x27;</span>, 
    <span class="hljs-attr">cursor</span>: <span class="hljs-string">&#x27;pointer&#x27;</span>, 
    <span class="hljs-attr">textDecoration</span>: <span class="hljs-string">&#x27;underline&#x27;</span>, 
    <span class="hljs-attr">paddingTop</span>: <span class="hljs-string">&#x27;3em&#x27;</span>, 
    <span class="hljs-attr">fontSize</span>: <span class="hljs-string">&#x27;1em&#x27;</span> 
  },
  <span class="hljs-attr">column</span>: {
    <span class="hljs-attr">height</span>: <span class="hljs-number">850</span>, 
    <span class="hljs-attr">backgroundColor</span>: 
    theme.<span class="hljs-property">palette</span>.<span class="hljs-property">common</span>.<span class="hljs-property">eggplant</span>, 
    <span class="hljs-attr">color</span>: <span class="hljs-string">&#x27;white&#x27;</span>, 
    <span class="hljs-attr">marginTop</span>: <span class="hljs-string">&#x27;1em&#x27;</span>
  }
}))

<span class="hljs-keyword">const</span> <span class="hljs-title function_">FeedbackIFrame</span> = (<span class="hljs-params"></span>) =&gt; {

  <span class="hljs-keyword">const</span> classes = <span class="hljs-title function_">useStyles</span>()
  <span class="hljs-keyword">const</span> [showForm, setShowForm] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>)

  <span class="hljs-keyword">const</span> isSmallDisplay = <span class="hljs-title function_">useMediaQuery</span>( { <span class="hljs-attr">query</span>: <span class="hljs-string">&#x27;(max-width: 480px)&#x27;</span> } )

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">toggleForm</span> = (<span class="hljs-params"></span>) =&gt; {
    <span class="hljs-title function_">setShowForm</span>(!showForm)
  }

  <span class="hljs-keyword">if</span> (!showForm) { 
    <span class="hljs-keyword">return</span> (
      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{classes.linkStyle}</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{toggleForm}</span>&gt;</span>
        See something wrong? 
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    )
  }

  <span class="hljs-keyword">return</span> (
    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Col</span> <span class="hljs-attr">justify</span>=<span class="hljs-string">&quot;center&quot;</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Row</span> <span class="hljs-attr">justify</span>=<span class="hljs-string">&quot;center&quot;</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{classes.linkStyle}</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{toggleForm}</span>&gt;</span>
          {showForm &amp;&amp; &#x27;Close feedback form&#x27;}
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  
      <span class="hljs-tag">&lt;/<span class="hljs-name">Row</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Row</span> <span class="hljs-attr">justify</span>=<span class="hljs-string">&quot;center&quot;</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{classes.column}</span> 
        <span class="hljs-attr">style</span>=<span class="hljs-string">{{width:</span> <span class="hljs-attr">isSmallDisplay</span> ? &#x27;<span class="hljs-attr">320px</span>&#x27; <span class="hljs-attr">:</span> &#x27;<span class="hljs-attr">425px</span>&#x27; }}&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">iframe</span> <span class="hljs-attr">src</span>=<span class="hljs-string">{iframeURL}</span> 
          <span class="hljs-attr">width</span>=<span class="hljs-string">&#x27;100%&#x27;</span>
          <span class="hljs-attr">height</span>=<span class="hljs-string">&#x27;100%&#x27;</span> 
          <span class="hljs-attr">frameBorder</span>=<span class="hljs-string">&quot;0&quot;</span> 
          <span class="hljs-attr">marginHeight</span>=<span class="hljs-string">&quot;0&quot;</span> 
          <span class="hljs-attr">marginWidth</span>=<span class="hljs-string">&quot;0&quot;</span>
          <span class="hljs-attr">overflowy</span>=<span class="hljs-string">&#x27;hidden&#x27;</span>
          <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;feedback form&quot;</span>
        &gt;</span>Loading…
        <span class="hljs-tag">&lt;/<span class="hljs-name">iframe</span>&gt;</span>

      <span class="hljs-tag">&lt;/<span class="hljs-name">Row</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Col</span>&gt;</span></span>
  )
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">Feedback</span>IFrame</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrccomponentsfooter.js"><a href="#toc"><a name="ui-src-components-footer-js">ui/src/components/Footer.js</a></a></h2>
<pre><code><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Link</span>, <span class="hljs-title class_">NavLink</span>, useLocation } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-router-dom&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Row</span>, <span class="hljs-title class_">Col</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./Grid&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Feedback</span>IFrame <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./FeedbackIFrame&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">BottomNavigation</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/BottomNavigation&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">BottomNavigationAction</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/BottomNavigationAction&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">FontAwesomeIcon</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@fortawesome/react-fontawesome&#x27;</span>
<span class="hljs-keyword">import</span> { faBezierCurve, faBalanceScale } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@fortawesome/free-solid-svg-icons&#x27;</span> <span class="hljs-comment">// methodology, SFADC</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">MenuBookIcon</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/icons/MenuBook&#x27;</span> <span class="hljs-comment">// glossary</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">InsertCommentIcon</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/icons/InsertComment&#x27;</span> <span class="hljs-comment">// feedback</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">InfoIcon</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/icons/Info&#x27;</span> <span class="hljs-comment">// disclaimer</span>
<span class="hljs-keyword">import</span> useStyles <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../theme/FooterStyles&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Typography</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/Typography&#x27;</span>
<span class="hljs-keyword">import</span> useMediaQuery <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/useMediaQuery&#x27;</span>
<span class="hljs-keyword">import</span> { useTranslation } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-i18next&#x27;</span>
<span class="hljs-keyword">import</span> i18n <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../i18n&#x27;</span>
<span class="hljs-keyword">import</span> { useTheme } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/styles&#x27;</span>

<span class="hljs-comment">/* conditionally renders either a mobile footer, or a footer for larger viewports */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Footer</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">const</span> location = <span class="hljs-title function_">useLocation</span>()
  <span class="hljs-keyword">const</span> theme = <span class="hljs-title function_">useTheme</span>()
  <span class="hljs-keyword">const</span> classes = <span class="hljs-title function_">useStyles</span>(theme)
  <span class="hljs-keyword">const</span> { t, <span class="hljs-attr">ready</span>: translationReady } = <span class="hljs-title function_">useTranslation</span>(
    <span class="hljs-string">&#x27;Footer&#x27;</span> <span class="hljs-comment">/* i18next-parser needs string here */</span>,
    { <span class="hljs-attr">useSuspense</span>: <span class="hljs-literal">false</span>, i18n }
  )

  <span class="hljs-comment">// MUI media query hook</span>
  <span class="hljs-keyword">const</span> isSmallDisplay = <span class="hljs-title function_">useMediaQuery</span>(<span class="hljs-string">&#x27;(max-width: 900px&#x27;</span>)

  <span class="hljs-keyword">if</span> (!translationReady) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>

  <span class="hljs-keyword">if</span> (isSmallDisplay) {
    <span class="hljs-keyword">return</span> (
      <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span>
        {location.pathname !== &#x27;/&#x27; &amp;&amp; (
          <span class="hljs-tag">&lt;<span class="hljs-name">Row</span> <span class="hljs-attr">justify</span>=<span class="hljs-string">&#x27;center&#x27;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">FeedbackIFrame</span> /&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">Row</span>&gt;</span>
        )}

        <span class="hljs-tag">&lt;<span class="hljs-name">BottomNavigation</span>
          <span class="hljs-attr">showLabels</span>
          <span class="hljs-attr">className</span>=<span class="hljs-string">{classes.rootMobile}</span>
          <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">marginTop:</span> <span class="hljs-attr">location.pathname</span> === <span class="hljs-string">&#x27;/&#x27;</span> ? <span class="hljs-attr">0</span> <span class="hljs-attr">:</span> <span class="hljs-attr">45</span> }}&gt;</span>

          <span class="hljs-tag">&lt;<span class="hljs-name">BottomNavigationAction</span>
            <span class="hljs-attr">label</span>=<span class="hljs-string">{t(</span>&#x27;<span class="hljs-attr">Tenant</span> <span class="hljs-attr">Resources</span>&#x27;)}
            <span class="hljs-attr">icon</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">FontAwesomeIcon</span> <span class="hljs-attr">icon</span>=<span class="hljs-string">{faBalanceScale}</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&#x27;lg&#x27;</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;fa-icon&#x27;</span> /&gt;</span>}
            className=&#x27;footerItem&#x27;
            component={Link}
            to={{ pathname: &#x27;http://sfadc.org&#x27; }}
            target=&#x27;_blank&#x27;
          /&gt;

          <span class="hljs-tag">&lt;<span class="hljs-name">BottomNavigationAction</span>
            <span class="hljs-attr">label</span>=<span class="hljs-string">{t(</span>&#x27;<span class="hljs-attr">Glossary</span>&#x27;)}
            <span class="hljs-attr">icon</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">MenuBookIcon</span> /&gt;</span>}
            className=&#x27;footerItem&#x27;
            component={NavLink}
            to=&#x27;/glossary&#x27;
          /&gt;

          <span class="hljs-tag">&lt;<span class="hljs-name">BottomNavigationAction</span>
            <span class="hljs-attr">label</span>=<span class="hljs-string">{t(</span>&#x27;<span class="hljs-attr">Methodology</span>&#x27;)}
            <span class="hljs-attr">icon</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">FontAwesomeIcon</span> <span class="hljs-attr">icon</span>=<span class="hljs-string">{faBezierCurve}</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&#x27;lg&#x27;</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;fa-icon&#x27;</span> /&gt;</span>}
            className=&#x27;footerItem&#x27;
            component={NavLink}
            to=&#x27;/methodology&#x27;
          /&gt;

          <span class="hljs-tag">&lt;<span class="hljs-name">BottomNavigationAction</span>
            <span class="hljs-attr">label</span>=<span class="hljs-string">{t(</span>&#x27;<span class="hljs-attr">Feedback</span>&#x27;)}
            <span class="hljs-attr">icon</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">InsertCommentIcon</span> /&gt;</span>}
            className=&#x27;footerItem&#x27;
            target=&#x27;_blank&#x27;
            component={NavLink}
            to=&#x27;/feedback&#x27;
          /&gt;

          <span class="hljs-tag">&lt;<span class="hljs-name">BottomNavigationAction</span>
            <span class="hljs-attr">label</span>=<span class="hljs-string">{t(</span>&#x27;<span class="hljs-attr">Disclaimer</span>&#x27;)}
            <span class="hljs-attr">icon</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">InfoIcon</span> /&gt;</span>}
            className=&#x27;footerItem&#x27;
            component={NavLink}
            to=&#x27;/disclaimer&#x27;
          /&gt;
        <span class="hljs-tag">&lt;/<span class="hljs-name">BottomNavigation</span>&gt;</span>
      <span class="hljs-tag">&lt;/&gt;</span></span>
    )
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span> (
      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Row</span>&gt;</span>
        {location.pathname !== &#x27;/&#x27; &amp;&amp; (
          <span class="hljs-tag">&lt;<span class="hljs-name">Row</span> <span class="hljs-attr">justify</span>=<span class="hljs-string">&#x27;center&#x27;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">FeedbackIFrame</span> /&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">Row</span>&gt;</span>
        )}

        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{classes.root}</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">marginTop:</span> <span class="hljs-attr">location.pathname</span> === <span class="hljs-string">&#x27;/&#x27;</span> ? <span class="hljs-attr">0</span> <span class="hljs-attr">:</span> <span class="hljs-attr">55</span>}}&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Col</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{classes.footerText}</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Typography</span> <span class="hljs-attr">variant</span>=<span class="hljs-string">&#x27;body1&#x27;</span>&gt;</span>
              {t(
                &#x27;EvictorBook combines data on property ownership, eviction records, and corporate business filings to identify connections between residential property and their owners in San Francisco.&#x27;
              )}
            <span class="hljs-tag">&lt;/<span class="hljs-name">Typography</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">Col</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Col</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{classes.footerText}</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{justifyContent:</span> &#x27;<span class="hljs-attr">flex-end</span>&#x27;}}&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Row</span> <span class="hljs-attr">direction</span>=<span class="hljs-string">&#x27;column&#x27;</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{classes.links}</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">NavLink</span> <span class="hljs-attr">to</span>=<span class="hljs-string">&#x27;/feedback&#x27;</span> <span class="hljs-attr">target</span>=<span class="hljs-string">&#x27;_blank&#x27;</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{classes.item}</span>&gt;</span>
                {t(&#x27;Feedback&#x27;)}
              <span class="hljs-tag">&lt;/<span class="hljs-name">NavLink</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">NavLink</span> <span class="hljs-attr">to</span>=<span class="hljs-string">&#x27;/glossary&#x27;</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{classes.item}</span>&gt;</span>
                {t(&#x27;Glossary&#x27;)}
              <span class="hljs-tag">&lt;/<span class="hljs-name">NavLink</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">NavLink</span> <span class="hljs-attr">to</span>=<span class="hljs-string">&#x27;/methodology&#x27;</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{classes.item}</span>&gt;</span>
                {t(&#x27;Methodology&#x27;)}
              <span class="hljs-tag">&lt;/<span class="hljs-name">NavLink</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">NavLink</span> <span class="hljs-attr">to</span>=<span class="hljs-string">&#x27;/disclaimer&#x27;</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{classes.item}</span>&gt;</span>
                {t(&#x27;Disclaimer&#x27;)}
              <span class="hljs-tag">&lt;/<span class="hljs-name">NavLink</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">pathname:</span> &#x27;<span class="hljs-attr">http:</span>//<span class="hljs-attr">sfadc.org</span>&#x27; }} <span class="hljs-attr">target</span>=<span class="hljs-string">&#x27;_blank&#x27;</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{classes.item}</span> &gt;</span>
                {t(&#x27;Tenant Resources&#x27;)}
              <span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">Row</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">Col</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Row</span>&gt;</span></span>
    )
  }
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrccomponentsgraphd3graph.js"><a href="#toc"><a name="ui-src-components-graph-d3graph-js">ui/src/components/Graph/D3Graph.js</a></a></h2>
<pre><code><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useEffect, useState, <span class="hljs-title class_">Fragment</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>
<span class="hljs-keyword">import</span> { get_view_network } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./graphProcessor&#x27;</span>
<span class="hljs-keyword">import</span> drawGraph <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./draw_graph&#x27;</span>
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> d3 <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;d3&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Row</span>, <span class="hljs-title class_">Col</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./../Grid&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Typography</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/Typography&#x27;</span>
<span class="hljs-keyword">import</span> { useTranslation } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-i18next&#x27;</span>
<span class="hljs-keyword">import</span> i18n <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../i18n&#x27;</span>
<span class="hljs-keyword">import</span>  <span class="hljs-title class_">CircularProgress</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/CircularProgress&#x27;</span>

<span class="hljs-comment">/* D3Graph: This component renders a network graph of properties and owners. 

Props: 
width, height: width and height of the graph svg element. 
graph: The graph data that is fetched and passed by pages/NetworkPage.js into here.
*/</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">D3Graph</span> = (<span class="hljs-params">{graph}</span>) =&gt; {

  <span class="hljs-keyword">const</span> [sizeFilter, setSizeFilter] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">50</span>)
  <span class="hljs-keyword">const</span> [labelFilter, setLabelFilter] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;All&#x27;</span>)
  <span class="hljs-keyword">const</span> network = <span class="hljs-title function_">get_view_network</span>(graph, sizeFilter, <span class="hljs-number">6</span>)

  <span class="hljs-keyword">const</span> { t, <span class="hljs-attr">ready</span>: translationReady } = <span class="hljs-title function_">useTranslation</span>(
    <span class="hljs-string">&#x27;Network&#x27;</span>, <span class="hljs-comment">/* i18next-parser needs string here */</span>
    { <span class="hljs-attr">useSuspense</span>: <span class="hljs-literal">false</span>, i18n }
  )

  <span class="hljs-comment">/* This array replaces NODE_COLOR in draw_graph.js for readability + DRY principle */</span> 
  <span class="hljs-comment">/* info here is read into both the legend and the actual node colors in draw_graph */</span>
  <span class="hljs-keyword">const</span> nodeColors = [
    {<span class="hljs-attr">code</span>: [<span class="hljs-string">&#x27;SOS_LP&#x27;</span>, <span class="hljs-string">&#x27;SOS_Corp&#x27;</span>], <span class="hljs-attr">label</span>:<span class="hljs-title function_">t</span>(<span class="hljs-string">&#x27;Business Entity (e.g. LLC)&#x27;</span>),  <span class="hljs-attr">color</span>: <span class="hljs-string">&#x27;#e7298a&#x27;</span>},
    {<span class="hljs-attr">code</span>: [<span class="hljs-string">&#x27;SOS_Owner&#x27;</span>], <span class="hljs-attr">label</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">&#x27;Business Owner&#x27;</span>), <span class="hljs-attr">color</span>: <span class="hljs-string">&#x27;#66a61e&#x27;</span> },
    {<span class="hljs-attr">code</span>: [<span class="hljs-string">&#x27;Address_Unit&#x27;</span>, <span class="hljs-string">&#x27;Address_Main&#x27;</span>], <span class="hljs-attr">label</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">&#x27;Business Address&#x27;</span>), <span class="hljs-attr">color</span>: <span class="hljs-string">&#x27;#e6ab02&#x27;</span>},
    {<span class="hljs-attr">code</span>: [<span class="hljs-string">&#x27;A_Parcel&#x27;</span>], <span class="hljs-attr">label</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">&#x27;Property&#x27;</span>), <span class="hljs-attr">color</span>: <span class="hljs-string">&#x27;#1b9e77&#x27;</span> },
    {<span class="hljs-attr">code</span>: [<span class="hljs-string">&#x27;A_Parcel_Owner&#x27;</span>], <span class="hljs-attr">label</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">&#x27;Property Owner&#x27;</span>), <span class="hljs-attr">color</span>: <span class="hljs-string">&#x27;#d95f02&#x27;</span>},
    {<span class="hljs-attr">code</span>: [<span class="hljs-string">&#x27;RB_Evictor&#x27;</span>], <span class="hljs-attr">label</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">&#x27;Evictor&#x27;</span>), <span class="hljs-attr">color</span>: <span class="hljs-string">&#x27;#a6761d&#x27;</span>},
  ]

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    d3.<span class="hljs-title function_">select</span>(<span class="hljs-string">&#x27;#viz&#x27;</span>).<span class="hljs-title function_">selectAll</span>(<span class="hljs-string">&#x27;*&#x27;</span>).<span class="hljs-title function_">remove</span>()
    <span class="hljs-title function_">drawGraph</span>(network, labelFilter, nodeColors)
  })

  <span class="hljs-keyword">if</span> (!translationReady) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
  <span class="hljs-keyword">return</span> (
    <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(graph) === <span class="hljs-string">&#x27;{}&#x27;</span> ? 
      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{display:</span> &#x27;<span class="hljs-attr">flex</span>&#x27;, <span class="hljs-attr">placeItems:</span> &#x27;<span class="hljs-attr">center</span>&#x27;, <span class="hljs-attr">width:</span> &#x27;<span class="hljs-attr">100</span>%&#x27;, <span class="hljs-attr">justifyContent:</span> &#x27;<span class="hljs-attr">center</span>&#x27;}}&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">CircularProgress</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span> :
      <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Row</span> <span class="hljs-attr">justify</span>=<span class="hljs-string">&#x27;flex-start&#x27;</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Typography</span> <span class="hljs-attr">variant</span>=<span class="hljs-string">&#x27;body1&#x27;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{marginRight:</span> <span class="hljs-attr">20</span>}}&gt;</span>
            <span class="hljs-tag">&lt;&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{labelFilter}</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">{e</span> =&gt;</span>
                setLabelFilter(e.target.value)} style={{
                color: &#x27;white&#x27;,
                backgroundColor: &#x27;#342A46&#x27;
              }}&gt;
                <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#x27;All&#x27;</span>&gt;</span>{t(&#x27;All&#x27;)}<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#x27;Businesses&#x27;</span>&gt;</span>{t(&#x27;Businesses&#x27;)}<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#x27;Properties&#x27;</span>&gt;</span>{t(&#x27;Properties&#x27;)}<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{sizeFilter}</span> 
                <span class="hljs-attr">onChange</span>=<span class="hljs-string">{e</span> =&gt;</span>
                  setSizeFilter(e.target.value)} 
                style={{
                  color: &#x27;white&#x27;,
                  backgroundColor: &#x27;#342A46&#x27;
                }}&gt;
                <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#x27;25&#x27;</span>&gt;</span>25<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#x27;50&#x27;</span>&gt;</span>50<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#x27;100&#x27;</span>&gt;</span>100<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#x27;All&#x27;</span>&gt;</span>All<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
            <span class="hljs-tag">&lt;/&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">Typography</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{display:</span> &#x27;<span class="hljs-attr">grid</span>&#x27;, <span class="hljs-attr">gridTemplateColumns:</span> &#x27;<span class="hljs-attr">repeat</span>(<span class="hljs-attr">3</span>, <span class="hljs-attr">fit-content</span>(<span class="hljs-attr">100</span>%))&#x27;, 
            <span class="hljs-attr">justifyContent:</span> &#x27;<span class="hljs-attr">end</span>&#x27;, <span class="hljs-attr">flex:</span> &#x27;<span class="hljs-attr">1</span>&#x27;}}&gt;</span>
            {nodeColors.map((d,i) =&gt; {
              return <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{i}</span> 
                <span class="hljs-attr">style</span>=<span class="hljs-string">{{flexBasis:</span> &#x27;<span class="hljs-attr">33</span>%&#x27;, <span class="hljs-attr">display:</span> &#x27;<span class="hljs-attr">flex</span>&#x27;, 
                  <span class="hljs-attr">marginTop:</span> &#x27;<span class="hljs-attr">10px</span>&#x27;, <span class="hljs-attr">justifyContent:</span> &#x27;<span class="hljs-attr">right</span>&#x27;,
                  <span class="hljs-attr">whiteSpace:</span> &#x27;<span class="hljs-attr">nowrap</span>&#x27;, <span class="hljs-attr">maxWidth:</span> &#x27;<span class="hljs-attr">fit-content</span>&#x27;}}&gt;</span> 
                <span class="hljs-tag">&lt;<span class="hljs-name">Col</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{backgroundColor:</span> <span class="hljs-attr">d.color</span>, <span class="hljs-attr">marginLeft:</span> <span class="hljs-attr">10</span>, <span class="hljs-attr">marginRight:</span> <span class="hljs-attr">10</span>}}&gt;</span><span class="hljs-symbol">&amp;nbsp;</span><span class="hljs-symbol">&amp;nbsp;</span><span class="hljs-symbol">&amp;nbsp;</span><span class="hljs-symbol">&amp;nbsp;</span><span class="hljs-tag">&lt;/<span class="hljs-name">Col</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">Col</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">Typography</span>&gt;</span>{&#x27;  &#x27;}{d.label}{&#x27;  &#x27;}<span class="hljs-tag">&lt;/<span class="hljs-name">Typography</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">Col</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            })}
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Row</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">svg</span>
          <span class="hljs-attr">id</span>=<span class="hljs-string">&#x27;viz&#x27;</span>
          <span class="hljs-attr">width</span>=<span class="hljs-string">&#x27;100%&#x27;</span>
          <span class="hljs-attr">preserveAspectRatio</span>=<span class="hljs-string">&#x27;xMidYMid meet&#x27;</span>
        /&gt;</span>
      <span class="hljs-tag">&lt;/&gt;</span></span>
  )
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> D3Graph</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrccomponentsgraphdraw_graph.js"><a href="#toc"><a name="ui-src-components-graph-draw_graph-js">ui/src/components/Graph/draw_graph.js</a></a></h2>
<pre><code><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> d3 <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;d3&#x27;</span>
<span class="hljs-keyword">import</span> { titleCase } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../utils/stringUtils&#x27;</span>

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">FILTER_MAP</span> = {
  <span class="hljs-string">&#x27;All&#x27;</span>: [<span class="hljs-string">&#x27;A_Parcel&#x27;</span>, <span class="hljs-string">&#x27;A_Parcel_Owner&#x27;</span>, <span class="hljs-string">&#x27;SOS_Corp&#x27;</span>, <span class="hljs-string">&#x27;SOS_LP&#x27;</span>, <span class="hljs-string">&#x27;SOS_Owner&#x27;</span>, <span class="hljs-string">&#x27;Address_Unit&#x27;</span>, <span class="hljs-string">&#x27;Address_Main&#x27;</span>, <span class="hljs-string">&#x27;RB_Evictor&#x27;</span>, <span class="hljs-string">&#x27;RB_Eviction&#x27;</span>],
  <span class="hljs-string">&#x27;Businesses&#x27;</span>: [<span class="hljs-string">&#x27;SOS_Corp&#x27;</span>, <span class="hljs-string">&#x27;SOS_LP&#x27;</span>, <span class="hljs-string">&#x27;SOS_Owner&#x27;</span>],
  <span class="hljs-string">&#x27;Properties&#x27;</span>: [<span class="hljs-string">&#x27;A_Parcel&#x27;</span>, <span class="hljs-string">&#x27;A_Parcel_Owner&#x27;</span>]
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">drawGraph</span>(<span class="hljs-params">graph, labelFilter, nodeColors</span>) {
  <span class="hljs-keyword">if</span>(!d3.<span class="hljs-title function_">select</span>(<span class="hljs-string">&#x27;#viz&#x27;</span>).<span class="hljs-title function_">size</span>()) <span class="hljs-keyword">return</span>
  <span class="hljs-keyword">let</span> nodeRadius = <span class="hljs-number">6</span>
  <span class="hljs-keyword">let</span> markerSize = <span class="hljs-number">0</span>

  <span class="hljs-comment">// This line takes the array of nodeColors specified by D3Graph and </span>
  <span class="hljs-comment">// cleans it into an object readily usable by the nodes here </span>
  <span class="hljs-comment">// The object is &#x27;flat&#x27; as in there are no nested arrays or objects</span>
  <span class="hljs-keyword">const</span> flatColors = nodeColors.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, d</span>) =&gt;</span> (
    {...acc, ...d.<span class="hljs-property">code</span>.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">a,x</span>) =&gt;</span> ({...a, [x]: d.<span class="hljs-property">color</span>}), {})}
  ), {})  

  <span class="hljs-comment">// create a set of nodes for the pair between nodes and their text</span>
  <span class="hljs-comment">// all evens are the labels, all odds represent the labelled node</span>
  <span class="hljs-keyword">const</span> label = {<span class="hljs-string">&#x27;nodes&#x27;</span>: [], <span class="hljs-string">&#x27;links&#x27;</span>: []}

  graph.<span class="hljs-property">nodes</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">d, i</span>) {
    label.<span class="hljs-property">nodes</span>.<span class="hljs-title function_">push</span>({<span class="hljs-attr">node</span>: d})
    label.<span class="hljs-property">nodes</span>.<span class="hljs-title function_">push</span>({<span class="hljs-attr">node</span>: d})
    label.<span class="hljs-property">links</span>.<span class="hljs-title function_">push</span>({
      <span class="hljs-attr">source</span>: i * <span class="hljs-number">2</span>,
      <span class="hljs-attr">target</span>: i * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>
    })
  })


  <span class="hljs-keyword">const</span> svg = d3.<span class="hljs-title function_">select</span>(<span class="hljs-string">&#x27;#viz&#x27;</span>)
  <span class="hljs-keyword">const</span> width = svg.<span class="hljs-title function_">node</span>().<span class="hljs-title function_">getBoundingClientRect</span>().<span class="hljs-property">width</span>
  <span class="hljs-keyword">const</span> height = width

  svg.<span class="hljs-title function_">style</span>(<span class="hljs-string">&#x27;height&#x27;</span>, height + <span class="hljs-string">&#x27;px&#x27;</span>).<span class="hljs-title function_">style</span>(<span class="hljs-string">&#x27;cursor&#x27;</span>, <span class="hljs-string">&#x27;grab&#x27;</span>)
  <span class="hljs-keyword">const</span> container = svg.<span class="hljs-title function_">append</span>(<span class="hljs-string">&#x27;g&#x27;</span>)

  <span class="hljs-keyword">const</span> zoom = d3.<span class="hljs-title function_">zoom</span>()
    .<span class="hljs-title function_">scaleExtent</span>([ <span class="hljs-number">0.25</span>, <span class="hljs-number">4</span>])
    .<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;zoom&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">event</span>) {
      container.<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;transform&#x27;</span>, event.<span class="hljs-property">transform</span>)
    })
  svg.<span class="hljs-title function_">call</span>(zoom)

  <span class="hljs-comment">// hacky: set edge lengths based on how many nodes there are</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">getEdgeDist</span>(<span class="hljs-params"></span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">150</span>, <span class="hljs-number">200</span> - (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, graph.<span class="hljs-property">nodes</span>.<span class="hljs-property">length</span> - <span class="hljs-number">20</span>) * <span class="hljs-number">2</span>))
  }

  <span class="hljs-comment">// set up d3 force simulation</span>
  <span class="hljs-keyword">const</span> simulation = d3.<span class="hljs-title function_">forceSimulation</span>(graph.<span class="hljs-property">nodes</span>)
    .<span class="hljs-title function_">force</span>(<span class="hljs-string">&#x27;charge&#x27;</span>, d3.<span class="hljs-title function_">forceManyBody</span>().<span class="hljs-title function_">strength</span>(-<span class="hljs-number">1500</span>)) <span class="hljs-comment">// repel all nodes from each other</span>
    .<span class="hljs-title function_">force</span>(<span class="hljs-string">&#x27;center&#x27;</span>, d3.<span class="hljs-title function_">forceCenter</span>(width / <span class="hljs-number">2</span>, height / <span class="hljs-number">2</span>))
    .<span class="hljs-title function_">force</span>(<span class="hljs-string">&#x27;link&#x27;</span>, d3.<span class="hljs-title function_">forceLink</span>(graph.<span class="hljs-property">links</span>).<span class="hljs-title function_">id</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">n</span>) { <span class="hljs-keyword">return</span> n.<span class="hljs-property">id</span> }).<span class="hljs-title function_">distance</span>(<span class="hljs-title function_">getEdgeDist</span>()).<span class="hljs-title function_">strength</span>(<span class="hljs-number">1</span>)) <span class="hljs-comment">// set length of edges</span>
    .<span class="hljs-title function_">alphaDecay</span>(<span class="hljs-number">0.1</span>) <span class="hljs-comment">// make simulation cool faster</span>
    .<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;tick&#x27;</span>, tick)

  <span class="hljs-comment">// create tooltip div</span>
  <span class="hljs-keyword">var</span> tooltip = d3.<span class="hljs-title function_">select</span>(<span class="hljs-string">&#x27;body&#x27;</span>)
    .<span class="hljs-title function_">append</span>(<span class="hljs-string">&#x27;div&#x27;</span>)
    .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;class&#x27;</span>, <span class="hljs-string">&#x27;tooltip&#x27;</span>)

  <span class="hljs-comment">// add links</span>
  <span class="hljs-keyword">const</span> link = container.<span class="hljs-title function_">append</span>(<span class="hljs-string">&#x27;g&#x27;</span>).<span class="hljs-title function_">selectAll</span>(<span class="hljs-string">&#x27;line&#x27;</span>)
    .<span class="hljs-title function_">data</span>(graph.<span class="hljs-property">links</span>)
    .<span class="hljs-title function_">enter</span>()
    .<span class="hljs-title function_">append</span>(<span class="hljs-string">&#x27;line&#x27;</span>)
    .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;class&#x27;</span>, <span class="hljs-string">&#x27;link&#x27;</span>)
    .<span class="hljs-title function_">style</span>(<span class="hljs-string">&#x27;stroke&#x27;</span>, <span class="hljs-string">&#x27;#666&#x27;</span>)

  <span class="hljs-comment">//create paths for labels along links</span>
  <span class="hljs-keyword">let</span> edgepaths = container.<span class="hljs-title function_">append</span>(<span class="hljs-string">&#x27;g&#x27;</span>).<span class="hljs-title function_">selectAll</span>(<span class="hljs-string">&#x27;.edgepath&#x27;</span>)
    .<span class="hljs-title function_">data</span>(graph.<span class="hljs-property">links</span>)
    .<span class="hljs-title function_">enter</span>()
    .<span class="hljs-title function_">append</span>(<span class="hljs-string">&#x27;path&#x27;</span>)
    .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;class&#x27;</span>, <span class="hljs-string">&#x27;edgepath&#x27;</span>)
    .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;fill-opacity&#x27;</span>, <span class="hljs-number">0</span>)
    .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;stroke-opacity&#x27;</span>, <span class="hljs-number">0</span>)
    .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;id&#x27;</span>, <span class="hljs-function"><span class="hljs-params">d</span> =&gt;</span> <span class="hljs-string">`edgepath<span class="hljs-subst">${d.index}</span>`</span>)
    .<span class="hljs-title function_">style</span>(<span class="hljs-string">&#x27;pointer-events&#x27;</span>, <span class="hljs-string">&#x27;none&#x27;</span>)

  <span class="hljs-keyword">const</span> edgelabels = container.<span class="hljs-title function_">append</span>(<span class="hljs-string">&#x27;g&#x27;</span>)

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">updateEdgelabels</span>(<span class="hljs-params">data</span>){
    edgelabels.<span class="hljs-title function_">selectAll</span>(<span class="hljs-string">&#x27;.edgelabel&#x27;</span>).<span class="hljs-title function_">data</span>(data)
      .<span class="hljs-title function_">join</span>(<span class="hljs-function">(<span class="hljs-params">enter</span>) =&gt;</span> {
        enter.<span class="hljs-title function_">append</span>(<span class="hljs-string">&#x27;text&#x27;</span>)
          .<span class="hljs-title function_">style</span>(<span class="hljs-string">&#x27;pointer-events&#x27;</span>, <span class="hljs-string">&#x27;none&#x27;</span>)
          .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;class&#x27;</span>, <span class="hljs-string">&#x27;edgelabel&#x27;</span>)
          .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;font-size&#x27;</span>, <span class="hljs-number">11</span>)
          .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;fill&#x27;</span>, <span class="hljs-string">&#x27;#fff&#x27;</span>)
          .<span class="hljs-title function_">append</span>(<span class="hljs-string">&#x27;textPath&#x27;</span>)
          .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;xlink:href&#x27;</span>, <span class="hljs-function"><span class="hljs-params">d</span> =&gt;</span> <span class="hljs-string">`#edgepath<span class="hljs-subst">${d.index}</span>`</span>)
          .<span class="hljs-title function_">style</span>(<span class="hljs-string">&#x27;text-anchor&#x27;</span>, <span class="hljs-string">&#x27;middle&#x27;</span>)
          .<span class="hljs-title function_">style</span>(<span class="hljs-string">&#x27;pointer-events&#x27;</span>, <span class="hljs-string">&#x27;none&#x27;</span>)
          .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;startOffset&#x27;</span>, <span class="hljs-string">&#x27;50%&#x27;</span>)
          .<span class="hljs-title function_">text</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">d</span>) {<span class="hljs-keyword">return</span> d.<span class="hljs-property">label</span> || <span class="hljs-string">&#x27;&#x27;</span>})
      })
  }

  <span class="hljs-comment">// append labels</span>
  <span class="hljs-comment">// add nodes</span>
  <span class="hljs-keyword">const</span> node = container.<span class="hljs-title function_">append</span>(<span class="hljs-string">&#x27;g&#x27;</span>).<span class="hljs-title function_">selectAll</span>(<span class="hljs-string">&#x27;g&#x27;</span>)
    .<span class="hljs-title function_">data</span>(graph.<span class="hljs-property">nodes</span>)
    .<span class="hljs-title function_">enter</span>().<span class="hljs-title function_">append</span>(<span class="hljs-string">&#x27;g&#x27;</span>)
    <span class="hljs-comment">// append circle svgs</span>
  node.<span class="hljs-title function_">append</span>(<span class="hljs-string">&#x27;circle&#x27;</span>)
    .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;r&#x27;</span>, nodeRadius)
    .<span class="hljs-title function_">style</span>(<span class="hljs-string">&#x27;fill&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">d</span>) { <span class="hljs-keyword">return</span> flatColors[d.<span class="hljs-property">type</span>] })
    .<span class="hljs-title function_">style</span>(<span class="hljs-string">&#x27;stroke&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">d</span>) { <span class="hljs-keyword">return</span> d3.<span class="hljs-title function_">rgb</span>(flatColors[d.<span class="hljs-property">type</span>]).<span class="hljs-title function_">darker</span>()})
    .<span class="hljs-title function_">style</span>(<span class="hljs-string">&#x27;cursor&#x27;</span>, <span class="hljs-string">&#x27;pointer&#x27;</span>)

  <span class="hljs-comment">// append node labels</span>
  <span class="hljs-keyword">const</span> textPadding = <span class="hljs-number">2</span>
  node.<span class="hljs-title function_">append</span>(<span class="hljs-string">&#x27;text&#x27;</span>)
    .<span class="hljs-title function_">text</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">d</span>) { <span class="hljs-keyword">return</span> (
      <span class="hljs-variable constant_">FILTER_MAP</span>[labelFilter].<span class="hljs-title function_">includes</span>(d.<span class="hljs-property">type</span>) ? <span class="hljs-title function_">titleCase</span>(d.<span class="hljs-property">name</span>.<span class="hljs-title function_">trim</span>()) : <span class="hljs-string">&#x27;&#x27;</span>)
    })
  <span class="hljs-comment">//.call(getBBox)</span>
    .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;dx&#x27;</span>, <span class="hljs-number">10</span> + textPadding)
    .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;dy&#x27;</span>, nodeRadius)
    .<span class="hljs-title function_">style</span>(<span class="hljs-string">&#x27;font-size&#x27;</span>, <span class="hljs-number">15</span>)
    .<span class="hljs-title function_">style</span>(<span class="hljs-string">&#x27;font-weight&#x27;</span>, <span class="hljs-string">&#x27;normal&#x27;</span>)
    .<span class="hljs-title function_">style</span>(<span class="hljs-string">&#x27;text-align&#x27;</span>,<span class="hljs-string">&#x27;center&#x27;</span>)
    .<span class="hljs-title function_">style</span>(<span class="hljs-string">&#x27;fill&#x27;</span>, <span class="hljs-string">&#x27;#FFFFFF&#x27;</span>)
    .<span class="hljs-title function_">style</span>(<span class="hljs-string">&#x27;pointer-events&#x27;</span>, <span class="hljs-string">&#x27;none&#x27;</span>)

  <span class="hljs-comment">/* Update bounding boxes after the text is rendered */</span>
  node.<span class="hljs-title function_">selectAll</span>(<span class="hljs-string">&#x27;text&#x27;</span>)
    .<span class="hljs-title function_">each</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">d</span>) { d.<span class="hljs-property">bbox</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getBBox</span>() })

  <span class="hljs-comment">// insert node label background </span>
  <span class="hljs-comment">// need insert because this needs to be added before the text:</span>
  <span class="hljs-comment">//   https://cambridge-intelligence.com/customize-graph-visualization-d3-keylines/</span>
  node.<span class="hljs-title function_">insert</span>(<span class="hljs-string">&#x27;rect&#x27;</span>,<span class="hljs-string">&#x27;text&#x27;</span>)
    .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;x&#x27;</span>, <span class="hljs-function"><span class="hljs-params">d</span> =&gt;</span> d.<span class="hljs-property">bbox</span>.<span class="hljs-property">x</span> - textPadding)
    .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;y&#x27;</span>, <span class="hljs-function"><span class="hljs-params">d</span> =&gt;</span> d.<span class="hljs-property">bbox</span>.<span class="hljs-property">y</span> - textPadding)
    .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;rx&#x27;</span>, <span class="hljs-string">&#x27;2px&#x27;</span>)
    .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;ry&#x27;</span>, <span class="hljs-string">&#x27;2px&#x27;</span>)
    .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;width&#x27;</span>, <span class="hljs-function"><span class="hljs-params">d</span> =&gt;</span> d.<span class="hljs-property">bbox</span>.<span class="hljs-property">width</span> + textPadding * <span class="hljs-number">2</span>)
    .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;height&#x27;</span>, <span class="hljs-function"><span class="hljs-params">d</span> =&gt;</span> d.<span class="hljs-property">bbox</span>.<span class="hljs-property">height</span> + textPadding * <span class="hljs-number">2</span>)
    .<span class="hljs-title function_">style</span>(<span class="hljs-string">&#x27;opacity&#x27;</span>, <span class="hljs-string">&#x27;0.2&#x27;</span>)
    .<span class="hljs-title function_">style</span>(<span class="hljs-string">&#x27;fill&#x27;</span>, <span class="hljs-function"><span class="hljs-params">d</span> =&gt;</span> flatColors[d.<span class="hljs-property">type</span>])
    .<span class="hljs-title function_">style</span>(<span class="hljs-string">&#x27;cursor&#x27;</span>, <span class="hljs-string">&#x27;pointer&#x27;</span>)


  <span class="hljs-comment">// keep track of (undirected) neighbors</span>
  <span class="hljs-keyword">const</span> adjlist = []
  graph.<span class="hljs-property">links</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">d</span>) {
    adjlist[d.<span class="hljs-property">source</span>.<span class="hljs-property">index</span> + <span class="hljs-string">&#x27;-&#x27;</span> + d.<span class="hljs-property">target</span>.<span class="hljs-property">index</span>] = <span class="hljs-literal">true</span>
    adjlist[d.<span class="hljs-property">target</span>.<span class="hljs-property">index</span> + <span class="hljs-string">&#x27;-&#x27;</span> + d.<span class="hljs-property">source</span>.<span class="hljs-property">index</span>] = <span class="hljs-literal">true</span>
  })

  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> https://stackoverflow.com/questions/14296309/freezing-force-directed-network-graph-and-make-draggable-in-d3</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">dragStarted</span>(<span class="hljs-params">event, d</span>) {
    d.<span class="hljs-property">dragging</span> = <span class="hljs-literal">true</span>
    event.<span class="hljs-property">sourceEvent</span>.<span class="hljs-title function_">stopPropagation</span>()
    <span class="hljs-keyword">if</span> (!event.<span class="hljs-property">active</span>) simulation.<span class="hljs-title function_">alpha</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">restart</span>()
    d.<span class="hljs-property">fx</span> = d.<span class="hljs-property">x</span>
    d.<span class="hljs-property">fy</span> = d.<span class="hljs-property">y</span>
  }

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">dragging</span>(<span class="hljs-params">event, d</span>) {
    d.<span class="hljs-property">fx</span> = event.<span class="hljs-property">x</span>
    d.<span class="hljs-property">fy</span> = event.<span class="hljs-property">y</span>
  }

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">dragEnded</span>(<span class="hljs-params">event, d</span>) {
    d.<span class="hljs-property">dragging</span> = <span class="hljs-literal">false</span>
    <span class="hljs-keyword">if</span> (!event.<span class="hljs-property">active</span>) simulation.<span class="hljs-title function_">alpha</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">restart</span>()
    d.<span class="hljs-property">fx</span> = event.<span class="hljs-property">x</span>
    d.<span class="hljs-property">fy</span> = event.<span class="hljs-property">y</span>
  }

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">focus</span>(<span class="hljs-params">event, activeNode</span>) {
    <span class="hljs-keyword">const</span> {index, dragging} = activeNode
    node.<span class="hljs-title function_">style</span>(<span class="hljs-string">&#x27;opacity&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">o</span>) {
      <span class="hljs-keyword">function</span> <span class="hljs-title function_">areNeighbors</span>(<span class="hljs-params">a, b</span>) {
        <span class="hljs-keyword">return</span> a === b || adjlist[a + <span class="hljs-string">&#x27;-&#x27;</span> + b]
      }
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">areNeighbors</span>(index, o.<span class="hljs-property">index</span>) ? <span class="hljs-number">1</span> : <span class="hljs-number">0.2</span>
    })
    link.<span class="hljs-title function_">style</span>(<span class="hljs-string">&#x27;opacity&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">o</span>) {
      <span class="hljs-keyword">return</span> o.<span class="hljs-property">source</span>.<span class="hljs-property">index</span> === index || o.<span class="hljs-property">target</span>.<span class="hljs-property">index</span> === index ? <span class="hljs-number">1</span> : <span class="hljs-number">0.2</span>
    })

    <span class="hljs-comment">// calculate newEdgelabels if the current node isn&#x27;t being dragged</span>
    <span class="hljs-comment">//    otherwise don&#x27;t show anything, to keep performance</span>
    <span class="hljs-keyword">const</span> newEdgelabels = !dragging ? graph.<span class="hljs-property">links</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">d</span>) =&gt;</span> {
      <span class="hljs-keyword">return</span> d.<span class="hljs-property">source</span>.<span class="hljs-property">index</span> === index || d.<span class="hljs-property">target</span>.<span class="hljs-property">index</span> === index ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>
    }) : []

    <span class="hljs-title function_">updateEdgelabels</span>(newEdgelabels)
  }

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">unfocus</span>(<span class="hljs-params"></span>) {
    node.<span class="hljs-title function_">transition</span>().<span class="hljs-title function_">duration</span>(<span class="hljs-number">100</span>).<span class="hljs-title function_">style</span>(<span class="hljs-string">&#x27;opacity&#x27;</span>, <span class="hljs-number">1</span>)
    link.<span class="hljs-title function_">transition</span>().<span class="hljs-title function_">duration</span>(<span class="hljs-number">100</span>).<span class="hljs-title function_">style</span>(<span class="hljs-string">&#x27;opacity&#x27;</span>, <span class="hljs-number">1</span>)
    <span class="hljs-title function_">updateEdgelabels</span>([])
  }

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">onMouseOver</span>(<span class="hljs-params">event, d</span>) {
    <span class="hljs-title function_">focus</span>(event, d)
    <span class="hljs-keyword">if</span> (d.<span class="hljs-property">not_displayed</span>) {
      tooltip.<span class="hljs-title function_">transition</span>()
        .<span class="hljs-title function_">duration</span>(<span class="hljs-number">200</span>)
      tooltip.<span class="hljs-title function_">style</span>(<span class="hljs-string">&#x27;opacity&#x27;</span>, <span class="hljs-number">.8</span>) <span class="hljs-comment">//;style(&quot;visibility&quot;, &quot;visible&quot;)</span>
        .<span class="hljs-title function_">style</span>(<span class="hljs-string">&#x27;left&#x27;</span>, event.<span class="hljs-property">pageX</span> - <span class="hljs-number">5</span> + <span class="hljs-string">&#x27;px&#x27;</span>)
        .<span class="hljs-title function_">style</span>(<span class="hljs-string">&#x27;top&#x27;</span>, event.<span class="hljs-property">pageY</span> - <span class="hljs-number">30</span> + <span class="hljs-string">&#x27;px&#x27;</span>)
        .<span class="hljs-title function_">text</span>(d.<span class="hljs-property">not_displayed</span> + <span class="hljs-string">&#x27; connection(s) not shown.&#x27;</span>)
    }
  }

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">onMouseMove</span>(<span class="hljs-params">event, d</span>) {
    <span class="hljs-title function_">focus</span>(event, d)
    tooltip.<span class="hljs-title function_">style</span>(<span class="hljs-string">&#x27;left&#x27;</span>, event.<span class="hljs-property">pageX</span> - <span class="hljs-number">5</span> + <span class="hljs-string">&#x27;px&#x27;</span>)
      .<span class="hljs-title function_">style</span>(<span class="hljs-string">&#x27;top&#x27;</span>, event.<span class="hljs-property">pageY</span> - <span class="hljs-number">30</span> + <span class="hljs-string">&#x27;px&#x27;</span>)
  }

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">onMouseOut</span>(<span class="hljs-params">d</span>) {
    <span class="hljs-keyword">if</span> (!d.<span class="hljs-property">dragging</span>) <span class="hljs-title function_">unfocus</span>()
    tooltip.<span class="hljs-title function_">transition</span>()
      .<span class="hljs-title function_">duration</span>(<span class="hljs-number">100</span>)
      .<span class="hljs-title function_">style</span>(<span class="hljs-string">&#x27;opacity&#x27;</span>, <span class="hljs-number">0</span>) <span class="hljs-comment">//tooltip.style(&quot;visibility&quot;, &quot;hidden&quot;);</span>
  }

  <span class="hljs-comment">// focus on node + neighbors on hover</span>
  node.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;mouseover&#x27;</span>, onMouseOver)
    .<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;mousemove&#x27;</span>, onMouseMove)
    .<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;mouseout&#x27;</span>, onMouseOut)

  node.<span class="hljs-title function_">call</span>(d3.<span class="hljs-title function_">drag</span>()
    .<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;start&#x27;</span>, dragStarted)
    .<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;drag&#x27;</span>, dragging)
    .<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;end&#x27;</span>, dragEnded))

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">fixna</span>(<span class="hljs-params">num</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">isFinite</span>(num)) <span class="hljs-keyword">return</span> num
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>
  }

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">tick</span>(<span class="hljs-params"></span>) {

    node.<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;transform&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">d</span>) {
      <span class="hljs-keyword">let</span> damper = <span class="hljs-number">0</span>
      d.<span class="hljs-property">x</span> = d.<span class="hljs-property">x</span> + (width / <span class="hljs-number">2</span> - d.<span class="hljs-property">x</span>) * (damper + <span class="hljs-number">0.02</span>) * <span class="hljs-number">0.1</span>
      d.<span class="hljs-property">y</span> = d.<span class="hljs-property">y</span> + (height / <span class="hljs-number">2</span> - d.<span class="hljs-property">y</span>) * (damper + <span class="hljs-number">0.02</span>) * <span class="hljs-number">0.1</span>
      <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;translate(&#x27;</span> + <span class="hljs-title function_">fixna</span>(d.<span class="hljs-property">x</span>) + <span class="hljs-string">&#x27;,&#x27;</span> + <span class="hljs-title function_">fixna</span>(d.<span class="hljs-property">y</span>) + <span class="hljs-string">&#x27;)&#x27;</span>
    })

    link.<span class="hljs-title function_">each</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">d</span>) {
      <span class="hljs-keyword">let</span> x1 = d.<span class="hljs-property">source</span>.<span class="hljs-property">x</span>
      <span class="hljs-keyword">let</span> y1 = d.<span class="hljs-property">source</span>.<span class="hljs-property">y</span>
      <span class="hljs-keyword">let</span> x2 = d.<span class="hljs-property">target</span>.<span class="hljs-property">x</span>
      <span class="hljs-keyword">let</span> y2 = d.<span class="hljs-property">target</span>.<span class="hljs-property">y</span>
      <span class="hljs-keyword">let</span> angle = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">atan2</span>(y2 - y1, x2 - x1)
      d.<span class="hljs-property">sourceX</span> = x1 + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(angle) * (nodeRadius + markerSize / <span class="hljs-number">2</span>)
      d.<span class="hljs-property">sourceY</span> = y1 + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(angle) * (nodeRadius + markerSize / <span class="hljs-number">2</span>)
      d.<span class="hljs-property">targetX</span> = x2 - <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(angle) * (nodeRadius + markerSize / <span class="hljs-number">2</span>)
      d.<span class="hljs-property">targetY</span> = y2 - <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(angle) * (nodeRadius + markerSize / <span class="hljs-number">2</span>)
    })
    link.<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;x1&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">d</span>) { <span class="hljs-keyword">return</span> d.<span class="hljs-property">sourceX</span> })
      .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;y1&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">d</span>) { <span class="hljs-keyword">return</span> d.<span class="hljs-property">sourceY</span> })
      .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;x2&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">d</span>) { <span class="hljs-keyword">return</span> d.<span class="hljs-property">targetX</span> })
      .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;y2&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">d</span>) { <span class="hljs-keyword">return</span> d.<span class="hljs-property">targetY</span> })

    edgepaths.<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;d&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">d</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;M &#x27;</span> + d.<span class="hljs-property">source</span>.<span class="hljs-property">x</span> + <span class="hljs-string">&#x27; &#x27;</span> + d.<span class="hljs-property">source</span>.<span class="hljs-property">y</span> + <span class="hljs-string">&#x27; L &#x27;</span> + d.<span class="hljs-property">target</span>.<span class="hljs-property">x</span> + <span class="hljs-string">&#x27; &#x27;</span> + d.<span class="hljs-property">target</span>.<span class="hljs-property">y</span>
    })

    edgelabels.<span class="hljs-title function_">selectAll</span>(<span class="hljs-string">&#x27;.edgelabel&#x27;</span>).<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;transform&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">d</span>) {
      <span class="hljs-keyword">if</span> (d.<span class="hljs-property">target</span>.<span class="hljs-property">x</span> &lt; d.<span class="hljs-property">source</span>.<span class="hljs-property">x</span>) {
        <span class="hljs-keyword">const</span> bbox = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getBBox</span>()

        <span class="hljs-keyword">let</span> rx = bbox.<span class="hljs-property">x</span> + bbox.<span class="hljs-property">width</span> / <span class="hljs-number">2</span>
        <span class="hljs-keyword">let</span> ry = bbox.<span class="hljs-property">y</span> + bbox.<span class="hljs-property">height</span> / <span class="hljs-number">2</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;rotate(180 &#x27;</span> + rx + <span class="hljs-string">&#x27; &#x27;</span> + ry + <span class="hljs-string">&#x27;)&#x27;</span>
      }
      <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;rotate(0)&#x27;</span>
      }
    })
  }
}</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrccomponentsgraphgraphprocessor.js"><a href="#toc"><a name="ui-src-components-graph-graphprocessor-js">ui/src/components/Graph/graphProcessor.js</a></a></h2>
<pre><code><span class="hljs-keyword">const</span> <span class="hljs-title function_">createNode</span> = node =&gt; {
  <span class="hljs-keyword">let</span> nodeName = <span class="hljs-string">&#x27;&#x27;</span>
  <span class="hljs-keyword">switch</span> (node.<span class="hljs-property">labels</span>[<span class="hljs-number">0</span>]) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;A_Parcel&#x27;</span>:
      nodeName = node.<span class="hljs-property">properties</span>.<span class="hljs-property">block_lot</span>
      <span class="hljs-keyword">break</span>
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;A_Parcel_Owner&#x27;</span>:
      nodeName = node.<span class="hljs-property">properties</span>.<span class="hljs-property">owner_name</span>.<span class="hljs-title function_">concat</span>(<span class="hljs-string">&#x27; (Property Owner)&#x27;</span>)
      <span class="hljs-keyword">break</span>
    <span class="hljs-comment">// note: we do not display Addresss_Unit, only the assoc. Address_Main</span>
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;Address_Main&#x27;</span>:
      nodeName = node.<span class="hljs-property">properties</span>.<span class="hljs-property">addr_readable</span>
      <span class="hljs-keyword">break</span>
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;Address_Unit&#x27;</span>:
      nodeName = node.<span class="hljs-property">properties</span>.<span class="hljs-property">addr_readable</span>
      <span class="hljs-keyword">break</span>
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;SOS_Corp&#x27;</span>:
      nodeName = node.<span class="hljs-property">properties</span>.<span class="hljs-property">name_norm</span>
      <span class="hljs-keyword">break</span>
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;SOS_LP&#x27;</span>:
      nodeName = node.<span class="hljs-property">properties</span>.<span class="hljs-property">name_norm</span>
      <span class="hljs-keyword">break</span>
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;SOS_Owner&#x27;</span>:
      nodeName = node.<span class="hljs-property">properties</span>.<span class="hljs-property">name_norm</span>
      <span class="hljs-keyword">break</span>
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;RB_Evictor&#x27;</span>:
      nodeName = node.<span class="hljs-property">properties</span>.<span class="hljs-property">name</span>.<span class="hljs-title function_">concat</span>(<span class="hljs-string">&#x27; (Evictor)&#x27;</span>)
      <span class="hljs-keyword">break</span>
    <span class="hljs-comment">// note: RB_Evictions are not displayed; evictor mapped to parcel</span>
    <span class="hljs-attr">default</span>:
      nodeName = <span class="hljs-string">&#x27;&#x27;</span>
  }
  <span class="hljs-keyword">return</span> { <span class="hljs-attr">id</span>: node.<span class="hljs-property">identity</span>, <span class="hljs-attr">name</span>: nodeName, <span class="hljs-attr">type</span>: node.<span class="hljs-property">labels</span>[<span class="hljs-number">0</span>] }
}

<span class="hljs-keyword">const</span> get_node_degrees = <span class="hljs-keyword">function</span> (<span class="hljs-params">graph</span>) {
  <span class="hljs-keyword">let</span> degrees = {}
  graph.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">rel</span> =&gt;</span> {
    <span class="hljs-keyword">if</span> (rel.<span class="hljs-property">type</span> !== <span class="hljs-string">&#x27;EVICTOR_AT&#x27;</span> &amp;&amp; rel.<span class="hljs-property">type</span> !== <span class="hljs-string">&#x27;EVICTED_AT&#x27;</span>) {
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> id <span class="hljs-keyword">of</span> [rel.<span class="hljs-property">start</span>.<span class="hljs-property">identity</span>, rel.<span class="hljs-property">end</span>.<span class="hljs-property">identity</span>]) {
        <span class="hljs-keyword">if</span> (!(id <span class="hljs-keyword">in</span> degrees)) {
          degrees[id] = <span class="hljs-number">1</span>
        } <span class="hljs-keyword">else</span> {
          degrees[id] += <span class="hljs-number">1</span>
        }
      }
    }
  })
  <span class="hljs-keyword">return</span> degrees
}

<span class="hljs-keyword">const</span> generate_addr_map = <span class="hljs-keyword">function</span> (<span class="hljs-params">graph</span>) {
  <span class="hljs-keyword">let</span> addr_map = {} <span class="hljs-comment">// unit_id: {addr_main node}</span>
  <span class="hljs-keyword">const</span> addr_unit_rels = graph.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">n</span> =&gt;</span> n.<span class="hljs-property">type</span> === <span class="hljs-string">&#x27;UNIT_AT&#x27;</span>)
  addr_unit_rels.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">rel</span> =&gt;</span> {
    addr_map[rel.<span class="hljs-property">start</span>.<span class="hljs-property">identity</span>] = <span class="hljs-title function_">createNode</span>(rel.<span class="hljs-property">end</span>)
  })
  <span class="hljs-keyword">return</span> addr_map
}

<span class="hljs-comment">/*
generate_evictor_maps produces mappings from parcels &lt;-&gt; evictors as follows:

evictor_map = {
    evictor_id: {
        num_certain: 5,
        num_possible: 10,
        definite_parcels: [parcel_a, parcel_b]
    }
}

parcel_map: {
    parcel_id: {
        num_certain: 4,
        num_possible: 8
        definite_evictors: [evictor_a, evictor_b]
    }
}
*/</span>

<span class="hljs-keyword">const</span> generate_evictor_maps = <span class="hljs-keyword">function</span> (<span class="hljs-params">graph</span>) {
  <span class="hljs-keyword">const</span> eviction_rels = graph.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">n</span> =&gt;</span> n.<span class="hljs-property">start</span>.<span class="hljs-property">labels</span>[<span class="hljs-number">0</span>] === <span class="hljs-string">&#x27;RB_Eviction&#x27;</span>)
  <span class="hljs-comment">/* {RB_Eviction id: {
            &quot;evictors&quot;: [(e:evictor_node, certain:bool), ...]
            &quot;parcels&quot;: [(p:parcel_node, certain:bool), ...]}
        }
    */</span>
  <span class="hljs-keyword">let</span> eviction_map = {}
  eviction_rels.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">rel</span> =&gt;</span> {
    <span class="hljs-keyword">const</span> evict_id = rel.<span class="hljs-property">start</span>.<span class="hljs-property">identity</span>
    <span class="hljs-keyword">if</span> (!(evict_id <span class="hljs-keyword">in</span> eviction_map)) {
      eviction_map[evict_id] = { <span class="hljs-attr">evictors</span>: [], <span class="hljs-attr">parcels</span>: [] }
    }
    <span class="hljs-keyword">const</span> end_node = <span class="hljs-title function_">createNode</span>(rel.<span class="hljs-property">end</span>)
    <span class="hljs-keyword">if</span> (rel.<span class="hljs-property">type</span> === <span class="hljs-string">&#x27;EVICTED_BY&#x27;</span>) {
      <span class="hljs-comment">// if r.rel.type ==</span>
      eviction_map[evict_id][<span class="hljs-string">&#x27;evictors&#x27;</span>].<span class="hljs-title function_">push</span>(end_node)
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (rel.<span class="hljs-property">type</span> === <span class="hljs-string">&#x27;EVICTION_AT&#x27;</span>) {
      eviction_map[evict_id][<span class="hljs-string">&#x27;parcels&#x27;</span>].<span class="hljs-title function_">push</span>(end_node)
    }
  })

  <span class="hljs-keyword">let</span> evictor_map = {}
  <span class="hljs-keyword">let</span> parcel_map = {}
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> evict_id <span class="hljs-keyword">in</span> eviction_map) {
    <span class="hljs-comment">// if more than one evictor or parcel is assoc. with an eviction,</span>
    <span class="hljs-comment">// this is a &quot;multiple match&quot; scenario, so we are not confident</span>
    <span class="hljs-comment">// about the evictor / parcel</span>
    <span class="hljs-keyword">const</span> evictor_certain = eviction_map[evict_id].<span class="hljs-property">evictors</span>.<span class="hljs-property">length</span> === <span class="hljs-number">1</span>
    <span class="hljs-keyword">const</span> parcel_certain = eviction_map[evict_id].<span class="hljs-property">parcels</span>.<span class="hljs-property">length</span> === <span class="hljs-number">1</span>
    eviction_map[evict_id].<span class="hljs-property">evictors</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">evictor</span> =&gt;</span> {
      <span class="hljs-keyword">if</span> (!(evictor.<span class="hljs-property">id</span> <span class="hljs-keyword">in</span> evictor_map)) {
        evictor_map[evictor.<span class="hljs-property">id</span>] = {
          <span class="hljs-attr">num_certain</span>: <span class="hljs-number">0</span>,
          <span class="hljs-attr">num_possible</span>: <span class="hljs-number">0</span>,
          <span class="hljs-attr">parcels</span>: [],
        }
      }
      <span class="hljs-keyword">let</span> e = evictor_map[evictor.<span class="hljs-property">id</span>]
      e.<span class="hljs-property">num_certain</span> += evictor_certain ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>
      e.<span class="hljs-property">num_possible</span> += evictor_certain ? <span class="hljs-number">0</span> : <span class="hljs-number">1</span>
      <span class="hljs-comment">// ONLY connect evictor and parcel if both matches are certain</span>
      <span class="hljs-keyword">if</span> (evictor_certain &amp;&amp; parcel_certain) {
        <span class="hljs-keyword">const</span> parcel = eviction_map[evict_id].<span class="hljs-property">parcels</span>[<span class="hljs-number">0</span>]
        <span class="hljs-keyword">if</span> (!e.<span class="hljs-property">parcels</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x.<span class="hljs-property">id</span>).<span class="hljs-title function_">includes</span>(parcel.<span class="hljs-property">id</span>)) {
          e.<span class="hljs-property">parcels</span>.<span class="hljs-title function_">push</span>(parcel)
        }
      }
    })
    eviction_map[evict_id].<span class="hljs-property">parcels</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">parcel</span> =&gt;</span> {
      <span class="hljs-keyword">if</span> (!(parcel.<span class="hljs-property">id</span> <span class="hljs-keyword">in</span> parcel_map)) {
        parcel_map[parcel.<span class="hljs-property">id</span>] = {
          <span class="hljs-attr">num_certain</span>: <span class="hljs-number">0</span>,
          <span class="hljs-attr">num_possible</span>: <span class="hljs-number">0</span>,
          <span class="hljs-attr">evictors</span>: [],
        }
      }
      <span class="hljs-keyword">let</span> p = parcel_map[parcel.<span class="hljs-property">id</span>]
      p.<span class="hljs-property">num_certain</span> += parcel_certain ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>
      p.<span class="hljs-property">num_possible</span> += parcel_certain ? <span class="hljs-number">0</span> : <span class="hljs-number">1</span>
      <span class="hljs-comment">// ONLY connect evictor and parcel if both matches are certain</span>
      <span class="hljs-keyword">if</span> (evictor_certain &amp;&amp; parcel_certain) {
        <span class="hljs-keyword">const</span> evictor = eviction_map[evict_id].<span class="hljs-property">evictors</span>[<span class="hljs-number">0</span>]
        <span class="hljs-keyword">if</span> (!p.<span class="hljs-property">evictors</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x.<span class="hljs-property">id</span>).<span class="hljs-title function_">includes</span>(evictor.<span class="hljs-property">id</span>)) p.<span class="hljs-property">evictors</span>.<span class="hljs-title function_">push</span>(evictor)
      }
    })
  }
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">evictor_map</span>: evictor_map,
    <span class="hljs-attr">parcel_map</span>: parcel_map,
  }
}

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">LINK_LABEL</span> = {
  <span class="hljs-attr">PARC_OWNER_ADDR_AT</span>: <span class="hljs-string">&#x27;owner address at&#x27;</span>,
  <span class="hljs-attr">PARC_OWNED_BY</span>: <span class="hljs-string">&#x27;property owned by&#x27;</span>,
  <span class="hljs-attr">OFFICER_FOR</span>: <span class="hljs-string">&#x27;officer for&#x27;</span>,
  <span class="hljs-attr">ENTITY_OWNED_BY</span>: <span class="hljs-string">&#x27;owned by&#x27;</span>,
  <span class="hljs-attr">LISTED_AT</span>: <span class="hljs-string">&#x27;listed at&#x27;</span>,
}

<span class="hljs-keyword">const</span> _create_link = <span class="hljs-keyword">function</span> (<span class="hljs-params">source_id, target_id, label</span>) {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">source</span>: source_id,
    <span class="hljs-attr">target</span>: target_id,
    <span class="hljs-attr">label</span>: label,
  }
}

<span class="hljs-keyword">const</span> unique_nodes = <span class="hljs-keyword">function</span> (<span class="hljs-params">nodes</span>) {
  <span class="hljs-keyword">let</span> unique = []
  nodes.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">n</span> =&gt;</span> {
    <span class="hljs-keyword">if</span> (!unique.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x.<span class="hljs-property">id</span>).<span class="hljs-title function_">includes</span>(n.<span class="hljs-property">id</span>)) unique.<span class="hljs-title function_">push</span>(n)
  })
  <span class="hljs-keyword">return</span> unique
}

<span class="hljs-keyword">const</span> unique_links = <span class="hljs-keyword">function</span> (<span class="hljs-params">links</span>) {
  <span class="hljs-keyword">let</span> unique = []
  links.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">l</span> =&gt;</span> {
    <span class="hljs-keyword">if</span> (l.<span class="hljs-property">label</span> === <span class="hljs-literal">undefined</span>) <span class="hljs-keyword">return</span>
    <span class="hljs-keyword">let</span> can_add = <span class="hljs-literal">true</span>
    unique.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">u</span> =&gt;</span> {
      <span class="hljs-keyword">if</span> (u.<span class="hljs-property">source</span> === l.<span class="hljs-property">source</span> &amp;&amp; u.<span class="hljs-property">target</span> === l.<span class="hljs-property">target</span>) {
        can_add = <span class="hljs-literal">false</span>
      }
    })
    <span class="hljs-keyword">if</span> (can_add) unique.<span class="hljs-title function_">push</span>(l)
  })
  <span class="hljs-keyword">return</span> unique
}

<span class="hljs-comment">// get_next_edges(): given a node, returns all of nodes with one</span>
<span class="hljs-comment">//   edge between them and this node</span>
<span class="hljs-comment">//   as well as all of their associated links</span>
<span class="hljs-comment">//   exclude_set: set of node_ids already added to master list</span>
<span class="hljs-keyword">const</span> get_next_edges = <span class="hljs-keyword">function</span> (<span class="hljs-params">node, graph, addr_map, evictor_map, parcel_map, exclude_set</span>) {
  <span class="hljs-keyword">let</span> new_nodes = []
  <span class="hljs-keyword">let</span> new_links = []
  <span class="hljs-comment">// if current node is RB_Evictor, automatically add parcels</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> add property counting evictions</span>
  <span class="hljs-keyword">if</span> (node.<span class="hljs-property">type</span> === <span class="hljs-string">&#x27;RB_Evictor&#x27;</span>) {
    <span class="hljs-keyword">if</span> (node.<span class="hljs-property">id</span> <span class="hljs-keyword">in</span> evictor_map) {
      <span class="hljs-keyword">const</span> e = evictor_map[node.<span class="hljs-property">id</span>]
      e.<span class="hljs-property">parcels</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">p</span> =&gt;</span> {
        <span class="hljs-keyword">if</span> (!exclude_set.<span class="hljs-title function_">includes</span>(p.<span class="hljs-property">id</span>)) new_nodes.<span class="hljs-title function_">push</span>(p)
        <span class="hljs-comment">// should this be under if statement?</span>
        new_links.<span class="hljs-title function_">push</span>(<span class="hljs-title function_">_create_link</span>(node.<span class="hljs-property">id</span>, p.<span class="hljs-property">id</span>, <span class="hljs-string">&#x27;evictor at&#x27;</span>))
      })
    }
  }
  <span class="hljs-comment">// if current node is A_Parcel, automatically add evictors</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> add property counting evictions</span>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (node.<span class="hljs-property">type</span> === <span class="hljs-string">&#x27;A_Parcel&#x27;</span>) {
    <span class="hljs-keyword">if</span> (node.<span class="hljs-property">id</span> <span class="hljs-keyword">in</span> parcel_map) {
      <span class="hljs-keyword">const</span> p = parcel_map[node.<span class="hljs-property">id</span>]
      p.<span class="hljs-property">evictors</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {
        <span class="hljs-keyword">if</span> (!exclude_set.<span class="hljs-title function_">includes</span>(e.<span class="hljs-property">id</span>)) new_nodes.<span class="hljs-title function_">push</span>(e)
        new_links.<span class="hljs-title function_">push</span>(<span class="hljs-title function_">_create_link</span>(e.<span class="hljs-property">id</span>, node.<span class="hljs-property">id</span>, <span class="hljs-string">&#x27;evictor at&#x27;</span>))
      })
    }
  }

  graph.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">rel</span> =&gt;</span> {
    <span class="hljs-comment">// if rel is an EVICTED_BY or EVICTION_AT, continue (parcels/evictors already added)</span>
    <span class="hljs-keyword">if</span> (rel.<span class="hljs-property">type</span> === <span class="hljs-string">&#x27;EVICTED_BY&#x27;</span> || rel.<span class="hljs-property">type</span> === <span class="hljs-string">&#x27;EVICTION_AT&#x27;</span>) <span class="hljs-keyword">return</span>

    <span class="hljs-comment">// if neither endpoint matches current node, skip</span>
    <span class="hljs-keyword">if</span> (rel.<span class="hljs-property">start</span>.<span class="hljs-property">identity</span> !== node.<span class="hljs-property">id</span> &amp;&amp; rel.<span class="hljs-property">end</span>.<span class="hljs-property">identity</span> !== node.<span class="hljs-property">id</span>) <span class="hljs-keyword">return</span>

    <span class="hljs-keyword">const</span> linked_neo4j_node = rel.<span class="hljs-property">start</span>.<span class="hljs-property">identity</span> === node.<span class="hljs-property">id</span> ? rel.<span class="hljs-property">end</span> : rel.<span class="hljs-property">start</span>
    <span class="hljs-keyword">const</span> source_rel = rel.<span class="hljs-property">start</span>.<span class="hljs-property">identity</span> === node.<span class="hljs-property">id</span> ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span> <span class="hljs-comment">// if true, current node is source of link</span>

    <span class="hljs-keyword">let</span> linked_node = <span class="hljs-title function_">createNode</span>(linked_neo4j_node)
    <span class="hljs-comment">// if we can replace Address_Unit linked node with Address_Main, do so</span>
    <span class="hljs-keyword">if</span> (linked_neo4j_node.<span class="hljs-property">identity</span> <span class="hljs-keyword">in</span> addr_map) {
      linked_node = addr_map[linked_neo4j_node.<span class="hljs-property">identity</span>]
    }

    <span class="hljs-comment">// if current node is BE_LINKED_TO another node, contract rel</span>
    <span class="hljs-comment">// and add one-degree connections of other node</span>
    <span class="hljs-keyword">if</span> (rel.<span class="hljs-property">type</span> === <span class="hljs-string">&#x27;BE_LINKED_TO&#x27;</span> &amp;&amp; !exclude_set.<span class="hljs-title function_">includes</span>(linked_node.<span class="hljs-property">id</span>)) {
      <span class="hljs-keyword">const</span> linked_res = <span class="hljs-title function_">get_next_edges</span>(
        linked_node,
        graph,
        addr_map,
        evictor_map,
        parcel_map,
        exclude_set.<span class="hljs-title function_">concat</span>([linked_node.<span class="hljs-property">id</span>])
      )
      new_nodes.<span class="hljs-title function_">push</span>(...linked_res.<span class="hljs-property">nodes</span>)
      <span class="hljs-comment">// modify links to link back up to current node</span>
      linked_res.<span class="hljs-property">links</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">l</span> =&gt;</span> {
        <span class="hljs-keyword">if</span> (l.<span class="hljs-property">source</span> === linked_node.<span class="hljs-property">id</span>) l.<span class="hljs-property">source</span> = node.<span class="hljs-property">id</span>
        <span class="hljs-keyword">else</span> l.<span class="hljs-property">target</span> = node.<span class="hljs-property">id</span>
        new_links.<span class="hljs-title function_">push</span>(l)
      })
      <span class="hljs-keyword">return</span>
    }

    <span class="hljs-comment">// otherwise, add this linked node to set of one degree connections</span>
    <span class="hljs-keyword">if</span> (!exclude_set.<span class="hljs-title function_">includes</span>(linked_node.<span class="hljs-property">id</span>)) new_nodes.<span class="hljs-title function_">push</span>(linked_node)
    <span class="hljs-keyword">if</span> (source_rel) {
      new_links.<span class="hljs-title function_">push</span>(<span class="hljs-title function_">_create_link</span>(node.<span class="hljs-property">id</span>, linked_node.<span class="hljs-property">id</span>, <span class="hljs-variable constant_">LINK_LABEL</span>[rel.<span class="hljs-property">type</span>]))
    } <span class="hljs-keyword">else</span> {
      new_links.<span class="hljs-title function_">push</span>(<span class="hljs-title function_">_create_link</span>(linked_node.<span class="hljs-property">id</span>, node.<span class="hljs-property">id</span>, <span class="hljs-variable constant_">LINK_LABEL</span>[rel.<span class="hljs-property">type</span>]))
    }
  })
  <span class="hljs-keyword">return</span> { <span class="hljs-attr">nodes</span>: <span class="hljs-title function_">unique_nodes</span>(new_nodes), <span class="hljs-attr">links</span>: <span class="hljs-title function_">unique_links</span>(new_links) }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> get_view_network = <span class="hljs-keyword">function</span> (<span class="hljs-params">db_graph, node_limit = <span class="hljs-number">80</span>, degree_limit = <span class="hljs-number">6</span></span>) {
  <span class="hljs-keyword">const</span> graph = db_graph?.<span class="hljs-property">network_subgraph</span>

  <span class="hljs-comment">// If there&#x27;s no graph to render, short-circuit and return an obj with empty</span>
  <span class="hljs-comment">// lists for &#x27;nodes&#x27; and &#x27;links&#x27;.</span>
  <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(graph) || graph.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">nodes</span>: [],
      <span class="hljs-attr">links</span>: [],
    }
  }

  <span class="hljs-keyword">const</span> node_degrees = <span class="hljs-title function_">get_node_degrees</span>(graph)
  <span class="hljs-keyword">const</span> addr_map = <span class="hljs-title function_">generate_addr_map</span>(graph)
  <span class="hljs-keyword">const</span> emap = <span class="hljs-title function_">generate_evictor_maps</span>(graph)
  <span class="hljs-keyword">const</span> evictor_map = emap.<span class="hljs-property">evictor_map</span>
  <span class="hljs-keyword">const</span> parcel_map = emap.<span class="hljs-property">parcel_map</span>

  <span class="hljs-keyword">let</span> confirmed_nodes = [<span class="hljs-title function_">createNode</span>(graph[<span class="hljs-number">0</span>].<span class="hljs-property">start</span>)] <span class="hljs-comment">// arbitrarily use the first node to start with</span>
  <span class="hljs-keyword">let</span> confirmed_links = []

  <span class="hljs-keyword">let</span> path_length = <span class="hljs-number">1</span>

  <span class="hljs-keyword">let</span> last_added_nodes = [...confirmed_nodes] <span class="hljs-comment">// the set of nodes added on the last run of the while loop</span>
  <span class="hljs-keyword">let</span> cached_nodes = [...confirmed_nodes] <span class="hljs-comment">// a copy of the total amount of saved nodes</span>

  <span class="hljs-comment">// If the user selected &#x27;All&#x27;, set the limit as the number of total nodes</span>
  node_limit = node_limit === <span class="hljs-string">&#x27;All&#x27;</span> ? <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(node_degrees).<span class="hljs-property">length</span> : node_limit

  <span class="hljs-keyword">while</span> (confirmed_nodes.<span class="hljs-property">length</span> &lt; node_limit &amp;&amp; path_length &lt;= degree_limit) {
    <span class="hljs-keyword">let</span> nodes_to_add = []
    <span class="hljs-keyword">let</span> links_to_add = []
    <span class="hljs-comment">/* eslint no-loop-func: &#x27;off&#x27; */</span>
    last_added_nodes.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">n</span> =&gt;</span> {
      <span class="hljs-keyword">const</span> { nodes, links } = <span class="hljs-title function_">get_next_edges</span>(n, graph, addr_map, evictor_map, parcel_map, [])
      nodes.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">new_n</span> =&gt;</span> {
        <span class="hljs-keyword">if</span> (!nodes_to_add.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x.<span class="hljs-property">id</span>).<span class="hljs-title function_">includes</span>(new_n.<span class="hljs-property">id</span>)) nodes_to_add.<span class="hljs-title function_">push</span>(new_n)
      })
      links_to_add.<span class="hljs-title function_">push</span>(...links)
    })
    last_added_nodes = nodes_to_add

    cached_nodes.<span class="hljs-title function_">push</span>(...nodes_to_add)
    cached_nodes = <span class="hljs-title function_">unique_nodes</span>(cached_nodes)

    <span class="hljs-comment">// update confirmed_nodes iff the result will be under node_limit</span>
    <span class="hljs-comment">//    if it crosses the limit, then confirmed_nodes will &quot;remember&quot;</span>
    <span class="hljs-comment">//    a cached value from the previous run and not add the limit-breaking nodes</span>
    <span class="hljs-comment">// This also provides a safety check in case the graph processor thinks the graph is</span>
    <span class="hljs-comment">//    &quot;fragmented&quot; and will never reach the total number of nodes. In this scenario</span>
    <span class="hljs-comment">//    it will cause a stack overflow, so we want to break if there were no nodes added</span>
    <span class="hljs-comment">//    from one run of the while loop</span>
    <span class="hljs-keyword">if</span> (cached_nodes.<span class="hljs-property">length</span> &gt;= node_limit || cached_nodes.<span class="hljs-property">length</span> === confirmed_nodes.<span class="hljs-property">length</span>) <span class="hljs-keyword">break</span>
    confirmed_nodes = [...cached_nodes]
    confirmed_links = <span class="hljs-title function_">unique_links</span>(links_to_add)
    path_length += <span class="hljs-number">1</span>
  }

  confirmed_nodes.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">n</span> =&gt;</span> {
    <span class="hljs-keyword">let</span> displayed_degree = <span class="hljs-number">0</span>
    confirmed_links.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">l</span> =&gt;</span> {
      <span class="hljs-keyword">if</span> (l.<span class="hljs-property">source</span> === n.<span class="hljs-property">id</span> || l.<span class="hljs-property">target</span> === n.<span class="hljs-property">id</span>) displayed_degree += <span class="hljs-number">1</span>
    })
    <span class="hljs-keyword">if</span> (displayed_degree &lt; node_degrees[n.<span class="hljs-property">id</span>]) {
      n[<span class="hljs-string">&#x27;not_displayed&#x27;</span>] = node_degrees[n.<span class="hljs-property">id</span>] - displayed_degree
    }
  })

  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">nodes</span>: confirmed_nodes,
    <span class="hljs-attr">links</span>: confirmed_links,
  }
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrccomponentsgrid.js"><a href="#toc"><a name="ui-src-components-grid-js">ui/src/components/Grid.js</a></a></h2>
<pre><code><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { forwardRef } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Grid</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/Grid&#x27;</span>

<span class="hljs-comment">/* Helper functions to enhance readability since with Material UI a row is &#x27;&lt;Grid container&gt;&#x27; and a column is &#x27;&lt;Grid item&gt;&#x27; */</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">Row</span> = <span class="hljs-title function_">forwardRef</span>(
  <span class="hljs-function">(<span class="hljs-params">props, ref</span>) =&gt;</span>
    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Grid</span> <span class="hljs-attr">container</span> {<span class="hljs-attr">...props</span>} <span class="hljs-attr">ref</span>=<span class="hljs-string">{ref}</span>&gt;</span>
      {props.children}
    <span class="hljs-tag">&lt;/<span class="hljs-name">Grid</span>&gt;</span></span>
)

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">Col</span> = <span class="hljs-title function_">forwardRef</span>(
  <span class="hljs-function">(<span class="hljs-params">props, ref</span>) =&gt;</span>
    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Grid</span> <span class="hljs-attr">item</span> {<span class="hljs-attr">...props</span>} <span class="hljs-attr">ref</span>=<span class="hljs-string">{ref}</span>&gt;</span>
      {props.children}
    <span class="hljs-tag">&lt;/<span class="hljs-name">Grid</span>&gt;</span></span>
)</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrccomponentsheader.js"><a href="#toc"><a name="ui-src-components-header-js">ui/src/components/Header.js</a></a></h2>
<pre><code><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { memo } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">NavLink</span>, useLocation } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-router-dom&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">SearchBar</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./DataSearchBar/SearchBar&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Toolbar</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/Toolbar&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Typography</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/Typography&#x27;</span>
<span class="hljs-keyword">import</span> useMediaQuery <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/useMediaQuery&#x27;</span>
<span class="hljs-keyword">import</span> useStyles <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../theme/HeaderStyles&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">HomeIcon</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/icons/Home&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Link</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/Link&#x27;</span>
<span class="hljs-keyword">import</span> { useTheme } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/styles&#x27;</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">Header</span> = (<span class="hljs-params"></span>) =&gt; {
  
  <span class="hljs-keyword">let</span> location = <span class="hljs-title function_">useLocation</span>()
  <span class="hljs-keyword">const</span> theme = <span class="hljs-title function_">useTheme</span>()
  <span class="hljs-keyword">const</span> classes = <span class="hljs-title function_">useStyles</span>(theme)
  <span class="hljs-keyword">const</span> isSmallDisplay = <span class="hljs-title function_">useMediaQuery</span>(<span class="hljs-string">&#x27;(max-width: 600px)&#x27;</span>)

  <span class="hljs-keyword">return</span> (
    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Toolbar</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{classes.root}</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">underline</span>=<span class="hljs-string">&#x27;none&#x27;</span> <span class="hljs-attr">component</span>=<span class="hljs-string">{NavLink}</span> <span class="hljs-attr">to</span>=<span class="hljs-string">&quot;/&quot;</span>&gt;</span>
        {
          isSmallDisplay
            ? <span class="hljs-tag">&lt;<span class="hljs-name">HomeIcon</span> <span class="hljs-attr">htmlColor</span>=<span class="hljs-string">{theme.palette.common.EGGPLANT}</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{fontSize:</span> &#x27;<span class="hljs-attr">40</span>&#x27;}} /&gt;</span>
            : <span class="hljs-tag">&lt;<span class="hljs-name">Typography</span> <span class="hljs-attr">variant</span>=<span class="hljs-string">&quot;h3&quot;</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{classes.titleText}</span>&gt;</span>
              EVICTORBOOK
            <span class="hljs-tag">&lt;/<span class="hljs-name">Typography</span>&gt;</span>
        }
      <span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span>
      {location.pathname !== &#x27;/&#x27; &amp;&amp;
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{</span>
          <span class="hljs-attr">isSmallDisplay</span>
            ? <span class="hljs-attr">classes.searchBarMobile</span>
            <span class="hljs-attr">:</span> <span class="hljs-attr">classes.searchBarDiv</span>
        }&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">SearchBar</span> <span class="hljs-attr">location</span>=<span class="hljs-string">&#x27;/results&#x27;</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      }
    <span class="hljs-tag">&lt;/<span class="hljs-name">Toolbar</span>&gt;</span></span>
  )
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">memo</span>(<span class="hljs-title class_">Header</span>)</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrccomponentsnetworklist.js"><a href="#toc"><a name="ui-src-components-networklist-js">ui/src/components/NetworkList.js</a></a></h2>
<pre><code><span class="hljs-keyword">import</span> React, { memo, useState } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>
<span class="hljs-keyword">import</span> { useSelector } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-redux&#x27;</span>
<span class="hljs-keyword">import</span> { Typography } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core&#x27;</span>
<span class="hljs-keyword">import</span> Card <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/Card&#x27;</span>
<span class="hljs-keyword">import</span> Divider <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/Divider&#x27;</span>
<span class="hljs-keyword">import</span> Chip <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/Chip&#x27;</span>
<span class="hljs-keyword">import</span> Avatar <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/Avatar&#x27;</span>
<span class="hljs-keyword">import</span> CardActionArea <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/CardActionArea&#x27;</span>
<span class="hljs-keyword">import</span> CardContent <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/CardContent&#x27;</span>
<span class="hljs-keyword">import</span> ArrowDropDown <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/icons/ArrowDropDown&#x27;</span>
<span class="hljs-keyword">import</span> Button <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/Button&#x27;</span>
<span class="hljs-keyword">import</span> { commaSeparatedBolded } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../utils/dataUtils&#x27;</span>
<span class="hljs-keyword">import</span> { isEmpty, sliceJson } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./DataPage/DataPage&#x27;</span>
<span class="hljs-keyword">import</span> { useTheme } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/styles&#x27;</span>
<span class="hljs-keyword">import</span> { Row } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./Grid&#x27;</span>
<span class="hljs-keyword">import</span> useStyles <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../theme/ListStyles&#x27;</span>
<span class="hljs-keyword">import</span> { useTranslation } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-i18next&#x27;</span>
<span class="hljs-keyword">import</span> { generateGraphIdUrl } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../utils/tableUtils&#x27;</span>
<span class="hljs-keyword">import</span> i18n <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../i18n&#x27;</span>
<span class="hljs-keyword">import</span> { ReactComponent as NetworkLink } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../images/noun_networking_2148898.svg&#x27;</span>

const NetworkList = props =&gt; {

  const theme = useTheme()
  const classes = useStyles(theme)
  const { t, ready: translationReady } = useTranslation(
    <span class="hljs-string">&#x27;List&#x27;</span>, <span class="hljs-comment">/* i18next-parser needs string here */</span>
    { useSuspense: <span class="hljs-keyword">false</span>, i18n }
  )
  const slice = props.slice
  const noDataMessage = props.noDataMessage
  const [showAll, setShowAll] = useState(<span class="hljs-keyword">false</span>)
  const resultJson = useSelector(sliceJson(slice))
  const related = Object.assign([], resultJson)

  <span class="hljs-keyword">if</span> (!translationReady) <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>
  const ownershipNetworkLabel = t(<span class="hljs-string">&#x27;Ownership network containing&#x27;</span>)

  <span class="hljs-keyword">if</span> (isEmpty(resultJson)) 
    <span class="hljs-keyword">return</span> (
      &lt;&gt;
        &lt;Typography variant=<span class="hljs-string">&#x27;h2&#x27;</span>&gt;{t(<span class="hljs-string">&#x27;Related Ownership Networks&#x27;</span>)}&lt;/Typography&gt;
        &lt;Typography variant=<span class="hljs-string">&#x27;body1&#x27;</span>&gt;{noDataMessage}&lt;/Typography&gt;
      &lt;/&gt;
    )

  const handleShowMoreClick = () =&gt; setShowAll(<span class="hljs-keyword">true</span>)

  <span class="hljs-keyword">return</span> (
    &lt;&gt;
      &lt;Typography variant=<span class="hljs-string">&#x27;h2&#x27;</span>&gt;{t(<span class="hljs-string">&#x27;Related Ownership Networks&#x27;</span>)}&lt;/Typography&gt;
      &lt;Typography variant=<span class="hljs-string">&#x27;body1&#x27;</span>&gt;
        Related ownership networks are those which have something important in 
        common with the ownership network highlighted on <span class="hljs-keyword">this</span> page. A summary 
        of <span class="hljs-keyword">each</span> related network is shown below along with the reason <span class="hljs-keyword">for</span> the 
        relationship.
      &lt;/Typography&gt;
      &lt;br/&gt;
      { <span class="hljs-comment">/* always show the first three networks */</span>
        related.slice(<span class="hljs-number">0</span>, showAll ? related.length : <span class="hljs-number">3</span>).map((network,i) =&gt; {

          const <span class="hljs-keyword">description</span> = network.network_description
          const id = <span class="hljs-keyword">description</span>.network_id

          <span class="hljs-comment">// creates the rows for each related network card, providing</span>
          <span class="hljs-comment">// an explanation for why we believe the networks are related</span>
          const explanation_section = network.explanations.map((exp) =&gt; {
            let firstChipLabel
            let firstChipCount
            let secondChipLabel
            let secondChipCount
            let cardText

            <span class="hljs-keyword">switch</span>(exp.exp_type) {
              <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;businesses_listed_at_addrs&#x27;</span>:
                <span class="hljs-comment">// Case: There are businesses in one networks that have</span>
                <span class="hljs-comment">//       listed office addresses in the other network</span>

                firstChipLabel = exp.exp_metrics.num_addrs &gt; <span class="hljs-number">1</span> ? <span class="hljs-string">&#x27;Addresses&#x27;</span> : <span class="hljs-string">&#x27;Address&#x27;</span>
                firstChipCount = exp.exp_metrics.num_addrs
                secondChipLabel = exp.exp_metrics.num_businesses &gt; <span class="hljs-number">1</span> ? <span class="hljs-string">&#x27;Businesses&#x27;</span> : <span class="hljs-string">&#x27;Business&#x27;</span>
                secondChipCount = exp.exp_metrics.num_businesses
                cardText = <span class="hljs-string">&#x27;shared between networks&#x27;</span>
                <span class="hljs-keyword">break</span>

              <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;related_to_excluded&#x27;</span>:
                <span class="hljs-comment">// Case: There are businesses in the networks that are</span>
                <span class="hljs-comment">//       connected via a business or an address that we </span>
                <span class="hljs-comment">//       have determined to be a likely &quot;unreliable&quot;</span>
                <span class="hljs-comment">//       connector (e.g. might be an address for a </span>
                <span class="hljs-comment">//       business filing service)</span>

                firstChipLabel = exp.exp_metrics.num_related_to_excluded &gt; <span class="hljs-number">1</span> ? <span class="hljs-string">&#x27;Businesses&#x27;</span> : <span class="hljs-string">&#x27;Business&#x27;</span>
                firstChipCount = exp.exp_metrics.num_related_to_excluded
                cardText = <span class="hljs-string">&#x27;between networks associated with a likely unreliable business or address connection&#x27;</span>
                <span class="hljs-keyword">break</span>

              <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;businesses_owning_parcels&#x27;</span>:
                <span class="hljs-comment">// Case: There are businesses in one networks that are </span>
                <span class="hljs-comment">//       listed as the property owner for properties in</span>
                <span class="hljs-comment">//       the other network </span>

                firstChipLabel = exp.exp_metrics.num_businesses &gt; <span class="hljs-number">1</span> ? <span class="hljs-string">&#x27;Businesses&#x27;</span> : <span class="hljs-string">&#x27;Business&#x27;</span>
                firstChipCount = exp.exp_metrics.num_businesses
                secondChipLabel = exp.exp_metrics.num_parcels &gt; <span class="hljs-number">1</span> ? <span class="hljs-string">&#x27;Properties&#x27;</span> : <span class="hljs-string">&#x27;Property&#x27;</span>
                secondChipCount = exp.exp_metrics.num_parcels
                cardText = <span class="hljs-string">&#x27;shared between networks&#x27;</span>
                <span class="hljs-keyword">break</span>

              <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;parcels_owned_by_same_non_business_owner&#x27;</span>:
                <span class="hljs-comment">// Case: There are properties in the two networks that</span>
                <span class="hljs-comment">//       both have a non-business owner. E.g. might be a </span>
                <span class="hljs-comment">//       person or a trust that owns both. </span>

                firstChipLabel = exp.exp_metrics.num_parcels &gt; <span class="hljs-number">1</span> ? <span class="hljs-string">&#x27;Properties&#x27;</span> : <span class="hljs-string">&#x27;Property&#x27;</span>
                firstChipCount = exp.exp_metrics.num_parcels
                cardText = <span class="hljs-string">&#x27;owned by same non-business owner between networks&#x27;</span>
                <span class="hljs-keyword">break</span>

              <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;similar_addresses&#x27;</span>:
                <span class="hljs-comment">// Case: There are office addresses in one network that</span>
                <span class="hljs-comment">//       have the same street address as addresses in the other</span>
                <span class="hljs-comment">//       (i.e. they are in the same building but have different</span>
                <span class="hljs-comment">//       suite / unit numbers)</span>
                
                cardText = <span class="hljs-string">&#x27;Similar business addresses between networks&#x27;</span>
                <span class="hljs-keyword">break</span>
              
              <span class="hljs-keyword">default</span>:
                <span class="hljs-keyword">break</span>
            }

            <span class="hljs-comment">/* Return for network.explanations.map((exp) =&gt; */</span>
            <span class="hljs-keyword">return</span> (
              &lt;<span class="hljs-keyword">div</span> key={`${exp.exp_type}`}&gt;
                {&lt;hr style={{
                  border: <span class="hljs-number">0</span>,
                  borderTop: <span class="hljs-string">&#x27;1px solid lightgrey&#x27;</span>
                }}/&gt;}
                {firstChipLabel &amp;&amp; firstChipCount &amp;&amp; &lt;Chip
                  <span class="hljs-keyword">size</span>=<span class="hljs-string">&quot;small&quot;</span>
                  avatar={&lt;Avatar color=<span class="hljs-string">&#x27;primary&#x27;</span>&gt;{firstChipCount}&lt;/Avatar&gt;}
                  label={firstChipLabel}
                  color=<span class="hljs-string">&quot;primary&quot;</span>
                /&gt;}
                {secondChipLabel &amp;&amp; secondChipCount &amp;&amp; &lt;Chip
                  <span class="hljs-keyword">size</span>=<span class="hljs-string">&quot;small&quot;</span>
                  avatar={&lt;Avatar color=<span class="hljs-string">&#x27;primary&#x27;</span>&gt;{secondChipCount}&lt;/Avatar&gt;}
                  label={secondChipLabel}
                  color=<span class="hljs-string">&quot;primary&quot;</span>
                /&gt;}
                {&lt;span&gt;
                  {<span class="hljs-string">&#x27; &#x27;</span>}{cardText}
                &lt;/span&gt;
                }
              &lt;/<span class="hljs-keyword">div</span>&gt;
            )
          })

          <span class="hljs-comment">/* Return for related.slice(0, 3).map((network,i) =&gt; */</span>
          <span class="hljs-keyword">return</span> (
            &lt;Row
              key={`${<span class="hljs-keyword">description</span>}-${i}`}&gt;
              &lt;Card style={{
                borderRadius: <span class="hljs-number">5</span>,
                marginBottom: <span class="hljs-number">15</span>,
                paddingTop: <span class="hljs-number">10</span>,
                paddingBottom: <span class="hljs-number">10</span>,
                fontFamily: <span class="hljs-string">&#x27;Source Sans Pro, sans-serif&#x27;</span>,
                border: <span class="hljs-number">0</span>,
                fontSize: <span class="hljs-string">&#x27;0.9rem&#x27;</span>,
                width: <span class="hljs-string">&#x27;100%&#x27;</span>
              }}&gt;
                &lt;CardActionArea href={generateGraphIdUrl(id)}&gt;
                  &lt;CardContent style={{ padding: <span class="hljs-number">0</span> }}&gt;
                    &lt;<span class="hljs-keyword">div</span> className={classes.cardText} style={{
                      display: <span class="hljs-string">&#x27;flex&#x27;</span>,
                      justifyContent: <span class="hljs-string">&#x27;space-between&#x27;</span>
                    }}&gt;
                      &lt;<span class="hljs-keyword">div</span> style={{
                        marginLeft: <span class="hljs-number">10</span>,
                        display: <span class="hljs-string">&#x27;flex&#x27;</span>,
                        flexDirection: <span class="hljs-string">&#x27;row&#x27;</span>
                      }}&gt;
                        &lt;<span class="hljs-keyword">div</span> style={{ display: <span class="hljs-string">&#x27;flex&#x27;</span>, flexDirection: <span class="hljs-string">&#x27;column&#x27;</span>, justifyContent: <span class="hljs-string">&#x27;center&#x27;</span> }}&gt;
                          &lt;<span class="hljs-keyword">div</span> style={{display: <span class="hljs-string">&#x27;flex&#x27;</span>, flexDirection: <span class="hljs-string">&#x27;row&#x27;</span>, alignItems: <span class="hljs-string">&#x27;center&#x27;</span>}}&gt;
                            &lt;span style={{
                              width: <span class="hljs-number">55</span>,
                              margin: <span class="hljs-string">&#x27;0&#x27;</span>,
                              padding: <span class="hljs-string">&#x27;0&#x27;</span>
                            }}&gt;
                              &lt;NetworkLink style={{
                                width: <span class="hljs-number">55</span>,
                                height: <span class="hljs-number">50</span>
                              }} /&gt;
                            &lt;/span&gt;
                            &lt;Typography variant=<span class="hljs-string">&#x27;body2&#x27;</span>
                              style={{
                                margin: <span class="hljs-string">&#x27;0 10px&#x27;</span>,
                                fontSize: <span class="hljs-string">&#x27;1em&#x27;</span>
                              }}&gt;
                              {ownershipNetworkLabel}{<span class="hljs-string">&#x27; &#x27;</span>}
                              {commaSeparatedBolded([
                                <span class="hljs-keyword">description</span>.top_be,
                                <span class="hljs-keyword">description</span>.top_owner,
                                <span class="hljs-keyword">description</span>.top_addr
                              ])}
                            &lt;/Typography&gt;
                          &lt;/<span class="hljs-keyword">div</span>&gt;
                          {explanation_section}
                        &lt;/<span class="hljs-keyword">div</span>&gt;
                      &lt;/<span class="hljs-keyword">div</span>&gt;
                      &lt;<span class="hljs-keyword">div</span> style={{
                        marginLeft: <span class="hljs-number">10</span>,
                        marginRight: <span class="hljs-number">10</span>,
                        whiteSpace: <span class="hljs-string">&#x27;nowrap&#x27;</span>,
                        display: <span class="hljs-string">&#x27;flex&#x27;</span>
                      }}&gt;
                        &lt;Divider orientation=<span class="hljs-string">&#x27;vertical&#x27;</span> flexItem /&gt;
                        &lt;<span class="hljs-keyword">div</span> style={{ 
                          flexDirection: <span class="hljs-string">&#x27;column&#x27;</span>, 
                          marginLeft: <span class="hljs-number">15</span>, 
                          display: <span class="hljs-string">&#x27;flex&#x27;</span>, 
                          justifyContent: <span class="hljs-string">&#x27;center&#x27;</span>}}&gt;
                          &lt;<span class="hljs-keyword">div</span>&gt;{<span class="hljs-keyword">description</span>.num_parcels}{<span class="hljs-string">&#x27; &#x27;</span>}{t(<span class="hljs-string">&#x27;properties&#x27;</span>)}&lt;/<span class="hljs-keyword">div</span>&gt;
                          &lt;<span class="hljs-keyword">div</span>&gt;{<span class="hljs-keyword">description</span>.num_units}{<span class="hljs-string">&#x27; &#x27;</span>}{t(<span class="hljs-string">&#x27;units&#x27;</span>)}&lt;/<span class="hljs-keyword">div</span>&gt;
                        &lt;/<span class="hljs-keyword">div</span>&gt;
                      &lt;/<span class="hljs-keyword">div</span>&gt;
                    &lt;/<span class="hljs-keyword">div</span>&gt;
                  &lt;/CardContent&gt;
                &lt;/CardActionArea&gt;
              &lt;/Card&gt;
            &lt;/Row&gt;
          )
        })
      }
      { <span class="hljs-comment">/* render a &quot;show more&quot; button when there are more than three networks */</span>
        related.length &gt; <span class="hljs-number">3</span> &amp;&amp; showAll === <span class="hljs-keyword">false</span> &amp;&amp;
        &lt;Button className={classes.showMoreButton} onClick={handleShowMoreClick}&gt;
          &lt;Typography variant=<span class="hljs-string">&#x27;body1&#x27;</span>&gt;Show More&lt;<span class="hljs-regexp">/Typography&gt;&lt;ArrowDropDown/</span>&gt;
        &lt;/Button&gt;
      }
    &lt;/&gt;
  )

}

export <span class="hljs-keyword">default</span> memo(NetworkList)</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrccomponentsnotavailable.js"><a href="#toc"><a name="ui-src-components-notavailable-js">ui/src/components/NotAvailable.js</a></a></h2>
<pre><code><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">CircularProgress</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/CircularProgress&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Typography</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/Typography&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Row</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./Grid&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">StorageIcon</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/icons/Storage&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ErrorOutlineIcon</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/icons/ErrorOutline&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ReactComponent</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">BrokenLink</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../images/broken-link.svg&#x27;</span>
<span class="hljs-keyword">import</span> { useTranslation } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-i18next&#x27;</span>
<span class="hljs-keyword">import</span> i18n <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../i18n&#x27;</span>
<span class="hljs-keyword">import</span> theme <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../theme/Theme&#x27;</span>

<span class="hljs-comment">// used for all icons</span>
<span class="hljs-keyword">const</span> iconStyle = {
  <span class="hljs-attr">color</span>: theme.<span class="hljs-property">palette</span>.<span class="hljs-property">common</span>.<span class="hljs-property">OFFWHITE</span>, 
  <span class="hljs-attr">fontSize</span>: <span class="hljs-string">&#x27;5rem&#x27;</span>, 
  <span class="hljs-attr">marginBottom</span>: <span class="hljs-string">&#x27;.5rem&#x27;</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">Loading</span> = 
  (<span class="hljs-params"></span>) =&gt; {

    <span class="hljs-keyword">return</span> (
      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Row</span> <span class="hljs-attr">justify</span>=<span class="hljs-string">&#x27;center&#x27;</span> <span class="hljs-attr">alignItems</span>=<span class="hljs-string">&#x27;center&#x27;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">height:</span> <span class="hljs-attr">100</span> }}&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">CircularProgress</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{iconStyle}</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Row</span>&gt;</span></span>
    )

  }

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">TableLoading</span> =
(<span class="hljs-params"></span>) =&gt; {

  <span class="hljs-keyword">const</span> { t, <span class="hljs-attr">ready</span>: translationReady } = <span class="hljs-title function_">useTranslation</span>(
    <span class="hljs-string">&#x27;Status&#x27;</span>, <span class="hljs-comment">/* i18next-parser needs string here */</span>
    { <span class="hljs-attr">useSuspense</span>: <span class="hljs-literal">false</span>, i18n }
  )

  <span class="hljs-keyword">if</span> (!translationReady) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>

  <span class="hljs-keyword">return</span> (
    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Row</span> <span class="hljs-attr">direction</span>=<span class="hljs-string">&#x27;column&#x27;</span> <span class="hljs-attr">alignItems</span>=<span class="hljs-string">&#x27;center&#x27;</span> <span class="hljs-attr">justify</span>=<span class="hljs-string">&#x27;center&#x27;</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">CircularProgress</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{iconStyle}</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Typography</span> <span class="hljs-attr">variant</span>=<span class="hljs-string">&#x27;body1&#x27;</span>&gt;</span><span class="hljs-symbol">&amp;nbsp;</span><span class="hljs-symbol">&amp;nbsp;</span>{t(&#x27;Loading Table&#x27;)}<span class="hljs-tag">&lt;/<span class="hljs-name">Typography</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Row</span>&gt;</span></span>
  )

}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">NoPage</span> = 
  (<span class="hljs-params"></span>) =&gt; {

    <span class="hljs-keyword">const</span> { t, <span class="hljs-attr">ready</span>: translationReady } = <span class="hljs-title function_">useTranslation</span>(
      <span class="hljs-string">&#x27;Status&#x27;</span>, <span class="hljs-comment">/* i18next-parser needs string here */</span>
      { <span class="hljs-attr">useSuspense</span>: <span class="hljs-literal">false</span>, i18n }
    )

    <span class="hljs-keyword">if</span> (!translationReady) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>

    <span class="hljs-keyword">return</span> (
      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Row</span> <span class="hljs-attr">direction</span>=<span class="hljs-string">&#x27;column&#x27;</span> <span class="hljs-attr">alignItems</span>=<span class="hljs-string">&#x27;center&#x27;</span> <span class="hljs-attr">justify</span>=<span class="hljs-string">&#x27;center&#x27;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">BrokenLink</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">height:</span> <span class="hljs-attr">72</span>, <span class="hljs-attr">fill:</span> <span class="hljs-attr">theme.palette.common.EGGPLANT</span> }}/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Typography</span> <span class="hljs-attr">variant</span>=<span class="hljs-string">&#x27;body1&#x27;</span>&gt;</span>{t(&#x27;Page not found&#x27;)}<span class="hljs-tag">&lt;/<span class="hljs-name">Typography</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Row</span>&gt;</span></span>
    )

  }

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">NoData</span> = 
  (<span class="hljs-params"></span>) =&gt; {

    <span class="hljs-keyword">const</span> { t, <span class="hljs-attr">ready</span>: translationReady } = <span class="hljs-title function_">useTranslation</span>(
      <span class="hljs-string">&#x27;Status&#x27;</span>, <span class="hljs-comment">/* i18next-parser needs string here */</span>
      { <span class="hljs-attr">useSuspense</span>: <span class="hljs-literal">false</span>, i18n }
    )

    <span class="hljs-keyword">if</span> (!translationReady) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>

    <span class="hljs-keyword">return</span> (
      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Row</span> <span class="hljs-attr">direction</span>=<span class="hljs-string">&#x27;column&#x27;</span> <span class="hljs-attr">alignItems</span>=<span class="hljs-string">&#x27;center&#x27;</span> <span class="hljs-attr">justify</span>=<span class="hljs-string">&#x27;center&#x27;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">ErrorOutlineIcon</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{iconStyle}</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Typography</span> <span class="hljs-attr">variant</span>=<span class="hljs-string">&#x27;body1&#x27;</span>&gt;</span>{t(&#x27;Data not available&#x27;)}<span class="hljs-tag">&lt;/<span class="hljs-name">Typography</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Row</span>&gt;</span></span>
    )

  }

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">TableNoData</span> =
  props =&gt; {

    <span class="hljs-keyword">return</span> (
      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Row</span> <span class="hljs-attr">direction</span>=<span class="hljs-string">&#x27;column&#x27;</span> <span class="hljs-attr">alignItems</span>=<span class="hljs-string">&#x27;center&#x27;</span> <span class="hljs-attr">justify</span>=<span class="hljs-string">&#x27;center&#x27;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">StorageIcon</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{iconStyle}</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Typography</span> <span class="hljs-attr">variant</span>=<span class="hljs-string">&#x27;body1&#x27;</span>&gt;</span><span class="hljs-symbol">&amp;nbsp;</span><span class="hljs-symbol">&amp;nbsp;</span>{props.noDataMessage}<span class="hljs-tag">&lt;/<span class="hljs-name">Typography</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Row</span>&gt;</span></span>  
    )
  }

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">Error</span> = 
  (<span class="hljs-params">{ source, error }</span>) =&gt; {

    <span class="hljs-keyword">const</span> { t, <span class="hljs-attr">ready</span>: translationReady } = <span class="hljs-title function_">useTranslation</span>(
      <span class="hljs-string">&#x27;Status&#x27;</span>, <span class="hljs-comment">/* i18next-parser needs string here */</span>
      { <span class="hljs-attr">useSuspense</span>: <span class="hljs-literal">false</span>, i18n }
    )

    <span class="hljs-keyword">if</span> (!translationReady) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>

    <span class="hljs-keyword">return</span> (
      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Row</span> <span class="hljs-attr">direction</span>=<span class="hljs-string">&#x27;column&#x27;</span> <span class="hljs-attr">alignItems</span>=<span class="hljs-string">&#x27;center&#x27;</span> <span class="hljs-attr">justify</span>=<span class="hljs-string">&#x27;center&#x27;</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">ErrorOutlineIcon</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{iconStyle}</span> /&gt;</span>
          
        <span class="hljs-tag">&lt;<span class="hljs-name">Typography</span> <span class="hljs-attr">variant</span>=<span class="hljs-string">&#x27;body1&#x27;</span>&gt;</span>
          {t(&#x27;Error loading &#x27;)}{source}
          <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">fontSize:</span> <span class="hljs-attr">18</span> }} &gt;</span>{error}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Typography</span>&gt;</span>

      <span class="hljs-tag">&lt;/<span class="hljs-name">Row</span>&gt;</span></span>        
    
    )

  }</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrccomponentsownershipnetwork.js"><a href="#toc"><a name="ui-src-components-ownershipnetwork-js">ui/src/components/OwnershipNetwork.js</a></a></h2>
<pre><code><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>
<span class="hljs-keyword">import</span> { useSelector } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-redux&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Card</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/Card&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">CardActionArea</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/CardActionArea&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">CardContent</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/CardContent&#x27;</span>
<span class="hljs-keyword">import</span> { renderOwnerLink, generateGraphIdUrl } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../utils/tableUtils&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ReactComponent</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">NetworkLink</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../images/noun_networking_2148898.svg&#x27;</span>
<span class="hljs-keyword">import</span> { isEmpty, sliceJson } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./DataPage/DataPage&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Typography</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core&#x27;</span>
<span class="hljs-keyword">import</span> { useTranslation } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-i18next&#x27;</span>
<span class="hljs-keyword">import</span> { titleCase } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../utils/stringUtils&#x27;</span>
<span class="hljs-keyword">import</span> i18n <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../i18n&#x27;</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">OwnershipNetwork</span> = props =&gt; {
  <span class="hljs-keyword">const</span> urlParam = props?.<span class="hljs-property">urlParam</span>

  <span class="hljs-keyword">const</span> { t } = <span class="hljs-title function_">useTranslation</span>(<span class="hljs-string">&#x27;Parcel&#x27;</span> <span class="hljs-comment">/* i18next-parser needs string here */</span>, {
    <span class="hljs-attr">useSuspense</span>: <span class="hljs-literal">false</span>,
    i18n,
  })

  <span class="hljs-keyword">const</span> details = <span class="hljs-title function_">useSelector</span>(<span class="hljs-title function_">sliceJson</span>(<span class="hljs-string">`<span class="hljs-subst">${urlParam}</span>-details`</span>))
  <span class="hljs-keyword">const</span> networkDetails = <span class="hljs-title function_">useSelector</span>(<span class="hljs-title function_">sliceJson</span>(<span class="hljs-string">`<span class="hljs-subst">${urlParam}</span>-network-details`</span>))
  <span class="hljs-keyword">const</span> totalNetworkEntities =
    networkDetails.<span class="hljs-property">total_bes</span> + networkDetails.<span class="hljs-property">total_addrs</span> + networkDetails.<span class="hljs-property">total_owners</span>

  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isEmpty</span>(networkDetails) || totalNetworkEntities === <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">return</span> (
      <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Typography</span> <span class="hljs-attr">variant</span>=<span class="hljs-string">&#x27;h2&#x27;</span>&gt;</span>{t(&#x27;Ownership Network&#x27;)}<span class="hljs-tag">&lt;/<span class="hljs-name">Typography</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Typography</span> <span class="hljs-attr">variant</span>=<span class="hljs-string">&#x27;body1&#x27;</span>&gt;</span>
          {t(&#x27;This property does not appear to be part of a larger ownership network.&#x27;)}
        <span class="hljs-tag">&lt;/<span class="hljs-name">Typography</span>&gt;</span>
      <span class="hljs-tag">&lt;/&gt;</span></span>
    )
  }

  <span class="hljs-keyword">const</span> name = details.<span class="hljs-property">addr_details</span>
    ? <span class="hljs-title function_">titleCase</span>(details.<span class="hljs-property">addr_details</span>?.<span class="hljs-property">main_addr</span>)
    : <span class="hljs-title function_">titleCase</span>(details.<span class="hljs-property">name</span>)
  <span class="hljs-keyword">const</span> networkId = details.<span class="hljs-property">network_id</span>

  <span class="hljs-comment">/* If there are businesses, render the total number of businesses with a linked example */</span>
  <span class="hljs-comment">/* E.g. &quot;10 businesses, such as Veritas Investments Inc,&quot; */</span>
  <span class="hljs-keyword">const</span> business_text_section =
    networkDetails.<span class="hljs-property">total_bes</span> === <span class="hljs-number">0</span> ? (
      <span class="hljs-string">&#x27;&#x27;</span>
    ) : (
      <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span>
        {t(&#x27;{{total_businesses}} {{business_text}}&#x27;, {
          total_businesses: networkDetails.total_bes,
          business_text:
            networkDetails.total_bes &gt; 1 ? &#x27;businesses, such as &#x27; : &#x27;business, namely &#x27;,
        })}
        {renderOwnerLink(networkDetails.top_be.name_norm, networkDetails.top_be.__typename)}
        {networkDetails.top_addr || networkDetails.top_owner ? t(&#x27;,&#x27;) : &#x27;&#x27;}
      <span class="hljs-tag">&lt;/&gt;</span></span>
    )

  <span class="hljs-comment">/* If there are addresses, render an example */</span>
  <span class="hljs-comment">/* E.g. &quot; 10 business office or property owner addresses, such 123 Main St CA, and&quot; */</span>
  <span class="hljs-keyword">const</span> addr_text_section =
    networkDetails.<span class="hljs-property">total_addrs</span> === <span class="hljs-number">0</span> ? (
      <span class="hljs-string">&#x27;&#x27;</span>
    ) : (
      <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span>
        {t(&#x27; {{total_addrs}} {{addr_type}} {{addr_text}}{{addr_example}}&#x27;, {
          total_addrs: networkDetails.total_addrs,
          addr_type: networkDetails.top_addr.is_business
            ? networkDetails.top_addr.is_property_owner
              ? t(&#x27;business office and property owner&#x27;)
              : t(&#x27;business office&#x27;)
            : t(&#x27;property owner&#x27;),
          addr_text: networkDetails.total_addrs &gt; 1 ? &#x27;addresses, such as &#x27; : &#x27;address, namely &#x27;,
          addr_example: titleCase(networkDetails.top_addr.addr_readable),
        })}
        {networkDetails.top_owner ? t(&#x27;, and&#x27;) : &#x27;&#x27;}
      <span class="hljs-tag">&lt;/&gt;</span></span>
    )

  <span class="hljs-comment">/* If there are owners, render an example */</span>
  <span class="hljs-comment">/* E.g. &quot; 5 business owners, such as David McCloskey&quot; */</span>
  <span class="hljs-keyword">const</span> owner_text_section =
    networkDetails.<span class="hljs-property">total_owners</span> === <span class="hljs-number">0</span> ? (
      <span class="hljs-string">&#x27;&#x27;</span>
    ) : (
      <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span>
        {t(&#x27; {{total_owners}} {{owner_text}}{{owner_example}}&#x27;, {
          total_owners: networkDetails.total_owners,
          owner_text:
            networkDetails.total_owners &gt; 1
              ? &#x27; business owners, such as &#x27;
              : &#x27; business owner, namely &#x27;,
          owner_example: titleCase(networkDetails.top_owner.name_norm),
        })}
      <span class="hljs-tag">&lt;/&gt;</span></span>
    )
  <span class="hljs-keyword">return</span> (
    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Typography</span> <span class="hljs-attr">variant</span>=<span class="hljs-string">&#x27;h2&#x27;</span>&gt;</span>{t(&#x27;Ownership Network&#x27;)}<span class="hljs-tag">&lt;/<span class="hljs-name">Typography</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Typography</span> <span class="hljs-attr">variant</span>=<span class="hljs-string">&#x27;body1&#x27;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>{name}<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span>
        {t(&#x27; is part of an ownership network with &#x27;)}
        {business_text_section}
        {addr_text_section}
        {owner_text_section}
        {t(&#x27;.&#x27;)}
      <span class="hljs-tag">&lt;/<span class="hljs-name">Typography</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Card</span>
        <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span>
          <span class="hljs-attr">borderRadius:</span> <span class="hljs-attr">5</span>,
          <span class="hljs-attr">marginBottom:</span> <span class="hljs-attr">15</span>,
          <span class="hljs-attr">border:</span> <span class="hljs-attr">0</span>,
          <span class="hljs-attr">width:</span> &#x27;<span class="hljs-attr">57ch</span>&#x27;,
        }}&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">CardActionArea</span> <span class="hljs-attr">href</span>=<span class="hljs-string">{generateGraphIdUrl(networkId)}</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">CardContent</span>
            <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span>
              <span class="hljs-attr">display:</span> &#x27;<span class="hljs-attr">flex</span>&#x27;,
              <span class="hljs-attr">alignItems:</span> &#x27;<span class="hljs-attr">center</span>&#x27;,
              <span class="hljs-attr">padding:</span> &#x27;<span class="hljs-attr">20px</span>&#x27;,
            }}&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">NetworkLink</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">width:</span> <span class="hljs-attr">55</span>, <span class="hljs-attr">height:</span> <span class="hljs-attr">50</span> }} /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Typography</span> <span class="hljs-attr">variant</span>=<span class="hljs-string">&#x27;body2&#x27;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">margin:</span> &#x27;<span class="hljs-attr">0</span> <span class="hljs-attr">10px</span>&#x27;, <span class="hljs-attr">fontSize:</span> &#x27;<span class="hljs-attr">0.9rem</span>&#x27; }}&gt;</span>
              Click here to learn more about who is behind this network.
            <span class="hljs-tag">&lt;/<span class="hljs-name">Typography</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">CardContent</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">CardActionArea</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Card</span>&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span></span>
  )
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">OwnershipNetwork</span>
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrccomponentspagetitle.js"><a href="#toc"><a name="ui-src-components-pagetitle-js">ui/src/components/PageTitle.js</a></a></h2>
<pre><code><span class="hljs-keyword">import</span> React, { memo } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>
<span class="hljs-keyword">import</span> { useSelector } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-redux&#x27;</span>
<span class="hljs-keyword">import</span> { Typography } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core&#x27;</span>
<span class="hljs-keyword">import</span> { sliceJson, <span class="hljs-keyword">isNull</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./Data/DataUtils&#x27;</span>

const PageTitle = props =&gt; {

  const <span class="hljs-keyword">slice</span> = props.<span class="hljs-keyword">slice</span>
  const appendTextSelector = props.appendTextSelector
  const <span class="hljs-type">text</span> = props.text
  const resultJson = useSelector(sliceJson(<span class="hljs-keyword">slice</span>))

  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isNull</span>(resultJson))
    <span class="hljs-keyword">return</span> &lt;Typography variant=<span class="hljs-string">&#x27;h1&#x27;</span>&gt;{<span class="hljs-type">text</span>}&lt;/Typography&gt;

  <span class="hljs-keyword">return</span> (
    &lt;Typography variant=<span class="hljs-string">&#x27;h1&#x27;</span>&gt;
      {<span class="hljs-type">text</span>}
      {typeof appendTextSelector === <span class="hljs-string">&#x27;function&#x27;</span>
        ? appendTextSelector(resultJson) : <span class="hljs-string">&#x27;&#x27;</span>}
    &lt;/Typography&gt;
  )

}

export <span class="hljs-keyword">default</span> memo(PageTitle)</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrccomponentspropertylist.js"><a href="#toc"><a name="ui-src-components-propertylist-js">ui/src/components/PropertyList.js</a></a></h2>
<pre><code><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { memo } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>
<span class="hljs-keyword">import</span> { useSelector } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-redux&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Typography</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">DataTable</span>, { isEmpty, sliceJson } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./DataTable/DataTable&#x27;</span>
<span class="hljs-keyword">import</span> { titleCase } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../utils/stringUtils&#x27;</span>
<span class="hljs-keyword">import</span> { useTranslation } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-i18next&#x27;</span>
<span class="hljs-keyword">import</span> i18n <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../i18n&#x27;</span>
<span class="hljs-keyword">import</span> { renderParcelLink, renderOwnerLink } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../utils/tableUtils&#x27;</span>

<span class="hljs-comment">/*
  PropertyList: render a table with a list of properties
*/</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">PropertyList</span> = props =&gt; {
  <span class="hljs-keyword">const</span> portfolio = <span class="hljs-title function_">useSelector</span>(<span class="hljs-title function_">sliceJson</span>(props.<span class="hljs-property">portfolioSlice</span>)) ?? []
  <span class="hljs-keyword">const</span> noDataMessage = props.<span class="hljs-property">noDataMessage</span>
  <span class="hljs-keyword">const</span> title = props.<span class="hljs-property">title</span>
  <span class="hljs-keyword">const</span> subTitle = props.<span class="hljs-property">subTitle</span>
  <span class="hljs-keyword">const</span> { t, <span class="hljs-attr">ready</span>: translationReady } = <span class="hljs-title function_">useTranslation</span>(
    <span class="hljs-string">&#x27;List&#x27;</span>, <span class="hljs-comment">/* i18next-parser needs string here */</span>
    { <span class="hljs-attr">useSuspense</span>: <span class="hljs-literal">false</span>, i18n }
  )

  <span class="hljs-keyword">if</span> (!translationReady) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>

  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isEmpty</span>(portfolio)) {
    <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Typography</span> <span class="hljs-attr">variant</span>=<span class="hljs-string">&#x27;h2&#x27;</span>&gt;</span>{title}<span class="hljs-tag">&lt;/<span class="hljs-name">Typography</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Typography</span> <span class="hljs-attr">variant</span>=<span class="hljs-string">&#x27;body1&#x27;</span>&gt;</span>{noDataMessage}<span class="hljs-tag">&lt;/<span class="hljs-name">Typography</span>&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span></span>
  }
  
  <span class="hljs-comment">// Structure API data so that we don&#x27;t have to do this</span>
  <span class="hljs-keyword">const</span> tableData = portfolio.<span class="hljs-title function_">map</span>(
    <span class="hljs-function">(<span class="hljs-params">e, i</span>) =&gt;</span> ({
      <span class="hljs-attr">addr</span>: <span class="hljs-title function_">titleCase</span>(e.<span class="hljs-property">addr</span> || e.<span class="hljs-property">location</span>?.<span class="hljs-property">addr</span>),
      <span class="hljs-attr">block_lot</span>: e.<span class="hljs-property">block_lot</span> || e.<span class="hljs-property">location</span>?.<span class="hljs-property">block_lot</span>,
      <span class="hljs-attr">num_evictions</span>: e.<span class="hljs-property">num_evictions</span>,
      <span class="hljs-attr">units</span>: e.<span class="hljs-property">units</span>,
      <span class="hljs-attr">typename</span>: e.<span class="hljs-property">owners</span>[<span class="hljs-number">0</span>].<span class="hljs-property">linked_be</span>?.<span class="hljs-property">__typename</span> ?? <span class="hljs-string">&#x27;&#x27;</span>,
      <span class="hljs-attr">owner_name</span>: e.<span class="hljs-property">owners</span>[<span class="hljs-number">0</span>].<span class="hljs-property">owner_name</span> ?? <span class="hljs-string">&#x27;&#x27;</span>,
      <span class="hljs-attr">be_type</span>: e.<span class="hljs-property">owners</span>?.[<span class="hljs-number">0</span>]?.<span class="hljs-property">linked_be</span>?.<span class="hljs-property">__typename</span> ?? <span class="hljs-string">&#x27;&#x27;</span>,
      <span class="hljs-attr">owner_addr</span>: <span class="hljs-title function_">titleCase</span>(e.<span class="hljs-property">owner_mailing_addr</span> || e.<span class="hljs-property">mailing_address</span>) 
    })
  ) ?? []

  <span class="hljs-comment">/* Count occurences of the data for each column */</span>
  <span class="hljs-keyword">const</span> countAddr = portfolio.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">row</span> =&gt;</span> <span class="hljs-keyword">typeof</span> row.<span class="hljs-property">addr</span> !== <span class="hljs-string">&#x27;undefined&#x27;</span>).<span class="hljs-property">length</span>
  <span class="hljs-keyword">const</span> countOwnerName = portfolio.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">row</span> =&gt;</span> <span class="hljs-keyword">typeof</span> row.<span class="hljs-property">owners</span>?.[<span class="hljs-number">0</span>]?.<span class="hljs-property">owner_name</span> !== <span class="hljs-string">&#x27;undefined&#x27;</span>).<span class="hljs-property">length</span>
  <span class="hljs-keyword">const</span> countUnits = portfolio.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">row</span> =&gt;</span> <span class="hljs-keyword">typeof</span> row.<span class="hljs-property">units</span> !== <span class="hljs-string">&#x27;undefined&#x27;</span>).<span class="hljs-property">length</span>
  <span class="hljs-keyword">const</span> countNumEvictions = portfolio.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">row</span> =&gt;</span> <span class="hljs-keyword">typeof</span> row.<span class="hljs-property">num_evictions</span> !== <span class="hljs-string">&#x27;undefined&#x27;</span>).<span class="hljs-property">length</span>
  <span class="hljs-keyword">const</span> countOwnerAddr = portfolio.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">row</span> =&gt;</span> row.<span class="hljs-property">owner_mailing_addr</span> || row.<span class="hljs-property">mailing_address</span>).<span class="hljs-property">length</span>
  <span class="hljs-keyword">const</span> columns = []
  <span class="hljs-comment">/* Display columns with at least one data item */</span>

  countAddr &gt; <span class="hljs-number">0</span> &amp;&amp; columns.<span class="hljs-title function_">push</span>({
    <span class="hljs-attr">field</span>: <span class="hljs-string">&#x27;addr&#x27;</span>,
    <span class="hljs-attr">headerName</span>: <span class="hljs-string">&#x27;Address&#x27;</span>,
    <span class="hljs-attr">flex</span>: <span class="hljs-number">2</span>,
    <span class="hljs-attr">renderCell</span>: <span class="hljs-function"><span class="hljs-params">p</span> =&gt;</span> <span class="hljs-title function_">renderParcelLink</span>(
      p.<span class="hljs-property">row</span>.<span class="hljs-property">block_lot</span> || p.<span class="hljs-property">row</span>.<span class="hljs-property">location</span>?.<span class="hljs-property">block_lot</span>,
      <span class="hljs-title function_">titleCase</span>(p.<span class="hljs-property">row</span>.<span class="hljs-property">addr</span> || p.<span class="hljs-property">row</span>.<span class="hljs-property">location</span>?.<span class="hljs-property">addr</span>)
    )
  })

  countOwnerName &gt; <span class="hljs-number">0</span> &amp;&amp; columns.<span class="hljs-title function_">push</span>(
    { <span class="hljs-attr">field</span>: <span class="hljs-string">&#x27;owner_name&#x27;</span>, <span class="hljs-attr">headerName</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">&#x27;Owner Name&#x27;</span>), <span class="hljs-attr">flex</span>: <span class="hljs-number">3</span>,
      <span class="hljs-attr">renderCell</span>: <span class="hljs-function"><span class="hljs-params">p</span> =&gt;</span> <span class="hljs-title function_">renderOwnerLink</span>(
        p.<span class="hljs-property">row</span>.<span class="hljs-property">owner_name</span>,
        p.<span class="hljs-property">row</span>.<span class="hljs-property">be_type</span>
      )
    }
  )

  countOwnerAddr &gt; <span class="hljs-number">0</span> &amp;&amp; columns.<span class="hljs-title function_">push</span>(
    { <span class="hljs-attr">field</span>: <span class="hljs-string">&#x27;owner_addr&#x27;</span>, <span class="hljs-attr">headerName</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">&#x27;Owner Mailing Address&#x27;</span>), <span class="hljs-attr">flex</span>: <span class="hljs-number">3</span>, 
      <span class="hljs-attr">renderCell</span>: <span class="hljs-function"><span class="hljs-params">p</span> =&gt;</span> p.<span class="hljs-property">row</span>.<span class="hljs-property">owner_addr</span>
    }
  )

  countUnits &gt; <span class="hljs-number">0</span> &amp;&amp; columns.<span class="hljs-title function_">push</span>(
    { <span class="hljs-attr">field</span>: <span class="hljs-string">&#x27;units&#x27;</span>, <span class="hljs-attr">headerName</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">&#x27;# of Units&#x27;</span>), <span class="hljs-attr">flex</span>: <span class="hljs-number">1.5</span>,
      <span class="hljs-attr">renderCell</span>: <span class="hljs-function"><span class="hljs-params">p</span> =&gt;</span> p.<span class="hljs-property">row</span>.<span class="hljs-property">units</span> ? p.<span class="hljs-property">row</span>.<span class="hljs-property">units</span> : <span class="hljs-string">&#x27;Unknown&#x27;</span>
    }
  )

  countNumEvictions &gt; <span class="hljs-number">0</span> &amp;&amp; columns.<span class="hljs-title function_">push</span>(
    { <span class="hljs-attr">field</span>: <span class="hljs-string">&#x27;num_evictions&#x27;</span>, <span class="hljs-attr">headerName</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">&#x27;Evictions Filed&#x27;</span>), <span class="hljs-attr">flex</span>: <span class="hljs-number">1.5</span> }
  )
  
  <span class="hljs-keyword">return</span> (
    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Typography</span> <span class="hljs-attr">variant</span>=<span class="hljs-string">&#x27;h2&#x27;</span>&gt;</span>{title}<span class="hljs-tag">&lt;/<span class="hljs-name">Typography</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Typography</span> <span class="hljs-attr">variant</span>=<span class="hljs-string">&#x27;body1&#x27;</span>&gt;</span>{subTitle}<span class="hljs-tag">&lt;/<span class="hljs-name">Typography</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">DataTable</span>
        <span class="hljs-attr">sortModel</span>=<span class="hljs-string">{[{</span> <span class="hljs-attr">field:</span> &#x27;<span class="hljs-attr">addr</span>&#x27;, <span class="hljs-attr">sort:</span> &#x27;<span class="hljs-attr">asc</span>&#x27; }]}
        <span class="hljs-attr">name</span>=<span class="hljs-string">&#x27;properties&#x27;</span>
        {<span class="hljs-attr">...props</span>}
        <span class="hljs-attr">rows</span>=<span class="hljs-string">{tableData}</span>
        <span class="hljs-attr">columns</span>=<span class="hljs-string">{columns}</span>
      /&gt;</span>
      {/*<span class="hljs-tag">&lt;<span class="hljs-name">CSVLink</span> <span class="hljs-attr">data</span>=<span class="hljs-string">{RelatedParcelsCSV(csvData)}</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;parcel-link&quot;</span> <span class="hljs-attr">filename</span>=<span class="hljs-string">{toUnderscore(titleCase(parcelAddress)</span> + &#x27;<span class="hljs-attr">_related_properties.csv</span>&#x27;)}&gt;</span>Download Connected Properties as CSV<span class="hljs-tag">&lt;/<span class="hljs-name">CSVLink</span>&gt;</span>*/}
    <span class="hljs-tag">&lt;/&gt;</span></span>
  )
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">memo</span>(<span class="hljs-title class_">PropertyList</span>)</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrcconfigconfig.json"><a href="#toc"><a name="ui-src-config-config-json">ui/src/config/config.json</a></a></h2>
<pre><code>{
  <span class="hljs-string">&quot;map&quot;</span>: {
    <span class="hljs-string">&quot;MAPBOX_TOKEN&quot;</span>: <span class="hljs-string">&quot;pk.eyJ1IjoiZHBzYWthZ3VjaGkiLCJhIjoiY2pwenpzcHd3MGhqZjQydWxvbDN3bTFjbSJ9.B7PhleBjh8qFmWLkjkWGRQ&quot;</span>,
    <span class="hljs-string">&quot;attribution&quot;</span>: <span class="hljs-string">&quot;&lt;a href=&#x27;</span>https:<span class="hljs-comment">//antievictionmap.com/&#x27;&gt;&amp;copy; Anti Eviction Mapping Project&lt;/a&gt;&amp;nbsp;|&amp;nbsp;&lt;a href=&#x27;https://leafletjs.com/&#x27;&gt;Leaflet&lt;/a&gt;&quot;,</span>
    <span class="hljs-string">&quot;regions&quot;</span>: {
      <span class="hljs-string">&quot;SanFrancisco&quot;</span>: {
        <span class="hljs-string">&quot;defaultCoordinates&quot;</span>: { <span class="hljs-string">&quot;lat&quot;</span>: <span class="hljs-number">37.7749</span>, <span class="hljs-string">&quot;long&quot;</span>: <span class="hljs-number">-122.4194</span> }
      },
      <span class="hljs-string">&quot;Oakland&quot;</span>: { 
        <span class="hljs-string">&quot;defaultCoordinates&quot;</span>: { <span class="hljs-string">&quot;lat&quot;</span>: <span class="hljs-number">37.8044</span>, <span class="hljs-string">&quot;long&quot;</span>: <span class="hljs-number">-122.2712</span> }
      },
      <span class="hljs-string">&quot;LosAngeles&quot;</span>: {
        <span class="hljs-string">&quot;defaultCoordinates&quot;</span>: { <span class="hljs-string">&quot;lat&quot;</span>: <span class="hljs-number">34.0522</span>, <span class="hljs-string">&quot;long&quot;</span>: <span class="hljs-number">-118.2437</span> }
      }
    }
  },
  <span class="hljs-string">&quot;categories&quot;</span>: {
    <span class="hljs-string">&quot;BUSINESS_ENTITY&quot;</span>: <span class="hljs-string">&quot;2&quot;</span>,
    <span class="hljs-string">&quot;NEIGHBORHOOD_SUMMARY&quot;</span>: <span class="hljs-string">&quot;1&quot;</span>,
    <span class="hljs-string">&quot;PARCEL&quot;</span>: <span class="hljs-string">&quot;0&quot;</span>
  }
}</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrcconfigstyle-guide.txt"><a href="#toc"><a name="ui-src-config-style-guide-txt">ui/src/config/style-guide.txt</a></a></h2>
<pre><code>Notes on Evictorbook FE style

### Useful links ###
  - EvictorBook developer guide https:<span class="hljs-comment">//docs.google.com/document/d/1NnJ_Yd_Av8S2bFs5MceeA73BXmx0Ebvy_hJ4xNJI1IA/edit

### Information pages ###
(such as Disclaimer, Methodology, etc.)
- By default the page background will be eggplant, and there will be 100px of padding on the bottom, provided by the Footer. Font color will be provided by the theme. If you&#x27;re implementing a new feature like this, follow the same basic arrangement as the existing pages.

### Colors ###
- Theme colors are stored in src/theme/theme.js. 

### Fonts ###
- Headings:
  - Font: Oswald
- Paragraphs: 
  - Font: Source Sans
- Make sure to add the translation for every bit of Typography that needs to be translated.
- Dynamic values from the database should not be translated
- The link to retrieve those Google fonts is in ui/public/index.html, and then imported into the appropriate scss files. </span></pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrci18n.js"><a href="#toc"><a name="ui-src-i18n-js">ui/src/i18n.js</a></a></h2>
<pre><code><span class="hljs-keyword">import</span> i18n <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;i18next&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Backend</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;i18next-http-backend&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">LanguageDetector</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;i18next-browser-languagedetector&#x27;</span>
<span class="hljs-keyword">import</span> { initReactI18next } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-i18next&#x27;</span>

<span class="hljs-comment">/*
  i18n Initialization
  notes:

    Language Translations In This Application

      This application uses react-i18next and associated libraries to perform
      translation from English to languages such as Chinese and Spanish.

      Translation files are located under ui/public/locales and are in JSON
      format. There is a folder under &#x27;locales&#x27; for each language.

      The translations must be performed by hand by copying the files
      under the &#x27;en&#x27; folder to other folders such as &#x27;zh&#x27; (Chinese)
      and &#x27;es&#x27; (Spanish). The JSON files have key/value pairs. The key must
      remain untranslated, and the value on the right of the : is what should
      be translated. Spaces in the text should be preserved unless there is
      a language reason not to. Variables wrapped with {{ and }} should be
      preserved and not translated or they will not work.

      Only static text that does not change on the site can be translated.
      If the data itself is in English, it must remain in English even if
      a translation is in use.

      The t() function performs the translation. The first argument is the key,
      which in this application is the text which also will be translated.
      The second argument is an object with variables embedded in the text
      string of the first argument.

      When changing the source code for the translations, make one change at
      a time and test that the parser picks up the changes, as it is unable
      to detect some code syntax, so there can be unexpected quirks

      It is not necessary to edit the JSON translation files manually, for
      the most part.

      Run &#x27;npx i18next&#x27; in the &#x27;ui&#x27; directory to parse source files and
      automatically extract text per config file &#x27;ui/i18next-parser.config.js&#x27;.
      The configuration can be changed to support what you are trying to do.

      The parser will remove keys that no longer exist. Any new keys will be
      added to the file, and existing keys will not automatically be updated.
      The parser can create _plural keys when certain variables are present,
      but the text grammar needs to be manually updated.

      The translation JSON files need to be curated to update the grammar for
      plurals and to remove any falsely detected plurals as well as to find
      any oddities.

      If the text in these files needs to be changed, it must be changed in
      the source code first, then &#x27;npx i18next&#x27; run from the &#x27;ui&#x27; folder in
      order to re-add the modified text.

      Below is the configuration for i18n within the application. This is
      different from the configuration for i18next-parser.

      To see all status messages for i18n in the console, set debug to
      enabled in the configuration below.
*/</span>

i18n
  .<span class="hljs-title function_">use</span>(<span class="hljs-title class_">Backend</span>)
  .<span class="hljs-title function_">use</span>(<span class="hljs-title class_">LanguageDetector</span>)
  .<span class="hljs-title function_">use</span>(initReactI18next)
  .<span class="hljs-title function_">init</span>({
    <span class="hljs-attr">backend</span>: {
      <span class="hljs-attr">loadPath</span>: <span class="hljs-string">&#x27;locales/{{lng}}/{{ns}}.json&#x27;</span>,
      <span class="hljs-attr">allowMultiLoading</span>: <span class="hljs-literal">false</span>
    },
    <span class="hljs-attr">lng</span>: <span class="hljs-string">&#x27;en&#x27;</span>,
    <span class="hljs-attr">load</span>: <span class="hljs-string">&#x27;all&#x27;</span>,
    <span class="hljs-attr">ns</span>: [<span class="hljs-string">&#x27;Home&#x27;</span>, <span class="hljs-string">&#x27;Search&#x27;</span>, <span class="hljs-string">&#x27;Parcel&#x27;</span>, <span class="hljs-string">&#x27;Owner&#x27;</span>, <span class="hljs-string">&#x27;Evictions&#x27;</span>, <span class="hljs-string">&#x27;List&#x27;</span>, <span class="hljs-string">&#x27;Disclaimer&#x27;</span>,
      <span class="hljs-string">&#x27;Network&#x27;</span>, <span class="hljs-string">&#x27;Glossary&#x27;</span>, <span class="hljs-string">&#x27;Methodology&#x27;</span>, <span class="hljs-string">&#x27;Footer&#x27;</span>, <span class="hljs-string">&#x27;Map&#x27;</span>, <span class="hljs-string">&#x27;Status&#x27;</span>],
    <span class="hljs-attr">whitelist</span>: [<span class="hljs-string">&#x27;en&#x27;</span>],
    <span class="hljs-attr">debug</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">/* Disable console logging for i18n in general */</span>
    <span class="hljs-attr">fallbackLng</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">interpolation</span>: { <span class="hljs-attr">escapeValue</span>: <span class="hljs-literal">false</span> },
    <span class="hljs-attr">nsSeparator</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">keySeparator</span>: <span class="hljs-literal">false</span>
  })

<span class="hljs-comment">/* Enable console logging for errors */</span>
i18n.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;missingKey&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">lng, namespace, key, fallbackValue</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(lng, namespace, key, fallbackValue)
})
i18n.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;failedLoading&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">lng, namespace, msg</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(lng, namespace, msg)
})

<span class="hljs-comment">/* Enable console logging when the language changes */</span>
i18n.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;languageChanged&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">lng</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Language changed to <span class="hljs-subst">${lng}</span> `</span>)
})

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> i18n</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrcindex.js"><a href="#toc"><a name="ui-src-index-js">ui/src/index.js</a></a></h2>
<pre><code><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>
<span class="hljs-keyword">import</span> { render } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-dom&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/App&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Provider</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-redux&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Store</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./state/store.js&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ThemeProvider</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/styles&#x27;</span>
<span class="hljs-keyword">import</span> theme <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./theme/Theme&#x27;</span>
<span class="hljs-keyword">import</span> L <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;leaflet&#x27;</span> <span class="hljs-comment">//regular leaflet</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">CssBaseline</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/CssBaseline&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;mapbox-gl/dist/mapbox-gl.css&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;leaflet/dist/leaflet.css&#x27;</span> <span class="hljs-comment">//regular leaflet css</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;react-leaflet-markercluster/dist/styles.min.css&#x27;</span> <span class="hljs-comment">//markerCluster</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;@fontsource/roboto/300.css&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;@fontsource/roboto/400.css&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;@fontsource/roboto/500.css&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;@fontsource/roboto/700.css&#x27;</span>
 
<span class="hljs-comment">//annoying hack to deal with webpack and marker icon</span>
<span class="hljs-keyword">delete</span> L.<span class="hljs-property">Icon</span>.<span class="hljs-property">Default</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">_getIconUrl</span>

L.<span class="hljs-property">Icon</span>.<span class="hljs-property">Default</span>.<span class="hljs-title function_">mergeOptions</span>({
  <span class="hljs-attr">iconRetinaUrl</span>: <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;leaflet/dist/images/marker-icon-2x.png&#x27;</span>),
  <span class="hljs-attr">iconUrl</span>: <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;leaflet/dist/images/marker-icon.png&#x27;</span>),
  <span class="hljs-attr">shadowUrl</span>: <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;leaflet/dist/images/marker-shadow.png&#x27;</span>)
})

<span class="hljs-title function_">render</span>(
  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Provider</span> <span class="hljs-attr">store</span>=<span class="hljs-string">{Store}</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ThemeProvider</span> <span class="hljs-attr">theme</span>=<span class="hljs-string">{theme}</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">CssBaseline</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">ThemeProvider</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">Provider</span>&gt;</span></span>,
  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;root&#x27;</span>)
)</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrcpagesdisclaimer.js"><a href="#toc"><a name="ui-src-pages-disclaimer-js">ui/src/pages/Disclaimer.js</a></a></h2>
<pre><code><span class="hljs-keyword">import</span> React, { memo } from <span class="hljs-comment">&#x27;react&#x27;</span>
<span class="hljs-keyword">import</span> { Link as RouterLink } from <span class="hljs-comment">&#x27;react-router-dom&#x27;</span>
<span class="hljs-keyword">import</span> Typography from <span class="hljs-comment">&#x27;@material-ui/core/Typography&#x27;</span>
<span class="hljs-keyword">import</span> { Row, Col } from <span class="hljs-comment">&#x27;../components/Grid&#x27;</span>
<span class="hljs-keyword">import</span> { useTranslation } from <span class="hljs-comment">&#x27;react-i18next&#x27;</span>
<span class="hljs-keyword">import</span> i18n from <span class="hljs-comment">&#x27;../i18n&#x27;</span>
<span class="hljs-keyword">import</span> { useTheme } from <span class="hljs-comment">&#x27;@material-ui/core/styles&#x27;</span>
<span class="hljs-keyword">import</span> PageTitle from <span class="hljs-comment">&#x27;../components/PageTitle&#x27;</span>
<span class="hljs-keyword">import</span> Link from <span class="hljs-comment">&#x27;@material-ui/core/Link&#x27;</span>

<span class="hljs-keyword">const</span> lineBreak = &lt;span style={{ width: <span class="hljs-comment">&#x27;100%&#x27;, display: &#x27;inline-block&#x27; }} /&gt;</span>

<span class="hljs-keyword">const</span> Disclaimer = () =&gt; {

  <span class="hljs-keyword">const</span> theme = useTheme()
  <span class="hljs-keyword">const</span> { t, ready: translationReady } = useTranslation(
    <span class="hljs-comment">&#x27;Disclaimer&#x27;, /* i18next-parser needs string here */</span>
    { useSuspense: <span class="hljs-literal">false</span>, i18n }
  )
  
  <span class="hljs-keyword">if</span> (!translationReady) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>

  <span class="hljs-keyword">return</span> (
    &lt;Row justify=<span class="hljs-comment">&#x27;center&#x27;&gt;</span>
      &lt;Col xs={<span class="hljs-number">10</span>} sm={<span class="hljs-number">8</span>} md={<span class="hljs-number">6</span>}&gt;
        &lt;PageTitle text={t(<span class="hljs-comment">&#x27;Disclaimer&#x27;)} /&gt;</span>
        &lt;hr style={{ backgroundColor: theme.palette.common.white }} /&gt;
        &lt;Typography variant=<span class="hljs-comment">&#x27;body1&#x27;&gt;</span>
          {t(<span class="hljs-comment">&#x27;The information on this website is sourced from publicly available data that is provided by, created by, and maintained by third-party sites. We are making that data available here. &#x27;)}</span>
          &lt;Link
            style={{textDecoration: <span class="hljs-comment">&#x27;underline&#x27;, fontWeight: &#x27;bold&#x27;}}</span>
            <span class="hljs-keyword">to</span>={{ pathname: <span class="hljs-comment">&#x27;/methodology&#x27; }}</span>
            component={RouterLink}&gt;
            {t(<span class="hljs-comment">&#x27;Our methodology page&#x27;)}</span>
          &lt;/Link&gt;
          {t(<span class="hljs-comment">&#x27; lists the sources we use, as well as the dates on which we last retrieved data from each source. We do not collect data on the users of this website.&#x27;)}</span>
          {lineBreak}
          {t(<span class="hljs-comment">&#x27;An evictor is defined here as an entity or corporation taking legal action to remove someone from occupying a building. Evictions themselves are not defamatory. Moreover, the appearance of a person, entity, or corporation on this website does not necessarily mean that they have evicted someone or taken advantage of eviction laws.&#x27;)}</span>
          {lineBreak}
          {t(<span class="hljs-comment">&#x27;The information on this website is provided “as is,” “as available,” and “with all faults.” Your access to, any reliance upon, and/or use of the information is at your sole risk. To the fullest extent permissible by law, Mapping Action Collective and Anti-Eviction Mapping Project hereby disclaim all express or implied warranties of any kind including but not limited to accuracy and non-infringement, and make no representations, warranties, endorsements, or promises, express or implied, in connection with, or otherwise directly or indirectly related to, the information provided on this website. Under no circumstances shall Mapping Action Collective or Anti-Eviction Mapping Project or its members, employees, volunteers, and affiliates be liable for any indirect, incidental, punitive, special, or consequential damages (including but not limited to damages from personal injury and/or death, lost revenues or profits, loss of business or loss of data) that are directly or indirectly related to the use of the website.&#x27;)}</span>
          {lineBreak}
          {t(<span class="hljs-comment">&#x27;The information on this website does not constitute legal advice and must not be used as a substitute for the advice of a lawyer qualified to give advice on legal issues pertaining to housing. We can help direct you to free legal services if necessary.&#x27;)}</span>
          {lineBreak}
          {t(<span class="hljs-comment">&#x27;We at the Mapping Action Collective and Anti-Eviction Mapping Project do not condone any violent, harassing, threatening, or destructive behavior directed at landlords, their families, their associates, or their property, or at anyone else. Rather, we encourage our website users to conduct themselves peacefully and responsibly at all times.&#x27;)}</span>
        &lt;/Typography&gt;
      &lt;/Col&gt;
    &lt;/Row&gt;
  )

}

export <span class="hljs-keyword">default</span> memo(Disclaimer)</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrcpagesevictionpage.js"><a href="#toc"><a name="ui-src-pages-evictionpage-js">ui/src/pages/EvictionPage.js</a></a></h2>
<pre><code><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useState, useMemo, useRef } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>
<span class="hljs-keyword">import</span> { useSelector } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-redux&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Typography</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">InfoBox</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../components/DataMap/Overlays/InfoBox&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">MapIcon</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/icons/Map&#x27;</span>
<span class="hljs-keyword">import</span> { isEmpty, urlParam } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../components/DataTable/DataTable&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">DataMap</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../components/DataMap/DataMap&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">DataPage</span>, { sliceJson } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../components/DataPage/DataPage&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Row</span>, <span class="hljs-title class_">Col</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../components/Grid&#x27;</span>
<span class="hljs-keyword">import</span> { titleCase, reformatDate } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../utils/stringUtils&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Overlay</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../components/DataMap/Overlays/Overlay&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ReactComponent</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">EvictionIcon</span> }
  <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../components/DataMap/Map/map_icons/directly-evicted-icon.svg&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">PageTitle</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../components/PageTitle&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">EvictionList</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../components/EvictionList&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Legend</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../components/DataMap/Overlays/Legend&#x27;</span>
<span class="hljs-keyword">import</span> { useTranslation } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-i18next&#x27;</span>
<span class="hljs-keyword">import</span> i18n <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../i18n&#x27;</span>

<span class="hljs-comment">/*
  EvictionsPage: presents content for evictions in a geographic region
*/</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">EvictionPage</span> = (<span class="hljs-params"></span>) =&gt; {
  
  <span class="hljs-keyword">const</span> [tableSearchRows, setTableSearchRows] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>)
  <span class="hljs-keyword">const</span> search = <span class="hljs-title function_">urlParam</span>(<span class="hljs-string">&#x27;search&#x27;</span>)
  <span class="hljs-keyword">const</span> evictionSourceData = <span class="hljs-title function_">useSelector</span>(<span class="hljs-title function_">sliceJson</span>(<span class="hljs-string">`<span class="hljs-subst">${search}</span>-about-evictions`</span>))
  <span class="hljs-keyword">const</span> evictionSourceText = evictionSourceData.<span class="hljs-property">source_name</span> + <span class="hljs-string">&#x27; (as of &#x27;</span> + <span class="hljs-title function_">reformatDate</span>(evictionSourceData.<span class="hljs-property">date_exported</span>) + <span class="hljs-string">&#x27;)&#x27;</span>
  <span class="hljs-keyword">const</span> evictionList = <span class="hljs-title function_">useRef</span>([])
  <span class="hljs-keyword">const</span> totalEvictions = <span class="hljs-title function_">useRef</span>(<span class="hljs-number">0</span>)

  <span class="hljs-comment">/* If tableSearchRows exist use them instead of the full evictionList */</span>
  <span class="hljs-keyword">const</span> json = <span class="hljs-title function_">useSelector</span>(<span class="hljs-title function_">sliceJson</span>(<span class="hljs-string">`<span class="hljs-subst">${search}</span>-evictions`</span>))
  <span class="hljs-keyword">const</span> evictionsJson = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(json) ? json : [] <span class="hljs-comment">/* DataMap needs array */</span>
  <span class="hljs-keyword">const</span> evictions = !<span class="hljs-title function_">isEmpty</span>(tableSearchRows) ? tableSearchRows : evictionsJson
  totalEvictions.<span class="hljs-property">current</span> = evictions.<span class="hljs-property">length</span> ?? <span class="hljs-number">0</span>
  evictionList.<span class="hljs-property">current</span> = evictions

  <span class="hljs-keyword">const</span> { t, <span class="hljs-attr">ready</span>: translationReady } = <span class="hljs-title function_">useTranslation</span>(
    <span class="hljs-string">&#x27;Evictions&#x27;</span>, <span class="hljs-comment">/* i18next-parser needs string here */</span>
    { <span class="hljs-attr">useSuspense</span>: <span class="hljs-literal">false</span>, i18n }
  )

  <span class="hljs-comment">/* Calculate numEvictions and evictionDatesMinMax */</span>
  <span class="hljs-keyword">const</span> numEvictions = evictions.<span class="hljs-property">length</span> ?? <span class="hljs-number">0</span>
  <span class="hljs-keyword">let</span> oldestEviction = <span class="hljs-string">&#x27;&#x27;</span>
  <span class="hljs-keyword">let</span> newestEviction = <span class="hljs-string">&#x27;&#x27;</span>
  <span class="hljs-keyword">const</span> evictionDatesMinMax = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; evictions.<span class="hljs-property">length</span>; i++) {
      <span class="hljs-keyword">const</span> d = evictions[i].<span class="hljs-property">evict_date</span>
      <span class="hljs-comment">// eslint-disable-next-line</span>
      <span class="hljs-keyword">if</span> (!oldestEviction || d &lt; oldestEviction) oldestEviction = d
      <span class="hljs-comment">// eslint-disable-next-line</span>
      <span class="hljs-keyword">if</span> (!newestEviction || d &gt; newestEviction) newestEviction = d     
    }
    <span class="hljs-keyword">return</span> ({
      <span class="hljs-attr">oldest</span>: <span class="hljs-title function_">reformatDate</span>(oldestEviction),
      <span class="hljs-attr">newest</span>: <span class="hljs-title function_">reformatDate</span>(newestEviction)
    })
  }, [evictions])

  <span class="hljs-keyword">if</span> (!translationReady) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">EvictionMap</span> = (<span class="hljs-params"></span>) =&gt; {

    <span class="hljs-keyword">const</span> [selectedEviction, setSelectedEviction] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>)

    <span class="hljs-comment">/* Avoid hundreds of redundant translation calls */</span>
    <span class="hljs-comment">// eslint-disable-next-line</span>
    <span class="hljs-keyword">const</span> addressLabel = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">t</span>(<span class="hljs-string">&#x27;Address&#x27;</span>),[i18n.<span class="hljs-property">language</span>])
    <span class="hljs-comment">// eslint-disable-next-line</span>
    <span class="hljs-keyword">const</span> evictionTypeLabel = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">t</span>(<span class="hljs-string">&#x27;Type&#x27;</span>),[i18n.<span class="hljs-property">language</span>])
    <span class="hljs-comment">// eslint-disable-next-line</span>
    <span class="hljs-keyword">const</span> dateFiledLabel = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">t</span>(<span class="hljs-string">&#x27;Date Filed&#x27;</span>),[i18n.<span class="hljs-property">language</span>])

    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isEmpty</span>(evictions)) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">HoverContent</span> (eviction) {
      <span class="hljs-keyword">const</span> ellis_text = eviction.<span class="hljs-property">units</span> &amp;&amp; (eviction.<span class="hljs-property">type</span> === <span class="hljs-string">&#x27;Ellis Act Withdrawal&#x27;</span>)
        ? <span class="hljs-title function_">t</span>(<span class="hljs-string">&#x27; (affecting &#x27;</span>) + eviction.<span class="hljs-property">units</span> + <span class="hljs-title function_">t</span>(<span class="hljs-string">&#x27; units)&#x27;</span>)
        : <span class="hljs-string">&#x27;&#x27;</span>
      <span class="hljs-keyword">return</span> (
        <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Typography</span> <span class="hljs-attr">variant</span>=<span class="hljs-string">&#x27;body1&#x27;</span>&gt;</span>
          {addressLabel}{&#x27;: &#x27;}{titleCase(eviction.addr)}<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>
          {evictionTypeLabel}{&#x27;: &#x27;}{eviction.type}{ellis_text}<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>
          {dateFiledLabel}{&#x27;: &#x27;}{reformatDate(eviction.evict_date)}
        <span class="hljs-tag">&lt;/<span class="hljs-name">Typography</span>&gt;</span></span>
      )
    }

    <span class="hljs-keyword">return</span> (
      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">DataMap</span> <span class="hljs-attr">markers</span>=<span class="hljs-string">{evictions}</span> <span class="hljs-attr">isDebugEnabled</span>=<span class="hljs-string">{false}</span>
        <span class="hljs-attr">overlays</span>=<span class="hljs-string">{[</span>
          &lt;<span class="hljs-attr">Overlay</span> <span class="hljs-attr">position</span>=<span class="hljs-string">&#x27;bottomright&#x27;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Legend</span>
              <span class="hljs-attr">title</span>=<span class="hljs-string">{t(</span>&#x27;<span class="hljs-attr">Legend</span>&#x27;)}
              <span class="hljs-attr">items</span>=<span class="hljs-string">{[</span>
                { <span class="hljs-attr">icon:</span> &lt;<span class="hljs-attr">EvictionIcon</span>/&gt;</span>, label: t(&#x27;Eviction&#x27;) }
              ]}
            /&gt;
          <span class="hljs-tag">&lt;/<span class="hljs-name">Overlay</span>&gt;</span>,
          <span class="hljs-tag">&lt;<span class="hljs-name">Overlay</span> <span class="hljs-attr">position</span>=<span class="hljs-string">&#x27;topleft&#x27;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">InfoBox</span>
              <span class="hljs-attr">selectedMarker</span>=<span class="hljs-string">{selectedEviction}</span>
              <span class="hljs-attr">directions</span>=<span class="hljs-string">{t(</span>&#x27;<span class="hljs-attr">Click</span> <span class="hljs-attr">an</span> <span class="hljs-attr">eviction</span> <span class="hljs-attr">on</span> <span class="hljs-attr">the</span> <span class="hljs-attr">map</span> <span class="hljs-attr">for</span> <span class="hljs-attr">details</span>&#x27;)}
            /&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">Overlay</span>&gt;</span>
        ]}
        onSelect={eviction =&gt; setSelectedEviction(eviction)}
        renderMarkerHover={HoverContent}
      /&gt;</span>
    )
  }

  <span class="hljs-keyword">return</span> (
    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Row</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Col</span> <span class="hljs-attr">xs</span>=<span class="hljs-string">{12}</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">DataPage</span> <span class="hljs-attr">fetch</span>=<span class="hljs-string">{[</span>
          {
            <span class="hljs-attr">slice:</span> `${<span class="hljs-attr">search</span>}<span class="hljs-attr">-evictions</span>`,
            <span class="hljs-attr">url:</span> `<span class="hljs-attr">api</span>/<span class="hljs-attr">neighborhood</span>/${<span class="hljs-attr">search</span>}/<span class="hljs-attr">evictions</span>?<span class="hljs-attr">size</span>=<span class="hljs-string">99999</span>`
          },
          { <span class="hljs-attr">slice:</span> `${<span class="hljs-attr">search</span>}<span class="hljs-attr">-about-evictions</span>`, <span class="hljs-attr">url:</span> &#x27;<span class="hljs-attr">api</span>/<span class="hljs-attr">about</span>/<span class="hljs-attr">eviction</span>&#x27;},
        ]} <span class="hljs-attr">isDebugEnabled</span>=<span class="hljs-string">{false}</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">EvictionMap</span>/&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Row</span> <span class="hljs-attr">justify</span>=<span class="hljs-string">&#x27;center&#x27;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Col</span> <span class="hljs-attr">xs</span>=<span class="hljs-string">{10}</span> <span class="hljs-attr">sm</span>=<span class="hljs-string">{8}</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">PageTitle</span>
                <span class="hljs-attr">text</span>=<span class="hljs-string">{t(</span>&#x27;<span class="hljs-attr">Evictions</span> <span class="hljs-attr">for</span> <span class="hljs-attr">the</span> {{<span class="hljs-attr">search</span>}} <span class="hljs-attr">Neighborhood</span>&#x27;,
                  {<span class="hljs-attr">search:</span> <span class="hljs-attr">titleCase</span>(<span class="hljs-attr">search</span>)})}
              /&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">EvictionList</span>
                <span class="hljs-attr">evictionSlice</span>=<span class="hljs-string">{</span>`${<span class="hljs-attr">search</span>}<span class="hljs-attr">-evictions</span>`}
                <span class="hljs-attr">title</span>=<span class="hljs-string">{t(</span>&#x27;<span class="hljs-attr">Eviction</span> <span class="hljs-attr">Summary</span>&#x27;)}
                <span class="hljs-attr">subTitle</span>=<span class="hljs-string">{t(</span>&#x27;<span class="hljs-attr">Map</span> <span class="hljs-attr">and</span> <span class="hljs-attr">table</span> <span class="hljs-attr">show</span> {{<span class="hljs-attr">numEvictions</span>}} <span class="hljs-attr">evictions</span> <span class="hljs-attr">between</span> {{<span class="hljs-attr">oldest</span>}} <span class="hljs-attr">and</span> {{<span class="hljs-attr">newest</span>}}{{<span class="hljs-attr">searchTermApplied</span>}}<span class="hljs-attr">.</span>&#x27;, {
                  <span class="hljs-attr">numEvictions:</span> <span class="hljs-attr">numEvictions</span>,
                  <span class="hljs-attr">oldest:</span> <span class="hljs-attr">evictionDatesMinMax.oldest</span>,
                  <span class="hljs-attr">newest:</span> <span class="hljs-attr">evictionDatesMinMax.newest</span>,
                  <span class="hljs-attr">searchTermApplied:</span> (<span class="hljs-attr">totalEvictions.current</span> &lt; <span class="hljs-attr">evictionsJson.length</span>
                    ? &#x27; <span class="hljs-attr">with</span> <span class="hljs-attr">a</span> <span class="hljs-attr">search</span> <span class="hljs-attr">term</span> <span class="hljs-attr">applied</span>&#x27; <span class="hljs-attr">:</span> &#x27;&#x27;)
                })
                }
                <span class="hljs-attr">noDataMessage</span>=<span class="hljs-string">{t(</span>&#x27;<span class="hljs-attr">No</span> <span class="hljs-attr">evictions</span> <span class="hljs-attr">recorded</span> <span class="hljs-attr">for</span> <span class="hljs-attr">this</span> <span class="hljs-attr">area.</span>&#x27;)}
                <span class="hljs-attr">aboutData</span>=<span class="hljs-string">{{</span>
                  <span class="hljs-attr">source:</span> <span class="hljs-attr">evictionSourceText</span>,
                  <span class="hljs-attr">href:</span> &#x27;/<span class="hljs-attr">methodology</span>&#x27;,
                  <span class="hljs-attr">notes:</span> (
                    <span class="hljs-attr">t</span>(&#x27;<span class="hljs-attr">Eviction</span> <span class="hljs-attr">records</span> <span class="hljs-attr">generally</span> <span class="hljs-attr">only</span> <span class="hljs-attr">include</span> <span class="hljs-attr">the</span> <span class="hljs-attr">address</span> <span class="hljs-attr">of</span> <span class="hljs-attr">the</span> <span class="hljs-attr">eviction.</span> &#x27;) +
                    <span class="hljs-attr">t</span>(&#x27;<span class="hljs-attr">Evictions</span> <span class="hljs-attr">were</span> <span class="hljs-attr">matched</span> <span class="hljs-attr">to</span> <span class="hljs-attr">parcel</span> <span class="hljs-attr">records</span> <span class="hljs-attr">and</span> <span class="hljs-attr">property</span> <span class="hljs-attr">ownership</span> <span class="hljs-attr">records.</span> &#x27;) +
                    <span class="hljs-attr">t</span>(&#x27;<span class="hljs-attr">As</span> <span class="hljs-attr">a</span> <span class="hljs-attr">result</span>, <span class="hljs-attr">some</span> <span class="hljs-attr">evictions</span> <span class="hljs-attr">were</span> <span class="hljs-attr">matched</span> <span class="hljs-attr">to</span> <span class="hljs-attr">multiple</span> <span class="hljs-attr">or</span> <span class="hljs-attr">no</span> <span class="hljs-attr">properties</span>, <span class="hljs-attr">if</span> <span class="hljs-attr">an</span> <span class="hljs-attr">exact</span> &#x27;) +
                    <span class="hljs-attr">t</span>(&#x27;<span class="hljs-attr">match</span> <span class="hljs-attr">could</span> <span class="hljs-attr">not</span> <span class="hljs-attr">be</span> <span class="hljs-attr">found.</span> <span class="hljs-attr">Some</span> <span class="hljs-attr">evictions</span> <span class="hljs-attr">also</span> <span class="hljs-attr">include</span> <span class="hljs-attr">names</span> <span class="hljs-attr">on</span> <span class="hljs-attr">the</span> <span class="hljs-attr">filing</span>, &#x27;) +
                    <span class="hljs-attr">t</span>(&#x27;<span class="hljs-attr">which</span> <span class="hljs-attr">may</span> <span class="hljs-attr">be</span> <span class="hljs-attr">either</span> <span class="hljs-attr">property</span> <span class="hljs-attr">owners</span> <span class="hljs-attr">or</span> <span class="hljs-attr">lawyers</span> <span class="hljs-attr">involved</span> <span class="hljs-attr">in</span> <span class="hljs-attr">the</span> <span class="hljs-attr">case.</span> <span class="hljs-attr">For</span> <span class="hljs-attr">these</span>, &#x27;) +
                    <span class="hljs-attr">t</span>(&#x27;<span class="hljs-attr">we</span> <span class="hljs-attr">have</span> <span class="hljs-attr">shown</span> <span class="hljs-attr">the</span> <span class="hljs-attr">name</span> <span class="hljs-attr">identified</span> <span class="hljs-attr">through</span> <span class="hljs-attr">property</span> <span class="hljs-attr">records</span>, <span class="hljs-attr">and</span> <span class="hljs-attr">the</span> <span class="hljs-attr">additional</span> &#x27;) +
                    <span class="hljs-attr">t</span>(&#x27;<span class="hljs-attr">names</span> <span class="hljs-attr">are</span> <span class="hljs-attr">those</span> <span class="hljs-attr">found</span> <span class="hljs-attr">on</span> <span class="hljs-attr">the</span> <span class="hljs-attr">eviction</span> <span class="hljs-attr">filing</span> <span class="hljs-attr">itself.</span>&#x27;)
                  )
                }}
                <span class="hljs-attr">onSearchFilter</span>=<span class="hljs-string">{filtered</span> =&gt;</span> setTableSearchRows(filtered)}
                searchHint={() =&gt;
                  <span class="hljs-tag">&lt;<span class="hljs-name">Row</span> <span class="hljs-attr">alignItems</span>=<span class="hljs-string">&#x27;center&#x27;</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">MapIcon</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{color:</span> &#x27;<span class="hljs-attr">white</span>&#x27;}} /&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">Typography</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{fontSize:</span> &#x27;<span class="hljs-attr">12px</span>&#x27;}}&gt;</span>
                      {&#x27; &#x27;}{t(&#x27;Map Updated&#x27;)}{&#x27; &#x27;}
                    <span class="hljs-tag">&lt;/<span class="hljs-name">Typography</span>&gt;</span>
                  <span class="hljs-tag">&lt;/<span class="hljs-name">Row</span>&gt;</span>
                }
                paginationPageSize={25}
                csvFileName={t(&#x27;Evictions for the {{search}} Neighborhood&#x27;,
                  {search: titleCase(search)})}
              /&gt;
            <span class="hljs-tag">&lt;/<span class="hljs-name">Col</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">Row</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">DataPage</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Col</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Row</span>&gt;</span></span>
  )

}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">EvictionPage</span></pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrcpagesglossary.js"><a href="#toc"><a name="ui-src-pages-glossary-js">ui/src/pages/Glossary.js</a></a></h2>
<pre><code><span class="hljs-comment">import</span> <span class="hljs-comment">React</span><span class="hljs-string">,</span> <span class="hljs-comment">{</span> <span class="hljs-comment">useState</span> <span class="hljs-comment">}</span> <span class="hljs-comment">from</span> <span class="hljs-comment">&#x27;react&#x27;</span>
<span class="hljs-comment">import</span> <span class="hljs-comment">Typography</span> <span class="hljs-comment">from</span> <span class="hljs-comment">&#x27;@material</span><span class="hljs-literal">-</span><span class="hljs-comment">ui/core/Typography&#x27;</span>
<span class="hljs-comment">import</span> <span class="hljs-comment">{</span> <span class="hljs-comment">useTranslation</span> <span class="hljs-comment">}</span> <span class="hljs-comment">from</span> <span class="hljs-comment">&#x27;react</span><span class="hljs-literal">-</span><span class="hljs-comment">i18next&#x27;</span>
<span class="hljs-comment">import</span> <span class="hljs-comment">i18n</span> <span class="hljs-comment">from</span> <span class="hljs-comment">&#x27;</span><span class="hljs-string">.</span><span class="hljs-string">.</span><span class="hljs-comment">/i18n&#x27;</span>
<span class="hljs-comment">import</span> <span class="hljs-comment">{</span> <span class="hljs-comment">Row</span><span class="hljs-string">,</span> <span class="hljs-comment">Col</span> <span class="hljs-comment">}</span> <span class="hljs-comment">from</span> <span class="hljs-comment">&#x27;</span><span class="hljs-string">.</span><span class="hljs-string">.</span><span class="hljs-comment">/components/Grid&#x27;</span>
<span class="hljs-comment">import</span> <span class="hljs-comment">Link</span> <span class="hljs-comment">from</span> <span class="hljs-comment">&#x27;@material</span><span class="hljs-literal">-</span><span class="hljs-comment">ui/core/Link&#x27;</span>
<span class="hljs-comment">import</span> <span class="hljs-comment">PageTitle</span> <span class="hljs-comment">from</span> <span class="hljs-comment">&#x27;</span><span class="hljs-string">.</span><span class="hljs-string">.</span><span class="hljs-comment">/components/PageTitle&#x27;</span>
<span class="hljs-comment">import</span> <span class="hljs-comment">Accordion</span> <span class="hljs-comment">from</span> <span class="hljs-comment">&#x27;@material</span><span class="hljs-literal">-</span><span class="hljs-comment">ui/core/Accordion&#x27;</span>
<span class="hljs-comment">import</span> <span class="hljs-comment">AccordionDetails</span> <span class="hljs-comment">from</span> <span class="hljs-comment">&#x27;@material</span><span class="hljs-literal">-</span><span class="hljs-comment">ui/core/AccordionDetails&#x27;</span>
<span class="hljs-comment">import</span> <span class="hljs-comment">AccordionSummary</span> <span class="hljs-comment">from</span> <span class="hljs-comment">&#x27;@material</span><span class="hljs-literal">-</span><span class="hljs-comment">ui/core/AccordionSummary&#x27;</span>
<span class="hljs-comment">import</span> <span class="hljs-comment">ExpandMoreIcon</span> <span class="hljs-comment">from</span> <span class="hljs-comment">&#x27;@material</span><span class="hljs-literal">-</span><span class="hljs-comment">ui/icons/ExpandMore&#x27;</span>
<span class="hljs-comment">import</span> <span class="hljs-comment">{</span> <span class="hljs-comment">useTheme</span> <span class="hljs-comment">}</span> <span class="hljs-comment">from</span> <span class="hljs-comment">&#x27;@material</span><span class="hljs-literal">-</span><span class="hljs-comment">ui/core/styles&#x27;</span>
<span class="hljs-comment">import</span> <span class="hljs-comment">ListItem</span> <span class="hljs-comment">from</span> <span class="hljs-comment">&#x27;@material</span><span class="hljs-literal">-</span><span class="hljs-comment">ui/core/ListItem&#x27;</span>

<span class="hljs-comment">const</span> <span class="hljs-comment">Glossary</span> <span class="hljs-comment">=</span> <span class="hljs-comment">()</span> <span class="hljs-comment">=</span>&gt; <span class="hljs-comment">{</span>

  <span class="hljs-comment">const</span> <span class="hljs-comment">theme</span> <span class="hljs-comment">=</span> <span class="hljs-comment">useTheme()</span>
  <span class="hljs-comment">const</span> <span class="hljs-title">[</span><span class="hljs-comment">expanded</span><span class="hljs-string">,</span> <span class="hljs-comment">setExpanded</span><span class="hljs-title">]</span> <span class="hljs-comment">=</span> <span class="hljs-comment">useState(false)</span>
  <span class="hljs-comment">const</span> <span class="hljs-comment">{</span> <span class="hljs-comment">t</span><span class="hljs-string">,</span> <span class="hljs-comment">ready:</span> <span class="hljs-comment">translationReady</span> <span class="hljs-comment">}</span> <span class="hljs-comment">=</span> <span class="hljs-comment">useTranslation(</span>
    <span class="hljs-comment">&#x27;Glossary&#x27;</span><span class="hljs-string">,</span> <span class="hljs-comment">/*</span> <span class="hljs-comment">i18next</span><span class="hljs-literal">-</span><span class="hljs-comment">parser needs string here */</span>
    <span class="hljs-comment">{</span> <span class="hljs-comment">useSuspense:</span> <span class="hljs-comment">false</span><span class="hljs-string">,</span> <span class="hljs-comment">i18n</span> <span class="hljs-comment">}</span>
  <span class="hljs-comment">)</span>

  <span class="hljs-comment">if</span> <span class="hljs-comment">(!translationReady)</span> <span class="hljs-comment">return</span> <span class="hljs-comment">null</span>

  <span class="hljs-comment">const</span> <span class="hljs-comment">questions</span> <span class="hljs-comment">=</span> <span class="hljs-title">[</span>
    <span class="hljs-comment">{</span>
      <span class="hljs-comment">siteId:</span> <span class="hljs-comment">&#x27;just</span><span class="hljs-literal">-</span><span class="hljs-comment">cause</span><span class="hljs-literal">-</span><span class="hljs-comment">no</span><span class="hljs-literal">-</span><span class="hljs-comment">fault&#x27;</span><span class="hljs-string">,</span>
      <span class="hljs-comment">question:</span> <span class="hljs-comment">t(&#x27;What causes for eviction are considered just cause </span><span class="hljs-literal">-</span> <span class="hljs-comment">no</span><span class="hljs-literal">-</span><span class="hljs-comment">fault?&#x27;)</span><span class="hljs-string">,</span>
      <span class="hljs-comment">answer:</span> <span class="hljs-title">[</span>
        <span class="hljs-comment">t(&#x27;Owner/relative</span> <span class="hljs-comment">move</span><span class="hljs-literal">-</span><span class="hljs-comment">in&#x27;)</span><span class="hljs-string">,</span>
        <span class="hljs-comment">t(&#x27;Condo</span> <span class="hljs-comment">conversion&#x27;)</span><span class="hljs-string">,</span>
        <span class="hljs-comment">t(&#x27;Demolition</span> <span class="hljs-comment">/ removal from rental market&#x27;)</span><span class="hljs-string">,</span>
        <span class="hljs-comment">t(&#x27;Temporary removal from rental market for capital improvements or</span> <span class="hljs-comment">rehabilitation</span> <span class="hljs-comment">work&#x27;)</span><span class="hljs-string">,</span>
        <span class="hljs-comment">t(&#x27;Substantial</span> <span class="hljs-comment">rehabilitationLead</span> <span class="hljs-comment">remediation</span> <span class="hljs-comment">or</span> <span class="hljs-comment">abatement</span> <span class="hljs-comment">work&#x27;)</span><span class="hljs-string">,</span>
        <span class="hljs-comment">t(&#x27;Demolition</span> <span class="hljs-comment">/ removal from rental market in accordance with development agreement entered into by</span> <span class="hljs-comment">the</span> <span class="hljs-comment">City&#x27;)</span>
      <span class="hljs-title">]</span><span class="hljs-string">,</span>
      <span class="hljs-comment">link:</span> <span class="hljs-comment">&#x27;https://sanfrancisco</span><span class="hljs-literal">-</span><span class="hljs-comment">policies</span><span class="hljs-string">.</span><span class="hljs-comment">glitch</span><span class="hljs-string">.</span><span class="hljs-comment">me/&#x27;</span><span class="hljs-string">,</span>
      <span class="hljs-comment">credit:</span> <span class="hljs-comment">t(&#x27;Tenants</span> <span class="hljs-comment">Together</span> <span class="hljs-comment">/</span> <span class="hljs-comment">Urban</span> <span class="hljs-comment">Displacement</span> <span class="hljs-comment">Project&#x27;)</span>
    <span class="hljs-comment">}</span><span class="hljs-string">,</span>
    <span class="hljs-comment">{</span>
      <span class="hljs-comment">siteId:</span> <span class="hljs-comment">&#x27;just</span><span class="hljs-literal">-</span><span class="hljs-comment">cause</span><span class="hljs-literal">-</span><span class="hljs-comment">tenant</span><span class="hljs-literal">-</span><span class="hljs-comment">at</span><span class="hljs-literal">-</span><span class="hljs-comment">fault&#x27;</span><span class="hljs-string">,</span>
      <span class="hljs-comment">question:</span> <span class="hljs-comment">t(&#x27;What is Considered Just Cause</span> <span class="hljs-literal">-</span> <span class="hljs-comment">tenant</span> <span class="hljs-comment">at</span><span class="hljs-literal">-</span><span class="hljs-comment">fault?&#x27;)</span><span class="hljs-string">,</span>
      <span class="hljs-comment">answer:</span> <span class="hljs-title">[</span>
        <span class="hljs-comment">t(&#x27;Failure</span> <span class="hljs-comment">to</span> <span class="hljs-comment">pay</span> <span class="hljs-comment">rent&#x27;)</span><span class="hljs-string">,</span>
        <span class="hljs-comment">t(&#x27;Violation</span> <span class="hljs-comment">of the rental agreement or</span> <span class="hljs-comment">lease&#x27;)</span><span class="hljs-string">,</span>
        <span class="hljs-comment">t(&#x27;Unreasonable interference with the comfort</span><span class="hljs-string">,</span> <span class="hljs-comment">safety</span> <span class="hljs-comment">or</span> <span class="hljs-comment">enjoyment</span> <span class="hljs-comment">of</span> <span class="hljs-comment">other</span> <span class="hljs-comment">tenants</span><span class="hljs-string">,</span> <span class="hljs-comment">or damaging the rental unit</span> <span class="hljs-comment">or</span> <span class="hljs-comment">the</span> <span class="hljs-comment">property&#x27;)</span><span class="hljs-string">,</span>
        <span class="hljs-comment">t(&#x27;Using your rental unit or the common areas of the property for an</span> <span class="hljs-comment">illegal</span> <span class="hljs-comment">purpose&#x27;)</span><span class="hljs-string">,</span>
        <span class="hljs-comment">t(&#x27;Refusal to renew a lease</span> <span class="hljs-comment">or</span> <span class="hljs-comment">rental</span> <span class="hljs-comment">agreement</span> <span class="hljs-comment">of like terms and conditions&#x27;)</span><span class="hljs-string">,</span>
        <span class="hljs-comment">t(&#x27;Refusing the landlord reasonable access to the rental unit for repairs and inspections to name a couple</span> <span class="hljs-comment">of</span> <span class="hljs-comment">examples&#x27;)</span><span class="hljs-string">,</span>
        <span class="hljs-comment">t(&#x27;At</span> <span class="hljs-comment">the</span> <span class="hljs-comment">end</span> <span class="hljs-comment">of</span> <span class="hljs-comment">a</span> <span class="hljs-comment">lease</span> <span class="hljs-comment">term</span><span class="hljs-string">,</span> <span class="hljs-comment">the landlord discovers the tenant is not the person who initially rented the unit and the landlord</span> <span class="hljs-comment">didn’t</span> <span class="hljs-comment">approve</span> <span class="hljs-comment">this</span> <span class="hljs-comment">person’s</span> <span class="hljs-comment">tenancy&#x27;)</span>
      <span class="hljs-title">]</span><span class="hljs-string">,</span>
      <span class="hljs-comment">link:</span> <span class="hljs-comment">&#x27;https://sanfrancisco</span><span class="hljs-literal">-</span><span class="hljs-comment">policies</span><span class="hljs-string">.</span><span class="hljs-comment">glitch</span><span class="hljs-string">.</span><span class="hljs-comment">me/&#x27;</span><span class="hljs-string">,</span>
      <span class="hljs-comment">credit:</span> <span class="hljs-comment">t(&#x27;Tenants</span> <span class="hljs-comment">Together</span> <span class="hljs-comment">/</span> <span class="hljs-comment">Urban</span> <span class="hljs-comment">Displacement</span> <span class="hljs-comment">Project&#x27;)</span>
    <span class="hljs-comment">}</span><span class="hljs-string">,</span>
    <span class="hljs-comment">{</span>
      <span class="hljs-comment">siteId:</span> <span class="hljs-comment">&#x27;pay</span><span class="hljs-literal">-</span><span class="hljs-comment">relocation</span><span class="hljs-literal">-</span><span class="hljs-comment">assistance&#x27;</span><span class="hljs-string">,</span>
      <span class="hljs-comment">question:</span> <span class="hljs-comment">t(&#x27;What triggers the obligation to</span> <span class="hljs-comment">pay</span> <span class="hljs-comment">relocation</span> <span class="hljs-comment">assistance?&#x27;)</span><span class="hljs-string">,</span>
      <span class="hljs-comment">answer:</span> <span class="hljs-title">[</span>
        <span class="hljs-comment">t(&#x27;Owner/relative</span> <span class="hljs-comment">move</span><span class="hljs-literal">-</span><span class="hljs-comment">in</span> <span class="hljs-comment">(unless tenant is elderly or</span> <span class="hljs-comment">disabled</span><span class="hljs-string">,</span> <span class="hljs-comment">then</span> <span class="hljs-comment">not</span> <span class="hljs-comment">justified)&#x27;)</span><span class="hljs-string">,</span>
        <span class="hljs-comment">t(&#x27;Demolition</span> <span class="hljs-comment">/ removal from rental market&#x27;)</span><span class="hljs-string">,</span>
        <span class="hljs-comment">t(&#x27;Temporary removal from rental market</span> <span class="hljs-comment">for</span> <span class="hljs-comment">capital</span> <span class="hljs-comment">improvements&#x27;)</span><span class="hljs-string">,</span>
        <span class="hljs-comment">t(&#x27;Substantial</span> <span class="hljs-comment">rehabilitation&#x27;)</span>
      <span class="hljs-title">]</span><span class="hljs-string">,</span>
      <span class="hljs-comment">link:</span> <span class="hljs-comment">&#x27;https://sanfrancisco</span><span class="hljs-literal">-</span><span class="hljs-comment">policies</span><span class="hljs-string">.</span><span class="hljs-comment">glitch</span><span class="hljs-string">.</span><span class="hljs-comment">me/&#x27;</span><span class="hljs-string">,</span>
      <span class="hljs-comment">credit:</span> <span class="hljs-comment">t(&#x27;Tenants</span> <span class="hljs-comment">Together</span> <span class="hljs-comment">/</span> <span class="hljs-comment">Urban</span> <span class="hljs-comment">Displacement</span> <span class="hljs-comment">Project&#x27;)</span>
    <span class="hljs-comment">}</span>
  <span class="hljs-title">]</span>

  <span class="hljs-comment">const</span> <span class="hljs-comment">terms</span> <span class="hljs-comment">=</span> <span class="hljs-title">[</span>
    <span class="hljs-comment">{</span>
      <span class="hljs-comment">siteId:</span> <span class="hljs-comment">&#x27;apn&#x27;</span><span class="hljs-string">,</span>
      <span class="hljs-comment">term:</span> <span class="hljs-comment">t(&#x27;APN&#x27;)</span><span class="hljs-string">,</span>
      <span class="hljs-comment">definition:</span> <span class="hljs-comment">t(`APN is the assessor&#x27;s parcel</span> <span class="hljs-comment">number</span> <span class="hljs-literal">-</span> 
        <span class="hljs-comment">a number assigned to property</span> <span class="hljs-comment">parcels</span> <span class="hljs-comment">by</span> 
        <span class="hljs-comment">the</span> <span class="hljs-comment">tax</span> <span class="hljs-comment">assessor</span> <span class="hljs-comment">of a particular jurisdiction </span>
        <span class="hljs-comment">for identification and record-keeping. The</span> 
        <span class="hljs-comment">assigned number is unique within</span> <span class="hljs-comment">the</span> 
        <span class="hljs-comment">particular</span> <span class="hljs-comment">jurisdiction</span><span class="hljs-string">.</span><span class="hljs-comment">`)</span><span class="hljs-string">,</span>
      <span class="hljs-comment">link:</span> <span class="hljs-comment">&#x27;https://en</span><span class="hljs-string">.</span><span class="hljs-comment">wikipedia</span><span class="hljs-string">.</span><span class="hljs-comment">org/wiki/Assessor%27s_parcel_number&#x27;</span><span class="hljs-string">,</span>
      <span class="hljs-comment">credit:</span> <span class="hljs-comment">t(&#x27;Wikipedia&#x27;)</span>
    <span class="hljs-comment">}</span><span class="hljs-string">,</span>
    <span class="hljs-comment">{</span>
      <span class="hljs-comment">siteId:</span> <span class="hljs-comment">&#x27;assessors</span><span class="hljs-literal">-</span><span class="hljs-comment">office&#x27;</span><span class="hljs-string">,</span>
      <span class="hljs-comment">term:</span> <span class="hljs-comment">t(&#x27;Assessors</span> <span class="hljs-comment">Office&#x27;)</span><span class="hljs-string">,</span>
      <span class="hljs-comment">definition:</span> <span class="hljs-comment">t(`Tax</span> <span class="hljs-comment">assessment</span><span class="hljs-string">,</span> <span class="hljs-comment">or</span> <span class="hljs-comment">assessment</span><span class="hljs-string">,</span> <span class="hljs-comment">is</span> <span class="hljs-comment">the</span> <span class="hljs-comment">job</span> <span class="hljs-comment">of</span> 
        <span class="hljs-comment">determining</span> <span class="hljs-comment">the</span> <span class="hljs-comment">value</span><span class="hljs-string">,</span> <span class="hljs-comment">and sometimes determining the </span>
        <span class="hljs-comment">use</span><span class="hljs-string">,</span> <span class="hljs-comment">of</span> <span class="hljs-comment">property</span><span class="hljs-string">,</span> <span class="hljs-comment">usually to calculate a property</span> <span class="hljs-comment">tax</span><span class="hljs-string">.</span> 
        <span class="hljs-comment">This is usually done by</span> <span class="hljs-comment">an office called the assessor</span> 
        <span class="hljs-comment">or</span> <span class="hljs-comment">tax</span> <span class="hljs-comment">assessor</span><span class="hljs-string">.</span><span class="hljs-comment">`)</span><span class="hljs-string">,</span>
      <span class="hljs-comment">link:</span> <span class="hljs-comment">&#x27;https://en</span><span class="hljs-string">.</span><span class="hljs-comment">wikipedia</span><span class="hljs-string">.</span><span class="hljs-comment">org/wiki/Tax_assessment&#x27;</span><span class="hljs-string">,</span>
      <span class="hljs-comment">credit:</span> <span class="hljs-comment">t(&#x27;Wikipedia&#x27;)</span>
    <span class="hljs-comment">}</span><span class="hljs-string">,</span>
    <span class="hljs-comment">{</span>
      <span class="hljs-comment">siteId:</span> <span class="hljs-comment">&#x27;buyouts&#x27;</span><span class="hljs-string">,</span>
      <span class="hljs-comment">term:</span> <span class="hljs-comment">t(&#x27;Buyouts&#x27;)</span><span class="hljs-string">,</span>
      <span class="hljs-comment">definition:</span> <span class="hljs-comment">t(`Buyouts are often offered to</span> <span class="hljs-comment">tenants</span> <span class="hljs-comment">as</span> 
        <span class="hljs-comment">ways</span> <span class="hljs-comment">to</span> <span class="hljs-comment">leave</span><span class="hljs-string">,</span> <span class="hljs-comment">recieve</span> <span class="hljs-comment">some</span> <span class="hljs-comment">funding</span><span class="hljs-string">,</span> <span class="hljs-comment">and</span> <span class="hljs-comment">not</span> <span class="hljs-comment">formally</span> 
        <span class="hljs-comment">be</span> <span class="hljs-comment">evicted</span><span class="hljs-string">.</span> <span class="hljs-comment">However</span><span class="hljs-string">,</span> <span class="hljs-comment">most</span> <span class="hljs-comment">tenants</span> <span class="hljs-comment">don’t</span> <span class="hljs-comment">understand</span> <span class="hljs-comment">their</span> 
        <span class="hljs-comment">rights to stay and when the buyout is coupled</span> <span class="hljs-comment">with</span> <span class="hljs-comment">threats</span> 
        <span class="hljs-comment">to</span> <span class="hljs-comment">evict</span><span class="hljs-string">,</span> <span class="hljs-comment">tenants are often intimidated into taking the buyout. </span>
        <span class="hljs-comment">Lately buyouts have been on</span> <span class="hljs-comment">the</span> <span class="hljs-comment">rise</span> <span class="hljs-comment">as</span> <span class="hljs-comment">a</span> <span class="hljs-comment">means</span> <span class="hljs-comment">of</span> 
        <span class="hljs-comment">informally</span> <span class="hljs-comment">evicting</span> <span class="hljs-comment">tenants</span><span class="hljs-string">.</span><span class="hljs-comment">`)</span><span class="hljs-string">,</span>
      <span class="hljs-comment">link:</span> <span class="hljs-comment">&#x27;https://www</span><span class="hljs-string">.</span><span class="hljs-comment">sftu</span><span class="hljs-string">.</span><span class="hljs-comment">org/buyouts/&#x27;</span><span class="hljs-string">,</span>
      <span class="hljs-comment">credit:</span> <span class="hljs-comment">t(&#x27;SF</span> <span class="hljs-comment">Tenants</span> <span class="hljs-comment">Union&#x27;)</span>
    <span class="hljs-comment">}</span><span class="hljs-string">,</span>
    <span class="hljs-comment">{</span>
      <span class="hljs-comment">siteId:</span> <span class="hljs-comment">&#x27;capital</span><span class="hljs-literal">-</span><span class="hljs-comment">improvement</span><span class="hljs-literal">-</span><span class="hljs-comment">pass&#x27;</span><span class="hljs-string">,</span>
      <span class="hljs-comment">term:</span> <span class="hljs-comment">t(&#x27;Capital</span> <span class="hljs-comment">Improvement</span> <span class="hljs-comment">and</span> <span class="hljs-comment">Passthroughs&#x27;)</span><span class="hljs-string">,</span>
      <span class="hljs-comment">definition:</span> <span class="hljs-comment">t(`For</span> <span class="hljs-comment">certain</span> <span class="hljs-comment">types</span> <span class="hljs-comment">of</span> <span class="hljs-comment">rent</span> <span class="hljs-comment">increases</span><span class="hljs-string">,</span> <span class="hljs-comment">landlords</span> <span class="hljs-comment">must</span> <span class="hljs-comment">file</span> 
        <span class="hljs-comment">a petition at the Rent Board before serving the tenants with a notice</span> <span class="hljs-comment">of</span> 
        <span class="hljs-comment">the increase. The tenants are not required to pay the increase until the</span> 
        <span class="hljs-comment">Rent</span> <span class="hljs-comment">Board</span> <span class="hljs-comment">approves</span> <span class="hljs-comment">it</span><span class="hljs-string">,</span> <span class="hljs-comment">but</span> <span class="hljs-comment">if</span> <span class="hljs-comment">approved</span><span class="hljs-string">,</span> <span class="hljs-comment">the rent increase will be</span> <span class="hljs-comment">retroactive</span> 
        <span class="hljs-comment">to the effective date specified in a valid notice</span> <span class="hljs-comment">of</span> <span class="hljs-comment">increase</span><span class="hljs-string">.</span><span class="hljs-comment">There</span> <span class="hljs-comment">are</span> <span class="hljs-comment">six</span> 
        <span class="hljs-comment">types</span> <span class="hljs-comment">of rent increases that require</span> <span class="hljs-comment">the</span> <span class="hljs-comment">filing</span> <span class="hljs-comment">of a landlord petition. These</span> <span class="hljs-comment">are:</span> 
        <span class="hljs-comment">Capital</span> <span class="hljs-comment">Improvement</span> <span class="hljs-comment">Passthrough; Operating and Maintenance Expense</span> <span class="hljs-comment">Increase;</span> <span class="hljs-comment">Special</span> 
        <span class="hljs-comment">Circumstances Increase Based on Rents</span> <span class="hljs-comment">for</span> <span class="hljs-comment">Comparable</span> <span class="hljs-comment">Units;</span>
        <span class="hljs-comment">Rent Increase Based on the Past Rent History of a Proposition I Affected</span> <span class="hljs-comment">Unit;</span> 
        <span class="hljs-comment">Utility</span> <span class="hljs-comment">Passthrough</span> <span class="hljs-comment">(requires</span> <span class="hljs-comment">the</span> <span class="hljs-comment">filing</span> <span class="hljs-comment">of either a petition or</span> <span class="hljs-comment">a</span> <span class="hljs-comment">worksheet);</span> 
        <span class="hljs-comment">and Rules and Regulations Section</span> <span class="hljs-comment">1</span><span class="hljs-string">.</span><span class="hljs-comment">21 Increase where there is</span> <span class="hljs-comment">no</span> <span class="hljs-comment">Tenant</span> <span class="hljs-comment">in</span> <span class="hljs-comment">Occupancy`)</span><span class="hljs-string">,</span>
      <span class="hljs-comment">link:</span> <span class="hljs-comment">&#x27;https://sfrb</span><span class="hljs-string">.</span><span class="hljs-comment">org/fact</span><span class="hljs-literal">-</span><span class="hljs-comment">sheet</span><span class="hljs-literal">-</span><span class="hljs-comment">5</span><span class="hljs-literal">-</span><span class="hljs-comment">landlord</span><span class="hljs-literal">-</span><span class="hljs-comment">petitions</span><span class="hljs-literal">-</span><span class="hljs-comment">and</span><span class="hljs-literal">-</span><span class="hljs-comment">passthroughs&#x27;</span><span class="hljs-string">,</span>
      <span class="hljs-comment">credit:</span> <span class="hljs-comment">t(&#x27;SF</span> <span class="hljs-comment">Rent</span> <span class="hljs-comment">Board&#x27;)</span>
    <span class="hljs-comment">}</span><span class="hljs-string">,</span>
    <span class="hljs-comment">{</span>
      <span class="hljs-comment">siteId:</span> <span class="hljs-comment">&#x27;condos</span><span class="hljs-literal">-</span><span class="hljs-comment">tic</span><span class="hljs-literal">-</span><span class="hljs-comment">conversions&#x27;</span><span class="hljs-string">,</span>
      <span class="hljs-comment">term:</span> <span class="hljs-comment">t(&#x27;Condos</span> <span class="hljs-comment">and</span> <span class="hljs-comment">TIC</span> <span class="hljs-comment">Conversions&#x27;)</span><span class="hljs-string">,</span>
      <span class="hljs-comment">definition:</span> <span class="hljs-comment">t(`TICs</span> <span class="hljs-comment">(Tenancies</span> <span class="hljs-comment">In</span> <span class="hljs-comment">Common) are usually the first step for removing housing</span> 
        <span class="hljs-comment">from rent control to create owner-occupied housing for the</span> <span class="hljs-comment">profit</span> <span class="hljs-comment">of real estate investors. </span>
        <span class="hljs-comment">TICs are joint ownership of a building where each owner has a side</span> <span class="hljs-comment">agreement</span> <span class="hljs-comment">to</span> <span class="hljs-comment">only</span>
        <span class="hljs-comment">occupy a single unit although the owners have joint liability and usually a</span> <span class="hljs-comment">shared</span> <span class="hljs-comment">mortgage</span><span class="hljs-string">.</span><span class="hljs-comment">`)</span><span class="hljs-string">,</span>
      <span class="hljs-comment">link:</span> <span class="hljs-comment">&#x27;https://www</span><span class="hljs-string">.</span><span class="hljs-comment">sftu</span><span class="hljs-string">.</span><span class="hljs-comment">org/newtic/&#x27;</span><span class="hljs-string">,</span>
      <span class="hljs-comment">credit:</span> <span class="hljs-comment">t(&#x27;SF</span> <span class="hljs-comment">Tenants</span> <span class="hljs-comment">Union&#x27;)</span>
    <span class="hljs-comment">}</span><span class="hljs-string">,</span>
    <span class="hljs-comment">{</span>
      <span class="hljs-comment">siteId:</span> <span class="hljs-comment">&#x27;eligible</span><span class="hljs-literal">-</span><span class="hljs-comment">units&#x27;</span><span class="hljs-string">,</span>
      <span class="hljs-comment">term:</span> <span class="hljs-comment">t(&#x27;Eligible</span> <span class="hljs-comment">Units&#x27;)</span><span class="hljs-string">,</span>
      <span class="hljs-comment">definition:</span> <span class="hljs-comment">t(`Housing</span> <span class="hljs-comment">Choice</span> <span class="hljs-comment">Voucher</span> <span class="hljs-comment">Program</span>
        <span class="hljs-comment">Over</span><span class="hljs-literal">-</span><span class="hljs-comment">FMR</span> <span class="hljs-comment">Tenancy</span> <span class="hljs-comment">program</span> 
        <span class="hljs-comment">Section</span> <span class="hljs-comment">8</span>
        <span class="hljs-comment">Federal</span> <span class="hljs-comment">LIHTC</span> <span class="hljs-comment">(when</span> <span class="hljs-comment">a</span> <span class="hljs-comment">tenant’s</span> <span class="hljs-comment">occupancy</span> <span class="hljs-comment">of unit began before LIHTC regulatory agreement was recorded</span><span class="hljs-string">,</span> 
        <span class="hljs-comment">and rent is not controlled</span> <span class="hljs-comment">by</span> <span class="hljs-comment">City</span> <span class="hljs-comment">agencies)</span>
        <span class="hljs-comment">Any unit where a qualifying tenant has been in</span> <span class="hljs-comment">possession</span> <span class="hljs-comment">of the unit since 1/19/2007ADUs</span> <span class="hljs-comment">(accessory</span> <span class="hljs-comment">dwelling</span> <span class="hljs-comment">unit)`)</span><span class="hljs-string">,</span>
      <span class="hljs-comment">link:</span> <span class="hljs-comment">&#x27;https://docs</span><span class="hljs-string">.</span><span class="hljs-comment">google</span><span class="hljs-string">.</span><span class="hljs-comment">com/spreadsheets/d/13UjOKg07X</span><span class="hljs-literal">-</span><span class="hljs-comment">GP2AETMKcXqBDUCwJ_dvsLZzzvLkLCj1E/edit#gid=0&#x27;</span><span class="hljs-string">,</span>
      <span class="hljs-comment">credit:</span> <span class="hljs-comment">t(&#x27;Tenants</span> <span class="hljs-comment">Together</span> <span class="hljs-comment">/</span> <span class="hljs-comment">Urban</span> <span class="hljs-comment">Displacement</span> <span class="hljs-comment">Project&#x27;)</span>
    <span class="hljs-comment">}</span><span class="hljs-string">,</span>
    <span class="hljs-comment">{</span>
      <span class="hljs-comment">siteId:</span> <span class="hljs-comment">&#x27;ellis</span><span class="hljs-literal">-</span><span class="hljs-comment">act</span><span class="hljs-literal">-</span><span class="hljs-comment">ecivtions&#x27;</span><span class="hljs-string">,</span>
      <span class="hljs-comment">term:</span> <span class="hljs-comment">t(&#x27;Ellis</span> <span class="hljs-comment">Act</span> <span class="hljs-comment">Evictions&#x27;)</span><span class="hljs-string">,</span>
      <span class="hljs-comment">definition:</span> <span class="hljs-comment">t(`The</span> <span class="hljs-comment">“Ellis</span> <span class="hljs-comment">Act” is a state law which says that landlords have the unconditional </span>
        <span class="hljs-comment">right to evict tenants to</span> <span class="hljs-comment">“go</span> <span class="hljs-comment">out</span> <span class="hljs-comment">of</span> <span class="hljs-comment">business</span><span class="hljs-string">.</span><span class="hljs-comment">”</span> <span class="hljs-comment">For</span> <span class="hljs-comment">an</span> <span class="hljs-comment">Ellis</span> <span class="hljs-comment">eviction</span><span class="hljs-string">,</span> <span class="hljs-comment">the landlord must remove </span>
        <span class="hljs-comment">all</span> <span class="hljs-comment">of the units in the building from the rental</span> <span class="hljs-comment">market</span><span class="hljs-string">,</span> <span class="hljs-comment">i</span><span class="hljs-string">.</span><span class="hljs-comment">e</span><span class="hljs-string">.</span><span class="hljs-string">,</span> <span class="hljs-comment">the landlord must evict all</span> 
        <span class="hljs-comment">the tenants and cannot single out one tenant (for</span> <span class="hljs-comment">example</span><span class="hljs-string">,</span> <span class="hljs-comment">with</span> <span class="hljs-comment">low</span> <span class="hljs-comment">rent)</span> <span class="hljs-comment">and/or</span> <span class="hljs-comment">remove</span> <span class="hljs-comment">just</span> 
        <span class="hljs-comment">one</span> <span class="hljs-comment">unit</span> <span class="hljs-comment">out</span> <span class="hljs-comment">of several from the rental market. The Ellis Act is included in the</span> <span class="hljs-comment">just</span> <span class="hljs-comment">causes</span> 
        <span class="hljs-comment">for eviction under the Rent</span> <span class="hljs-comment">Ordinance</span> <span class="hljs-comment">as</span> <span class="hljs-comment">Section</span> <span class="hljs-comment">37</span><span class="hljs-string">.</span><span class="hljs-comment">9(a)13)</span><span class="hljs-string">.</span><span class="hljs-comment">`)</span><span class="hljs-string">,</span>
      <span class="hljs-comment">link:</span> <span class="hljs-comment">&#x27;https://www</span><span class="hljs-string">.</span><span class="hljs-comment">sftu</span><span class="hljs-string">.</span><span class="hljs-comment">org/ellis/&#x27;</span><span class="hljs-string">,</span>
      <span class="hljs-comment">credit:</span> <span class="hljs-comment">t(&#x27;SF</span> <span class="hljs-comment">Tenants</span> <span class="hljs-comment">Union&#x27;)</span>
    <span class="hljs-comment">}</span><span class="hljs-string">,</span>
    <span class="hljs-comment">{</span>
      <span class="hljs-comment">siteId:</span> <span class="hljs-comment">&#x27;estoppel</span><span class="hljs-literal">-</span><span class="hljs-comment">agreement&#x27;</span><span class="hljs-string">,</span>
      <span class="hljs-comment">term:</span> <span class="hljs-comment">t(&#x27;Estoppel</span> <span class="hljs-comment">Agreement&#x27;)</span><span class="hljs-string">,</span>
      <span class="hljs-comment">definition:</span> <span class="hljs-comment">t(`When a building is for</span> <span class="hljs-comment">sale</span><span class="hljs-string">,</span> <span class="hljs-comment">the realtor often gives tenants</span> <span class="hljs-comment">an</span> <span class="hljs-comment">“estoppel</span> <span class="hljs-comment">agreement”</span> <span class="hljs-comment">or</span> 
      <span class="hljs-comment">“rental</span> <span class="hljs-comment">questionnaire” to sign. The landlord is seeking information in this form to tie</span> <span class="hljs-comment">your</span> <span class="hljs-comment">down</span> 
        <span class="hljs-comment">to what you understand your rental agreement means. You</span> <span class="hljs-comment">do not have to fill</span> <span class="hljs-comment">out</span> <span class="hljs-comment">or sign this form </span>
        <span class="hljs-comment">unless your rental agreement requires that you fill out any estoppel agreements or</span> <span class="hljs-comment">similar</span> <span class="hljs-comment">requests;</span> 
        <span class="hljs-comment">it is for the landlord’s convenience. Any statements you</span> <span class="hljs-comment">agree</span> <span class="hljs-comment">to</span> <span class="hljs-comment">(explicitly</span> <span class="hljs-comment">or</span> <span class="hljs-comment">through</span> <span class="hljs-comment">omission)</span> <span class="hljs-comment">may</span> 
        <span class="hljs-comment">come back to haunt you</span> <span class="hljs-comment">later</span><span class="hljs-string">.</span><span class="hljs-comment">`)</span><span class="hljs-string">,</span>
      <span class="hljs-comment">link:</span> <span class="hljs-comment">&#x27;https://www</span><span class="hljs-string">.</span><span class="hljs-comment">sftu</span><span class="hljs-string">.</span><span class="hljs-comment">org/sale/&#x27;</span><span class="hljs-string">,</span>
      <span class="hljs-comment">credit:</span> <span class="hljs-comment">t(&#x27;SF</span> <span class="hljs-comment">Tenants</span> <span class="hljs-comment">Union&#x27;)</span>
    <span class="hljs-comment">}</span><span class="hljs-string">,</span>
    <span class="hljs-comment">{</span>
      <span class="hljs-comment">siteId:</span> <span class="hljs-comment">&#x27;evictor&#x27;</span><span class="hljs-string">,</span>
      <span class="hljs-comment">term:</span> <span class="hljs-comment">t(&#x27;Evictor&#x27;)</span><span class="hljs-string">,</span>
      <span class="hljs-comment">definition:</span> <span class="hljs-comment">t(&#x27;An</span> <span class="hljs-comment">entity</span> <span class="hljs-comment">or corporation taking legal action to remove someone from occupying a building and/or</span> <span class="hljs-comment">their</span> <span class="hljs-comment">home</span><span class="hljs-string">.</span> <span class="hljs-comment">We recognize that evictions also take place through unofficial</span> <span class="hljs-comment">and</span> <span class="hljs-comment">nonlegal</span> <span class="hljs-comment">means</span><span class="hljs-string">,</span> <span class="hljs-comment">also</span> <span class="hljs-comment">by</span> <span class="hljs-comment">evictors</span><span class="hljs-string">.</span> <span class="hljs-comment">In</span> <span class="hljs-comment">this</span> <span class="hljs-comment">tool</span><span class="hljs-string">,</span> <span class="hljs-comment">however</span><span class="hljs-string">,</span> <span class="hljs-comment">we are only looking at</span> <span class="hljs-comment">formal</span> <span class="hljs-comment">evictions</span><span class="hljs-string">.</span><span class="hljs-comment">&#x27;)</span><span class="hljs-string">,</span>
      <span class="hljs-comment">link:</span> <span class="hljs-comment">&#x27;https://antievictionmap</span><span class="hljs-string">.</span><span class="hljs-comment">com/&#x27;</span><span class="hljs-string">,</span>
      <span class="hljs-comment">credit:</span> <span class="hljs-comment">t(&#x27;Anti</span><span class="hljs-literal">-</span><span class="hljs-comment">Eviction</span> <span class="hljs-comment">Mapping</span> <span class="hljs-comment">Project&#x27;)</span>
    <span class="hljs-comment">}</span><span class="hljs-string">,</span>
    <span class="hljs-comment">{</span>
      <span class="hljs-comment">siteId:</span> <span class="hljs-comment">&#x27;exempt</span><span class="hljs-literal">-</span><span class="hljs-comment">eligibility&#x27;</span><span class="hljs-string">,</span>
      <span class="hljs-comment">term:</span> <span class="hljs-comment">t(&#x27;Exemptions</span> <span class="hljs-comment">from</span> <span class="hljs-comment">Eligibility&#x27;)</span><span class="hljs-string">,</span>
      <span class="hljs-comment">definition:</span> <span class="hljs-comment">t(`Rental units located in a structure for which a</span> <span class="hljs-comment">certificate</span> <span class="hljs-comment">of occupancy was first issued</span> 
        <span class="hljs-comment">after the effective date of</span> <span class="hljs-comment">this</span> <span class="hljs-comment">ordinance</span> <span class="hljs-comment">(6/13/1979)</span>
        <span class="hljs-comment">Unit where substantial rehabilitation was undertaken after effective date</span> <span class="hljs-comment">of</span> <span class="hljs-comment">this</span> <span class="hljs-comment">ordinance</span>
        <span class="hljs-comment">Units exempted from rent stabilization</span> <span class="hljs-comment">by</span> <span class="hljs-comment">Costa</span><span class="hljs-literal">-</span><span class="hljs-comment">Hawkins:</span> <span class="hljs-comment">single</span> <span class="hljs-comment">family</span> <span class="hljs-comment">homes`)</span><span class="hljs-string">,</span>
      <span class="hljs-comment">link:</span> <span class="hljs-comment">&#x27;https://docs</span><span class="hljs-string">.</span><span class="hljs-comment">google</span><span class="hljs-string">.</span><span class="hljs-comment">com/spreadsheets/d/13UjOKg07X</span><span class="hljs-literal">-</span><span class="hljs-comment">GP2AETMKcXqBDUCwJ_dvsLZzzvLkLCj1E/edit#gid=0&#x27;</span><span class="hljs-string">,</span>
      <span class="hljs-comment">credit:</span> <span class="hljs-comment">t(&#x27;Tenants</span> <span class="hljs-comment">Together</span> <span class="hljs-comment">/</span> <span class="hljs-comment">Urban</span> <span class="hljs-comment">Displacement</span> <span class="hljs-comment">Project&#x27;)</span>
    <span class="hljs-comment">}</span><span class="hljs-string">,</span>
    <span class="hljs-comment">{</span>
      <span class="hljs-comment">siteId:</span> <span class="hljs-comment">&#x27;habitability</span><span class="hljs-literal">-</span><span class="hljs-comment">repairs&#x27;</span><span class="hljs-string">,</span>
      <span class="hljs-comment">term:</span> <span class="hljs-comment">t(&#x27;Habitability</span> <span class="hljs-comment">and</span> <span class="hljs-comment">Repairs&#x27;)</span><span class="hljs-string">,</span>
      <span class="hljs-comment">definition:</span> <span class="hljs-comment">t(`Tenants have the right to safe and habitable homes in exchange for the</span> <span class="hljs-comment">rents</span> <span class="hljs-comment">we</span> <span class="hljs-comment">are</span> <span class="hljs-comment">paying</span><span class="hljs-string">.</span> 
        <span class="hljs-comment">If your landlord is not</span> <span class="hljs-comment">making</span> <span class="hljs-comment">repairs</span><span class="hljs-string">,</span> <span class="hljs-comment">he</span> <span class="hljs-comment">or she is violating your</span> <span class="hljs-comment">“Warranty</span> <span class="hljs-comment">of</span> <span class="hljs-comment">Habitability”</span> <span class="hljs-comment">and</span> <span class="hljs-comment">you</span> 
        <span class="hljs-comment">have the right to have repairs made. Tenants have the right to report landlords to city agencies</span> <span class="hljs-comment">and</span> 
        <span class="hljs-comment">rights to withhold rent or</span> <span class="hljs-comment">“repair</span> <span class="hljs-comment">and</span> <span class="hljs-comment">deduct</span><span class="hljs-string">.</span><span class="hljs-comment">” And the landlord cannot</span> <span class="hljs-comment">retaliate</span> <span class="hljs-comment">against</span> <span class="hljs-comment">you;</span> <span class="hljs-comment">any</span> 
        <span class="hljs-comment">eviction</span> <span class="hljs-comment">or rent increase attempt within</span> <span class="hljs-comment">six</span> <span class="hljs-comment">months</span> <span class="hljs-comment">of such a complaint will</span> <span class="hljs-comment">be</span> <span class="hljs-comment">examined</span> <span class="hljs-comment">by</span> <span class="hljs-comment">the</span> <span class="hljs-comment">judge</span> 
        <span class="hljs-comment">for</span> <span class="hljs-comment">retaliation</span><span class="hljs-string">.</span><span class="hljs-comment">`)</span><span class="hljs-string">,</span>
      <span class="hljs-comment">link:</span> <span class="hljs-comment">&#x27;https://www</span><span class="hljs-string">.</span><span class="hljs-comment">sftu</span><span class="hljs-string">.</span><span class="hljs-comment">org/repairs/&#x27;</span><span class="hljs-string">,</span>
      <span class="hljs-comment">credit:</span> <span class="hljs-comment">t(&#x27;SF</span> <span class="hljs-comment">Tenants</span> <span class="hljs-comment">Union&#x27;)</span>
    <span class="hljs-comment">}</span><span class="hljs-string">,</span>
    <span class="hljs-comment">{</span>
      <span class="hljs-comment">siteId:</span> <span class="hljs-comment">&#x27;harassment&#x27;</span><span class="hljs-string">,</span>
      <span class="hljs-comment">term:</span> <span class="hljs-comment">t(&#x27;Harassment&#x27;)</span><span class="hljs-string">,</span>
      <span class="hljs-comment">definition:</span> <span class="hljs-comment">t(`Your</span> <span class="hljs-comment">landlord</span><span class="hljs-string">,</span> <span class="hljs-comment">or anyone acting for your</span> <span class="hljs-comment">landlord</span><span class="hljs-string">,</span> <span class="hljs-comment">cannot harass you out of</span> <span class="hljs-comment">your</span> <span class="hljs-comment">home</span><span class="hljs-string">.</span> 
        <span class="hljs-comment">Landlords cannot evict you by just locking you out</span><span class="hljs-string">,</span> <span class="hljs-comment">shutting</span> <span class="hljs-comment">off</span> <span class="hljs-comment">your</span> <span class="hljs-comment">utilities</span><span class="hljs-string">,</span> <span class="hljs-comment">forcibly</span> <span class="hljs-comment">entering</span> 
        <span class="hljs-comment">your</span> <span class="hljs-comment">home</span> <span class="hljs-comment">without</span> <span class="hljs-comment">notice</span><span class="hljs-string">,</span> <span class="hljs-comment">or</span> <span class="hljs-comment">removing</span> <span class="hljs-comment">your</span> <span class="hljs-comment">belongings</span><span class="hljs-string">.</span><span class="hljs-comment">`)</span><span class="hljs-string">,</span>
      <span class="hljs-comment">link:</span> <span class="hljs-comment">&#x27;https://www</span><span class="hljs-string">.</span><span class="hljs-comment">sftu</span><span class="hljs-string">.</span><span class="hljs-comment">org/harass/&#x27;</span><span class="hljs-string">,</span>
      <span class="hljs-comment">credit:</span> <span class="hljs-comment">t(&#x27;SF</span> <span class="hljs-comment">Tenants</span> <span class="hljs-comment">Union&#x27;)</span>
    <span class="hljs-comment">}</span><span class="hljs-string">,</span>
    <span class="hljs-comment">{</span>
      <span class="hljs-comment">siteId:</span> <span class="hljs-comment">&#x27;just</span><span class="hljs-literal">-</span><span class="hljs-comment">cause</span><span class="hljs-literal">-</span><span class="hljs-comment">fault</span><span class="hljs-literal">-</span><span class="hljs-comment">eviction&#x27;</span><span class="hljs-string">,</span>
      <span class="hljs-comment">term:</span> <span class="hljs-comment">t(&#x27;Just</span> <span class="hljs-comment">Cause</span> <span class="hljs-comment">/</span> <span class="hljs-comment">Fault</span> <span class="hljs-comment">Eviction&#x27;)</span><span class="hljs-string">,</span>
      <span class="hljs-comment">definition:</span> <span class="hljs-comment">t(`For</span> <span class="hljs-comment">rent</span><span class="hljs-literal">-</span><span class="hljs-comment">controlled</span> <span class="hljs-comment">units</span><span class="hljs-string">,</span> <span class="hljs-comment">the landlord must have honest</span> <span class="hljs-comment">intent</span><span class="hljs-string">,</span> <span class="hljs-comment">without</span> <span class="hljs-comment">ulterior</span> <span class="hljs-comment">motive</span> 
        <span class="hljs-comment">(e</span><span class="hljs-string">.</span><span class="hljs-comment">g</span><span class="hljs-string">.</span><span class="hljs-string">,</span> <span class="hljs-comment">a</span> <span class="hljs-comment">motive</span> <span class="hljs-comment">of</span> <span class="hljs-comment">raising</span> <span class="hljs-comment">the</span> <span class="hljs-comment">rent) to evict the tenant</span> <span class="hljs-comment">with</span> <span class="hljs-comment">“just</span> <span class="hljs-comment">cause</span><span class="hljs-string">.</span><span class="hljs-comment">” Below are the just</span> <span class="hljs-comment">causes</span> 
        <span class="hljs-comment">summarized; for the legal wording get the rent control ordinance and see Section</span> <span class="hljs-comment">37</span><span class="hljs-string">.</span><span class="hljs-comment">9(a)</span><span class="hljs-string">.</span> 
        <span class="hljs-comment">If</span> <span class="hljs-comment">done</span> <span class="hljs-comment">properly</span><span class="hljs-string">,</span> <span class="hljs-comment">the landlord may evict for these just causes. (The landlord may also evict</span> <span class="hljs-comment">without</span> 
        <span class="hljs-comment">a just cause under rent control if the landlord shares the rental unit</span> <span class="hljs-comment">with</span> <span class="hljs-comment">the</span> <span class="hljs-comment">tenant</span><span class="hljs-string">.</span><span class="hljs-comment">)</span> <span class="hljs-comment">However</span><span class="hljs-string">,</span> 
        <span class="hljs-comment">many</span> <span class="hljs-comment">of these eviction attempts are done improperly and may</span> <span class="hljs-comment">be successfully defended. Talk to</span> <span class="hljs-comment">a</span> 
        <span class="hljs-comment">counselor</span> <span class="hljs-comment">and/or get our handbook to find out your defenses</span><span class="hljs-string">.</span><span class="hljs-comment">`)</span><span class="hljs-string">,</span>
      <span class="hljs-comment">link:</span> <span class="hljs-comment">&#x27;https://www</span><span class="hljs-string">.</span><span class="hljs-comment">sftu</span><span class="hljs-string">.</span><span class="hljs-comment">org/justcauses/&#x27;</span><span class="hljs-string">,</span>
      <span class="hljs-comment">credit:</span> <span class="hljs-comment">t(&#x27;SF</span> <span class="hljs-comment">Tenants</span> <span class="hljs-comment">Union&#x27;)</span>
    <span class="hljs-comment">}</span><span class="hljs-string">,</span>
    <span class="hljs-comment">{</span>
      <span class="hljs-comment">siteId:</span> <span class="hljs-comment">&#x27;llc&#x27;</span><span class="hljs-string">,</span>
      <span class="hljs-comment">term:</span> <span class="hljs-comment">t(&#x27;LLC&#x27;)</span><span class="hljs-string">,</span>
      <span class="hljs-comment">definition:</span> <span class="hljs-comment">t(`A limited liability company (LLC) is the US-specific form</span> <span class="hljs-comment">of a private limited company</span><span class="hljs-string">.</span> 
        <span class="hljs-comment">It is a business structure that can combine the</span> <span class="hljs-comment">pass</span><span class="hljs-literal">-</span><span class="hljs-comment">through</span> <span class="hljs-comment">taxation</span> <span class="hljs-comment">of</span> <span class="hljs-comment">a</span> <span class="hljs-comment">partnership</span> <span class="hljs-comment">or</span> <span class="hljs-comment">sole</span> 
        <span class="hljs-comment">proprietorship with the limited liability</span> <span class="hljs-comment">of</span> <span class="hljs-comment">a</span> <span class="hljs-comment">corporation</span><span class="hljs-string">.</span> <span class="hljs-comment">An</span> <span class="hljs-comment">LLC is not a corporation</span> <span class="hljs-comment">under</span> <span class="hljs-comment">state</span> <span class="hljs-comment">law;</span> 
        <span class="hljs-comment">it is a legal form</span> <span class="hljs-comment">of a company that provides limited liability to its owners in many jurisdictions</span><span class="hljs-string">.</span> 
        <span class="hljs-comment">LLCs are well known for the flexibility that they provide to business owners; depending on the situation</span><span class="hljs-string">,</span> 
        <span class="hljs-comment">an</span> <span class="hljs-comment">LLC may elect to use corporate tax rules instead</span> <span class="hljs-comment">of</span> <span class="hljs-comment">being</span> <span class="hljs-comment">treated</span> <span class="hljs-comment">as</span> <span class="hljs-comment">a</span> <span class="hljs-comment">partnership</span> <span class="hljs-comment">and</span><span class="hljs-string">,</span> <span class="hljs-comment">under</span> <span class="hljs-comment">certain</span> 
        <span class="hljs-comment">circumstances</span><span class="hljs-string">,</span> <span class="hljs-comment">LLCs</span> <span class="hljs-comment">may</span> <span class="hljs-comment">be</span> <span class="hljs-comment">organized</span> <span class="hljs-comment">as</span> <span class="hljs-comment">not</span><span class="hljs-literal">-</span><span class="hljs-comment">for</span><span class="hljs-literal">-</span><span class="hljs-comment">profit</span><span class="hljs-string">.</span> <span class="hljs-comment">Many landlords and speculators use</span> <span class="hljs-comment">LLCs</span> <span class="hljs-comment">as</span> <span class="hljs-comment">shell</span> 
        <span class="hljs-comment">companies to buy properties and evict tenants. This provides them anonymity and protection</span><span class="hljs-string">.</span><span class="hljs-comment">`)</span><span class="hljs-string">,</span>
      <span class="hljs-comment">link:</span> <span class="hljs-comment">&#x27;https://en</span><span class="hljs-string">.</span><span class="hljs-comment">wikipedia</span><span class="hljs-string">.</span><span class="hljs-comment">org/wiki/Limited_liability_company&#x27;</span><span class="hljs-string">,</span>
      <span class="hljs-comment">credit:</span> <span class="hljs-comment">t(&#x27;Wikipedia&#x27;)</span>
    <span class="hljs-comment">}</span><span class="hljs-string">,</span>
    <span class="hljs-comment">{</span>
      <span class="hljs-comment">siteId:</span> <span class="hljs-comment">&#x27;mergers</span><span class="hljs-literal">-</span><span class="hljs-comment">demolitions&#x27;</span><span class="hljs-string">,</span>
      <span class="hljs-comment">term:</span> <span class="hljs-comment">t(&#x27;Mergers</span> <span class="hljs-comment">and</span> <span class="hljs-comment">Demolitions&#x27;)</span><span class="hljs-string">,</span>
      <span class="hljs-comment">definition:</span> <span class="hljs-comment">t(`Mergers and demolition evictions should</span> <span class="hljs-comment">be done under eviction just</span> <span class="hljs-comment">cause</span> <span class="hljs-comment">37</span><span class="hljs-string">.</span><span class="hljs-comment">9(a)(10) if the rental </span>
        <span class="hljs-comment">unit is covered under the San Francisco Rent Ordinance and is a single unit. Developments may be able to demolish </span>
        <span class="hljs-comment">multiple units under just cause</span> <span class="hljs-comment">37</span><span class="hljs-string">.</span><span class="hljs-comment">9(a)(15)</span><span class="hljs-string">.</span> <span class="hljs-comment">Just</span> <span class="hljs-comment">cause</span> <span class="hljs-comment">37</span><span class="hljs-string">.</span><span class="hljs-comment">9(a)(15) has been used to evict many tenants in</span> <span class="hljs-comment">developments</span> 
        <span class="hljs-comment">such</span> <span class="hljs-comment">as Trinity Properties and Park Merced. Other evictions are anticipated using this just cause unless the law</span> <span class="hljs-comment">is</span> <span class="hljs-comment">changed</span><span class="hljs-string">.</span> 
        <span class="hljs-comment">It is particularly important in</span> <span class="hljs-comment">these</span> <span class="hljs-comment">cases</span> <span class="hljs-comment">of</span> <span class="hljs-comment">demolition</span> <span class="hljs-comment">of multiple units to organize</span> <span class="hljs-comment">as</span> <span class="hljs-comment">tenants</span><span class="hljs-string">.</span><span class="hljs-comment">`)</span><span class="hljs-string">,</span>
      <span class="hljs-comment">link:</span> <span class="hljs-comment">&#x27;https://www</span><span class="hljs-string">.</span><span class="hljs-comment">sftu</span><span class="hljs-string">.</span><span class="hljs-comment">org/merger/&#x27;</span><span class="hljs-string">,</span>
      <span class="hljs-comment">credit:</span> <span class="hljs-comment">t(&#x27;SF</span> <span class="hljs-comment">Tenants</span> <span class="hljs-comment">Union&#x27;)</span>
    <span class="hljs-comment">}</span><span class="hljs-string">,</span>
    <span class="hljs-comment">{</span>
      <span class="hljs-comment">siteId:</span> <span class="hljs-comment">&#x27;omi</span><span class="hljs-literal">-</span><span class="hljs-comment">evictions&#x27;</span><span class="hljs-string">,</span>
      <span class="hljs-comment">term:</span> <span class="hljs-comment">t(&#x27;Owner</span> <span class="hljs-comment">Move</span> <span class="hljs-comment">In</span> <span class="hljs-comment">(OMI)</span> <span class="hljs-comment">Evictions&#x27;)</span><span class="hljs-string">,</span>
      <span class="hljs-comment">definition:</span> <span class="hljs-comment">t(`For</span> <span class="hljs-comment">rent</span><span class="hljs-literal">-</span><span class="hljs-comment">controlled</span> <span class="hljs-comment">units</span><span class="hljs-string">,</span> <span class="hljs-comment">one</span> <span class="hljs-comment">of the most common evictions in San Francisco is</span> <span class="hljs-comment">for</span> <span class="hljs-comment">owner</span> <span class="hljs-comment">or</span> <span class="hljs-comment">relative</span> <span class="hljs-comment">move</span><span class="hljs-literal">-</span><span class="hljs-comment">in</span> 
        <span class="hljs-comment">(San Francisco Administrative Code Section</span> <span class="hljs-comment">37</span><span class="hljs-string">.</span><span class="hljs-comment">9(a)(8))</span><span class="hljs-string">.</span> <span class="hljs-comment">Subject</span> <span class="hljs-comment">to</span> <span class="hljs-comment">certain</span> <span class="hljs-comment">restrictions</span><span class="hljs-string">,</span><span class="hljs-comment">a landlord can evict a</span> <span class="hljs-comment">tenant</span> <span class="hljs-comment">if</span> 
        <span class="hljs-comment">the landlord is going to move into the unit</span> <span class="hljs-comment">to</span> <span class="hljs-comment">live</span><span class="hljs-string">,</span> <span class="hljs-comment">or</span> <span class="hljs-comment">(only if the landlord is also going to be living in the building)</span> 
        <span class="hljs-comment">for a close relative to move in and live there. These evictions are highly abused and landlords who want to evict</span> <span class="hljs-comment">a</span> <span class="hljs-comment">tenant</span> 
        <span class="hljs-comment">in order to raise the rent on a new tenant typically use owner</span> <span class="hljs-comment">move</span><span class="hljs-literal">-</span><span class="hljs-comment">in</span> <span class="hljs-comment">evictions</span> <span class="hljs-comment">(OMIs/landlord</span> <span class="hljs-comment">move</span><span class="hljs-literal">-</span><span class="hljs-comment">in</span> <span class="hljs-comment">evictions/LMIs)</span> <span class="hljs-comment">that</span> 
        <span class="hljs-comment">are only allowed if done</span> <span class="hljs-comment">properly</span><span class="hljs-string">.</span><span class="hljs-comment">`)</span><span class="hljs-string">,</span>
      <span class="hljs-comment">link:</span> <span class="hljs-comment">&#x27;https://www</span><span class="hljs-string">.</span><span class="hljs-comment">sftu</span><span class="hljs-string">.</span><span class="hljs-comment">org/omi/&#x27;</span><span class="hljs-string">,</span>
      <span class="hljs-comment">credit:</span> <span class="hljs-comment">t(&#x27;SF</span> <span class="hljs-comment">Tenants</span> <span class="hljs-comment">Union&#x27;)</span>
    <span class="hljs-comment">}</span><span class="hljs-string">,</span>
    <span class="hljs-comment">{</span>
      <span class="hljs-comment">siteId:</span> <span class="hljs-comment">&#x27;rent</span><span class="hljs-literal">-</span><span class="hljs-comment">control&#x27;</span><span class="hljs-string">,</span>
      <span class="hljs-comment">term:</span> <span class="hljs-comment">t(&#x27;Rent</span> <span class="hljs-comment">Control&#x27;)</span><span class="hljs-string">,</span>
      <span class="hljs-comment">definition:</span> <span class="hljs-comment">t(`In</span> <span class="hljs-comment">San</span> <span class="hljs-comment">Francisco</span><span class="hljs-string">,</span> <span class="hljs-comment">most residential tenants are covered</span> <span class="hljs-comment">by rent control. This means rents can only be</span> <span class="hljs-comment">raised</span> <span class="hljs-comment">by</span> <span class="hljs-comment">certain</span> 
        <span class="hljs-comment">amounts per year and the tenant can only be</span> <span class="hljs-comment">evicted</span> <span class="hljs-comment">for</span> <span class="hljs-comment">“just</span> <span class="hljs-comment">causes</span><span class="hljs-string">.</span><span class="hljs-comment">”</span> <span class="hljs-comment">In</span> <span class="hljs-comment">addition</span><span class="hljs-string">,</span> <span class="hljs-comment">some rental units have restrictions on how much </span>
        <span class="hljs-comment">the landlord can charge the new tenant due to previous evictions. Tenants who</span> <span class="hljs-comment">do not have rent control can have their rent</span> <span class="hljs-comment">increased</span> 
        <span class="hljs-comment">by any amount at any time with a proper</span> <span class="hljs-comment">written</span> <span class="hljs-comment">notice</span><span class="hljs-string">.</span><span class="hljs-comment">`)</span><span class="hljs-string">,</span>
      <span class="hljs-comment">link:</span> <span class="hljs-comment">&#x27;https://www</span><span class="hljs-string">.</span><span class="hljs-comment">sftu</span><span class="hljs-string">.</span><span class="hljs-comment">org/rent</span><span class="hljs-literal">-</span><span class="hljs-comment">control/&#x27;</span><span class="hljs-string">,</span>
      <span class="hljs-comment">credit:</span> <span class="hljs-comment">t(&#x27;SF</span> <span class="hljs-comment">Tenants</span> <span class="hljs-comment">Union&#x27;)</span>
    <span class="hljs-comment">}</span><span class="hljs-string">,</span>
    <span class="hljs-comment">{</span>
      <span class="hljs-comment">siteid:</span> <span class="hljs-comment">&#x27;sale</span><span class="hljs-literal">-</span><span class="hljs-comment">of</span><span class="hljs-literal">-</span><span class="hljs-comment">building&#x27;</span><span class="hljs-string">,</span>
      <span class="hljs-comment">term:</span> <span class="hljs-comment">t(&#x27;Sale</span> <span class="hljs-comment">of</span> <span class="hljs-comment">Building&#x27;)</span><span class="hljs-string">,</span>
      <span class="hljs-comment">definition:</span> <span class="hljs-comment">t(`All</span> <span class="hljs-comment">agreements</span> <span class="hljs-comment">(such</span> <span class="hljs-comment">as written and oral month</span><span class="hljs-literal">-</span><span class="hljs-comment">to</span><span class="hljs-literal">-</span><span class="hljs-comment">month</span> <span class="hljs-comment">or</span> <span class="hljs-comment">lease</span> <span class="hljs-comment">agreements) you made with the old landlord are binding on the new </span>
        <span class="hljs-comment">landlord</span><span class="hljs-string">.</span> <span class="hljs-comment">Similarly</span><span class="hljs-string">,</span> <span class="hljs-comment">the new landlord is bound to any legal orders</span> <span class="hljs-comment">or judgments: if the Department</span> <span class="hljs-comment">of Building Inspection ordered the</span> <span class="hljs-comment">old</span> 
        <span class="hljs-comment">landlord</span> <span class="hljs-comment">to</span> <span class="hljs-comment">make</span> <span class="hljs-comment">repairs</span><span class="hljs-string">,</span> <span class="hljs-comment">the new landlord must make</span> <span class="hljs-comment">those</span> <span class="hljs-comment">repairs; if the Rent Board has ordered rents reduced</span><span class="hljs-string">,</span> <span class="hljs-comment">the new landlord must follow</span> 
        <span class="hljs-comment">this order. The seller and</span> <span class="hljs-comment">buyer</span> <span class="hljs-comment">of a multi-unit building covered under the San Francisco Rent Ordinance must disclose</span> <span class="hljs-comment">to</span> <span class="hljs-comment">tenants</span> <span class="hljs-comment">(in</span> <span class="hljs-comment">writing)</span> 
        <span class="hljs-comment">that</span> <span class="hljs-comment">they</span> <span class="hljs-comment">cannot</span> <span class="hljs-comment">be</span> <span class="hljs-comment">evicted</span><span class="hljs-string">,</span> <span class="hljs-comment">have</span> <span class="hljs-comment">their</span> <span class="hljs-comment">rent</span> <span class="hljs-comment">increased</span><span class="hljs-string">,</span> <span class="hljs-comment">or have the terms of their tenancy changed just because the building is</span> <span class="hljs-comment">being</span> <span class="hljs-comment">sold</span> <span class="hljs-comment">or</span> <span class="hljs-comment">has</span> <span class="hljs-comment">sold</span><span class="hljs-string">.</span> 
        <span class="hljs-comment">Beware</span><span class="hljs-string">,</span> <span class="hljs-comment">though</span><span class="hljs-string">,</span> <span class="hljs-comment">many landlords try to use</span> <span class="hljs-comment">the</span> <span class="hljs-comment">sale</span> <span class="hljs-comment">or</span> <span class="hljs-comment">foreclosure</span> <span class="hljs-comment">of a building to intimidate</span> <span class="hljs-comment">tenants</span><span class="hljs-string">.</span><span class="hljs-comment">`)</span><span class="hljs-string">,</span>
      <span class="hljs-comment">link:</span> <span class="hljs-comment">&#x27;https://www</span><span class="hljs-string">.</span><span class="hljs-comment">sftu</span><span class="hljs-string">.</span><span class="hljs-comment">org/sale/&#x27;</span><span class="hljs-string">,</span>
      <span class="hljs-comment">credit:</span> <span class="hljs-comment">t(&#x27;SF</span> <span class="hljs-comment">Tenants</span> <span class="hljs-comment">Union&#x27;)</span>
    <span class="hljs-comment">}</span><span class="hljs-string">,</span>
    <span class="hljs-comment">{</span>
      <span class="hljs-comment">siteId:</span> <span class="hljs-comment">&#x27;short</span><span class="hljs-literal">-</span><span class="hljs-comment">term</span><span class="hljs-literal">-</span><span class="hljs-comment">rentals&#x27;</span><span class="hljs-string">,</span>
      <span class="hljs-comment">term:</span> <span class="hljs-comment">t(&#x27;Short</span> <span class="hljs-comment">Term</span> <span class="hljs-comment">Rentals&#x27;)</span><span class="hljs-string">,</span>
      <span class="hljs-comment">definition:</span> <span class="hljs-comment">t(`Short term vacation rentals replace long term housing stock in San Francisco and in cities across the</span> <span class="hljs-comment">world</span><span class="hljs-string">.</span> <span class="hljs-comment">In</span> <span class="hljs-comment">San</span> <span class="hljs-comment">Franicsco</span><span class="hljs-string">,</span> 
        <span class="hljs-comment">Airbnb has reduced vacant rental</span> <span class="hljs-comment">housing</span> <span class="hljs-comment">stock</span> <span class="hljs-comment">by</span> <span class="hljs-comment">as</span> <span class="hljs-comment">much</span> <span class="hljs-comment">as</span> <span class="hljs-comment">43</span> <span class="hljs-comment">percent</span><span class="hljs-string">,</span> <span class="hljs-comment">making homes even less affordable</span><span class="hljs-string">.</span> <span class="hljs-comment">At</span> <span class="hljs-comment">times</span><span class="hljs-string">,</span> <span class="hljs-comment">tenants</span> <span class="hljs-comment">are</span> <span class="hljs-comment">illegally</span> 
        <span class="hljs-comment">evicted and their rooms become</span> <span class="hljs-comment">Airbnb</span> <span class="hljs-comment">units</span><span class="hljs-string">.</span><span class="hljs-comment">`)</span><span class="hljs-string">,</span>
      <span class="hljs-comment">link:</span> <span class="hljs-comment">&#x27;https://www</span><span class="hljs-string">.</span><span class="hljs-comment">sftu</span><span class="hljs-string">.</span><span class="hljs-comment">org/short</span><span class="hljs-literal">-</span><span class="hljs-comment">term</span><span class="hljs-literal">-</span><span class="hljs-comment">rentals/&#x27;</span><span class="hljs-string">,</span>
      <span class="hljs-comment">credit:</span> <span class="hljs-comment">t(&#x27;SF</span> <span class="hljs-comment">Tenants</span> <span class="hljs-comment">Union&#x27;)</span>
    <span class="hljs-comment">}</span>
  <span class="hljs-title">]</span>

  <span class="hljs-comment">const</span> <span class="hljs-comment">handleChange</span> <span class="hljs-comment">=</span> <span class="hljs-comment">panel</span> <span class="hljs-comment">=</span>&gt; <span class="hljs-comment">(event</span><span class="hljs-string">,</span> <span class="hljs-comment">isExpanded)</span> <span class="hljs-comment">=</span>&gt;
    <span class="hljs-comment">setExpanded(isExpanded</span> <span class="hljs-comment">?</span> <span class="hljs-comment">panel</span> <span class="hljs-comment">:</span> <span class="hljs-comment">false)</span>

  <span class="hljs-comment">return</span> <span class="hljs-comment">(</span>
    &lt;<span class="hljs-comment">Row</span> <span class="hljs-comment">justify=&#x27;center&#x27;</span>&gt;
      &lt;<span class="hljs-comment">Col</span> <span class="hljs-comment">xs={10}</span> <span class="hljs-comment">sm={8}</span> <span class="hljs-comment">md={6}</span>&gt;
        &lt;<span class="hljs-comment">PageTitle</span> <span class="hljs-comment">text={t(&#x27;Glossary&#x27;)}</span> <span class="hljs-comment">/</span>&gt;
        <span class="hljs-comment">{terms</span><span class="hljs-string">.</span><span class="hljs-comment">map((term</span><span class="hljs-string">,</span><span class="hljs-comment">index)</span> <span class="hljs-comment">=</span>&gt;
          &lt;<span class="hljs-comment">Accordion</span>
            <span class="hljs-comment">expanded={expanded</span> <span class="hljs-comment">===</span> <span class="hljs-comment">&#x27;panel&#x27;</span> <span class="hljs-literal">+</span> <span class="hljs-comment">index}</span>
            <span class="hljs-comment">key={index}</span>
            <span class="hljs-comment">onChange={handleChange(&#x27;panel&#x27;</span> <span class="hljs-literal">+</span> <span class="hljs-comment">index)}</span>&gt;
            &lt;<span class="hljs-comment">AccordionSummary</span>
              <span class="hljs-comment">expandIcon={</span>&lt;<span class="hljs-comment">ExpandMoreIcon</span> <span class="hljs-comment">/</span>&gt;<span class="hljs-comment">}</span>
              <span class="hljs-comment">aria</span><span class="hljs-literal">-</span><span class="hljs-comment">controls=&quot;panel1bh</span><span class="hljs-literal">-</span><span class="hljs-comment">content&quot;</span>
              <span class="hljs-comment">id=&quot;panel1bh</span><span class="hljs-literal">-</span><span class="hljs-comment">header&quot;</span>
            &gt;
              &lt;<span class="hljs-comment">Typography</span> <span class="hljs-comment">variant=&#x27;body2&#x27;</span>&gt;<span class="hljs-comment">{term</span><span class="hljs-string">.</span><span class="hljs-comment">term}</span>&lt;<span class="hljs-comment">/Typography</span>&gt;
            &lt;<span class="hljs-comment">/AccordionSummary</span>&gt;
            &lt;<span class="hljs-comment">AccordionDetails</span> <span class="hljs-comment">style={{display:</span> <span class="hljs-comment">&#x27;flex&#x27;</span><span class="hljs-string">,</span> <span class="hljs-comment">flexDirection:</span> <span class="hljs-comment">&#x27;column&#x27;}}</span>&gt;
              &lt;<span class="hljs-comment">Typography</span> <span class="hljs-comment">variant=&#x27;body2&#x27;</span>&gt;
                <span class="hljs-comment">{term</span><span class="hljs-string">.</span><span class="hljs-comment">definition}</span>
              &lt;<span class="hljs-comment">/Typography</span>&gt;
              &lt;<span class="hljs-comment">Typography</span> <span class="hljs-comment">variant=&#x27;body2&#x27;</span> <span class="hljs-comment">style={{marginTop:</span> <span class="hljs-comment">20}}</span>&gt;
                <span class="hljs-comment">{t(&#x27;Source:&#x27;)}&amp;nbsp;</span>
                &lt;<span class="hljs-comment">Link</span> <span class="hljs-comment">target=&#x27;_blank&#x27;</span> <span class="hljs-comment">href={term</span><span class="hljs-string">.</span><span class="hljs-comment">link}</span> <span class="hljs-comment">style={{</span>
                  <span class="hljs-comment">color:</span> <span class="hljs-comment">theme</span><span class="hljs-string">.</span><span class="hljs-comment">palette</span><span class="hljs-string">.</span><span class="hljs-comment">common</span><span class="hljs-string">.</span><span class="hljs-comment">EGGPLANT</span><span class="hljs-string">,</span>
                  <span class="hljs-comment">backgroundColor:</span> <span class="hljs-comment">theme</span><span class="hljs-string">.</span><span class="hljs-comment">palette</span><span class="hljs-string">.</span><span class="hljs-comment">common</span><span class="hljs-string">.</span><span class="hljs-comment">white</span>
                <span class="hljs-comment">}}</span>&gt;<span class="hljs-comment">{term</span><span class="hljs-string">.</span><span class="hljs-comment">credit}</span>&lt;<span class="hljs-comment">/Link</span>&gt;
              &lt;<span class="hljs-comment">/Typography</span>&gt;
            &lt;<span class="hljs-comment">/AccordionDetails</span>&gt;
          &lt;<span class="hljs-comment">/Accordion</span>&gt;
        <span class="hljs-comment">)}</span>
        <span class="hljs-comment">{questions</span><span class="hljs-string">.</span><span class="hljs-comment">map(question</span> <span class="hljs-comment">=</span>&gt;
          &lt;<span class="hljs-comment">Accordion</span>
            <span class="hljs-comment">expanded={expanded</span> <span class="hljs-comment">===</span> <span class="hljs-comment">&#x27;panel&#x27;</span> <span class="hljs-literal">+</span> <span class="hljs-comment">question</span><span class="hljs-string">.</span><span class="hljs-comment">siteId}</span>
            <span class="hljs-comment">key={question</span><span class="hljs-string">.</span><span class="hljs-comment">siteId}</span>
            <span class="hljs-comment">onChange={handleChange(&#x27;panel&#x27;</span> <span class="hljs-literal">+</span> <span class="hljs-comment">question</span><span class="hljs-string">.</span><span class="hljs-comment">siteId)}</span>&gt;
            &lt;<span class="hljs-comment">AccordionSummary</span>
              <span class="hljs-comment">expandIcon={</span>&lt;<span class="hljs-comment">ExpandMoreIcon</span> <span class="hljs-comment">/</span>&gt;<span class="hljs-comment">}</span>
              <span class="hljs-comment">aria</span><span class="hljs-literal">-</span><span class="hljs-comment">controls=&quot;panel1bh</span><span class="hljs-literal">-</span><span class="hljs-comment">content&quot;</span>
              <span class="hljs-comment">id=&quot;panel1bh</span><span class="hljs-literal">-</span><span class="hljs-comment">header&quot;</span>
            &gt;
              &lt;<span class="hljs-comment">Typography</span> <span class="hljs-comment">variant=&#x27;body2&#x27;</span>&gt;<span class="hljs-comment">{question</span><span class="hljs-string">.</span><span class="hljs-comment">question}</span>&lt;<span class="hljs-comment">/Typography</span>&gt;
            &lt;<span class="hljs-comment">/AccordionSummary</span>&gt;
            &lt;<span class="hljs-comment">AccordionDetails</span> <span class="hljs-comment">style={{display:</span> <span class="hljs-comment">&#x27;flex&#x27;</span><span class="hljs-string">,</span> <span class="hljs-comment">flexDirection:</span> <span class="hljs-comment">&#x27;column&#x27;}}</span>&gt;
              <span class="hljs-comment">{question</span><span class="hljs-string">.</span><span class="hljs-comment">answer</span><span class="hljs-string">.</span><span class="hljs-comment">map((point</span><span class="hljs-string">,</span><span class="hljs-comment">index)</span> <span class="hljs-comment">=</span>&gt;
                &lt;<span class="hljs-comment">ListItem</span> <span class="hljs-comment">button</span> <span class="hljs-comment">key={index}</span>&gt;
                  &lt;<span class="hljs-comment">Typography</span> <span class="hljs-comment">variant=&#x27;body2&#x27;</span>&gt;<span class="hljs-comment">{point}</span>&lt;<span class="hljs-comment">/Typography</span>&gt;
                &lt;<span class="hljs-comment">/ListItem</span>&gt;
              <span class="hljs-comment">)}</span>
              &lt;<span class="hljs-comment">Typography</span> <span class="hljs-comment">style={{marginTop:</span> <span class="hljs-comment">20}}</span> <span class="hljs-comment">variant=&#x27;body2&#x27;</span>&gt;
                <span class="hljs-comment">{t(&#x27;Source:&#x27;)}&amp;nbsp;</span>
                &lt;<span class="hljs-comment">Link</span> <span class="hljs-comment">target=&#x27;_blank&#x27;</span> <span class="hljs-comment">href={question</span><span class="hljs-string">.</span><span class="hljs-comment">link}</span> <span class="hljs-comment">style={{</span>
                  <span class="hljs-comment">color:</span> <span class="hljs-comment">theme</span><span class="hljs-string">.</span><span class="hljs-comment">palette</span><span class="hljs-string">.</span><span class="hljs-comment">common</span><span class="hljs-string">.</span><span class="hljs-comment">EGGPLANT</span><span class="hljs-string">,</span>
                  <span class="hljs-comment">backgroundColor:</span> <span class="hljs-comment">theme</span><span class="hljs-string">.</span><span class="hljs-comment">palette</span><span class="hljs-string">.</span><span class="hljs-comment">common</span><span class="hljs-string">.</span><span class="hljs-comment">white</span>
                <span class="hljs-comment">}}</span>&gt;
                  <span class="hljs-comment">{question</span><span class="hljs-string">.</span><span class="hljs-comment">credit}</span>
                &lt;<span class="hljs-comment">/Link</span>&gt;
              &lt;<span class="hljs-comment">/Typography</span>&gt;
            &lt;<span class="hljs-comment">/AccordionDetails</span>&gt;
          &lt;<span class="hljs-comment">/Accordion</span>&gt;
        <span class="hljs-comment">)}</span>
      &lt;<span class="hljs-comment">/Col</span>&gt;
    &lt;<span class="hljs-comment">/Row</span>&gt;
  <span class="hljs-comment">)</span>
<span class="hljs-comment">}</span>

<span class="hljs-comment">export</span> <span class="hljs-comment">default</span> <span class="hljs-comment">Glossary</span></pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrcpageshome.js"><a href="#toc"><a name="ui-src-pages-home-js">ui/src/pages/Home.js</a></a></h2>
<pre><code><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { memo } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ReactComponent</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">HomeIcon</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../images/home.svg&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ReactComponent</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">RentIcon</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../images/rent.svg&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ReactComponent</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">BalanceIcon</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../images/balance.svg&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Typography</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/Typography&#x27;</span>
<span class="hljs-keyword">import</span> { useTheme } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/styles&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Row</span>, <span class="hljs-title class_">Col</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../components/Grid&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">SearchBar</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../components/DataSearchBar/SearchBar&#x27;</span>
<span class="hljs-keyword">import</span> useStyles <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../theme/HomeStyles&#x27;</span>
<span class="hljs-keyword">import</span> { useTranslation } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-i18next&#x27;</span>
<span class="hljs-keyword">import</span> i18n <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../i18n&#x27;</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">DisplayItem</span> = (<span class="hljs-params">{ displayString1, displayString2, index }</span>) =&gt; {

  <span class="hljs-keyword">const</span> theme = <span class="hljs-title function_">useTheme</span>()
  <span class="hljs-keyword">const</span> classes = <span class="hljs-title function_">useStyles</span>(theme)

  <span class="hljs-keyword">if</span> (displayString1 &amp;&amp; displayString2) {

    <span class="hljs-keyword">return</span> (
      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Col</span> <span class="hljs-attr">sm</span>=<span class="hljs-string">{12}</span> <span class="hljs-attr">md</span>=<span class="hljs-string">{3}</span> <span class="hljs-attr">lg</span>=<span class="hljs-string">{3}</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{classes.colStyle}</span> <span class="hljs-attr">index</span>=<span class="hljs-string">{index}</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Row</span> <span class="hljs-attr">justify</span>=<span class="hljs-string">&quot;center&quot;</span>&gt;</span>
          {index === 0 ? <span class="hljs-tag">&lt;<span class="hljs-name">HomeIcon</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{classes.iconStyle}</span> /&gt;</span>
            : index === 1 ? <span class="hljs-tag">&lt;<span class="hljs-name">RentIcon</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{classes.iconStyle}</span> /&gt;</span>
              : index === 2 ? <span class="hljs-tag">&lt;<span class="hljs-name">BalanceIcon</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{classes.iconStyle}</span> /&gt;</span>
                : null}
        <span class="hljs-tag">&lt;/<span class="hljs-name">Row</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Row</span> <span class="hljs-attr">justify</span>=<span class="hljs-string">&quot;center&quot;</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Typography</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{classes.subHeading}</span>&gt;</span>
            {displayString1}
          <span class="hljs-tag">&lt;/<span class="hljs-name">Typography</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Row</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Row</span> <span class="hljs-attr">justify</span>=<span class="hljs-string">&quot;center&quot;</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Typography</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{classes.columnText}</span>&gt;</span>
            {displayString2}
          <span class="hljs-tag">&lt;/<span class="hljs-name">Typography</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Row</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Col</span>&gt;</span></span>
    )} <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
  }
}



<span class="hljs-keyword">const</span> <span class="hljs-title function_">Home</span> = (<span class="hljs-params"></span>) =&gt; {

  <span class="hljs-keyword">const</span> theme = <span class="hljs-title function_">useTheme</span>()
  <span class="hljs-keyword">const</span> classes = <span class="hljs-title function_">useStyles</span>(theme)
  <span class="hljs-keyword">const</span> { t, <span class="hljs-attr">ready</span>: translationReady } = <span class="hljs-title function_">useTranslation</span>(
    <span class="hljs-string">&#x27;Home&#x27;</span>, <span class="hljs-comment">/* i18next-parser needs string here */</span>
    { <span class="hljs-attr">useSuspense</span>: <span class="hljs-literal">false</span>, i18n }
  )

  <span class="hljs-keyword">if</span> (!translationReady) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>

  <span class="hljs-keyword">const</span> displayItemText = [
    [<span class="hljs-title function_">t</span>(<span class="hljs-string">&#x27;Should I rent from this landlord?&#x27;</span>), <span class="hljs-title function_">t</span>(<span class="hljs-string">&#x27;Find out about a building and an owner\&#x27;s history&#x27;</span>)],
    [<span class="hljs-title function_">t</span>(<span class="hljs-string">&#x27;Who really owns my building?&#x27;</span>), <span class="hljs-title function_">t</span>(<span class="hljs-string">&#x27;Is it the person you give your check to every month, or a large network of corporations?&#x27;</span>)],
  ]
  
  <span class="hljs-keyword">return</span> (
    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{classes.intro}</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">SearchBar</span> 
            <span class="hljs-attr">location</span>=<span class="hljs-string">&quot;home&quot;</span>
            <span class="hljs-attr">helperText</span>=<span class="hljs-string">{t(</span>&#x27;<span class="hljs-attr">Enter</span> <span class="hljs-attr">an</span> <span class="hljs-attr">address</span>, <span class="hljs-attr">business</span>, <span class="hljs-attr">landlord</span>, <span class="hljs-attr">or</span> <span class="hljs-attr">neighborhood</span> <span class="hljs-attr">view</span> <span class="hljs-attr">to</span> <span class="hljs-attr">see</span> <span class="hljs-attr">the</span> <span class="hljs-attr">connections</span> <span class="hljs-attr">we</span>\&#x27;<span class="hljs-attr">ve</span> <span class="hljs-attr">found</span>&#x27;)} /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{classes.infoStyle}</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Row</span> <span class="hljs-attr">justify</span>=<span class="hljs-string">&quot;space-around&quot;</span> <span class="hljs-attr">align</span>=<span class="hljs-string">&quot;center&quot;</span> <span class="hljs-attr">nowrap</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span>
          {displayItemText.map((e,i) =&gt; 
            <span class="hljs-tag">&lt;<span class="hljs-name">DisplayItem</span> <span class="hljs-attr">displayString1</span>=<span class="hljs-string">{e[0]}</span> <span class="hljs-attr">displayString2</span>=<span class="hljs-string">{e[1]}</span> <span class="hljs-attr">index</span>=<span class="hljs-string">{i}</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{e[0]</span> + <span class="hljs-attr">i</span>} /&gt;</span>
          )}
        <span class="hljs-tag">&lt;/<span class="hljs-name">Row</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span></span>
  )
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">memo</span>(<span class="hljs-title class_">Home</span>)</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrcpagesmethodology.js"><a href="#toc"><a name="ui-src-pages-methodology-js">ui/src/pages/Methodology.js</a></a></h2>
<pre><code>import React, { memo } from <span class="hljs-string">&#x27;react&#x27;</span>
import graph from <span class="hljs-string">&#x27;../images/methodology-graph.png&#x27;</span>
import { useTranslation } from <span class="hljs-string">&#x27;react-i18next&#x27;</span>
import i18n from <span class="hljs-string">&#x27;../i18n&#x27;</span>
import { Row, Col } from <span class="hljs-string">&#x27;../components/Grid&#x27;</span>
import PageTitle from <span class="hljs-string">&#x27;../components/PageTitle&#x27;</span>
import Typography from <span class="hljs-string">&#x27;@material-ui/core/Typography&#x27;</span>
import Accordion from <span class="hljs-string">&#x27;@material-ui/core/Accordion&#x27;</span>
import AccordionSummary from <span class="hljs-string">&#x27;@material-ui/core/AccordionSummary&#x27;</span>
import AccordionDetails from <span class="hljs-string">&#x27;@material-ui/core/AccordionDetails&#x27;</span>
import ExpandMoreIcon from <span class="hljs-string">&#x27;@material-ui/icons/ExpandMore&#x27;</span>
import ListItem from <span class="hljs-string">&#x27;@material-ui/core/ListItem&#x27;</span>
import Table from <span class="hljs-string">&#x27;@material-ui/core/Table&#x27;</span>
import TableBody from <span class="hljs-string">&#x27;@material-ui/core/TableBody&#x27;</span>
import TableCell from <span class="hljs-string">&#x27;@material-ui/core/TableCell&#x27;</span>
import TableContainer from <span class="hljs-string">&#x27;@material-ui/core/TableContainer&#x27;</span>
import TableHead from <span class="hljs-string">&#x27;@material-ui/core/TableHead&#x27;</span>
import TableRow from <span class="hljs-string">&#x27;@material-ui/core/TableRow&#x27;</span>
import Paper from <span class="hljs-string">&#x27;@material-ui/core/Paper&#x27;</span>
import DataPage, { sliceJson } from <span class="hljs-string">&#x27;../components/DataPage/DataPage&#x27;</span>
import { useSelector } from <span class="hljs-string">&#x27;react-redux&#x27;</span>
import { reformatDate } from <span class="hljs-string">&#x27;../utils/stringUtils&#x27;</span>

const Methodology = () =&gt; {

  const evictionSourceData = useSelector(sliceJson(<span class="hljs-string">&#x27;methodology-about-evictions&#x27;</span>))
  const assessorSourceData = useSelector(sliceJson(<span class="hljs-string">&#x27;methodology-about-assessor&#x27;</span>))
  const businessSourceData = useSelector(sliceJson(<span class="hljs-string">&#x27;methodology-about-business&#x27;</span>))

  const { t, ready: translationReady } = useTranslation(
    <span class="hljs-string">&#x27;Methodology&#x27;</span>, /* i18next-parser needs string here */
    { useSuspense: false, i18n }
  )

  if (<span class="hljs-comment">!translationReady) return null

  const dataSources = [
    {
      source: assessorSourceData.source_name,
      description: t(&#x27;A list of parcels, addresses, and current parcel owners&#x27;),
      retrieved: reformatDate(assessorSourceData.date_exported)
    },
    {
      source: businessSourceData.source_name,
      description: t(&#x27;A list of all registered LLC and LP’s and corporations in California, along with their officers, owners, and mailing addresses&#x27;),
      retrieved: reformatDate(businessSourceData.date_exported)
    },
    {
      source: evictionSourceData.source_name,
      description: t(&#x27;Ellis Act eviction data, buyout data, and all eviction notices&#x27;),
      retrieved: reformatDate(evictionSourceData.date_exported)
    },
  ]

  const quirks = [
    {
      title: t(&#x27;Our search feature may not list a property you are interested in.&#x27;),
      info: [
        &#x27;&#x27;, //left intentionally blank for list styling
        t(&#x27;Sometimes the data we use for property information lists a range of addresses for a single property. E.g. if you are looking for 102 Main St and the property in our database is recorded as “100-104 Main St, it may not show up when you search. If you don’t find your property, try searching adjacent properties.&#x27;),
        t(&#x27;Sometimes properties located on corner lots will have units that are listed on several different cross streets. Because the property is only recorded in our database using one of the cross streets, it may be difficult to find on the EvictorBook.&#x27;),
        t(&#x27;Our database contains all properties that are either currently residential properties or ones that have had an eviction recorded at them in the past.&#x27;)
      ]
    },
    {
      title: t(&#x27;Our search feature may not list a business you are interested in.&#x27;),
      info: [ t(&#x27;Our database contains businesses that are highly linked to the properties that they own. Often, to avoid creating connections between unrelated businesses, we have to remove businesses from the corporate networks that are not tightly connected to the network. For example, any company that is a property owner, or an evictor, or listed at the same address as the mailing address for a property, will all be in the database. However, businesses more distantly related might not be in the database. We recommend searching a property to find businesses in the network that are on the EvictorBook.&#x27;) ]
    },
    {
      title: t(&#x27;Looking up the name of a person associated with an eviction and not their business entity.&#x27;),
      info: [ t(&#x27;For now, you can only look up their business entity. For instance, you might know that Yat-Pang Au is the CEO and person associated with Veritas (San Francisco’s biggest landlord), but currently you have to search for Veritas or one of Vertitas’s LLCs and not Yat-Pang Au himself.&#x27;) ]
    },
    {
      title: t(&#x27;The owner percentages on the property pages may not add up to 100%.&#x27;),
      info: [ t(&#x27;Our source data currently only lists one owner for each property, even when it is likely that multiple owners exist.&#x27;) ]
    },
    {
      title: t(&#x27;Some identical evictions are listed on multiple different properties, and some have either no or multiple evictors.&#x27;),
      info: [ t(&#x27;Sometimes there are multiple possible properties that correspond to the address listed on the eviction, and sometimes we find multiple evictors for an eviction record, or none at all. Overall we are able to find evictors for more than 90% of the eviction records.&#x27;) ]
    },
    {
      title: t(&#x27;A business you are looking for may have different information than you were expecting.&#x27;),
      info: [ t(&#x27;Sometimes businesses have multiple records attached to them, if they are filed, cancelled, and then later refiled. We use the information from either the active record, or if there are none, the most recently filed inactive record.&#x27;) ]
    },
    {
      title: t(&#x27;Some evictors and property owners appear to be businesses, but are not linked to a business page, or addresses that are listed separately but look like the same. &#x27;),
      info: [ t(&#x27;All of the records we use are quite messy, often with spelling errors from when the records were manually entered. We attempt to clean up these errors, but sometimes the errors are so strange that we cannot connect the records together.&#x27;) ]
    },
    {
      title: t(&#x27;The evictor assigned to an eviction may be different than you expected.&#x27;),
      info: [ t(&#x27;We determine the evictor for each eviction by searching the property owner at the time of the eviction from sales transfer records. Often this results in the correct owner, but because there are sometimes multiple transactions (e.g. between different trusts) that don’t represent transfers between different people, the evictor might look a bit strange.&#x27;) ]
    },
    {
      title: t(&#x27;A property may be part of multiple possible ownership networks.&#x27;),
      info: [ t(&#x27;Our method to connect properties into ownership networks relies on owner mailing address lookups. Sometimes office buildings will have offices with different real estate companies. While we are able to distinguish between these companies, when we look up properties using a mailing address at those buildings, because of recording differences between our source data, we have to assume that the properties could be part of any of those companies.&#x27;) ]
    },
    {
      title: t(&#x27;The related parcels list may be smaller or longer than you expected.&#x27;),
      info: [ t(&#x27;We are constantly learning more about these corporate ownership networks and improving our connection methods. We attempted to tune our method to be able to reproduce many large, widely known, corporate owner networks. However, because of the way that shell companies, investors, management companies, and even insurance companies, operate, unexpected connections sometimes appear. If you see something unexpected or simply wrong, please let us know!&#x27;) ]
    },
  ]

  const connections = [
    {
      title: t(&#x27;Connecting Properties and Business Entities&#x27;),
      info: [
        t(&#x27;Properties are connected to business entities in one of two ways:&#x27;),
        t(&#x27;The property owner (as obtained from either the County Assessor officer, for current ownership, or sales transfer records, for past ownership) shares the same name as a business entity that is registered with the state, or&#x27;),
        t(&#x27;The property owner’s mailing address is listed at the same or similar address unit as a business entity is.&#x27;)
      ]
    },
    {
      title: t(&#x27;Connecting Properties, Evictions and Evictors&#x27;),
      info: [
        t(&#x27;We connect each eviction to the propertie(s) on which they occurred by matching on the address provided in the eviction record. For evictions that cannot be merged using the address exactly (e.g. for corner lots that use different street names, or for currently non-existent addresses), we grab the longitude and latitude of the address and match it to the closest existing parcel.&#x27;),
        t(&#x27;Since the eviction records do not list the evictor, we then match the eviction to the property owner at the time of eviction from sales transfer records. We consider that property owner the likely evictor.&#x27;),
        t(&#x27;Because we sometimes find multiple address matches or multiple sales matches, we may be unable to connect each eviction to a single property and single evictor with 100% confidence. In these cases, we notify the user that these are not confident links.&#x27;)
      ]
    },
    {
      title: t(&#x27;Determining Connections between Business Entities&#x27;),
      info: [
        t(&#x27;When businesses file with the Secretary of State, they list both addresses, “officers” (partners for LP’s or CEOs for corporations), and owners. These “officers” and owners can either be individuals or other business entities. Thus, we create connections between businesses when:&#x27;),
        t(&#x27;businesses share the same officer or owner, or&#x27;),
        t(&#x27;businesses list one another as an officer or owner.&#x27;),
        t(&#x27;These connections allow us to create “property owner networks.” Each property owner network is a group of interconnected properties, property owners, corporate entities, corporate owners, and evictors. Property owners and evictors could be business entities themselves. Each network is formed by entities that are connected by relationships as defined in the image above.&#x27;)
      ]
    }
  ]

  return (
    &lt;Row justify=&#x27;center&#x27;&gt;
      &lt;Col xs={10} sm={8} md={6}&gt;
        &lt;DataPage fetch={[
          { slice: &#x27;methodology-about-evictions&#x27;, url: &#x27;api/about/eviction&#x27;},
          { slice: &#x27;methodology-about-assessor&#x27;, url: &#x27;api/about/assessor&#x27;},
          { slice: &#x27;methodology-about-business&#x27;, url: &#x27;api/about/business&#x27;},
        ]} isDebugEnabled={false}&gt;
          &lt;PageTitle text={t(&#x27;Methodology&#x27;)} /&gt;
          &lt;Typography variant=&#x27;h2&#x27;&gt;{t(&#x27;Data Sources&#x27;)}&lt;/Typography&gt;
          &lt;Typography variant=&#x27;body1&#x27;&gt;
            {t(&#x27;If you believe any information provided is inaccurate, please contact us through the feedback form and specifically explain the basis of your request for correction or deletion.&#x27;)}
          &lt;/Typography&gt;
          &lt;TableContainer component={Paper} style={{marginTop: 20}}&gt;
            &lt;Table aria-label=&#x27;data sources&#x27; size=&#x27;small&#x27;&gt;
              &lt;TableHead&gt;
                &lt;TableRow&gt;
                  &lt;TableCell align=&#x27;left&#x27;&gt;Source&lt;/TableCell&gt;
                  &lt;TableCell align=&#x27;left&#x27;&gt;Description&lt;/TableCell&gt;
                  &lt;TableCell align=&#x27;left&#x27;&gt;Last Retrieved&lt;/TableCell&gt;
                &lt;/TableRow&gt;
              &lt;/TableHead&gt;
              &lt;TableBody&gt;
                
                {dataSources.map((row) =&gt; (
                  &lt;TableRow key={row.source}&gt;
                    &lt;TableCell align=&#x27;left&#x27;&gt;{row.source}&lt;/TableCell&gt;
                    &lt;TableCell align=&#x27;left&#x27;&gt;{row.description}&lt;/TableCell&gt;
                    &lt;TableCell align=&#x27;left&#x27;&gt;{row.retrieved}&lt;/TableCell&gt;
                  &lt;/TableRow&gt;
                ))}
              &lt;/TableBody&gt;
            &lt;/Table&gt;
          &lt;/TableContainer&gt;
          &lt;Typography variant=&#x27;h2&#x27;&gt;{t(&#x27;Connections&#x27;)}&lt;/Typography&gt;
          &lt;Typography variant=&#x27;body1&#x27;&gt;
            {t(&#x27;We connect the data from the sources above into a graph network that reveals the connections between properties, property owners, evictors, and business entities.&#x27;)}
          &lt;/Typography&gt;
          &amp;nbsp;</span>
          &lt;div style={{ textAlign: <span class="hljs-string">&#x27;center&#x27;</span>, marginBottom: <span class="hljs-number">20</span> }}&gt;
            &lt;img src={graph} alt={t(<span class="hljs-string">&#x27;Graph Diagram&#x27;</span>)}  /&gt;
          &lt;/div&gt;

          {connections.map(connection =&gt;
            &lt;Accordion key={connection.title}&gt;
              &lt;AccordionSummary
                expandIcon={&lt;ExpandMoreIcon /&gt;}
                aria-controls=<span class="hljs-string">&quot;panel2a-content&quot;</span>
                id=<span class="hljs-string">&quot;panel2a-header&quot;</span>
              &gt;
                &lt;Typography variant=<span class="hljs-string">&#x27;body2&#x27;</span>&gt;{connection.title}&lt;/Typography&gt;
              &lt;/AccordionSummary&gt;
              &lt;AccordionDetails style={{display: <span class="hljs-string">&#x27;flex&#x27;</span>, flexDirection: <span class="hljs-string">&#x27;column&#x27;</span>}}&gt;
                {connection.info.map((point, index) =&gt;
                  &lt;ListItem button key={index}&gt;
                    &lt;Typography variant=<span class="hljs-string">&#x27;body2&#x27;</span> key={<span class="hljs-string">&#x27;connections&#x27;</span> + index}&gt;
                      {point}
                    &lt;/Typography&gt;
                  &lt;/ListItem&gt;
                )}
              &lt;/AccordionDetails&gt;
            &lt;/Accordion&gt;
          )}
          &lt;Typography variant=<span class="hljs-string">&#x27;h2&#x27;</span>&gt;{t(<span class="hljs-string">&#x27;Common Issues &amp; Quirks&#x27;</span>)}&lt;/Typography&gt;
          &lt;Typography variant=<span class="hljs-string">&#x27;body1&#x27;</span> style={{marginBottom: <span class="hljs-number">20</span>}}&gt;
            {t(<span class="hljs-string">&#x27;While we do our best to ensure that the data and connections shown on this site are as accurate as possible, and we will continue to improve our methods, there are limitations that you should be aware of. We encourage you, where possible, to verify findings on this site using other data sources as well.&#x27;</span>)}
          &lt;/Typography&gt;

          {quirks.map(quirk =&gt;
            &lt;Accordion key={quirk.title}&gt;
              &lt;AccordionSummary
                expandIcon={&lt;ExpandMoreIcon /&gt;}
                aria-controls=<span class="hljs-string">&quot;panel2a-content&quot;</span>
                id=<span class="hljs-string">&quot;panel2a-header&quot;</span>&gt;
                &lt;Typography variant=<span class="hljs-string">&#x27;body2&#x27;</span>&gt;{quirk.title}&lt;/Typography&gt;
              &lt;/AccordionSummary&gt;
              &lt;AccordionDetails style={{display: <span class="hljs-string">&#x27;flex&#x27;</span>, flexDirection: <span class="hljs-string">&#x27;column&#x27;</span>}}&gt;
                {quirk.info.map((point, index) =&gt;
                  &lt;ListItem button key={index}&gt;
                    &lt;Typography variant=<span class="hljs-string">&#x27;body2&#x27;</span> key={<span class="hljs-string">&#x27;quirks&#x27;</span> + index}&gt;
                      {point}
                    &lt;/Typography&gt;
                  &lt;/ListItem&gt;
                )}
              &lt;/AccordionDetails&gt;
            &lt;/Accordion&gt;
          )}
        &lt;/DataPage&gt;
      &lt;/Col&gt;
    &lt;/Row&gt;
  )
}

export default memo(Methodology)</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrcpagesnetworkpage.js"><a href="#toc"><a name="ui-src-pages-networkpage-js">ui/src/pages/NetworkPage.js</a></a></h2>
<pre><code>import React, {useState, useEffect} from <span class="hljs-string">&#x27;react&#x27;</span>
import { useSelector } from <span class="hljs-string">&#x27;react-redux&#x27;</span>
import { Typography } from <span class="hljs-string">&#x27;@material-ui/core&#x27;</span>
import { useTranslation } from <span class="hljs-string">&#x27;react-i18next&#x27;</span>
import DataPage, { sliceJson, urlParam } from <span class="hljs-string">&#x27;../components/DataPage/DataPage&#x27;</span>
import Data from <span class="hljs-string">&#x27;../components/Data/Data&#x27;</span>
import DataTable from <span class="hljs-string">&#x27;../components/DataTable/DataTable&#x27;</span>
import { Row, Col } from <span class="hljs-string">&#x27;../components/Grid&#x27;</span>
import { commaSeparatedBolded } from <span class="hljs-string">&#x27;../utils/dataUtils&#x27;</span>
import NetworkList from <span class="hljs-string">&#x27;../components/NetworkList&#x27;</span>
import PropertyList from <span class="hljs-string">&#x27;../components/PropertyList&#x27;</span>
import PageTitle from <span class="hljs-string">&#x27;../components/PageTitle&#x27;</span>
import i18n from <span class="hljs-string">&#x27;../i18n&#x27;</span>
import D3Graph from <span class="hljs-string">&#x27;../components/Graph/D3Graph&#x27;</span>
import { renderOwnerLink } from <span class="hljs-string">&#x27;../utils/tableUtils&#x27;</span>
import { reformatDate } from <span class="hljs-string">&#x27;../utils/stringUtils&#x27;</span>

<span class="hljs-comment">/*
  NetworkPage: presents content for an ownership network and its connections
*/</span> 

const NetworkPage = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {

  const networkId = urlParam(<span class="hljs-string">&#x27;id&#x27;</span>)

  const businessSourceData = useSelector(sliceJson(<span class="hljs-string">`<span class="hljs-subst">${networkId}</span>-about-business`</span>))
  const businessSourceText = businessSourceData.source_name +
    <span class="hljs-string">&#x27; (as of &#x27;</span> + reformatDate(businessSourceData.date_exported) + <span class="hljs-string">&#x27;)&#x27;</span>
  const assessorSourceData = useSelector(sliceJson(<span class="hljs-string">`<span class="hljs-subst">${networkId}</span>-about-assessor`</span>))
  const assessorSourceText = assessorSourceData.source_name +
    <span class="hljs-string">&#x27; (as of &#x27;</span> + reformatDate(assessorSourceData.date_exported) + <span class="hljs-string">&#x27;)&#x27;</span>
 
  const { t, <span class="hljs-attr">ready</span>: translationReady } = useTranslation(
    <span class="hljs-string">&#x27;Network&#x27;</span>, <span class="hljs-comment">/* i18next-parser needs string here */</span>
    { <span class="hljs-attr">useSuspense</span>: <span class="hljs-literal">false</span>, i18n }
  )


  const details = useSelector(sliceJson(<span class="hljs-string">`<span class="hljs-subst">${networkId}</span>-details`</span>))

  const [shouldGetGraph, setShouldGetGraph] = useState(<span class="hljs-literal">false</span>)
  useEffect(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
    <span class="hljs-keyword">if</span>(details.total_bes &lt; <span class="hljs-number">500</span>) setShouldGetGraph(<span class="hljs-literal">true</span>)
  }, [details])
  const graph = useSelector(sliceJson(<span class="hljs-string">`<span class="hljs-subst">${networkId}</span>-graph`</span>))

  <span class="hljs-keyword">if</span> (!translationReady) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>

  const NetworkDetails = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {

    const networkNodes = useSelector(sliceJson(<span class="hljs-string">`<span class="hljs-subst">${networkId}</span>-nodes`</span>))

    const nodeTableData = Object.assign([], networkNodes?.map(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> ({
      <span class="hljs-attr">name</span>: x.name,
      <span class="hljs-attr">type</span>: x.type,
      <span class="hljs-attr">type_readable</span>: x.type_readable
    })))

    <span class="hljs-keyword">return</span> (
      &lt;&gt;
        &lt;Typography variant=<span class="hljs-string">&#x27;h2&#x27;</span>&gt;
          {t(<span class="hljs-string">&#x27;Businesses, People, and Addresses in this Ownership Network&#x27;</span>)}
        &lt;/Typography&gt;
        &lt;Typography variant=<span class="hljs-string">&#x27;body1&#x27;</span>&gt;
          {t(<span class="hljs-string">&#x27;In total, there are {{numBusinesses}} businesses, {{numOwners}} business owners and {{numAddresses}} business or property owner addresses in this ownership network.&#x27;</span>, {
            <span class="hljs-attr">numBusinesses</span>: details.total_bes,
            <span class="hljs-attr">numOwners</span>: details.total_owners,
            <span class="hljs-attr">numAddresses</span>: details.total_addrs
          })}
        &lt;/Typography&gt;
        &lt;DataTable
          rows={nodeTableData}
          columns = {[
            { <span class="hljs-attr">field</span>: <span class="hljs-string">&#x27;name&#x27;</span>, <span class="hljs-attr">headerName</span>: <span class="hljs-string">&#x27;Name&#x27;</span>, <span class="hljs-attr">flex</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">renderCell</span>: <span class="hljs-function"><span class="hljs-params">p</span> =&gt;</span>
              renderOwnerLink(p.row.name, p.row.type)
            },
            { <span class="hljs-attr">field</span>: <span class="hljs-string">&#x27;type_readable&#x27;</span>, <span class="hljs-attr">headerName</span>: <span class="hljs-string">&#x27;Type&#x27;</span>, <span class="hljs-attr">flex</span>: <span class="hljs-number">1.5</span>},
          ]}
          title={t(<span class="hljs-string">&#x27;Ownership Network&#x27;</span>)}
          isDebugEnabled={<span class="hljs-literal">false</span>}
          aboutData={{
            <span class="hljs-attr">source</span>: businessSourceText,
            <span class="hljs-attr">href</span>: <span class="hljs-string">&#x27;/methodology&#x27;</span>,
            <span class="hljs-attr">notes</span>: t(<span class="hljs-string">&#x27;Due to inexact name matches, some businesses may be listed as business owners&#x27;</span>)
          }}
          noDataMessage={t(<span class="hljs-string">&#x27;Ownership network data not found&#x27;</span>)}
          sortModel={[
            { <span class="hljs-attr">field</span>: <span class="hljs-string">&#x27;entity&#x27;</span>, <span class="hljs-attr">sort</span>: <span class="hljs-string">&#x27;asc&#x27;</span> },
            { <span class="hljs-attr">field</span>: <span class="hljs-string">&#x27;type&#x27;</span>, <span class="hljs-attr">sort</span>: <span class="hljs-string">&#x27;asc&#x27;</span> }
          ]}
          paginationPageSize={<span class="hljs-number">10</span>}
          csvFileName={t(<span class="hljs-string">&#x27;Businesses, People, and Addresses in this Ownership Network with ID {{networkId}}&#x27;</span>,
            { <span class="hljs-attr">networkId</span>: networkId })}
        /&gt;
      &lt;/&gt;
    )

  }

  const PropertyPortfolio = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
    <span class="hljs-keyword">return</span> (
      &lt;&gt;
        &lt;PropertyList
          portfolioSlice={<span class="hljs-string">`<span class="hljs-subst">${networkId}</span>-portfolio`</span>}
          title={t(<span class="hljs-string">&#x27;Property Portfolio&#x27;</span>)}
          subTitle={
            &lt;&gt;
              {t(<span class="hljs-string">&#x27;We have determined that the following buildings may be owned by this ownership network.&#x27;</span>)}
            &lt;/&gt;
          }
          noDataMessage={t(<span class="hljs-string">&#x27;No portfolio properties found for this parcel.&#x27;</span>)}
          aboutData={{
            <span class="hljs-attr">source</span>: assessorSourceText,
            <span class="hljs-attr">href</span>: <span class="hljs-string">&#x27;/methodology&#x27;</span>,
            <span class="hljs-attr">notes</span>: ( 
              t(<span class="hljs-string">&#x27;Property portfolios are created by identifying properties with the&#x27;</span>) +
              t(<span class="hljs-string">&#x27;same mailing address(es). We associate properties with business ownership &#x27;</span>) +
              t(<span class="hljs-string">&#x27;networks through either the name listed as the property owner (if it is a &#x27;</span>) +
              t(<span class="hljs-string">&#x27;business) and through the property mailing addresses that are also business &#x27;</span>) +
              t(<span class="hljs-string">&#x27;office addresses. Some business networks have multiple addresses. In counting &#x27;</span>) +
              t(<span class="hljs-string">&#x27;the number of evictions for a property, Ellis Act evictions are counted as &#x27;</span>) +
              t(<span class="hljs-string">&#x27;separate evictions for each unit.&#x27;</span>)
            )
          }}
          paginationPageSize={<span class="hljs-number">5</span>}
          csvFileName={t(<span class="hljs-string">&#x27;Properties for Ownership Network with ID {{networkId}}&#x27;</span>,
            { <span class="hljs-attr">networkId</span>: networkId })}
        /&gt;
      &lt;/&gt;
    )
  }

  <span class="hljs-keyword">return</span> (
    &lt;Row&gt;
      &lt;Col xs={<span class="hljs-number">12</span>}&gt;
        &lt;DataPage fetch={[
          { <span class="hljs-attr">slice</span>: <span class="hljs-string">`<span class="hljs-subst">${networkId}</span>-details`</span>, <span class="hljs-attr">url</span>: <span class="hljs-string">`api/network/<span class="hljs-subst">${networkId}</span>/details`</span>},
          { <span class="hljs-attr">slice</span>: <span class="hljs-string">`<span class="hljs-subst">${networkId}</span>-portfolio`</span>, <span class="hljs-attr">url</span>: <span class="hljs-string">`api/network/<span class="hljs-subst">${networkId}</span>/portfolio`</span>},
          { <span class="hljs-attr">slice</span>: <span class="hljs-string">`<span class="hljs-subst">${networkId}</span>-network`</span>, <span class="hljs-attr">url</span>: <span class="hljs-string">`api/network/<span class="hljs-subst">${networkId}</span>/relatedNetworks`</span>},
          { <span class="hljs-attr">slice</span>: <span class="hljs-string">`<span class="hljs-subst">${networkId}</span>-nodes`</span>, <span class="hljs-attr">url</span>: <span class="hljs-string">`api/network/<span class="hljs-subst">${networkId}</span>/nodes`</span>,
            <span class="hljs-attr">select</span>: <span class="hljs-function"><span class="hljs-params">j</span> =&gt;</span> j.nodes},
          { <span class="hljs-attr">slice</span>: <span class="hljs-string">`<span class="hljs-subst">${networkId}</span>-about-assessor`</span>, <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;api/about/assessor&#x27;</span>},
          { <span class="hljs-attr">slice</span>: <span class="hljs-string">`<span class="hljs-subst">${networkId}</span>-about-business`</span>, <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;api/about/business&#x27;</span>}
        ]} isDebugEnabled={<span class="hljs-literal">false</span>}&gt;
          &lt;Row justify=<span class="hljs-string">&#x27;center&#x27;</span>&gt;
            &lt;Col xs={<span class="hljs-number">10</span>} sm={<span class="hljs-number">8</span>}&gt;
              &lt;PageTitle text={t(<span class="hljs-string">&#x27;Ownership Network&#x27;</span>)} /&gt;
              &lt;Typography variant=<span class="hljs-string">&#x27;body1&#x27;</span>&gt;
                {t(<span class="hljs-string">&#x27;Containing&#x27;</span>)}{<span class="hljs-string">&#x27; &#x27;</span>}
                {commaSeparatedBolded([
                  details.top_owner,
                  details.top_be?.name_norm,
                  details.top_addr
                ])}{<span class="hljs-string">&#x27;.&#x27;</span>}
              &lt;/Typography&gt;
              &lt;Typography variant=<span class="hljs-string">&#x27;h2&#x27;</span>&gt;{t(<span class="hljs-string">&#x27;Network Connections&#x27;</span>)}&lt;/Typography&gt;
              { <span class="hljs-comment">// conditionally render the graph and show an alternative message if it&#x27;s not rendered</span>
                <span class="hljs-comment">//    using a second &lt;Data /&gt; component here to avoid loading the things in &lt;DataPage /&gt; twice</span>
                shouldGetGraph ?
                  &lt;&gt;
                    &lt;Data fetch={[{ <span class="hljs-attr">slice</span>: <span class="hljs-string">`<span class="hljs-subst">${networkId}</span>-graph`</span>, <span class="hljs-attr">url</span>: <span class="hljs-string">`api/network/<span class="hljs-subst">${networkId}</span>/graph`</span>}]}/&gt;
                    &lt;Typography variant=<span class="hljs-string">&#x27;body1&#x27;</span>&gt;
                      {t(<span class="hljs-string">&#x27;Below is the full set of network connections within this ownership network.&#x27;</span>) }
                    &lt;/Typography&gt;
                    &lt;br/&gt;
                    &lt;D3Graph graph={graph} /&gt; 
                  &lt;/&gt; :
                  &lt;Typography variant=<span class="hljs-string">&#x27;body1&#x27;</span>&gt;
                    {t(<span class="hljs-string">&#x27;Large ownership networks are currently unable to be shown.&#x27;</span>)}
                  &lt;/Typography&gt;
              }
              &lt;NetworkDetails/&gt;
              &lt;PropertyPortfolio /&gt;
              &lt;NetworkList
                slice={<span class="hljs-string">`<span class="hljs-subst">${networkId}</span>-network`</span>}
                noDataMessage={t(<span class="hljs-string">&#x27;No related networks found.&#x27;</span>)}
              /&gt;
            &lt;/Col&gt;
          &lt;/Row&gt;
        &lt;/DataPage&gt;
      &lt;/Col&gt;
    &lt;/Row&gt;
  )

}

export default NetworkPage</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrcpagesownerpage.js"><a href="#toc"><a name="ui-src-pages-ownerpage-js">ui/src/pages/OwnerPage.js</a></a></h2>
<pre><code><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useState, useMemo } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>
<span class="hljs-keyword">import</span> { useSelector } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-redux&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Typography</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core&#x27;</span>
<span class="hljs-keyword">import</span> { useTranslation } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-i18next&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">InfoBox</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../components/DataMap/Overlays/InfoBox&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">PageTitle</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../components/PageTitle&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">DataPage</span>, { isNull, isEmpty, sliceJson, urlParam }
  <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../components/DataPage/DataPage&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">DataMap</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../components/DataMap/DataMap&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Overlay</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../components/DataMap/Overlays/Overlay&#x27;</span>
<span class="hljs-keyword">import</span> { reformatDate, titleCase } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../utils/stringUtils&#x27;</span>
<span class="hljs-keyword">import</span> { commaSeparatedText } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../utils/dataUtils&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ReactComponent</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">RelatedParcelIcon</span> }
  <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../components/DataMap/Map/map_icons/related-parcel-icon.svg&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ReactComponent</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">EvictionIcon</span> }
  <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../components/DataMap/Map/map_icons/directly-evicted-icon.svg&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Row</span>, <span class="hljs-title class_">Col</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../components/Grid&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">NetworkList</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../components/NetworkList&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">EvictionList</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../components/EvictionList&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">PropertyList</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../components/PropertyList&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Legend</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../components/DataMap/Overlays/Legend&#x27;</span>
<span class="hljs-keyword">import</span> i18n <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../i18n&#x27;</span>
<span class="hljs-keyword">import</span> { beStatusIndefiniteArticle } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../utils/dataUtils&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">OwnershipNetwork</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../components/OwnershipNetwork&#x27;</span>

<span class="hljs-comment">/*
  OwnerPage: presents content for a property owner
*/</span> 

<span class="hljs-keyword">const</span> <span class="hljs-title function_">Owner</span> = (<span class="hljs-params"></span>) =&gt; {

  <span class="hljs-keyword">const</span> search = <span class="hljs-title function_">urlParam</span>(<span class="hljs-string">&#x27;search&#x27;</span>)
  <span class="hljs-keyword">const</span> beType = <span class="hljs-title function_">urlParam</span>(<span class="hljs-string">&#x27;be&#x27;</span>) <span class="hljs-comment">// either &#x27;lp&#x27; or &#x27;corp&#x27;</span>
  <span class="hljs-keyword">const</span> evictionSourceData = <span class="hljs-title function_">useSelector</span>(<span class="hljs-title function_">sliceJson</span>(<span class="hljs-string">`<span class="hljs-subst">${search}</span>-about-evictions`</span>))
  <span class="hljs-keyword">const</span> evictionSourceText = evictionSourceData.<span class="hljs-property">source_name</span> +
    <span class="hljs-string">&#x27; (as of &#x27;</span> + <span class="hljs-title function_">reformatDate</span>(evictionSourceData.<span class="hljs-property">date_exported</span>) + <span class="hljs-string">&#x27;)&#x27;</span>
  <span class="hljs-keyword">const</span> assessorSourceData = <span class="hljs-title function_">useSelector</span>(<span class="hljs-title function_">sliceJson</span>(<span class="hljs-string">`<span class="hljs-subst">${search}</span>-about-assessor`</span>))
  <span class="hljs-keyword">const</span> assessorSourceText = assessorSourceData.<span class="hljs-property">source_name</span> +
    <span class="hljs-string">&#x27; (as of &#x27;</span> + <span class="hljs-title function_">reformatDate</span>(assessorSourceData.<span class="hljs-property">date_exported</span>) + <span class="hljs-string">&#x27;)&#x27;</span>

  <span class="hljs-keyword">const</span> { t, <span class="hljs-attr">ready</span>: translationReady } = <span class="hljs-title function_">useTranslation</span>(
    <span class="hljs-string">&#x27;Owner&#x27;</span>, <span class="hljs-comment">/* i18next-parser needs string here */</span>
    { <span class="hljs-attr">useSuspense</span>: <span class="hljs-literal">false</span>, i18n }
  )
  
  <span class="hljs-keyword">if</span> (!translationReady) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">OwnerMap</span> = (<span class="hljs-params"></span>) =&gt; {
    
    <span class="hljs-keyword">const</span> details = <span class="hljs-title function_">useSelector</span>(<span class="hljs-title function_">sliceJson</span>(<span class="hljs-string">`<span class="hljs-subst">${search}</span>-details`</span>))
    <span class="hljs-keyword">const</span> evictions = <span class="hljs-title function_">useSelector</span>(<span class="hljs-title function_">sliceJson</span>(<span class="hljs-string">`<span class="hljs-subst">${search}</span>-evictions`</span>))
    <span class="hljs-keyword">const</span> portfolio = <span class="hljs-title function_">useSelector</span>(<span class="hljs-title function_">sliceJson</span>(<span class="hljs-string">`<span class="hljs-subst">${search}</span>-portfolio`</span>))

    <span class="hljs-comment">/* setting the initial value for selectedParcel as the owner makes the infobox display the owner information on load */</span> 
    <span class="hljs-keyword">const</span> [selectedParcel, setSelectedParcel] = <span class="hljs-title function_">useState</span>(details)

    <span class="hljs-comment">/* Map data includes evictions by the same owner as well as properties 
       owned by the same owner. The type property is used by downstream
       code to set the icon. */</span>
    <span class="hljs-keyword">const</span> mapData = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">const</span> evictionList = <span class="hljs-title function_">isEmpty</span>(evictions)
        ? [] : evictions.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> !<span class="hljs-title function_">isNull</span>(x.<span class="hljs-property">location</span>.<span class="hljs-property">lat</span>))
      <span class="hljs-keyword">const</span> propertyList = <span class="hljs-title function_">isEmpty</span>(portfolio)
        ? [] : portfolio.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> !<span class="hljs-title function_">isNull</span>(x.<span class="hljs-property">lat</span>))
      <span class="hljs-keyword">const</span> ownerProperty = {...details, <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;Parcel&#x27;</span>}
      <span class="hljs-keyword">let</span> data = [...evictionList, ...propertyList]
      <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">isNull</span>(ownerProperty.<span class="hljs-property">lat</span>)) data = data.<span class="hljs-title function_">concat</span>(ownerProperty)
      <span class="hljs-keyword">return</span> data
    }
    <span class="hljs-comment">// eslint-disable-next-line</span>
    , [evictions])
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isEmpty</span>(mapData)) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>

    <span class="hljs-keyword">return</span> (
      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">DataMap</span> <span class="hljs-attr">markers</span>=<span class="hljs-string">{mapData}</span> <span class="hljs-attr">isDebugEnabled</span>=<span class="hljs-string">{false}</span>
        <span class="hljs-attr">overlays</span>=<span class="hljs-string">{[</span>
          &lt;<span class="hljs-attr">Overlay</span> <span class="hljs-attr">position</span>=<span class="hljs-string">&#x27;bottomright&#x27;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Legend</span>
              <span class="hljs-attr">title</span>=<span class="hljs-string">{t(</span>&#x27;<span class="hljs-attr">Legend</span>&#x27;)}
              <span class="hljs-attr">items</span>=<span class="hljs-string">{[</span>
                { <span class="hljs-attr">icon:</span> &lt;<span class="hljs-attr">EvictionIcon</span>/&gt;</span>, label: t(&#x27;Eviction&#x27;) },
                { icon: <span class="hljs-tag">&lt;<span class="hljs-name">RelatedParcelIcon</span>/&gt;</span>, label: t(&#x27;Property&#x27;) }
              ]}
            /&gt;
          <span class="hljs-tag">&lt;/<span class="hljs-name">Overlay</span>&gt;</span>,
          <span class="hljs-tag">&lt;<span class="hljs-name">Overlay</span> <span class="hljs-attr">position</span>=<span class="hljs-string">&#x27;topleft&#x27;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">InfoBox</span>
              <span class="hljs-attr">selectedMarker</span>=<span class="hljs-string">{selectedParcel}</span>
              <span class="hljs-attr">directions</span>=<span class="hljs-string">{t(</span>&#x27;<span class="hljs-attr">Click</span> <span class="hljs-attr">an</span> <span class="hljs-attr">eviction</span> <span class="hljs-attr">or</span> <span class="hljs-attr">property</span> <span class="hljs-attr">on</span> <span class="hljs-attr">the</span> <span class="hljs-attr">map</span> <span class="hljs-attr">for</span> <span class="hljs-attr">details</span>&#x27;)
              }
            /&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">Overlay</span>&gt;</span>
        ]}
        onSelect={marker =&gt; setSelectedParcel(marker)}
        renderMarkerHover={marker =&gt; 
          <span class="hljs-tag">&lt;<span class="hljs-name">Typography</span> <span class="hljs-attr">variant</span>=<span class="hljs-string">&#x27;body1&#x27;</span>&gt;</span>{titleCase(marker.addr)}<span class="hljs-tag">&lt;/<span class="hljs-name">Typography</span>&gt;</span>
        }
      /&gt;</span>
    )
  }

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">OwnerDetails</span> = (<span class="hljs-params"></span>) =&gt; {

    <span class="hljs-keyword">const</span> details = <span class="hljs-title function_">useSelector</span>(<span class="hljs-title function_">sliceJson</span>(<span class="hljs-string">`<span class="hljs-subst">${search}</span>-details`</span>))
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isNull</span>(details)) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
    <span class="hljs-keyword">const</span> addresses = details.<span class="hljs-property">office_addresses</span>
    <span class="hljs-keyword">const</span> status = details.<span class="hljs-property">status</span>
    <span class="hljs-keyword">const</span> jurisdiction = details.<span class="hljs-property">be_specific_details</span>?.<span class="hljs-property">jurisdiction</span>
    <span class="hljs-keyword">const</span> name = <span class="hljs-title function_">titleCase</span>(details.<span class="hljs-property">name</span>)
    <span class="hljs-keyword">const</span> date = <span class="hljs-title function_">reformatDate</span>(details.<span class="hljs-property">creation_date</span>)

    <span class="hljs-keyword">return</span> (
      <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Typography</span> <span class="hljs-attr">variant</span>=<span class="hljs-string">&#x27;h2&#x27;</span>&gt;</span>{t(&#x27;About the Business&#x27;)}
        <span class="hljs-tag">&lt;/<span class="hljs-name">Typography</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Typography</span> <span class="hljs-attr">variant</span>=<span class="hljs-string">&#x27;body1&#x27;</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>{name}<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span>
          {
            beType === &#x27;lp&#x27;
              ? t(&#x27; is {{article}} {{status}} Limited Partnership, first registered {{date}} in {{jurisdiction}}, located at {{addresses}}.&#x27;, {
                article: beStatusIndefiniteArticle(status),
                status: status,
                date: date,
                jurisdiction: jurisdiction,
                addresses: commaSeparatedText(addresses) ||
                  &#x27;an address not in our records&#x27;
              })
              : t(&#x27; is {{article}} {{status}} corporation first registered {{date}}, located at {{addresses}}.&#x27;, {
                article: beStatusIndefiniteArticle(status),
                status: status,
                date: date,
                addresses: commaSeparatedText(addresses) ||
                  &#x27;an address not in our records&#x27;
              })
          }
        <span class="hljs-tag">&lt;/<span class="hljs-name">Typography</span>&gt;</span> 
      <span class="hljs-tag">&lt;/&gt;</span></span>
    )
  }

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">PropertySection</span> = (<span class="hljs-params"></span>) =&gt; {

    <span class="hljs-keyword">const</span> details = <span class="hljs-title function_">useSelector</span>(<span class="hljs-title function_">sliceJson</span>(<span class="hljs-string">`<span class="hljs-subst">${search}</span>-details`</span>))
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isNull</span>(details)) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
    <span class="hljs-keyword">const</span> name = <span class="hljs-title function_">titleCase</span>(details.<span class="hljs-property">name</span>)

    <span class="hljs-keyword">return</span> (
      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">PropertyList</span>
        <span class="hljs-attr">portfolioSlice</span>=<span class="hljs-string">{</span>`${<span class="hljs-attr">search</span>}<span class="hljs-attr">-portfolio</span>`}
        <span class="hljs-attr">title</span>=<span class="hljs-string">{t(</span>&#x27;<span class="hljs-attr">Property</span> <span class="hljs-attr">Portfolio</span>&#x27;)}
        <span class="hljs-attr">subTitle</span>=<span class="hljs-string">{</span>
          &lt;&gt;</span>
            {t(&#x27;The following buildings may be part of the same ownership network as &#x27;)}
            <span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>{name}<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span>{&#x27;.&#x27;}
          <span class="hljs-tag">&lt;/&gt;</span></span>
        }
        noDataMessage={<span class="hljs-title function_">t</span>(<span class="hljs-string">&#x27;No portfolio properties found for this parcel.&#x27;</span>)}
        aboutData={{
          <span class="hljs-attr">source</span>: assessorSourceText,
          <span class="hljs-attr">href</span>: <span class="hljs-string">&#x27;/methodology&#x27;</span>,
          <span class="hljs-attr">notes</span>: ( 
            <span class="hljs-title function_">t</span>(<span class="hljs-string">&#x27;Property portfolios are created by identifying properties with the&#x27;</span>) +
            <span class="hljs-title function_">t</span>(<span class="hljs-string">&#x27;same mailing address(es). We associate properties with business ownership &#x27;</span>) +
            <span class="hljs-title function_">t</span>(<span class="hljs-string">&#x27;networks through either the name listed as the property owner (if it is a &#x27;</span>) +
            <span class="hljs-title function_">t</span>(<span class="hljs-string">&#x27;business) and through the property mailing addresses that are also business &#x27;</span>) +
            <span class="hljs-title function_">t</span>(<span class="hljs-string">&#x27;office addresses. Some business networks have multiple addresses. In counting &#x27;</span>) +
            <span class="hljs-title function_">t</span>(<span class="hljs-string">&#x27;the number of evictions for a property, Ellis Act evictions are counted as &#x27;</span>) +
            <span class="hljs-title function_">t</span>(<span class="hljs-string">&#x27;separate evictions for each unit.&#x27;</span>)
          )
        }}
        paginationPageSize={<span class="hljs-number">5</span>}
        csvFileName={<span class="hljs-title function_">t</span>(<span class="hljs-string">&#x27;Properties in the portfolio of Owner {{owner}}&#x27;</span>,
          { <span class="hljs-attr">owner</span>: search })}
      /&gt;
    )
  
  }

  <span class="hljs-keyword">return</span> (
    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Row</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Col</span> <span class="hljs-attr">xs</span>=<span class="hljs-string">{12}</span>&gt;</span>
          {/* The API should flatten the roots for details -&gt; parcel_details and owners -&gt; owners */}
          <span class="hljs-tag">&lt;<span class="hljs-name">DataPage</span> <span class="hljs-attr">fetch</span>=<span class="hljs-string">{[</span>
            { <span class="hljs-attr">slice:</span> `${<span class="hljs-attr">search</span>}<span class="hljs-attr">-details</span>`, <span class="hljs-attr">url:</span> `<span class="hljs-attr">api</span>/<span class="hljs-attr">owner</span>/${<span class="hljs-attr">beType</span>}/${<span class="hljs-attr">search</span>}/<span class="hljs-attr">details</span>` },
            { <span class="hljs-attr">slice:</span> `${<span class="hljs-attr">search</span>}<span class="hljs-attr">-evictions</span>`, <span class="hljs-attr">url:</span> `<span class="hljs-attr">api</span>/<span class="hljs-attr">owner</span>/${<span class="hljs-attr">beType</span>}/${<span class="hljs-attr">search</span>}/<span class="hljs-attr">evictions</span>`},
            { <span class="hljs-attr">slice:</span> `${<span class="hljs-attr">search</span>}<span class="hljs-attr">-network-details</span>`, <span class="hljs-attr">url:</span> `<span class="hljs-attr">api</span>/<span class="hljs-attr">owner</span>/${<span class="hljs-attr">beType</span>}/${<span class="hljs-attr">search</span>}/<span class="hljs-attr">networkDetails</span>`},
            { <span class="hljs-attr">slice:</span> `${<span class="hljs-attr">search</span>}<span class="hljs-attr">-network</span>`, <span class="hljs-attr">url:</span> `<span class="hljs-attr">api</span>/<span class="hljs-attr">owner</span>/${<span class="hljs-attr">beType</span>}/${<span class="hljs-attr">search</span>}/<span class="hljs-attr">relatedNetworks</span>`},
            { <span class="hljs-attr">slice:</span> `${<span class="hljs-attr">search</span>}<span class="hljs-attr">-portfolio</span>`, <span class="hljs-attr">url:</span> `<span class="hljs-attr">api</span>/<span class="hljs-attr">owner</span>/${<span class="hljs-attr">beType</span>}/${<span class="hljs-attr">search</span>}/<span class="hljs-attr">portfolio</span>`,
              <span class="hljs-attr">select:</span> <span class="hljs-attr">j</span> =&gt;</span> j.property_portfolio },
            { slice: `${search}-about-evictions`, url: &#x27;api/about/eviction&#x27;},
            { slice: `${search}-about-assessor`, url: &#x27;api/about/assessor&#x27;},
          ]} isDebugEnabled={false}&gt;
            <span class="hljs-tag">&lt;<span class="hljs-name">OwnerMap</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Row</span> <span class="hljs-attr">justify</span>=<span class="hljs-string">&#x27;center&#x27;</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">Col</span> <span class="hljs-attr">xs</span>=<span class="hljs-string">{10}</span> <span class="hljs-attr">sm</span>=<span class="hljs-string">{8}</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">PageTitle</span> <span class="hljs-attr">text</span>=<span class="hljs-string">{t(</span>&#x27;<span class="hljs-attr">Owner</span> <span class="hljs-attr">Details</span> <span class="hljs-attr">for</span> &#x27;) + <span class="hljs-attr">titleCase</span>(<span class="hljs-attr">search</span>)}/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">OwnerDetails</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">OwnershipNetwork</span> <span class="hljs-attr">urlParam</span>=<span class="hljs-string">{search}/</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">EvictionList</span>
                  <span class="hljs-attr">evictionSlice</span>=<span class="hljs-string">{</span>`${<span class="hljs-attr">search</span>}<span class="hljs-attr">-evictions</span>`}
                  <span class="hljs-attr">title</span>=<span class="hljs-string">{t(</span>&#x27;<span class="hljs-attr">Eviction</span> <span class="hljs-attr">History</span> <span class="hljs-attr">for</span> <span class="hljs-attr">this</span> <span class="hljs-attr">Ownership</span> <span class="hljs-attr">Network</span>&#x27;)}
                  <span class="hljs-attr">subTitle</span>=<span class="hljs-string">{</span>
                    <span class="hljs-attr">t</span>(&#x27;<span class="hljs-attr">The</span> <span class="hljs-attr">following</span> <span class="hljs-attr">evictions</span> <span class="hljs-attr">were</span> <span class="hljs-attr">conducted</span> <span class="hljs-attr">by</span> <span class="hljs-attr">businesses</span> <span class="hljs-attr">in</span> <span class="hljs-attr">the</span> <span class="hljs-attr">ownership</span> <span class="hljs-attr">network.</span> &#x27;) +
                    <span class="hljs-attr">t</span>(&#x27;<span class="hljs-attr">Namely</span>, <span class="hljs-attr">a</span> <span class="hljs-attr">business</span> <span class="hljs-attr">in</span> <span class="hljs-attr">the</span> <span class="hljs-attr">network</span> <span class="hljs-attr">was</span> <span class="hljs-attr">the</span> <span class="hljs-attr">property</span> <span class="hljs-attr">owner</span> <span class="hljs-attr">at</span> <span class="hljs-attr">the</span> <span class="hljs-attr">time</span> <span class="hljs-attr">of</span> <span class="hljs-attr">the</span> <span class="hljs-attr">eviction.</span> &#x27;) +
                    <span class="hljs-attr">t</span>(&#x27;<span class="hljs-attr">This</span> <span class="hljs-attr">may</span> <span class="hljs-attr">include</span> <span class="hljs-attr">properties</span> <span class="hljs-attr">that</span> <span class="hljs-attr">are</span> <span class="hljs-attr">no</span> <span class="hljs-attr">longer</span> <span class="hljs-attr">owned</span> <span class="hljs-attr">by</span> <span class="hljs-attr">this</span> <span class="hljs-attr">network.</span>&#x27;)
                  }
                  <span class="hljs-attr">noDataMessage</span>=<span class="hljs-string">{t(</span>&#x27;<span class="hljs-attr">No</span> <span class="hljs-attr">evictions</span> <span class="hljs-attr">recorded</span> <span class="hljs-attr">for</span> <span class="hljs-attr">this</span> <span class="hljs-attr">business.</span>&#x27;)}
                  <span class="hljs-attr">aboutData</span>=<span class="hljs-string">{{</span>
                    <span class="hljs-attr">source:</span> <span class="hljs-attr">evictionSourceText</span>,
                    <span class="hljs-attr">href:</span> &#x27;/<span class="hljs-attr">methodology</span>&#x27;,
                    <span class="hljs-attr">notes:</span>  ( 
                      <span class="hljs-attr">t</span>(&#x27;<span class="hljs-attr">Eviction</span> <span class="hljs-attr">records</span> <span class="hljs-attr">generally</span> <span class="hljs-attr">only</span> <span class="hljs-attr">include</span> <span class="hljs-attr">the</span> <span class="hljs-attr">address</span> <span class="hljs-attr">of</span> <span class="hljs-attr">the</span> <span class="hljs-attr">eviction.</span> &#x27;) +
                      <span class="hljs-attr">t</span>(&#x27;<span class="hljs-attr">Evictions</span> <span class="hljs-attr">were</span> <span class="hljs-attr">matched</span> <span class="hljs-attr">to</span> <span class="hljs-attr">parcel</span> <span class="hljs-attr">records</span> <span class="hljs-attr">and</span> <span class="hljs-attr">property</span> <span class="hljs-attr">ownership</span> <span class="hljs-attr">records.</span> &#x27;) +
                      <span class="hljs-attr">t</span>(&#x27;<span class="hljs-attr">As</span> <span class="hljs-attr">a</span> <span class="hljs-attr">result</span>, <span class="hljs-attr">some</span> <span class="hljs-attr">evictions</span> <span class="hljs-attr">were</span> <span class="hljs-attr">matched</span> <span class="hljs-attr">to</span> <span class="hljs-attr">multiple</span> <span class="hljs-attr">or</span> <span class="hljs-attr">no</span> <span class="hljs-attr">properties</span>, <span class="hljs-attr">if</span> <span class="hljs-attr">an</span> <span class="hljs-attr">exact</span> &#x27;) +
                      <span class="hljs-attr">t</span>(&#x27;<span class="hljs-attr">match</span> <span class="hljs-attr">could</span> <span class="hljs-attr">not</span> <span class="hljs-attr">be</span> <span class="hljs-attr">found.</span> <span class="hljs-attr">Some</span> <span class="hljs-attr">evictions</span> <span class="hljs-attr">also</span> <span class="hljs-attr">include</span> <span class="hljs-attr">names</span> <span class="hljs-attr">on</span> <span class="hljs-attr">the</span> <span class="hljs-attr">filing</span>, &#x27;) +
                      <span class="hljs-attr">t</span>(&#x27;<span class="hljs-attr">which</span> <span class="hljs-attr">may</span> <span class="hljs-attr">be</span> <span class="hljs-attr">either</span> <span class="hljs-attr">property</span> <span class="hljs-attr">owners</span> <span class="hljs-attr">or</span> <span class="hljs-attr">lawyers</span> <span class="hljs-attr">involved</span> <span class="hljs-attr">in</span> <span class="hljs-attr">the</span> <span class="hljs-attr">case.</span> <span class="hljs-attr">For</span> <span class="hljs-attr">these</span>, &#x27;) +
                      <span class="hljs-attr">t</span>(&#x27;<span class="hljs-attr">we</span> <span class="hljs-attr">have</span> <span class="hljs-attr">shown</span> <span class="hljs-attr">the</span> <span class="hljs-attr">name</span> <span class="hljs-attr">identified</span> <span class="hljs-attr">through</span> <span class="hljs-attr">property</span> <span class="hljs-attr">records</span>, <span class="hljs-attr">and</span> <span class="hljs-attr">the</span> <span class="hljs-attr">additional</span> &#x27;) +
                      <span class="hljs-attr">t</span>(&#x27;<span class="hljs-attr">names</span> <span class="hljs-attr">are</span> <span class="hljs-attr">those</span> <span class="hljs-attr">found</span> <span class="hljs-attr">on</span> <span class="hljs-attr">the</span> <span class="hljs-attr">eviction</span> <span class="hljs-attr">filing</span> <span class="hljs-attr">itself.</span>&#x27;)
                    )
                  }}
                  <span class="hljs-attr">paginationPageSize</span>=<span class="hljs-string">{5}</span>
                  <span class="hljs-attr">csvFileName</span>=<span class="hljs-string">{t(</span>&#x27;<span class="hljs-attr">Known</span> <span class="hljs-attr">evictions</span> <span class="hljs-attr">for</span> <span class="hljs-attr">Owner</span> {{<span class="hljs-attr">owner</span>}}&#x27;,
                    {<span class="hljs-attr">owner:</span> <span class="hljs-attr">search</span>})}
                /&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">PropertySection</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">NetworkList</span>
                  <span class="hljs-attr">slice</span>=<span class="hljs-string">{</span>`${<span class="hljs-attr">search</span>}<span class="hljs-attr">-network</span>`}
                  <span class="hljs-attr">noDataMessage</span>=<span class="hljs-string">{t(</span>&#x27;<span class="hljs-attr">No</span> <span class="hljs-attr">related</span> <span class="hljs-attr">networks</span> <span class="hljs-attr">found.</span>&#x27;)}
                /&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-name">Col</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">Row</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">DataPage</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Col</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Row</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )

}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">Owner</span></pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrcpagesparcelpage.js"><a href="#toc"><a name="ui-src-pages-parcelpage-js">ui/src/pages/ParcelPage.js</a></a></h2>
<pre><code>import React, { useState, useMemo } from <span class="hljs-string">&#x27;react&#x27;</span>
import { useSelector } from <span class="hljs-string">&#x27;react-redux&#x27;</span>
import { Typography } from <span class="hljs-string">&#x27;@material-ui/core&#x27;</span>
import DataPage, { isNull, isEmpty, sliceJson, urlParam }
  from <span class="hljs-string">&#x27;../components/DataPage/DataPage&#x27;</span>
import DataMap from <span class="hljs-string">&#x27;../components/DataMap/DataMap&#x27;</span>
import { InfoBox } from <span class="hljs-string">&#x27;../components/DataMap/Overlays/InfoBox&#x27;</span>
import { Row, Col } from <span class="hljs-string">&#x27;../components/Grid&#x27;</span>
import { formatPropertyClass, getClassByCode } from <span class="hljs-string">&#x27;../utils/propertyClass&#x27;</span>
import { reformatDate, titleCase } from <span class="hljs-string">&#x27;../utils/stringUtils&#x27;</span>
import { ReactComponent as SearchedForIcon }
  from <span class="hljs-string">&#x27;../components/DataMap/Map/map_icons/searched-for-icon.svg&#x27;</span>
import { ReactComponent as RelatedParcelIcon }
  from <span class="hljs-string">&#x27;../components/DataMap/Map/map_icons/related-parcel-icon.svg&#x27;</span>
import Overlay from <span class="hljs-string">&#x27;../components/DataMap/Overlays/Overlay&#x27;</span>
import NetworkList from <span class="hljs-string">&#x27;../components/NetworkList&#x27;</span>
import EvictionList from <span class="hljs-string">&#x27;../components/EvictionList&#x27;</span>
import PageTitle from <span class="hljs-string">&#x27;../components/PageTitle&#x27;</span>
import PropertyList from <span class="hljs-string">&#x27;../components/PropertyList&#x27;</span>
import Legend from <span class="hljs-string">&#x27;../components/DataMap/Overlays/Legend&#x27;</span>
import { useTranslation } from <span class="hljs-string">&#x27;react-i18next&#x27;</span>
import i18n from <span class="hljs-string">&#x27;../i18n&#x27;</span>
import Link from <span class="hljs-string">&#x27;@material-ui/core/Link&#x27;</span>
import { renderOwnerLink } from <span class="hljs-string">&#x27;../utils/tableUtils&#x27;</span>
import OwnershipNetwork from <span class="hljs-string">&#x27;../components/OwnershipNetwork&#x27;</span>

<span class="hljs-comment">/*
  ParcelPage: presents content for a property parcel
*/</span>

const Parcel = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {

  const bl = urlParam(<span class="hljs-string">&#x27;bl&#x27;</span>)
  const evictionSourceData = useSelector(sliceJson(<span class="hljs-string">`<span class="hljs-subst">${bl}</span>-about-evictions`</span>))
  const evictionSourceText = evictionSourceData.source_name +
    <span class="hljs-string">&#x27; (as of &#x27;</span> + reformatDate(evictionSourceData.date_exported) + <span class="hljs-string">&#x27;)&#x27;</span>
  const assessorSourceData = useSelector(sliceJson(<span class="hljs-string">`<span class="hljs-subst">${bl}</span>-about-assessor`</span>))
  const assessorSourceText = assessorSourceData.source_name +
    <span class="hljs-string">&#x27; (as of &#x27;</span> + reformatDate(assessorSourceData.date_exported) + <span class="hljs-string">&#x27;)&#x27;</span>

  const { t, <span class="hljs-attr">ready</span>: translationReady } = useTranslation(
    <span class="hljs-string">&#x27;Parcel&#x27;</span>, <span class="hljs-comment">/* i18next-parser needs string here */</span>
    { <span class="hljs-attr">useSuspense</span>: <span class="hljs-literal">false</span>, i18n }
  )

  const ParcelMap = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {

    const details = useSelector(sliceJson(<span class="hljs-string">`<span class="hljs-subst">${bl}</span>-details`</span>))
    const portfolio = useSelector(sliceJson(<span class="hljs-string">`<span class="hljs-subst">${bl}</span>-portfolio`</span>))
    <span class="hljs-comment">/* Map data includes portfolio properties as related parcels 
       and the page&#x27;s details parcel as the searched-for parcel.
       It adds a type property for downstream code to choose the icon */</span>
    const mapData = useMemo(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
      const propertyList = isEmpty(portfolio)
        ? [] : portfolio
          .filter(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> !isNull(x.lat))
          .map(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> ({...x, <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;Related Parcel&#x27;</span>}))
      const ownerProperty = {
        ...details,
        <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;Parcel&#x27;</span>, <span class="hljs-attr">addr</span>: details.addr_details?.main_addr
      }
      let data = [...propertyList]
      <span class="hljs-keyword">if</span> (!isNull(ownerProperty.lat)) data = data.concat(ownerProperty)
      <span class="hljs-keyword">return</span> data
    }
    <span class="hljs-comment">// eslint-disable-next-line</span>
    , [portfolio, details])
    <span class="hljs-comment">/* setting the initial value for selectedParcel as the main parcel makes the infobox display the main parcel information on load */</span> 
    const [selectedParcel, setSelectedParcel] = useState(mapData.slice(<span class="hljs-number">-1</span>).pop())

    <span class="hljs-keyword">if</span> (isEmpty(mapData)) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>

    <span class="hljs-keyword">return</span> (
      &lt;DataMap markers={mapData} isDebugEnabled={<span class="hljs-literal">false</span>}
        overlays={[
          &lt;Overlay position=<span class="hljs-string">&#x27;bottomright&#x27;</span>&gt;
            &lt;Legend
              title={t(<span class="hljs-string">&#x27;Legend&#x27;</span>)}
              items={[
                { <span class="hljs-attr">icon</span>: &lt;SearchedForIcon/&gt;, <span class="hljs-attr">label</span>: t(<span class="hljs-string">&#x27;This Property&#x27;</span>) },
                { <span class="hljs-attr">icon</span>: &lt;RelatedParcelIcon/&gt;, <span class="hljs-attr">label</span>: t(<span class="hljs-string">&#x27;Related Properties&#x27;</span>) }
              ]}
            /&gt;
          &lt;/Overlay&gt;,
          &lt;Overlay position=<span class="hljs-string">&#x27;topleft&#x27;</span>&gt;
            &lt;InfoBox
              selectedMarker={selectedParcel}
              directions={t(<span class="hljs-string">&#x27;Click a property on the map for details&#x27;</span>)}
            /&gt;
          &lt;/Overlay&gt;
        ]}
        onSelect={marker =&gt; setSelectedParcel(marker)}
        renderMarkerHover={marker =&gt; 
          &lt;Typography variant=<span class="hljs-string">&#x27;body1&#x27;</span>&gt;{titleCase(marker.addr)}&lt;/Typography&gt;
        }
      /&gt;
    )
  }

  const PropertyDetails = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {

    const details = useSelector(sliceJson(<span class="hljs-string">`<span class="hljs-subst">${bl}</span>-details`</span>))
    const owners = useSelector(sliceJson(<span class="hljs-string">`<span class="hljs-subst">${bl}</span>-owners`</span>))
    const ownerList = owners?.owners
    <span class="hljs-keyword">if</span> (isNull(details) || isNull(owners)) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
    const propertyType = formatPropertyClass(getClassByCode(details.prop_class_code))
    const address = titleCase(details.addr_details.main_addr)
    const yearBuilt = details.yr_built
    const numUnits = details.units
    const rentControlCode = details.rent_controlled
    const firstOwnerName = ownerList[<span class="hljs-number">0</span>]?.owner_name ?? <span class="hljs-string">&#x27;&#x27;</span>

    let addrVariations = details.addr_details.addr_variations.map(<span class="hljs-function"><span class="hljs-params">d</span> =&gt;</span> titleCase(d))
    let extraVariations = details.addr_details.num_extra_addr_variations

    switch(extraVariations){
      case <span class="hljs-number">0</span>: <span class="hljs-keyword">break</span>
      case <span class="hljs-number">1</span>: 
        addrVariations.push(<span class="hljs-string">&#x27;1 other variation&#x27;</span>) 
        <span class="hljs-keyword">break</span>
      default: addrVariations.push(<span class="hljs-string">`<span class="hljs-subst">${extraVariations}</span> other variations`</span>)
    }
    const addrText = addrVariations.reduce(<span class="hljs-function">(<span class="hljs-params">string, d,i</span>) =&gt;</span> {
      const comma = (i &lt; addrVariations.length - <span class="hljs-number">1</span> &amp;&amp; addrVariations.length !== <span class="hljs-number">2</span>)
        ? <span class="hljs-string">&#x27;, &#x27;</span> : <span class="hljs-string">&#x27;&#x27;</span>
      const and = i === addrVariations.length - <span class="hljs-number">2</span> ? <span class="hljs-string">&#x27; and &#x27;</span> : <span class="hljs-string">&#x27;&#x27;</span>
      <span class="hljs-keyword">return</span> string + d + comma + and
    }, <span class="hljs-string">&#x27;&#x27;</span>)

    <span class="hljs-keyword">return</span> (
      &lt;&gt;
        &lt;Typography variant=<span class="hljs-string">&#x27;h2&#x27;</span>&gt;{t(<span class="hljs-string">&#x27;About the property&#x27;</span>)}&lt;/Typography&gt;
        &lt;Typography variant=<span class="hljs-string">&#x27;body1&#x27;</span>&gt;
          &lt;strong&gt;{address}&lt;/strong&gt;
          {
            t(<span class="hljs-string">&#x27; is a {{propertyType}} built in {{year}}. &#x27;</span>, {
              <span class="hljs-attr">propertyType</span>: propertyType
                .replace(<span class="hljs-string">&#x27;(tic &#x27;</span>, <span class="hljs-string">&#x27;(TIC &#x27;</span>) <span class="hljs-comment">/* Until this is fixed in the data */</span>
                .replace(<span class="hljs-string">&#x27; )&#x27;</span>, <span class="hljs-string">&#x27;)&#x27;</span>), <span class="hljs-comment">/* Until this is fixed in the data */</span>
              year: String(yearBuilt)
            })
          }
          {
            typeof numUnits === <span class="hljs-string">&#x27;number&#x27;</span> &amp;&amp;
              t(<span class="hljs-string">&#x27;It has {{count}} units. &#x27;</span>, {
                <span class="hljs-attr">count</span>: numUnits,
                <span class="hljs-attr">context</span>: (numUnits === <span class="hljs-number">0</span>)
                  ? <span class="hljs-string">&#x27;zero&#x27;</span> <span class="hljs-comment">/* Add a translation for zero with suffix _zero */</span>
                  : <span class="hljs-string">&#x27;&#x27;</span> 
              })
          }
          {
            firstOwnerName &amp;&amp;
              &lt;&gt;
                {t(<span class="hljs-string">&#x27;It is currently owned by &#x27;</span>)}
                &lt;strong&gt;{titleCase(firstOwnerName)}&lt;/strong&gt;{<span class="hljs-string">&#x27;. &#x27;</span> }
              &lt;/&gt;
          }
          {
            { <span class="hljs-string">&#x27;2&#x27;</span>: t(<span class="hljs-string">&#x27;Since it was built before 1979, it is likely rent controlled.&#x27;</span>),
              <span class="hljs-string">&#x27;1&#x27;</span>: t(<span class="hljs-string">&#x27;It is not likely rent controlled.&#x27;</span>),
              <span class="hljs-string">&#x27;0&#x27;</span>: t(<span class="hljs-string">&#x27;No rent control data is available.&#x27;</span>)
            }[rentControlCode]
          }
        &lt;/Typography&gt; 
        { addrVariations.length &gt; <span class="hljs-number">0</span> &amp;&amp; 
          &lt;&gt;
            &lt;br/&gt;
            &lt;Typography variant = <span class="hljs-string">&quot;body1&quot;</span>&gt;
              {t(<span class="hljs-string">&#x27;This property is also listed under {{addrText}}.&#x27;</span>, {
                <span class="hljs-attr">addrText</span>: addrText
              })}
            &lt;/Typography&gt;
          &lt;/&gt;
        }
      &lt;/&gt;
    )

  }

  const EvictionSection = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {

    const details = useSelector(sliceJson(<span class="hljs-string">`<span class="hljs-subst">${bl}</span>-details`</span>))
    const evictions = useSelector(sliceJson(<span class="hljs-string">`<span class="hljs-subst">${bl}</span>-evictions`</span>))
    const numUnits = details.units
    const address = titleCase(details.addr_details.main_addr)
    const yearBuilt = details.yr_built

    const numEllisEvictions = evictions.filter(<span class="hljs-function"><span class="hljs-params">eviction</span> =&gt;</span>
      eviction.type === <span class="hljs-string">&#x27;Ellis Act Withdrawal&#x27;</span>).length
    const numOtherEvictions = evictions.length - numEllisEvictions

    <span class="hljs-keyword">return</span> (
      &lt;EvictionList
        evictionSlice={<span class="hljs-string">`<span class="hljs-subst">${bl}</span>-evictions`</span>}
        title={t(<span class="hljs-string">&#x27;Eviction History at this Property&#x27;</span>)}
        subTitle={
          &lt;&gt;
            &lt;strong&gt;{address}&lt;/strong&gt;
            {
              t(<span class="hljs-string">&#x27; has {{count}} units and we have records of &#x27;</span>, {
                <span class="hljs-attr">count</span>: numUnits,
                <span class="hljs-attr">context</span>: (typeof numUnits !== <span class="hljs-string">&#x27;number&#x27;</span> || numUnits === <span class="hljs-number">0</span>)
                  ? <span class="hljs-string">&#x27;zero&#x27;</span> <span class="hljs-comment">/* Add a translation for zero with suffix _zero */</span>
                  : <span class="hljs-string">&#x27;&#x27;</span> 
              })
            }
            {
              numEllisEvictions &gt; <span class="hljs-number">0</span> &amp;&amp;
                t(<span class="hljs-string">&#x27;{{count}} Ellis Act {{evictionText}}{{endLink}}&#x27;</span>, {
                  <span class="hljs-attr">count</span>: numEllisEvictions,
                  <span class="hljs-attr">evictionText</span>: numEllisEvictions &gt; <span class="hljs-number">1</span> ? <span class="hljs-string">&#x27;evictions&#x27;</span> : <span class="hljs-string">&#x27;eviction&#x27;</span>,
                  <span class="hljs-attr">endLink</span>: numOtherEvictions === <span class="hljs-number">0</span> &amp;&amp; !numUnits ? t(<span class="hljs-string">&#x27;. &#x27;</span>) : <span class="hljs-string">&#x27;&#x27;</span>
                })
            }
            {
              numEllisEvictions &gt; <span class="hljs-number">0</span> &amp;&amp; numUnits &gt; <span class="hljs-number">0</span> &amp;&amp;
                t(<span class="hljs-string">&#x27;{{startLink}} affecting the {{units}} units{{endLink}}&#x27;</span>, {
                  <span class="hljs-attr">startLink</span>: numEllisEvictions &gt; <span class="hljs-number">1</span> ? <span class="hljs-string">&#x27;, each&#x27;</span> : <span class="hljs-string">&#x27;,&#x27;</span>,
                  <span class="hljs-attr">units</span>: numUnits,
                  <span class="hljs-attr">endLink</span>: numOtherEvictions &gt; <span class="hljs-number">0</span> ? <span class="hljs-string">&#x27;&#x27;</span> : t(<span class="hljs-string">&#x27;. &#x27;</span>)
                })
            }
            { numOtherEvictions &gt; <span class="hljs-number">0</span> &amp;&amp;
              t(<span class="hljs-string">&#x27;{{startLink}}{{count}} {{otherText}}{{evictionText}}&#x27;</span>, {
                <span class="hljs-attr">startLink</span>: numEllisEvictions &gt; <span class="hljs-number">0</span> ? t(<span class="hljs-string">&#x27; and &#x27;</span>) : <span class="hljs-string">&#x27;&#x27;</span>,
                <span class="hljs-attr">count</span>: numOtherEvictions,
                <span class="hljs-attr">otherText</span>: numEllisEvictions &gt; <span class="hljs-number">0</span> ? t(<span class="hljs-string">&#x27;other &#x27;</span>) : <span class="hljs-string">&#x27;&#x27;</span>,
                <span class="hljs-attr">evictionText</span>: numOtherEvictions &gt; <span class="hljs-number">1</span> ? t(<span class="hljs-string">&#x27;evictions. &#x27;</span>) : t(<span class="hljs-string">&#x27;eviction. &#x27;</span>),
                <span class="hljs-attr">context</span>: (typeof numUnits !== <span class="hljs-string">&#x27;number&#x27;</span> || numUnits === <span class="hljs-number">0</span>)
                  ? <span class="hljs-string">&#x27;zero&#x27;</span> <span class="hljs-comment">/* Add a translation for zero with suffix _zero */</span>
                  : <span class="hljs-string">&#x27;&#x27;</span> 
              })
            } 
            {
              typeof yearBuilt === <span class="hljs-string">&#x27;number&#x27;</span>
                ? t(<span class="hljs-string">&#x27;It was built in {{yearBuilt}}.&#x27;</span>, { <span class="hljs-attr">yearBuilt</span>: yearBuilt })
                : <span class="hljs-string">&#x27;&#x27;</span>
            }
          &lt;/&gt;
        }
        noDataMessage={t(<span class="hljs-string">&#x27;No evictions recorded for this address.&#x27;</span>)}
        aboutData={{
          <span class="hljs-attr">source</span>: evictionSourceText,
          <span class="hljs-attr">href</span>: <span class="hljs-string">&#x27;/methodology&#x27;</span>,
          <span class="hljs-attr">notes</span>:  ( 
            t(<span class="hljs-string">&#x27;Eviction records generally only include the address of the eviction. &#x27;</span>) +
            t(<span class="hljs-string">&#x27;Evictions were matched to parcel records and property ownership records. &#x27;</span>) +
            t(<span class="hljs-string">&#x27;As a result, some evictions were matched to multiple or no properties, if an exact &#x27;</span>) +
            t(<span class="hljs-string">&#x27;match could not be found. Some evictions also include names on the filing, &#x27;</span>) +
            t(<span class="hljs-string">&#x27;which may be either property owners or lawyers involved in the case. For these, &#x27;</span>) +
            t(<span class="hljs-string">&#x27;we have shown the name identified through property records, and the additional &#x27;</span>) +
            t(<span class="hljs-string">&#x27;names are those found on the eviction filing itself.&#x27;</span>)
          )
        }}
        paginationPageSize={<span class="hljs-number">5</span>}
        csvFileName={t(<span class="hljs-string">&#x27;Eviction history for address {{address}}&#x27;</span>,
          {<span class="hljs-attr">address</span>: address})}
      /&gt;
    )
 
  }

  const OwnerDetails = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
    
    const owners = useSelector(sliceJson(<span class="hljs-string">`<span class="hljs-subst">${bl}</span>-owners`</span>))
    <span class="hljs-keyword">if</span> (isEmpty(owners)) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
    const ownerList = owners?.owners
    const firstOwnerName = ownerList[<span class="hljs-number">0</span>]?.owner_name ?? <span class="hljs-string">&#x27;&#x27;</span>
    const firstOwnerBusinessType = ownerList[<span class="hljs-number">0</span>]?.linked_be?.__typename ?? <span class="hljs-string">&#x27;&#x27;</span>
    const firstOwnerAddress = ownerList[<span class="hljs-number">0</span>]?.mailing_address ?? <span class="hljs-string">&#x27;&#x27;</span>
    const subdivided = owners?.subdivided
    const multiple_owners = owners?.multiple_owners

    <span class="hljs-keyword">return</span> (
      &lt;&gt;
        &lt;Typography variant=<span class="hljs-string">&#x27;h2&#x27;</span>&gt;{t(<span class="hljs-string">&#x27;Owner&#x27;</span>)}&lt;/Typography&gt;
        &lt;Typography variant=<span class="hljs-string">&#x27;body1&#x27;</span>&gt;
          &lt;strong&gt;
            {renderOwnerLink(firstOwnerName, firstOwnerBusinessType)}
          &lt;/strong&gt;
        &amp;nbsp;{t(<span class="hljs-string">&#x27;is a registered owner located at&#x27;</span>)}
        &amp;nbsp;{titleCase(firstOwnerAddress)}{<span class="hljs-string">&#x27;.&#x27;</span>}
        &lt;/Typography&gt;
        &lt;br/&gt;
        &lt;Typography variant=<span class="hljs-string">&#x27;body1&#x27;</span>&gt;
          &lt;&gt;
            {subdivided ?
              t(<span class="hljs-string">&#x27;Records suggest that this property resulted from a subdivision, meaning &#x27;</span> +
                <span class="hljs-string">&#x27;that a parcel was split up into multiple parcels. There may be other parcels at the same location. &#x27;</span>)
              : <span class="hljs-string">&#x27;&#x27;</span>}
            {subdivided ? &lt;&gt;&lt;br/&gt;&lt;br/&gt;&lt;/&gt; : <span class="hljs-string">&#x27;&#x27;</span>}
            {multiple_owners ? 
              t(<span class="hljs-string">&#x27;There appear to be additional owners for this property. &#x27;</span>) : 
              t(<span class="hljs-string">&#x27;There may be additional owners for this property. &#x27;</span>)}
            {t(<span class="hljs-string">&#x27;To verify, please check out the &#x27;</span>)}
            &lt;Link
              href=<span class="hljs-string">&#x27;https://recorder.sfgov.org&#x27;</span>
              style={{<span class="hljs-attr">cursor</span>: <span class="hljs-string">&#x27;pointer&#x27;</span>, <span class="hljs-attr">textDecoration</span>: <span class="hljs-string">&#x27;underline&#x27;</span>}}
              variant=<span class="hljs-string">&#x27;body1&#x27;</span>&gt;
              {t(<span class="hljs-string">&#x27;SF Recorder\&#x27;s Office&#x27;</span>)}
            &lt;/Link&gt;
            {t(<span class="hljs-string">&#x27;, where you can search this address to see the full list of owners.&#x27;</span>)}
          &lt;/&gt;
        &lt;/Typography&gt;
      &lt;/&gt;
    )

  }

  const PropertySection = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {

    const details = useSelector(sliceJson(<span class="hljs-string">`<span class="hljs-subst">${bl}</span>-details`</span>))
    const address = titleCase(details.addr_details.main_addr)

    <span class="hljs-keyword">return</span> (
      &lt;PropertyList
        portfolioSlice={<span class="hljs-string">`<span class="hljs-subst">${bl}</span>-portfolio`</span>}
        title={t(<span class="hljs-string">&#x27;Property Portfolio&#x27;</span>)}
        subTitle={
          &lt;&gt;
            {t(<span class="hljs-string">&#x27;The following buildings may be part of the same ownership network as &#x27;</span>)}
            &lt;strong&gt;{address}&lt;/strong&gt;{<span class="hljs-string">&#x27;.&#x27;</span>}
          &lt;/&gt;
        }
        noDataMessage={t(<span class="hljs-string">&#x27;No portfolio properties found for this parcel.&#x27;</span>)}
        aboutData={{
          <span class="hljs-attr">source</span>: assessorSourceText,
          <span class="hljs-attr">href</span>: <span class="hljs-string">&#x27;/methodology&#x27;</span>,
          <span class="hljs-attr">notes</span>: ( 
            t(<span class="hljs-string">&#x27;Property portfolios are created by identifying properties with the&#x27;</span>) +
            t(<span class="hljs-string">&#x27;same mailing address(es). We associate properties with business ownership &#x27;</span>) +
            t(<span class="hljs-string">&#x27;networks through either the name listed as the property owner (if it is a &#x27;</span>) +
            t(<span class="hljs-string">&#x27;business) and through the property mailing addresses that are also business &#x27;</span>) +
            t(<span class="hljs-string">&#x27;office addresses. Some business networks have multiple addresses. In counting &#x27;</span>) +
            t(<span class="hljs-string">&#x27;the number of evictions for a property, Ellis Act evictions are counted as &#x27;</span>) +
            t(<span class="hljs-string">&#x27;separate evictions for each unit.&#x27;</span>)
          )
        }}
        paginationPageSize={<span class="hljs-number">5</span>}
        csvFileName={t(<span class="hljs-string">&#x27;Properties in the same ownership network as {{property}}&#x27;</span>,
          { <span class="hljs-attr">property</span>: address })}
      /&gt;
    )
  
  }

  <span class="hljs-keyword">if</span> (!translationReady) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>

  <span class="hljs-keyword">return</span> (
    &lt;div&gt;
      &lt;Row&gt;
        &lt;Col xs={<span class="hljs-number">12</span>}&gt;
          {<span class="hljs-comment">/* The API should flatten the roots for details -&gt; parcel_details and owners -&gt; owners */</span>}
          &lt;DataPage fetch={[
            { <span class="hljs-attr">slice</span>: <span class="hljs-string">`<span class="hljs-subst">${bl}</span>-details`</span>,
              <span class="hljs-attr">url</span>: <span class="hljs-string">`api/parcel/<span class="hljs-subst">${bl}</span>/details`</span>, <span class="hljs-attr">select</span>: <span class="hljs-function"><span class="hljs-params">j</span> =&gt;</span> j.parcel_details },
            { <span class="hljs-attr">slice</span>: <span class="hljs-string">`<span class="hljs-subst">${bl}</span>-owners`</span>, <span class="hljs-attr">url</span>: <span class="hljs-string">`api/parcel/<span class="hljs-subst">${bl}</span>/owners`</span>},
            { <span class="hljs-attr">slice</span>: <span class="hljs-string">`<span class="hljs-subst">${bl}</span>-evictions`</span>, <span class="hljs-attr">url</span>: <span class="hljs-string">`api/parcel/<span class="hljs-subst">${bl}</span>/evictions`</span>},
            { <span class="hljs-attr">slice</span>: <span class="hljs-string">`<span class="hljs-subst">${bl}</span>-network-details`</span>, <span class="hljs-attr">url</span>: <span class="hljs-string">`api/parcel/<span class="hljs-subst">${bl}</span>/networkDetails`</span>},
            { <span class="hljs-attr">slice</span>: <span class="hljs-string">`<span class="hljs-subst">${bl}</span>-network`</span>, <span class="hljs-attr">url</span>: <span class="hljs-string">`api/parcel/<span class="hljs-subst">${bl}</span>/relatedNetworks`</span>},
            { <span class="hljs-attr">slice</span>: <span class="hljs-string">`<span class="hljs-subst">${bl}</span>-portfolio`</span>, <span class="hljs-attr">url</span>: <span class="hljs-string">`api/parcel/<span class="hljs-subst">${bl}</span>/portfolio`</span>},
            { <span class="hljs-attr">slice</span>: <span class="hljs-string">`<span class="hljs-subst">${bl}</span>-about-evictions`</span>, <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;api/about/eviction&#x27;</span>},
            { <span class="hljs-attr">slice</span>: <span class="hljs-string">`<span class="hljs-subst">${bl}</span>-about-assessor`</span>, <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;api/about/assessor&#x27;</span>},
          ]} isDebugEnabled={<span class="hljs-literal">false</span>}&gt;
            &lt;ParcelMap/&gt;
            &lt;Row justify=<span class="hljs-string">&#x27;center&#x27;</span>&gt;
              &lt;Col xs={<span class="hljs-number">10</span>} sm={<span class="hljs-number">8</span>}&gt;
                &lt;PageTitle
                  slice={<span class="hljs-string">`<span class="hljs-subst">${bl}</span>-details`</span>}
                  text={t(<span class="hljs-string">&#x27;Parcel Details for &#x27;</span>)}
                  appendTextSelector={j =&gt; titleCase(j.addr_details?.main_addr)}
                /&gt;
                &lt;PropertyDetails/&gt;
                &lt;OwnerDetails/&gt;
                &lt;OwnershipNetwork urlParam={bl}/&gt;
                &lt;EvictionSection/&gt;
                &lt;PropertySection/&gt;
                &lt;NetworkList
                  slice={<span class="hljs-string">`<span class="hljs-subst">${bl}</span>-network`</span>}
                  noDataMessage={t(<span class="hljs-string">&#x27;No related networks found.&#x27;</span>)}
                /&gt;
              &lt;/Col&gt;
            &lt;/Row&gt;
          &lt;/DataPage&gt;
        &lt;/Col&gt;
      &lt;/Row&gt;
    &lt;/div&gt;
  )

}

export default Parcel</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrcpagessearchresultspage.js"><a href="#toc"><a name="ui-src-pages-searchresultspage-js">ui/src/pages/SearchResultsPage.js</a></a></h2>
<pre><code><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>
<span class="hljs-keyword">import</span> { useSelector } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-redux&#x27;</span>
<span class="hljs-keyword">import</span>  <span class="hljs-title class_">Typography</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/Typography&#x27;</span>
<span class="hljs-keyword">import</span>  <span class="hljs-title class_">Card</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/Card&#x27;</span>
<span class="hljs-keyword">import</span>  <span class="hljs-title class_">CardHeader</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/CardHeader&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Avatar</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/Avatar&#x27;</span>
<span class="hljs-keyword">import</span>  <span class="hljs-title class_">Box</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/Box&#x27;</span>
<span class="hljs-keyword">import</span>  <span class="hljs-title class_">CircularProgress</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/CircularProgress&#x27;</span>
<span class="hljs-keyword">import</span>  <span class="hljs-title class_">Link</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/Link&#x27;</span>
<span class="hljs-keyword">import</span>  { useTheme } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/styles&#x27;</span>
<span class="hljs-keyword">import</span> useStyles <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../theme/SearchResultsStyles&#x27;</span>
<span class="hljs-keyword">import</span> { urlParam } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../components/DataPage/DataPage&#x27;</span>
<span class="hljs-keyword">import</span> { searchSelector } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../state/slices/searchStateSlice&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Row</span>, <span class="hljs-title class_">Col</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../components/Grid&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Link</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">RouterLink</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-router-dom&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">BusinessIcon</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/icons/Business&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">HomeIcon</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/icons/Home&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">RoomOutlinedIcon</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/icons/RoomOutlined&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">DataTable</span> <span class="hljs-keyword">from</span>  <span class="hljs-string">&#x27;../components/DataTable/DataTable&#x27;</span>
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> config <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../config/config.json&#x27;</span>
<span class="hljs-keyword">import</span> { useTranslation } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-i18next&#x27;</span>
<span class="hljs-keyword">import</span> i18n <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../i18n&#x27;</span>

<span class="hljs-comment">/*
  SearchResultsPage: presents results for a given search term
*/</span>

<span class="hljs-keyword">const</span> categories  = config.<span class="hljs-property">categories</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">RenderConditionalAvatar</span> = (<span class="hljs-params">category</span>) =&gt; {
  
  <span class="hljs-keyword">const</span> theme = <span class="hljs-title function_">useTheme</span>()
  <span class="hljs-keyword">const</span> classes = <span class="hljs-title function_">useStyles</span>(theme)

  <span class="hljs-keyword">return</span> (
    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Avatar</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{classes.avatar}</span>&gt;</span>
      {
        { &#x27;2&#x27;: <span class="hljs-tag">&lt;<span class="hljs-name">BusinessIcon</span> <span class="hljs-attr">color</span>=<span class="hljs-string">&quot;secondary&quot;</span> /&gt;</span>,
          &#x27;1&#x27;: <span class="hljs-tag">&lt;<span class="hljs-name">RoomOutlinedIcon</span> <span class="hljs-attr">color</span>=<span class="hljs-string">&quot;secondary&quot;</span> /&gt;</span>,
          &#x27;0&#x27;: <span class="hljs-tag">&lt;<span class="hljs-name">HomeIcon</span> <span class="hljs-attr">color</span>=<span class="hljs-string">&quot;secondary&quot;</span> /&gt;</span>
        }[categories[category]]
      }
    <span class="hljs-tag">&lt;/<span class="hljs-name">Avatar</span>&gt;</span></span>
  )
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">ResultCard</span> = (<span class="hljs-params">{ label, category, categoryReadable, url }</span>) =&gt; {

  <span class="hljs-keyword">const</span> theme = <span class="hljs-title function_">useTheme</span>()
  <span class="hljs-keyword">const</span> classes = <span class="hljs-title function_">useStyles</span>(theme)

  <span class="hljs-keyword">return</span> (
    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Link</span>
      <span class="hljs-attr">to</span>=<span class="hljs-string">{url}</span>
      <span class="hljs-attr">className</span>=<span class="hljs-string">{classes.title}</span>
      <span class="hljs-attr">component</span>=<span class="hljs-string">{RouterLink}</span>
      <span class="hljs-attr">underline</span>=<span class="hljs-string">&#x27;hover&#x27;</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Card</span> <span class="hljs-attr">elevation</span>=<span class="hljs-string">{1}</span> 
        <span class="hljs-attr">className</span>=<span class="hljs-string">{classes.card}</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">CardHeader</span>
          <span class="hljs-attr">avatar</span>=<span class="hljs-string">{RenderConditionalAvatar(category)}</span>
          <span class="hljs-attr">title</span>=<span class="hljs-string">{label}</span>
          <span class="hljs-attr">subheader</span>=<span class="hljs-string">{</span>
            &lt;<span class="hljs-attr">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{textDecoration:</span> &#x27;<span class="hljs-attr">none</span>&#x27;}}&gt;</span>{categoryReadable}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
          }
        /&gt;
      <span class="hljs-tag">&lt;/<span class="hljs-name">Card</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span></span>
  )

}


<span class="hljs-keyword">const</span> <span class="hljs-title function_">SearchResults</span> = (<span class="hljs-params"></span>) =&gt; {

  <span class="hljs-keyword">const</span> theme = <span class="hljs-title function_">useTheme</span>()
  <span class="hljs-keyword">const</span> classes = <span class="hljs-title function_">useStyles</span>(theme)
  <span class="hljs-keyword">const</span> searchParam = <span class="hljs-title function_">urlParam</span>(<span class="hljs-string">&#x27;search&#x27;</span>)
  <span class="hljs-keyword">const</span> search = <span class="hljs-title function_">useSelector</span>(<span class="hljs-function"><span class="hljs-params">state</span> =&gt;</span> state.<span class="hljs-property">search</span>.<span class="hljs-property">searchTerm</span>) || searchParam
  <span class="hljs-keyword">const</span> resultJson = <span class="hljs-title function_">useSelector</span>(searchSelector)
  <span class="hljs-keyword">const</span> pending = <span class="hljs-title function_">useSelector</span>(<span class="hljs-function"><span class="hljs-params">state</span> =&gt;</span> state.<span class="hljs-property">_fetch</span>.<span class="hljs-property">search</span>?.<span class="hljs-property">pending</span>)
  <span class="hljs-keyword">const</span> results = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>([], resultJson) <span class="hljs-comment">/* adds missing Array __proto__ */</span>

  <span class="hljs-keyword">const</span> { t, <span class="hljs-attr">ready</span>: translationReady } = <span class="hljs-title function_">useTranslation</span>(
    <span class="hljs-string">&#x27;Search&#x27;</span>, <span class="hljs-comment">/* i18next-parser needs string here */</span>
    { <span class="hljs-attr">useSuspense</span>: <span class="hljs-literal">false</span>, i18n }
  )
  
  <span class="hljs-keyword">if</span> (!translationReady) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
  <span class="hljs-keyword">if</span> (!search) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>

  <span class="hljs-keyword">return</span> ( 
    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{classes.page}</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Row</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Col</span> <span class="hljs-attr">xs</span>=<span class="hljs-string">{12}</span> <span class="hljs-attr">align</span>=<span class="hljs-string">&quot;center&quot;</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Row</span> <span class="hljs-attr">justify</span>=<span class="hljs-string">&quot;center&quot;</span> <span class="hljs-attr">alignItems</span>=<span class="hljs-string">&quot;center&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Typography</span> <span class="hljs-attr">variant</span>=<span class="hljs-string">&quot;h1&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span>&#x27;<span class="hljs-attr">marginRight</span>&#x27;<span class="hljs-attr">:</span> &#x27;<span class="hljs-attr">20px</span>&#x27;}} &gt;</span>
              {t(&#x27;{{state}} results for {{search}}&#x27;, {
                state: pending ? &#x27;Loading &#x27; : `Showing ${results.length}`,
                search: search
              })}
            <span class="hljs-tag">&lt;/<span class="hljs-name">Typography</span>&gt;</span>
            {pending &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">CircularProgress</span> /&gt;</span>}
          <span class="hljs-tag">&lt;/<span class="hljs-name">Row</span>&gt;</span>
          {results.length &gt; 0 &amp;&amp;
          <span class="hljs-tag">&lt;<span class="hljs-name">Box</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{classes.cardContainer}</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">DataTable</span> 
              <span class="hljs-attr">cellStyles</span>=<span class="hljs-string">{{padding:</span> <span class="hljs-attr">0</span>}}
              <span class="hljs-attr">className</span>=<span class="hljs-string">{classes.searchTable}</span>
              <span class="hljs-attr">csvFileName</span>=<span class="hljs-string">{t(</span>&#x27;<span class="hljs-attr">Search</span> <span class="hljs-attr">results</span> <span class="hljs-attr">for</span> {{<span class="hljs-attr">search</span>}}&#x27;, {<span class="hljs-attr">search:</span> <span class="hljs-attr">search</span>})}
              <span class="hljs-attr">name</span>=<span class="hljs-string">&#x27;results&#x27;</span>
              <span class="hljs-attr">rows</span>=<span class="hljs-string">{results}</span>
              <span class="hljs-attr">columns</span>=<span class="hljs-string">{[{</span>
                <span class="hljs-attr">field:</span> &#x27;<span class="hljs-attr">results</span>&#x27;,
                <span class="hljs-attr">renderCell:</span> <span class="hljs-attr">e</span> =&gt;</span> 
                  <span class="hljs-tag">&lt;<span class="hljs-name">ResultCard</span> 
                    <span class="hljs-attr">key</span>=<span class="hljs-string">{e.row.details_url}</span>
                    <span class="hljs-attr">label</span>=<span class="hljs-string">{e.row.label}</span>
                    <span class="hljs-attr">url</span>=<span class="hljs-string">{e.row.details_url}</span>
                    <span class="hljs-attr">categoryReadable</span>=<span class="hljs-string">{e.row.category_label}</span>
                    <span class="hljs-attr">category</span>=<span class="hljs-string">{e.row.category}</span>
                  /&gt;</span>
              }]}&gt;
            <span class="hljs-tag">&lt;/<span class="hljs-name">DataTable</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">Box</span>&gt;</span>
          }
        <span class="hljs-tag">&lt;/<span class="hljs-name">Col</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Row</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  ) 
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">SearchResults</span></pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrcstaterootreducer.js"><a href="#toc"><a name="ui-src-state-rootreducer-js">ui/src/state/rootReducer.js</a></a></h2>
<pre><code><span class="hljs-keyword">import</span> { combineReducers } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@reduxjs/toolkit&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">search</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./slices/searchStateSlice&#x27;</span>
<span class="hljs-keyword">import</span> _fetch <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../components/Data/DataState&#x27;</span>

export <span class="hljs-keyword">default</span> combineReducers({ <span class="hljs-keyword">search</span>, _fetch })</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrcstateslicessearchstateslice.js"><a href="#toc"><a name="ui-src-state-slices-searchstateslice-js">ui/src/state/slices/searchStateSlice.js</a></a></h2>
<pre><code><span class="hljs-keyword">import</span> { createSlice } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@reduxjs/toolkit&#x27;</span>

<span class="hljs-comment">/* A slice is a data object containing a portion of the application state */</span>
<span class="hljs-comment">/* Reducers determine how to modify state when something happens in the app */</span>

<span class="hljs-comment">/* State that should only be set initially */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> initialSearchState = { <span class="hljs-attr">searchTerm</span>: <span class="hljs-string">&#x27;&#x27;</span> }

<span class="hljs-comment">/* createSlice() automatically creates actions that incorporate the reducer logic below */</span>
<span class="hljs-keyword">const</span> searchSlice = <span class="hljs-title function_">createSlice</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;search&#x27;</span>,
  <span class="hljs-attr">initialState</span>: initialSearchState,
  <span class="hljs-attr">reducers</span>: {
    <span class="hljs-title function_">setSearchTerm</span>(<span class="hljs-params">state, action</span>) {
      state.<span class="hljs-property">searchTerm</span> = action.<span class="hljs-property">payload</span>
    },
    <span class="hljs-title function_">resetSearch</span>(<span class="hljs-params">state</span>) {
      <span class="hljs-keyword">return</span> { ...state, ...initialSearchState }
    }
  }
})

<span class="hljs-comment">/* Destructure and export synchronous action creators */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> { resetSearch, setSearchTerm } = searchSlice.<span class="hljs-property">actions</span>

<span class="hljs-comment">/* for a smoother search, we don&#x27;t want to return an empty object when the result is pending, as sliceJson does */</span>
<span class="hljs-comment">/* the result should instead be the last fetched result */</span> 
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">searchSelector</span> = (<span class="hljs-params">state</span>) =&gt; {
  <span class="hljs-keyword">const</span> slice = state?.<span class="hljs-property">_fetch</span>?.<span class="hljs-property">search</span>
  <span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> slice === <span class="hljs-string">&#x27;undefined&#x27;</span> || <span class="hljs-keyword">typeof</span> slice?.<span class="hljs-property">json</span> === <span class="hljs-string">&#x27;undefined&#x27;</span>) <span class="hljs-keyword">return</span> {}
  <span class="hljs-keyword">return</span> slice.<span class="hljs-property">json</span>
}

<span class="hljs-comment">/* Export the above reducers in a way that can be passed directly to combineReducers() */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> searchSlice.<span class="hljs-property">reducer</span></pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrcstatestore.js"><a href="#toc"><a name="ui-src-state-store-js">ui/src/state/store.js</a></a></h2>
<pre><code><span class="hljs-keyword">import</span> { configureStore } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@reduxjs/toolkit&#x27;</span>
<span class="hljs-keyword">import</span> rootReducer <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./rootReducer&#x27;</span>
<span class="hljs-keyword">import</span> logger <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;redux-logger&#x27;</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">configureStore</span>({
  <span class="hljs-attr">reducer</span>: rootReducer,
  <span class="hljs-attr">middleware</span>: <span class="hljs-function"><span class="hljs-params">getDefaultMiddleware</span> =&gt;</span> <span class="hljs-title function_">getDefaultMiddleware</span>().<span class="hljs-title function_">concat</span>(logger)
})

<span class="hljs-comment">/* getDefaultMiddleware() returns the following by default:
  [
    thunk, &lt;-- allows Redux to perform asyncronous tasks
    immutableStateInvariant, &lt;-- throws an error when state is mutated
    serializableStateInvariant &lt;-- logs a warning if Redux is abused to store non-data
  ] 
*/</span></pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrcthemefooterstyles.js"><a href="#toc"><a name="ui-src-theme-footerstyles-js">ui/src/theme/FooterStyles.js</a></a></h2>
<pre><code><span class="hljs-keyword">import</span> { makeStyles } from <span class="hljs-string">&#x27;@material-ui/core/styles&#x27;</span>

<span class="hljs-comment">/*
  Component Styles: provides non-global styles for a specific component
    If a style is global it should go in Theme.js not here
*/</span>

export <span class="hljs-keyword">default</span> <span class="hljs-title function_">makeStyles</span>(theme =&gt; ({
  <span class="hljs-comment">// desktop styles</span>
  root: {
    display: <span class="hljs-string">&#x27;flex&#x27;</span>,
    justifyContent: <span class="hljs-string">&#x27;space-between&#x27;</span>,
    alignItems: <span class="hljs-string">&#x27;center&#x27;</span>,
    minHeight: <span class="hljs-string">&#x27;8.5rem&#x27;</span>,
    <span class="hljs-built_in">width</span>: <span class="hljs-string">&#x27;100%&#x27;</span>,
    borderTop: `<span class="hljs-number">.5</span>px solid ${theme.<span class="hljs-property">palette</span>.<span class="hljs-property">primary</span>.<span class="hljs-property">dark</span>}`,
    padding: theme.<span class="hljs-property">spacing</span>(<span class="hljs-number">2</span>),
  },
  item: {
    <span class="hljs-type">color</span>: theme.<span class="hljs-property">palette</span>.<span class="hljs-property">common</span>.<span class="hljs-property">OFFWHITE</span>,
    textDecoration: <span class="hljs-string">&#x27;none&#x27;</span>,
    <span class="hljs-string">&#x27;&amp;:hover&#x27;</span>:{
      textDecoration: <span class="hljs-string">&#x27;underline&#x27;</span>,
      opacity: <span class="hljs-string">&#x27;1&#x27;</span>
    },
    <span class="hljs-string">&#x27;&amp;:focus&#x27;</span>:{
      textDecoration: <span class="hljs-string">&#x27;underline&#x27;</span>,
      opacity: <span class="hljs-string">&#x27;1&#x27;</span>
    },
    fontSize: <span class="hljs-string">&#x27;.89rem&#x27;</span>
  },
  footerText: {
    <span class="hljs-type">color</span>: <span class="hljs-string">&#x27;white&#x27;</span>,
    padding: theme.<span class="hljs-property">spacing</span>(<span class="hljs-number">2</span>),
    display: <span class="hljs-string">&#x27;flex&#x27;</span>,
    flex: <span class="hljs-number">1</span>,
  },
  links: {
    paddingRight: theme.<span class="hljs-property">spacing</span>(<span class="hljs-number">5</span>),
    paddingLeft: theme.<span class="hljs-property">spacing</span>(<span class="hljs-number">3</span>),
    <span class="hljs-built_in">width</span>: <span class="hljs-string">&#x27;fit-content&#x27;</span>,
    <span class="hljs-built_in">textAlign</span>: <span class="hljs-string">&#x27;right&#x27;</span>,
  },
  <span class="hljs-comment">// mobile styles</span>
  rootMobile: {
    <span class="hljs-built_in">height</span>: <span class="hljs-string">&#x27;fit-content&#x27;</span>,
    <span class="hljs-built_in">width</span>: <span class="hljs-string">&#x27;100%&#x27;</span>,
    padding: <span class="hljs-string">&#x27;1rem&#x27;</span>,
    display: <span class="hljs-string">&#x27;flex&#x27;</span>,
    borderTop: `<span class="hljs-number">.5</span>px solid ${theme.<span class="hljs-property">palette</span>.<span class="hljs-property">primary</span>.<span class="hljs-property">dark</span>}`,
    backgroundColor: theme.<span class="hljs-property">palette</span>.<span class="hljs-property">common</span>.<span class="hljs-property">EGGPLANT</span>, 
    <span class="hljs-string">&#x27;&amp; .footerItem&#x27;</span>: {
      <span class="hljs-built_in">textAlign</span>: <span class="hljs-string">&#x27;center&#x27;</span>,
      <span class="hljs-built_in">height</span>: <span class="hljs-string">&#x27;fit-content&#x27;</span>, 
      <span class="hljs-type">color</span>: theme.<span class="hljs-property">palette</span>.<span class="hljs-property">common</span>.<span class="hljs-property">LIGHTGREY</span>
    },
    <span class="hljs-string">&#x27;&amp; .fa-icon&#x27;</span>: {
      paddingBottom: <span class="hljs-string">&#x27;4px&#x27;</span>
    }
  }
}), {index: <span class="hljs-number">1</span>})</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrcthemegraphstyles.js"><a href="#toc"><a name="ui-src-theme-graphstyles-js">ui/src/theme/GraphStyles.js</a></a></h2>
<pre><code><span class="hljs-keyword">import</span> { makeStyles } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/styles&#x27;</span>

<span class="hljs-comment">/*
  Component Styles: provides non-global styles for a specific component
    If a style is global it should go in Theme.js not here
*/</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">makeStyles</span>(<span class="hljs-function"><span class="hljs-params">theme</span> =&gt;</span> 
  ({
    <span class="hljs-attr">graphLegend</span>: {
      <span class="hljs-attr">fontFamily</span>: <span class="hljs-string">&#x27;Source Sans Pro, sans-serif&#x27;</span>,
      <span class="hljs-attr">fontSize</span>: <span class="hljs-string">&#x27;0.8rem&#x27;</span>,
      <span class="hljs-attr">backgroundColor</span>: theme.<span class="hljs-property">palette</span>.<span class="hljs-property">common</span>.<span class="hljs-property">EGGPLANT</span>,
      <span class="hljs-attr">color</span>: theme.<span class="hljs-property">palette</span>.<span class="hljs-property">common</span>.<span class="hljs-property">OFFWHITE</span>
    }
  })
)</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrcthemeheaderstyles.js"><a href="#toc"><a name="ui-src-theme-headerstyles-js">ui/src/theme/HeaderStyles.js</a></a></h2>
<pre><code>import { makeStyles } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/styles&#x27;</span>

<span class="hljs-comment">/*
  Component Styles: provides non-global styles for a specific component
    If a style is global it should go in Theme.js not here
*/</span>

export <span class="hljs-literal">default</span> makeStyles((theme) =&gt; ({
  root: {
    <span class="hljs-keyword">display</span>: <span class="hljs-string">&#x27;flex&#x27;</span>,
    alignItems: <span class="hljs-string">&#x27;center&#x27;</span>,
    backgroundColor: theme.palette.<span class="hljs-keyword">common</span>.CORAL
  },
  title: { textDecoration: <span class="hljs-string">&#x27;none&#x27;</span> },
  titleText: {
    fontFamily: <span class="hljs-string">&#x27;Oswald&#x27;</span>, 
    color: theme.palette.<span class="hljs-keyword">common</span>.EGGPLANT,
    backgroundColor: theme.palette.<span class="hljs-keyword">common</span>.CORAL,
    fontWeight: <span class="hljs-number">600</span>
  },
  searchBarDiv: {
    width: <span class="hljs-string">&#x27;100%&#x27;</span>, 
    alignSelf: <span class="hljs-string">&#x27;flex-start&#x27;</span>, 
    justifySelf: <span class="hljs-string">&#x27;flex-end&#x27;</span>,
    paddingTop: <span class="hljs-string">&#x27;.25rem&#x27;</span>
  },
  searchBarMobile: {
    width: <span class="hljs-string">&#x27;100%&#x27;</span>, 
    alignSelf: <span class="hljs-string">&#x27;flex-start&#x27;</span>, 
    justifySelf: <span class="hljs-string">&#x27;flex-end&#x27;</span>,
    marginRight: <span class="hljs-string">&#x27;0&#x27;</span>,
    paddingRight: <span class="hljs-string">&#x27;0&#x27;</span>
  },
  offset: theme.mixins.toolbar
}), {<span class="hljs-keyword">index</span>: <span class="hljs-number">1</span>})</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrcthemehomestyles.js"><a href="#toc"><a name="ui-src-theme-homestyles-js">ui/src/theme/HomeStyles.js</a></a></h2>
<pre><code><span class="hljs-attribute">import { makeStyles } from &#x27;@material-ui/core/styles&#x27;

/*
  Component Styles</span><span class="hljs-punctuation">:</span> <span class="hljs-string">provides non-global styles for a specific component</span>
    <span class="hljs-attribute">If a style is global it should go in Theme.js not here
*/

export default makeStyles(theme =&gt; ({
  intro</span><span class="hljs-punctuation">:</span> <span class="hljs-string">{</span>
    <span class="hljs-attribute">backgroundColor</span><span class="hljs-punctuation">:</span> <span class="hljs-string">theme.palette.common.CORAL, </span>
    <span class="hljs-attribute">height</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;45vh&#x27;, </span>
    <span class="hljs-attribute">display</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;flex&#x27;, </span>
    <span class="hljs-attribute">flexDirection</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;column&#x27;, </span>
    <span class="hljs-attribute">justifyContent</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;flex-start&#x27;,</span>
    <span class="hljs-attribute">color</span><span class="hljs-punctuation">:</span> <span class="hljs-string">theme.palette.common.EGGPLANT,</span>
    <span class="hljs-attribute">paddingTop</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;13%&#x27;</span>
  <span class="hljs-attribute">},
  introText</span><span class="hljs-punctuation">:</span> <span class="hljs-string">{</span>
    <span class="hljs-attribute">maxWidth</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;90%&#x27;, </span>
    <span class="hljs-attribute">margin</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;0 auto&#x27;,</span>
    <span class="hljs-attribute">fontSize</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;1.25em&#x27;,</span>
    <span class="hljs-attribute">paddingBottom</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;1.5rem&#x27;,</span>
    <span class="hljs-attribute">lineHeight</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;1.35rem&#x27;,</span>
    <span class="hljs-attribute">fontWeight</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;400&#x27;</span>
  <span class="hljs-attribute">},
  introTextMobile</span><span class="hljs-punctuation">:</span> <span class="hljs-string">{</span>
    <span class="hljs-attribute">maxWidth</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;90%&#x27;, </span>
    <span class="hljs-attribute">margin</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;0 auto&#x27;,</span>
    <span class="hljs-attribute">marginTop</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;20&#x27;,</span>
    <span class="hljs-attribute">fontSize</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;1.5rem&#x27;,</span>
    <span class="hljs-attribute">lineHeight</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;32px&#x27;,</span>
    <span class="hljs-attribute">fontWeight</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;400&#x27;</span>
  <span class="hljs-attribute">},
  iconStyle</span><span class="hljs-punctuation">:</span> <span class="hljs-string">{</span>
    <span class="hljs-attribute">height</span><span class="hljs-punctuation">:</span> <span class="hljs-string">70, </span>
    <span class="hljs-attribute">width</span><span class="hljs-punctuation">:</span> <span class="hljs-string">70, </span>
    <span class="hljs-attribute">marginBottom</span><span class="hljs-punctuation">:</span> <span class="hljs-string">20 </span>
  <span class="hljs-attribute">},
  colStyle</span><span class="hljs-punctuation">:</span> <span class="hljs-string">{</span>
    <span class="hljs-attribute">width</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;100%&#x27;, </span>
    <span class="hljs-attribute">marginBottom</span><span class="hljs-punctuation">:</span> <span class="hljs-string">25,</span>
    <span class="hljs-attribute">color</span><span class="hljs-punctuation">:</span> <span class="hljs-string">theme.palette.common.EGGPLANT</span>
  <span class="hljs-attribute">}, 
  infoStyle</span><span class="hljs-punctuation">:</span> <span class="hljs-string">{</span>
    <span class="hljs-attribute">minHeight</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;45vh&#x27;,</span>
    <span class="hljs-attribute">backgroundColor</span><span class="hljs-punctuation">:</span> <span class="hljs-string">theme.palette.common.OFFWHITE,</span>
    <span class="hljs-attribute">display</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;flex&#x27;,</span>
    <span class="hljs-attribute">alignItems</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;center&#x27;,</span>
    <span class="hljs-attribute">padding</span><span class="hljs-punctuation">:</span> <span class="hljs-string">25</span>
  <span class="hljs-attribute">},
  subHeading</span><span class="hljs-punctuation">:</span> <span class="hljs-string">{</span>
    <span class="hljs-attribute">fontWeight</span><span class="hljs-punctuation">:</span> <span class="hljs-string">600, </span>
    <span class="hljs-attribute">fontSize</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;1.5rem&#x27;,</span>
    <span class="hljs-attribute">color</span><span class="hljs-punctuation">:</span> <span class="hljs-string">theme.palette.common.EGGPLANT</span>
  <span class="hljs-attribute">},
  columnText</span><span class="hljs-punctuation">:</span> <span class="hljs-string">{</span>
    <span class="hljs-attribute">fontSize</span><span class="hljs-punctuation">:</span> <span class="hljs-string">18, </span>
    <span class="hljs-attribute">marginBottom</span><span class="hljs-punctuation">:</span> <span class="hljs-string">25,</span>
    <span class="hljs-attribute">color</span><span class="hljs-punctuation">:</span> <span class="hljs-string">theme.palette.common.EGGPLANT </span>
  <span class="hljs-attribute">},
  offset</span><span class="hljs-punctuation">:</span> <span class="hljs-string">theme.mixins.toolbar</span>
<span class="hljs-attribute">}), {index</span><span class="hljs-punctuation">:</span> <span class="hljs-string">1}</span>
)</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrcthemeliststyles.js"><a href="#toc"><a name="ui-src-theme-liststyles-js">ui/src/theme/ListStyles.js</a></a></h2>
<pre><code>import { <span class="hljs-attribute">makeStyles } from &#x27;@material-ui/core/styles&#x27;

/*
  Component Styles</span>: provides non-global styles for a specific component
    If a style is global it should go in Theme<span class="hljs-variable">.js</span> not here
*/

export default makeStyles(theme =&gt; ({
  table: {
    background: theme<span class="hljs-variable">.palette</span><span class="hljs-variable">.common</span><span class="hljs-variable">.OFFWHITE</span>,
    color: theme<span class="hljs-variable">.palette</span><span class="hljs-variable">.common</span><span class="hljs-variable">.EGGPLANT</span>,
    &#x27;&amp; *::selection&#x27;: {
      color: theme<span class="hljs-variable">.palette</span><span class="hljs-variable">.common</span><span class="hljs-variable">.OFFWHITE</span>,
      background: theme<span class="hljs-variable">.palette</span><span class="hljs-variable">.common</span><span class="hljs-variable">.EGGPLANT</span>,
    },
    &#x27;&amp;::selection&#x27;: {
      color: theme<span class="hljs-variable">.palette</span><span class="hljs-variable">.common</span><span class="hljs-variable">.OFFWHITE</span>,
      background: theme<span class="hljs-variable">.palette</span><span class="hljs-variable">.common</span><span class="hljs-variable">.EGGPLANT</span>,
    },
    tableLayout: &#x27;fixed&#x27;,
  },
  tableCell: {
    overflow: &#x27;visible&#x27;,
    whiteSpace: &#x27;wrap&#x27;,
    wordBreak: &#x27;normal&#x27;,
    padding: 15,
    fontSize: 14,
    &#x27;&amp;::selection&#x27;: {
      color: theme<span class="hljs-variable">.palette</span><span class="hljs-variable">.common</span><span class="hljs-variable">.OFFWHITE</span>,
      background: theme<span class="hljs-variable">.palette</span><span class="hljs-variable">.common</span><span class="hljs-variable">.EGGPLANT</span>,
    },
    &#x27;&amp;:last-child&#x27;: {
      padding: 15
    },
  },
  headerCell: {
    overflow: &#x27;visible&#x27;,
    whiteSpace: &#x27;wrap&#x27;,
    padding: &#x27;8px 15px 8px 15px&#x27;,
    fontSize: 14,
    &#x27;&amp;::selection&#x27;: {
      color: theme<span class="hljs-variable">.palette</span><span class="hljs-variable">.common</span><span class="hljs-variable">.OFFWHITE</span>,
      background: theme<span class="hljs-variable">.palette</span><span class="hljs-variable">.common</span><span class="hljs-variable">.EGGPLANT</span>,
    },
    &#x27;&amp; <span class="hljs-variable">.MuiTableSortLabel-root</span>&#x27;: {
      &#x27;&amp;::selection&#x27;: {
        color: theme<span class="hljs-variable">.palette</span><span class="hljs-variable">.common</span><span class="hljs-variable">.OFFWHITE</span>,
        background: theme<span class="hljs-variable">.palette</span><span class="hljs-variable">.common</span><span class="hljs-variable">.EGGPLANT</span>,
      },
    },
  },
  tablePagination: {
    backgroundColor: theme<span class="hljs-variable">.palette</span><span class="hljs-variable">.common</span><span class="hljs-variable">.EGGPLANT</span>,
    color: theme<span class="hljs-variable">.palette</span><span class="hljs-variable">.common</span><span class="hljs-variable">.OFFWHITE</span>,
    &#x27;&amp; svg&#x27;: { color: theme<span class="hljs-variable">.palette</span><span class="hljs-variable">.common</span><span class="hljs-variable">.OFFWHITE</span> },
  },
  paginationOption: {
    color: theme<span class="hljs-variable">.palette</span><span class="hljs-variable">.common</span><span class="hljs-variable">.EGGPLANT</span>,
  },
  accordionInTable: {
    whiteSpace: &#x27;nowrap&#x27;,
    backgroundColor: &#x27;unset&#x27;,
  },
  accordionSummary: {
    padding: 0
  },
  cardText: {
    color: theme<span class="hljs-variable">.palette</span><span class="hljs-variable">.common</span><span class="hljs-variable">.EGGPLANT</span>,
    fontFamily: &#x27;Source Sans Pro, sans-serif&#x27;,
    fontSize: &#x27;0.9rem&#x27;,
    fontWeight: 400,
    marginTop: 10,
  },
  detailsText: {
    color: theme<span class="hljs-variable">.palette</span><span class="hljs-variable">.common</span><span class="hljs-variable">.OFFWHITE</span>,
    fontFamily: &#x27;Source Sans Pro, sans-serif&#x27;,
    fontSize: &#x27;0.8rem&#x27;,
    fontWeight: 400,
    marginLeft: 10,
  },
  lightColorLink: {
    &#x27;&amp; a&#x27;: {
      background: theme<span class="hljs-variable">.palette</span><span class="hljs-variable">.common</span><span class="hljs-variable">.EGGPLANT</span>,
      color: theme<span class="hljs-variable">.palette</span><span class="hljs-variable">.common</span><span class="hljs-variable">.OFFWHITE</span>,
    },
  },
  aboutCard: {
    padding: 15,
    borderRadius: 3,
    color: theme<span class="hljs-variable">.palette</span><span class="hljs-variable">.common</span><span class="hljs-variable">.OFFWHITE</span>,
    backgroundColor: &#x27;#302742&#x27;,
  },
  aboutButton: {
    boxShadow: &#x27;none&#x27;,
    border: 0,
    padding: &#x27;3px&#x27;,
    color: theme<span class="hljs-variable">.palette</span><span class="hljs-variable">.common</span><span class="hljs-variable">.OFFWHITE</span>,
    backgroundColor: theme<span class="hljs-variable">.palette</span><span class="hljs-variable">.common</span><span class="hljs-variable">.EGGPLANT</span>,
    &#x27;&amp; svg&#x27;: { color: theme<span class="hljs-variable">.palette</span><span class="hljs-variable">.common</span><span class="hljs-variable">.OFFWHITE</span> },
  },
  showMoreButton: {
    boxShadow: &#x27;none&#x27;,
    border: 0,
    marginBottom: 15,
    color: theme<span class="hljs-variable">.palette</span><span class="hljs-variable">.common</span><span class="hljs-variable">.OFFWHITE</span>,
    backgroundColor: theme<span class="hljs-variable">.palette</span><span class="hljs-variable">.common</span><span class="hljs-variable">.EGGPLANT</span>,
    &#x27;&amp; svg&#x27;: { color: theme<span class="hljs-variable">.palette</span><span class="hljs-variable">.common</span><span class="hljs-variable">.OFFWHITE</span> },
  },
  paper: {
    boxShadow: &#x27;none&#x27;,
  },
}), {index: 1})
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrcthemeoverlaystyles.js"><a href="#toc"><a name="ui-src-theme-overlaystyles-js">ui/src/theme/OverlayStyles.js</a></a></h2>
<pre><code><span class="hljs-attribute">import { makeStyles } from &#x27;@material-ui/core/styles&#x27;

/*
  Component Styles</span><span class="hljs-punctuation">:</span> <span class="hljs-string">provides non-global styles for a specific component</span>
    <span class="hljs-attribute">If a style is global it should go in Theme.js not here
*/

export default makeStyles(theme =&gt;
  ({
    legend</span><span class="hljs-punctuation">:</span> <span class="hljs-string">{</span>
      <span class="hljs-attribute">fontFamily</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;Source Sans Pro, sans-serif&#x27;,</span>
      <span class="hljs-attribute">fontSize</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;0.9rem&#x27;,</span>
      <span class="hljs-attribute">fontWeight</span><span class="hljs-punctuation">:</span> <span class="hljs-string">400,</span>
      <span class="hljs-attribute">backgroundColor</span><span class="hljs-punctuation">:</span> <span class="hljs-string">theme.palette.common.EGGPLANT,</span>
      <span class="hljs-attribute">color</span><span class="hljs-punctuation">:</span> <span class="hljs-string">theme.palette.common.OFFWHITE,</span>
      <span class="hljs-attribute">opacity</span><span class="hljs-punctuation">:</span> <span class="hljs-string">0.9,</span>
      <span class="hljs-attribute">padding</span><span class="hljs-punctuation">:</span> <span class="hljs-string">8</span>
    <span class="hljs-attribute">},
    legendTitle</span><span class="hljs-punctuation">:</span> <span class="hljs-string">{</span>
      <span class="hljs-attribute">fontFamily</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;Source Sans Pro, sans-serif&#x27;,</span>
      <span class="hljs-attribute">fontSize</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;1.2rem&#x27;,</span>
      <span class="hljs-attribute">marginBottom</span><span class="hljs-punctuation">:</span> <span class="hljs-string">10</span>
    <span class="hljs-attribute">},
    infoBox</span><span class="hljs-punctuation">:</span> <span class="hljs-string">{</span>
      <span class="hljs-attribute">backgroundColor</span><span class="hljs-punctuation">:</span> <span class="hljs-string">theme.palette.common.EGGPLANT,</span>
      <span class="hljs-attribute">color</span><span class="hljs-punctuation">:</span> <span class="hljs-string">theme.palette.common.OFFWHITE,</span>
      <span class="hljs-attribute">zIndex</span><span class="hljs-punctuation">:</span> <span class="hljs-string">400,</span>
      <span class="hljs-attribute">overflow</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;hidden&#x27;,</span>
      <span class="hljs-attribute">opacity</span><span class="hljs-punctuation">:</span> <span class="hljs-string">0.9,</span>
      <span class="hljs-attribute">padding</span><span class="hljs-punctuation">:</span> <span class="hljs-string">8</span>
    <span class="hljs-attribute">},
  }), {index</span><span class="hljs-punctuation">:</span> <span class="hljs-string">1}</span>
)
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrcthemesearchbarstyles.js"><a href="#toc"><a name="ui-src-theme-searchbarstyles-js">ui/src/theme/SearchBarStyles.js</a></a></h2>
<pre><code><span class="hljs-keyword">import</span> { makeStyles } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core&#x27;</span>

<span class="hljs-comment">/*
  Component Styles: provides non-global styles for a specific component
    If a style is global it should go in Theme.js not here
*/</span>

export <span class="hljs-keyword">default</span> makeStyles((theme) =&gt; ({
  root: {
    position: <span class="hljs-string">&#x27;relative&#x27;</span>,
    <span class="hljs-string">&#x27;&amp; .search-results-item&#x27;</span>: {
      display: <span class="hljs-string">&#x27;flex&#x27;</span>, 
      marginTop: <span class="hljs-number">0</span>,
      marginBottom: <span class="hljs-number">0</span>,
      paddingTop: <span class="hljs-number">0</span>,
      paddingBottom: <span class="hljs-number">0</span>,
      width: <span class="hljs-string">&#x27;inherit&#x27;</span>,
      height: <span class="hljs-string">&#x27;3.5rem&#x27;</span>,
      zIndex: <span class="hljs-number">900</span>, 
      ariaLabel: <span class="hljs-string">&#x27;search results&#x27;</span>, 
      border: <span class="hljs-string">&#x27;.75px lightgrey solid&#x27;</span>,
      borderRight: <span class="hljs-string">&#x27;2.5px lightgrey solid&#x27;</span>,
      borderLeft: <span class="hljs-string">&#x27;2.5px lightgrey solid&#x27;</span>
    },
    <span class="hljs-string">&#x27;&amp; .search-results-item div.searchResultText:hover&#x27;</span>: {
      textDecoration: <span class="hljs-string">&#x27;underline&#x27;</span>
    },
    <span class="hljs-string">&#x27;&amp; .search-results-item:hover&#x27;</span>: {
      backgroundColor: theme.palette.common.LIGHTGREY,
      color: theme.palette.common.EGGPLANT
    },
    <span class="hljs-comment">/* Outline for when link is focused on via keyboard */</span>
    <span class="hljs-comment">/* DO NOT REMOVE. THIS IS FOR KEYBOARD ACCESSIBILITY. */</span>
    <span class="hljs-string">&#x27;&amp; .search-results-item:focus&#x27;</span>: {
      outline: <span class="hljs-string">&#x27;3px solid #A9A9A9&#x27;</span>
    },
    <span class="hljs-comment">/* text in focused Link div. works in tandem with the rule above. */</span>
    <span class="hljs-string">&#x27;&amp; .search-results-item:focus div.searchResultText&#x27;</span>: {
      textDecoration: <span class="hljs-string">&#x27;underline&#x27;</span>,
      fontWeight: <span class="hljs-string">&#x27;900&#x27;</span>
    },
    <span class="hljs-string">&#x27;&amp; button:focus&#x27;</span>: {
      outline: <span class="hljs-string">&#x27;3px solid #A9A9A9&#x27;</span>
    },
    <span class="hljs-string">&#x27;&amp; .wrapper-div&#x27;</span>: {
      width: <span class="hljs-string">&#x27;100%&#x27;</span>,
      position: <span class="hljs-string">&#x27;absolute&#x27;</span>, 
      minWidth: <span class="hljs-number">320</span>, 
      display: <span class="hljs-string">&#x27;flex&#x27;</span>, 
      flexDirection: <span class="hljs-string">&#x27;column&#x27;</span>, 
      zIndex: <span class="hljs-number">900</span>,
      alignItems: <span class="hljs-string">&#x27;center&#x27;</span>, 
      marginRight: <span class="hljs-string">&#x27;0&#x27;</span>, 
      paddingRight: <span class="hljs-string">&#x27;0&#x27;</span>, 
      maxWidth: <span class="hljs-string">&#x27;100%&#x27;</span>
    },
    <span class="hljs-string">&#x27;&amp; .search-bar&#x27;</span>: {
      width: <span class="hljs-string">&#x27;85%&#x27;</span>,
      maxWidth: <span class="hljs-number">1000</span>,
      margin: <span class="hljs-string">&#x27;0 auto&#x27;</span>,
      marginBottom: <span class="hljs-number">-.5</span>,
      border: <span class="hljs-string">&#x27;1px lightgrey solid&#x27;</span>
    },
    <span class="hljs-string">&#x27;&amp; .search-bar-header&#x27;</span>: {
      width: <span class="hljs-string">&#x27;85%&#x27;</span>,
      maxWidth: <span class="hljs-number">1000</span>,
      margin: <span class="hljs-string">&#x27;0 auto&#x27;</span>
      // <span class="hljs-keyword">add</span><span class="hljs-string">&#x27;t header styles can go here
    },
    &#x27;</span>&amp; .<span class="hljs-keyword">search</span>-form<span class="hljs-string">&#x27;: {
      position: &#x27;</span>relativ<span class="hljs-string">e&#x27;,
      display: &#x27;</span>flex<span class="hljs-string">&#x27;,
      alignItems: &#x27;</span>center<span class="hljs-string">&#x27;,
      flexWrap: &#x27;</span>nowrap<span class="hljs-string">&#x27;,
      justifyContent: &#x27;</span>center<span class="hljs-string">&#x27;
    },
    &#x27;</span>&amp; .searchResultText<span class="hljs-string">&#x27;: {
      fontSize: &#x27;</span><span class="hljs-number">18</span>px<span class="hljs-string">&#x27;, 
      color: theme.palette.common.EGGPLANT, 
    }, 
    &#x27;</span>&amp; .searchTypeText<span class="hljs-string">&#x27;: { //doesn&#x27;</span>t actually seem <span class="hljs-keyword">to</span> be <span class="hljs-keyword">overriding</span> the MUI typography css
      color: theme.palette.common.CORAL, 
      fontSize: <span class="hljs-number">13</span>
    },
    <span class="hljs-string">&#x27;&amp; .input&#x27;</span>: {
      backgroundColor: theme.palette.common.OFFWHITE,
      height: `${theme.mixins.toolbar.minHeight}`,
      <span class="hljs-string">&#x27;&amp; *::selection&#x27;</span>: {
        color: theme.palette.common.OFFWHITE,
        background: theme.palette.common.EGGPLANT
      }
    },
    <span class="hljs-string">&#x27;&amp; .result-icon&#x27;</span>: {
      color: theme.palette.common.EGGPLANT,
      margin: <span class="hljs-number">0</span>,
      padding: <span class="hljs-number">0</span>
    },
  },
  searchResults: {
    display: <span class="hljs-string">&#x27;flex&#x27;</span>,
    flexDirection: <span class="hljs-string">&#x27;column&#x27;</span>,
    justifyContent: <span class="hljs-string">&#x27;space-between&#x27;</span>,
    margin: <span class="hljs-string">&#x27;0, auto&#x27;</span>,
    width: <span class="hljs-string">&#x27;85%&#x27;</span>, 
    maxWidth: <span class="hljs-number">1000</span>, 
    backgroundColor: theme.palette.common.OFFWHITE, 
    marginTop: <span class="hljs-number">-2</span>, 
    zIndex: <span class="hljs-number">998</span>
  }
}), {<span class="hljs-keyword">index</span>: <span class="hljs-number">1</span>})</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrcthemesearchresultsstyles.js"><a href="#toc"><a name="ui-src-theme-searchresultsstyles-js">ui/src/theme/SearchResultsStyles.js</a></a></h2>
<pre><code><span class="hljs-attribute">import { makeStyles } from &#x27;@material-ui/core/styles&#x27;

/*
  Component Styles</span><span class="hljs-punctuation">:</span> <span class="hljs-string">provides non-global styles for a specific component</span>
    <span class="hljs-attribute">If a style is global it should go in Theme.js not here
*/

export default makeStyles(theme =&gt; 
  ({
    page</span><span class="hljs-punctuation">:</span> <span class="hljs-string">{</span>
      <span class="hljs-attribute">marginTop</span><span class="hljs-punctuation">:</span> <span class="hljs-string">20,</span>
      <span class="hljs-attribute">marginLeft</span><span class="hljs-punctuation">:</span> <span class="hljs-string">20</span>
    <span class="hljs-attribute">},
    header</span><span class="hljs-punctuation">:</span> <span class="hljs-string">{</span>
      <span class="hljs-attribute">marginBottom</span><span class="hljs-punctuation">:</span> <span class="hljs-string">theme.spacing(3)</span>
    <span class="hljs-attribute">},
    offWhiteText</span><span class="hljs-punctuation">:</span> <span class="hljs-string">{</span>
      <span class="hljs-attribute">color</span><span class="hljs-punctuation">:</span> <span class="hljs-string">theme.palette.common.OFFWHITE,</span>
      <span class="hljs-attribute">marginBottom</span><span class="hljs-punctuation">:</span> <span class="hljs-string">theme.spacing(2)</span>
    <span class="hljs-attribute">},
    feedback</span><span class="hljs-punctuation">:</span> <span class="hljs-string">{</span>
      <span class="hljs-attribute">alignItems</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;center&#x27;</span>
    <span class="hljs-attribute">},
    card</span><span class="hljs-punctuation">:</span> <span class="hljs-string">{</span>
      <span class="hljs-attribute">marginBottom</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;.5rem&#x27;,</span>
      <span class="hljs-attribute">width</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;100%&#x27;,</span>
      <span class="hljs-attribute">textAlign</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;left&#x27;,</span>
      <span class="hljs-attribute">borderRadius</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;3px&#x27;</span>
    <span class="hljs-attribute">},
    cardContainer</span><span class="hljs-punctuation">:</span> <span class="hljs-string">{</span>
      <span class="hljs-attribute">width</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;45%&#x27;,</span>
      <span class="hljs-attribute">minWidth</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;400px&#x27;</span>
    <span class="hljs-attribute">},
    avatar</span><span class="hljs-punctuation">:</span> <span class="hljs-string">{</span>
      <span class="hljs-attribute">border</span><span class="hljs-punctuation">:</span> <span class="hljs-string">`1px solid ${theme.palette.common.EGGPLANT}`,</span>
      <span class="hljs-attribute">backgroundColor</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;white&#x27;</span>
    <span class="hljs-attribute">},
    title</span><span class="hljs-punctuation">:</span> <span class="hljs-string">{</span>
      <span class="hljs-attribute">color</span><span class="hljs-punctuation">:</span> <span class="hljs-string">theme.palette.common.EGGPLANT,</span>
      <span class="hljs-attribute">fontWeight</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;bold&#x27;,</span>
      &#x27;&amp;:hover&#x27;: {
        <span class="hljs-attribute">textDecoration</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;underline&#x27;, </span>
        <span class="hljs-attribute">color</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;inherit&#x27;</span>
      <span class="hljs-attribute">} 
    },
    searchTable</span><span class="hljs-punctuation">:</span> <span class="hljs-string">{ //overriding ListStyles.js</span>
      <span class="hljs-attribute">&#x27;&amp; table&#x27;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">{ </span>
        <span class="hljs-attribute">backgroundColor</span><span class="hljs-punctuation">:</span> <span class="hljs-string">theme.palette.common.EGGPLANT,</span>
      },
      &#x27;&amp; thead&#x27;:{
        <span class="hljs-attribute">display</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;none&#x27;</span>
      <span class="hljs-attribute">}
    },
    filterText</span><span class="hljs-punctuation">:</span> <span class="hljs-string">{</span>
      <span class="hljs-attribute">color</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;white&#x27;,</span>
      <span class="hljs-attribute">display</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;flex&#x27;,</span>
      <span class="hljs-attribute">alignItems</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;center&#x27;,</span>
      <span class="hljs-attribute">justifyContent</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;center&#x27;,</span>
      <span class="hljs-attribute">marginBottom</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;1.25rem&#x27;,</span>
      <span class="hljs-attribute">marginTop</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;0&#x27;,</span>
      <span class="hljs-attribute">paddingTop</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;0&#x27;,</span>
      <span class="hljs-attribute">width</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;45%&#x27;,</span>
      <span class="hljs-attribute">minWidth</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;400px&#x27;</span>
    <span class="hljs-attribute">},
    checkBoxDiv</span><span class="hljs-punctuation">:</span> <span class="hljs-string">{</span>
      <span class="hljs-attribute">fill</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;white&#x27;,</span>
      <span class="hljs-attribute">color</span><span class="hljs-punctuation">:</span> <span class="hljs-string">theme.palette.primary,</span>
      <span class="hljs-attribute">backgroundColor</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;white&#x27;,</span>
      <span class="hljs-attribute">marginBottom</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;1.25rem&#x27;,</span>
      <span class="hljs-attribute">marginTop</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;0&#x27;,</span>
      <span class="hljs-attribute">paddingTop</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;0&#x27;,</span>
      <span class="hljs-attribute">width</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;45%&#x27;,</span>
      <span class="hljs-attribute">minWidth</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;400px&#x27;, </span>
      <span class="hljs-attribute">borderRadius</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;3px&#x27;,</span>
      <span class="hljs-attribute">opacity</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;.75&#x27;</span>
    <span class="hljs-attribute">}
  }), {index</span><span class="hljs-punctuation">:</span> <span class="hljs-string">1}</span>
)</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrcthemetheme.js"><a href="#toc"><a name="ui-src-theme-theme-js">ui/src/theme/Theme.js</a></a></h2>
<pre><code><span class="hljs-string">import</span> { <span class="hljs-string">createMuiTheme</span> } <span class="hljs-string">from</span> <span class="hljs-string">&#x27;@material-ui/core/styles&#x27;</span>

<span class="hljs-string">/*</span>
  <span class="hljs-attr">Theme:</span> <span class="hljs-string">provides</span> <span class="hljs-string">default</span> <span class="hljs-string">styling</span> <span class="hljs-string">for</span> <span class="hljs-string">Material</span> <span class="hljs-string">UI</span> <span class="hljs-string">components</span>
    <span class="hljs-string">Global</span> <span class="hljs-string">styles</span> <span class="hljs-string">that</span> <span class="hljs-string">affect</span> <span class="hljs-string">all</span> <span class="hljs-string">elements</span> <span class="hljs-string">of</span> <span class="hljs-string">a</span> <span class="hljs-string">given</span> <span class="hljs-string">type</span> <span class="hljs-string">are</span> <span class="hljs-string">here</span>
<span class="hljs-string">*/</span>

<span class="hljs-string">const</span> <span class="hljs-string">EGGPLANT</span> <span class="hljs-string">=</span> <span class="hljs-string">&#x27;#231935&#x27;</span>
<span class="hljs-string">const</span> <span class="hljs-string">CORAL</span> <span class="hljs-string">=</span> <span class="hljs-string">&#x27;#FB7F50&#x27;</span>
<span class="hljs-string">const</span> <span class="hljs-string">OFFWHITE</span> <span class="hljs-string">=</span> <span class="hljs-string">&#x27;#f5f4f2&#x27;</span>
<span class="hljs-string">const</span> <span class="hljs-string">LIGHTGREY</span> <span class="hljs-string">=</span> <span class="hljs-string">&#x27;#d9d9d9&#x27;</span>
<span class="hljs-string">const</span> <span class="hljs-string">DARKGREY</span> <span class="hljs-string">=</span> <span class="hljs-string">&#x27;#303030&#x27;</span>
<span class="hljs-string">const</span> <span class="hljs-string">BEIGE</span> <span class="hljs-string">=</span> <span class="hljs-string">&#x27;#f5f4f2&#x27;</span>

<span class="hljs-string">export</span> <span class="hljs-string">default</span> <span class="hljs-string">createMuiTheme({</span>
  <span class="hljs-string">/*</span> <span class="hljs-string">Text</span> <span class="hljs-string">styles</span> <span class="hljs-string">*/</span>
  <span class="hljs-attr">typography:</span> {
    <span class="hljs-attr">fontWeightRegular:</span> <span class="hljs-number">400</span>,
    <span class="hljs-attr">fontWeightBold:</span> <span class="hljs-number">700</span>,
    <span class="hljs-attr">h1:</span> {
      <span class="hljs-attr">color:</span> <span class="hljs-string">OFFWHITE</span>,
      <span class="hljs-attr">fontFamily:</span> <span class="hljs-string">&#x27;Oswald, sans-serif&#x27;</span>,
      <span class="hljs-attr">fontSize:</span> <span class="hljs-string">&#x27;2rem&#x27;</span>,
      <span class="hljs-attr">marginBottom:</span> <span class="hljs-number">10</span>,
      <span class="hljs-attr">marginTop:</span> <span class="hljs-number">30</span>,
      <span class="hljs-attr">fontWeight:</span> <span class="hljs-number">500</span>,
      <span class="hljs-attr">userSelect:</span> <span class="hljs-string">&#x27;text&#x27;</span>,
      <span class="hljs-string">&#x27;&amp;::selection&#x27;</span><span class="hljs-string">:</span> { <span class="hljs-attr">color:</span> <span class="hljs-string">EGGPLANT</span>, <span class="hljs-attr">background:</span> <span class="hljs-string">OFFWHITE</span> },
      <span class="hljs-string">&#x27;&amp; *::selection&#x27;</span><span class="hljs-string">:</span> { <span class="hljs-attr">color:</span> <span class="hljs-string">EGGPLANT</span>, <span class="hljs-attr">background:</span> <span class="hljs-string">OFFWHITE</span> },
      <span class="hljs-string">&#x27;&amp; a&#x27;</span><span class="hljs-string">:</span> { <span class="hljs-attr">color:</span> <span class="hljs-string">OFFWHITE</span>, <span class="hljs-attr">background:</span> <span class="hljs-string">EGGPLANT</span> },
    },
    <span class="hljs-attr">h2:</span> {
      <span class="hljs-attr">color:</span> <span class="hljs-string">OFFWHITE</span>,
      <span class="hljs-attr">fontFamily:</span> <span class="hljs-string">&#x27;Oswald, sans-serif&#x27;</span>,
      <span class="hljs-attr">fontSize:</span> <span class="hljs-string">&#x27;1.4rem&#x27;</span>,
      <span class="hljs-attr">marginBottom:</span> <span class="hljs-number">10</span>,
      <span class="hljs-attr">marginTop:</span> <span class="hljs-number">30</span>,
      <span class="hljs-attr">fontWeight:</span> <span class="hljs-number">500</span>,
      <span class="hljs-attr">userSelect:</span> <span class="hljs-string">&#x27;text&#x27;</span>,
      <span class="hljs-string">&#x27;&amp;::selection&#x27;</span><span class="hljs-string">:</span> { <span class="hljs-attr">color:</span> <span class="hljs-string">EGGPLANT</span>, <span class="hljs-attr">background:</span> <span class="hljs-string">OFFWHITE</span> },
      <span class="hljs-string">&#x27;&amp; *::selection&#x27;</span><span class="hljs-string">:</span> { <span class="hljs-attr">color:</span> <span class="hljs-string">EGGPLANT</span>, <span class="hljs-attr">background:</span> <span class="hljs-string">OFFWHITE</span> },
      <span class="hljs-string">&#x27;&amp; a&#x27;</span><span class="hljs-string">:</span> { <span class="hljs-attr">color:</span> <span class="hljs-string">OFFWHITE</span>, <span class="hljs-attr">background:</span> <span class="hljs-string">EGGPLANT</span> },
    },
    <span class="hljs-attr">h3:</span> {
      <span class="hljs-attr">display:</span> <span class="hljs-string">&#x27;flex&#x27;</span>,
      <span class="hljs-attr">alignContent:</span> <span class="hljs-string">&#x27;center&#x27;</span>,
      <span class="hljs-attr">color:</span> <span class="hljs-string">EGGPLANT</span>,
      <span class="hljs-attr">fontFamily:</span> <span class="hljs-string">&#x27;Oswald, sans-serif&#x27;</span>,
      <span class="hljs-attr">fontSize:</span> <span class="hljs-string">&#x27;1.4rem&#x27;</span>,
      <span class="hljs-attr">fontWeight:</span> <span class="hljs-number">500</span>,
      <span class="hljs-attr">userSelect:</span> <span class="hljs-string">&#x27;text&#x27;</span>,
      <span class="hljs-attr">textDecoration:</span> <span class="hljs-string">&#x27;none&#x27;</span>,
      <span class="hljs-string">&#x27;&amp;::selection&#x27;</span><span class="hljs-string">:</span> { <span class="hljs-attr">color:</span> <span class="hljs-string">OFFWHITE</span>, <span class="hljs-attr">background:</span> <span class="hljs-string">EGGPLANT</span> },
      <span class="hljs-string">&#x27;&amp; *::selection&#x27;</span><span class="hljs-string">:</span> { <span class="hljs-attr">color:</span> <span class="hljs-string">OFFWHITE</span>, <span class="hljs-attr">background:</span> <span class="hljs-string">EGGPLANT</span> },
      <span class="hljs-string">&#x27;&amp;::hover&#x27;</span><span class="hljs-string">:</span> { <span class="hljs-attr">textDecoration:</span> <span class="hljs-string">&#x27;none&#x27;</span> },
    },
    <span class="hljs-attr">body1:</span> {
      <span class="hljs-attr">color:</span> <span class="hljs-string">OFFWHITE</span>,
      <span class="hljs-attr">fontFamily:</span> <span class="hljs-string">&#x27;Source Sans Pro, sans-serif&#x27;</span>,
      <span class="hljs-attr">fontSize:</span> <span class="hljs-string">&#x27;0.9rem&#x27;</span>,
      <span class="hljs-attr">fontWeight:</span> <span class="hljs-number">400</span>,
      <span class="hljs-attr">userSelect:</span> <span class="hljs-string">&#x27;text&#x27;</span>,
      <span class="hljs-string">&#x27;&amp; p&#x27;</span><span class="hljs-string">:</span> { <span class="hljs-attr">maxWidth:</span> <span class="hljs-string">&#x27;57ch&#x27;</span> },
      <span class="hljs-string">&#x27;&amp;::selection&#x27;</span><span class="hljs-string">:</span> { <span class="hljs-attr">color:</span> <span class="hljs-string">EGGPLANT</span>, <span class="hljs-attr">background:</span> <span class="hljs-string">OFFWHITE</span> },
      <span class="hljs-string">&#x27;&amp; *::selection&#x27;</span><span class="hljs-string">:</span> { <span class="hljs-attr">color:</span> <span class="hljs-string">EGGPLANT</span>, <span class="hljs-attr">background:</span> <span class="hljs-string">OFFWHITE</span> },
      <span class="hljs-string">&#x27;&amp; a&#x27;</span><span class="hljs-string">:</span> { <span class="hljs-attr">color:</span> <span class="hljs-string">OFFWHITE</span> },
    },
    <span class="hljs-attr">body2:</span> {
      <span class="hljs-attr">color:</span> <span class="hljs-string">EGGPLANT</span>,
      <span class="hljs-attr">fontFamily:</span> <span class="hljs-string">&#x27;Source Sans Pro, sans-serif&#x27;</span>,
      <span class="hljs-attr">fontSize:</span> <span class="hljs-string">&#x27;0.9rem&#x27;</span>,
      <span class="hljs-attr">fontWeight:</span> <span class="hljs-number">400</span>,
      <span class="hljs-attr">userSelect:</span> <span class="hljs-string">&#x27;text&#x27;</span>,
      <span class="hljs-string">&#x27;&amp; p&#x27;</span><span class="hljs-string">:</span> { <span class="hljs-attr">maxWidth:</span> <span class="hljs-string">&#x27;57ch&#x27;</span> },
      <span class="hljs-string">&#x27;&amp;::selection&#x27;</span><span class="hljs-string">:</span> { <span class="hljs-attr">color:</span> <span class="hljs-string">OFFWHITE</span>, <span class="hljs-attr">background:</span> <span class="hljs-string">EGGPLANT</span> },
      <span class="hljs-string">&#x27;&amp; *::selection&#x27;</span><span class="hljs-string">:</span> { <span class="hljs-attr">color:</span> <span class="hljs-string">OFFWHITE</span>, <span class="hljs-attr">background:</span> <span class="hljs-string">EGGPLANT</span> },
      <span class="hljs-string">&#x27;&amp; a&#x27;</span><span class="hljs-string">:</span> { <span class="hljs-attr">color:</span> <span class="hljs-string">EGGPLANT</span> },
    },
    <span class="hljs-attr">subtitle1:</span> {
      <span class="hljs-attr">color:</span> <span class="hljs-string">OFFWHITE</span>,
      <span class="hljs-attr">fontFamily:</span> <span class="hljs-string">&#x27;Oswald, sans-serif&#x27;</span>,
      <span class="hljs-attr">fontSize:</span> <span class="hljs-string">&#x27;1.4rem&#x27;</span>,
      <span class="hljs-attr">marginBottom:</span> <span class="hljs-number">10</span>,
      <span class="hljs-attr">fontWeight:</span> <span class="hljs-number">500</span>,
      <span class="hljs-attr">userSelect:</span> <span class="hljs-string">&#x27;text&#x27;</span>,
      <span class="hljs-string">&#x27;&amp;::selection&#x27;</span><span class="hljs-string">:</span> { <span class="hljs-attr">color:</span> <span class="hljs-string">EGGPLANT</span>, <span class="hljs-attr">background:</span> <span class="hljs-string">OFFWHITE</span> },
      <span class="hljs-string">&#x27;&amp; *::selection&#x27;</span><span class="hljs-string">:</span> { <span class="hljs-attr">color:</span> <span class="hljs-string">EGGPLANT</span>, <span class="hljs-attr">background:</span> <span class="hljs-string">OFFWHITE</span> },
      <span class="hljs-string">&#x27;&amp; a&#x27;</span><span class="hljs-string">:</span> { <span class="hljs-attr">color:</span> <span class="hljs-string">OFFWHITE</span> },
    },
    <span class="hljs-attr">button:</span> {
      <span class="hljs-string">&#x27;&amp;:hover&#x27;</span><span class="hljs-string">:</span> { <span class="hljs-attr">backgroundColor:</span> <span class="hljs-string">&#x27;inherit&#x27;</span> },
    },
    <span class="hljs-attr">caption:</span> {
      <span class="hljs-attr">fontFamily:</span> <span class="hljs-string">&#x27;Source Sans Pro, sans-serif&#x27;</span>,
      <span class="hljs-attr">fontSize:</span> <span class="hljs-string">&#x27;1.2rem&#x27;</span>,
      <span class="hljs-attr">marginBottom:</span> <span class="hljs-number">10</span>,
    },
  }<span class="hljs-string">,</span>

  <span class="hljs-string">/*</span> <span class="hljs-string">Colors</span> <span class="hljs-string">*/</span>
  <span class="hljs-attr">palette:</span> {
    <span class="hljs-attr">common:</span> {
      <span class="hljs-attr">EGGPLANT:</span> <span class="hljs-string">EGGPLANT</span>,
      <span class="hljs-attr">CORAL:</span> <span class="hljs-string">CORAL</span>,
      <span class="hljs-attr">OFFWHITE:</span> <span class="hljs-string">OFFWHITE</span>,
      <span class="hljs-attr">LIGHTGREY:</span> <span class="hljs-string">LIGHTGREY</span>,
      <span class="hljs-attr">DARKGREY:</span> <span class="hljs-string">DARKGREY</span>,
      <span class="hljs-attr">BEIGE:</span> <span class="hljs-string">BEIGE</span>,
    },
    <span class="hljs-attr">primary:</span> { <span class="hljs-attr">main:</span> <span class="hljs-string">OFFWHITE</span> },
    <span class="hljs-attr">secondary:</span> { <span class="hljs-attr">main:</span> <span class="hljs-string">CORAL</span> },
  }<span class="hljs-string">,</span>

  <span class="hljs-string">/*</span> <span class="hljs-string">Material</span> <span class="hljs-string">UI</span> <span class="hljs-string">component</span> <span class="hljs-string">styles</span> <span class="hljs-string">*/</span>
  <span class="hljs-attr">overrides:</span> {
    <span class="hljs-attr">MuiCssBaseline:</span> {
      <span class="hljs-string">&#x27;@global&#x27;</span><span class="hljs-string">:</span> {
        <span class="hljs-attr">body:</span> {
          <span class="hljs-attr">padding:</span> <span class="hljs-number">0</span>,
          <span class="hljs-attr">margin:</span> <span class="hljs-number">0</span>,
          <span class="hljs-attr">WebkitFontSmoothing:</span> <span class="hljs-string">&#x27;auto&#x27;</span>,
          <span class="hljs-attr">backgroundColor:</span> <span class="hljs-string">EGGPLANT</span>,
          <span class="hljs-attr">minHeight:</span> <span class="hljs-string">&#x27;100vh&#x27;</span>,
          <span class="hljs-attr">display:</span> <span class="hljs-string">&#x27;flex&#x27;</span>,
          <span class="hljs-attr">flexDirection:</span> <span class="hljs-string">&#x27;column&#x27;</span>,
          <span class="hljs-attr">fontFamily:</span> <span class="hljs-string">&#x27;Source Sans Pro, sans-serif&#x27;</span>,
          <span class="hljs-attr">fontWeight:</span> <span class="hljs-number">400</span>,
        },
        <span class="hljs-string">&#x27;*:before, *:after&#x27;</span><span class="hljs-string">:</span> {
          <span class="hljs-attr">boxSizing:</span> <span class="hljs-string">&#x27;inherit&#x27;</span>,
        },
        <span class="hljs-attr">img:</span> {
          <span class="hljs-attr">maxWidth:</span> <span class="hljs-string">&#x27;100%&#x27;</span> <span class="hljs-string">/*</span> <span class="hljs-string">so</span> <span class="hljs-string">images</span> <span class="hljs-string">are</span> <span class="hljs-string">never</span> <span class="hljs-string">wider</span> <span class="hljs-string">than</span> <span class="hljs-string">the</span> <span class="hljs-string">page</span> <span class="hljs-string">*/</span>,
        },
        <span class="hljs-attr">&#x27;a:visited&#x27;:</span> {
          <span class="hljs-attr">textDecoration:</span> <span class="hljs-string">&#x27;none !important&#x27;</span>,
        },
        <span class="hljs-string">&#x27;#logo&#x27;</span><span class="hljs-string">:</span> {
          <span class="hljs-attr">textDecoration:</span> <span class="hljs-string">&#x27;none !important&#x27;</span>,
        },
      },
    },
    <span class="hljs-attr">MuiSvgIcon:</span> {
      <span class="hljs-attr">colorPrimary:</span> { <span class="hljs-attr">color:</span> <span class="hljs-string">OFFWHITE</span> },
      <span class="hljs-attr">colorSecondary:</span> { <span class="hljs-attr">color:</span> <span class="hljs-string">EGGPLANT</span> },
    },
    <span class="hljs-attr">MuiChip:</span> {
      <span class="hljs-attr">label:</span> { <span class="hljs-attr">color:</span> <span class="hljs-string">EGGPLANT</span> },
    },
    <span class="hljs-attr">MuiInput:</span> {
      <span class="hljs-attr">root:</span> { <span class="hljs-attr">border:</span> <span class="hljs-number">0</span> },
      <span class="hljs-attr">input:</span> { <span class="hljs-attr">userSelect:</span> <span class="hljs-string">&#x27;text&#x27;</span>, <span class="hljs-attr">color:</span> <span class="hljs-string">OFFWHITE</span>, <span class="hljs-attr">background:</span> <span class="hljs-string">EGGPLANT</span> },
      <span class="hljs-attr">underline:</span> {
        <span class="hljs-attr">borderBottom:</span> <span class="hljs-string">`1px</span> <span class="hljs-string">solid</span> <span class="hljs-string">$</span>{<span class="hljs-string">OFFWHITE</span>}<span class="hljs-string">`</span>,
        <span class="hljs-string">&#x27;&amp;&amp;&amp;&amp;:hover:before&#x27;</span><span class="hljs-string">:</span> { <span class="hljs-attr">borderBottom:</span> <span class="hljs-string">`1px</span> <span class="hljs-string">solid</span> <span class="hljs-string">$</span>{<span class="hljs-string">OFFWHITE</span>}<span class="hljs-string">`</span> },
        <span class="hljs-string">&#x27;&amp;&amp;&amp;&amp;:hover:after&#x27;</span><span class="hljs-string">:</span> { <span class="hljs-attr">borderBottom:</span> <span class="hljs-string">`1px</span> <span class="hljs-string">solid</span> <span class="hljs-string">$</span>{<span class="hljs-string">OFFWHITE</span>}<span class="hljs-string">`</span> },
        <span class="hljs-string">&#x27;&amp;:hover&#x27;</span><span class="hljs-string">:</span> { <span class="hljs-attr">borderBottom:</span> <span class="hljs-string">`1px</span> <span class="hljs-string">solid</span> <span class="hljs-string">$</span>{<span class="hljs-string">OFFWHITE</span>}<span class="hljs-string">`</span> },
        <span class="hljs-string">&#x27;&amp;:after&#x27;</span><span class="hljs-string">:</span> { <span class="hljs-attr">borderBottom:</span> <span class="hljs-string">`1px</span> <span class="hljs-string">solid</span> <span class="hljs-string">$</span>{<span class="hljs-string">OFFWHITE</span>}<span class="hljs-string">`</span> },
        <span class="hljs-string">&#x27;&amp;:selected&#x27;</span><span class="hljs-string">:</span> { <span class="hljs-attr">borderBottom:</span> <span class="hljs-string">`1px</span> <span class="hljs-string">solid</span> <span class="hljs-string">$</span>{<span class="hljs-string">OFFWHITE</span>}<span class="hljs-string">`</span> },
      },
    },
  }<span class="hljs-string">,</span>

  <span class="hljs-string">/*</span> <span class="hljs-string">Other</span> <span class="hljs-string">*/</span>
  <span class="hljs-attr">section:</span> { <span class="hljs-attr">marginLeft:</span> <span class="hljs-number">20</span>, <span class="hljs-attr">marginRight:</span> <span class="hljs-number">20</span> }<span class="hljs-string">,</span>
  <span class="hljs-attr">shape:</span> { <span class="hljs-attr">borderRadius:</span> <span class="hljs-number">0</span> }<span class="hljs-string">,</span>
<span class="hljs-string">})</span>
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrcutilsapi.js"><a href="#toc"><a name="ui-src-utils-api-js">ui/src/utils/api.js</a></a></h2>
<pre><code><span class="hljs-keyword">import</span> pDebounce <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;p-debounce&#x27;</span>
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> graphProcessor <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../components/Graph/graphProcessor&#x27;</span>

<span class="hljs-comment">/*
  NOTE 6/25/2021:
  Much of this file has become obsolete.
  The functionality for this has moved to Data/DataState.js and to the
  page components.
  It should be deleted once the graph component is migrated to API 2.0,
  as that should be the last item that still uses code in here.
*/</span>

<span class="hljs-comment">//login &amp; logout api utils</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">userLogin</span>(<span class="hljs-params">user, pass</span>) {
  <span class="hljs-keyword">const</span> route = <span class="hljs-string">&#x27;/session/login&#x27;</span>

  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(route, {
      <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,
      <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({
        <span class="hljs-attr">username</span>: user,
        <span class="hljs-attr">password</span>: pass,
      }),
      <span class="hljs-attr">headers</span>: { <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;application/json&#x27;</span> }
    })
    <span class="hljs-keyword">if</span> (!response.<span class="hljs-property">ok</span> || response.<span class="hljs-property">status</span> !== <span class="hljs-number">200</span>) <span class="hljs-keyword">throw</span> response

    <span class="hljs-keyword">const</span> json = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>()
    <span class="hljs-keyword">if</span> (json.<span class="hljs-property">response</span> !== <span class="hljs-literal">true</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;Error with JSON response.&#x27;</span>)

    <span class="hljs-keyword">return</span> json
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;userLogin error: &#x27;</span>, error)
    <span class="hljs-keyword">const</span> message = error.<span class="hljs-property">message</span> || error.<span class="hljs-property">statusText</span> || error.<span class="hljs-property">status</span> || <span class="hljs-literal">null</span>
    <span class="hljs-keyword">if</span> (message) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(message)
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">throw</span> error
  }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">callAuthAPI</span>(<span class="hljs-params">route</span>) {
  <span class="hljs-comment">//route can be /login or /logout</span>
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(route)
    <span class="hljs-keyword">if</span> (!response || !response.<span class="hljs-property">ok</span> || response.<span class="hljs-property">status</span> !== <span class="hljs-number">200</span>) <span class="hljs-keyword">throw</span> response

    <span class="hljs-keyword">const</span> json = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>()
    <span class="hljs-keyword">if</span> (!json) <span class="hljs-keyword">throw</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;No JSON from server.&#x27;</span>)
    <span class="hljs-keyword">if</span> (json <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Error</span>) <span class="hljs-keyword">throw</span> json

    <span class="hljs-keyword">return</span> json
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;callAuthAPI error: &#x27;</span>, error)
    <span class="hljs-keyword">const</span> message = error.<span class="hljs-property">message</span> || error.<span class="hljs-property">statusText</span> || error.<span class="hljs-property">status</span> || <span class="hljs-literal">null</span>
    <span class="hljs-keyword">if</span> (message) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(message)
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">throw</span> error
  }
}

<span class="hljs-comment">/////////////////////</span>

<span class="hljs-comment">//fetch search api util</span>
<span class="hljs-keyword">const</span> populateSearch = <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">searchTerm, route</span>) {
  <span class="hljs-comment">//route can be either &#x27;api/parcel-search/&#x27; or &#x27;api/be-search/&#x27;</span>
  <span class="hljs-keyword">if</span> (searchTerm === <span class="hljs-string">&#x27;&#x27;</span>) {
    <span class="hljs-keyword">return</span> []
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(route + <span class="hljs-built_in">encodeURIComponent</span>(searchTerm))
    <span class="hljs-keyword">const</span> json = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>()
    <span class="hljs-keyword">if</span> (response.<span class="hljs-property">status</span> !== <span class="hljs-number">200</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`An error occurred searching: <span class="hljs-subst">${json.message}</span>`</span>)
    }
    <span class="hljs-keyword">return</span> json
  }
}
<span class="hljs-comment">//debounce the search (we need unique pDebounce calls per search type)</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> debouncedPopulateOwnerSearch = <span class="hljs-title function_">pDebounce</span>(populateSearch, <span class="hljs-number">500</span>)
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> debouncedPopulateParcelSearch = <span class="hljs-title function_">pDebounce</span>(populateSearch, <span class="hljs-number">500</span>)

<span class="hljs-comment">////////////////////////////</span>

<span class="hljs-comment">//Fetch owner and parcel api utils</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getOwnerData</span>(<span class="hljs-params">searchTerm, businessEntity</span>) {
  <span class="hljs-keyword">if</span> (!businessEntity) <span class="hljs-keyword">return</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;Owner needs a business entity type.&#x27;</span>)
  <span class="hljs-keyword">const</span> entityType = businessEntity.<span class="hljs-title function_">toLowerCase</span>()
  <span class="hljs-keyword">if</span> (!entityType) <span class="hljs-keyword">return</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;Invalid business entity type.&#x27;</span>)

  <span class="hljs-keyword">const</span> route = <span class="hljs-string">`api/<span class="hljs-subst">${entityType}</span>/`</span>

  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`<span class="hljs-subst">${route}</span><span class="hljs-subst">${<span class="hljs-built_in">encodeURIComponent</span>(searchTerm)}</span>`</span>)
  <span class="hljs-keyword">if</span> (!response.<span class="hljs-property">ok</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-title class_">Error</span>(response.<span class="hljs-property">statusText</span>)
  }

  <span class="hljs-keyword">let</span> json = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>()

  <span class="hljs-keyword">let</span> mapData = []

  <span class="hljs-keyword">if</span> (json.<span class="hljs-property">networks</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
    json.<span class="hljs-property">networks</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">network</span>) =&gt;</span>
      mapData.<span class="hljs-title function_">push</span>({ ...network, <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;indirectly_currently_owned&#x27;</span> })
    )
  }

  <span class="hljs-keyword">if</span> (json.<span class="hljs-property">parcels_owned</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
    json.<span class="hljs-property">parcels_owned</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">parcel</span>) =&gt;</span>
      mapData.<span class="hljs-title function_">push</span>({ ...parcel, <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;directly_currently_owned&#x27;</span> })
    )
  }

  <span class="hljs-keyword">if</span> (json.<span class="hljs-property">evictions</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
    json.<span class="hljs-property">evictions</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">eviction</span>) =&gt;</span>
      mapData.<span class="hljs-title function_">push</span>({ ...eviction, <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;previously_evicted&#x27;</span> })
    )
  }

  <span class="hljs-comment">//added this filter to remove nulls from return</span>
  mapData = mapData.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">parcel</span>) =&gt;</span> {
    <span class="hljs-keyword">return</span> parcel.<span class="hljs-property">lat</span> !== <span class="hljs-literal">null</span>
  })

  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">ownerData</span>: json.<span class="hljs-property">be_details</span>,
    entityType,
    <span class="hljs-attr">parcelsOwned</span>: json.<span class="hljs-property">parcels_owned</span>,
    <span class="hljs-attr">evictions</span>: json.<span class="hljs-property">evictions</span>,
    <span class="hljs-attr">networkParcels</span>: json.<span class="hljs-property">networks</span>,
    mapData,
    searchTerm
  }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getParcelDetailsData</span>(<span class="hljs-params">blockLot</span>) {
  <span class="hljs-keyword">const</span> route = <span class="hljs-string">`api/parcel/<span class="hljs-subst">${<span class="hljs-built_in">encodeURIComponent</span>(blockLot)}</span>/details`</span>

  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(route)
  <span class="hljs-keyword">if</span> (!response.<span class="hljs-property">ok</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-title class_">Error</span>(response.<span class="hljs-property">statusText</span>)
  }

  <span class="hljs-keyword">const</span> parcelData = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>()

  <span class="hljs-keyword">const</span> parcel_details = parcelData.<span class="hljs-property">parcel_details</span>;

  <span class="hljs-comment">// format prices</span>
  [ <span class="hljs-string">&#x27;assess_land_val&#x27;</span>, <span class="hljs-string">&#x27;assess_imp_val&#x27;</span>, <span class="hljs-string">&#x27;curr_sales_price&#x27;</span> ].<span class="hljs-title function_">forEach</span>(
    <span class="hljs-function">(<span class="hljs-params">priceVal</span>) =&gt;</span> {
      parcel_details[priceVal] = parcel_details[priceVal]
        ? <span class="hljs-string">&#x27;$&#x27;</span> + parcel_details[priceVal].<span class="hljs-title function_">toLocaleString</span>()
        : <span class="hljs-literal">null</span>
    }
  )

  <span class="hljs-keyword">const</span> mapData = [
    {
      <span class="hljs-attr">lat</span>: parcel_details.<span class="hljs-property">lat</span>,
      <span class="hljs-attr">long</span>: parcel_details.<span class="hljs-property">long</span>,
      <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;Parcel Searched&#x27;</span>,
      <span class="hljs-attr">addr</span>: parcel_details.<span class="hljs-property">addr</span>,
    },
  ]

  <span class="hljs-keyword">return</span> {
    parcelData,
    mapData,
    blockLot
  }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getParcelEvictionsData</span>(<span class="hljs-params">blockLot</span>) {
  <span class="hljs-keyword">const</span> route = <span class="hljs-string">`api/parcel/<span class="hljs-subst">${<span class="hljs-built_in">encodeURIComponent</span>(blockLot)}</span>/evictions`</span>

  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(route)
  <span class="hljs-keyword">if</span> (!response.<span class="hljs-property">ok</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-title class_">Error</span>(response.<span class="hljs-property">statusText</span>)
  }

  <span class="hljs-keyword">const</span> parcelData = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>()

  <span class="hljs-keyword">return</span> {
    parcelData,
    blockLot
  }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getParcelNetworksData</span>(<span class="hljs-params">blockLot</span>) {
  <span class="hljs-keyword">const</span> route = <span class="hljs-string">`api/parcel/<span class="hljs-subst">${<span class="hljs-built_in">encodeURIComponent</span>(blockLot)}</span>/networks`</span>

  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(route)
  <span class="hljs-keyword">if</span> (!response.<span class="hljs-property">ok</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-title class_">Error</span>(response.<span class="hljs-property">statusText</span>)
  }

  <span class="hljs-keyword">const</span> parcelData = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>()


  <span class="hljs-keyword">const</span> mapData = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(parcelData.<span class="hljs-property">networks</span>).<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, networkId, index</span>) =&gt;</span> {
    <span class="hljs-keyword">return</span> acc = [ ...acc, ...parcelData.<span class="hljs-property">networks</span>[networkId].<span class="hljs-property">related_parcels</span>
      .<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">parcel</span>) =&gt;</span> {
        <span class="hljs-keyword">return</span> parcel.<span class="hljs-property">lat</span> !== <span class="hljs-literal">null</span>
      })
      .<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">parcel</span>) =&gt;</span> {
        <span class="hljs-keyword">return</span> {
          <span class="hljs-attr">lat</span>: parcel.<span class="hljs-property">lat</span>,
          <span class="hljs-attr">long</span>: parcel.<span class="hljs-property">long</span>,
          <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;Related Parcel&#x27;</span>,
          <span class="hljs-attr">addr</span>: parcel.<span class="hljs-property">addr</span>,
          <span class="hljs-attr">netId</span>: networkId,
        }
      }) ]
  }, [])

  <span class="hljs-keyword">return</span> {
    parcelData,
    mapData,
    blockLot
  }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getParcelOwnersData</span>(<span class="hljs-params">blockLot</span>) {
  <span class="hljs-keyword">const</span> route = <span class="hljs-string">`api/parcel/<span class="hljs-subst">${<span class="hljs-built_in">encodeURIComponent</span>(blockLot)}</span>/owners`</span>

  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(route)
  <span class="hljs-keyword">if</span> (!response.<span class="hljs-property">ok</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-title class_">Error</span>(response.<span class="hljs-property">statusText</span>)
  }

  <span class="hljs-keyword">const</span> parcelData = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>()

  <span class="hljs-keyword">return</span> {
    parcelData,
    blockLot
  }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getParcelMapData</span>(<span class="hljs-params">blockLot</span>) {
  <span class="hljs-keyword">const</span> route = <span class="hljs-string">`api/parcel/<span class="hljs-subst">${<span class="hljs-built_in">encodeURIComponent</span>(blockLot)}</span>`</span>

  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(route)
  <span class="hljs-keyword">if</span> (!response.<span class="hljs-property">ok</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-title class_">Error</span>(response.<span class="hljs-property">statusText</span>)
  }

  <span class="hljs-keyword">const</span> { networks, parcel_details } = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();

  <span class="hljs-comment">// format prices</span>
  [ <span class="hljs-string">&#x27;assess_land_val&#x27;</span>, <span class="hljs-string">&#x27;assess_imp_val&#x27;</span>, <span class="hljs-string">&#x27;curr_sales_price&#x27;</span> ].<span class="hljs-title function_">forEach</span>(
    <span class="hljs-function">(<span class="hljs-params">priceVal</span>) =&gt;</span> {
      parcel_details[priceVal] = parcel_details[priceVal]
        ? <span class="hljs-string">&#x27;$&#x27;</span> + parcel_details[priceVal].<span class="hljs-title function_">toLocaleString</span>()
        : <span class="hljs-literal">null</span>
    }
  )

  <span class="hljs-keyword">let</span> mapData = [
    {
      <span class="hljs-attr">lat</span>: parcel_details.<span class="hljs-property">lat</span>,
      <span class="hljs-attr">long</span>: parcel_details.<span class="hljs-property">long</span>,
      <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;Parcel Searched&#x27;</span>,
      <span class="hljs-attr">addr</span>: parcel_details.<span class="hljs-property">addr</span>,
    },
  ]

  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(networks).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">networkId, index</span>) =&gt;</span> {
    networks[networkId].<span class="hljs-property">related_parcels</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">parcel</span>) =&gt;</span> {
      mapData.<span class="hljs-title function_">push</span>({
        <span class="hljs-attr">lat</span>: parcel.<span class="hljs-property">lat</span>,
        <span class="hljs-attr">long</span>: parcel.<span class="hljs-property">long</span>,
        <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;Related Parcel&#x27;</span>,
        <span class="hljs-attr">addr</span>: parcel.<span class="hljs-property">addr</span>,
        <span class="hljs-attr">netId</span>: networkId,
      })
    })
  })
  <span class="hljs-comment">//added this filter to remove nulls from return</span>
  mapData = mapData.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">parcel</span>) =&gt;</span> {
    <span class="hljs-keyword">return</span> parcel.<span class="hljs-property">lat</span> !== <span class="hljs-literal">null</span>
  })

  <span class="hljs-keyword">return</span> {
    mapData,
    blockLot
  }
}

<span class="hljs-comment">//////////////////////////</span>

<span class="hljs-comment">//fetch graph data utils</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getNetworkGraphData</span>(<span class="hljs-params">
  searchType,
  searchTerm,
  searchNetwork,
  sizeFilter = <span class="hljs-number">50</span>,
</span>) {

  searchTerm = <span class="hljs-built_in">encodeURIComponent</span>(searchTerm)
  searchType = searchType.<span class="hljs-title function_">toLowerCase</span>()

  <span class="hljs-keyword">let</span> network_req
  <span class="hljs-keyword">if</span> (searchType === <span class="hljs-string">&#x27;parcel&#x27;</span> &amp;&amp; <span class="hljs-keyword">typeof</span> searchNetwork === <span class="hljs-string">&#x27;string&#x27;</span> &amp;&amp; searchNetwork.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
    network_req = <span class="hljs-string">`api/network/<span class="hljs-subst">${searchType}</span>/<span class="hljs-subst">${searchNetwork}</span>/<span class="hljs-subst">${searchTerm}</span>`</span>
  } <span class="hljs-keyword">else</span> {
    network_req = <span class="hljs-string">`api/network/<span class="hljs-subst">${searchType}</span>/<span class="hljs-subst">${searchTerm}</span>`</span>
  }

  <span class="hljs-keyword">const</span> response_network = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(network_req)
  <span class="hljs-keyword">if</span> (!response_network.<span class="hljs-property">ok</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-title class_">Error</span>(response_network.<span class="hljs-property">statusText</span>)
  }

  <span class="hljs-keyword">let</span> json_network = <span class="hljs-keyword">await</span> response_network.<span class="hljs-title function_">json</span>().<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(e))
  json_network.<span class="hljs-property">network_subgraph</span> = graphProcessor.<span class="hljs-title function_">get_view_network</span>(
    json_network,
    searchType,
    sizeFilter,
    <span class="hljs-number">5</span>
  )

  json_network.<span class="hljs-property">searchType</span> = searchType
  json_network.<span class="hljs-property">title</span> =
    json_network.<span class="hljs-property">searchType</span> === <span class="hljs-string">&#x27;parcel&#x27;</span>
      ? json_network.<span class="hljs-property">addr</span>
      : json_network.<span class="hljs-property">name_norm</span>

  <span class="hljs-keyword">return</span> json_network
}

<span class="hljs-comment">//fetch graph data utils</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getNeighborhoodData</span>(<span class="hljs-params">searchTerm</span>) {
  <span class="hljs-keyword">let</span> mapData = []
  <span class="hljs-keyword">let</span> summary = {
    <span class="hljs-attr">total</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">neighborhood</span>: searchTerm,
    <span class="hljs-attr">by_type</span>: {},
  }

  <span class="hljs-keyword">const</span> route = <span class="hljs-string">&#x27;api/neighborhood/&#x27;</span>

  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(
    <span class="hljs-string">`<span class="hljs-subst">${route}</span><span class="hljs-subst">${<span class="hljs-built_in">encodeURIComponent</span>(searchTerm).toLowerCase()}</span>`</span>
  )
  <span class="hljs-keyword">if</span> (!response.<span class="hljs-property">ok</span>) <span class="hljs-keyword">throw</span> <span class="hljs-title class_">Error</span>(response.<span class="hljs-property">statusText</span>)

  <span class="hljs-keyword">if</span> (response.<span class="hljs-property">status</span> === <span class="hljs-number">204</span>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">neighborhoodData</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-attr">summaryData</span>: summary,
      mapData,
      searchTerm
    }
  }

  <span class="hljs-keyword">let</span> json = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>()

  json.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">eviction</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> high_accuracy = !eviction.<span class="hljs-property">multiple_addr_matches</span>
    <span class="hljs-keyword">const</span> evict_type =
      eviction.<span class="hljs-property">type</span> === <span class="hljs-literal">null</span> ? <span class="hljs-string">&#x27;Eviction Type Unknown&#x27;</span> : eviction.<span class="hljs-property">type</span>

    <span class="hljs-keyword">if</span> (!(evict_type <span class="hljs-keyword">in</span> summary.<span class="hljs-property">by_type</span>)) {
      <span class="hljs-comment">// if eviction type is not already in summary, create it:</span>
      summary[<span class="hljs-string">&#x27;by_type&#x27;</span>][evict_type] = {
        <span class="hljs-attr">likely_count</span>: high_accuracy ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>,
        <span class="hljs-attr">possible_count</span>: high_accuracy ? <span class="hljs-number">0</span> : <span class="hljs-number">1</span>,
      }
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// else increment existing counts:</span>
      <span class="hljs-keyword">if</span> (high_accuracy) {
        summary[<span class="hljs-string">&#x27;by_type&#x27;</span>][evict_type][<span class="hljs-string">&#x27;likely_count&#x27;</span>] += <span class="hljs-number">1</span>
      } <span class="hljs-keyword">else</span> {
        summary[<span class="hljs-string">&#x27;by_type&#x27;</span>][evict_type][<span class="hljs-string">&#x27;possible_count&#x27;</span>] += <span class="hljs-number">1</span>
      }
    }

    mapData.<span class="hljs-title function_">push</span>({
      <span class="hljs-attr">lat</span>: eviction.<span class="hljs-property">lat</span>,
      <span class="hljs-attr">long</span>: eviction.<span class="hljs-property">long</span>,
      <span class="hljs-attr">block_lot</span>: eviction.<span class="hljs-property">block_lot</span>,
      evict_type,
      <span class="hljs-attr">evict_date</span>: eviction.<span class="hljs-property">evict_date</span>,
      <span class="hljs-attr">addr</span>: eviction.<span class="hljs-property">addr</span>,
      <span class="hljs-attr">multiple_sales_matches</span>: eviction.<span class="hljs-property">multiple_sales_matches</span>,
      <span class="hljs-attr">multiple_addr_matches</span>: eviction.<span class="hljs-property">multiple_addr_matches</span>,
    })
  })

  <span class="hljs-comment">// turn summary into array so react-table doesn&#x27;t throw up:</span>
  summary.<span class="hljs-property">by_type</span> = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(summary.<span class="hljs-property">by_type</span>), <span class="hljs-function">(<span class="hljs-params">type</span>) =&gt;</span> {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">evict_type</span>: type,
      ...summary[<span class="hljs-string">&#x27;by_type&#x27;</span>][type],
    }
  })

  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">neighborhoodData</span>: json,
    <span class="hljs-attr">summaryData</span>: summary,
    <span class="hljs-attr">mapData</span>: mapData,
    <span class="hljs-attr">searchTerm</span>: searchTerm
  }
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrcutilscsvformat.js"><a href="#toc"><a name="ui-src-utils-csvformat-js">ui/src/utils/csvFormat.js</a></a></h2>
<pre><code>import {
  Address,
  Owners,
  OwnerSameNetwork,
  OwnerMailingAddress,
  ProportionOwner,
  OwnerSince,
  NetworkAddress,
  NumUnits,
  Evictions,
  Neighborhood,
} from &#x27;./parcelFormat&#x27;
import {
  EvictDate,
  EvictId,
  EvictionLikelihood,
  Evictor,
  EvictType,
  SalesLikelihood,
} from &#x27;./evictionFormat&#x27;

<span class="hljs-keyword">function</span> <span class="hljs-constructor">ParcelEvictionsTable(<span class="hljs-params">evictions</span>)</span> {
  return(
    evictions.map(d =&gt; ({
      &#x27;Date&#x27;: <span class="hljs-constructor">EvictDate(<span class="hljs-params">d</span>)</span>,
      &#x27;Petition ID&#x27;: <span class="hljs-constructor">EvictId(<span class="hljs-params">d</span>)</span>,
      &#x27;Location Accuracy&#x27;: <span class="hljs-constructor">EvictionLikelihood(<span class="hljs-params">d</span>)</span>,
      &#x27;Evictor&#x27;: <span class="hljs-constructor">Evictor(<span class="hljs-params">d</span>)</span>,
      &#x27;Eviction Type&#x27;: <span class="hljs-constructor">EvictType(<span class="hljs-params">d</span>)</span>,
      &#x27;Evictor Accuracy&#x27;: <span class="hljs-constructor">SalesLikelihood(<span class="hljs-params">d</span>)</span>,
    }))
  )
}

<span class="hljs-keyword">function</span> <span class="hljs-constructor">RelatedParcelsTable(<span class="hljs-params">netId</span>, <span class="hljs-params">related_parcels</span>)</span> {
  return(
    related_parcels.map(d =&gt; ({
      &#x27;Parcel Address&#x27;: <span class="hljs-constructor">Address(<span class="hljs-params">d</span>)</span>,
      &#x27;<span class="hljs-constructor">Owner(<span class="hljs-params">s</span>)</span>&#x27;: <span class="hljs-constructor">Owners(<span class="hljs-params">d</span>)</span>,
      &#x27;Owner Part <span class="hljs-keyword">of</span> Same Network?&#x27;: <span class="hljs-constructor">OwnerSameNetwork(<span class="hljs-params">d</span>, <span class="hljs-params">netId</span>)</span>,
      &#x27;Owner Mailing Address&#x27;: <span class="hljs-constructor">OwnerMailingAddress(<span class="hljs-params">d</span>)</span>,
      &#x27;Network Address&#x27;: <span class="hljs-constructor">NetworkAddress(<span class="hljs-params">d</span>, <span class="hljs-params">netId</span>)</span>,
      &#x27;# <span class="hljs-keyword">of</span> Units&#x27;: <span class="hljs-constructor">NumUnits(<span class="hljs-params">d</span>)</span>,
      &#x27;Evictions Filed&#x27;: <span class="hljs-constructor">Evictions(<span class="hljs-params">d</span>)</span>
    }))
  )
}

<span class="hljs-keyword">function</span> <span class="hljs-constructor">OwnerViewEvictionsTable(<span class="hljs-params">evictions</span>)</span> {
  return(
    evictions.map(d=&gt; ({
      &#x27;Location&#x27;: <span class="hljs-constructor">Address(<span class="hljs-params">d</span>)</span>,
      &#x27;Date&#x27;: <span class="hljs-constructor">EvictDate(<span class="hljs-params">d</span>)</span>,
      &#x27;Eviction Type&#x27;: <span class="hljs-constructor">EvictType(<span class="hljs-params">d</span>)</span>,
      &#x27;Neighborhood&#x27;: <span class="hljs-constructor">Neighborhood(<span class="hljs-params">d</span>)</span>,
      &#x27;# <span class="hljs-keyword">of</span> Units&#x27;: <span class="hljs-constructor">NumUnits(<span class="hljs-params">d</span>)</span>,
      &#x27;Location Accuracy&#x27;: <span class="hljs-constructor">EvictionLikelihood(<span class="hljs-params">d</span>)</span>,
      &#x27;Evictor Accuracy&#x27;: <span class="hljs-constructor">SalesLikelihood(<span class="hljs-params">d</span>)</span>
    }))
  )
}


<span class="hljs-keyword">function</span> <span class="hljs-constructor">OwnerViewParcelTable(<span class="hljs-params">parcels</span>)</span>{
  return(
    parcels.map(d=&gt; ({
      &#x27;Location&#x27;: <span class="hljs-constructor">Address(<span class="hljs-params">d</span>)</span>,
      &#x27;Neighborhood&#x27;: <span class="hljs-constructor">Neighborhood(<span class="hljs-params">d</span>)</span>,
      &#x27;# <span class="hljs-keyword">of</span> Units&#x27;: <span class="hljs-constructor">NumUnits(<span class="hljs-params">d</span>)</span>,
      &#x27;Proportion Ownership&#x27;: <span class="hljs-constructor">ProportionOwner(<span class="hljs-params">d</span>)</span>,
      &#x27;Owner Since&#x27;: <span class="hljs-constructor">OwnerSince(<span class="hljs-params">d</span>)</span>,
      &#x27;Evictions Filed&#x27;: <span class="hljs-constructor">Evictions(<span class="hljs-params">d</span>)</span>
    }))
  )
}


export {
  ParcelEvictionsTable,
  RelatedParcelsTable,
  OwnerViewEvictionsTable,
  OwnerViewParcelTable
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrcutilsdatautils.js"><a href="#toc"><a name="ui-src-utils-datautils-js">ui/src/utils/dataUtils.js</a></a></h2>
<pre><code><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, {useRef, useEffect} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>
<span class="hljs-keyword">import</span> { titleCase } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./stringUtils&#x27;</span>

<span class="hljs-comment">/* Functions to improve readability and consistency with loading and error state */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">applyDefaultPendingState</span> = state =&gt; <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(state, { <span class="hljs-attr">loading</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">error</span>: <span class="hljs-literal">false</span> })
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">applyDefaultRejectedState</span> = (<span class="hljs-params">state, action</span>) =&gt; {
  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(state, { <span class="hljs-attr">error</span>: action?.<span class="hljs-property">payload</span>?.<span class="hljs-property">error</span>, <span class="hljs-attr">loading</span>: <span class="hljs-literal">false</span> })
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(action?.<span class="hljs-property">payload</span>?.<span class="hljs-property">error</span>)
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">applyDefaultFulfilledState</span> = state =&gt; <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(state, { <span class="hljs-attr">loading</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">error</span>: <span class="hljs-literal">false</span> })

<span class="hljs-comment">/* Functions to improve readability with data validation */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">isNull</span> = x =&gt; x === <span class="hljs-literal">undefined</span> || x === <span class="hljs-literal">null</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">isNotString</span> = x =&gt; <span class="hljs-title function_">isNull</span>(x) || <span class="hljs-keyword">typeof</span> x !== <span class="hljs-string">&#x27;string&#x27;</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">isNotArray</span> = x =&gt; <span class="hljs-title function_">isNull</span>(x) || !<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(x)
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">isNotObject</span> = x =&gt; <span class="hljs-title function_">isNull</span>(x) || <span class="hljs-keyword">typeof</span> x !== <span class="hljs-string">&#x27;object&#x27;</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">isEmpty</span> = x =&gt; {
  <span class="hljs-keyword">const</span> isArray = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(x)
  <span class="hljs-keyword">const</span> isObject = <span class="hljs-keyword">typeof</span> x === <span class="hljs-string">&#x27;object&#x27;</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isNull</span>(x)) { <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span> }
  <span class="hljs-keyword">if</span> (isArray &amp;&amp; x.<span class="hljs-property">length</span> &lt;= <span class="hljs-number">0</span>) { <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span> }
  <span class="hljs-keyword">if</span> (isObject &amp;&amp; <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(x).<span class="hljs-property">length</span> &lt;= <span class="hljs-number">0</span>) { <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span> }
  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
}

<span class="hljs-comment">/* Helper function to determine indefinite article */</span>
<span class="hljs-comment">/* This is idiomatic English that can&#x27;t be computed logically */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">beStatusIndefiniteArticle</span> = status =&gt; {
  <span class="hljs-keyword">switch</span> (status) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;SOS/FTB Suspended/Forfeited&#x27;</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;Active&#x27;</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;Inactive&#x27;</span>: <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;an&#x27;</span>
    <span class="hljs-attr">default</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;a&#x27;</span>
  }
}

<span class="hljs-comment">/* Logic to determine equality from primary and secondary data sources */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">compareState</span> = (<span class="hljs-params">primary, secondary</span>) =&gt; {
  <span class="hljs-keyword">return</span> ({ <span class="hljs-attr">isEqual</span>: primary === secondary })
}

<span class="hljs-comment">/* Helper function to create a comma separated string from an array, 
 * with each item bolded. 
 *
 * Returns: JSX element 
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">commaSeparatedBolded</span> = list =&gt; list?.<span class="hljs-title function_">map</span>(
  <span class="hljs-function">(<span class="hljs-params">x,i,a</span>) =&gt;</span>
    <span class="hljs-keyword">typeof</span> x === <span class="hljs-string">&#x27;string&#x27;</span> &amp;&amp; x.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span> &amp;&amp;
      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{i}</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{fontWeight:</span> &#x27;<span class="hljs-attr">bold</span>&#x27;}}&gt;</span>{titleCase(x)}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
        {
          i === (a.length - 2)
            ? <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>,<span class="hljs-symbol">&amp;nbsp;</span>and<span class="hljs-symbol">&amp;nbsp;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            : i &lt; (a.length - 1) ? <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>,<span class="hljs-symbol">&amp;nbsp;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span> : null
        }
      <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span>
)

<span class="hljs-comment">/* Helper function to create a comma separated string from an array 
 * 
 * Returns: String
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">commaSeparatedText</span> = list =&gt; list?.<span class="hljs-title function_">map</span>(
  <span class="hljs-function">(<span class="hljs-params">x,i,a</span>) =&gt;</span>
    <span class="hljs-keyword">typeof</span> x === <span class="hljs-string">&#x27;string&#x27;</span> &amp;&amp; x.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span> &amp;&amp;
    <span class="hljs-title function_">titleCase</span>(x) + (i === (a.<span class="hljs-property">length</span> - <span class="hljs-number">2</span>) ? <span class="hljs-string">&#x27; and &#x27;</span> : i &lt; (a.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>) ? <span class="hljs-string">&#x27;, &#x27;</span> : <span class="hljs-string">&#x27;&#x27;</span>)
).<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27;&#x27;</span>)

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">stableSort</span> = (<span class="hljs-params">arr, compare</span>) =&gt; arr
  .<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item, index</span>) =&gt;</span> ({item, index}))
  .<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> <span class="hljs-title function_">compare</span>(a.<span class="hljs-property">item</span>, b.<span class="hljs-property">item</span>) || a.<span class="hljs-property">index</span> - b.<span class="hljs-property">index</span>)
  .<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">{item}</span>) =&gt;</span> item)

<span class="hljs-comment">/* taken from https://usehooks.com/useMemoCompare/ */</span> 
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">useMemoCompare</span> = (<span class="hljs-params">next, compare</span>) =&gt; {
  <span class="hljs-comment">// Ref for storing previous value</span>
  <span class="hljs-keyword">const</span> previousRef = <span class="hljs-title function_">useRef</span>()
  <span class="hljs-keyword">const</span> previous = previousRef.<span class="hljs-property">current</span>
  <span class="hljs-comment">// Pass previous and next value to compare function</span>
  <span class="hljs-comment">// to determine whether to consider them equal.</span>
  <span class="hljs-keyword">const</span> isEqual = <span class="hljs-title function_">compare</span>(previous, next)
  <span class="hljs-comment">// If not equal update previousRef to next value.</span>
  <span class="hljs-comment">// We only update if not equal so that this hook continues to return</span>
  <span class="hljs-comment">// the same old value if compare keeps returning true.</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (!isEqual) {
      previousRef.<span class="hljs-property">current</span> = next
    }
  })
  <span class="hljs-comment">// Finally, if equal then return the previous value</span>
  <span class="hljs-keyword">return</span> isEqual ? previous : next
}</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrcutilsevictionformat.js"><a href="#toc"><a name="ui-src-utils-evictionformat-js">ui/src/utils/evictionFormat.js</a></a></h2>
<pre><code>import { reformatDate, titleCase } from &#x27;./stringUtils.js&#x27;

<span class="hljs-keyword">function</span> <span class="hljs-title">EvictDate</span>(d) {
  <span class="hljs-keyword">return</span> <span class="hljs-type">(d.evict_date</span> ? reformatDate(d.evict_date) : &#x27;<span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-type">available</span>&#x27;)
}
<span class="hljs-keyword">function</span> <span class="hljs-title">EvictId</span>(d) {
  <span class="hljs-keyword">return</span> <span class="hljs-type">(d.evict_id)</span>
}
<span class="hljs-keyword">function</span> <span class="hljs-title">EvictionLikelihood</span>(d) {
  <span class="hljs-keyword">return</span> <span class="hljs-type">(d.multiple_addr_matches</span> ? <span class="hljs-symbol">&#x27;Low</span>&#x27; : &#x27;<span class="hljs-type">High</span>&#x27;)
}
<span class="hljs-keyword">function</span> <span class="hljs-title">Evictor</span>(d) {
  <span class="hljs-keyword">return</span> <span class="hljs-type">(d.linked_be</span>
    ? titleCase(d.linked_be.name_norm)
    : <span class="hljs-type">titleCase</span>(d.name))
}
<span class="hljs-keyword">function</span> <span class="hljs-title">EvictType</span>(d) {
  <span class="hljs-keyword">return</span> <span class="hljs-type">(!d.type</span> ? <span class="hljs-symbol">&#x27;Not</span> recorded&#x27; : <span class="hljs-type">d.type</span>)
}
<span class="hljs-keyword">function</span> <span class="hljs-title">SalesLikelihood</span>(d) {
  <span class="hljs-keyword">return</span> <span class="hljs-type">(d.multiple_sales_matches</span> ? <span class="hljs-symbol">&#x27;Low</span>&#x27; : &#x27;<span class="hljs-type">High</span>&#x27;)
}

export {
  EvictDate,
  EvictId,
  EvictionLikelihood,
  Evictor,
  EvictType,
  SalesLikelihood
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrcutilsiconsinit.js"><a href="#toc"><a name="ui-src-utils-iconsinit-js">ui/src/utils/iconsInit.js</a></a></h2>
<pre><code><span class="hljs-attribute">import { library } from &#x27;@fortawesome/fontawesome-svg-core&#x27;

import {
  faHome,
  faBars,
  faPlus,
  faMinus,
  faSearch,
  faAngleDown,
  faAngleLeft,
  faAngleRight,
  faPhone,
  faGlobe,
  faPrint,
  faSave,
  faMapMarker,
  faSpinner,
  faBuilding,
  faUserTie
} from &#x27;@fortawesome/free-solid-svg-icons&#x27;

const appIcons = {
  home</span><span class="hljs-punctuation">:</span> <span class="hljs-string">faHome,</span>
  <span class="hljs-attribute">hamburgerBars</span><span class="hljs-punctuation">:</span> <span class="hljs-string">faBars,</span>
  <span class="hljs-attribute">plus</span><span class="hljs-punctuation">:</span> <span class="hljs-string">faPlus,</span>
  <span class="hljs-attribute">minus</span><span class="hljs-punctuation">:</span> <span class="hljs-string">faMinus,</span>
  <span class="hljs-attribute">search</span><span class="hljs-punctuation">:</span> <span class="hljs-string">faSearch,</span>
  <span class="hljs-attribute">angleDown</span><span class="hljs-punctuation">:</span> <span class="hljs-string">faAngleDown,</span>
  <span class="hljs-attribute">angleLeft</span><span class="hljs-punctuation">:</span> <span class="hljs-string">faAngleLeft,</span>
  <span class="hljs-attribute">angleRight</span><span class="hljs-punctuation">:</span> <span class="hljs-string">faAngleRight,</span>
  <span class="hljs-attribute">phone</span><span class="hljs-punctuation">:</span> <span class="hljs-string">faPhone,</span>
  <span class="hljs-attribute">globe</span><span class="hljs-punctuation">:</span> <span class="hljs-string">faGlobe,</span>
  <span class="hljs-attribute">print</span><span class="hljs-punctuation">:</span> <span class="hljs-string">faPrint,</span>
  <span class="hljs-attribute">save</span><span class="hljs-punctuation">:</span> <span class="hljs-string">faSave,</span>
  <span class="hljs-attribute">mapMarker</span><span class="hljs-punctuation">:</span> <span class="hljs-string">faMapMarker,</span>
  <span class="hljs-attribute">spinner</span><span class="hljs-punctuation">:</span> <span class="hljs-string">faSpinner,</span>
  <span class="hljs-attribute">building</span><span class="hljs-punctuation">:</span> <span class="hljs-string">faBuilding,</span>
  <span class="hljs-attribute">landlord</span><span class="hljs-punctuation">:</span> <span class="hljs-string">faUserTie</span>
}

//add them to the library to be used in all components
//import this script in the App component
Object.values(appIcons).map(icon =&gt; library.add(icon))
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrcutilsmaterialutils.js"><a href="#toc"><a name="ui-src-utils-materialutils-js">ui/src/utils/materialUtils.js</a></a></h2>
<pre><code><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Link</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">RouterLink</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-router-dom&#x27;</span>
<span class="hljs-keyword">import</span> { titleCase } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./stringUtils&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Link</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/Link&#x27;</span>

<span class="hljs-comment">/* MUI-specific implementation for the &quot;DataGrid&quot; component ONLY */</span>
<span class="hljs-comment">/* IT WILL NOT WORK with anything else */</span>
<span class="hljs-comment">/* see more: https://material-ui.com/components/data-grid/rendering/#value-getter */</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">MaterialParcelLink</span>(<span class="hljs-params">params</span>) {
  <span class="hljs-keyword">const</span> addr = params.<span class="hljs-property">row</span>.<span class="hljs-property">addr</span>
  <span class="hljs-keyword">const</span> block_lot = params.<span class="hljs-property">row</span>.<span class="hljs-property">block_lot</span>

  <span class="hljs-keyword">return</span> (
    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Link</span> 
      <span class="hljs-attr">to</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">pathname:</span> &#x27;/<span class="hljs-attr">parcel</span>&#x27;, <span class="hljs-attr">search:</span> `?<span class="hljs-attr">bl</span>=<span class="hljs-string">${encodeURIComponent(block_lot)}</span>` }}
      <span class="hljs-attr">component</span>=<span class="hljs-string">{RouterLink}</span>&gt;</span>
      {titleCase(addr)}
    <span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span></span>
  )
}</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrcutilsparcelformat.js"><a href="#toc"><a name="ui-src-utils-parcelformat-js">ui/src/utils/parcelFormat.js</a></a></h2>
<pre><code>import { titleCase, reformatDate } from &#x27;./stringUtils.js&#x27;

<span class="hljs-keyword">function</span> <span class="hljs-title">Address</span>(d) {
  <span class="hljs-keyword">return</span> <span class="hljs-type">(</span> titleCase(d.addr) )
}
<span class="hljs-keyword">function</span> <span class="hljs-title">Owners</span>(d) {
  <span class="hljs-keyword">return</span> <span class="hljs-type">(d.owners.map(owner</span> =&gt; titleCase(owner.owner_name)))
}
<span class="hljs-keyword">function</span> <span class="hljs-title">OwnerSameNetwork</span>(d, netId) {
  <span class="hljs-keyword">return</span> <span class="hljs-type">(d.owners.map(owner</span> =&gt;
    owner.linked_be ? (owner.linked_be.network_id === netId ? <span class="hljs-symbol">&#x27;Yes</span>&#x27; : &#x27;<span class="hljs-type">No</span>&#x27;) : &#x27;<span class="hljs-type">No</span>&#x27;))
}
<span class="hljs-keyword">function</span> <span class="hljs-title">OwnerMailingAddress</span>(d) {
  <span class="hljs-keyword">return</span> <span class="hljs-type">(d.owners.map(owner</span> =&gt; titleCase(owner.mailing_address)))
}
<span class="hljs-keyword">function</span> <span class="hljs-title">ProportionOwner</span>(d) {
  <span class="hljs-keyword">return</span> <span class="hljs-type">d.perc_owner</span> !== null ? d.perc_owner.toFixed(<span class="hljs-number">0</span>) + <span class="hljs-string">&#x27;%&#x27;</span> : &#x27;(<span class="hljs-type">unknown</span>)&#x27;
}
<span class="hljs-keyword">function</span> <span class="hljs-title">OwnerSince</span>(d) {
  <span class="hljs-keyword">return</span> <span class="hljs-type">d.record_date</span> !== null ? reformatDate(d.record_date) : &#x27;(<span class="hljs-type">unknown</span>)&#x27;
}
<span class="hljs-keyword">function</span> <span class="hljs-title">NetworkAddress</span>(d, netId) {
  <span class="hljs-keyword">return</span> <span class="hljs-type">(d.possible_networks[netId].map(addr</span> =&gt; titleCase(addr)))
}
<span class="hljs-keyword">function</span> <span class="hljs-title">NumUnits</span>(d) {
  <span class="hljs-keyword">return</span> <span class="hljs-type">(d.units</span> + &#x27;  unit&#x27; + (d.units &gt; <span class="hljs-number">1</span> ? <span class="hljs-string">&#x27;s&#x27;</span> : &#x27;&#x27;))
}
<span class="hljs-keyword">function</span> <span class="hljs-title">Evictions</span>(d) {
  <span class="hljs-keyword">return</span> <span class="hljs-type">d.num_evictions</span> !== null ? (d.num_evictions + &#x27; filed&#x27;) : &#x27;(<span class="hljs-type">unknown</span>)&#x27;
}
<span class="hljs-keyword">function</span> <span class="hljs-title">Neighborhood</span>(d) {
  <span class="hljs-keyword">return</span> <span class="hljs-type">d.neighborhood</span> !== null ? titleCase(d.neighborhood) : &#x27;(<span class="hljs-type">unknown</span>)&#x27;
}



export {
  Address,
  Owners,
  OwnerSameNetwork,
  OwnerMailingAddress,
  ProportionOwner,
  OwnerSince,
  NetworkAddress,
  NumUnits,
  Evictions,
  Neighborhood,
}

</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrcutilspropertyclass.js"><a href="#toc"><a name="ui-src-utils-propertyclass-js">ui/src/utils/propertyClass.js</a></a></h2>
<pre><code>// cf. https://data.sfgov.org/resource/pa56-ek2h.json
const propertyClasses =
  [
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;MRES&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Multi-Family Residential&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;A&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Apartment&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;MRES&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Multi-Family Residential&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;A15&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Apartment 15 Units or more &#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;MRES&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Multi-Family Residential&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;A5&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Apartment 5 to 14 Units&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;COMM&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Commercial Misc&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;AC&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Apartmnt &amp; Commercial Store&#x27;</span>
    },
    { <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;COMR&#x27;</span>, <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Commercial Retail&#x27;</span>, <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;B&#x27;</span>, <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Bank&#x27;</span> },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;COMR&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Commercial Retail&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;BZ&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Bank Condominium&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;COMR&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Commercial Retail&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;C&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Commercial Stores&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;COMR&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Commercial Retail&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;C1&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Shopping Center&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;COMR&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Commercial Retail&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;CD&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Commercial Department Stores&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;COMR&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Commercial Retail&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;CM&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Commercial/Mixed use&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;MRES&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Multi-Family Residential&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;CO&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Coop Units Unsegregated&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;SRES&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Single Family Residential&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;COS&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Coop Units Segregated&#x27;</span>
    },
    { <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;GOVT&#x27;</span>, <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Government&#x27;</span>, <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;CP&#x27;</span>, <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;City Property&#x27;</span> },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;COMR&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Commercial Retail&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;CZ&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Commercial Store Condo&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;SRES&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Single Family Residential&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;D&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Dwelling&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;MRES&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Multi-Family Residential&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;DA&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Dwellings - Apartments&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;MRES&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Multi-Family Residential&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;DA15&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Dwellings - Apt 15 units or more &#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;MRES&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Multi-Family Residential&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;DA5&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Dwellings - Apt 5 to 14 units &#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;SRES&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Single Family Residential&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;DBM&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Dwelling BMR&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;MRES&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Multi-Family Residential&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;DCON&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Legal Multi-Family Con to SFR &#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;MRES&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Multi-Family Residential&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;DD&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;2 Dwellings on One Parcel&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;MRES&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Multi-Family Residential&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;DD5&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;2 Dwellings on 1 Parcel 5 to 14 units &#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;MRES&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Multi-Family Residential&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;DF&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;1 Flat &amp; Dwelling-1 Parcel&#x27;</span>
    },
    { <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;COMM&#x27;</span>, <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Commercial Misc&#x27;</span>, <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;E&#x27;</span>, <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Schools&#x27;</span> },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;COMR&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Commercial Retail&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;EC&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Entertainment Complex&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;MRES&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Multi-Family Residential&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;F&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Flats &amp; Duplex&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;MRES&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Multi-Family Residential&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;F15&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Flats 15 units +&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;MRES&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Multi-Family Residential&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;F2&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Flat &amp; Store&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;MRES&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Multi-Family Residential&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;F5&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Flats 5 to 14 units &#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;MRES&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Multi-Family Residential&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;FA&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;1 Flat &amp; 1 Apt Bldg-1 Parcel&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;MRES&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Multi-Family Residential&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;FA5&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;1 Flat &amp; 1 Apt - 1 Parcel 5 to 14 units &#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;MRES&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Multi-Family Residential&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;FS&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Flat &amp; Store 4 units or less&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;MRES&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Multi-Family Residential&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;FS15&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Flat &amp; Store 15 units +&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;MRES&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Multi-Family Residential&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;FS5&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Flat &amp; Store 5 to 14 units&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;COMM&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Commercial Misc&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;G&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Garages (Commercial)&#x27;</span>
    },
    { <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;COMM&#x27;</span>, <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Commercial Misc&#x27;</span>, <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;GC&#x27;</span>, <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Golf Course&#x27;</span> },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;COMM&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Commercial Misc&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;GCU         &#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Golf Course                             &#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;COMM&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Commercial Misc&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;GZ&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Garage Condominium&#x27;</span>
    },
    { <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;COMH&#x27;</span>, <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Commercial Hotel&#x27;</span>, <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;H&#x27;</span>, <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Hotel&#x27;</span> },
    { <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;COMH&#x27;</span>, <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Commercial Hotel&#x27;</span>, <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;H1&#x27;</span>, <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Hotel&#x27;</span> },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;COMH&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Commercial Hotel&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;H2&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Hotels - Other&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;COMH&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Commercial Hotel&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;HC&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Hotel Commercial (H2w/Com)&#x27;</span>
    },
    { <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;IND&#x27;</span>, <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Industrial&#x27;</span>, <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;I&#x27;</span>, <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Industrial&#x27;</span> },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;IND&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Industrial&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;IDC&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Industrial Data Center&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;IND&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Industrial&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;IW&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Industial Warehouse&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;IND&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Industrial&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;IX&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Industrial Mixed/Other Use&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;IND&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Industrial&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;IZ&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Industrial Condominium&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;SRES&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Single Family Residential&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;LZ&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Live/Work Condominium&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;SRES&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Single Family Residential&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;LZBM&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Live/Work Condominium BMR&#x27;</span>
    },
    { <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;COMH&#x27;</span>, <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Commercial Hotel&#x27;</span>, <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;M&#x27;</span>, <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Motels&#x27;</span> },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;MISC&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Miscellaneous/Mixed-Use&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;MB&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Mission Bay&#x27;</span>
    },
    { <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;COMM&#x27;</span>, <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Commercial Misc&#x27;</span>, <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;MIX&#x27;</span>, <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Mixed use&#x27;</span> },
    { <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;COMM&#x27;</span>, <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Commercial Misc&#x27;</span>, <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;N1&#x27;</span>, <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Hospitals&#x27;</span> },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;COMM&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Commercial Misc&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;N2&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Convalescent/Nursing Homes&#x27;</span>
    },
    { <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;COMO&#x27;</span>, <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Commercial Office&#x27;</span>, <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Office&#x27;</span> },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;COMO&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Commercial Office&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;O35&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Office Portion Leased of 35 or More &#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;MRES&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Multi-Family Residential&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;OA&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Office and Apartments&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;MRES&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Multi-Family Residential&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;OA15&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Office and Apartments 15 units +&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;MRES&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Multi-Family Residential&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;OA5&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Office and Apartments 5 to 14 units&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;COMO&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Commercial Office&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;OAH&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Office - High Class A&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;COMO&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Commercial Office&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;OAL         &#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Office - Low Class A                     &#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;COMO&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Commercial Office&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;OAT&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Office - &quot;Trophy&quot; Class A&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;COMO&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Commercial Office&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;OBH&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Office - High Class B&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;COMO&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Commercial Office&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;OBM&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Office - Middle Class B&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;COMR&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Commercial Retail&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;OC&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Office with Major Retail Units&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;COMO&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Commercial Office&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;OCH&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Office - High Class C&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;COMO&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Commercial Office&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;OCL&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Office - Low Class C&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;COMO&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Commercial Office&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;OCM&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Office - Middle Class C&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;COMO&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Commercial Office&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;OMD&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Medical- dental Office Building&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;COMO&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Commercial Office&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;OZ&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Office - Condominium&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;SRES&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Single Family Residential&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;OZEU&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Office Condo Economic Unit &#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;GOVT&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Government&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;P&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Public Buildings (Govt)&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;COMM&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Commercial Misc&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;PD&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;PUD (Planned Unit Development)&#x27;</span>
    },
    { <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;COMM&#x27;</span>, <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Commercial Misc&#x27;</span>, <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;PL&#x27;</span>, <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Parking Lot&#x27;</span> },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;COMM&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Commercial Misc&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;PZ&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Parking Stall Condominium&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;GOVT&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Government&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;RDAP&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Redevelopment Agency Property&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;COMH&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Commercial Hotel&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;RH&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Residential Hotel &amp; SRO&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;COMH&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Commercial Hotel&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;RH1&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Retail &amp; Hotel&#x27;</span>
    },
    { <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;COMM&#x27;</span>, <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Commercial Misc&#x27;</span>, <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;S&#x27;</span>, <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Gas Station&#x27;</span> },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;GOVT&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Government&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;SP&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;State of California Property&#x27;</span>
    },
    { <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;COMM&#x27;</span>, <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Commercial Misc&#x27;</span>, <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;T&#x27;</span>, <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Theatres&#x27;</span> },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;SRES&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Single Family Residential&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;TH&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Town House&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;SRES&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Single Family Residential&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;THBM&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Town House BMR&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;MRES&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Multi-Family Residential&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;TI15&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;TIC Bldg 15 units + &#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;MRES&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Multi-Family Residential&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;TIA&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;TI Apartment&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;MRES&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Multi-Family Residential&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;TIC&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;TIC Bldg 4 units or less &#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;MRES&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Multi-Family Residential&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;TIC5        &#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;TIC Bldg 5 to 14 units                  &#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;MRES&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Multi-Family Residential&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;TIF&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;TI Flats &amp; Duplex&#x27;</span>
    },
    { <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;COMM&#x27;</span>, <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Commercial Misc&#x27;</span>, <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;TS&#x27;</span>, <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Timeshare&#x27;</span> },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;COMM&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Commercial Misc&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;TSF&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Time Share Fractional&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;COMM&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Commercial Misc&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;TSU&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Time Share Unsegregated&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;COMM&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Commercial Misc&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;U&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Clubs,Lodges,Fraternal Organizations&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;GOVT&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Government&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;UCP&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;University of California Property&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;GOVT&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Government&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;USP&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;U.S. Government Property&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;MISC&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Miscellaneous/Mixed-Use&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;UWL&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Under Water Lot&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;MISC&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Miscellaneous/Mixed-Use&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;V&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Vacant Lot&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;MISC&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Miscellaneous/Mixed-Use&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;VA15&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Vacant land- residential 15+ units &#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;MISC&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Miscellaneous/Mixed-Use&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;VCI&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Vacant Lot Comm and Ind &#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;MISC&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Miscellaneous/Mixed-Use&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;VCIX        &#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Vacant Lot Comm and Ind w/ Restriction   &#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;MISC&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Miscellaneous/Mixed-Use&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;VPUB&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Vacant Lot Public Use&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;MISC&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Miscellaneous/Mixed-Use&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;VR&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Vacant Lot - Restrictions&#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;MISC&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Miscellaneous/Mixed-Use&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;VRX&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Vacant Lot Residential w/ Restriction &#x27;</span>
    },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;COMM&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Commercial Misc&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;W&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Churches,Convents,Rectories&#x27;</span>
    },
    { <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;MISC&#x27;</span>, <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Miscellaneous/Mixed-Use&#x27;</span>, <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;X&#x27;</span>, <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Misc&#x27;</span> },
    {
      <span class="hljs-string">&#x27;use_code&#x27;</span>: <span class="hljs-string">&#x27;MRES&#x27;</span>,
      <span class="hljs-string">&#x27;use_definition&#x27;</span>: <span class="hljs-string">&#x27;Multi-Family Residential&#x27;</span>,
      <span class="hljs-string">&#x27;class_code&#x27;</span>: <span class="hljs-string">&#x27;XV&#x27;</span>,
      <span class="hljs-string">&#x27;class_definition&#x27;</span>: <span class="hljs-string">&#x27;Single Struct on Multi Lot(D &amp; F\&#x27;</span>s <span class="hljs-keyword">only</span>)<span class="hljs-string">&#x27;
    },
    {
      &#x27;</span>use_cod<span class="hljs-string">e&#x27;: &#x27;</span>GOVT<span class="hljs-string">&#x27;,
      &#x27;</span>use_definition<span class="hljs-string">&#x27;: &#x27;</span>Government<span class="hljs-string">&#x27;,
      &#x27;</span>class_cod<span class="hljs-string">e&#x27;: &#x27;</span>Y<span class="hljs-string">&#x27;,
      &#x27;</span>class_definition<span class="hljs-string">&#x27;: &#x27;</span>Port Commission Property<span class="hljs-string">&#x27;
    },
    {
      &#x27;</span>use_cod<span class="hljs-string">e&#x27;: &#x27;</span>SRES<span class="hljs-string">&#x27;,
      &#x27;</span>use_definition<span class="hljs-string">&#x27;: &#x27;</span>Single <span class="hljs-keyword">Family</span> Residential<span class="hljs-string">&#x27;,
      &#x27;</span>class_cod<span class="hljs-string">e&#x27;: &#x27;</span>Z<span class="hljs-string">&#x27;,
      &#x27;</span>class_definition<span class="hljs-string">&#x27;: &#x27;</span>Condominium<span class="hljs-string">&#x27;
    }, {
      &#x27;</span>use_cod<span class="hljs-string">e&#x27;: &#x27;</span>SRES<span class="hljs-string">&#x27;,
      &#x27;</span>use_definition<span class="hljs-string">&#x27;: &#x27;</span>Single <span class="hljs-keyword">Family</span> Residential<span class="hljs-string">&#x27;,
      &#x27;</span>class_cod<span class="hljs-string">e&#x27;: &#x27;</span>ZBM<span class="hljs-string">&#x27;,
      &#x27;</span>class_definition<span class="hljs-string">&#x27;: &#x27;</span>Condominium BMR<span class="hljs-string">&#x27;
    },
    {
      &#x27;</span>use_cod<span class="hljs-string">e&#x27;: &#x27;</span>SRES<span class="hljs-string">&#x27;,
      &#x27;</span>use_definition<span class="hljs-string">&#x27;: &#x27;</span>Single <span class="hljs-keyword">Family</span> Residential<span class="hljs-string">&#x27;,
      &#x27;</span>class_cod<span class="hljs-string">e&#x27;: &#x27;</span>ZEU<span class="hljs-string">&#x27;,
      &#x27;</span>class_definition<span class="hljs-string">&#x27;: &#x27;</span>Condominium Economic Unit <span class="hljs-string">&#x27;
    }
  ]

const unknownClass = {
  &#x27;</span>use_cod<span class="hljs-string">e&#x27;: &#x27;</span><span class="hljs-type">UNKNOWN</span><span class="hljs-string">&#x27;,
  &#x27;</span>use_definition<span class="hljs-string">&#x27;: &#x27;</span><span class="hljs-type">Unknown</span><span class="hljs-string">&#x27;,
  &#x27;</span>class_cod<span class="hljs-string">e&#x27;: &#x27;</span>X<span class="hljs-string">&#x27;,
  &#x27;</span>class_definition<span class="hljs-string">&#x27;: &#x27;</span><span class="hljs-type">Unknown</span><span class="hljs-string">&#x27;
}

export const getClassByCode = (classCode) =&gt; {
  const results = propertyClasses.filter((propertyClass) =&gt; propertyClass.class_code === classCode)
  if (results.length &gt;= 1) return results[0]
  return unknownClass
}

export const formatPropertyClass = (propertyClass) =&gt; {
  return `${propertyClass.use_definition.toLocaleLowerCase()} building (${propertyClass.class_definition.toLocaleLowerCase()})`
}
</span></pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrcutilsreacttable.js"><a href="#toc"><a name="ui-src-utils-reacttable-js">ui/src/utils/reactTable.js</a></a></h2>
<pre><code>import React from &#x27;react&#x27;

<span class="hljs-comment">// needs a unit test</span>
<span class="hljs-keyword">function</span> get<span class="hljs-constructor">OwnerString(<span class="hljs-params">elem</span>)</span> {
  <span class="hljs-keyword">if</span> (<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">React</span>.</span></span>is<span class="hljs-constructor">ValidElement(<span class="hljs-params">elem</span>)</span>) return elem.props.children <span class="hljs-comment">// React element</span>
  <span class="hljs-keyword">if</span> (elem<span class="hljs-literal">[<span class="hljs-number">0</span>]</span><span class="hljs-operator"> &amp;&amp; </span><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">React</span>.</span></span>is<span class="hljs-constructor">ValidElement(<span class="hljs-params">elem</span>[0][0])</span>) { <span class="hljs-comment">// nested React element</span>
    return elem<span class="hljs-literal">[<span class="hljs-number">0</span>]</span><span class="hljs-literal">[<span class="hljs-number">0</span>]</span>.props.children<span class="hljs-literal">[<span class="hljs-number">0</span>]</span>
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (elem<span class="hljs-literal">[<span class="hljs-number">0</span>]</span><span class="hljs-operator"> &amp;&amp; </span>elem<span class="hljs-literal">[<span class="hljs-number">0</span>]</span><span class="hljs-literal">[<span class="hljs-number">0</span>]</span>) { <span class="hljs-comment">// nested string</span>
    return elem<span class="hljs-literal">[<span class="hljs-number">0</span>]</span><span class="hljs-literal">[<span class="hljs-number">0</span>]</span>
  } <span class="hljs-keyword">else</span> {
    console.log(&#x27;NO direct owner <span class="hljs-built_in">string</span> found: &#x27;, elem)
  }
}

<span class="hljs-keyword">function</span> get<span class="hljs-constructor">AddressString(<span class="hljs-params">elem</span>)</span> {
  <span class="hljs-keyword">let</span> elemString
  elem = (elem<span class="hljs-literal">[<span class="hljs-number">0</span>]</span>) ? elem<span class="hljs-literal">[<span class="hljs-number">0</span>]</span> : elem
  <span class="hljs-keyword">if</span> (<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">React</span>.</span></span>is<span class="hljs-constructor">ValidElement(<span class="hljs-params">elem</span>)</span>) {
    elemString = elem.props.children
  } <span class="hljs-keyword">else</span> {
    console.log(&#x27;NO address <span class="hljs-built_in">string</span> found: &#x27;, elem)
  }
  return elemString
}

export {
  getOwnerString,
  getAddressString
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrcutilssearchutils.js"><a href="#toc"><a name="ui-src-utils-searchutils-js">ui/src/utils/searchUtils.js</a></a></h2>
<pre><code><span class="hljs-comment">//use these temporarily</span>
<span class="hljs-comment">//for searching by neighborhood name</span>
<span class="hljs-keyword">const</span> neighborhoodNames = [
  <span class="hljs-string">&#x27;Bayview&#x27;</span>,
  <span class="hljs-string">&#x27;Bernal Heights&#x27;</span>,
  <span class="hljs-string">&#x27;Castro/Upper Market&#x27;</span>,
  <span class="hljs-string">&#x27;Chinatown&#x27;</span>,
  <span class="hljs-string">&#x27;Crocker Amazon&#x27;</span>,
  <span class="hljs-string">&#x27;Diamond Heights&#x27;</span>,
  <span class="hljs-string">&#x27;Downtown/Civic Center&#x27;</span>,
  <span class="hljs-string">&#x27;Excelsior&#x27;</span>,
  <span class="hljs-string">&#x27;Financial District&#x27;</span>,
  <span class="hljs-string">&#x27;Glen Park&#x27;</span>,
  <span class="hljs-string">&#x27;Golden Gate Park&#x27;</span>,
  <span class="hljs-string">&#x27;Haight Ashbury&#x27;</span>,
  <span class="hljs-string">&#x27;Inner Richmond&#x27;</span>,
  <span class="hljs-string">&#x27;Inner Sunset&#x27;</span>,
  <span class="hljs-string">&#x27;Lakeshore&#x27;</span>,
  <span class="hljs-string">&#x27;Marina&#x27;</span>,
  <span class="hljs-string">&#x27;Mission&#x27;</span>,
  <span class="hljs-string">&#x27;Nob Hill&#x27;</span>,
  <span class="hljs-string">&#x27;Noe Valley&#x27;</span>,
  <span class="hljs-string">&#x27;North Beach&#x27;</span>,
  <span class="hljs-string">&#x27;Ocean View&#x27;</span>,
  <span class="hljs-string">&#x27;Outer Mission&#x27;</span>,
  <span class="hljs-string">&#x27;Outer Richmond&#x27;</span>,
  <span class="hljs-string">&#x27;Outer Sunset&#x27;</span>,
  <span class="hljs-string">&#x27;Pacific Heights&#x27;</span>,
  <span class="hljs-string">&#x27;Parkside&#x27;</span>,
  <span class="hljs-string">&#x27;Potrero Hill&#x27;</span>,
  <span class="hljs-string">&#x27;Presidio&#x27;</span>,
  <span class="hljs-string">&#x27;Presidio Heights&#x27;</span>,
  <span class="hljs-string">&#x27;Russian Hill&#x27;</span>,
  <span class="hljs-string">&#x27;Seacliff&#x27;</span>,
  <span class="hljs-string">&#x27;South Of Market&#x27;</span>,
  <span class="hljs-string">&#x27;Treasure Island/YBI&#x27;</span>,
  <span class="hljs-string">&#x27;Twin Peaks&#x27;</span>,
  <span class="hljs-string">&#x27;Visitacion Valley&#x27;</span>,
  <span class="hljs-string">&#x27;West Of Twin Peaks&#x27;</span>,
  <span class="hljs-string">&#x27;Western Addition&#x27;</span>
]

<span class="hljs-comment">// TODO needs a unit test</span>
<span class="hljs-comment">//this function returns a filtered list of neighborhoods</span>
<span class="hljs-comment">//and may need to be updated</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">listNeighborhoods</span>(<span class="hljs-params">searchTerm</span>) {
  <span class="hljs-keyword">const</span> neighborhoodsList = neighborhoodNames
    .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">name</span> =&gt;</span> {
      <span class="hljs-keyword">const</span> nameUpper = name.<span class="hljs-title function_">toUpperCase</span>()
      <span class="hljs-keyword">const</span> searchTermUpper = searchTerm.<span class="hljs-title function_">toUpperCase</span>()
      <span class="hljs-keyword">if</span> (nameUpper.<span class="hljs-title function_">indexOf</span>(searchTermUpper) &gt; -<span class="hljs-number">1</span>) {
        <span class="hljs-keyword">return</span> { name }
      }
      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
    })
    .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">name</span> =&gt;</span> name !== <span class="hljs-literal">null</span>)
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(neighborhoodsList)
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">composeQuery</span> = (<span class="hljs-params"> searchType, item </span>) =&gt; {
  <span class="hljs-keyword">if</span> (!item) { <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span> }
  <span class="hljs-keyword">if</span> ( searchType === <span class="hljs-string">&#x27;parcel&#x27;</span> ) { <span class="hljs-keyword">return</span> <span class="hljs-string">`?bl=<span class="hljs-subst">${ item.block_lot }</span>`</span> }
  <span class="hljs-keyword">const</span> baseQuery = <span class="hljs-string">`?search=<span class="hljs-subst">${ <span class="hljs-built_in">encodeURIComponent</span>( searchType === <span class="hljs-string">&#x27;owner&#x27;</span> ? item.name_norm : item.name ) }</span>`</span>
  <span class="hljs-keyword">if</span> ( searchType === <span class="hljs-string">&#x27;neighborhood&#x27;</span> ) { <span class="hljs-keyword">return</span> baseQuery }
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (item.<span class="hljs-property">__typename</span> != <span class="hljs-literal">null</span>) { <span class="hljs-keyword">return</span> baseQuery + <span class="hljs-string">`&amp;be=<span class="hljs-subst">${ item.__typename.split( <span class="hljs-string">&#x27;SOS_&#x27;</span> )[ <span class="hljs-number">1</span> ].toLowerCase() }</span>`</span> }
  <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrcutilsstringutils.js"><a href="#toc"><a name="ui-src-utils-stringutils-js">ui/src/utils/stringUtils.js</a></a></h2>
<pre><code>function reformatDate(str, short = <span class="hljs-literal">true</span>) {
  <span class="hljs-keyword">if</span> (typeof str !== <span class="hljs-string">&#x27;string&#x27;</span> || str.length &lt; <span class="hljs-number">8</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>
  <span class="hljs-keyword">const</span> y = str.substr(<span class="hljs-number">0</span>,<span class="hljs-number">4</span>),
    m = str.substr(<span class="hljs-number">4</span>,<span class="hljs-number">2</span>) - <span class="hljs-number">1</span>,
    d = str.substr(<span class="hljs-number">6</span>,<span class="hljs-number">2</span>)
  <span class="hljs-keyword">const</span> date = new Date(y,m,d)
  <span class="hljs-keyword">if</span> (isNaN(date.getTime())) <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>
  <span class="hljs-keyword">if</span> (short) <span class="hljs-keyword">return</span> date.toLocaleDateString()
  <span class="hljs-keyword">return</span> date.toDateString()
}

<span class="hljs-comment">// Helper function for titleCase, to handle &#x27;/&#x27; and &#x27;-&#x27; edge cases</span>
<span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> Yes, this seems like overkill, but using regex visibly slows down the text loading</span>
<span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> see if we can format the strings serverside or on the DB instead ?</span>
<span class="hljs-comment">// function mixSeparatedWordsCase(str, seperator) {</span>
<span class="hljs-comment">//   return str.split(seperator).map(word =&gt; word[0].toUpperCase() + word.slice(1).toLowerCase()).join(seperator);</span>
<span class="hljs-comment">// }</span>

<span class="hljs-comment">// PURPOSE: this function returns a string in &quot;title case&quot; format, to display to users</span>
<span class="hljs-comment">// It converts text to lower case, identifies any character that immediately follows a space, &quot;-&quot;, &quot;/&quot;, or &quot;.&quot;,</span>
<span class="hljs-comment">// and capitalizes it</span>
<span class="hljs-comment">// It ignores/capitalizes the following reserved words:</span>
<span class="hljs-keyword">const</span> reservedWords = [<span class="hljs-string">&#x27;LLC&#x27;</span>, <span class="hljs-string">&#x27;LP&#x27;</span>, <span class="hljs-string">&#x27;CA&#x27;</span>, <span class="hljs-string">&#x27;PO&#x27;</span>]
<span class="hljs-keyword">const</span> exceptions = [<span class="hljs-string">&#x27;and&#x27;</span>, <span class="hljs-string">&#x27;or&#x27;</span>, <span class="hljs-string">&#x27;of&#x27;</span>] 
<span class="hljs-keyword">const</span> isWordRE = /\w+/g

<span class="hljs-keyword">const</span> titleCase = (str, separators = [<span class="hljs-string">&#x27; &#x27;</span>, <span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-string">&#x27;-&#x27;</span>, <span class="hljs-string">&#x27;.&#x27;</span>, <span class="hljs-string">&#x27;,&#x27;</span>]) =&gt; {
  <span class="hljs-keyword">if</span> (![ <span class="hljs-string">&#x27;number&#x27;</span>, <span class="hljs-string">&#x27;string&#x27;</span> ].includes((typeof str))) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>
  }

  <span class="hljs-keyword">const</span> cleanStr = str + <span class="hljs-string">&#x27;&#x27;</span>

  <span class="hljs-comment">// no more separators, end recursion</span>
  <span class="hljs-keyword">if</span> (separators.length === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> cleanStr

  <span class="hljs-comment">/* Logic to title case a word */</span>
  <span class="hljs-keyword">const</span> titleCaseWord = w =&gt; {
    <span class="hljs-keyword">if</span> (!w || typeof w !== <span class="hljs-string">&#x27;string&#x27;</span> || w.length &lt;= <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> w
    <span class="hljs-keyword">const</span> idiom = idomaticWord(w) <span class="hljs-comment">/* Check for special cases */</span>
    <span class="hljs-keyword">if</span> (typeof idiom === <span class="hljs-string">&#x27;string&#x27;</span>) <span class="hljs-keyword">return</span> idiom
    <span class="hljs-keyword">const</span> firstLetter = w[<span class="hljs-number">0</span>]
    <span class="hljs-keyword">const</span> restOfTheWord = w.slice(<span class="hljs-number">1</span>)
    <span class="hljs-keyword">return</span> firstLetter.toUpperCase() + restOfTheWord.toLowerCase()
  }

  <span class="hljs-comment">/* Handle special cases of O&#x27;Farrell and McWhatever */</span>
  <span class="hljs-keyword">const</span> idomaticWord = w =&gt; {
    <span class="hljs-keyword">if</span> (!w || typeof w !== <span class="hljs-string">&#x27;string&#x27;</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
    <span class="hljs-keyword">const</span> word = w.toLowerCase()
    <span class="hljs-keyword">if</span> (word.startsWith(<span class="hljs-string">&#x27;mc&#x27;</span>) &amp;&amp; word.length &gt; <span class="hljs-number">3</span>)
      <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Mc&#x27;</span> + w[<span class="hljs-number">2</span>].toUpperCase() + word.slice(<span class="hljs-number">3</span>)
    <span class="hljs-keyword">if</span>(exceptions.includes(word)) <span class="hljs-keyword">return</span>(word)
    switch(word) {
      case <span class="hljs-string">&#x27;ofarrell&#x27;</span>: <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;O\&#x27;Farrell&#x27;</span>
      case <span class="hljs-string">&#x27;o\&#x27;farrell&#x27;</span>: <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;O\&#x27;Farrell&#x27;</span>
      default: <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
    }
  }

  <span class="hljs-comment">// split and join with the current separator</span>
  <span class="hljs-keyword">const</span> formattedSeparator = separators[<span class="hljs-number">0</span>] === <span class="hljs-string">&#x27;,&#x27;</span> ? <span class="hljs-string">&#x27;, &#x27;</span> : separators[<span class="hljs-number">0</span>]
  <span class="hljs-keyword">return</span> cleanStr
    .split(separators[<span class="hljs-number">0</span>]).map(word =&gt; {
      <span class="hljs-comment">// not a string, quit</span>
      <span class="hljs-keyword">if</span> (typeof word !== <span class="hljs-string">&#x27;string&#x27;</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>
      }

      <span class="hljs-comment">// not a word, quit</span>
      <span class="hljs-keyword">if</span> (!word.match(isWordRE)) {
        <span class="hljs-keyword">return</span> word
      }


      <span class="hljs-comment">// cap single letter and reserved words, title case the rest</span>
      <span class="hljs-keyword">const</span> cappedWords = (reservedWords.includes(word.toUpperCase()) || word.length === <span class="hljs-number">1</span>)
        ? word.toUpperCase()
        : titleCaseWord(word)

      <span class="hljs-comment">// go down a level with the next separator</span>
      <span class="hljs-keyword">return</span> titleCase(cappedWords, separators.slice(<span class="hljs-number">1</span>))
    })
    .join(formattedSeparator)
}

function toUnderscore(str) {
  <span class="hljs-keyword">if</span> (!str) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
  <span class="hljs-keyword">return</span> str.replace(/\s+/g, <span class="hljs-string">&#x27;_&#x27;</span>)
}

export {
  reformatDate,
  titleCase,
  toUnderscore
}
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrcutilsstringutils.test.js"><a href="#toc"><a name="ui-src-utils-stringutils-test-js">ui/src/utils/stringUtils.test.js</a></a></h2>
<pre><code>import { titleCase } from &#x27;./stringUtils&#x27;

describe(&#x27;utils/stringUtils&#x27;,<span class="hljs-function"> <span class="hljs-params">()</span> =&gt;</span> {
  it(&#x27;returns an empty <span class="hljs-built_in">string</span> <span class="hljs-keyword">when</span> receiving undefined&#x27;,<span class="hljs-function"> <span class="hljs-params">()</span> =&gt;</span> {
    expect(title<span class="hljs-constructor">Case(<span class="hljs-params">undefined</span>)</span>)
      .<span class="hljs-keyword">to</span><span class="hljs-constructor">Equal(&#x27;&#x27;)</span>
  })

  it(&#x27;returns an empty <span class="hljs-built_in">string</span> <span class="hljs-keyword">when</span> receiving null&#x27;,<span class="hljs-function"> <span class="hljs-params">()</span> =&gt;</span> {
    expect(title<span class="hljs-constructor">Case(<span class="hljs-params">null</span>)</span>)
      .<span class="hljs-keyword">to</span><span class="hljs-constructor">Equal(&#x27;&#x27;)</span>
  })

  it(&#x27;returns a numeric <span class="hljs-built_in">string</span> <span class="hljs-keyword">when</span> receiving a number&#x27;,<span class="hljs-function"> <span class="hljs-params">()</span> =&gt;</span> {
    expect(title<span class="hljs-constructor">Case(5)</span>)
      .<span class="hljs-keyword">to</span><span class="hljs-constructor">Equal(&#x27;5&#x27;)</span>
  })

  it(&#x27;returns an empty <span class="hljs-built_in">string</span> <span class="hljs-keyword">when</span> receiving an <span class="hljs-built_in">array</span>&#x27;,<span class="hljs-function"> <span class="hljs-params">()</span> =&gt;</span> {
    expect(title<span class="hljs-constructor">Case([ 5, &#x27;<span class="hljs-params">a</span>&#x27;, [] ])</span>)
      .<span class="hljs-keyword">to</span><span class="hljs-constructor">Equal(&#x27;&#x27;)</span>
  })

  it(&#x27;returns an empty <span class="hljs-built_in">string</span> <span class="hljs-keyword">when</span> receiving an <span class="hljs-keyword">object</span>&#x27;,<span class="hljs-function"> <span class="hljs-params">()</span> =&gt;</span> {
    expect(title<span class="hljs-constructor">Case({ <span class="hljs-params">a</span>: 5, <span class="hljs-params">b</span>:&#x27;<span class="hljs-params">a</span>&#x27;, <span class="hljs-params">c</span>:[] })</span>)
      .<span class="hljs-keyword">to</span><span class="hljs-constructor">Equal(&#x27;&#x27;)</span>
  })

  it(&#x27;changes nothing <span class="hljs-keyword">if</span> the <span class="hljs-built_in">string</span> follows all the rules&#x27;,<span class="hljs-function"> <span class="hljs-params">()</span> =&gt;</span> {
    expect(title<span class="hljs-constructor">Case(&#x27;This Is A Good-Enough Example<span class="hljs-operator">/</span>Test LLC P.O. O.K. Nice&#x27;)</span>).<span class="hljs-keyword">to</span><span class="hljs-constructor">Equal(&#x27;This Is A Good-Enough Example<span class="hljs-operator">/</span>Test LLC P.O. O.K. Nice&#x27;)</span>
  })

  it(&#x27;changes single letter words <span class="hljs-keyword">to</span> upper case&#x27;,<span class="hljs-function"> <span class="hljs-params">()</span> =&gt;</span> {
    expect(title<span class="hljs-constructor">Case(&#x27;<span class="hljs-params">a</span> <span class="hljs-params">thing</span> <span class="hljs-params">i</span> <span class="hljs-params">am</span> <span class="hljs-params">testing</span> <span class="hljs-params">by</span> <span class="hljs-params">i</span>.<span class="hljs-params">m</span>. <span class="hljs-params">good</span>&#x27;)</span>).<span class="hljs-keyword">to</span><span class="hljs-constructor">Equal(&#x27;A Thing I Am Testing By I.M. Good&#x27;)</span>
  })

  it(&#x27;changes slashed words <span class="hljs-keyword">to</span> uppercase&#x27;,<span class="hljs-function"> <span class="hljs-params">()</span> =&gt;</span> {
    expect(title<span class="hljs-constructor">Case(&#x27;Classic <span class="hljs-params">movie</span> <span class="hljs-params">is</span> <span class="hljs-params">face</span><span class="hljs-operator">/</span><span class="hljs-params">off</span>&#x27;)</span>).<span class="hljs-keyword">to</span><span class="hljs-constructor">Equal(&#x27;Classic Movie Is Face<span class="hljs-operator">/</span>Off&#x27;)</span>
  })

  it(&#x27;changes hyphenated words <span class="hljs-keyword">to</span> uppercase&#x27;,<span class="hljs-function"> <span class="hljs-params">()</span> =&gt;</span> {
    expect(title<span class="hljs-constructor">Case(&#x27;Cooked <span class="hljs-params">up</span> <span class="hljs-params">medium</span>-<span class="hljs-params">well</span>&#x27;)</span>).<span class="hljs-keyword">to</span><span class="hljs-constructor">Equal(&#x27;Cooked Up Medium-Well&#x27;)</span>
  })

  it(&#x27;changes dotted words <span class="hljs-keyword">to</span> uppercase&#x27;,<span class="hljs-function"> <span class="hljs-params">()</span> =&gt;</span> {
    expect(title<span class="hljs-constructor">Case(&#x27;<span class="hljs-params">agents</span> <span class="hljs-params">of</span> <span class="hljs-params">s</span>.<span class="hljs-params">h</span>.<span class="hljs-params">i</span>.<span class="hljs-params">e</span>.<span class="hljs-params">l</span>.<span class="hljs-params">d</span>.&#x27;)</span>).<span class="hljs-keyword">to</span><span class="hljs-constructor">Equal(&#x27;Agents Of S.H.I.E.L.D.&#x27;)</span>
  })

  it(&#x27;changes words <span class="hljs-keyword">with</span> all separators <span class="hljs-keyword">to</span> uppercase&#x27;,<span class="hljs-function"> <span class="hljs-params">()</span> =&gt;</span> {
    expect(title<span class="hljs-constructor">Case(&#x27;<span class="hljs-params">the</span> <span class="hljs-params">on</span><span class="hljs-operator">/</span><span class="hljs-params">off</span>-<span class="hljs-params">c</span>.<span class="hljs-params">b</span>.&#x27;)</span>).<span class="hljs-keyword">to</span><span class="hljs-constructor">Equal(&#x27;The On<span class="hljs-operator">/</span>Off-C.B.&#x27;)</span>
  })

  it(&#x27;changes reserved words <span class="hljs-keyword">to</span> uppercase&#x27;,<span class="hljs-function"> <span class="hljs-params">()</span> =&gt;</span> {
    expect(title<span class="hljs-constructor">Case(&#x27;<span class="hljs-params">llc</span> <span class="hljs-params">lp</span> <span class="hljs-params">ca</span> <span class="hljs-params">i</span> <span class="hljs-params">p</span>.<span class="hljs-params">o</span>. <span class="hljs-params">po</span>&#x27;)</span>).<span class="hljs-keyword">to</span><span class="hljs-constructor">Equal(&#x27;LLC LP CA I P.O. PO&#x27;)</span>
  })

  it(&#x27;changes hyphenated reserved words <span class="hljs-keyword">to</span> uppercase&#x27;,<span class="hljs-function"> <span class="hljs-params">()</span> =&gt;</span> {
    expect(title<span class="hljs-constructor">Case(&#x27;<span class="hljs-params">llc</span>-<span class="hljs-params">lp</span>-<span class="hljs-params">ca</span>-<span class="hljs-params">i</span>-<span class="hljs-params">p</span>.<span class="hljs-params">o</span>.-<span class="hljs-params">po</span>&#x27;)</span>).<span class="hljs-keyword">to</span><span class="hljs-constructor">Equal(&#x27;LLC-LP-CA-I-P.O.-PO&#x27;)</span>
  })

  it(&#x27;changes slashed reserved words <span class="hljs-keyword">to</span> uppercase&#x27;,<span class="hljs-function"> <span class="hljs-params">()</span> =&gt;</span> {
    expect(title<span class="hljs-constructor">Case(&#x27;<span class="hljs-params">llc</span><span class="hljs-operator">/</span><span class="hljs-params">lp</span><span class="hljs-operator">/</span><span class="hljs-params">ca</span><span class="hljs-operator">/</span><span class="hljs-params">i</span><span class="hljs-operator">/</span><span class="hljs-params">p</span>.<span class="hljs-params">o</span>.<span class="hljs-operator">/</span><span class="hljs-params">po</span>&#x27;)</span>).<span class="hljs-keyword">to</span><span class="hljs-constructor">Equal(&#x27;LLC<span class="hljs-operator">/</span>LP<span class="hljs-operator">/</span>CA<span class="hljs-operator">/</span>I<span class="hljs-operator">/</span>P.O.<span class="hljs-operator">/</span>PO&#x27;)</span>
  })

  it(&#x27;changes dotted reserved words <span class="hljs-keyword">to</span> uppercase&#x27;,<span class="hljs-function"> <span class="hljs-params">()</span> =&gt;</span> {
    expect(title<span class="hljs-constructor">Case(&#x27;<span class="hljs-params">llc</span>.<span class="hljs-params">lp</span>.<span class="hljs-params">ca</span>.<span class="hljs-params">i</span>.<span class="hljs-params">p</span>.<span class="hljs-params">o</span>.<span class="hljs-params">po</span>&#x27;)</span>).<span class="hljs-keyword">to</span><span class="hljs-constructor">Equal(&#x27;LLC.LP.CA.I.P.O.PO&#x27;)</span>
  })

  it(&#x27;changes a single word <span class="hljs-keyword">to</span> title case&#x27;,<span class="hljs-function"> <span class="hljs-params">()</span> =&gt;</span> {
    expect(title<span class="hljs-constructor">Case(&#x27;MARKET&#x27;)</span>).<span class="hljs-keyword">to</span><span class="hljs-constructor">Equal(&#x27;Market&#x27;)</span>
  })

  it(&#x27;changes a single letter <span class="hljs-keyword">to</span> upper case&#x27;,<span class="hljs-function"> <span class="hljs-params">()</span> =&gt;</span> {
    expect(title<span class="hljs-constructor">Case(&#x27;<span class="hljs-params">z</span>&#x27;)</span>).<span class="hljs-keyword">to</span><span class="hljs-constructor">Equal(&#x27;Z&#x27;)</span>
  })

  it(&#x27;handles common EB use cases&#x27;,<span class="hljs-function"> <span class="hljs-params">()</span> =&gt;</span> {
    expect(title<span class="hljs-constructor">Case(&#x27;<span class="hljs-params">owner</span> <span class="hljs-params">and</span> <span class="hljs-params">owner</span>, <span class="hljs-params">llc</span>&#x27;)</span>).<span class="hljs-keyword">to</span><span class="hljs-constructor">Equal(&#x27;Owner And Owner, LLC&#x27;)</span>
    expect(title<span class="hljs-constructor">Case(&#x27;<span class="hljs-params">upper</span> <span class="hljs-params">market</span><span class="hljs-operator">/</span><span class="hljs-params">castro</span>&#x27;)</span>).<span class="hljs-keyword">to</span><span class="hljs-constructor">Equal(&#x27;Upper Market<span class="hljs-operator">/</span>Castro&#x27;)</span>
    expect(title<span class="hljs-constructor">Case(&#x27;UPPER MARKET<span class="hljs-operator">/</span>CASTRO&#x27;)</span>).<span class="hljs-keyword">to</span><span class="hljs-constructor">Equal(&#x27;Upper Market<span class="hljs-operator">/</span>Castro&#x27;)</span>
    expect(title<span class="hljs-constructor">Case(&#x27;INNER RICHMOND&#x27;)</span>).<span class="hljs-keyword">to</span><span class="hljs-constructor">Equal(&#x27;Inner Richmond&#x27;)</span>
  })
})
</pre>
<p></code></p>
<div style="page-break-after: always;">

</div>
<h2 id="uisrcutilstableutils.js"><a href="#toc"><a name="ui-src-utils-tableutils-js">ui/src/utils/tableUtils.js</a></a></h2>
<pre><code><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>
<span class="hljs-keyword">import</span> { titleCase } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./stringUtils&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Link</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">RouterLink</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-router-dom&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Link</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@material-ui/core/Link&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Row</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../components/Grid&#x27;</span>

<span class="hljs-comment">/*
 * renderOwnerLink: Attempts to create a title-cased link to an owner page
 *
 * If the business type is either non-existent or an invalid business type,
 * returns the title-cased input name
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">renderOwnerLink</span> = (<span class="hljs-params">owner_name, be_type</span>) =&gt; {
  <span class="hljs-keyword">if</span> (!be_type) {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">titleCase</span>(owner_name)
  }

  <span class="hljs-comment">// if the business type is neither &quot;SOS_LP&quot; or &quot;SOS_Corp&quot;, return</span>
  <span class="hljs-keyword">if</span> (be_type !== <span class="hljs-string">&#x27;SOS_LP&#x27;</span> &amp;&amp; be_type !== <span class="hljs-string">&#x27;SOS_Corp&#x27;</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">titleCase</span>(owner_name)
  }

  <span class="hljs-keyword">return</span> (
    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Link</span>
      <span class="hljs-attr">component</span>=<span class="hljs-string">{RouterLink}</span>
      <span class="hljs-attr">to</span>=<span class="hljs-string">{{</span>
        <span class="hljs-attr">pathname:</span> &#x27;/<span class="hljs-attr">owner</span>&#x27;,
        <span class="hljs-attr">search:</span> `?<span class="hljs-attr">search</span>=<span class="hljs-string">${encodeURIComponent(owner_name)}&amp;be</span>=<span class="hljs-string">${</span>
          <span class="hljs-attr">be_type</span> === <span class="hljs-string">&#x27;SOS_LP&#x27;</span> ? &#x27;<span class="hljs-attr">lp</span>&#x27; <span class="hljs-attr">:</span> &#x27;<span class="hljs-attr">corp</span>&#x27;
        }`,
      }}&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span>
        <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span>
          <span class="hljs-attr">textDecoration:</span> &#x27;<span class="hljs-attr">underline</span>&#x27;,
          <span class="hljs-attr">alignItems:</span> &#x27;<span class="hljs-attr">center</span>&#x27;,
        }}&gt;</span>
        {titleCase(owner_name)}
      <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span></span>
  )
}

<span class="hljs-comment">/*
 * renderNetworkLink: Attempts to create a link to a network page
 *
 * If the network ID is non-existent, returns the title-cased input text
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">renderNetworkLink</span> = (<span class="hljs-params">network_id, text</span>) =&gt; {
  <span class="hljs-keyword">if</span> (!network_id || network_id === <span class="hljs-string">&#x27;&#x27;</span>) {
    <span class="hljs-keyword">return</span> text
  }

  <span class="hljs-keyword">return</span> (
    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Link</span>
      <span class="hljs-attr">component</span>=<span class="hljs-string">{RouterLink}</span>
      <span class="hljs-attr">to</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">pathname:</span> &#x27;/<span class="hljs-attr">graph</span>&#x27;, <span class="hljs-attr">search:</span> `?<span class="hljs-attr">id</span>=<span class="hljs-string">${encodeURIComponent(network_id)}</span>` }}&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span>
        <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span>
          <span class="hljs-attr">textDecoration:</span> &#x27;<span class="hljs-attr">underline</span>&#x27;,
          <span class="hljs-attr">alignItems:</span> &#x27;<span class="hljs-attr">center</span>&#x27;,
        }}&gt;</span>
        {text}
      <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span></span>
  )
}

<span class="hljs-comment">/*
 * renderParcelLink: Attempts to create a link to a parcel page (consisting of
 * title-cased address)
 *
 * If the block lot or address is non-existent, returns the title-cased input address
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">renderParcelLink</span> = (<span class="hljs-params">block_lot, address</span>) =&gt; {
  <span class="hljs-keyword">if</span> (!block_lot || !address) {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">titleCase</span>(address)
  }

  <span class="hljs-keyword">return</span> (
    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Link</span>
      <span class="hljs-attr">to</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">pathname:</span> &#x27;/<span class="hljs-attr">parcel</span>&#x27;, <span class="hljs-attr">search:</span> `?<span class="hljs-attr">bl</span>=<span class="hljs-string">${encodeURIComponent(block_lot)}</span>` }}
      <span class="hljs-attr">component</span>=<span class="hljs-string">{RouterLink}</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Row</span> <span class="hljs-attr">alignItems</span>=<span class="hljs-string">&#x27;center&#x27;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">textDecoration:</span> &#x27;<span class="hljs-attr">underline</span>&#x27; }}&gt;</span>
        {titleCase(address)}
      <span class="hljs-tag">&lt;/<span class="hljs-name">Row</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span></span>
  )
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">generateGraphIdUrl</span> = id =&gt; <span class="hljs-string">`/graph?id=<span class="hljs-subst">${<span class="hljs-built_in">encodeURIComponent</span>(id)}</span>`</span>
</pre>
<p></code></p>
</body>
</html>
